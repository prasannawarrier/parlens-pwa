function db(c,d){for(var y=0;y<d.length;y++){const C=d[y];if(typeof C!="string"&&!Array.isArray(C)){for(const D in C)if(D!=="default"&&!(D in c)){const P=Object.getOwnPropertyDescriptor(C,D);P&&Object.defineProperty(c,D,P.get?P:{enumerable:!0,get:()=>C[D]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))C(D);new MutationObserver(D=>{for(const P of D)if(P.type==="childList")for(const N of P.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&C(N)}).observe(document,{childList:!0,subtree:!0});function y(D){const P={};return D.integrity&&(P.integrity=D.integrity),D.referrerPolicy&&(P.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?P.credentials="include":D.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function C(D){if(D.ep)return;D.ep=!0;const P=y(D);fetch(D.href,P)}})();var Vm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ap(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Q1={exports:{}},Tg={};var Hx;function iw(){if(Hx)return Tg;Hx=1;var c=Symbol.for("react.transitional.element"),d=Symbol.for("react.fragment");function y(C,D,P){var N=null;if(P!==void 0&&(N=""+P),D.key!==void 0&&(N=""+D.key),"key"in D){P={};for(var h in D)h!=="key"&&(P[h]=D[h])}else P=D;return D=P.ref,{$$typeof:c,type:C,key:N,ref:D!==void 0?D:null,props:P}}return Tg.Fragment=d,Tg.jsx=y,Tg.jsxs=y,Tg}var qx;function rw(){return qx||(qx=1,Q1.exports=iw()),Q1.exports}var M=rw(),K1={exports:{}},$i={};var Zx;function sw(){if(Zx)return $i;Zx=1;var c=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),P=Symbol.for("react.consumer"),N=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),H=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),Q=Symbol.for("react.activity"),_e=Symbol.iterator;function we(ke){return ke===null||typeof ke!="object"?null:(ke=_e&&ke[_e]||ke["@@iterator"],typeof ke=="function"?ke:null)}var ve={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},me=Object.assign,he={};function Re(ke,nt,Nt){this.props=ke,this.context=nt,this.refs=he,this.updater=Nt||ve}Re.prototype.isReactComponent={},Re.prototype.setState=function(ke,nt){if(typeof ke!="object"&&typeof ke!="function"&&ke!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ke,nt,"setState")},Re.prototype.forceUpdate=function(ke){this.updater.enqueueForceUpdate(this,ke,"forceUpdate")};function tt(){}tt.prototype=Re.prototype;function Ye(ke,nt,Nt){this.props=ke,this.context=nt,this.refs=he,this.updater=Nt||ve}var pt=Ye.prototype=new tt;pt.constructor=Ye,me(pt,Re.prototype),pt.isPureReactComponent=!0;var Wt=Array.isArray;function Et(){}var it={H:null,A:null,T:null,S:null},at=Object.prototype.hasOwnProperty;function He(ke,nt,Nt){var _t=Nt.ref;return{$$typeof:c,type:ke,key:nt,ref:_t!==void 0?_t:null,props:Nt}}function xt(ke,nt){return He(ke.type,nt,ke.props)}function Pe(ke){return typeof ke=="object"&&ke!==null&&ke.$$typeof===c}function ct(ke){var nt={"=":"=0",":":"=2"};return"$"+ke.replace(/[=:]/g,function(Nt){return nt[Nt]})}var vt=/\/+/g;function Zt(ke,nt){return typeof ke=="object"&&ke!==null&&ke.key!=null?ct(""+ke.key):nt.toString(36)}function Ne(ke){switch(ke.status){case"fulfilled":return ke.value;case"rejected":throw ke.reason;default:switch(typeof ke.status=="string"?ke.then(Et,Et):(ke.status="pending",ke.then(function(nt){ke.status==="pending"&&(ke.status="fulfilled",ke.value=nt)},function(nt){ke.status==="pending"&&(ke.status="rejected",ke.reason=nt)})),ke.status){case"fulfilled":return ke.value;case"rejected":throw ke.reason}}throw ke}function Te(ke,nt,Nt,_t,tn){var Bt=typeof ke;(Bt==="undefined"||Bt==="boolean")&&(ke=null);var Kt=!1;if(ke===null)Kt=!0;else switch(Bt){case"bigint":case"string":case"number":Kt=!0;break;case"object":switch(ke.$$typeof){case c:case d:Kt=!0;break;case Y:return Kt=ke._init,Te(Kt(ke._payload),nt,Nt,_t,tn)}}if(Kt)return tn=tn(ke),Kt=_t===""?"."+Zt(ke,0):_t,Wt(tn)?(Nt="",Kt!=null&&(Nt=Kt.replace(vt,"$&/")+"/"),Te(tn,nt,Nt,"",function(Nn){return Nn})):tn!=null&&(Pe(tn)&&(tn=xt(tn,Nt+(tn.key==null||ke&&ke.key===tn.key?"":(""+tn.key).replace(vt,"$&/")+"/")+Kt)),nt.push(tn)),1;Kt=0;var an=_t===""?".":_t+":";if(Wt(ke))for(var sn=0;sn<ke.length;sn++)_t=ke[sn],Bt=an+Zt(_t,sn),Kt+=Te(_t,nt,Nt,Bt,tn);else if(sn=we(ke),typeof sn=="function")for(ke=sn.call(ke),sn=0;!(_t=ke.next()).done;)_t=_t.value,Bt=an+Zt(_t,sn++),Kt+=Te(_t,nt,Nt,Bt,tn);else if(Bt==="object"){if(typeof ke.then=="function")return Te(Ne(ke),nt,Nt,_t,tn);throw nt=String(ke),Error("Objects are not valid as a React child (found: "+(nt==="[object Object]"?"object with keys {"+Object.keys(ke).join(", ")+"}":nt)+"). If you meant to render a collection of children, use an array instead.")}return Kt}function We(ke,nt,Nt){if(ke==null)return ke;var _t=[],tn=0;return Te(ke,_t,"","",function(Bt){return nt.call(Nt,Bt,tn++)}),_t}function wt(ke){if(ke._status===-1){var nt=ke._result;nt=nt(),nt.then(function(Nt){(ke._status===0||ke._status===-1)&&(ke._status=1,ke._result=Nt)},function(Nt){(ke._status===0||ke._status===-1)&&(ke._status=2,ke._result=Nt)}),ke._status===-1&&(ke._status=0,ke._result=nt)}if(ke._status===1)return ke._result.default;throw ke._result}var zt=typeof reportError=="function"?reportError:function(ke){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var nt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ke=="object"&&ke!==null&&typeof ke.message=="string"?String(ke.message):String(ke),error:ke});if(!window.dispatchEvent(nt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ke);return}console.error(ke)},Gt={map:We,forEach:function(ke,nt,Nt){We(ke,function(){nt.apply(this,arguments)},Nt)},count:function(ke){var nt=0;return We(ke,function(){nt++}),nt},toArray:function(ke){return We(ke,function(nt){return nt})||[]},only:function(ke){if(!Pe(ke))throw Error("React.Children.only expected to receive a single React element child.");return ke}};return $i.Activity=Q,$i.Children=Gt,$i.Component=Re,$i.Fragment=y,$i.Profiler=D,$i.PureComponent=Ye,$i.StrictMode=C,$i.Suspense=U,$i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=it,$i.__COMPILER_RUNTIME={__proto__:null,c:function(ke){return it.H.useMemoCache(ke)}},$i.cache=function(ke){return function(){return ke.apply(null,arguments)}},$i.cacheSignal=function(){return null},$i.cloneElement=function(ke,nt,Nt){if(ke==null)throw Error("The argument must be a React element, but you passed "+ke+".");var _t=me({},ke.props),tn=ke.key;if(nt!=null)for(Bt in nt.key!==void 0&&(tn=""+nt.key),nt)!at.call(nt,Bt)||Bt==="key"||Bt==="__self"||Bt==="__source"||Bt==="ref"&&nt.ref===void 0||(_t[Bt]=nt[Bt]);var Bt=arguments.length-2;if(Bt===1)_t.children=Nt;else if(1<Bt){for(var Kt=Array(Bt),an=0;an<Bt;an++)Kt[an]=arguments[an+2];_t.children=Kt}return He(ke.type,tn,_t)},$i.createContext=function(ke){return ke={$$typeof:N,_currentValue:ke,_currentValue2:ke,_threadCount:0,Provider:null,Consumer:null},ke.Provider=ke,ke.Consumer={$$typeof:P,_context:ke},ke},$i.createElement=function(ke,nt,Nt){var _t,tn={},Bt=null;if(nt!=null)for(_t in nt.key!==void 0&&(Bt=""+nt.key),nt)at.call(nt,_t)&&_t!=="key"&&_t!=="__self"&&_t!=="__source"&&(tn[_t]=nt[_t]);var Kt=arguments.length-2;if(Kt===1)tn.children=Nt;else if(1<Kt){for(var an=Array(Kt),sn=0;sn<Kt;sn++)an[sn]=arguments[sn+2];tn.children=an}if(ke&&ke.defaultProps)for(_t in Kt=ke.defaultProps,Kt)tn[_t]===void 0&&(tn[_t]=Kt[_t]);return He(ke,Bt,tn)},$i.createRef=function(){return{current:null}},$i.forwardRef=function(ke){return{$$typeof:h,render:ke}},$i.isValidElement=Pe,$i.lazy=function(ke){return{$$typeof:Y,_payload:{_status:-1,_result:ke},_init:wt}},$i.memo=function(ke,nt){return{$$typeof:H,type:ke,compare:nt===void 0?null:nt}},$i.startTransition=function(ke){var nt=it.T,Nt={};it.T=Nt;try{var _t=ke(),tn=it.S;tn!==null&&tn(Nt,_t),typeof _t=="object"&&_t!==null&&typeof _t.then=="function"&&_t.then(Et,zt)}catch(Bt){zt(Bt)}finally{nt!==null&&Nt.types!==null&&(nt.types=Nt.types),it.T=nt}},$i.unstable_useCacheRefresh=function(){return it.H.useCacheRefresh()},$i.use=function(ke){return it.H.use(ke)},$i.useActionState=function(ke,nt,Nt){return it.H.useActionState(ke,nt,Nt)},$i.useCallback=function(ke,nt){return it.H.useCallback(ke,nt)},$i.useContext=function(ke){return it.H.useContext(ke)},$i.useDebugValue=function(){},$i.useDeferredValue=function(ke,nt){return it.H.useDeferredValue(ke,nt)},$i.useEffect=function(ke,nt){return it.H.useEffect(ke,nt)},$i.useEffectEvent=function(ke){return it.H.useEffectEvent(ke)},$i.useId=function(){return it.H.useId()},$i.useImperativeHandle=function(ke,nt,Nt){return it.H.useImperativeHandle(ke,nt,Nt)},$i.useInsertionEffect=function(ke,nt){return it.H.useInsertionEffect(ke,nt)},$i.useLayoutEffect=function(ke,nt){return it.H.useLayoutEffect(ke,nt)},$i.useMemo=function(ke,nt){return it.H.useMemo(ke,nt)},$i.useOptimistic=function(ke,nt){return it.H.useOptimistic(ke,nt)},$i.useReducer=function(ke,nt,Nt){return it.H.useReducer(ke,nt,Nt)},$i.useRef=function(ke){return it.H.useRef(ke)},$i.useState=function(ke){return it.H.useState(ke)},$i.useSyncExternalStore=function(ke,nt,Nt){return it.H.useSyncExternalStore(ke,nt,Nt)},$i.useTransition=function(){return it.H.useTransition()},$i.version="19.2.3",$i}var Xx;function qy(){return Xx||(Xx=1,K1.exports=sw()),K1.exports}var ge=qy();const ta=ap(ge);var J1={exports:{}},Ig={},ey={exports:{}},ty={};var Wx;function aw(){return Wx||(Wx=1,(function(c){function d(Te,We){var wt=Te.length;Te.push(We);e:for(;0<wt;){var zt=wt-1>>>1,Gt=Te[zt];if(0<D(Gt,We))Te[zt]=We,Te[wt]=Gt,wt=zt;else break e}}function y(Te){return Te.length===0?null:Te[0]}function C(Te){if(Te.length===0)return null;var We=Te[0],wt=Te.pop();if(wt!==We){Te[0]=wt;e:for(var zt=0,Gt=Te.length,ke=Gt>>>1;zt<ke;){var nt=2*(zt+1)-1,Nt=Te[nt],_t=nt+1,tn=Te[_t];if(0>D(Nt,wt))_t<Gt&&0>D(tn,Nt)?(Te[zt]=tn,Te[_t]=wt,zt=_t):(Te[zt]=Nt,Te[nt]=wt,zt=nt);else if(_t<Gt&&0>D(tn,wt))Te[zt]=tn,Te[_t]=wt,zt=_t;else break e}}return We}function D(Te,We){var wt=Te.sortIndex-We.sortIndex;return wt!==0?wt:Te.id-We.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var P=performance;c.unstable_now=function(){return P.now()}}else{var N=Date,h=N.now();c.unstable_now=function(){return N.now()-h}}var U=[],H=[],Y=1,Q=null,_e=3,we=!1,ve=!1,me=!1,he=!1,Re=typeof setTimeout=="function"?setTimeout:null,tt=typeof clearTimeout=="function"?clearTimeout:null,Ye=typeof setImmediate<"u"?setImmediate:null;function pt(Te){for(var We=y(H);We!==null;){if(We.callback===null)C(H);else if(We.startTime<=Te)C(H),We.sortIndex=We.expirationTime,d(U,We);else break;We=y(H)}}function Wt(Te){if(me=!1,pt(Te),!ve)if(y(U)!==null)ve=!0,Et||(Et=!0,ct());else{var We=y(H);We!==null&&Ne(Wt,We.startTime-Te)}}var Et=!1,it=-1,at=5,He=-1;function xt(){return he?!0:!(c.unstable_now()-He<at)}function Pe(){if(he=!1,Et){var Te=c.unstable_now();He=Te;var We=!0;try{e:{ve=!1,me&&(me=!1,tt(it),it=-1),we=!0;var wt=_e;try{t:{for(pt(Te),Q=y(U);Q!==null&&!(Q.expirationTime>Te&&xt());){var zt=Q.callback;if(typeof zt=="function"){Q.callback=null,_e=Q.priorityLevel;var Gt=zt(Q.expirationTime<=Te);if(Te=c.unstable_now(),typeof Gt=="function"){Q.callback=Gt,pt(Te),We=!0;break t}Q===y(U)&&C(U),pt(Te)}else C(U);Q=y(U)}if(Q!==null)We=!0;else{var ke=y(H);ke!==null&&Ne(Wt,ke.startTime-Te),We=!1}}break e}finally{Q=null,_e=wt,we=!1}We=void 0}}finally{We?ct():Et=!1}}}var ct;if(typeof Ye=="function")ct=function(){Ye(Pe)};else if(typeof MessageChannel<"u"){var vt=new MessageChannel,Zt=vt.port2;vt.port1.onmessage=Pe,ct=function(){Zt.postMessage(null)}}else ct=function(){Re(Pe,0)};function Ne(Te,We){it=Re(function(){Te(c.unstable_now())},We)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(Te){Te.callback=null},c.unstable_forceFrameRate=function(Te){0>Te||125<Te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):at=0<Te?Math.floor(1e3/Te):5},c.unstable_getCurrentPriorityLevel=function(){return _e},c.unstable_next=function(Te){switch(_e){case 1:case 2:case 3:var We=3;break;default:We=_e}var wt=_e;_e=We;try{return Te()}finally{_e=wt}},c.unstable_requestPaint=function(){he=!0},c.unstable_runWithPriority=function(Te,We){switch(Te){case 1:case 2:case 3:case 4:case 5:break;default:Te=3}var wt=_e;_e=Te;try{return We()}finally{_e=wt}},c.unstable_scheduleCallback=function(Te,We,wt){var zt=c.unstable_now();switch(typeof wt=="object"&&wt!==null?(wt=wt.delay,wt=typeof wt=="number"&&0<wt?zt+wt:zt):wt=zt,Te){case 1:var Gt=-1;break;case 2:Gt=250;break;case 5:Gt=1073741823;break;case 4:Gt=1e4;break;default:Gt=5e3}return Gt=wt+Gt,Te={id:Y++,callback:We,priorityLevel:Te,startTime:wt,expirationTime:Gt,sortIndex:-1},wt>zt?(Te.sortIndex=wt,d(H,Te),y(U)===null&&Te===y(H)&&(me?(tt(it),it=-1):me=!0,Ne(Wt,wt-zt))):(Te.sortIndex=Gt,d(U,Te),ve||we||(ve=!0,Et||(Et=!0,ct()))),Te},c.unstable_shouldYield=xt,c.unstable_wrapCallback=function(Te){var We=_e;return function(){var wt=_e;_e=We;try{return Te.apply(this,arguments)}finally{_e=wt}}}})(ty)),ty}var Yx;function ow(){return Yx||(Yx=1,ey.exports=aw()),ey.exports}var ny={exports:{}},Uo={};var $x;function lw(){if($x)return Uo;$x=1;var c=qy();function d(U){var H="https://react.dev/errors/"+U;if(1<arguments.length){H+="?args[]="+encodeURIComponent(arguments[1]);for(var Y=2;Y<arguments.length;Y++)H+="&args[]="+encodeURIComponent(arguments[Y])}return"Minified React error #"+U+"; visit "+H+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function y(){}var C={d:{f:y,r:function(){throw Error(d(522))},D:y,C:y,L:y,m:y,X:y,S:y,M:y},p:0,findDOMNode:null},D=Symbol.for("react.portal");function P(U,H,Y){var Q=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:Q==null?null:""+Q,children:U,containerInfo:H,implementation:Y}}var N=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(U,H){if(U==="font")return"";if(typeof H=="string")return H==="use-credentials"?H:""}return Uo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Uo.createPortal=function(U,H){var Y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!H||H.nodeType!==1&&H.nodeType!==9&&H.nodeType!==11)throw Error(d(299));return P(U,H,null,Y)},Uo.flushSync=function(U){var H=N.T,Y=C.p;try{if(N.T=null,C.p=2,U)return U()}finally{N.T=H,C.p=Y,C.d.f()}},Uo.preconnect=function(U,H){typeof U=="string"&&(H?(H=H.crossOrigin,H=typeof H=="string"?H==="use-credentials"?H:"":void 0):H=null,C.d.C(U,H))},Uo.prefetchDNS=function(U){typeof U=="string"&&C.d.D(U)},Uo.preinit=function(U,H){if(typeof U=="string"&&H&&typeof H.as=="string"){var Y=H.as,Q=h(Y,H.crossOrigin),_e=typeof H.integrity=="string"?H.integrity:void 0,we=typeof H.fetchPriority=="string"?H.fetchPriority:void 0;Y==="style"?C.d.S(U,typeof H.precedence=="string"?H.precedence:void 0,{crossOrigin:Q,integrity:_e,fetchPriority:we}):Y==="script"&&C.d.X(U,{crossOrigin:Q,integrity:_e,fetchPriority:we,nonce:typeof H.nonce=="string"?H.nonce:void 0})}},Uo.preinitModule=function(U,H){if(typeof U=="string")if(typeof H=="object"&&H!==null){if(H.as==null||H.as==="script"){var Y=h(H.as,H.crossOrigin);C.d.M(U,{crossOrigin:Y,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0})}}else H==null&&C.d.M(U)},Uo.preload=function(U,H){if(typeof U=="string"&&typeof H=="object"&&H!==null&&typeof H.as=="string"){var Y=H.as,Q=h(Y,H.crossOrigin);C.d.L(U,Y,{crossOrigin:Q,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0,type:typeof H.type=="string"?H.type:void 0,fetchPriority:typeof H.fetchPriority=="string"?H.fetchPriority:void 0,referrerPolicy:typeof H.referrerPolicy=="string"?H.referrerPolicy:void 0,imageSrcSet:typeof H.imageSrcSet=="string"?H.imageSrcSet:void 0,imageSizes:typeof H.imageSizes=="string"?H.imageSizes:void 0,media:typeof H.media=="string"?H.media:void 0})}},Uo.preloadModule=function(U,H){if(typeof U=="string")if(H){var Y=h(H.as,H.crossOrigin);C.d.m(U,{as:typeof H.as=="string"&&H.as!=="script"?H.as:void 0,crossOrigin:Y,integrity:typeof H.integrity=="string"?H.integrity:void 0})}else C.d.m(U)},Uo.requestFormReset=function(U){C.d.r(U)},Uo.unstable_batchedUpdates=function(U,H){return U(H)},Uo.useFormState=function(U,H,Y){return N.H.useFormState(U,H,Y)},Uo.useFormStatus=function(){return N.H.useHostTransitionStatus()},Uo.version="19.2.3",Uo}var Qx;function fb(){if(Qx)return ny.exports;Qx=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(d){console.error(d)}}return c(),ny.exports=lw(),ny.exports}var Kx;function cw(){if(Kx)return Ig;Kx=1;var c=ow(),d=qy(),y=fb();function C(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)o+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function D(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function P(r){var o=r,m=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(m=o.return),r=o.return;while(r)}return o.tag===3?m:null}function N(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function h(r){if(r.tag===31){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function U(r){if(P(r)!==r)throw Error(C(188))}function H(r){var o=r.alternate;if(!o){if(o=P(r),o===null)throw Error(C(188));return o!==r?null:r}for(var m=r,E=o;;){var L=m.return;if(L===null)break;var V=L.alternate;if(V===null){if(E=L.return,E!==null){m=E;continue}break}if(L.child===V.child){for(V=L.child;V;){if(V===m)return U(L),r;if(V===E)return U(L),o;V=V.sibling}throw Error(C(188))}if(m.return!==E.return)m=L,E=V;else{for(var ne=!1,Ae=L.child;Ae;){if(Ae===m){ne=!0,m=L,E=V;break}if(Ae===E){ne=!0,E=L,m=V;break}Ae=Ae.sibling}if(!ne){for(Ae=V.child;Ae;){if(Ae===m){ne=!0,m=V,E=L;break}if(Ae===E){ne=!0,E=V,m=L;break}Ae=Ae.sibling}if(!ne)throw Error(C(189))}}if(m.alternate!==E)throw Error(C(190))}if(m.tag!==3)throw Error(C(188));return m.stateNode.current===m?r:o}function Y(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=Y(r),o!==null)return o;r=r.sibling}return null}var Q=Object.assign,_e=Symbol.for("react.element"),we=Symbol.for("react.transitional.element"),ve=Symbol.for("react.portal"),me=Symbol.for("react.fragment"),he=Symbol.for("react.strict_mode"),Re=Symbol.for("react.profiler"),tt=Symbol.for("react.consumer"),Ye=Symbol.for("react.context"),pt=Symbol.for("react.forward_ref"),Wt=Symbol.for("react.suspense"),Et=Symbol.for("react.suspense_list"),it=Symbol.for("react.memo"),at=Symbol.for("react.lazy"),He=Symbol.for("react.activity"),xt=Symbol.for("react.memo_cache_sentinel"),Pe=Symbol.iterator;function ct(r){return r===null||typeof r!="object"?null:(r=Pe&&r[Pe]||r["@@iterator"],typeof r=="function"?r:null)}var vt=Symbol.for("react.client.reference");function Zt(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===vt?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case me:return"Fragment";case Re:return"Profiler";case he:return"StrictMode";case Wt:return"Suspense";case Et:return"SuspenseList";case He:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case ve:return"Portal";case Ye:return r.displayName||"Context";case tt:return(r._context.displayName||"Context")+".Consumer";case pt:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case it:return o=r.displayName||null,o!==null?o:Zt(r.type)||"Memo";case at:o=r._payload,r=r._init;try{return Zt(r(o))}catch{}}return null}var Ne=Array.isArray,Te=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,We=y.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,wt={pending:!1,data:null,method:null,action:null},zt=[],Gt=-1;function ke(r){return{current:r}}function nt(r){0>Gt||(r.current=zt[Gt],zt[Gt]=null,Gt--)}function Nt(r,o){Gt++,zt[Gt]=r.current,r.current=o}var _t=ke(null),tn=ke(null),Bt=ke(null),Kt=ke(null);function an(r,o){switch(Nt(Bt,o),Nt(tn,r),Nt(_t,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?Fu(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=Fu(o),r=ig(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}nt(_t),Nt(_t,r)}function sn(){nt(_t),nt(tn),nt(Bt)}function Nn(r){r.memoizedState!==null&&Nt(Kt,r);var o=_t.current,m=ig(o,r.type);o!==m&&(Nt(tn,r),Nt(_t,m))}function Dn(r){tn.current===r&&(nt(_t),nt(tn)),Kt.current===r&&(nt(Kt),Md._currentValue=wt)}var si,kn;function ui(r){if(si===void 0)try{throw Error()}catch(m){var o=m.stack.trim().match(/\n( *(at )?)/);si=o&&o[1]||"",kn=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+si+r+kn}var _i=!1;function Di(r,o){if(!r||_i)return"";_i=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var E={DetermineComponentFrameRoot:function(){try{if(o){var pn=function(){throw Error()};if(Object.defineProperty(pn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pn,[])}catch(Yt){var Ht=Yt}Reflect.construct(r,[],pn)}else{try{pn.call()}catch(Yt){Ht=Yt}r.call(pn.prototype)}}else{try{throw Error()}catch(Yt){Ht=Yt}(pn=r())&&typeof pn.catch=="function"&&pn.catch(function(){})}}catch(Yt){if(Yt&&Ht&&typeof Yt.stack=="string")return[Yt.stack,Ht.stack]}return[null,null]}};E.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var L=Object.getOwnPropertyDescriptor(E.DetermineComponentFrameRoot,"name");L&&L.configurable&&Object.defineProperty(E.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var V=E.DetermineComponentFrameRoot(),ne=V[0],Ae=V[1];if(ne&&Ae){var lt=ne.split(`
`),Vt=Ae.split(`
`);for(L=E=0;E<lt.length&&!lt[E].includes("DetermineComponentFrameRoot");)E++;for(;L<Vt.length&&!Vt[L].includes("DetermineComponentFrameRoot");)L++;if(E===lt.length||L===Vt.length)for(E=lt.length-1,L=Vt.length-1;1<=E&&0<=L&&lt[E]!==Vt[L];)L--;for(;1<=E&&0<=L;E--,L--)if(lt[E]!==Vt[L]){if(E!==1||L!==1)do if(E--,L--,0>L||lt[E]!==Vt[L]){var rn=`
`+lt[E].replace(" at new "," at ");return r.displayName&&rn.includes("<anonymous>")&&(rn=rn.replace("<anonymous>",r.displayName)),rn}while(1<=E&&0<=L);break}}}finally{_i=!1,Error.prepareStackTrace=m}return(m=r?r.displayName||r.name:"")?ui(m):""}function qn(r,o){switch(r.tag){case 26:case 27:case 5:return ui(r.type);case 16:return ui("Lazy");case 13:return r.child!==o&&o!==null?ui("Suspense Fallback"):ui("Suspense");case 19:return ui("SuspenseList");case 0:case 15:return Di(r.type,!1);case 11:return Di(r.type.render,!1);case 1:return Di(r.type,!0);case 31:return ui("Activity");default:return""}}function Gn(r){try{var o="",m=null;do o+=qn(r,m),m=r,r=r.return;while(r);return o}catch(E){return`
Error generating stack: `+E.message+`
`+E.stack}}var In=Object.prototype.hasOwnProperty,vi=c.unstable_scheduleCallback,nn=c.unstable_cancelCallback,Li=c.unstable_shouldYield,Ki=c.unstable_requestPaint,Pi=c.unstable_now,xr=c.unstable_getCurrentPriorityLevel,gt=c.unstable_ImmediatePriority,oe=c.unstable_UserBlockingPriority,ce=c.unstable_NormalPriority,pe=c.unstable_LowPriority,je=c.unstable_IdlePriority,Je=c.log,St=c.unstable_setDisableYieldValue,rt=null,de=null;function Ze(r){if(typeof Je=="function"&&St(r),de&&typeof de.setStrictMode=="function")try{de.setStrictMode(rt,r)}catch{}}var yt=Math.clz32?Math.clz32:jt,Oe=Math.log,At=Math.LN2;function jt(r){return r>>>=0,r===0?32:31-(Oe(r)/At|0)|0}var _n=256,mn=262144,ti=4194304;function ut(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function ai(r,o,m){var E=r.pendingLanes;if(E===0)return 0;var L=0,V=r.suspendedLanes,ne=r.pingedLanes;r=r.warmLanes;var Ae=E&134217727;return Ae!==0?(E=Ae&~V,E!==0?L=ut(E):(ne&=Ae,ne!==0?L=ut(ne):m||(m=Ae&~r,m!==0&&(L=ut(m))))):(Ae=E&~V,Ae!==0?L=ut(Ae):ne!==0?L=ut(ne):m||(m=E&~r,m!==0&&(L=ut(m)))),L===0?0:o!==0&&o!==L&&(o&V)===0&&(V=L&-L,m=o&-o,V>=m||V===32&&(m&4194048)!==0)?o:L}function Qn(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function Kn(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jn(){var r=ti;return ti<<=1,(ti&62914560)===0&&(ti=4194304),r}function lr(r){for(var o=[],m=0;31>m;m++)o.push(r);return o}function Mi(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function ni(r,o,m,E,L,V){var ne=r.pendingLanes;r.pendingLanes=m,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=m,r.entangledLanes&=m,r.errorRecoveryDisabledLanes&=m,r.shellSuspendCounter=0;var Ae=r.entanglements,lt=r.expirationTimes,Vt=r.hiddenUpdates;for(m=ne&~m;0<m;){var rn=31-yt(m),pn=1<<rn;Ae[rn]=0,lt[rn]=-1;var Ht=Vt[rn];if(Ht!==null)for(Vt[rn]=null,rn=0;rn<Ht.length;rn++){var Yt=Ht[rn];Yt!==null&&(Yt.lane&=-536870913)}m&=~pn}E!==0&&zi(r,E,0),V!==0&&L===0&&r.tag!==0&&(r.suspendedLanes|=V&~(ne&~o))}function zi(r,o,m){r.pendingLanes|=o,r.suspendedLanes&=~o;var E=31-yt(o);r.entangledLanes|=o,r.entanglements[E]=r.entanglements[E]|1073741824|m&261930}function Ei(r,o){var m=r.entangledLanes|=o;for(r=r.entanglements;m;){var E=31-yt(m),L=1<<E;L&o|r[E]&o&&(r[E]|=o),m&=~L}}function Bi(r,o){var m=o&-o;return m=(m&42)!==0?1:Cr(m),(m&(r.suspendedLanes|o))!==0?0:m}function Cr(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Jt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function gi(){var r=We.p;return r!==0?r:(r=window.event,r===void 0?32:Dh(r.type))}function An(r,o){var m=We.p;try{return We.p=r,o()}finally{We.p=m}}var ar=Math.random().toString(36).slice(2),Zi="__reactFiber$"+ar,ln="__reactProps$"+ar,Ue="__reactContainer$"+ar,mt="__reactEvents$"+ar,$t="__reactListeners$"+ar,gn="__reactHandles$"+ar,un="__reactResources$"+ar,fn="__reactMarker$"+ar;function Rn(r){delete r[Zi],delete r[ln],delete r[mt],delete r[$t],delete r[gn]}function Hn(r){var o=r[Zi];if(o)return o;for(var m=r.parentNode;m;){if(o=m[Ue]||m[Zi]){if(m=o.alternate,o.child!==null||m!==null&&m.child!==null)for(r=Tf(r);r!==null;){if(m=r[Zi])return m;r=Tf(r)}return o}r=m,m=r.parentNode}return null}function Fn(r){if(r=r[Zi]||r[Ue]){var o=r.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return r}return null}function ki(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(C(33))}function xi(r){var o=r[un];return o||(o=r[un]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function bi(r){r[fn]=!0}var Ct=new Set,Zn={};function En(r,o){Ri(r,o),Ri(r+"Capture",o)}function Ri(r,o){for(Zn[r]=o,r=0;r<o.length;r++)Ct.add(o[r])}var ii=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$n={},jn={};function li(r){return In.call(jn,r)?!0:In.call($n,r)?!1:ii.test(r)?jn[r]=!0:($n[r]=!0,!1)}function us(r,o,m){if(li(o))if(m===null)r.removeAttribute(o);else{switch(typeof m){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var E=o.toLowerCase().slice(0,5);if(E!=="data-"&&E!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+m)}}function Xr(r,o,m){if(m===null)r.removeAttribute(o);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+m)}}function ci(r,o,m,E){if(E===null)r.removeAttribute(m);else{switch(typeof E){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(m);return}r.setAttributeNS(o,m,""+E)}}function Un(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Tr(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ss(r,o,m){var E=Object.getOwnPropertyDescriptor(r.constructor.prototype,o);if(!r.hasOwnProperty(o)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var L=E.get,V=E.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return L.call(this)},set:function(ne){m=""+ne,V.call(this,ne)}}),Object.defineProperty(r,o,{enumerable:E.enumerable}),{getValue:function(){return m},setValue:function(ne){m=""+ne},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function Ji(r){if(!r._valueTracker){var o=Tr(r)?"checked":"value";r._valueTracker=Ss(r,o,""+r[o])}}function Lr(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var m=o.getValue(),E="";return r&&(E=Tr(r)?r.checked?"true":"false":r.value),r=E,r!==m?(o.setValue(r),!0):!1}function hs(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Ho=/[\n"\\]/g;function Fi(r){return r.replace(Ho,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function $r(r,o,m,E,L,V,ne,Ae){r.name="",ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?r.type=ne:r.removeAttribute("type"),o!=null?ne==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+Un(o)):r.value!==""+Un(o)&&(r.value=""+Un(o)):ne!=="submit"&&ne!=="reset"||r.removeAttribute("value"),o!=null?De(r,ne,Un(o)):m!=null?De(r,ne,Un(m)):E!=null&&r.removeAttribute("value"),L==null&&V!=null&&(r.defaultChecked=!!V),L!=null&&(r.checked=L&&typeof L!="function"&&typeof L!="symbol"),Ae!=null&&typeof Ae!="function"&&typeof Ae!="symbol"&&typeof Ae!="boolean"?r.name=""+Un(Ae):r.removeAttribute("name")}function Rt(r,o,m,E,L,V,ne,Ae){if(V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"&&(r.type=V),o!=null||m!=null){if(!(V!=="submit"&&V!=="reset"||o!=null)){Ji(r);return}m=m!=null?""+Un(m):"",o=o!=null?""+Un(o):m,Ae||o===r.value||(r.value=o),r.defaultValue=o}E=E??L,E=typeof E!="function"&&typeof E!="symbol"&&!!E,r.checked=Ae?r.checked:!!E,r.defaultChecked=!!E,ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(r.name=ne),Ji(r)}function De(r,o,m){o==="number"&&hs(r.ownerDocument)===r||r.defaultValue===""+m||(r.defaultValue=""+m)}function oi(r,o,m,E){if(r=r.options,o){o={};for(var L=0;L<m.length;L++)o["$"+m[L]]=!0;for(m=0;m<r.length;m++)L=o.hasOwnProperty("$"+r[m].value),r[m].selected!==L&&(r[m].selected=L),L&&E&&(r[m].defaultSelected=!0)}else{for(m=""+Un(m),o=null,L=0;L<r.length;L++){if(r[L].value===m){r[L].selected=!0,E&&(r[L].defaultSelected=!0);return}o!==null||r[L].disabled||(o=r[L])}o!==null&&(o.selected=!0)}}function ds(r,o,m){if(o!=null&&(o=""+Un(o),o!==r.value&&(r.value=o),m==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=m!=null?""+Un(m):""}function Ns(r,o,m,E){if(o==null){if(E!=null){if(m!=null)throw Error(C(92));if(Ne(E)){if(1<E.length)throw Error(C(93));E=E[0]}m=E}m==null&&(m=""),o=m}m=Un(o),r.defaultValue=m,E=r.textContent,E===m&&E!==""&&E!==null&&(r.value=E),Ji(r)}function Da(r,o){if(o){var m=r.firstChild;if(m&&m===r.lastChild&&m.nodeType===3){m.nodeValue=o;return}}r.textContent=o}var uc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Hr(r,o,m){var E=o.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?E?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":E?r.setProperty(o,m):typeof m!="number"||m===0||uc.has(o)?o==="float"?r.cssFloat=m:r[o]=(""+m).trim():r[o]=m+"px"}function mi(r,o,m){if(o!=null&&typeof o!="object")throw Error(C(62));if(r=r.style,m!=null){for(var E in m)!m.hasOwnProperty(E)||o!=null&&o.hasOwnProperty(E)||(E.indexOf("--")===0?r.setProperty(E,""):E==="float"?r.cssFloat="":r[E]="");for(var L in o)E=o[L],o.hasOwnProperty(L)&&m[L]!==E&&Hr(r,L,E)}else for(var V in o)o.hasOwnProperty(V)&&Hr(r,V,o[V])}function fr(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ao=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),cl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Si(r){return cl.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Xs(){}var Ll=null;function ul(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Xi=null,Br=null;function er(r){var o=Fn(r);if(o&&(r=o.stateNode)){var m=r[ln]||null;e:switch(r=o.stateNode,o.type){case"input":if($r(r,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),o=m.name,m.type==="radio"&&o!=null){for(m=r;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+Fi(""+o)+'"][type="radio"]'),o=0;o<m.length;o++){var E=m[o];if(E!==r&&E.form===r.form){var L=E[ln]||null;if(!L)throw Error(C(90));$r(E,L.value,L.defaultValue,L.defaultValue,L.checked,L.defaultChecked,L.type,L.name)}}for(o=0;o<m.length;o++)E=m[o],E.form===r.form&&Lr(E)}break e;case"textarea":ds(r,m.value,m.defaultValue);break e;case"select":o=m.value,o!=null&&oi(r,!!m.multiple,o,!1)}}}var yn=!1;function _r(r,o,m){if(yn)return r(o,m);yn=!0;try{var E=r(o);return E}finally{if(yn=!1,(Xi!==null||Br!==null)&&(_f(),Xi&&(o=Xi,r=Br,Br=Xi=null,er(o),r)))for(o=0;o<r.length;o++)er(r[o])}}function Ci(r,o){var m=r.stateNode;if(m===null)return null;var E=m[ln]||null;if(E===null)return null;m=E[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(E=!E.disabled)||(r=r.type,E=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!E;break e;default:r=!1}if(r)return null;if(m&&typeof m!="function")throw Error(C(231,o,typeof m));return m}var ji=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ws=!1;if(ji)try{var Qr={};Object.defineProperty(Qr,"passive",{get:function(){Ws=!0}}),window.addEventListener("test",Qr,Qr),window.removeEventListener("test",Qr,Qr)}catch{Ws=!1}var Ys=null,Us=null,Nr=null;function ma(){if(Nr)return Nr;var r,o=Us,m=o.length,E,L="value"in Ys?Ys.value:Ys.textContent,V=L.length;for(r=0;r<m&&o[r]===L[r];r++);var ne=m-r;for(E=1;E<=ne&&o[m-E]===L[V-E];E++);return Nr=L.slice(r,1<E?1-E:void 0)}function ys(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function Ea(){return!0}function Ds(){return!1}function Dr(r){function o(m,E,L,V,ne){this._reactName=m,this._targetInst=L,this.type=E,this.nativeEvent=V,this.target=ne,this.currentTarget=null;for(var Ae in r)r.hasOwnProperty(Ae)&&(m=r[Ae],this[Ae]=m?m(V):V[Ae]);return this.isDefaultPrevented=(V.defaultPrevented!=null?V.defaultPrevented:V.returnValue===!1)?Ea:Ds,this.isPropagationStopped=Ds,this}return Q(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=Ea)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=Ea)},persist:function(){},isPersistent:Ea}),o}var ns={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ir=Dr(ns),Eo=Q({},ns,{view:0,detail:0}),So=Dr(Eo),cr,Ee,qe,Xe=Q({},Eo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ra,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==qe&&(qe&&r.type==="mousemove"?(cr=r.screenX-qe.screenX,Ee=r.screenY-qe.screenY):Ee=cr=0,qe=r),cr)},movementY:function(r){return"movementY"in r?r.movementY:Ee}}),et=Dr(Xe),bt=Q({},Xe,{dataTransfer:0}),Mn=Dr(bt),Xn=Q({},Eo,{relatedTarget:0}),Ui=Dr(Xn),It=Q({},ns,{animationName:0,elapsedTime:0,pseudoElement:0}),hi=Dr(It),Hi=Q({},ns,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),ya=Dr(Hi),hc=Q({},ns,{data:0}),qo=Dr(hc),Rs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wr(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=rr[r])?!!o[r]:!1}function Ra(){return wr}var pr=Q({},Eo,{key:function(r){if(r.key){var o=Rs[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=ys(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Cs[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ra,charCode:function(r){return r.type==="keypress"?ys(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ys(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),br=Dr(pr),Pa=Q({},Xe,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wi=Dr(Pa),wi=Q({},Eo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ra}),ih=Dr(wi),gr=Q({},ns,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ua=Dr(gr),Sa=Q({},Xe,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),dc=Dr(Sa),is=Q({},ns,{newState:0,oldState:0}),Co=Dr(is),Zo=[9,13,27,32],Kr=ji&&"CompositionEvent"in window,Bl=null;ji&&"documentMode"in document&&(Bl=document.documentMode);var Fl=ji&&"TextEvent"in window&&!Bl,fc=ji&&(!Kr||Bl&&8<Bl&&11>=Bl),Oa=" ",_u=!1;function Bc(r,o){switch(r){case"keyup":return Zo.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pc(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var ro=!1;function so(r,o){switch(r){case"compositionend":return pc(o);case"keypress":return o.which!==32?null:(_u=!0,Oa);case"textInput":return r=o.data,r===Oa&&_u?null:r;default:return null}}function Fc(r,o){if(ro)return r==="compositionend"||!Kr&&Bc(r,o)?(r=ma(),Nr=Us=Ys=null,ro=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return fc&&o.locale!=="ko"?null:o.data;default:return null}}var za={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jc(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!za[r.type]:o==="textarea"}function La(r,o,m,E){Xi?Br?Br.push(E):Br=[E]:Xi=E,o=Af(o,"onChange"),0<o.length&&(m=new ir("onChange","change",null,m,E),r.push({event:m,listeners:o}))}var jl=null,hl=null;function Xh(r){bm(r,0)}function gc(r){var o=ki(r);if(Lr(o))return r}function $s(r,o){if(r==="change")return o}var rh=!1;if(ji){var Ul;if(ji){var Va="oninput"in document;if(!Va){var sr=document.createElement("div");sr.setAttribute("oninput","return;"),Va=typeof sr.oninput=="function"}Ul=Va}else Ul=!1;rh=Ul&&(!document.documentMode||9<document.documentMode)}function dl(){jl&&(jl.detachEvent("onpropertychange",le),hl=jl=null)}function le(r){if(r.propertyName==="value"&&gc(hl)){var o=[];La(o,hl,r,ul(r)),_r(Xh,o)}}function a(r,o,m){r==="focusin"?(dl(),jl=o,hl=m,jl.attachEvent("onpropertychange",le)):r==="focusout"&&dl()}function u(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return gc(hl)}function g(r,o){if(r==="click")return gc(o)}function v(r,o){if(r==="input"||r==="change")return gc(o)}function w(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var I=typeof Object.is=="function"?Object.is:w;function O(r,o){if(I(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var m=Object.keys(r),E=Object.keys(o);if(m.length!==E.length)return!1;for(E=0;E<m.length;E++){var L=m[E];if(!In.call(o,L)||!I(r[L],o[L]))return!1}return!0}function F(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function q(r,o){var m=F(r);r=0;for(var E;m;){if(m.nodeType===3){if(E=r+m.textContent.length,r<=o&&E>=o)return{node:m,offset:o-r};r=E}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=F(m)}}function te(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?te(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function ue(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=hs(r.document);o instanceof r.HTMLIFrameElement;){try{var m=typeof o.contentWindow.location.href=="string"}catch{m=!1}if(m)r=o.contentWindow;else break;o=hs(r.document)}return o}function xe(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var ze=ji&&"documentMode"in document&&11>=document.documentMode,ot=null,ht=null,Dt=null,qt=!1;function Sn(r,o,m){var E=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;qt||ot==null||ot!==hs(E)||(E=ot,"selectionStart"in E&&xe(E)?E={start:E.selectionStart,end:E.selectionEnd}:(E=(E.ownerDocument&&E.ownerDocument.defaultView||window).getSelection(),E={anchorNode:E.anchorNode,anchorOffset:E.anchorOffset,focusNode:E.focusNode,focusOffset:E.focusOffset}),Dt&&O(Dt,E)||(Dt=E,E=Af(ht,"onSelect"),0<E.length&&(o=new ir("onSelect","select",null,o,m),r.push({event:o,listeners:E}),o.target=ot)))}function wn(r,o){var m={};return m[r.toLowerCase()]=o.toLowerCase(),m["Webkit"+r]="webkit"+o,m["Moz"+r]="moz"+o,m}var xn={animationend:wn("Animation","AnimationEnd"),animationiteration:wn("Animation","AnimationIteration"),animationstart:wn("Animation","AnimationStart"),transitionrun:wn("Transition","TransitionRun"),transitionstart:wn("Transition","TransitionStart"),transitioncancel:wn("Transition","TransitionCancel"),transitionend:wn("Transition","TransitionEnd")},Yi={},Wn={};ji&&(Wn=document.createElement("div").style,"AnimationEvent"in window||(delete xn.animationend.animation,delete xn.animationiteration.animation,delete xn.animationstart.animation),"TransitionEvent"in window||delete xn.transitionend.transition);function rs(r){if(Yi[r])return Yi[r];if(!xn[r])return r;var o=xn[r],m;for(m in o)if(o.hasOwnProperty(m)&&m in Wn)return Yi[r]=o[m];return r}var xa=rs("animationend"),Vs=rs("animationiteration"),Ar=rs("animationstart"),ss=rs("transitionrun"),Qs=rs("transitionstart"),ao=rs("transitioncancel"),Gs=rs("transitionend"),sh=new Map,bu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bu.push("scrollEnd");function oo(r,o){sh.set(r,o),En(o,[r])}var fl=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Ba=[],Vl=0,Uc=0;function Vc(){for(var r=Vl,o=Uc=Vl=0;o<r;){var m=Ba[o];Ba[o++]=null;var E=Ba[o];Ba[o++]=null;var L=Ba[o];Ba[o++]=null;var V=Ba[o];if(Ba[o++]=null,E!==null&&L!==null){var ne=E.pending;ne===null?L.next=L:(L.next=ne.next,ne.next=L),E.pending=L}V!==0&&qd(m,L,V)}}function ah(r,o,m,E){Ba[Vl++]=r,Ba[Vl++]=o,Ba[Vl++]=m,Ba[Vl++]=E,Uc|=E,r.lanes|=E,r=r.alternate,r!==null&&(r.lanes|=E)}function mc(r,o,m,E){return ah(r,o,m,E),vu(r)}function To(r,o){return ah(r,null,null,o),vu(r)}function qd(r,o,m){r.lanes|=m;var E=r.alternate;E!==null&&(E.lanes|=m);for(var L=!1,V=r.return;V!==null;)V.childLanes|=m,E=V.alternate,E!==null&&(E.childLanes|=m),V.tag===22&&(r=V.stateNode,r===null||r._visibility&1||(L=!0)),r=V,V=V.return;return r.tag===3?(V=r.stateNode,L&&o!==null&&(L=31-yt(m),r=V.hiddenUpdates,E=r[L],E===null?r[L]=[o]:E.push(o),o.lane=m|536870912),V):null}function vu(r){if(50<xf)throw xf=0,U0=null,Error(C(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var Oi={};function Wh(r,o,m,E){this.tag=r,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=E,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lo(r,o,m,E){return new Wh(r,o,m,E)}function Yh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function co(r,o){var m=r.alternate;return m===null?(m=lo(r.tag,o,r.key,r.mode),m.elementType=r.elementType,m.type=r.type,m.stateNode=r.stateNode,m.alternate=r,r.alternate=m):(m.pendingProps=o,m.type=r.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=r.flags&65011712,m.childLanes=r.childLanes,m.lanes=r.lanes,m.child=r.child,m.memoizedProps=r.memoizedProps,m.memoizedState=r.memoizedState,m.updateQueue=r.updateQueue,o=r.dependencies,m.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},m.sibling=r.sibling,m.index=r.index,m.ref=r.ref,m.refCleanup=r.refCleanup,m}function lp(r,o){r.flags&=65011714;var m=r.alternate;return m===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=m.childLanes,r.lanes=m.lanes,r.child=m.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=m.memoizedProps,r.memoizedState=m.memoizedState,r.updateQueue=m.updateQueue,r.type=m.type,o=m.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function $h(r,o,m,E,L,V){var ne=0;if(E=r,typeof r=="function")Yh(r)&&(ne=1);else if(typeof r=="string")ne=t0(r,m,_t.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case He:return r=lo(31,m,o,L),r.elementType=He,r.lanes=V,r;case me:return yc(m.children,L,V,o);case he:ne=8,L|=24;break;case Re:return r=lo(12,m,o,L|2),r.elementType=Re,r.lanes=V,r;case Wt:return r=lo(13,m,o,L),r.elementType=Wt,r.lanes=V,r;case Et:return r=lo(19,m,o,L),r.elementType=Et,r.lanes=V,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Ye:ne=10;break e;case tt:ne=9;break e;case pt:ne=11;break e;case it:ne=14;break e;case at:ne=16,E=null;break e}ne=29,m=Error(C(130,r===null?"null":typeof r,"")),E=null}return o=lo(ne,m,o,L),o.elementType=r,o.type=E,o.lanes=V,o}function yc(r,o,m,E){return r=lo(7,r,E,o),r.lanes=m,r}function Zd(r,o,m){return r=lo(6,r,null,o),r.lanes=m,r}function Qh(r){var o=lo(18,null,null,0);return o.stateNode=r,o}function xc(r,o,m){return o=lo(4,r.children!==null?r.children:[],r.key,o),o.lanes=m,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var wu=new WeakMap;function Fa(r,o){if(typeof r=="object"&&r!==null){var m=wu.get(r);return m!==void 0?m:(o={value:r,source:o,stack:Gn(o)},wu.set(r,o),o)}return{value:r,source:o,stack:Gn(o)}}var _c=[],bc=0,Gc=null,vc=0,Ks=[],na=0,pl=null,gl=1,Ga="";function Gl(r,o){_c[bc++]=vc,_c[bc++]=Gc,Gc=r,vc=o}function Xd(r,o,m){Ks[na++]=gl,Ks[na++]=Ga,Ks[na++]=pl,pl=r;var E=gl;r=Ga;var L=32-yt(E)-1;E&=~(1<<L),m+=1;var V=32-yt(o)+L;if(30<V){var ne=L-L%5;V=(E&(1<<ne)-1).toString(32),E>>=ne,L-=ne,gl=1<<32-yt(o)+L|m<<L|E,Ga=V+r}else gl=1<<V|m<<L|E,Ga=r}function Hc(r){r.return!==null&&(Gl(r,1),Xd(r,1,0))}function Au(r){for(;r===Gc;)Gc=_c[--bc],_c[bc]=null,vc=_c[--bc],_c[bc]=null;for(;r===pl;)pl=Ks[--na],Ks[na]=null,Ga=Ks[--na],Ks[na]=null,gl=Ks[--na],Ks[na]=null}function Wd(r,o){Ks[na++]=gl,Ks[na++]=Ga,Ks[na++]=pl,gl=o.id,Ga=o.overflow,pl=r}var ia=null,Fr=null,tr=!1,Hl=null,uo=!1,fs=Error(C(519));function Ha(r){var o=Error(C(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ql(Fa(o,r)),fs}function qa(r){var o=r.stateNode,m=r.type,E=r.memoizedProps;switch(o[Zi]=r,o[ln]=E,m){case"dialog":dr("cancel",o),dr("close",o);break;case"iframe":case"object":case"embed":dr("load",o);break;case"video":case"audio":for(m=0;m<Bu.length;m++)dr(Bu[m],o);break;case"source":dr("error",o);break;case"img":case"image":case"link":dr("error",o),dr("load",o);break;case"details":dr("toggle",o);break;case"input":dr("invalid",o),Rt(o,E.value,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name,!0);break;case"select":dr("invalid",o);break;case"textarea":dr("invalid",o),Ns(o,E.value,E.defaultValue,E.children)}m=E.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||o.textContent===""+m||E.suppressHydrationWarning===!0||tg(o.textContent,m)?(E.popover!=null&&(dr("beforetoggle",o),dr("toggle",o)),E.onScroll!=null&&dr("scroll",o),E.onScrollEnd!=null&&dr("scrollend",o),E.onClick!=null&&(o.onclick=Xs),o=!0):o=!1,o||Ha(r,!0)}function oh(r){for(ia=r.return;ia;)switch(ia.tag){case 5:case 31:case 13:uo=!1;return;case 27:case 3:uo=!0;return;default:ia=ia.return}}function ml(r){if(r!==ia)return!1;if(!tr)return oh(r),tr=!0,!1;var o=r.tag,m;if((m=o!==3&&o!==27)&&((m=o===5)&&(m=r.type,m=!(m!=="form"&&m!=="button")||Wp(r.type,r.memoizedProps)),m=!m),m&&Fr&&Ha(r),oh(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(317));Fr=ha(r)}else if(o===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(317));Fr=ha(r)}else o===27?(o=Fr,Uu(r.type)?(r=_o,_o=null,Fr=r):Fr=o):Fr=ia?rl(r.stateNode.nextSibling):null;return!0}function yl(){Fr=ia=null,tr=!1}function xl(){var r=Hl;return r!==null&&(Lo===null?Lo=r:Lo.push.apply(Lo,r),Hl=null),r}function ql(r){Hl===null?Hl=[r]:Hl.push(r)}var Zl=ke(null),Io=null,_l=null;function Xl(r,o,m){Nt(Zl,o._currentValue),o._currentValue=m}function bl(r){r._currentValue=Zl.current,nt(Zl)}function Kh(r,o,m){for(;r!==null;){var E=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,E!==null&&(E.childLanes|=o)):E!==null&&(E.childLanes&o)!==o&&(E.childLanes|=o),r===m)break;r=r.return}}function Jh(r,o,m,E){var L=r.child;for(L!==null&&(L.return=r);L!==null;){var V=L.dependencies;if(V!==null){var ne=L.child;V=V.firstContext;e:for(;V!==null;){var Ae=V;V=L;for(var lt=0;lt<o.length;lt++)if(Ae.context===o[lt]){V.lanes|=m,Ae=V.alternate,Ae!==null&&(Ae.lanes|=m),Kh(V.return,m,r),E||(ne=null);break e}V=Ae.next}}else if(L.tag===18){if(ne=L.return,ne===null)throw Error(C(341));ne.lanes|=m,V=ne.alternate,V!==null&&(V.lanes|=m),Kh(ne,m,r),ne=null}else ne=L.child;if(ne!==null)ne.return=L;else for(ne=L;ne!==null;){if(ne===r){ne=null;break}if(L=ne.sibling,L!==null){L.return=ne.return,ne=L;break}ne=ne.return}L=ne}}function ho(r,o,m,E){r=null;for(var L=o,V=!1;L!==null;){if(!V){if((L.flags&524288)!==0)V=!0;else if((L.flags&262144)!==0)break}if(L.tag===10){var ne=L.alternate;if(ne===null)throw Error(C(387));if(ne=ne.memoizedProps,ne!==null){var Ae=L.type;I(L.pendingProps.value,ne.value)||(r!==null?r.push(Ae):r=[Ae])}}else if(L===Kt.current){if(ne=L.alternate,ne===null)throw Error(C(387));ne.memoizedState.memoizedState!==L.memoizedState.memoizedState&&(r!==null?r.push(Md):r=[Md])}L=L.return}r!==null&&Jh(o,r,m,E),o.flags|=262144}function Eu(r){for(r=r.firstContext;r!==null;){if(!I(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Wl(r){Io=r,_l=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Ps(r){return ed(Io,r)}function lh(r,o){return Io===null&&Wl(r),ed(r,o)}function ed(r,o){var m=o._currentValue;if(o={context:o,memoizedValue:m,next:null},_l===null){if(r===null)throw Error(C(308));_l=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else _l=_l.next=o;return m}var Yd=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(m,E){r.push(E)}};this.abort=function(){o.aborted=!0,r.forEach(function(m){return m()})}},cp=c.unstable_scheduleCallback,$d=c.unstable_NormalPriority,Ts={$$typeof:Ye,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vl(){return{controller:new Yd,data:new Map,refCount:0}}function Su(r){r.refCount--,r.refCount===0&&cp($d,function(){r.controller.abort()})}var Ca=null,fo=0,qc=0,Ta=null;function E0(r,o){if(Ca===null){var m=Ca=[];fo=0,qc=$0(),Ta={status:"pending",value:void 0,then:function(E){m.push(E)}}}return fo++,o.then(Cu,Cu),o}function Cu(){if(--fo===0&&Ca!==null){Ta!==null&&(Ta.status="fulfilled");var r=Ca;Ca=null,qc=0,Ta=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function ch(r,o){var m=[],E={status:"pending",value:null,reason:null,then:function(L){m.push(L)}};return r.then(function(){E.status="fulfilled",E.value=o;for(var L=0;L<m.length;L++)(0,m[L])(o)},function(L){for(E.status="rejected",E.reason=L,L=0;L<m.length;L++)(0,m[L])(void 0)}),E}var Js=Te.S;Te.S=function(r,o){im=Pi(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&E0(r,o),Js!==null&&Js(r,o)};var Xo=ke(null);function td(){var r=Xo.current;return r!==null?r:ls.pooledCache}function nd(r,o){o===null?Nt(Xo,Xo.current):Nt(Xo,o.pool)}function up(){var r=td();return r===null?null:{parent:Ts._currentValue,pool:r}}var Wo=Error(C(460)),wc=Error(C(474)),Za=Error(C(542)),On={then:function(){}};function uh(r){return r=r.status,r==="fulfilled"||r==="rejected"}function id(r,o,m){switch(m=r[m],m===void 0?r.push(o):m!==o&&(o.then(Xs,Xs),o=m),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,rd(r),r;default:if(typeof o.status=="string")o.then(Xs,Xs);else{if(r=ls,r!==null&&100<r.shellSuspendCounter)throw Error(C(482));r=o,r.status="pending",r.then(function(E){if(o.status==="pending"){var L=o;L.status="fulfilled",L.value=E}},function(E){if(o.status==="pending"){var L=o;L.status="rejected",L.reason=E}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,rd(r),r}throw Yo=o,Wo}}function Mo(r){try{var o=r._init;return o(r._payload)}catch(m){throw m!==null&&typeof m=="object"&&typeof m.then=="function"?(Yo=m,Wo):m}}var Yo=null;function Tu(){if(Yo===null)throw Error(C(459));var r=Yo;return Yo=null,r}function rd(r){if(r===Wo||r===Za)throw Error(C(483))}var wl=null,Zc=0;function hh(r){var o=Zc;return Zc+=1,wl===null&&(wl=[]),id(wl,r,o)}function Al(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function sd(r,o){throw o.$$typeof===_e?Error(C(525)):(r=Object.prototype.toString.call(o),Error(C(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function dh(r){function o(Tt,ft){if(r){var Ft=Tt.deletions;Ft===null?(Tt.deletions=[ft],Tt.flags|=16):Ft.push(ft)}}function m(Tt,ft){if(!r)return null;for(;ft!==null;)o(Tt,ft),ft=ft.sibling;return null}function E(Tt){for(var ft=new Map;Tt!==null;)Tt.key!==null?ft.set(Tt.key,Tt):ft.set(Tt.index,Tt),Tt=Tt.sibling;return ft}function L(Tt,ft){return Tt=co(Tt,ft),Tt.index=0,Tt.sibling=null,Tt}function V(Tt,ft,Ft){return Tt.index=Ft,r?(Ft=Tt.alternate,Ft!==null?(Ft=Ft.index,Ft<ft?(Tt.flags|=67108866,ft):Ft):(Tt.flags|=67108866,ft)):(Tt.flags|=1048576,ft)}function ne(Tt){return r&&Tt.alternate===null&&(Tt.flags|=67108866),Tt}function Ae(Tt,ft,Ft,hn){return ft===null||ft.tag!==6?(ft=Zd(Ft,Tt.mode,hn),ft.return=Tt,ft):(ft=L(ft,Ft),ft.return=Tt,ft)}function lt(Tt,ft,Ft,hn){var Ti=Ft.type;return Ti===me?rn(Tt,ft,Ft.props.children,hn,Ft.key):ft!==null&&(ft.elementType===Ti||typeof Ti=="object"&&Ti!==null&&Ti.$$typeof===at&&Mo(Ti)===ft.type)?(ft=L(ft,Ft.props),Al(ft,Ft),ft.return=Tt,ft):(ft=$h(Ft.type,Ft.key,Ft.props,null,Tt.mode,hn),Al(ft,Ft),ft.return=Tt,ft)}function Vt(Tt,ft,Ft,hn){return ft===null||ft.tag!==4||ft.stateNode.containerInfo!==Ft.containerInfo||ft.stateNode.implementation!==Ft.implementation?(ft=xc(Ft,Tt.mode,hn),ft.return=Tt,ft):(ft=L(ft,Ft.children||[]),ft.return=Tt,ft)}function rn(Tt,ft,Ft,hn,Ti){return ft===null||ft.tag!==7?(ft=yc(Ft,Tt.mode,hn,Ti),ft.return=Tt,ft):(ft=L(ft,Ft),ft.return=Tt,ft)}function pn(Tt,ft,Ft){if(typeof ft=="string"&&ft!==""||typeof ft=="number"||typeof ft=="bigint")return ft=Zd(""+ft,Tt.mode,Ft),ft.return=Tt,ft;if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case we:return Ft=$h(ft.type,ft.key,ft.props,null,Tt.mode,Ft),Al(Ft,ft),Ft.return=Tt,Ft;case ve:return ft=xc(ft,Tt.mode,Ft),ft.return=Tt,ft;case at:return ft=Mo(ft),pn(Tt,ft,Ft)}if(Ne(ft)||ct(ft))return ft=yc(ft,Tt.mode,Ft,null),ft.return=Tt,ft;if(typeof ft.then=="function")return pn(Tt,hh(ft),Ft);if(ft.$$typeof===Ye)return pn(Tt,lh(Tt,ft),Ft);sd(Tt,ft)}return null}function Ht(Tt,ft,Ft,hn){var Ti=ft!==null?ft.key:null;if(typeof Ft=="string"&&Ft!==""||typeof Ft=="number"||typeof Ft=="bigint")return Ti!==null?null:Ae(Tt,ft,""+Ft,hn);if(typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case we:return Ft.key===Ti?lt(Tt,ft,Ft,hn):null;case ve:return Ft.key===Ti?Vt(Tt,ft,Ft,hn):null;case at:return Ft=Mo(Ft),Ht(Tt,ft,Ft,hn)}if(Ne(Ft)||ct(Ft))return Ti!==null?null:rn(Tt,ft,Ft,hn,null);if(typeof Ft.then=="function")return Ht(Tt,ft,hh(Ft),hn);if(Ft.$$typeof===Ye)return Ht(Tt,ft,lh(Tt,Ft),hn);sd(Tt,Ft)}return null}function Yt(Tt,ft,Ft,hn,Ti){if(typeof hn=="string"&&hn!==""||typeof hn=="number"||typeof hn=="bigint")return Tt=Tt.get(Ft)||null,Ae(ft,Tt,""+hn,Ti);if(typeof hn=="object"&&hn!==null){switch(hn.$$typeof){case we:return Tt=Tt.get(hn.key===null?Ft:hn.key)||null,lt(ft,Tt,hn,Ti);case ve:return Tt=Tt.get(hn.key===null?Ft:hn.key)||null,Vt(ft,Tt,hn,Ti);case at:return hn=Mo(hn),Yt(Tt,ft,Ft,hn,Ti)}if(Ne(hn)||ct(hn))return Tt=Tt.get(Ft)||null,rn(ft,Tt,hn,Ti,null);if(typeof hn.then=="function")return Yt(Tt,ft,Ft,hh(hn),Ti);if(hn.$$typeof===Ye)return Yt(Tt,ft,Ft,lh(ft,hn),Ti);sd(ft,hn)}return null}function di(Tt,ft,Ft,hn){for(var Ti=null,Or=null,fi=ft,Ai=ft=0,or=null;fi!==null&&Ai<Ft.length;Ai++){fi.index>Ai?(or=fi,fi=null):or=fi.sibling;var kr=Ht(Tt,fi,Ft[Ai],hn);if(kr===null){fi===null&&(fi=or);break}r&&fi&&kr.alternate===null&&o(Tt,fi),ft=V(kr,ft,Ai),Or===null?Ti=kr:Or.sibling=kr,Or=kr,fi=or}if(Ai===Ft.length)return m(Tt,fi),tr&&Gl(Tt,Ai),Ti;if(fi===null){for(;Ai<Ft.length;Ai++)fi=pn(Tt,Ft[Ai],hn),fi!==null&&(ft=V(fi,ft,Ai),Or===null?Ti=fi:Or.sibling=fi,Or=fi);return tr&&Gl(Tt,Ai),Ti}for(fi=E(fi);Ai<Ft.length;Ai++)or=Yt(fi,Tt,Ai,Ft[Ai],hn),or!==null&&(r&&or.alternate!==null&&fi.delete(or.key===null?Ai:or.key),ft=V(or,ft,Ai),Or===null?Ti=or:Or.sibling=or,Or=or);return r&&fi.forEach(function(fu){return o(Tt,fu)}),tr&&Gl(Tt,Ai),Ti}function Ii(Tt,ft,Ft,hn){if(Ft==null)throw Error(C(151));for(var Ti=null,Or=null,fi=ft,Ai=ft=0,or=null,kr=Ft.next();fi!==null&&!kr.done;Ai++,kr=Ft.next()){fi.index>Ai?(or=fi,fi=null):or=fi.sibling;var fu=Ht(Tt,fi,kr.value,hn);if(fu===null){fi===null&&(fi=or);break}r&&fi&&fu.alternate===null&&o(Tt,fi),ft=V(fu,ft,Ai),Or===null?Ti=fu:Or.sibling=fu,Or=fu,fi=or}if(kr.done)return m(Tt,fi),tr&&Gl(Tt,Ai),Ti;if(fi===null){for(;!kr.done;Ai++,kr=Ft.next())kr=pn(Tt,kr.value,hn),kr!==null&&(ft=V(kr,ft,Ai),Or===null?Ti=kr:Or.sibling=kr,Or=kr);return tr&&Gl(Tt,Ai),Ti}for(fi=E(fi);!kr.done;Ai++,kr=Ft.next())kr=Yt(fi,Tt,Ai,kr.value,hn),kr!==null&&(r&&kr.alternate!==null&&fi.delete(kr.key===null?Ai:kr.key),ft=V(kr,ft,Ai),Or===null?Ti=kr:Or.sibling=kr,Or=kr);return r&&fi.forEach(function(Ag){return o(Tt,Ag)}),tr&&Gl(Tt,Ai),Ti}function Yr(Tt,ft,Ft,hn){if(typeof Ft=="object"&&Ft!==null&&Ft.type===me&&Ft.key===null&&(Ft=Ft.props.children),typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case we:e:{for(var Ti=Ft.key;ft!==null;){if(ft.key===Ti){if(Ti=Ft.type,Ti===me){if(ft.tag===7){m(Tt,ft.sibling),hn=L(ft,Ft.props.children),hn.return=Tt,Tt=hn;break e}}else if(ft.elementType===Ti||typeof Ti=="object"&&Ti!==null&&Ti.$$typeof===at&&Mo(Ti)===ft.type){m(Tt,ft.sibling),hn=L(ft,Ft.props),Al(hn,Ft),hn.return=Tt,Tt=hn;break e}m(Tt,ft);break}else o(Tt,ft);ft=ft.sibling}Ft.type===me?(hn=yc(Ft.props.children,Tt.mode,hn,Ft.key),hn.return=Tt,Tt=hn):(hn=$h(Ft.type,Ft.key,Ft.props,null,Tt.mode,hn),Al(hn,Ft),hn.return=Tt,Tt=hn)}return ne(Tt);case ve:e:{for(Ti=Ft.key;ft!==null;){if(ft.key===Ti)if(ft.tag===4&&ft.stateNode.containerInfo===Ft.containerInfo&&ft.stateNode.implementation===Ft.implementation){m(Tt,ft.sibling),hn=L(ft,Ft.children||[]),hn.return=Tt,Tt=hn;break e}else{m(Tt,ft);break}else o(Tt,ft);ft=ft.sibling}hn=xc(Ft,Tt.mode,hn),hn.return=Tt,Tt=hn}return ne(Tt);case at:return Ft=Mo(Ft),Yr(Tt,ft,Ft,hn)}if(Ne(Ft))return di(Tt,ft,Ft,hn);if(ct(Ft)){if(Ti=ct(Ft),typeof Ti!="function")throw Error(C(150));return Ft=Ti.call(Ft),Ii(Tt,ft,Ft,hn)}if(typeof Ft.then=="function")return Yr(Tt,ft,hh(Ft),hn);if(Ft.$$typeof===Ye)return Yr(Tt,ft,lh(Tt,Ft),hn);sd(Tt,Ft)}return typeof Ft=="string"&&Ft!==""||typeof Ft=="number"||typeof Ft=="bigint"?(Ft=""+Ft,ft!==null&&ft.tag===6?(m(Tt,ft.sibling),hn=L(ft,Ft),hn.return=Tt,Tt=hn):(m(Tt,ft),hn=Zd(Ft,Tt.mode,hn),hn.return=Tt,Tt=hn),ne(Tt)):m(Tt,ft)}return function(Tt,ft,Ft,hn){try{Zc=0;var Ti=Yr(Tt,ft,Ft,hn);return wl=null,Ti}catch(fi){if(fi===Wo||fi===Za)throw fi;var Or=lo(29,fi,null,Tt.mode);return Or.lanes=hn,Or.return=Tt,Or}}}var El=dh(!0),Qd=dh(!1),Sl=!1;function ad(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fh(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Cl(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Yl(r,o,m){var E=r.updateQueue;if(E===null)return null;if(E=E.shared,(Vr&2)!==0){var L=E.pending;return L===null?o.next=o:(o.next=L.next,L.next=o),E.pending=o,o=vu(r),qd(r,null,m),o}return ah(r,E,o,m),vu(r)}function ko(r,o,m){if(o=o.updateQueue,o!==null&&(o=o.shared,(m&4194048)!==0)){var E=o.lanes;E&=r.pendingLanes,m|=E,o.lanes=m,Ei(r,m)}}function Ir(r,o){var m=r.updateQueue,E=r.alternate;if(E!==null&&(E=E.updateQueue,m===E)){var L=null,V=null;if(m=m.firstBaseUpdate,m!==null){do{var ne={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};V===null?L=V=ne:V=V.next=ne,m=m.next}while(m!==null);V===null?L=V=o:V=V.next=o}else L=V=o;m={baseState:E.baseState,firstBaseUpdate:L,lastBaseUpdate:V,shared:E.shared,callbacks:E.callbacks},r.updateQueue=m;return}r=m.lastBaseUpdate,r===null?m.firstBaseUpdate=o:r.next=o,m.lastBaseUpdate=o}var Kd=!1;function $l(){if(Kd){var r=Ta;if(r!==null)throw r}}function Ac(r,o,m,E){Kd=!1;var L=r.updateQueue;Sl=!1;var V=L.firstBaseUpdate,ne=L.lastBaseUpdate,Ae=L.shared.pending;if(Ae!==null){L.shared.pending=null;var lt=Ae,Vt=lt.next;lt.next=null,ne===null?V=Vt:ne.next=Vt,ne=lt;var rn=r.alternate;rn!==null&&(rn=rn.updateQueue,Ae=rn.lastBaseUpdate,Ae!==ne&&(Ae===null?rn.firstBaseUpdate=Vt:Ae.next=Vt,rn.lastBaseUpdate=lt))}if(V!==null){var pn=L.baseState;ne=0,rn=Vt=lt=null,Ae=V;do{var Ht=Ae.lane&-536870913,Yt=Ht!==Ae.lane;if(Yt?(hr&Ht)===Ht:(E&Ht)===Ht){Ht!==0&&Ht===qc&&(Kd=!0),rn!==null&&(rn=rn.next={lane:0,tag:Ae.tag,payload:Ae.payload,callback:null,next:null});e:{var di=r,Ii=Ae;Ht=o;var Yr=m;switch(Ii.tag){case 1:if(di=Ii.payload,typeof di=="function"){pn=di.call(Yr,pn,Ht);break e}pn=di;break e;case 3:di.flags=di.flags&-65537|128;case 0:if(di=Ii.payload,Ht=typeof di=="function"?di.call(Yr,pn,Ht):di,Ht==null)break e;pn=Q({},pn,Ht);break e;case 2:Sl=!0}}Ht=Ae.callback,Ht!==null&&(r.flags|=64,Yt&&(r.flags|=8192),Yt=L.callbacks,Yt===null?L.callbacks=[Ht]:Yt.push(Ht))}else Yt={lane:Ht,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},rn===null?(Vt=rn=Yt,lt=pn):rn=rn.next=Yt,ne|=Ht;if(Ae=Ae.next,Ae===null){if(Ae=L.shared.pending,Ae===null)break;Yt=Ae,Ae=Yt.next,Yt.next=null,L.lastBaseUpdate=Yt,L.shared.pending=null}}while(!0);rn===null&&(lt=pn),L.baseState=lt,L.firstBaseUpdate=Vt,L.lastBaseUpdate=rn,V===null&&(L.shared.lanes=0),au|=ne,r.lanes=ne,r.memoizedState=pn}}function ph(r,o){if(typeof r!="function")throw Error(C(191,r));r.call(o)}function od(r,o){var m=r.callbacks;if(m!==null)for(r.callbacks=null,r=0;r<m.length;r++)ph(m[r],o)}var Xc=ke(null),gh=ke(0);function Jd(r,o){r=su,Nt(gh,r),Nt(Xc,o),su=r|o.baseLanes}function po(){Nt(gh,su),Nt(Xc,Xc.current)}function Wc(){su=gh.current,nt(Xc),nt(gh)}var Bn=ke(null),ri=null;function No(r){var o=r.alternate;Nt(xs,xs.current&1),Nt(Bn,r),ri===null&&(o===null||Xc.current!==null||o.memoizedState!==null)&&(ri=r)}function Iu(r){Nt(xs,xs.current),Nt(Bn,r),ri===null&&(ri=r)}function mh(r){r.tag===22?(Nt(xs,xs.current),Nt(Bn,r),ri===null&&(ri=r)):Is()}function Is(){Nt(xs,xs.current),Nt(Bn,Bn.current)}function ps(r){nt(Bn),ri===r&&(ri=null),nt(xs)}var xs=ke(0);function yh(r){for(var o=r;o!==null;){if(o.tag===13){var m=o.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||$a(m)||qs(m)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Ql=0,Gi=null,Er=null,Vi=null,as=!1,Do=!1,$o=!1,Yc=0,$c=0,Kl=null,ef=0;function Jr(){throw Error(C(321))}function Qo(r,o){if(o===null)return!1;for(var m=0;m<o.length&&m<r.length;m++)if(!I(r[m],o[m]))return!1;return!0}function Mu(r,o,m,E,L,V){return Ql=V,Gi=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Te.H=r===null||r.memoizedState===null?Ur:Os,$o=!1,V=m(E,L),$o=!1,Do&&(V=xh(o,m,E,L)),ku(r),V}function ku(r){Te.H=Mr;var o=Er!==null&&Er.next!==null;if(Ql=0,Vi=Er=Gi=null,as=!1,$c=0,Kl=null,o)throw Error(C(300));r===null||aa||(r=r.dependencies,r!==null&&Eu(r)&&(aa=!0))}function xh(r,o,m,E){Gi=r;var L=0;do{if(Do&&(Kl=null),$c=0,Do=!1,25<=L)throw Error(C(301));if(L+=1,Vi=Er=null,r.updateQueue!=null){var V=r.updateQueue;V.lastEffect=null,V.events=null,V.stores=null,V.memoCache!=null&&(V.memoCache.index=0)}Te.H=Hs,V=o(m,E)}while(Do);return V}function _h(){var r=Te.H,o=r.useState()[0];return o=typeof o.then=="function"?Qc(o):o,r=r.useState()[0],(Er!==null?Er.memoizedState:null)!==r&&(Gi.flags|=1024),o}function bh(){var r=Yc!==0;return Yc=0,r}function Ec(r,o,m){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~m}function Jl(r){if(as){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}as=!1}Ql=0,Vi=Er=Gi=null,Do=!1,$c=Yc=0,Kl=null}function _a(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vi===null?Gi.memoizedState=Vi=r:Vi=Vi.next=r,Vi}function os(){if(Er===null){var r=Gi.alternate;r=r!==null?r.memoizedState:null}else r=Er.next;var o=Vi===null?Gi.memoizedState:Vi.next;if(o!==null)Vi=o,Er=r;else{if(r===null)throw Gi.alternate===null?Error(C(467)):Error(C(310));Er=r,r={memoizedState:Er.memoizedState,baseState:Er.baseState,baseQueue:Er.baseQueue,queue:Er.queue,next:null},Vi===null?Gi.memoizedState=Vi=r:Vi=Vi.next=r}return Vi}function Tl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qc(r){var o=$c;return $c+=1,Kl===null&&(Kl=[]),r=id(Kl,r,o),o=Gi,(Vi===null?o.memoizedState:Vi.next)===null&&(o=o.alternate,Te.H=o===null||o.memoizedState===null?Ur:Os),r}function Kc(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Qc(r);if(r.$$typeof===Ye)return Ps(r)}throw Error(C(438,String(r)))}function Nu(r){var o=null,m=Gi.updateQueue;if(m!==null&&(o=m.memoCache),o==null){var E=Gi.alternate;E!==null&&(E=E.updateQueue,E!==null&&(E=E.memoCache,E!=null&&(o={data:E.data.map(function(L){return L.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),m===null&&(m=Tl(),Gi.updateQueue=m),m.memoCache=o,m=o.data[o.index],m===void 0)for(m=o.data[o.index]=Array(r),E=0;E<r;E++)m[E]=xt;return o.index++,m}function Ko(r,o){return typeof o=="function"?o(r):o}function A(r){var o=os();return t(o,Er,r)}function t(r,o,m){var E=r.queue;if(E===null)throw Error(C(311));E.lastRenderedReducer=m;var L=r.baseQueue,V=E.pending;if(V!==null){if(L!==null){var ne=L.next;L.next=V.next,V.next=ne}o.baseQueue=L=V,E.pending=null}if(V=r.baseState,L===null)r.memoizedState=V;else{o=L.next;var Ae=ne=null,lt=null,Vt=o,rn=!1;do{var pn=Vt.lane&-536870913;if(pn!==Vt.lane?(hr&pn)===pn:(Ql&pn)===pn){var Ht=Vt.revertLane;if(Ht===0)lt!==null&&(lt=lt.next={lane:0,revertLane:0,gesture:null,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null}),pn===qc&&(rn=!0);else if((Ql&Ht)===Ht){Vt=Vt.next,Ht===qc&&(rn=!0);continue}else pn={lane:0,revertLane:Vt.revertLane,gesture:null,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},lt===null?(Ae=lt=pn,ne=V):lt=lt.next=pn,Gi.lanes|=Ht,au|=Ht;pn=Vt.action,$o&&m(V,pn),V=Vt.hasEagerState?Vt.eagerState:m(V,pn)}else Ht={lane:pn,revertLane:Vt.revertLane,gesture:Vt.gesture,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},lt===null?(Ae=lt=Ht,ne=V):lt=lt.next=Ht,Gi.lanes|=pn,au|=pn;Vt=Vt.next}while(Vt!==null&&Vt!==o);if(lt===null?ne=V:lt.next=Ae,!I(V,r.memoizedState)&&(aa=!0,rn&&(m=Ta,m!==null)))throw m;r.memoizedState=V,r.baseState=ne,r.baseQueue=lt,E.lastRenderedState=V}return L===null&&(E.lanes=0),[r.memoizedState,E.dispatch]}function s(r){var o=os(),m=o.queue;if(m===null)throw Error(C(311));m.lastRenderedReducer=r;var E=m.dispatch,L=m.pending,V=o.memoizedState;if(L!==null){m.pending=null;var ne=L=L.next;do V=r(V,ne.action),ne=ne.next;while(ne!==L);I(V,o.memoizedState)||(aa=!0),o.memoizedState=V,o.baseQueue===null&&(o.baseState=V),m.lastRenderedState=V}return[V,E]}function f(r,o,m){var E=Gi,L=os(),V=tr;if(V){if(m===void 0)throw Error(C(407));m=m()}else m=o();var ne=!I((Er||L).memoizedState,m);if(ne&&(L.memoizedState=m,aa=!0),L=L.queue,Ot(k.bind(null,E,L,r),[r]),L.getSnapshot!==o||ne||Vi!==null&&Vi.memoizedState.tag&1){if(E.flags|=2048,Ve(9,{destroy:void 0},S.bind(null,E,L,m,o),null),ls===null)throw Error(C(349));V||(Ql&127)!==0||x(E,o,m)}return m}function x(r,o,m){r.flags|=16384,r={getSnapshot:o,value:m},o=Gi.updateQueue,o===null?(o=Tl(),Gi.updateQueue=o,o.stores=[r]):(m=o.stores,m===null?o.stores=[r]:m.push(r))}function S(r,o,m,E){o.value=m,o.getSnapshot=E,z(o)&&j(r)}function k(r,o,m){return m(function(){z(o)&&j(r)})}function z(r){var o=r.getSnapshot;r=r.value;try{var m=o();return!I(r,m)}catch{return!0}}function j(r){var o=To(r,2);o!==null&&Fo(o,r,2)}function Z(r){var o=_a();if(typeof r=="function"){var m=r;if(r=m(),$o){Ze(!0);try{m()}finally{Ze(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ko,lastRenderedState:r},o}function W(r,o,m,E){return r.baseState=m,t(r,Er,typeof E=="function"?E:Ko)}function ee(r,o,m,E,L){if(go(r))throw Error(C(485));if(r=o.action,r!==null){var V={payload:L,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ne){V.listeners.push(ne)}};Te.T!==null?m(!0):V.isTransition=!1,E(V),m=o.pending,m===null?(V.next=o.pending=V,J(o,V)):(V.next=m.next,o.pending=m.next=V)}}function J(r,o){var m=o.action,E=o.payload,L=r.state;if(o.isTransition){var V=Te.T,ne={};Te.T=ne;try{var Ae=m(L,E),lt=Te.S;lt!==null&&lt(ne,Ae),se(r,o,Ae)}catch(Vt){Ce(r,o,Vt)}finally{V!==null&&ne.types!==null&&(V.types=ne.types),Te.T=V}}else try{V=m(L,E),se(r,o,V)}catch(Vt){Ce(r,o,Vt)}}function se(r,o,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(E){fe(r,o,E)},function(E){return Ce(r,o,E)}):fe(r,o,m)}function fe(r,o,m){o.status="fulfilled",o.value=m,Me(o),r.state=m,o=r.pending,o!==null&&(m=o.next,m===o?r.pending=null:(m=m.next,o.next=m,J(r,m)))}function Ce(r,o,m){var E=r.pending;if(r.pending=null,E!==null){E=E.next;do o.status="rejected",o.reason=m,Me(o),o=o.next;while(o!==E)}r.action=null}function Me(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function Ie(r,o){return o}function Be(r,o){if(tr){var m=ls.formState;if(m!==null){e:{var E=Gi;if(tr){if(Fr){t:{for(var L=Fr,V=uo;L.nodeType!==8;){if(!V){L=null;break t}if(L=rl(L.nextSibling),L===null){L=null;break t}}V=L.data,L=V==="F!"||V==="F"?L:null}if(L){Fr=rl(L.nextSibling),E=L.data==="F!";break e}}Ha(E)}E=!1}E&&(o=m[0])}}return m=_a(),m.memoizedState=m.baseState=o,E={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ie,lastRenderedState:o},m.queue=E,m=Du.bind(null,Gi,E),E.dispatch=m,E=Z(!1),V=Wa.bind(null,Gi,!1,E.queue),E=_a(),L={state:o,dispatch:null,action:r,pending:null},E.queue=L,m=ee.bind(null,Gi,L,V,m),L.dispatch=m,E.memoizedState=r,[o,m,!1]}function Qe(r){var o=os();return Le(o,Er,r)}function Le(r,o,m){if(o=t(r,o,Ie)[0],r=A(Ko)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var E=Qc(o)}catch(ne){throw ne===Wo?Za:ne}else E=o;o=os();var L=o.queue,V=L.dispatch;return m!==o.memoizedState&&(Gi.flags|=2048,Ve(9,{destroy:void 0},$e.bind(null,L,m),null)),[E,V,r]}function $e(r,o){r.action=o}function st(r){var o=os(),m=Er;if(m!==null)return Le(o,m,r);os(),o=o.memoizedState,m=os();var E=m.queue.dispatch;return m.memoizedState=r,[o,E,!1]}function Ve(r,o,m,E){return r={tag:r,create:m,deps:E,inst:o,next:null},o=Gi.updateQueue,o===null&&(o=Tl(),Gi.updateQueue=o),m=o.lastEffect,m===null?o.lastEffect=r.next=r:(E=m.next,m.next=r,r.next=E,o.lastEffect=r),r}function dt(){return os().memoizedState}function Lt(r,o,m,E){var L=_a();Gi.flags|=r,L.memoizedState=Ve(1|o,{destroy:void 0},m,E===void 0?null:E)}function Mt(r,o,m,E){var L=os();E=E===void 0?null:E;var V=L.memoizedState.inst;Er!==null&&E!==null&&Qo(E,Er.memoizedState.deps)?L.memoizedState=Ve(o,V,m,E):(Gi.flags|=r,L.memoizedState=Ve(1|o,V,m,E))}function Pt(r,o){Lt(8390656,8,r,o)}function Ot(r,o){Mt(2048,8,r,o)}function bn(r){Gi.flags|=4;var o=Gi.updateQueue;if(o===null)o=Tl(),Gi.updateQueue=o,o.events=[r];else{var m=o.events;m===null?o.events=[r]:m.push(r)}}function vn(r){var o=os().memoizedState;return bn({ref:o,nextImpl:r}),function(){if((Vr&2)!==0)throw Error(C(440));return o.impl.apply(void 0,arguments)}}function on(r,o){return Mt(4,2,r,o)}function Cn(r,o){return Mt(4,4,r,o)}function Ni(r,o){if(typeof o=="function"){r=r();var m=o(r);return function(){typeof m=="function"?m():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function Sr(r,o,m){m=m!=null?m.concat([r]):null,Mt(4,4,Ni.bind(null,o,r),m)}function qr(){}function jr(r,o){var m=os();o=o===void 0?null:o;var E=m.memoizedState;return o!==null&&Qo(o,E[1])?E[0]:(m.memoizedState=[r,o],r)}function es(r,o){var m=os();o=o===void 0?null:o;var E=m.memoizedState;if(o!==null&&Qo(o,E[1]))return E[0];if(E=r(),$o){Ze(!0);try{r()}finally{Ze(!1)}}return m.memoizedState=[E,o],E}function Rr(r,o,m){return m===void 0||(Ql&1073741824)!==0&&(hr&261930)===0?r.memoizedState=o:(r.memoizedState=m,r=sm(),Gi.lanes|=r,au|=r,m)}function gs(r,o,m,E){return I(m,o)?m:Xc.current!==null?(r=Rr(r,m,E),I(r,o)||(aa=!0),r):(Ql&42)===0||(Ql&1073741824)!==0&&(hr&261930)===0?(aa=!0,r.memoizedState=m):(r=sm(),Gi.lanes|=r,au|=r,o)}function ts(r,o,m,E,L){var V=We.p;We.p=V!==0&&8>V?V:8;var ne=Te.T,Ae={};Te.T=Ae,Wa(r,!1,o,m);try{var lt=L(),Vt=Te.S;if(Vt!==null&&Vt(Ae,lt),lt!==null&&typeof lt=="object"&&typeof lt.then=="function"){var rn=ch(lt,E);el(r,o,rn,Bo(r))}else el(r,o,E,Bo(r))}catch(pn){el(r,o,{then:function(){},status:"rejected",reason:pn},Bo())}finally{We.p=V,ne!==null&&Ae.types!==null&&(ne.types=Ae.types),Te.T=ne}}function ra(){}function _s(r,o,m,E){if(r.tag!==5)throw Error(C(476));var L=bs(r).queue;ts(r,L,o,wt,m===null?ra:function(){return sa(r),m(E)})}function bs(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:wt,baseState:wt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ko,lastRenderedState:wt},next:null};var m={};return o.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ko,lastRenderedState:m},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function sa(r){var o=bs(r);o.next===null&&(o=r.alternate.memoizedState),el(r,o.next.queue,{},Bo())}function Il(){return Ps(Md)}function Ml(){return os().memoizedState}function Jo(){return os().memoizedState}function Xa(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var m=Bo();r=Cl(m);var E=Yl(o,r,m);E!==null&&(Fo(E,o,m),ko(E,o,m)),o={cache:vl()},r.payload=o;return}o=o.return}}function Jc(r,o,m){var E=Bo();m={lane:E,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},go(r)?Ro(o,m):(m=mc(r,o,m,E),m!==null&&(Fo(m,r,E),Po(m,o,E)))}function Du(r,o,m){var E=Bo();el(r,o,m,E)}function el(r,o,m,E){var L={lane:E,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null};if(go(r))Ro(o,L);else{var V=r.alternate;if(r.lanes===0&&(V===null||V.lanes===0)&&(V=o.lastRenderedReducer,V!==null))try{var ne=o.lastRenderedState,Ae=V(ne,m);if(L.hasEagerState=!0,L.eagerState=Ae,I(Ae,ne))return ah(r,o,L,0),ls===null&&Vc(),!1}catch{}if(m=mc(r,o,L,E),m!==null)return Fo(m,r,E),Po(m,o,E),!0}return!1}function Wa(r,o,m,E){if(E={lane:2,revertLane:$0(),gesture:null,action:E,hasEagerState:!1,eagerState:null,next:null},go(r)){if(o)throw Error(C(479))}else o=mc(r,m,E,2),o!==null&&Fo(o,r,2)}function go(r){var o=r.alternate;return r===Gi||o!==null&&o===Gi}function Ro(r,o){Do=as=!0;var m=r.pending;m===null?o.next=o:(o.next=m.next,m.next=o),r.pending=o}function Po(r,o,m){if((m&4194048)!==0){var E=o.lanes;E&=r.pendingLanes,m|=E,o.lanes=m,Ei(r,m)}}var Mr={readContext:Ps,use:Kc,useCallback:Jr,useContext:Jr,useEffect:Jr,useImperativeHandle:Jr,useLayoutEffect:Jr,useInsertionEffect:Jr,useMemo:Jr,useReducer:Jr,useRef:Jr,useState:Jr,useDebugValue:Jr,useDeferredValue:Jr,useTransition:Jr,useSyncExternalStore:Jr,useId:Jr,useHostTransitionStatus:Jr,useFormState:Jr,useActionState:Jr,useOptimistic:Jr,useMemoCache:Jr,useCacheRefresh:Jr};Mr.useEffectEvent=Jr;var Ur={readContext:Ps,use:Kc,useCallback:function(r,o){return _a().memoizedState=[r,o===void 0?null:o],r},useContext:Ps,useEffect:Pt,useImperativeHandle:function(r,o,m){m=m!=null?m.concat([r]):null,Lt(4194308,4,Ni.bind(null,o,r),m)},useLayoutEffect:function(r,o){return Lt(4194308,4,r,o)},useInsertionEffect:function(r,o){Lt(4,2,r,o)},useMemo:function(r,o){var m=_a();o=o===void 0?null:o;var E=r();if($o){Ze(!0);try{r()}finally{Ze(!1)}}return m.memoizedState=[E,o],E},useReducer:function(r,o,m){var E=_a();if(m!==void 0){var L=m(o);if($o){Ze(!0);try{m(o)}finally{Ze(!1)}}}else L=o;return E.memoizedState=E.baseState=L,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:L},E.queue=r,r=r.dispatch=Jc.bind(null,Gi,r),[E.memoizedState,r]},useRef:function(r){var o=_a();return r={current:r},o.memoizedState=r},useState:function(r){r=Z(r);var o=r.queue,m=Du.bind(null,Gi,o);return o.dispatch=m,[r.memoizedState,m]},useDebugValue:qr,useDeferredValue:function(r,o){var m=_a();return Rr(m,r,o)},useTransition:function(){var r=Z(!1);return r=ts.bind(null,Gi,r.queue,!0,!1),_a().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,m){var E=Gi,L=_a();if(tr){if(m===void 0)throw Error(C(407));m=m()}else{if(m=o(),ls===null)throw Error(C(349));(hr&127)!==0||x(E,o,m)}L.memoizedState=m;var V={value:m,getSnapshot:o};return L.queue=V,Pt(k.bind(null,E,V,r),[r]),E.flags|=2048,Ve(9,{destroy:void 0},S.bind(null,E,V,m,o),null),m},useId:function(){var r=_a(),o=ls.identifierPrefix;if(tr){var m=Ga,E=gl;m=(E&~(1<<32-yt(E)-1)).toString(32)+m,o="_"+o+"R_"+m,m=Yc++,0<m&&(o+="H"+m.toString(32)),o+="_"}else m=ef++,o="_"+o+"r_"+m.toString(32)+"_";return r.memoizedState=o},useHostTransitionStatus:Il,useFormState:Be,useActionState:Be,useOptimistic:function(r){var o=_a();o.memoizedState=o.baseState=r;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=m,o=Wa.bind(null,Gi,!0,m),m.dispatch=o,[r,o]},useMemoCache:Nu,useCacheRefresh:function(){return _a().memoizedState=Xa.bind(null,Gi)},useEffectEvent:function(r){var o=_a(),m={impl:r};return o.memoizedState=m,function(){if((Vr&2)!==0)throw Error(C(440));return m.impl.apply(void 0,arguments)}}},Os={readContext:Ps,use:Kc,useCallback:jr,useContext:Ps,useEffect:Ot,useImperativeHandle:Sr,useInsertionEffect:on,useLayoutEffect:Cn,useMemo:es,useReducer:A,useRef:dt,useState:function(){return A(Ko)},useDebugValue:qr,useDeferredValue:function(r,o){var m=os();return gs(m,Er.memoizedState,r,o)},useTransition:function(){var r=A(Ko)[0],o=os().memoizedState;return[typeof r=="boolean"?r:Qc(r),o]},useSyncExternalStore:f,useId:Ml,useHostTransitionStatus:Il,useFormState:Qe,useActionState:Qe,useOptimistic:function(r,o){var m=os();return W(m,Er,r,o)},useMemoCache:Nu,useCacheRefresh:Jo};Os.useEffectEvent=vn;var Hs={readContext:Ps,use:Kc,useCallback:jr,useContext:Ps,useEffect:Ot,useImperativeHandle:Sr,useInsertionEffect:on,useLayoutEffect:Cn,useMemo:es,useReducer:s,useRef:dt,useState:function(){return s(Ko)},useDebugValue:qr,useDeferredValue:function(r,o){var m=os();return Er===null?Rr(m,r,o):gs(m,Er.memoizedState,r,o)},useTransition:function(){var r=s(Ko)[0],o=os().memoizedState;return[typeof r=="boolean"?r:Qc(r),o]},useSyncExternalStore:f,useId:Ml,useHostTransitionStatus:Il,useFormState:st,useActionState:st,useOptimistic:function(r,o){var m=os();return Er!==null?W(m,Er,r,o):(m.baseState=r,[r,m.queue.dispatch])},useMemoCache:Nu,useCacheRefresh:Jo};Hs.useEffectEvent=vn;function ld(r,o,m,E){o=r.memoizedState,m=m(E,o),m=m==null?o:Q({},o,m),r.memoizedState=m,r.lanes===0&&(r.updateQueue.baseState=m)}var cd={enqueueSetState:function(r,o,m){r=r._reactInternals;var E=Bo(),L=Cl(E);L.payload=o,m!=null&&(L.callback=m),o=Yl(r,L,E),o!==null&&(Fo(o,r,E),ko(o,r,E))},enqueueReplaceState:function(r,o,m){r=r._reactInternals;var E=Bo(),L=Cl(E);L.tag=1,L.payload=o,m!=null&&(L.callback=m),o=Yl(r,L,E),o!==null&&(Fo(o,r,E),ko(o,r,E))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var m=Bo(),E=Cl(m);E.tag=2,o!=null&&(E.callback=o),o=Yl(r,E,m),o!==null&&(Fo(o,r,m),ko(o,r,m))}};function Sc(r,o,m,E,L,V,ne){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(E,V,ne):o.prototype&&o.prototype.isPureReactComponent?!O(m,E)||!O(L,V):!0}function hp(r,o,m,E){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(m,E),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(m,E),o.state!==r&&cd.enqueueReplaceState(o,o.state,null)}function Cc(r,o){var m=o;if("ref"in o){m={};for(var E in o)E!=="ref"&&(m[E]=o[E])}if(r=r.defaultProps){m===o&&(m=Q({},m));for(var L in r)m[L]===void 0&&(m[L]=r[L])}return m}function ud(r){fl(r)}function ec(r){console.error(r)}function tc(r){fl(r)}function tl(r,o){try{var m=r.onUncaughtError;m(o.value,{componentStack:o.stack})}catch(E){setTimeout(function(){throw E})}}function hd(r,o,m){try{var E=r.onCaughtError;E(m.value,{componentStack:m.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(L){setTimeout(function(){throw L})}}function vh(r,o,m){return m=Cl(m),m.tag=3,m.payload={element:null},m.callback=function(){tl(r,o)},m}function wh(r){return r=Cl(r),r.tag=3,r}function Ah(r,o,m,E){var L=m.type.getDerivedStateFromError;if(typeof L=="function"){var V=E.value;r.payload=function(){return L(V)},r.callback=function(){hd(o,m,E)}}var ne=m.stateNode;ne!==null&&typeof ne.componentDidCatch=="function"&&(r.callback=function(){hd(o,m,E),typeof L!="function"&&(ou===null?ou=new Set([this]):ou.add(this));var Ae=E.stack;this.componentDidCatch(E.value,{componentStack:Ae!==null?Ae:""})})}function dp(r,o,m,E,L){if(m.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){if(o=m.alternate,o!==null&&ho(o,m,L,!0),m=Bn.current,m!==null){switch(m.tag){case 31:case 13:return ri===null?bf():m.alternate===null&&zs===0&&(zs=3),m.flags&=-257,m.flags|=65536,m.lanes=L,E===On?m.flags|=16384:(o=m.updateQueue,o===null?m.updateQueue=new Set([E]):o.add(E),Lp(r,E,L)),!1;case 22:return m.flags|=65536,E===On?m.flags|=16384:(o=m.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([E])},m.updateQueue=o):(m=o.retryQueue,m===null?o.retryQueue=new Set([E]):m.add(E)),Lp(r,E,L)),!1}throw Error(C(435,m.tag))}return Lp(r,E,L),bf(),!1}if(tr)return o=Bn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=L,E!==fs&&(r=Error(C(422),{cause:E}),ql(Fa(r,m)))):(E!==fs&&(o=Error(C(423),{cause:E}),ql(Fa(o,m))),r=r.current.alternate,r.flags|=65536,L&=-L,r.lanes|=L,E=Fa(E,m),L=vh(r.stateNode,E,L),Ir(r,L),zs!==4&&(zs=2)),!1;var V=Error(C(520),{cause:E});if(V=Fa(V,m),mf===null?mf=[V]:mf.push(V),zs!==4&&(zs=2),o===null)return!0;E=Fa(E,m),m=o;do{switch(m.tag){case 3:return m.flags|=65536,r=L&-L,m.lanes|=r,r=vh(m.stateNode,E,r),Ir(m,r),!1;case 1:if(o=m.type,V=m.stateNode,(m.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(ou===null||!ou.has(V))))return m.flags|=65536,L&=-L,m.lanes|=L,L=wh(L),Ah(L,r,m,E),Ir(m,L),!1}m=m.return}while(m!==null);return!1}var fp=Error(C(461)),aa=!1;function ba(r,o,m,E){o.child=r===null?Qd(o,null,m,E):El(o,r.child,m,E)}function Vg(r,o,m,E,L){m=m.render;var V=o.ref;if("ref"in E){var ne={};for(var Ae in E)Ae!=="ref"&&(ne[Ae]=E[Ae])}else ne=E;return Wl(o),E=Mu(r,o,m,ne,V,L),Ae=bh(),r!==null&&!aa?(Ec(r,o,L),Ic(r,o,L)):(tr&&Ae&&Hc(o),o.flags|=1,ba(r,o,E,L),o.child)}function pp(r,o,m,E,L){if(r===null){var V=m.type;return typeof V=="function"&&!Yh(V)&&V.defaultProps===void 0&&m.compare===null?(o.tag=15,o.type=V,S0(r,o,V,E,L)):(r=$h(m.type,null,E,o,o.mode,L),r.ref=o.ref,r.return=o,o.child=r)}if(V=r.child,!rf(r,L)){var ne=V.memoizedProps;if(m=m.compare,m=m!==null?m:O,m(ne,E)&&r.ref===o.ref)return Ic(r,o,L)}return o.flags|=1,r=co(V,E),r.ref=o.ref,r.return=o,o.child=r}function S0(r,o,m,E,L){if(r!==null){var V=r.memoizedProps;if(O(V,E)&&r.ref===o.ref)if(aa=!1,o.pendingProps=E=V,rf(r,L))(r.flags&131072)!==0&&(aa=!0);else return o.lanes=r.lanes,Ic(r,o,L)}return T0(r,o,m,E,L)}function C0(r,o,m,E){var L=E.children,V=r!==null?r.memoizedState:null;if(r===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),E.mode==="hidden"){if((o.flags&128)!==0){if(V=V!==null?V.baseLanes|m:m,r!==null){for(E=o.child=r.child,L=0;E!==null;)L=L|E.lanes|E.childLanes,E=E.sibling;E=L&~V}else E=0,o.child=null;return Gg(r,o,V,m,E)}if((m&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&nd(o,V!==null?V.cachePool:null),V!==null?Jd(o,V):po(),mh(o);else return E=o.lanes=536870912,Gg(r,o,V!==null?V.baseLanes|m:m,m,E)}else V!==null?(nd(o,V.cachePool),Jd(o,V),Is(),o.memoizedState=null):(r!==null&&nd(o,null),po(),Is());return ba(r,o,L,m),o.child}function Tc(r,o){return r!==null&&r.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Gg(r,o,m,E,L){var V=td();return V=V===null?null:{parent:Ts._currentValue,pool:V},o.memoizedState={baseLanes:m,cachePool:V},r!==null&&nd(o,null),po(),mh(o),r!==null&&ho(r,o,E,!0),o.childLanes=L,null}function eu(r,o){return o=_p({mode:o.mode,children:o.children},r.mode),o.ref=r.ref,r.child=o,o.return=r,o}function tf(r,o,m){return El(o,r.child,null,m),r=eu(o,o.pendingProps),r.flags|=2,ps(o),o.memoizedState=null,r}function gp(r,o,m){var E=o.pendingProps,L=(o.flags&128)!==0;if(o.flags&=-129,r===null){if(tr){if(E.mode==="hidden")return r=eu(o,E),o.lanes=536870912,Tc(null,r);if(Iu(o),(r=Fr)?(r=Vu(r,uo),r=r!==null&&r.data==="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:pl!==null?{id:gl,overflow:Ga}:null,retryLane:536870912,hydrationErrors:null},m=Qh(r),m.return=o,o.child=m,ia=o,Fr=null)):r=null,r===null)throw Ha(o);return o.lanes=536870912,null}return eu(o,E)}var V=r.memoizedState;if(V!==null){var ne=V.dehydrated;if(Iu(o),L)if(o.flags&256)o.flags&=-257,o=tf(r,o,m);else if(o.memoizedState!==null)o.child=r.child,o.flags|=128,o=null;else throw Error(C(558));else if(aa||ho(r,o,m,!1),L=(m&r.childLanes)!==0,aa||L){if(E=ls,E!==null&&(ne=Bi(E,m),ne!==0&&ne!==V.retryLane))throw V.retryLane=ne,To(r,ne),Fo(E,r,ne),fp;bf(),o=tf(r,o,m)}else r=V.treeContext,Fr=rl(ne.nextSibling),ia=o,tr=!0,Hl=null,uo=!1,r!==null&&Wd(o,r),o=eu(o,E),o.flags|=4096;return o}return r=co(r.child,{mode:E.mode,children:E.children}),r.ref=o.ref,o.child=r,r.return=o,r}function mp(r,o){var m=o.ref;if(m===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(C(284));(r===null||r.ref!==m)&&(o.flags|=4194816)}}function T0(r,o,m,E,L){return Wl(o),m=Mu(r,o,m,E,void 0,L),E=bh(),r!==null&&!aa?(Ec(r,o,L),Ic(r,o,L)):(tr&&E&&Hc(o),o.flags|=1,ba(r,o,m,L),o.child)}function Hg(r,o,m,E,L,V){return Wl(o),o.updateQueue=null,m=xh(o,E,m,L),ku(r),E=bh(),r!==null&&!aa?(Ec(r,o,V),Ic(r,o,V)):(tr&&E&&Hc(o),o.flags|=1,ba(r,o,m,V),o.child)}function qg(r,o,m,E,L){if(Wl(o),o.stateNode===null){var V=Oi,ne=m.contextType;typeof ne=="object"&&ne!==null&&(V=Ps(ne)),V=new m(E,V),o.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,V.updater=cd,o.stateNode=V,V._reactInternals=o,V=o.stateNode,V.props=E,V.state=o.memoizedState,V.refs={},ad(o),ne=m.contextType,V.context=typeof ne=="object"&&ne!==null?Ps(ne):Oi,V.state=o.memoizedState,ne=m.getDerivedStateFromProps,typeof ne=="function"&&(ld(o,m,ne,E),V.state=o.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(ne=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),ne!==V.state&&cd.enqueueReplaceState(V,V.state,null),Ac(o,E,V,L),$l(),V.state=o.memoizedState),typeof V.componentDidMount=="function"&&(o.flags|=4194308),E=!0}else if(r===null){V=o.stateNode;var Ae=o.memoizedProps,lt=Cc(m,Ae);V.props=lt;var Vt=V.context,rn=m.contextType;ne=Oi,typeof rn=="object"&&rn!==null&&(ne=Ps(rn));var pn=m.getDerivedStateFromProps;rn=typeof pn=="function"||typeof V.getSnapshotBeforeUpdate=="function",Ae=o.pendingProps!==Ae,rn||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(Ae||Vt!==ne)&&hp(o,V,E,ne),Sl=!1;var Ht=o.memoizedState;V.state=Ht,Ac(o,E,V,L),$l(),Vt=o.memoizedState,Ae||Ht!==Vt||Sl?(typeof pn=="function"&&(ld(o,m,pn,E),Vt=o.memoizedState),(lt=Sl||Sc(o,m,lt,E,Ht,Vt,ne))?(rn||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount()),typeof V.componentDidMount=="function"&&(o.flags|=4194308)):(typeof V.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=E,o.memoizedState=Vt),V.props=E,V.state=Vt,V.context=ne,E=lt):(typeof V.componentDidMount=="function"&&(o.flags|=4194308),E=!1)}else{V=o.stateNode,fh(r,o),ne=o.memoizedProps,rn=Cc(m,ne),V.props=rn,pn=o.pendingProps,Ht=V.context,Vt=m.contextType,lt=Oi,typeof Vt=="object"&&Vt!==null&&(lt=Ps(Vt)),Ae=m.getDerivedStateFromProps,(Vt=typeof Ae=="function"||typeof V.getSnapshotBeforeUpdate=="function")||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(ne!==pn||Ht!==lt)&&hp(o,V,E,lt),Sl=!1,Ht=o.memoizedState,V.state=Ht,Ac(o,E,V,L),$l();var Yt=o.memoizedState;ne!==pn||Ht!==Yt||Sl||r!==null&&r.dependencies!==null&&Eu(r.dependencies)?(typeof Ae=="function"&&(ld(o,m,Ae,E),Yt=o.memoizedState),(rn=Sl||Sc(o,m,rn,E,Ht,Yt,lt)||r!==null&&r.dependencies!==null&&Eu(r.dependencies))?(Vt||typeof V.UNSAFE_componentWillUpdate!="function"&&typeof V.componentWillUpdate!="function"||(typeof V.componentWillUpdate=="function"&&V.componentWillUpdate(E,Yt,lt),typeof V.UNSAFE_componentWillUpdate=="function"&&V.UNSAFE_componentWillUpdate(E,Yt,lt)),typeof V.componentDidUpdate=="function"&&(o.flags|=4),typeof V.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof V.componentDidUpdate!="function"||ne===r.memoizedProps&&Ht===r.memoizedState||(o.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||ne===r.memoizedProps&&Ht===r.memoizedState||(o.flags|=1024),o.memoizedProps=E,o.memoizedState=Yt),V.props=E,V.state=Yt,V.context=lt,E=rn):(typeof V.componentDidUpdate!="function"||ne===r.memoizedProps&&Ht===r.memoizedState||(o.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||ne===r.memoizedProps&&Ht===r.memoizedState||(o.flags|=1024),E=!1)}return V=E,mp(r,o),E=(o.flags&128)!==0,V||E?(V=o.stateNode,m=E&&typeof m.getDerivedStateFromError!="function"?null:V.render(),o.flags|=1,r!==null&&E?(o.child=El(o,r.child,null,L),o.child=El(o,null,m,L)):ba(r,o,m,L),o.memoizedState=V.state,r=o.child):r=Ic(r,o,L),r}function Zg(r,o,m,E){return yl(),o.flags|=256,ba(r,o,m,E),o.child}var yp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function nf(r){return{baseLanes:r,cachePool:up()}}function xp(r,o,m){return r=r!==null?r.childLanes&~m:0,o&&(r|=ja),r}function I0(r,o,m){var E=o.pendingProps,L=!1,V=(o.flags&128)!==0,ne;if((ne=V)||(ne=r!==null&&r.memoizedState===null?!1:(xs.current&2)!==0),ne&&(L=!0,o.flags&=-129),ne=(o.flags&32)!==0,o.flags&=-33,r===null){if(tr){if(L?No(o):Is(),(r=Fr)?(r=Vu(r,uo),r=r!==null&&r.data!=="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:pl!==null?{id:gl,overflow:Ga}:null,retryLane:536870912,hydrationErrors:null},m=Qh(r),m.return=o,o.child=m,ia=o,Fr=null)):r=null,r===null)throw Ha(o);return qs(r)?o.lanes=32:o.lanes=536870912,null}var Ae=E.children;return E=E.fallback,L?(Is(),L=o.mode,Ae=_p({mode:"hidden",children:Ae},L),E=yc(E,L,m,null),Ae.return=o,E.return=o,Ae.sibling=E,o.child=Ae,E=o.child,E.memoizedState=nf(m),E.childLanes=xp(r,ne,m),o.memoizedState=yp,Tc(null,E)):(No(o),M0(o,Ae))}var lt=r.memoizedState;if(lt!==null&&(Ae=lt.dehydrated,Ae!==null)){if(V)o.flags&256?(No(o),o.flags&=-257,o=bp(r,o,m)):o.memoizedState!==null?(Is(),o.child=r.child,o.flags|=128,o=null):(Is(),Ae=E.fallback,L=o.mode,E=_p({mode:"visible",children:E.children},L),Ae=yc(Ae,L,m,null),Ae.flags|=2,E.return=o,Ae.return=o,E.sibling=Ae,o.child=E,El(o,r.child,null,m),E=o.child,E.memoizedState=nf(m),E.childLanes=xp(r,ne,m),o.memoizedState=yp,o=Tc(null,E));else if(No(o),qs(Ae)){if(ne=Ae.nextSibling&&Ae.nextSibling.dataset,ne)var Vt=ne.dgst;ne=Vt,E=Error(C(419)),E.stack="",E.digest=ne,ql({value:E,source:null,stack:null}),o=bp(r,o,m)}else if(aa||ho(r,o,m,!1),ne=(m&r.childLanes)!==0,aa||ne){if(ne=ls,ne!==null&&(E=Bi(ne,m),E!==0&&E!==lt.retryLane))throw lt.retryLane=E,To(r,E),Fo(ne,r,E),fp;$a(Ae)||bf(),o=bp(r,o,m)}else $a(Ae)?(o.flags|=192,o.child=r.child,o=null):(r=lt.treeContext,Fr=rl(Ae.nextSibling),ia=o,tr=!0,Hl=null,uo=!1,r!==null&&Wd(o,r),o=M0(o,E.children),o.flags|=4096);return o}return L?(Is(),Ae=E.fallback,L=o.mode,lt=r.child,Vt=lt.sibling,E=co(lt,{mode:"hidden",children:E.children}),E.subtreeFlags=lt.subtreeFlags&65011712,Vt!==null?Ae=co(Vt,Ae):(Ae=yc(Ae,L,m,null),Ae.flags|=2),Ae.return=o,E.return=o,E.sibling=Ae,o.child=E,Tc(null,E),E=o.child,Ae=r.child.memoizedState,Ae===null?Ae=nf(m):(L=Ae.cachePool,L!==null?(lt=Ts._currentValue,L=L.parent!==lt?{parent:lt,pool:lt}:L):L=up(),Ae={baseLanes:Ae.baseLanes|m,cachePool:L}),E.memoizedState=Ae,E.childLanes=xp(r,ne,m),o.memoizedState=yp,Tc(r.child,E)):(No(o),m=r.child,r=m.sibling,m=co(m,{mode:"visible",children:E.children}),m.return=o,m.sibling=null,r!==null&&(ne=o.deletions,ne===null?(o.deletions=[r],o.flags|=16):ne.push(r)),o.child=m,o.memoizedState=null,m)}function M0(r,o){return o=_p({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function _p(r,o){return r=lo(22,r,null,o),r.lanes=0,r}function bp(r,o,m){return El(o,r.child,null,m),r=M0(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function k0(r,o,m){r.lanes|=o;var E=r.alternate;E!==null&&(E.lanes|=o),Kh(r.return,o,m)}function N0(r,o,m,E,L,V){var ne=r.memoizedState;ne===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:E,tail:m,tailMode:L,treeForkCount:V}:(ne.isBackwards=o,ne.rendering=null,ne.renderingStartTime=0,ne.last=E,ne.tail=m,ne.tailMode=L,ne.treeForkCount=V)}function vp(r,o,m){var E=o.pendingProps,L=E.revealOrder,V=E.tail;E=E.children;var ne=xs.current,Ae=(ne&2)!==0;if(Ae?(ne=ne&1|2,o.flags|=128):ne&=1,Nt(xs,ne),ba(r,o,E,m),E=tr?vc:0,!Ae&&r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&k0(r,m,o);else if(r.tag===19)k0(r,m,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(L){case"forwards":for(m=o.child,L=null;m!==null;)r=m.alternate,r!==null&&yh(r)===null&&(L=m),m=m.sibling;m=L,m===null?(L=o.child,o.child=null):(L=m.sibling,m.sibling=null),N0(o,!1,L,m,V,E);break;case"backwards":case"unstable_legacy-backwards":for(m=null,L=o.child,o.child=null;L!==null;){if(r=L.alternate,r!==null&&yh(r)===null){o.child=L;break}r=L.sibling,L.sibling=m,m=L,L=r}N0(o,!0,m,null,V,E);break;case"together":N0(o,!1,null,null,void 0,E);break;default:o.memoizedState=null}return o.child}function Ic(r,o,m){if(r!==null&&(o.dependencies=r.dependencies),au|=o.lanes,(m&o.childLanes)===0)if(r!==null){if(ho(r,o,m,!1),(m&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(C(153));if(o.child!==null){for(r=o.child,m=co(r,r.pendingProps),o.child=m,m.return=o;r.sibling!==null;)r=r.sibling,m=m.sibling=co(r,r.pendingProps),m.return=o;m.sibling=null}return o.child}function rf(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&Eu(r)))}function sf(r,o,m){switch(o.tag){case 3:an(o,o.stateNode.containerInfo),Xl(o,Ts,r.memoizedState.cache),yl();break;case 27:case 5:Nn(o);break;case 4:an(o,o.stateNode.containerInfo);break;case 10:Xl(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Iu(o),null;break;case 13:var E=o.memoizedState;if(E!==null)return E.dehydrated!==null?(No(o),o.flags|=128,null):(m&o.child.childLanes)!==0?I0(r,o,m):(No(o),r=Ic(r,o,m),r!==null?r.sibling:null);No(o);break;case 19:var L=(r.flags&128)!==0;if(E=(m&o.childLanes)!==0,E||(ho(r,o,m,!1),E=(m&o.childLanes)!==0),L){if(E)return vp(r,o,m);o.flags|=128}if(L=o.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),Nt(xs,xs.current),E)break;return null;case 22:return o.lanes=0,C0(r,o,m,o.pendingProps);case 24:Xl(o,Ts,r.memoizedState.cache)}return Ic(r,o,m)}function Ya(r,o,m){if(r!==null)if(r.memoizedProps!==o.pendingProps)aa=!0;else{if(!rf(r,m)&&(o.flags&128)===0)return aa=!1,sf(r,o,m);aa=(r.flags&131072)!==0}else aa=!1,tr&&(o.flags&1048576)!==0&&Xd(o,vc,o.index);switch(o.lanes=0,o.tag){case 16:e:{var E=o.pendingProps;if(r=Mo(o.elementType),o.type=r,typeof r=="function")Yh(r)?(E=Cc(r,E),o.tag=1,o=qg(null,o,r,E,m)):(o.tag=0,o=T0(null,o,r,E,m));else{if(r!=null){var L=r.$$typeof;if(L===pt){o.tag=11,o=Vg(null,o,r,E,m);break e}else if(L===it){o.tag=14,o=pp(null,o,r,E,m);break e}}throw o=Zt(r)||r,Error(C(306,o,""))}}return o;case 0:return T0(r,o,o.type,o.pendingProps,m);case 1:return E=o.type,L=Cc(E,o.pendingProps),qg(r,o,E,L,m);case 3:e:{if(an(o,o.stateNode.containerInfo),r===null)throw Error(C(387));E=o.pendingProps;var V=o.memoizedState;L=V.element,fh(r,o),Ac(o,E,null,m);var ne=o.memoizedState;if(E=ne.cache,Xl(o,Ts,E),E!==V.cache&&Jh(o,[Ts],m,!0),$l(),E=ne.element,V.isDehydrated)if(V={element:E,isDehydrated:!1,cache:ne.cache},o.updateQueue.baseState=V,o.memoizedState=V,o.flags&256){o=Zg(r,o,E,m);break e}else if(E!==L){L=Fa(Error(C(424)),o),ql(L),o=Zg(r,o,E,m);break e}else for(r=o.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Fr=rl(r.firstChild),ia=o,tr=!0,Hl=null,uo=!0,m=Qd(o,null,E,m),o.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(yl(),E===L){o=Ic(r,o,m);break e}ba(r,o,E,m)}o=o.child}return o;case 26:return mp(r,o),r===null?(m=hg(o.type,null,o.pendingProps,null))?o.memoizedState=m:tr||(m=o.type,r=o.pendingProps,E=Cf(Bt.current).createElement(m),E[Zi]=o,E[ln]=r,wa(E,m,r),bi(E),o.stateNode=E):o.memoizedState=hg(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return Nn(o),r===null&&tr&&(E=o.stateNode=Cm(o.type,o.pendingProps,Bt.current),ia=o,uo=!0,L=Fr,Uu(o.type)?(_o=L,Fr=rl(E.firstChild)):Fr=L),ba(r,o,o.pendingProps.children,m),mp(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&tr&&((L=E=Fr)&&(E=Ia(E,o.type,o.pendingProps,uo),E!==null?(o.stateNode=E,ia=o,Fr=rl(E.firstChild),uo=!1,L=!0):L=!1),L||Ha(o)),Nn(o),L=o.type,V=o.pendingProps,ne=r!==null?r.memoizedProps:null,E=V.children,Wp(L,V)?E=null:ne!==null&&Wp(L,ne)&&(o.flags|=32),o.memoizedState!==null&&(L=Mu(r,o,_h,null,null,m),Md._currentValue=L),mp(r,o),ba(r,o,E,m),o.child;case 6:return r===null&&tr&&((r=m=Fr)&&(m=ac(m,o.pendingProps,uo),m!==null?(o.stateNode=m,ia=o,Fr=null,r=!0):r=!1),r||Ha(o)),null;case 13:return I0(r,o,m);case 4:return an(o,o.stateNode.containerInfo),E=o.pendingProps,r===null?o.child=El(o,null,E,m):ba(r,o,E,m),o.child;case 11:return Vg(r,o,o.type,o.pendingProps,m);case 7:return ba(r,o,o.pendingProps,m),o.child;case 8:return ba(r,o,o.pendingProps.children,m),o.child;case 12:return ba(r,o,o.pendingProps.children,m),o.child;case 10:return E=o.pendingProps,Xl(o,o.type,E.value),ba(r,o,E.children,m),o.child;case 9:return L=o.type._context,E=o.pendingProps.children,Wl(o),L=Ps(L),E=E(L),o.flags|=1,ba(r,o,E,m),o.child;case 14:return pp(r,o,o.type,o.pendingProps,m);case 15:return S0(r,o,o.type,o.pendingProps,m);case 19:return vp(r,o,m);case 31:return gp(r,o,m);case 22:return C0(r,o,m,o.pendingProps);case 24:return Wl(o),E=Ps(Ts),r===null?(L=td(),L===null&&(L=ls,V=vl(),L.pooledCache=V,V.refCount++,V!==null&&(L.pooledCacheLanes|=m),L=V),o.memoizedState={parent:E,cache:L},ad(o),Xl(o,Ts,L)):((r.lanes&m)!==0&&(fh(r,o),Ac(o,null,null,m),$l()),L=r.memoizedState,V=o.memoizedState,L.parent!==E?(L={parent:E,cache:E},o.memoizedState=L,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=L),Xl(o,Ts,E)):(E=V.cache,Xl(o,Ts,E),E!==L.cache&&Jh(o,[Ts],m,!0))),ba(r,o,o.pendingProps.children,m),o.child;case 29:throw o.pendingProps}throw Error(C(156,o.tag))}function Mc(r){r.flags|=4}function af(r,o,m,E,L){if((o=(r.mode&32)!==0)&&(o=!1),o){if(r.flags|=16777216,(L&335544128)===L)if(r.stateNode.complete)r.flags|=8192;else if(G0())r.flags|=8192;else throw Yo=On,wc}else r.flags&=-16777217}function Xg(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!kf(o))if(G0())r.flags|=8192;else throw Yo=On,wc}function of(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?Jn():536870912,r.lanes|=o,Ih|=o)}function lf(r,o){if(!tr)switch(r.tailMode){case"hidden":o=r.tail;for(var m=null;o!==null;)o.alternate!==null&&(m=o),o=o.sibling;m===null?r.tail=null:m.sibling=null;break;case"collapsed":m=r.tail;for(var E=null;m!==null;)m.alternate!==null&&(E=m),m=m.sibling;E===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:E.sibling=null}}function vs(r){var o=r.alternate!==null&&r.alternate.child===r.child,m=0,E=0;if(o)for(var L=r.child;L!==null;)m|=L.lanes|L.childLanes,E|=L.subtreeFlags&65011712,E|=L.flags&65011712,L.return=r,L=L.sibling;else for(L=r.child;L!==null;)m|=L.lanes|L.childLanes,E|=L.subtreeFlags,E|=L.flags,L.return=r,L=L.sibling;return r.subtreeFlags|=E,r.childLanes=m,o}function Wg(r,o,m){var E=o.pendingProps;switch(Au(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vs(o),null;case 1:return vs(o),null;case 3:return m=o.stateNode,E=null,r!==null&&(E=r.memoizedState.cache),o.memoizedState.cache!==E&&(o.flags|=2048),bl(Ts),sn(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(r===null||r.child===null)&&(ml(o)?Mc(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,xl())),vs(o),null;case 26:var L=o.type,V=o.memoizedState;return r===null?(Mc(o),V!==null?(vs(o),Xg(o,V)):(vs(o),af(o,L,null,E,m))):V?V!==r.memoizedState?(Mc(o),vs(o),Xg(o,V)):(vs(o),o.flags&=-16777217):(r=r.memoizedProps,r!==E&&Mc(o),vs(o),af(o,L,r,E,m)),null;case 27:if(Dn(o),m=Bt.current,L=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==E&&Mc(o);else{if(!E){if(o.stateNode===null)throw Error(C(166));return vs(o),null}r=_t.current,ml(o)?qa(o):(r=Cm(L,E,m),o.stateNode=r,Mc(o))}return vs(o),null;case 5:if(Dn(o),L=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==E&&Mc(o);else{if(!E){if(o.stateNode===null)throw Error(C(166));return vs(o),null}if(V=_t.current,ml(o))qa(o);else{var ne=Cf(Bt.current);switch(V){case 1:V=ne.createElementNS("http://www.w3.org/2000/svg",L);break;case 2:V=ne.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;default:switch(L){case"svg":V=ne.createElementNS("http://www.w3.org/2000/svg",L);break;case"math":V=ne.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;case"script":V=ne.createElement("div"),V.innerHTML="<script><\/script>",V=V.removeChild(V.firstChild);break;case"select":V=typeof E.is=="string"?ne.createElement("select",{is:E.is}):ne.createElement("select"),E.multiple?V.multiple=!0:E.size&&(V.size=E.size);break;default:V=typeof E.is=="string"?ne.createElement(L,{is:E.is}):ne.createElement(L)}}V[Zi]=o,V[ln]=E;e:for(ne=o.child;ne!==null;){if(ne.tag===5||ne.tag===6)V.appendChild(ne.stateNode);else if(ne.tag!==4&&ne.tag!==27&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===o)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===o)break e;ne=ne.return}ne.sibling.return=ne.return,ne=ne.sibling}o.stateNode=V;e:switch(wa(V,L,E),L){case"button":case"input":case"select":case"textarea":E=!!E.autoFocus;break e;case"img":E=!0;break e;default:E=!1}E&&Mc(o)}}return vs(o),af(o,o.type,r===null?null:r.memoizedProps,o.pendingProps,m),null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==E&&Mc(o);else{if(typeof E!="string"&&o.stateNode===null)throw Error(C(166));if(r=Bt.current,ml(o)){if(r=o.stateNode,m=o.memoizedProps,E=null,L=ia,L!==null)switch(L.tag){case 27:case 5:E=L.memoizedProps}r[Zi]=o,r=!!(r.nodeValue===m||E!==null&&E.suppressHydrationWarning===!0||tg(r.nodeValue,m)),r||Ha(o,!0)}else r=Cf(r).createTextNode(E),r[Zi]=o,o.stateNode=r}return vs(o),null;case 31:if(m=o.memoizedState,r===null||r.memoizedState!==null){if(E=ml(o),m!==null){if(r===null){if(!E)throw Error(C(318));if(r=o.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(557));r[Zi]=o}else yl(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;vs(o),r=!1}else m=xl(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=m),r=!0;if(!r)return o.flags&256?(ps(o),o):(ps(o),null);if((o.flags&128)!==0)throw Error(C(558))}return vs(o),null;case 13:if(E=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(L=ml(o),E!==null&&E.dehydrated!==null){if(r===null){if(!L)throw Error(C(318));if(L=o.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(C(317));L[Zi]=o}else yl(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;vs(o),L=!1}else L=xl(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=L),L=!0;if(!L)return o.flags&256?(ps(o),o):(ps(o),null)}return ps(o),(o.flags&128)!==0?(o.lanes=m,o):(m=E!==null,r=r!==null&&r.memoizedState!==null,m&&(E=o.child,L=null,E.alternate!==null&&E.alternate.memoizedState!==null&&E.alternate.memoizedState.cachePool!==null&&(L=E.alternate.memoizedState.cachePool.pool),V=null,E.memoizedState!==null&&E.memoizedState.cachePool!==null&&(V=E.memoizedState.cachePool.pool),V!==L&&(E.flags|=2048)),m!==r&&m&&(o.child.flags|=8192),of(o,o.updateQueue),vs(o),null);case 4:return sn(),r===null&&J0(o.stateNode.containerInfo),vs(o),null;case 10:return bl(o.type),vs(o),null;case 19:if(nt(xs),E=o.memoizedState,E===null)return vs(o),null;if(L=(o.flags&128)!==0,V=E.rendering,V===null)if(L)lf(E,!1);else{if(zs!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(V=yh(r),V!==null){for(o.flags|=128,lf(E,!1),r=V.updateQueue,o.updateQueue=r,of(o,r),o.subtreeFlags=0,r=m,m=o.child;m!==null;)lp(m,r),m=m.sibling;return Nt(xs,xs.current&1|2),tr&&Gl(o,E.treeForkCount),o.child}r=r.sibling}E.tail!==null&&Pi()>yf&&(o.flags|=128,L=!0,lf(E,!1),o.lanes=4194304)}else{if(!L)if(r=yh(V),r!==null){if(o.flags|=128,L=!0,r=r.updateQueue,o.updateQueue=r,of(o,r),lf(E,!0),E.tail===null&&E.tailMode==="hidden"&&!V.alternate&&!tr)return vs(o),null}else 2*Pi()-E.renderingStartTime>yf&&m!==536870912&&(o.flags|=128,L=!0,lf(E,!1),o.lanes=4194304);E.isBackwards?(V.sibling=o.child,o.child=V):(r=E.last,r!==null?r.sibling=V:o.child=V,E.last=V)}return E.tail!==null?(r=E.tail,E.rendering=r,E.tail=r.sibling,E.renderingStartTime=Pi(),r.sibling=null,m=xs.current,Nt(xs,L?m&1|2:m&1),tr&&Gl(o,E.treeForkCount),r):(vs(o),null);case 22:case 23:return ps(o),Wc(),E=o.memoizedState!==null,r!==null?r.memoizedState!==null!==E&&(o.flags|=8192):E&&(o.flags|=8192),E?(m&536870912)!==0&&(o.flags&128)===0&&(vs(o),o.subtreeFlags&6&&(o.flags|=8192)):vs(o),m=o.updateQueue,m!==null&&of(o,m.retryQueue),m=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(m=r.memoizedState.cachePool.pool),E=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(E=o.memoizedState.cachePool.pool),E!==m&&(o.flags|=2048),r!==null&&nt(Xo),null;case 24:return m=null,r!==null&&(m=r.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),bl(Ts),vs(o),null;case 25:return null;case 30:return null}throw Error(C(156,o.tag))}function P1(r,o){switch(Au(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return bl(Ts),sn(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return Dn(o),null;case 31:if(o.memoizedState!==null){if(ps(o),o.alternate===null)throw Error(C(340));yl()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 13:if(ps(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(C(340));yl()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return nt(xs),null;case 4:return sn(),null;case 10:return bl(o.type),null;case 22:case 23:return ps(o),Wc(),r!==null&&nt(Xo),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return bl(Ts),null;case 25:return null;default:return null}}function wp(r,o){switch(Au(o),o.tag){case 3:bl(Ts),sn();break;case 26:case 27:case 5:Dn(o);break;case 4:sn();break;case 31:o.memoizedState!==null&&ps(o);break;case 13:ps(o);break;case 19:nt(xs);break;case 10:bl(o.type);break;case 22:case 23:ps(o),Wc(),r!==null&&nt(Xo);break;case 24:bl(Ts)}}function dd(r,o){try{var m=o.updateQueue,E=m!==null?m.lastEffect:null;if(E!==null){var L=E.next;m=L;do{if((m.tag&r)===r){E=void 0;var V=m.create,ne=m.inst;E=V(),ne.destroy=E}m=m.next}while(m!==L)}}catch(Ae){Gr(o,o.return,Ae)}}function tu(r,o,m){try{var E=o.updateQueue,L=E!==null?E.lastEffect:null;if(L!==null){var V=L.next;E=V;do{if((E.tag&r)===r){var ne=E.inst,Ae=ne.destroy;if(Ae!==void 0){ne.destroy=void 0,L=o;var lt=m,Vt=Ae;try{Vt()}catch(rn){Gr(L,lt,rn)}}}E=E.next}while(E!==V)}}catch(rn){Gr(o,o.return,rn)}}function Yg(r){var o=r.updateQueue;if(o!==null){var m=r.stateNode;try{od(o,m)}catch(E){Gr(r,r.return,E)}}}function $g(r,o,m){m.props=Cc(r.type,r.memoizedProps),m.state=r.memoizedState;try{m.componentWillUnmount()}catch(E){Gr(r,o,E)}}function cf(r,o){try{var m=r.ref;if(m!==null){switch(r.tag){case 26:case 27:case 5:var E=r.stateNode;break;case 30:E=r.stateNode;break;default:E=r.stateNode}typeof m=="function"?r.refCleanup=m(E):m.current=E}}catch(L){Gr(r,o,L)}}function nl(r,o){var m=r.ref,E=r.refCleanup;if(m!==null)if(typeof E=="function")try{E()}catch(L){Gr(r,o,L)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(L){Gr(r,o,L)}else m.current=null}function Ap(r){var o=r.type,m=r.memoizedProps,E=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":m.autoFocus&&E.focus();break e;case"img":m.src?E.src=m.src:m.srcSet&&(E.srcset=m.srcSet)}}catch(L){Gr(r,r.return,L)}}function Ep(r,o,m){try{var E=r.stateNode;Em(E,r.type,m,o),E[ln]=o}catch(L){Gr(r,r.return,L)}}function Ru(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Uu(r.type)||r.tag===4}function Eh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Ru(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Uu(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function D0(r,o,m){var E=r.tag;if(E===5||E===6)r=r.stateNode,o?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(r,o):(o=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,o.appendChild(r),m=m._reactRootContainer,m!=null||o.onclick!==null||(o.onclick=Xs));else if(E!==4&&(E===27&&Uu(r.type)&&(m=r.stateNode,o=null),r=r.child,r!==null))for(D0(r,o,m),r=r.sibling;r!==null;)D0(r,o,m),r=r.sibling}function Sp(r,o,m){var E=r.tag;if(E===5||E===6)r=r.stateNode,o?m.insertBefore(r,o):m.appendChild(r);else if(E!==4&&(E===27&&Uu(r.type)&&(m=r.stateNode),r=r.child,r!==null))for(Sp(r,o,m),r=r.sibling;r!==null;)Sp(r,o,m),r=r.sibling}function Qg(r){var o=r.stateNode,m=r.memoizedProps;try{for(var E=r.type,L=o.attributes;L.length;)o.removeAttributeNode(L[0]);wa(o,E,m),o[Zi]=r,o[ln]=m}catch(V){Gr(r,r.return,V)}}var nu=!1,oa=!1,R0=!1,Kg=typeof WeakSet=="function"?WeakSet:Set,la=null;function O1(r,o){if(r=r.containerInfo,Sf=Of,r=ue(r),xe(r)){if("selectionStart"in r)var m={start:r.selectionStart,end:r.selectionEnd};else e:{m=(m=r.ownerDocument)&&m.defaultView||window;var E=m.getSelection&&m.getSelection();if(E&&E.rangeCount!==0){m=E.anchorNode;var L=E.anchorOffset,V=E.focusNode;E=E.focusOffset;try{m.nodeType,V.nodeType}catch{m=null;break e}var ne=0,Ae=-1,lt=-1,Vt=0,rn=0,pn=r,Ht=null;t:for(;;){for(var Yt;pn!==m||L!==0&&pn.nodeType!==3||(Ae=ne+L),pn!==V||E!==0&&pn.nodeType!==3||(lt=ne+E),pn.nodeType===3&&(ne+=pn.nodeValue.length),(Yt=pn.firstChild)!==null;)Ht=pn,pn=Yt;for(;;){if(pn===r)break t;if(Ht===m&&++Vt===L&&(Ae=ne),Ht===V&&++rn===E&&(lt=ne),(Yt=pn.nextSibling)!==null)break;pn=Ht,Ht=pn.parentNode}pn=Yt}m=Ae===-1||lt===-1?null:{start:Ae,end:lt}}else m=null}m=m||{start:0,end:0}}else m=null;for(ng={focusedElem:r,selectionRange:m},Of=!1,la=o;la!==null;)if(o=la,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,la=r;else for(;la!==null;){switch(o=la,V=o.alternate,r=o.flags,o.tag){case 0:if((r&4)!==0&&(r=o.updateQueue,r=r!==null?r.events:null,r!==null))for(m=0;m<r.length;m++)L=r[m],L.ref.impl=L.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&V!==null){r=void 0,m=o,L=V.memoizedProps,V=V.memoizedState,E=m.stateNode;try{var di=Cc(m.type,L);r=E.getSnapshotBeforeUpdate(di,V),E.__reactInternalSnapshotBeforeUpdate=r}catch(Ii){Gr(m,m.return,Ii)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,m=r.nodeType,m===9)sc(r);else if(m===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":sc(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(C(163))}if(r=o.sibling,r!==null){r.return=o.return,la=r;break}la=o.return}}function P0(r,o,m){var E=m.flags;switch(m.tag){case 0:case 11:case 15:zo(r,m),E&4&&dd(5,m);break;case 1:if(zo(r,m),E&4)if(r=m.stateNode,o===null)try{r.componentDidMount()}catch(ne){Gr(m,m.return,ne)}else{var L=Cc(m.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(L,o,r.__reactInternalSnapshotBeforeUpdate)}catch(ne){Gr(m,m.return,ne)}}E&64&&Yg(m),E&512&&cf(m,m.return);break;case 3:if(zo(r,m),E&64&&(r=m.updateQueue,r!==null)){if(o=null,m.child!==null)switch(m.child.tag){case 27:case 5:o=m.child.stateNode;break;case 1:o=m.child.stateNode}try{od(r,o)}catch(ne){Gr(m,m.return,ne)}}break;case 27:o===null&&E&4&&Qg(m);case 26:case 5:zo(r,m),o===null&&E&4&&Ap(m),E&512&&cf(m,m.return);break;case 12:zo(r,m);break;case 31:zo(r,m),E&4&&uf(r,m);break;case 13:zo(r,m),E&4&&hf(r,m),E&64&&(r=m.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(m=q0.bind(null,m),ua(r,m))));break;case 22:if(E=m.memoizedState!==null||nu,!E){o=o!==null&&o.memoizedState!==null||oa,L=nu;var V=oa;nu=E,(oa=o)&&!V?iu(r,m,(m.subtreeFlags&8772)!==0):zo(r,m),nu=L,oa=V}break;case 30:break;default:zo(r,m)}}function fd(r){var o=r.alternate;o!==null&&(r.alternate=null,fd(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&Rn(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Ms=null,mr=!1;function Oo(r,o,m){for(m=m.child;m!==null;)O0(r,o,m),m=m.sibling}function O0(r,o,m){if(de&&typeof de.onCommitFiberUnmount=="function")try{de.onCommitFiberUnmount(rt,m)}catch{}switch(m.tag){case 26:oa||nl(m,o),Oo(r,o,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:oa||nl(m,o);var E=Ms,L=mr;Uu(m.type)&&(Ms=m.stateNode,mr=!1),Oo(r,o,m),Cd(m.stateNode),Ms=E,mr=L;break;case 5:oa||nl(m,o);case 6:if(E=Ms,L=mr,Ms=null,Oo(r,o,m),Ms=E,mr=L,Ms!==null)if(mr)try{(Ms.nodeType===9?Ms.body:Ms.nodeName==="HTML"?Ms.ownerDocument.body:Ms).removeChild(m.stateNode)}catch(V){Gr(m,o,V)}else try{Ms.removeChild(m.stateNode)}catch(V){Gr(m,o,V)}break;case 18:Ms!==null&&(mr?(r=Ms,Sm(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,m.stateNode),Xu(r)):Sm(Ms,m.stateNode));break;case 4:E=Ms,L=mr,Ms=m.stateNode.containerInfo,mr=!0,Oo(r,o,m),Ms=E,mr=L;break;case 0:case 11:case 14:case 15:tu(2,m,o),oa||tu(4,m,o),Oo(r,o,m);break;case 1:oa||(nl(m,o),E=m.stateNode,typeof E.componentWillUnmount=="function"&&$g(m,o,E)),Oo(r,o,m);break;case 21:Oo(r,o,m);break;case 22:oa=(E=oa)||m.memoizedState!==null,Oo(r,o,m),oa=E;break;default:Oo(r,o,m)}}function uf(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Xu(r)}catch(m){Gr(o,o.return,m)}}}function hf(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Xu(r)}catch(m){Gr(o,o.return,m)}}function df(r){switch(r.tag){case 31:case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new Kg),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new Kg),o;default:throw Error(C(435,r.tag))}}function ff(r,o){var m=df(r);o.forEach(function(E){if(!m.has(E)){m.add(E);var L=B1.bind(null,r,E);E.then(L,L)}})}function mo(r,o){var m=o.deletions;if(m!==null)for(var E=0;E<m.length;E++){var L=m[E],V=r,ne=o,Ae=ne;e:for(;Ae!==null;){switch(Ae.tag){case 27:if(Uu(Ae.type)){Ms=Ae.stateNode,mr=!1;break e}break;case 5:Ms=Ae.stateNode,mr=!1;break e;case 3:case 4:Ms=Ae.stateNode.containerInfo,mr=!0;break e}Ae=Ae.return}if(Ms===null)throw Error(C(160));O0(V,ne,L),Ms=null,mr=!1,V=L.alternate,V!==null&&(V.return=null),L.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Cp(o,r),o=o.sibling}var yo=null;function Cp(r,o){var m=r.alternate,E=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:mo(o,r),va(r),E&4&&(tu(3,r,r.return),dd(3,r),tu(5,r,r.return));break;case 1:mo(o,r),va(r),E&512&&(oa||m===null||nl(m,m.return)),E&64&&nu&&(r=r.updateQueue,r!==null&&(E=r.callbacks,E!==null&&(m=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=m===null?E:m.concat(E))));break;case 26:var L=yo;if(mo(o,r),va(r),E&512&&(oa||m===null||nl(m,m.return)),E&4){var V=m!==null?m.memoizedState:null;if(E=r.memoizedState,m===null)if(E===null)if(r.stateNode===null){e:{E=r.type,m=r.memoizedProps,L=L.ownerDocument||L;t:switch(E){case"title":V=L.getElementsByTagName("title")[0],(!V||V[fn]||V[Zi]||V.namespaceURI==="http://www.w3.org/2000/svg"||V.hasAttribute("itemprop"))&&(V=L.createElement(E),L.head.insertBefore(V,L.querySelector("head > title"))),wa(V,E,m),V[Zi]=r,bi(V),E=V;break e;case"link":var ne=gg("link","href",L).get(E+(m.href||""));if(ne){for(var Ae=0;Ae<ne.length;Ae++)if(V=ne[Ae],V.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&V.getAttribute("rel")===(m.rel==null?null:m.rel)&&V.getAttribute("title")===(m.title==null?null:m.title)&&V.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){ne.splice(Ae,1);break t}}V=L.createElement(E),wa(V,E,m),L.head.appendChild(V);break;case"meta":if(ne=gg("meta","content",L).get(E+(m.content||""))){for(Ae=0;Ae<ne.length;Ae++)if(V=ne[Ae],V.getAttribute("content")===(m.content==null?null:""+m.content)&&V.getAttribute("name")===(m.name==null?null:m.name)&&V.getAttribute("property")===(m.property==null?null:m.property)&&V.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&V.getAttribute("charset")===(m.charSet==null?null:m.charSet)){ne.splice(Ae,1);break t}}V=L.createElement(E),wa(V,E,m),L.head.appendChild(V);break;default:throw Error(C(468,E))}V[Zi]=r,bi(V),E=V}r.stateNode=E}else Mf(L,r.type,r.stateNode);else r.stateNode=pg(L,E,r.memoizedProps);else V!==E?(V===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):V.count--,E===null?Mf(L,r.type,r.stateNode):pg(L,E,r.memoizedProps)):E===null&&r.stateNode!==null&&Ep(r,r.memoizedProps,m.memoizedProps)}break;case 27:mo(o,r),va(r),E&512&&(oa||m===null||nl(m,m.return)),m!==null&&E&4&&Ep(r,r.memoizedProps,m.memoizedProps);break;case 5:if(mo(o,r),va(r),E&512&&(oa||m===null||nl(m,m.return)),r.flags&32){L=r.stateNode;try{Da(L,"")}catch(di){Gr(r,r.return,di)}}E&4&&r.stateNode!=null&&(L=r.memoizedProps,Ep(r,L,m!==null?m.memoizedProps:L)),E&1024&&(R0=!0);break;case 6:if(mo(o,r),va(r),E&4){if(r.stateNode===null)throw Error(C(162));E=r.memoizedProps,m=r.stateNode;try{m.nodeValue=E}catch(di){Gr(r,r.return,di)}}break;case 3:if(e0=null,L=yo,yo=Qp(o.containerInfo),mo(o,r),yo=L,va(r),E&4&&m!==null&&m.memoizedState.isDehydrated)try{Xu(o.containerInfo)}catch(di){Gr(r,r.return,di)}R0&&(R0=!1,pf(r));break;case 4:E=yo,yo=Qp(r.stateNode.containerInfo),mo(o,r),va(r),yo=E;break;case 12:mo(o,r),va(r);break;case 31:mo(o,r),va(r),E&4&&(E=r.updateQueue,E!==null&&(r.updateQueue=null,ff(r,E)));break;case 13:mo(o,r),va(r),r.child.flags&8192&&r.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(Mp=Pi()),E&4&&(E=r.updateQueue,E!==null&&(r.updateQueue=null,ff(r,E)));break;case 22:L=r.memoizedState!==null;var lt=m!==null&&m.memoizedState!==null,Vt=nu,rn=oa;if(nu=Vt||L,oa=rn||lt,mo(o,r),oa=rn,nu=Vt,va(r),E&8192)e:for(o=r.stateNode,o._visibility=L?o._visibility&-2:o._visibility|1,L&&(m===null||lt||nu||oa||nc(r)),m=null,o=r;;){if(o.tag===5||o.tag===26){if(m===null){lt=m=o;try{if(V=lt.stateNode,L)ne=V.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{Ae=lt.stateNode;var pn=lt.memoizedProps.style,Ht=pn!=null&&pn.hasOwnProperty("display")?pn.display:null;Ae.style.display=Ht==null||typeof Ht=="boolean"?"":(""+Ht).trim()}}catch(di){Gr(lt,lt.return,di)}}}else if(o.tag===6){if(m===null){lt=o;try{lt.stateNode.nodeValue=L?"":lt.memoizedProps}catch(di){Gr(lt,lt.return,di)}}}else if(o.tag===18){if(m===null){lt=o;try{var Yt=lt.stateNode;L?qi(Yt,!0):qi(lt.stateNode,!1)}catch(di){Gr(lt,lt.return,di)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;m===o&&(m=null),o=o.return}m===o&&(m=null),o.sibling.return=o.return,o=o.sibling}E&4&&(E=r.updateQueue,E!==null&&(m=E.retryQueue,m!==null&&(E.retryQueue=null,ff(r,m))));break;case 19:mo(o,r),va(r),E&4&&(E=r.updateQueue,E!==null&&(r.updateQueue=null,ff(r,E)));break;case 30:break;case 21:break;default:mo(o,r),va(r)}}function va(r){var o=r.flags;if(o&2){try{for(var m,E=r.return;E!==null;){if(Ru(E)){m=E;break}E=E.return}if(m==null)throw Error(C(160));switch(m.tag){case 27:var L=m.stateNode,V=Eh(r);Sp(r,V,L);break;case 5:var ne=m.stateNode;m.flags&32&&(Da(ne,""),m.flags&=-33);var Ae=Eh(r);Sp(r,Ae,ne);break;case 3:case 4:var lt=m.stateNode.containerInfo,Vt=Eh(r);D0(r,Vt,lt);break;default:throw Error(C(161))}}catch(rn){Gr(r,r.return,rn)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function pf(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;pf(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function zo(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)P0(r,o.alternate,o),o=o.sibling}function nc(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:tu(4,o,o.return),nc(o);break;case 1:nl(o,o.return);var m=o.stateNode;typeof m.componentWillUnmount=="function"&&$g(o,o.return,m),nc(o);break;case 27:Cd(o.stateNode);case 26:case 5:nl(o,o.return),nc(o);break;case 22:o.memoizedState===null&&nc(o);break;case 30:nc(o);break;default:nc(o)}r=r.sibling}}function iu(r,o,m){for(m=m&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var E=o.alternate,L=r,V=o,ne=V.flags;switch(V.tag){case 0:case 11:case 15:iu(L,V,m),dd(4,V);break;case 1:if(iu(L,V,m),E=V,L=E.stateNode,typeof L.componentDidMount=="function")try{L.componentDidMount()}catch(Vt){Gr(E,E.return,Vt)}if(E=V,L=E.updateQueue,L!==null){var Ae=E.stateNode;try{var lt=L.shared.hiddenCallbacks;if(lt!==null)for(L.shared.hiddenCallbacks=null,L=0;L<lt.length;L++)ph(lt[L],Ae)}catch(Vt){Gr(E,E.return,Vt)}}m&&ne&64&&Yg(V),cf(V,V.return);break;case 27:Qg(V);case 26:case 5:iu(L,V,m),m&&E===null&&ne&4&&Ap(V),cf(V,V.return);break;case 12:iu(L,V,m);break;case 31:iu(L,V,m),m&&ne&4&&uf(L,V);break;case 13:iu(L,V,m),m&&ne&4&&hf(L,V);break;case 22:V.memoizedState===null&&iu(L,V,m),cf(V,V.return);break;case 30:break;default:iu(L,V,m)}o=o.sibling}}function Tp(r,o){var m=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(m=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==m&&(r!=null&&r.refCount++,m!=null&&Su(m))}function ru(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Su(r))}function ic(r,o,m,E){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)z0(r,o,m,E),o=o.sibling}function z0(r,o,m,E){var L=o.flags;switch(o.tag){case 0:case 11:case 15:ic(r,o,m,E),L&2048&&dd(9,o);break;case 1:ic(r,o,m,E);break;case 3:ic(r,o,m,E),L&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Su(r)));break;case 12:if(L&2048){ic(r,o,m,E),r=o.stateNode;try{var V=o.memoizedProps,ne=V.id,Ae=V.onPostCommit;typeof Ae=="function"&&Ae(ne,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(lt){Gr(o,o.return,lt)}}else ic(r,o,m,E);break;case 31:ic(r,o,m,E);break;case 13:ic(r,o,m,E);break;case 23:break;case 22:V=o.stateNode,ne=o.alternate,o.memoizedState!==null?V._visibility&2?ic(r,o,m,E):Sh(r,o):V._visibility&2?ic(r,o,m,E):(V._visibility|=2,kc(r,o,m,E,(o.subtreeFlags&10256)!==0||!1)),L&2048&&Tp(ne,o);break;case 24:ic(r,o,m,E),L&2048&&ru(o.alternate,o);break;default:ic(r,o,m,E)}}function kc(r,o,m,E,L){for(L=L&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var V=r,ne=o,Ae=m,lt=E,Vt=ne.flags;switch(ne.tag){case 0:case 11:case 15:kc(V,ne,Ae,lt,L),dd(8,ne);break;case 23:break;case 22:var rn=ne.stateNode;ne.memoizedState!==null?rn._visibility&2?kc(V,ne,Ae,lt,L):Sh(V,ne):(rn._visibility|=2,kc(V,ne,Ae,lt,L)),L&&Vt&2048&&Tp(ne.alternate,ne);break;case 24:kc(V,ne,Ae,lt,L),L&&Vt&2048&&ru(ne.alternate,ne);break;default:kc(V,ne,Ae,lt,L)}o=o.sibling}}function Sh(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var m=r,E=o,L=E.flags;switch(E.tag){case 22:Sh(m,E),L&2048&&Tp(E.alternate,E);break;case 24:Sh(m,E),L&2048&&ru(E.alternate,E);break;default:Sh(m,E)}o=o.sibling}}var pd=8192;function Ch(r,o,m){if(r.subtreeFlags&pd)for(r=r.child;r!==null;)Jg(r,o,m),r=r.sibling}function Jg(r,o,m){switch(r.tag){case 26:Ch(r,o,m),r.flags&pd&&r.memoizedState!==null&&mg(m,yo,r.memoizedState,r.memoizedProps);break;case 5:Ch(r,o,m);break;case 3:case 4:var E=yo;yo=Qp(r.stateNode.containerInfo),Ch(r,o,m),yo=E;break;case 22:r.memoizedState===null&&(E=r.alternate,E!==null&&E.memoizedState!==null?(E=pd,pd=16777216,Ch(r,o,m),pd=E):Ch(r,o,m));break;default:Ch(r,o,m)}}function em(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function gf(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var m=0;m<o.length;m++){var E=o[m];la=E,gd(E,r)}em(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)tm(r),r=r.sibling}function tm(r){switch(r.tag){case 0:case 11:case 15:gf(r),r.flags&2048&&tu(9,r,r.return);break;case 3:gf(r);break;case 12:gf(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,Ip(r)):gf(r);break;default:gf(r)}}function Ip(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var m=0;m<o.length;m++){var E=o[m];la=E,gd(E,r)}em(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:tu(8,o,o.return),Ip(o);break;case 22:m=o.stateNode,m._visibility&2&&(m._visibility&=-3,Ip(o));break;default:Ip(o)}r=r.sibling}}function gd(r,o){for(;la!==null;){var m=la;switch(m.tag){case 0:case 11:case 15:tu(8,m,o);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var E=m.memoizedState.cachePool.pool;E!=null&&E.refCount++}break;case 24:Su(m.memoizedState.cache)}if(E=m.child,E!==null)E.return=m,la=E;else e:for(m=r;la!==null;){E=la;var L=E.sibling,V=E.return;if(fd(E),E===m){la=null;break e}if(L!==null){L.return=V,la=L;break e}la=V}}}var z1={getCacheForType:function(r){var o=Ps(Ts),m=o.data.get(r);return m===void 0&&(m=r(),o.data.set(r,m)),m},cacheSignal:function(){return Ps(Ts).controller.signal}},nm=typeof WeakMap=="function"?WeakMap:Map,Vr=0,ls=null,ur=null,hr=0,Wr=0,xo=null,kl=!1,Pu=!1,L0=!1,su=0,zs=0,au=0,Th=0,B0=0,ja=0,Ih=0,mf=null,Lo=null,F0=!1,Mp=0,im=0,yf=1/0,md=null,ou=null,ca=0,lu=null,yd=null,Nl=0,j0=0,kp=null,rm=null,xf=0,U0=null;function Bo(){return(Vr&2)!==0&&hr!==0?hr&-hr:Te.T!==null?$0():gi()}function sm(){if(ja===0)if((hr&536870912)===0||tr){var r=mn;mn<<=1,(mn&3932160)===0&&(mn=262144),ja=r}else ja=536870912;return r=Bn.current,r!==null&&(r.flags|=32),ja}function Fo(r,o,m){(r===ls&&(Wr===2||Wr===9)||r.cancelPendingCommit!==null)&&(_d(r,0),Ou(r,hr,ja,!1)),Mi(r,m),((Vr&2)===0||r!==ls)&&(r===ls&&((Vr&2)===0&&(Th|=m),zs===4&&Ou(r,hr,ja,!1)),rc(r))}function ea(r,o,m){if((Vr&6)!==0)throw Error(C(327));var E=!m&&(o&127)===0&&(o&r.expiredLanes)===0||Qn(r,o),L=E?bd(r,o):Rp(r,o,!0),V=E;do{if(L===0){Pu&&!E&&Ou(r,o,0,!1);break}else{if(m=r.current.alternate,V&&!L1(m)){L=Rp(r,o,!1),V=!1;continue}if(L===2){if(V=o,r.errorRecoveryDisabledLanes&V)var ne=0;else ne=r.pendingLanes&-536870913,ne=ne!==0?ne:ne&536870912?536870912:0;if(ne!==0){o=ne;e:{var Ae=r;L=mf;var lt=Ae.current.memoizedState.isDehydrated;if(lt&&(_d(Ae,ne).flags|=256),ne=Rp(Ae,ne,!1),ne!==2){if(L0&&!lt){Ae.errorRecoveryDisabledLanes|=V,Th|=V,L=4;break e}V=Lo,Lo=L,V!==null&&(Lo===null?Lo=V:Lo.push.apply(Lo,V))}L=ne}if(V=!1,L!==2)continue}}if(L===1){_d(r,0),Ou(r,o,0,!0);break}e:{switch(E=r,V=L,V){case 0:case 1:throw Error(C(345));case 4:if((o&4194048)!==o)break;case 6:Ou(E,o,ja,!kl);break e;case 2:Lo=null;break;case 3:case 5:break;default:throw Error(C(329))}if((o&62914560)===o&&(L=Mp+300-Pi(),10<L)){if(Ou(E,o,ja,!kl),ai(E,0,!0)!==0)break e;Nl=o,E.timeoutHandle=$p(xd.bind(null,E,m,Lo,md,F0,o,ja,Th,Ih,kl,V,"Throttled",-0,0),L);break e}xd(E,m,Lo,md,F0,o,ja,Th,Ih,kl,V,null,-0,0)}}break}while(!0);rc(r)}function xd(r,o,m,E,L,V,ne,Ae,lt,Vt,rn,pn,Ht,Yt){if(r.timeoutHandle=-1,pn=o.subtreeFlags,pn&8192||(pn&16785408)===16785408){pn={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Xs},Jg(o,V,pn);var di=(V&62914560)===V?Mp-Pi():(V&4194048)===V?im-Pi():0;if(di=yg(pn,di),di!==null){Nl=V,r.cancelPendingCommit=di(um.bind(null,r,o,V,m,E,L,ne,Ae,lt,rn,pn,null,Ht,Yt)),Ou(r,V,ne,!Vt);return}}um(r,o,V,m,E,L,ne,Ae,lt)}function L1(r){for(var o=r;;){var m=o.tag;if((m===0||m===11||m===15)&&o.flags&16384&&(m=o.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var E=0;E<m.length;E++){var L=m[E],V=L.getSnapshot;L=L.value;try{if(!I(V(),L))return!1}catch{return!1}}if(m=o.child,o.subtreeFlags&16384&&m!==null)m.return=o,o=m;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ou(r,o,m,E){o&=~B0,o&=~Th,r.suspendedLanes|=o,r.pingedLanes&=~o,E&&(r.warmLanes|=o),E=r.expirationTimes;for(var L=o;0<L;){var V=31-yt(L),ne=1<<V;E[V]=-1,L&=~ne}m!==0&&zi(r,m,o)}function _f(){return(Vr&6)===0?(il(0),!1):!0}function Np(){if(ur!==null){if(Wr===0)var r=ur.return;else r=ur,_l=Io=null,Jl(r),wl=null,Zc=0,r=ur;for(;r!==null;)wp(r.alternate,r),r=r.return;ur=null}}function _d(r,o){var m=r.timeoutHandle;m!==-1&&(r.timeoutHandle=-1,rg(m)),m=r.cancelPendingCommit,m!==null&&(r.cancelPendingCommit=null,m()),Nl=0,Np(),ls=r,ur=m=co(r.current,null),hr=o,Wr=0,xo=null,kl=!1,Pu=Qn(r,o),L0=!1,Ih=ja=B0=Th=au=zs=0,Lo=mf=null,F0=!1,(o&8)!==0&&(o|=o&32);var E=r.entangledLanes;if(E!==0)for(r=r.entanglements,E&=o;0<E;){var L=31-yt(E),V=1<<L;o|=r[L],E&=~V}return su=o,Vc(),m}function V0(r,o){Gi=null,Te.H=Mr,o===Wo||o===Za?(o=Tu(),Wr=3):o===wc?(o=Tu(),Wr=4):Wr=o===fp?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,xo=o,ur===null&&(zs=1,tl(r,Fa(o,r.current)))}function G0(){var r=Bn.current;return r===null?!0:(hr&4194048)===hr?ri===null:(hr&62914560)===hr||(hr&536870912)!==0?r===ri:!1}function Mh(){var r=Te.H;return Te.H=Mr,r===null?Mr:r}function Dp(){var r=Te.A;return Te.A=z1,r}function bf(){zs=4,kl||(hr&4194048)!==hr&&Bn.current!==null||(Pu=!0),(au&134217727)===0&&(Th&134217727)===0||ls===null||Ou(ls,hr,ja,!1)}function Rp(r,o,m){var E=Vr;Vr|=2;var L=Mh(),V=Dp();(ls!==r||hr!==o)&&(md=null,_d(r,o)),o=!1;var ne=zs;e:do try{if(Wr!==0&&ur!==null){var Ae=ur,lt=xo;switch(Wr){case 8:Np(),ne=6;break e;case 3:case 2:case 9:case 6:Bn.current===null&&(o=!0);var Vt=Wr;if(Wr=0,xo=null,vd(r,Ae,lt,Vt),m&&Pu){ne=0;break e}break;default:Vt=Wr,Wr=0,xo=null,vd(r,Ae,lt,Vt)}}Pp(),ne=zs;break}catch(rn){V0(r,rn)}while(!0);return o&&r.shellSuspendCounter++,_l=Io=null,Vr=E,Te.H=L,Te.A=V,ur===null&&(ls=null,hr=0,Vc()),ne}function Pp(){for(;ur!==null;)om(ur)}function bd(r,o){var m=Vr;Vr|=2;var E=Mh(),L=Dp();ls!==r||hr!==o?(md=null,yf=Pi()+500,_d(r,o)):Pu=Qn(r,o);e:do try{if(Wr!==0&&ur!==null){o=ur;var V=xo;t:switch(Wr){case 1:Wr=0,xo=null,vd(r,o,V,1);break;case 2:case 9:if(uh(V)){Wr=0,xo=null,lm(o);break}o=function(){Wr!==2&&Wr!==9||ls!==r||(Wr=7),rc(r)},V.then(o,o);break e;case 3:Wr=7;break e;case 4:Wr=5;break e;case 7:uh(V)?(Wr=0,xo=null,lm(o)):(Wr=0,xo=null,vd(r,o,V,7));break;case 5:var ne=null;switch(ur.tag){case 26:ne=ur.memoizedState;case 5:case 27:var Ae=ur;if(ne?kf(ne):Ae.stateNode.complete){Wr=0,xo=null;var lt=Ae.sibling;if(lt!==null)ur=lt;else{var Vt=Ae.return;Vt!==null?(ur=Vt,Op(Vt)):ur=null}break t}}Wr=0,xo=null,vd(r,o,V,5);break;case 6:Wr=0,xo=null,vd(r,o,V,6);break;case 8:Np(),zs=6;break e;default:throw Error(C(462))}}am();break}catch(rn){V0(r,rn)}while(!0);return _l=Io=null,Te.H=E,Te.A=L,Vr=m,ur!==null?0:(ls=null,hr=0,Vc(),zs)}function am(){for(;ur!==null&&!Li();)om(ur)}function om(r){var o=Ya(r.alternate,r,su);r.memoizedProps=r.pendingProps,o===null?Op(r):ur=o}function lm(r){var o=r,m=o.alternate;switch(o.tag){case 15:case 0:o=Hg(m,o,o.pendingProps,o.type,void 0,hr);break;case 11:o=Hg(m,o,o.pendingProps,o.type.render,o.ref,hr);break;case 5:Jl(o);default:wp(m,o),o=ur=lp(o,su),o=Ya(m,o,su)}r.memoizedProps=r.pendingProps,o===null?Op(r):ur=o}function vd(r,o,m,E){_l=Io=null,Jl(o),wl=null,Zc=0;var L=o.return;try{if(dp(r,L,o,m,hr)){zs=1,tl(r,Fa(m,r.current)),ur=null;return}}catch(V){if(L!==null)throw ur=L,V;zs=1,tl(r,Fa(m,r.current)),ur=null;return}o.flags&32768?(tr||E===1?r=!0:Pu||(hr&536870912)!==0?r=!1:(kl=r=!0,(E===2||E===9||E===3||E===6)&&(E=Bn.current,E!==null&&E.tag===13&&(E.flags|=16384))),cm(o,r)):Op(o)}function Op(r){var o=r;do{if((o.flags&32768)!==0){cm(o,kl);return}r=o.return;var m=Wg(o.alternate,o,su);if(m!==null){ur=m;return}if(o=o.sibling,o!==null){ur=o;return}ur=o=r}while(o!==null);zs===0&&(zs=5)}function cm(r,o){do{var m=P1(r.alternate,r);if(m!==null){m.flags&=32767,ur=m;return}if(m=r.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!o&&(r=r.sibling,r!==null)){ur=r;return}ur=r=m}while(r!==null);zs=6,ur=null}function um(r,o,m,E,L,V,ne,Ae,lt){r.cancelPendingCommit=null;do zp();while(ca!==0);if((Vr&6)!==0)throw Error(C(327));if(o!==null){if(o===r.current)throw Error(C(177));if(V=o.lanes|o.childLanes,V|=Uc,ni(r,m,V,ne,Ae,lt),r===ls&&(ur=ls=null,hr=0),yd=o,lu=r,Nl=m,j0=V,kp=L,rm=E,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,mm(ce,function(){return gm(),null})):(r.callbackNode=null,r.callbackPriority=0),E=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||E){E=Te.T,Te.T=null,L=We.p,We.p=2,ne=Vr,Vr|=4;try{O1(r,o,m)}finally{Vr=ne,We.p=L,Te.T=E}}ca=1,hm(),dm(),fm()}}function hm(){if(ca===1){ca=0;var r=lu,o=yd,m=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||m){m=Te.T,Te.T=null;var E=We.p;We.p=2;var L=Vr;Vr|=4;try{Cp(o,r);var V=ng,ne=ue(r.containerInfo),Ae=V.focusedElem,lt=V.selectionRange;if(ne!==Ae&&Ae&&Ae.ownerDocument&&te(Ae.ownerDocument.documentElement,Ae)){if(lt!==null&&xe(Ae)){var Vt=lt.start,rn=lt.end;if(rn===void 0&&(rn=Vt),"selectionStart"in Ae)Ae.selectionStart=Vt,Ae.selectionEnd=Math.min(rn,Ae.value.length);else{var pn=Ae.ownerDocument||document,Ht=pn&&pn.defaultView||window;if(Ht.getSelection){var Yt=Ht.getSelection(),di=Ae.textContent.length,Ii=Math.min(lt.start,di),Yr=lt.end===void 0?Ii:Math.min(lt.end,di);!Yt.extend&&Ii>Yr&&(ne=Yr,Yr=Ii,Ii=ne);var Tt=q(Ae,Ii),ft=q(Ae,Yr);if(Tt&&ft&&(Yt.rangeCount!==1||Yt.anchorNode!==Tt.node||Yt.anchorOffset!==Tt.offset||Yt.focusNode!==ft.node||Yt.focusOffset!==ft.offset)){var Ft=pn.createRange();Ft.setStart(Tt.node,Tt.offset),Yt.removeAllRanges(),Ii>Yr?(Yt.addRange(Ft),Yt.extend(ft.node,ft.offset)):(Ft.setEnd(ft.node,ft.offset),Yt.addRange(Ft))}}}}for(pn=[],Yt=Ae;Yt=Yt.parentNode;)Yt.nodeType===1&&pn.push({element:Yt,left:Yt.scrollLeft,top:Yt.scrollTop});for(typeof Ae.focus=="function"&&Ae.focus(),Ae=0;Ae<pn.length;Ae++){var hn=pn[Ae];hn.element.scrollLeft=hn.left,hn.element.scrollTop=hn.top}}Of=!!Sf,ng=Sf=null}finally{Vr=L,We.p=E,Te.T=m}}r.current=o,ca=2}}function dm(){if(ca===2){ca=0;var r=lu,o=yd,m=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||m){m=Te.T,Te.T=null;var E=We.p;We.p=2;var L=Vr;Vr|=4;try{P0(r,o.alternate,o)}finally{Vr=L,We.p=E,Te.T=m}}ca=3}}function fm(){if(ca===4||ca===3){ca=0,Ki();var r=lu,o=yd,m=Nl,E=rm;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?ca=5:(ca=0,yd=lu=null,pm(r,r.pendingLanes));var L=r.pendingLanes;if(L===0&&(ou=null),Jt(m),o=o.stateNode,de&&typeof de.onCommitFiberRoot=="function")try{de.onCommitFiberRoot(rt,o,void 0,(o.current.flags&128)===128)}catch{}if(E!==null){o=Te.T,L=We.p,We.p=2,Te.T=null;try{for(var V=r.onRecoverableError,ne=0;ne<E.length;ne++){var Ae=E[ne];V(Ae.value,{componentStack:Ae.stack})}}finally{Te.T=o,We.p=L}}(Nl&3)!==0&&zp(),rc(r),L=r.pendingLanes,(m&261930)!==0&&(L&42)!==0?r===U0?xf++:(xf=0,U0=r):xf=0,il(0)}}function pm(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,Su(o)))}function zp(){return hm(),dm(),fm(),gm()}function gm(){if(ca!==5)return!1;var r=lu,o=j0;j0=0;var m=Jt(Nl),E=Te.T,L=We.p;try{We.p=32>m?32:m,Te.T=null,m=kp,kp=null;var V=lu,ne=Nl;if(ca=0,yd=lu=null,Nl=0,(Vr&6)!==0)throw Error(C(331));var Ae=Vr;if(Vr|=4,tm(V.current),z0(V,V.current,ne,m),Vr=Ae,il(0,!1),de&&typeof de.onPostCommitFiberRoot=="function")try{de.onPostCommitFiberRoot(rt,V)}catch{}return!0}finally{We.p=L,Te.T=E,pm(r,o)}}function H0(r,o,m){o=Fa(m,o),o=vh(r.stateNode,o,2),r=Yl(r,o,2),r!==null&&(Mi(r,2),rc(r))}function Gr(r,o,m){if(r.tag===3)H0(r,r,m);else for(;o!==null;){if(o.tag===3){H0(o,r,m);break}else if(o.tag===1){var E=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof E.componentDidCatch=="function"&&(ou===null||!ou.has(E))){r=Fa(m,r),m=wh(2),E=Yl(o,m,2),E!==null&&(Ah(m,E,o,r),Mi(E,2),rc(E));break}}o=o.return}}function Lp(r,o,m){var E=r.pingCache;if(E===null){E=r.pingCache=new nm;var L=new Set;E.set(o,L)}else L=E.get(o),L===void 0&&(L=new Set,E.set(o,L));L.has(m)||(L0=!0,L.add(m),r=zu.bind(null,r,o,m),o.then(r,r))}function zu(r,o,m){var E=r.pingCache;E!==null&&E.delete(o),r.pingedLanes|=r.suspendedLanes&m,r.warmLanes&=~m,ls===r&&(hr&m)===m&&(zs===4||zs===3&&(hr&62914560)===hr&&300>Pi()-Mp?(Vr&2)===0&&_d(r,0):B0|=m,Ih===hr&&(Ih=0)),rc(r)}function vf(r,o){o===0&&(o=Jn()),r=To(r,o),r!==null&&(Mi(r,o),rc(r))}function q0(r){var o=r.memoizedState,m=0;o!==null&&(m=o.retryLane),vf(r,m)}function B1(r,o){var m=0;switch(r.tag){case 31:case 13:var E=r.stateNode,L=r.memoizedState;L!==null&&(m=L.retryLane);break;case 19:E=r.stateNode;break;case 22:E=r.stateNode._retryCache;break;default:throw Error(C(314))}E!==null&&E.delete(o),vf(r,m)}function mm(r,o){return vi(r,o)}var Bp=null,wd=null,Z0=!1,Fp=!1,X0=!1,cu=0;function rc(r){r!==wd&&r.next===null&&(wd===null?Bp=wd=r:wd=wd.next=r),Fp=!0,Z0||(Z0=!0,Y0())}function il(r,o){if(!X0&&Fp){X0=!0;do for(var m=!1,E=Bp;E!==null;){if(r!==0){var L=E.pendingLanes;if(L===0)var V=0;else{var ne=E.suspendedLanes,Ae=E.pingedLanes;V=(1<<31-yt(42|r)+1)-1,V&=L&~(ne&~Ae),V=V&201326741?V&201326741|1:V?V|2:0}V!==0&&(m=!0,wf(E,V))}else V=hr,V=ai(E,E===ls?V:0,E.cancelPendingCommit!==null||E.timeoutHandle!==-1),(V&3)===0||Qn(E,V)||(m=!0,wf(E,V));E=E.next}while(m);X0=!1}}function Lu(){W0()}function W0(){Fp=Z0=!1;var r=0;cu!==0&&Yp()&&(r=cu);for(var o=Pi(),m=null,E=Bp;E!==null;){var L=E.next,V=jp(E,o);V===0?(E.next=null,m===null?Bp=L:m.next=L,L===null&&(wd=m)):(m=E,(r!==0||(V&3)!==0)&&(Fp=!0)),E=L}ca!==0&&ca!==5||il(r),cu!==0&&(cu=0)}function jp(r,o){for(var m=r.suspendedLanes,E=r.pingedLanes,L=r.expirationTimes,V=r.pendingLanes&-62914561;0<V;){var ne=31-yt(V),Ae=1<<ne,lt=L[ne];lt===-1?((Ae&m)===0||(Ae&E)!==0)&&(L[ne]=Kn(Ae,o)):lt<=o&&(r.expiredLanes|=Ae),V&=~Ae}if(o=ls,m=hr,m=ai(r,r===o?m:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),E=r.callbackNode,m===0||r===o&&(Wr===2||Wr===9)||r.cancelPendingCommit!==null)return E!==null&&E!==null&&nn(E),r.callbackNode=null,r.callbackPriority=0;if((m&3)===0||Qn(r,m)){if(o=m&-m,o===r.callbackPriority)return o;switch(E!==null&&nn(E),Jt(m)){case 2:case 8:m=oe;break;case 32:m=ce;break;case 268435456:m=je;break;default:m=ce}return E=ym.bind(null,r),m=vi(m,E),r.callbackPriority=o,r.callbackNode=m,o}return E!==null&&E!==null&&nn(E),r.callbackPriority=2,r.callbackNode=null,2}function ym(r,o){if(ca!==0&&ca!==5)return r.callbackNode=null,r.callbackPriority=0,null;var m=r.callbackNode;if(zp()&&r.callbackNode!==m)return null;var E=hr;return E=ai(r,r===ls?E:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),E===0?null:(ea(r,E,o),jp(r,Pi()),r.callbackNode!=null&&r.callbackNode===m?ym.bind(null,r):null)}function wf(r,o){if(zp())return null;ea(r,o,!0)}function Y0(){ag(function(){(Vr&6)!==0?vi(gt,Lu):W0()})}function $0(){if(cu===0){var r=qc;r===0&&(r=_n,_n<<=1,(_n&261888)===0&&(_n=256)),cu=r}return cu}function Up(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Si(""+r)}function Vp(r,o){var m=o.ownerDocument.createElement("input");return m.name=o.name,m.value=o.value,r.id&&m.setAttribute("form",r.id),o.parentNode.insertBefore(m,o),r=new FormData(r),m.parentNode.removeChild(m),r}function Ad(r,o,m,E,L){if(o==="submit"&&m&&m.stateNode===L){var V=Up((L[ln]||null).action),ne=E.submitter;ne&&(o=(o=ne[ln]||null)?Up(o.formAction):ne.getAttribute("formAction"),o!==null&&(V=o,ne=null));var Ae=new ir("action","action",null,E,L);r.push({event:Ae,listeners:[{instance:null,listener:function(){if(E.defaultPrevented){if(cu!==0){var lt=ne?Vp(L,ne):new FormData(L);_s(m,{pending:!0,data:lt,method:L.method,action:V},null,lt)}}else typeof V=="function"&&(Ae.preventDefault(),lt=ne?Vp(L,ne):new FormData(L),_s(m,{pending:!0,data:lt,method:L.method,action:V},V,lt))},currentTarget:L}]})}}for(var Gp=0;Gp<bu.length;Gp++){var Hp=bu[Gp],Q0=Hp.toLowerCase(),xm=Hp[0].toUpperCase()+Hp.slice(1);oo(Q0,"on"+xm)}oo(xa,"onAnimationEnd"),oo(Vs,"onAnimationIteration"),oo(Ar,"onAnimationStart"),oo("dblclick","onDoubleClick"),oo("focusin","onFocus"),oo("focusout","onBlur"),oo(ss,"onTransitionRun"),oo(Qs,"onTransitionStart"),oo(ao,"onTransitionCancel"),oo(Gs,"onTransitionEnd"),Ri("onMouseEnter",["mouseout","mouseover"]),Ri("onMouseLeave",["mouseout","mouseover"]),Ri("onPointerEnter",["pointerout","pointerover"]),Ri("onPointerLeave",["pointerout","pointerover"]),En("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),En("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),En("onBeforeInput",["compositionend","keypress","textInput","paste"]),En("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),En("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),En("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_m=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Bu));function bm(r,o){o=(o&4)!==0;for(var m=0;m<r.length;m++){var E=r[m],L=E.event;E=E.listeners;e:{var V=void 0;if(o)for(var ne=E.length-1;0<=ne;ne--){var Ae=E[ne],lt=Ae.instance,Vt=Ae.currentTarget;if(Ae=Ae.listener,lt!==V&&L.isPropagationStopped())break e;V=Ae,L.currentTarget=Vt;try{V(L)}catch(rn){fl(rn)}L.currentTarget=null,V=lt}else for(ne=0;ne<E.length;ne++){if(Ae=E[ne],lt=Ae.instance,Vt=Ae.currentTarget,Ae=Ae.listener,lt!==V&&L.isPropagationStopped())break e;V=Ae,L.currentTarget=Vt;try{V(L)}catch(rn){fl(rn)}L.currentTarget=null,V=lt}}}}function dr(r,o){var m=o[mt];m===void 0&&(m=o[mt]=new Set);var E=r+"__bubble";m.has(E)||(Zp(o,r,2,!1),m.add(E))}function K0(r,o,m){var E=0;o&&(E|=4),Zp(m,r,E,o)}var qp="_reactListening"+Math.random().toString(36).slice(2);function J0(r){if(!r[qp]){r[qp]=!0,Ct.forEach(function(m){m!=="selectionchange"&&(_m.has(m)||K0(m,!1,r),K0(m,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[qp]||(o[qp]=!0,K0("selectionchange",!1,o))}}function Zp(r,o,m,E){switch(Dh(o)){case 2:var L=zf;break;case 8:L=Pm;break;default:L=_g}m=L.bind(null,o,m,r),L=void 0,!Ws||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(L=!0),E?L!==void 0?r.addEventListener(o,m,{capture:!0,passive:L}):r.addEventListener(o,m,!0):L!==void 0?r.addEventListener(o,m,{passive:L}):r.addEventListener(o,m,!1)}function Nc(r,o,m,E,L){var V=E;if((o&1)===0&&(o&2)===0&&E!==null)e:for(;;){if(E===null)return;var ne=E.tag;if(ne===3||ne===4){var Ae=E.stateNode.containerInfo;if(Ae===L)break;if(ne===4)for(ne=E.return;ne!==null;){var lt=ne.tag;if((lt===3||lt===4)&&ne.stateNode.containerInfo===L)return;ne=ne.return}for(;Ae!==null;){if(ne=Hn(Ae),ne===null)return;if(lt=ne.tag,lt===5||lt===6||lt===26||lt===27){E=V=ne;continue e}Ae=Ae.parentNode}}E=E.return}_r(function(){var Vt=V,rn=ul(m),pn=[];e:{var Ht=sh.get(r);if(Ht!==void 0){var Yt=ir,di=r;switch(r){case"keypress":if(ys(m)===0)break e;case"keydown":case"keyup":Yt=br;break;case"focusin":di="focus",Yt=Ui;break;case"focusout":di="blur",Yt=Ui;break;case"beforeblur":case"afterblur":Yt=Ui;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Yt=et;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Yt=Mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Yt=ih;break;case xa:case Vs:case Ar:Yt=hi;break;case Gs:Yt=Ua;break;case"scroll":case"scrollend":Yt=So;break;case"wheel":Yt=dc;break;case"copy":case"cut":case"paste":Yt=ya;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Yt=Wi;break;case"toggle":case"beforetoggle":Yt=Co}var Ii=(o&4)!==0,Yr=!Ii&&(r==="scroll"||r==="scrollend"),Tt=Ii?Ht!==null?Ht+"Capture":null:Ht;Ii=[];for(var ft=Vt,Ft;ft!==null;){var hn=ft;if(Ft=hn.stateNode,hn=hn.tag,hn!==5&&hn!==26&&hn!==27||Ft===null||Tt===null||(hn=Ci(ft,Tt),hn!=null&&Ii.push(Ed(ft,hn,Ft))),Yr)break;ft=ft.return}0<Ii.length&&(Ht=new Yt(Ht,di,null,m,rn),pn.push({event:Ht,listeners:Ii}))}}if((o&7)===0){e:{if(Ht=r==="mouseover"||r==="pointerover",Yt=r==="mouseout"||r==="pointerout",Ht&&m!==Ll&&(di=m.relatedTarget||m.fromElement)&&(Hn(di)||di[Ue]))break e;if((Yt||Ht)&&(Ht=rn.window===rn?rn:(Ht=rn.ownerDocument)?Ht.defaultView||Ht.parentWindow:window,Yt?(di=m.relatedTarget||m.toElement,Yt=Vt,di=di?Hn(di):null,di!==null&&(Yr=P(di),Ii=di.tag,di!==Yr||Ii!==5&&Ii!==27&&Ii!==6)&&(di=null)):(Yt=null,di=Vt),Yt!==di)){if(Ii=et,hn="onMouseLeave",Tt="onMouseEnter",ft="mouse",(r==="pointerout"||r==="pointerover")&&(Ii=Wi,hn="onPointerLeave",Tt="onPointerEnter",ft="pointer"),Yr=Yt==null?Ht:ki(Yt),Ft=di==null?Ht:ki(di),Ht=new Ii(hn,ft+"leave",Yt,m,rn),Ht.target=Yr,Ht.relatedTarget=Ft,hn=null,Hn(rn)===Vt&&(Ii=new Ii(Tt,ft+"enter",di,m,rn),Ii.target=Ft,Ii.relatedTarget=Yr,hn=Ii),Yr=hn,Yt&&di)t:{for(Ii=vm,Tt=Yt,ft=di,Ft=0,hn=Tt;hn;hn=Ii(hn))Ft++;hn=0;for(var Ti=ft;Ti;Ti=Ii(Ti))hn++;for(;0<Ft-hn;)Tt=Ii(Tt),Ft--;for(;0<hn-Ft;)ft=Ii(ft),hn--;for(;Ft--;){if(Tt===ft||ft!==null&&Tt===ft.alternate){Ii=Tt;break t}Tt=Ii(Tt),ft=Ii(ft)}Ii=null}else Ii=null;Yt!==null&&eg(pn,Ht,Yt,Ii,!1),di!==null&&Yr!==null&&eg(pn,Yr,di,Ii,!0)}}e:{if(Ht=Vt?ki(Vt):window,Yt=Ht.nodeName&&Ht.nodeName.toLowerCase(),Yt==="select"||Yt==="input"&&Ht.type==="file")var Or=$s;else if(jc(Ht))if(rh)Or=v;else{Or=u;var fi=a}else Yt=Ht.nodeName,!Yt||Yt.toLowerCase()!=="input"||Ht.type!=="checkbox"&&Ht.type!=="radio"?Vt&&fr(Vt.elementType)&&(Or=$s):Or=g;if(Or&&(Or=Or(r,Vt))){La(pn,Or,m,rn);break e}fi&&fi(r,Ht,Vt),r==="focusout"&&Vt&&Ht.type==="number"&&Vt.memoizedProps.value!=null&&De(Ht,"number",Ht.value)}switch(fi=Vt?ki(Vt):window,r){case"focusin":(jc(fi)||fi.contentEditable==="true")&&(ot=fi,ht=Vt,Dt=null);break;case"focusout":Dt=ht=ot=null;break;case"mousedown":qt=!0;break;case"contextmenu":case"mouseup":case"dragend":qt=!1,Sn(pn,m,rn);break;case"selectionchange":if(ze)break;case"keydown":case"keyup":Sn(pn,m,rn)}var Ai;if(Kr)e:{switch(r){case"compositionstart":var or="onCompositionStart";break e;case"compositionend":or="onCompositionEnd";break e;case"compositionupdate":or="onCompositionUpdate";break e}or=void 0}else ro?Bc(r,m)&&(or="onCompositionEnd"):r==="keydown"&&m.keyCode===229&&(or="onCompositionStart");or&&(fc&&m.locale!=="ko"&&(ro||or!=="onCompositionStart"?or==="onCompositionEnd"&&ro&&(Ai=ma()):(Ys=rn,Us="value"in Ys?Ys.value:Ys.textContent,ro=!0)),fi=Af(Vt,or),0<fi.length&&(or=new qo(or,r,null,m,rn),pn.push({event:or,listeners:fi}),Ai?or.data=Ai:(Ai=pc(m),Ai!==null&&(or.data=Ai)))),(Ai=Fl?so(r,m):Fc(r,m))&&(or=Af(Vt,"onBeforeInput"),0<or.length&&(fi=new qo("onBeforeInput","beforeinput",null,m,rn),pn.push({event:fi,listeners:or}),fi.data=Ai)),Ad(pn,r,Vt,m,rn)}bm(pn,o)})}function Ed(r,o,m){return{instance:r,listener:o,currentTarget:m}}function Af(r,o){for(var m=o+"Capture",E=[];r!==null;){var L=r,V=L.stateNode;if(L=L.tag,L!==5&&L!==26&&L!==27||V===null||(L=Ci(r,m),L!=null&&E.unshift(Ed(r,L,V)),L=Ci(r,o),L!=null&&E.push(Ed(r,L,V))),r.tag===3)return E;r=r.return}return[]}function vm(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function eg(r,o,m,E,L){for(var V=o._reactName,ne=[];m!==null&&m!==E;){var Ae=m,lt=Ae.alternate,Vt=Ae.stateNode;if(Ae=Ae.tag,lt!==null&&lt===E)break;Ae!==5&&Ae!==26&&Ae!==27||Vt===null||(lt=Vt,L?(Vt=Ci(m,V),Vt!=null&&ne.unshift(Ed(m,Vt,lt))):L||(Vt=Ci(m,V),Vt!=null&&ne.push(Ed(m,Vt,lt)))),m=m.return}ne.length!==0&&r.push({event:o,listeners:ne})}var wm=/\r\n?/g,Am=/\u0000|\uFFFD/g;function Ef(r){return(typeof r=="string"?r:""+r).replace(wm,`
`).replace(Am,"")}function tg(r,o){return o=Ef(o),Ef(r)===o}function Pr(r,o,m,E,L,V){switch(m){case"children":typeof E=="string"?o==="body"||o==="textarea"&&E===""||Da(r,E):(typeof E=="number"||typeof E=="bigint")&&o!=="body"&&Da(r,""+E);break;case"className":Xr(r,"class",E);break;case"tabIndex":Xr(r,"tabindex",E);break;case"dir":case"role":case"viewBox":case"width":case"height":Xr(r,m,E);break;case"style":mi(r,E,V);break;case"data":if(o!=="object"){Xr(r,"data",E);break}case"src":case"href":if(E===""&&(o!=="a"||m!=="href")){r.removeAttribute(m);break}if(E==null||typeof E=="function"||typeof E=="symbol"||typeof E=="boolean"){r.removeAttribute(m);break}E=Si(""+E),r.setAttribute(m,E);break;case"action":case"formAction":if(typeof E=="function"){r.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof V=="function"&&(m==="formAction"?(o!=="input"&&Pr(r,o,"name",L.name,L,null),Pr(r,o,"formEncType",L.formEncType,L,null),Pr(r,o,"formMethod",L.formMethod,L,null),Pr(r,o,"formTarget",L.formTarget,L,null)):(Pr(r,o,"encType",L.encType,L,null),Pr(r,o,"method",L.method,L,null),Pr(r,o,"target",L.target,L,null)));if(E==null||typeof E=="symbol"||typeof E=="boolean"){r.removeAttribute(m);break}E=Si(""+E),r.setAttribute(m,E);break;case"onClick":E!=null&&(r.onclick=Xs);break;case"onScroll":E!=null&&dr("scroll",r);break;case"onScrollEnd":E!=null&&dr("scrollend",r);break;case"dangerouslySetInnerHTML":if(E!=null){if(typeof E!="object"||!("__html"in E))throw Error(C(61));if(m=E.__html,m!=null){if(L.children!=null)throw Error(C(60));r.innerHTML=m}}break;case"multiple":r.multiple=E&&typeof E!="function"&&typeof E!="symbol";break;case"muted":r.muted=E&&typeof E!="function"&&typeof E!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(E==null||typeof E=="function"||typeof E=="boolean"||typeof E=="symbol"){r.removeAttribute("xlink:href");break}m=Si(""+E),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":E!=null&&typeof E!="function"&&typeof E!="symbol"?r.setAttribute(m,""+E):r.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":E&&typeof E!="function"&&typeof E!="symbol"?r.setAttribute(m,""):r.removeAttribute(m);break;case"capture":case"download":E===!0?r.setAttribute(m,""):E!==!1&&E!=null&&typeof E!="function"&&typeof E!="symbol"?r.setAttribute(m,E):r.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":E!=null&&typeof E!="function"&&typeof E!="symbol"&&!isNaN(E)&&1<=E?r.setAttribute(m,E):r.removeAttribute(m);break;case"rowSpan":case"start":E==null||typeof E=="function"||typeof E=="symbol"||isNaN(E)?r.removeAttribute(m):r.setAttribute(m,E);break;case"popover":dr("beforetoggle",r),dr("toggle",r),us(r,"popover",E);break;case"xlinkActuate":ci(r,"http://www.w3.org/1999/xlink","xlink:actuate",E);break;case"xlinkArcrole":ci(r,"http://www.w3.org/1999/xlink","xlink:arcrole",E);break;case"xlinkRole":ci(r,"http://www.w3.org/1999/xlink","xlink:role",E);break;case"xlinkShow":ci(r,"http://www.w3.org/1999/xlink","xlink:show",E);break;case"xlinkTitle":ci(r,"http://www.w3.org/1999/xlink","xlink:title",E);break;case"xlinkType":ci(r,"http://www.w3.org/1999/xlink","xlink:type",E);break;case"xmlBase":ci(r,"http://www.w3.org/XML/1998/namespace","xml:base",E);break;case"xmlLang":ci(r,"http://www.w3.org/XML/1998/namespace","xml:lang",E);break;case"xmlSpace":ci(r,"http://www.w3.org/XML/1998/namespace","xml:space",E);break;case"is":us(r,"is",E);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=Ao.get(m)||m,us(r,m,E))}}function Xp(r,o,m,E,L,V){switch(m){case"style":mi(r,E,V);break;case"dangerouslySetInnerHTML":if(E!=null){if(typeof E!="object"||!("__html"in E))throw Error(C(61));if(m=E.__html,m!=null){if(L.children!=null)throw Error(C(60));r.innerHTML=m}}break;case"children":typeof E=="string"?Da(r,E):(typeof E=="number"||typeof E=="bigint")&&Da(r,""+E);break;case"onScroll":E!=null&&dr("scroll",r);break;case"onScrollEnd":E!=null&&dr("scrollend",r);break;case"onClick":E!=null&&(r.onclick=Xs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Zn.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(L=m.endsWith("Capture"),o=m.slice(2,L?m.length-7:void 0),V=r[ln]||null,V=V!=null?V[m]:null,typeof V=="function"&&r.removeEventListener(o,V,L),typeof E=="function")){typeof V!="function"&&V!==null&&(m in r?r[m]=null:r.hasAttribute(m)&&r.removeAttribute(m)),r.addEventListener(o,E,L);break e}m in r?r[m]=E:E===!0?r.setAttribute(m,""):us(r,m,E)}}}function wa(r,o,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dr("error",r),dr("load",r);var E=!1,L=!1,V;for(V in m)if(m.hasOwnProperty(V)){var ne=m[V];if(ne!=null)switch(V){case"src":E=!0;break;case"srcSet":L=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(C(137,o));default:Pr(r,o,V,ne,m,null)}}L&&Pr(r,o,"srcSet",m.srcSet,m,null),E&&Pr(r,o,"src",m.src,m,null);return;case"input":dr("invalid",r);var Ae=V=ne=L=null,lt=null,Vt=null;for(E in m)if(m.hasOwnProperty(E)){var rn=m[E];if(rn!=null)switch(E){case"name":L=rn;break;case"type":ne=rn;break;case"checked":lt=rn;break;case"defaultChecked":Vt=rn;break;case"value":V=rn;break;case"defaultValue":Ae=rn;break;case"children":case"dangerouslySetInnerHTML":if(rn!=null)throw Error(C(137,o));break;default:Pr(r,o,E,rn,m,null)}}Rt(r,V,Ae,lt,Vt,ne,L,!1);return;case"select":dr("invalid",r),E=ne=V=null;for(L in m)if(m.hasOwnProperty(L)&&(Ae=m[L],Ae!=null))switch(L){case"value":V=Ae;break;case"defaultValue":ne=Ae;break;case"multiple":E=Ae;default:Pr(r,o,L,Ae,m,null)}o=V,m=ne,r.multiple=!!E,o!=null?oi(r,!!E,o,!1):m!=null&&oi(r,!!E,m,!0);return;case"textarea":dr("invalid",r),V=L=E=null;for(ne in m)if(m.hasOwnProperty(ne)&&(Ae=m[ne],Ae!=null))switch(ne){case"value":E=Ae;break;case"defaultValue":L=Ae;break;case"children":V=Ae;break;case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(C(91));break;default:Pr(r,o,ne,Ae,m,null)}Ns(r,E,L,V);return;case"option":for(lt in m)m.hasOwnProperty(lt)&&(E=m[lt],E!=null)&&(lt==="selected"?r.selected=E&&typeof E!="function"&&typeof E!="symbol":Pr(r,o,lt,E,m,null));return;case"dialog":dr("beforetoggle",r),dr("toggle",r),dr("cancel",r),dr("close",r);break;case"iframe":case"object":dr("load",r);break;case"video":case"audio":for(E=0;E<Bu.length;E++)dr(Bu[E],r);break;case"image":dr("error",r),dr("load",r);break;case"details":dr("toggle",r);break;case"embed":case"source":case"link":dr("error",r),dr("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Vt in m)if(m.hasOwnProperty(Vt)&&(E=m[Vt],E!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":throw Error(C(137,o));default:Pr(r,o,Vt,E,m,null)}return;default:if(fr(o)){for(rn in m)m.hasOwnProperty(rn)&&(E=m[rn],E!==void 0&&Xp(r,o,rn,E,m,void 0));return}}for(Ae in m)m.hasOwnProperty(Ae)&&(E=m[Ae],E!=null&&Pr(r,o,Ae,E,m,null))}function Em(r,o,m,E){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var L=null,V=null,ne=null,Ae=null,lt=null,Vt=null,rn=null;for(Yt in m){var pn=m[Yt];if(m.hasOwnProperty(Yt)&&pn!=null)switch(Yt){case"checked":break;case"value":break;case"defaultValue":lt=pn;default:E.hasOwnProperty(Yt)||Pr(r,o,Yt,null,E,pn)}}for(var Ht in E){var Yt=E[Ht];if(pn=m[Ht],E.hasOwnProperty(Ht)&&(Yt!=null||pn!=null))switch(Ht){case"type":V=Yt;break;case"name":L=Yt;break;case"checked":Vt=Yt;break;case"defaultChecked":rn=Yt;break;case"value":ne=Yt;break;case"defaultValue":Ae=Yt;break;case"children":case"dangerouslySetInnerHTML":if(Yt!=null)throw Error(C(137,o));break;default:Yt!==pn&&Pr(r,o,Ht,Yt,E,pn)}}$r(r,ne,Ae,lt,Vt,rn,V,L);return;case"select":Yt=ne=Ae=Ht=null;for(V in m)if(lt=m[V],m.hasOwnProperty(V)&&lt!=null)switch(V){case"value":break;case"multiple":Yt=lt;default:E.hasOwnProperty(V)||Pr(r,o,V,null,E,lt)}for(L in E)if(V=E[L],lt=m[L],E.hasOwnProperty(L)&&(V!=null||lt!=null))switch(L){case"value":Ht=V;break;case"defaultValue":Ae=V;break;case"multiple":ne=V;default:V!==lt&&Pr(r,o,L,V,E,lt)}o=Ae,m=ne,E=Yt,Ht!=null?oi(r,!!m,Ht,!1):!!E!=!!m&&(o!=null?oi(r,!!m,o,!0):oi(r,!!m,m?[]:"",!1));return;case"textarea":Yt=Ht=null;for(Ae in m)if(L=m[Ae],m.hasOwnProperty(Ae)&&L!=null&&!E.hasOwnProperty(Ae))switch(Ae){case"value":break;case"children":break;default:Pr(r,o,Ae,null,E,L)}for(ne in E)if(L=E[ne],V=m[ne],E.hasOwnProperty(ne)&&(L!=null||V!=null))switch(ne){case"value":Ht=L;break;case"defaultValue":Yt=L;break;case"children":break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(C(91));break;default:L!==V&&Pr(r,o,ne,L,E,V)}ds(r,Ht,Yt);return;case"option":for(var di in m)Ht=m[di],m.hasOwnProperty(di)&&Ht!=null&&!E.hasOwnProperty(di)&&(di==="selected"?r.selected=!1:Pr(r,o,di,null,E,Ht));for(lt in E)Ht=E[lt],Yt=m[lt],E.hasOwnProperty(lt)&&Ht!==Yt&&(Ht!=null||Yt!=null)&&(lt==="selected"?r.selected=Ht&&typeof Ht!="function"&&typeof Ht!="symbol":Pr(r,o,lt,Ht,E,Yt));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ii in m)Ht=m[Ii],m.hasOwnProperty(Ii)&&Ht!=null&&!E.hasOwnProperty(Ii)&&Pr(r,o,Ii,null,E,Ht);for(Vt in E)if(Ht=E[Vt],Yt=m[Vt],E.hasOwnProperty(Vt)&&Ht!==Yt&&(Ht!=null||Yt!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":if(Ht!=null)throw Error(C(137,o));break;default:Pr(r,o,Vt,Ht,E,Yt)}return;default:if(fr(o)){for(var Yr in m)Ht=m[Yr],m.hasOwnProperty(Yr)&&Ht!==void 0&&!E.hasOwnProperty(Yr)&&Xp(r,o,Yr,void 0,E,Ht);for(rn in E)Ht=E[rn],Yt=m[rn],!E.hasOwnProperty(rn)||Ht===Yt||Ht===void 0&&Yt===void 0||Xp(r,o,rn,Ht,E,Yt);return}}for(var Tt in m)Ht=m[Tt],m.hasOwnProperty(Tt)&&Ht!=null&&!E.hasOwnProperty(Tt)&&Pr(r,o,Tt,null,E,Ht);for(pn in E)Ht=E[pn],Yt=m[pn],!E.hasOwnProperty(pn)||Ht===Yt||Ht==null&&Yt==null||Pr(r,o,pn,Ht,E,Yt)}function jo(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Sd(){if(typeof performance.getEntriesByType=="function"){for(var r=0,o=0,m=performance.getEntriesByType("resource"),E=0;E<m.length;E++){var L=m[E],V=L.transferSize,ne=L.initiatorType,Ae=L.duration;if(V&&Ae&&jo(ne)){for(ne=0,Ae=L.responseEnd,E+=1;E<m.length;E++){var lt=m[E],Vt=lt.startTime;if(Vt>Ae)break;var rn=lt.transferSize,pn=lt.initiatorType;rn&&jo(pn)&&(lt=lt.responseEnd,ne+=rn*(lt<Ae?1:(Ae-Vt)/(lt-Vt)))}if(--E,o+=8*(V+ne)/(L.duration/1e3),r++,10<r)break}}if(0<r)return o/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Sf=null,ng=null;function Cf(r){return r.nodeType===9?r:r.ownerDocument}function Fu(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ig(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function Wp(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var ju=null;function Yp(){var r=window.event;return r&&r.type==="popstate"?r===ju?!1:(ju=r,!0):(ju=null,!1)}var $p=typeof setTimeout=="function"?setTimeout:void 0,rg=typeof clearTimeout=="function"?clearTimeout:void 0,sg=typeof Promise=="function"?Promise:void 0,ag=typeof queueMicrotask=="function"?queueMicrotask:typeof sg<"u"?function(r){return sg.resolve(null).then(r).catch(og)}:$p;function og(r){setTimeout(function(){throw r})}function Uu(r){return r==="head"}function Sm(r,o){var m=o,E=0;do{var L=m.nextSibling;if(r.removeChild(m),L&&L.nodeType===8)if(m=L.data,m==="/$"||m==="/&"){if(E===0){r.removeChild(L),Xu(o);return}E--}else if(m==="$"||m==="$?"||m==="$~"||m==="$!"||m==="&")E++;else if(m==="html")Cd(r.ownerDocument.documentElement);else if(m==="head"){m=r.ownerDocument.head,Cd(m);for(var V=m.firstChild;V;){var ne=V.nextSibling,Ae=V.nodeName;V[fn]||Ae==="SCRIPT"||Ae==="STYLE"||Ae==="LINK"&&V.rel.toLowerCase()==="stylesheet"||m.removeChild(V),V=ne}}else m==="body"&&Cd(r.ownerDocument.body);m=L}while(m);Xu(o)}function qi(r,o){var m=r;r=0;do{var E=m.nextSibling;if(m.nodeType===1?o?(m._stashedDisplay=m.style.display,m.style.display="none"):(m.style.display=m._stashedDisplay||"",m.getAttribute("style")===""&&m.removeAttribute("style")):m.nodeType===3&&(o?(m._stashedText=m.nodeValue,m.nodeValue=""):m.nodeValue=m._stashedText||""),E&&E.nodeType===8)if(m=E.data,m==="/$"){if(r===0)break;r--}else m!=="$"&&m!=="$?"&&m!=="$~"&&m!=="$!"||r++;m=E}while(m)}function sc(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var m=o;switch(o=o.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":sc(m),Rn(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}r.removeChild(m)}}function Ia(r,o,m,E){for(;r.nodeType===1;){var L=m;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!E&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(E){if(!r[fn])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(V=r.getAttribute("rel"),V==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(V!==L.rel||r.getAttribute("href")!==(L.href==null||L.href===""?null:L.href)||r.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin)||r.getAttribute("title")!==(L.title==null?null:L.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(V=r.getAttribute("src"),(V!==(L.src==null?null:L.src)||r.getAttribute("type")!==(L.type==null?null:L.type)||r.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin))&&V&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var V=L.name==null?null:""+L.name;if(L.type==="hidden"&&r.getAttribute("name")===V)return r}else return r;if(r=rl(r.nextSibling),r===null)break}return null}function ac(r,o,m){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!m||(r=rl(r.nextSibling),r===null))return null;return r}function Vu(r,o){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!o||(r=rl(r.nextSibling),r===null))return null;return r}function $a(r){return r.data==="$?"||r.data==="$~"}function qs(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function ua(r,o){var m=r.ownerDocument;if(r.data==="$~")r._reactRetry=o;else if(r.data!=="$?"||m.readyState!=="loading")o();else{var E=function(){o(),m.removeEventListener("DOMContentLoaded",E)};m.addEventListener("DOMContentLoaded",E),r._reactRetry=E}}function rl(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return r}var _o=null;function ha(r){r=r.nextSibling;for(var o=0;r;){if(r.nodeType===8){var m=r.data;if(m==="/$"||m==="/&"){if(o===0)return rl(r.nextSibling);o--}else m!=="$"&&m!=="$!"&&m!=="$?"&&m!=="$~"&&m!=="&"||o++}r=r.nextSibling}return null}function Tf(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var m=r.data;if(m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"){if(o===0)return r;o--}else m!=="/$"&&m!=="/&"||o++}r=r.previousSibling}return null}function Cm(r,o,m){switch(o=Cf(m),r){case"html":if(r=o.documentElement,!r)throw Error(C(452));return r;case"head":if(r=o.head,!r)throw Error(C(453));return r;case"body":if(r=o.body,!r)throw Error(C(454));return r;default:throw Error(C(451))}}function Cd(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);Rn(r)}var Ma=new Map,kh=new Set;function Qp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Dc=We.d;We.d={f:Tm,r:Im,D:cg,C:Qa,L:oc,m:Ka,X:Kp,S:Hu,M:ug};function Tm(){var r=Dc.f(),o=_f();return r||o}function Im(r){var o=Fn(r);o!==null&&o.tag===5&&o.type==="form"?sa(o):Dc.r(r)}var Gu=typeof document>"u"?null:document;function lg(r,o,m){var E=Gu;if(E&&typeof o=="string"&&o){var L=Fi(o);L='link[rel="'+r+'"][href="'+L+'"]',typeof m=="string"&&(L+='[crossorigin="'+m+'"]'),kh.has(L)||(kh.add(L),r={rel:r,crossOrigin:m,href:o},E.querySelector(L)===null&&(o=E.createElement("link"),wa(o,"link",r),bi(o),E.head.appendChild(o)))}}function cg(r){Dc.D(r),lg("dns-prefetch",r,null)}function Qa(r,o){Dc.C(r,o),lg("preconnect",r,o)}function oc(r,o,m){Dc.L(r,o,m);var E=Gu;if(E&&r&&o){var L='link[rel="preload"][as="'+Fi(o)+'"]';o==="image"&&m&&m.imageSrcSet?(L+='[imagesrcset="'+Fi(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(L+='[imagesizes="'+Fi(m.imageSizes)+'"]')):L+='[href="'+Fi(r)+'"]';var V=L;switch(o){case"style":V=Nh(r);break;case"script":V=uu(r)}Ma.has(V)||(r=Q({rel:"preload",href:o==="image"&&m&&m.imageSrcSet?void 0:r,as:o},m),Ma.set(V,r),E.querySelector(L)!==null||o==="style"&&E.querySelector(Td(V))||o==="script"&&E.querySelector(Id(V))||(o=E.createElement("link"),wa(o,"link",r),bi(o),E.head.appendChild(o)))}}function Ka(r,o){Dc.m(r,o);var m=Gu;if(m&&r){var E=o&&typeof o.as=="string"?o.as:"script",L='link[rel="modulepreload"][as="'+Fi(E)+'"][href="'+Fi(r)+'"]',V=L;switch(E){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":V=uu(r)}if(!Ma.has(V)&&(r=Q({rel:"modulepreload",href:r},o),Ma.set(V,r),m.querySelector(L)===null)){switch(E){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(Id(V)))return}E=m.createElement("link"),wa(E,"link",r),bi(E),m.head.appendChild(E)}}}function Hu(r,o,m){Dc.S(r,o,m);var E=Gu;if(E&&r){var L=xi(E).hoistableStyles,V=Nh(r);o=o||"default";var ne=L.get(V);if(!ne){var Ae={loading:0,preload:null};if(ne=E.querySelector(Td(V)))Ae.loading=5;else{r=Q({rel:"stylesheet",href:r,"data-precedence":o},m),(m=Ma.get(V))&&If(r,m);var lt=ne=E.createElement("link");bi(lt),wa(lt,"link",r),lt._p=new Promise(function(Vt,rn){lt.onload=Vt,lt.onerror=rn}),lt.addEventListener("load",function(){Ae.loading|=1}),lt.addEventListener("error",function(){Ae.loading|=2}),Ae.loading|=4,hu(ne,o,E)}ne={type:"stylesheet",instance:ne,count:1,state:Ae},L.set(V,ne)}}}function Kp(r,o){Dc.X(r,o);var m=Gu;if(m&&r){var E=xi(m).hoistableScripts,L=uu(r),V=E.get(L);V||(V=m.querySelector(Id(L)),V||(r=Q({src:r,async:!0},o),(o=Ma.get(L))&&Jp(r,o),V=m.createElement("script"),bi(V),wa(V,"link",r),m.head.appendChild(V)),V={type:"script",instance:V,count:1,state:null},E.set(L,V))}}function ug(r,o){Dc.M(r,o);var m=Gu;if(m&&r){var E=xi(m).hoistableScripts,L=uu(r),V=E.get(L);V||(V=m.querySelector(Id(L)),V||(r=Q({src:r,async:!0,type:"module"},o),(o=Ma.get(L))&&Jp(r,o),V=m.createElement("script"),bi(V),wa(V,"link",r),m.head.appendChild(V)),V={type:"script",instance:V,count:1,state:null},E.set(L,V))}}function hg(r,o,m,E){var L=(L=Bt.current)?Qp(L):null;if(!L)throw Error(C(446));switch(r){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(o=Nh(m.href),m=xi(L).hoistableStyles,E=m.get(o),E||(E={type:"style",instance:null,count:0,state:null},m.set(o,E)),E):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){r=Nh(m.href);var V=xi(L).hoistableStyles,ne=V.get(r);if(ne||(L=L.ownerDocument||L,ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},V.set(r,ne),(V=L.querySelector(Td(r)))&&!V._p&&(ne.instance=V,ne.state.loading=5),Ma.has(r)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},Ma.set(r,m),V||fg(L,r,m,ne.state))),o&&E===null)throw Error(C(528,""));return ne}if(o&&E!==null)throw Error(C(529,""));return null;case"script":return o=m.async,m=m.src,typeof m=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=uu(m),m=xi(L).hoistableScripts,E=m.get(o),E||(E={type:"script",instance:null,count:0,state:null},m.set(o,E)),E):{type:"void",instance:null,count:0,state:null};default:throw Error(C(444,r))}}function Nh(r){return'href="'+Fi(r)+'"'}function Td(r){return'link[rel="stylesheet"]['+r+"]"}function dg(r){return Q({},r,{"data-precedence":r.precedence,precedence:null})}function fg(r,o,m,E){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?E.loading=1:(o=r.createElement("link"),E.preload=o,o.addEventListener("load",function(){return E.loading|=1}),o.addEventListener("error",function(){return E.loading|=2}),wa(o,"link",m),bi(o),r.head.appendChild(o))}function uu(r){return'[src="'+Fi(r)+'"]'}function Id(r){return"script[async]"+r}function pg(r,o,m){if(o.count++,o.instance===null)switch(o.type){case"style":var E=r.querySelector('style[data-href~="'+Fi(m.href)+'"]');if(E)return o.instance=E,bi(E),E;var L=Q({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return E=(r.ownerDocument||r).createElement("style"),bi(E),wa(E,"style",L),hu(E,m.precedence,r),o.instance=E;case"stylesheet":L=Nh(m.href);var V=r.querySelector(Td(L));if(V)return o.state.loading|=4,o.instance=V,bi(V),V;E=dg(m),(L=Ma.get(L))&&If(E,L),V=(r.ownerDocument||r).createElement("link"),bi(V);var ne=V;return ne._p=new Promise(function(Ae,lt){ne.onload=Ae,ne.onerror=lt}),wa(V,"link",E),o.state.loading|=4,hu(V,m.precedence,r),o.instance=V;case"script":return V=uu(m.src),(L=r.querySelector(Id(V)))?(o.instance=L,bi(L),L):(E=m,(L=Ma.get(V))&&(E=Q({},m),Jp(E,L)),r=r.ownerDocument||r,L=r.createElement("script"),bi(L),wa(L,"link",E),r.head.appendChild(L),o.instance=L);case"void":return null;default:throw Error(C(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(E=o.instance,o.state.loading|=4,hu(E,m.precedence,r));return o.instance}function hu(r,o,m){for(var E=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),L=E.length?E[E.length-1]:null,V=L,ne=0;ne<E.length;ne++){var Ae=E[ne];if(Ae.dataset.precedence===o)V=Ae;else if(V!==L)break}V?V.parentNode.insertBefore(r,V.nextSibling):(o=m.nodeType===9?m.head:m,o.insertBefore(r,o.firstChild))}function If(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function Jp(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var e0=null;function gg(r,o,m){if(e0===null){var E=new Map,L=e0=new Map;L.set(m,E)}else L=e0,E=L.get(m),E||(E=new Map,L.set(m,E));if(E.has(r))return E;for(E.set(r,null),m=m.getElementsByTagName(r),L=0;L<m.length;L++){var V=m[L];if(!(V[fn]||V[Zi]||r==="link"&&V.getAttribute("rel")==="stylesheet")&&V.namespaceURI!=="http://www.w3.org/2000/svg"){var ne=V.getAttribute(o)||"";ne=r+ne;var Ae=E.get(ne);Ae?Ae.push(V):E.set(ne,[V])}}return E}function Mf(r,o,m){r=r.ownerDocument||r,r.head.insertBefore(m,o==="title"?r.querySelector("head > title"):null)}function t0(r,o,m){if(m===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(r=o.disabled,typeof o.precedence=="string"&&r==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function kf(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function mg(r,o,m,E){if(m.type==="stylesheet"&&(typeof E.media!="string"||matchMedia(E.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var L=Nh(E.href),V=o.querySelector(Td(L));if(V){o=V._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(r.count++,r=Df.bind(r),o.then(r,r)),m.state.loading|=4,m.instance=V,bi(V);return}V=o.ownerDocument||o,E=dg(E),(L=Ma.get(L))&&If(E,L),V=V.createElement("link"),bi(V);var ne=V;ne._p=new Promise(function(Ae,lt){ne.onload=Ae,ne.onerror=lt}),wa(V,"link",E),m.instance=V}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(m,o),(o=m.state.preload)&&(m.state.loading&3)===0&&(r.count++,m=Df.bind(r),o.addEventListener("load",m),o.addEventListener("error",m))}}var Nf=0;function yg(r,o){return r.stylesheets&&r.count===0&&Pf(r,r.stylesheets),0<r.count||0<r.imgCount?function(m){var E=setTimeout(function(){if(r.stylesheets&&Pf(r,r.stylesheets),r.unsuspend){var V=r.unsuspend;r.unsuspend=null,V()}},6e4+o);0<r.imgBytes&&Nf===0&&(Nf=62500*Sd());var L=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Pf(r,r.stylesheets),r.unsuspend)){var V=r.unsuspend;r.unsuspend=null,V()}},(r.imgBytes>Nf?50:800)+o);return r.unsuspend=m,function(){r.unsuspend=null,clearTimeout(E),clearTimeout(L)}}:null}function Df(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Pf(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Rf=null;function Pf(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Rf=new Map,o.forEach(Mm,r),Rf=null,Df.call(r))}function Mm(r,o){if(!(o.state.loading&4)){var m=Rf.get(r);if(m)var E=m.get(null);else{m=new Map,Rf.set(r,m);for(var L=r.querySelectorAll("link[data-precedence],style[data-precedence]"),V=0;V<L.length;V++){var ne=L[V];(ne.nodeName==="LINK"||ne.getAttribute("media")!=="not all")&&(m.set(ne.dataset.precedence,ne),E=ne)}E&&m.set(null,E)}L=o.instance,ne=L.getAttribute("data-precedence"),V=m.get(ne)||E,V===E&&m.set(null,L),m.set(ne,L),this.count++,E=Df.bind(this),L.addEventListener("load",E),L.addEventListener("error",E),V?V.parentNode.insertBefore(L,V.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(L,r.firstChild)),o.state.loading|=4}}var Md={$$typeof:Ye,Provider:null,Consumer:null,_currentValue:wt,_currentValue2:wt,_threadCount:0};function F1(r,o,m,E,L,V,ne,Ae,lt){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=lr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lr(0),this.hiddenUpdates=lr(null),this.identifierPrefix=E,this.onUncaughtError=L,this.onCaughtError=V,this.onRecoverableError=ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=lt,this.incompleteTransitions=new Map}function xg(r,o,m,E,L,V,ne,Ae,lt,Vt,rn,pn){return r=new F1(r,o,m,ne,lt,Vt,rn,pn,Ae),o=1,V===!0&&(o|=24),V=lo(3,null,null,o),r.current=V,V.stateNode=r,o=vl(),o.refCount++,r.pooledCache=o,o.refCount++,V.memoizedState={element:E,isDehydrated:m,cache:o},ad(V),r}function km(r){return r?(r=Oi,r):Oi}function Nm(r,o,m,E,L,V){L=km(L),E.context===null?E.context=L:E.pendingContext=L,E=Cl(o),E.payload={element:m},V=V===void 0?null:V,V!==null&&(E.callback=V),m=Yl(r,E,o),m!==null&&(Fo(m,r,o),ko(m,r,o))}function n0(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var m=r.retryLane;r.retryLane=m!==0&&m<o?m:o}}function i0(r,o){n0(r,o),(r=r.alternate)&&n0(r,o)}function Dm(r){if(r.tag===13||r.tag===31){var o=To(r,67108864);o!==null&&Fo(o,r,67108864),i0(r,67108864)}}function Rm(r){if(r.tag===13||r.tag===31){var o=Bo();o=Cr(o);var m=To(r,o);m!==null&&Fo(m,r,o),i0(r,o)}}var Of=!0;function zf(r,o,m,E){var L=Te.T;Te.T=null;var V=We.p;try{We.p=2,_g(r,o,m,E)}finally{We.p=V,Te.T=L}}function Pm(r,o,m,E){var L=Te.T;Te.T=null;var V=We.p;try{We.p=8,_g(r,o,m,E)}finally{We.p=V,Te.T=L}}function _g(r,o,m,E){if(Of){var L=Lf(E);if(L===null)Nc(r,o,E,kd,m),Om(r,E);else if(U1(L,r,o,m,E))E.stopPropagation();else if(Om(r,E),o&4&&-1<j1.indexOf(r)){for(;L!==null;){var V=Fn(L);if(V!==null)switch(V.tag){case 3:if(V=V.stateNode,V.current.memoizedState.isDehydrated){var ne=ut(V.pendingLanes);if(ne!==0){var Ae=V;for(Ae.pendingLanes|=2,Ae.entangledLanes|=2;ne;){var lt=1<<31-yt(ne);Ae.entanglements[1]|=lt,ne&=~lt}rc(V),(Vr&6)===0&&(yf=Pi()+500,il(0))}}break;case 31:case 13:Ae=To(V,2),Ae!==null&&Fo(Ae,V,2),_f(),i0(V,2)}if(V=Lf(E),V===null&&Nc(r,o,E,kd,m),V===L)break;L=V}L!==null&&E.stopPropagation()}else Nc(r,o,E,null,m)}}function Lf(r){return r=ul(r),r0(r)}var kd=null;function r0(r){if(kd=null,r=Hn(r),r!==null){var o=P(r);if(o===null)r=null;else{var m=o.tag;if(m===13){if(r=N(o),r!==null)return r;r=null}else if(m===31){if(r=h(o),r!==null)return r;r=null}else if(m===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return kd=r,null}function Dh(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(xr()){case gt:return 2;case oe:return 8;case ce:case pe:return 32;case je:return 268435456;default:return 32}default:return 32}}var s0=!1,qu=null,Dl=null,Zu=null,Bf=new Map,Nd=new Map,du=[],j1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Om(r,o){switch(r){case"focusin":case"focusout":qu=null;break;case"dragenter":case"dragleave":Dl=null;break;case"mouseover":case"mouseout":Zu=null;break;case"pointerover":case"pointerout":Bf.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nd.delete(o.pointerId)}}function Ff(r,o,m,E,L,V){return r===null||r.nativeEvent!==V?(r={blockedOn:o,domEventName:m,eventSystemFlags:E,nativeEvent:V,targetContainers:[L]},o!==null&&(o=Fn(o),o!==null&&Dm(o)),r):(r.eventSystemFlags|=E,o=r.targetContainers,L!==null&&o.indexOf(L)===-1&&o.push(L),r)}function U1(r,o,m,E,L){switch(o){case"focusin":return qu=Ff(qu,r,o,m,E,L),!0;case"dragenter":return Dl=Ff(Dl,r,o,m,E,L),!0;case"mouseover":return Zu=Ff(Zu,r,o,m,E,L),!0;case"pointerover":var V=L.pointerId;return Bf.set(V,Ff(Bf.get(V)||null,r,o,m,E,L)),!0;case"gotpointercapture":return V=L.pointerId,Nd.set(V,Ff(Nd.get(V)||null,r,o,m,E,L)),!0}return!1}function zm(r){var o=Hn(r.target);if(o!==null){var m=P(o);if(m!==null){if(o=m.tag,o===13){if(o=N(m),o!==null){r.blockedOn=o,An(r.priority,function(){Rm(m)});return}}else if(o===31){if(o=h(m),o!==null){r.blockedOn=o,An(r.priority,function(){Rm(m)});return}}else if(o===3&&m.stateNode.current.memoizedState.isDehydrated){r.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}r.blockedOn=null}function jf(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var m=Lf(r.nativeEvent);if(m===null){m=r.nativeEvent;var E=new m.constructor(m.type,m);Ll=E,m.target.dispatchEvent(E),Ll=null}else return o=Fn(m),o!==null&&Dm(o),r.blockedOn=m,!1;o.shift()}return!0}function Lm(r,o,m){jf(r)&&m.delete(o)}function Uf(){s0=!1,qu!==null&&jf(qu)&&(qu=null),Dl!==null&&jf(Dl)&&(Dl=null),Zu!==null&&jf(Zu)&&(Zu=null),Bf.forEach(Lm),Nd.forEach(Lm)}function a0(r,o){r.blockedOn===o&&(r.blockedOn=null,s0||(s0=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,Uf)))}var o0=null;function Bm(r){o0!==r&&(o0=r,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){o0===r&&(o0=null);for(var o=0;o<r.length;o+=3){var m=r[o],E=r[o+1],L=r[o+2];if(typeof E!="function"){if(r0(E||m)===null)continue;break}var V=Fn(m);V!==null&&(r.splice(o,3),o-=3,_s(V,{pending:!0,data:L,method:m.method,action:E},E,L))}}))}function Xu(r){function o(lt){return a0(lt,r)}qu!==null&&a0(qu,r),Dl!==null&&a0(Dl,r),Zu!==null&&a0(Zu,r),Bf.forEach(o),Nd.forEach(o);for(var m=0;m<du.length;m++){var E=du[m];E.blockedOn===r&&(E.blockedOn=null)}for(;0<du.length&&(m=du[0],m.blockedOn===null);)zm(m),m.blockedOn===null&&du.shift();if(m=(r.ownerDocument||r).$$reactFormReplay,m!=null)for(E=0;E<m.length;E+=3){var L=m[E],V=m[E+1],ne=L[ln]||null;if(typeof V=="function")ne||Bm(m);else if(ne){var Ae=null;if(V&&V.hasAttribute("formAction")){if(L=V,ne=V[ln]||null)Ae=ne.formAction;else if(r0(L)!==null)continue}else Ae=ne.action;typeof Ae=="function"?m[E+1]=Ae:(m.splice(E,3),E-=3),Bm(m)}}}function bg(){function r(V){V.canIntercept&&V.info==="react-transition"&&V.intercept({handler:function(){return new Promise(function(ne){return L=ne})},focusReset:"manual",scroll:"manual"})}function o(){L!==null&&(L(),L=null),E||setTimeout(m,20)}function m(){if(!E&&!navigation.transition){var V=navigation.currentEntry;V&&V.url!=null&&navigation.navigate(V.url,{state:V.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var E=!1,L=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(m,100),function(){E=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),L!==null&&(L(),L=null)}}}function vg(r){this._internalRoot=r}l0.prototype.render=vg.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(C(409));var m=o.current,E=Bo();Nm(m,E,r,o,null,null)},l0.prototype.unmount=vg.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;Nm(r.current,2,null,r,null,null),_f(),o[Ue]=null}};function l0(r){this._internalRoot=r}l0.prototype.unstable_scheduleHydration=function(r){if(r){var o=gi();r={blockedOn:null,target:r,priority:o};for(var m=0;m<du.length&&o!==0&&o<du[m].priority;m++);du.splice(m,0,r),m===0&&zm(r)}};var wg=d.version;if(wg!=="19.2.3")throw Error(C(527,wg,"19.2.3"));We.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(C(188)):(r=Object.keys(r).join(","),Error(C(268,r)));return r=H(o),r=r!==null?Y(r):null,r=r===null?null:r.stateNode,r};var Fm={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Te,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var c0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!c0.isDisabled&&c0.supportsFiber)try{rt=c0.inject(Fm),de=c0}catch{}}return Ig.createRoot=function(r,o){if(!D(r))throw Error(C(299));var m=!1,E="",L=ud,V=ec,ne=tc;return o!=null&&(o.unstable_strictMode===!0&&(m=!0),o.identifierPrefix!==void 0&&(E=o.identifierPrefix),o.onUncaughtError!==void 0&&(L=o.onUncaughtError),o.onCaughtError!==void 0&&(V=o.onCaughtError),o.onRecoverableError!==void 0&&(ne=o.onRecoverableError)),o=xg(r,1,!1,null,null,m,E,null,L,V,ne,bg),r[Ue]=o.current,J0(r),new vg(o)},Ig.hydrateRoot=function(r,o,m){if(!D(r))throw Error(C(299));var E=!1,L="",V=ud,ne=ec,Ae=tc,lt=null;return m!=null&&(m.unstable_strictMode===!0&&(E=!0),m.identifierPrefix!==void 0&&(L=m.identifierPrefix),m.onUncaughtError!==void 0&&(V=m.onUncaughtError),m.onCaughtError!==void 0&&(ne=m.onCaughtError),m.onRecoverableError!==void 0&&(Ae=m.onRecoverableError),m.formState!==void 0&&(lt=m.formState)),o=xg(r,1,!0,o,m??null,E,L,lt,V,ne,Ae,bg),o.context=km(null),m=o.current,E=Bo(),E=Cr(E),L=Cl(E),L.callback=null,Yl(m,L,E),m=E,o.current.lanes=m,Mi(o,m),rc(o),r[Ue]=o.current,J0(r),new l0(o)},Ig.version="19.2.3",Ig}var Jx;function uw(){if(Jx)return J1.exports;Jx=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(d){console.error(d)}}return c(),J1.exports=cw(),J1.exports}var hw=uw();const dw=ap(hw),fw="modulepreload",pw=function(c){return"/parlens-pwa/"+c},e_={},e1=function(d,y,C){let D=Promise.resolve();if(y&&y.length>0){let H=function(Y){return Promise.all(Y.map(Q=>Promise.resolve(Q).then(_e=>({status:"fulfilled",value:_e}),_e=>({status:"rejected",reason:_e}))))};var N=H;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),U=h?.nonce||h?.getAttribute("nonce");D=H(y.map(Y=>{if(Y=pw(Y),Y in e_)return;e_[Y]=!0;const Q=Y.endsWith(".css"),_e=Q?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Y}"]${_e}`))return;const we=document.createElement("link");if(we.rel=Q?"stylesheet":fw,Q||(we.as="script"),we.crossOrigin="",we.href=Y,U&&we.setAttribute("nonce",U),document.head.appendChild(we),Q)return new Promise((ve,me)=>{we.addEventListener("load",ve),we.addEventListener("error",()=>me(new Error(`Unable to preload CSS for ${Y}`)))})}))}function P(h){const U=new Event("vite:preloadError",{cancelable:!0});if(U.payload=h,window.dispatchEvent(U),!U.defaultPrevented)throw h}return D.then(h=>{for(const U of h||[])U.status==="rejected"&&P(U.reason);return d().catch(P)})};function t_(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`Wrong positive integer: ${c}`)}function pb(c,...d){if(!(c instanceof Uint8Array))throw new Error("Expected Uint8Array");if(d.length>0&&!d.includes(c.length))throw new Error(`Expected Uint8Array of length ${d}, not of length=${c.length}`)}function gw(c){if(typeof c!="function"||typeof c.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");t_(c.outputLen),t_(c.blockLen)}function t1(c,d=!0){if(c.destroyed)throw new Error("Hash instance has been destroyed");if(d&&c.finished)throw new Error("Hash#digest() has already been called")}function mw(c,d){pb(c);const y=d.outputLen;if(c.length<y)throw new Error(`digestInto() expects output buffer of length at least ${y}`)}const iy=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const gb=c=>c instanceof Uint8Array,ry=c=>new DataView(c.buffer,c.byteOffset,c.byteLength),Yu=(c,d)=>c<<32-d|c>>>d,yw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!yw)throw new Error("Non little-endian hardware is not supported");function xw(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function Zy(c){if(typeof c=="string"&&(c=xw(c)),!gb(c))throw new Error(`expected Uint8Array, got ${typeof c}`);return c}function _w(...c){const d=new Uint8Array(c.reduce((C,D)=>C+D.length,0));let y=0;return c.forEach(C=>{if(!gb(C))throw new Error("Uint8Array expected");d.set(C,y),y+=C.length}),d}let mb=class{clone(){return this._cloneInto()}};function bw(c){const d=C=>c().update(Zy(C)).digest(),y=c();return d.outputLen=y.outputLen,d.blockLen=y.blockLen,d.create=()=>c(),d}function yb(c=32){if(iy&&typeof iy.getRandomValues=="function")return iy.getRandomValues(new Uint8Array(c));throw new Error("crypto.getRandomValues must be defined")}function vw(c,d,y,C){if(typeof c.setBigUint64=="function")return c.setBigUint64(d,y,C);const D=BigInt(32),P=BigInt(4294967295),N=Number(y>>D&P),h=Number(y&P),U=C?4:0,H=C?0:4;c.setUint32(d+U,N,C),c.setUint32(d+H,h,C)}let ww=class extends mb{constructor(d,y,C,D){super(),this.blockLen=d,this.outputLen=y,this.padOffset=C,this.isLE=D,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(d),this.view=ry(this.buffer)}update(d){t1(this);const{view:y,buffer:C,blockLen:D}=this;d=Zy(d);const P=d.length;for(let N=0;N<P;){const h=Math.min(D-this.pos,P-N);if(h===D){const U=ry(d);for(;D<=P-N;N+=D)this.process(U,N);continue}C.set(d.subarray(N,N+h),this.pos),this.pos+=h,N+=h,this.pos===D&&(this.process(y,0),this.pos=0)}return this.length+=d.length,this.roundClean(),this}digestInto(d){t1(this),mw(d,this),this.finished=!0;const{buffer:y,view:C,blockLen:D,isLE:P}=this;let{pos:N}=this;y[N++]=128,this.buffer.subarray(N).fill(0),this.padOffset>D-N&&(this.process(C,0),N=0);for(let Q=N;Q<D;Q++)y[Q]=0;vw(C,D-8,BigInt(this.length*8),P),this.process(C,0);const h=ry(d),U=this.outputLen;if(U%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const H=U/4,Y=this.get();if(H>Y.length)throw new Error("_sha2: outputLen bigger than state");for(let Q=0;Q<H;Q++)h.setUint32(4*Q,Y[Q],P)}digest(){const{buffer:d,outputLen:y}=this;this.digestInto(d);const C=d.slice(0,y);return this.destroy(),C}_cloneInto(d){d||(d=new this.constructor),d.set(...this.get());const{blockLen:y,buffer:C,length:D,finished:P,destroyed:N,pos:h}=this;return d.length=D,d.pos=h,d.finished=P,d.destroyed=N,D%y&&d.buffer.set(C),d}};const Aw=(c,d,y)=>c&d^~c&y,Ew=(c,d,y)=>c&d^c&y^d&y,Sw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Rd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Pd=new Uint32Array(64);let Cw=class extends ww{constructor(){super(64,32,8,!1),this.A=Rd[0]|0,this.B=Rd[1]|0,this.C=Rd[2]|0,this.D=Rd[3]|0,this.E=Rd[4]|0,this.F=Rd[5]|0,this.G=Rd[6]|0,this.H=Rd[7]|0}get(){const{A:d,B:y,C,D,E:P,F:N,G:h,H:U}=this;return[d,y,C,D,P,N,h,U]}set(d,y,C,D,P,N,h,U){this.A=d|0,this.B=y|0,this.C=C|0,this.D=D|0,this.E=P|0,this.F=N|0,this.G=h|0,this.H=U|0}process(d,y){for(let Q=0;Q<16;Q++,y+=4)Pd[Q]=d.getUint32(y,!1);for(let Q=16;Q<64;Q++){const _e=Pd[Q-15],we=Pd[Q-2],ve=Yu(_e,7)^Yu(_e,18)^_e>>>3,me=Yu(we,17)^Yu(we,19)^we>>>10;Pd[Q]=me+Pd[Q-7]+ve+Pd[Q-16]|0}let{A:C,B:D,C:P,D:N,E:h,F:U,G:H,H:Y}=this;for(let Q=0;Q<64;Q++){const _e=Yu(h,6)^Yu(h,11)^Yu(h,25),we=Y+_e+Aw(h,U,H)+Sw[Q]+Pd[Q]|0,me=(Yu(C,2)^Yu(C,13)^Yu(C,22))+Ew(C,D,P)|0;Y=H,H=U,U=h,h=N+we|0,N=P,P=D,D=C,C=we+me|0}C=C+this.A|0,D=D+this.B|0,P=P+this.C|0,N=N+this.D|0,h=h+this.E|0,U=U+this.F|0,H=H+this.G|0,Y=Y+this.H|0,this.set(C,D,P,N,h,U,H,Y)}roundClean(){Pd.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Ay=bw(()=>new Cw);const xb=BigInt(0),g1=BigInt(1),Tw=BigInt(2),m1=c=>c instanceof Uint8Array,Iw=Array.from({length:256},(c,d)=>d.toString(16).padStart(2,"0"));function x0(c){if(!m1(c))throw new Error("Uint8Array expected");let d="";for(let y=0;y<c.length;y++)d+=Iw[c[y]];return d}function _b(c){const d=c.toString(16);return d.length&1?`0${d}`:d}function Xy(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);return BigInt(c===""?"0":`0x${c}`)}function _0(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const d=c.length;if(d%2)throw new Error("padded hex string expected, got unpadded hex of length "+d);const y=new Uint8Array(d/2);for(let C=0;C<y.length;C++){const D=C*2,P=c.slice(D,D+2),N=Number.parseInt(P,16);if(Number.isNaN(N)||N<0)throw new Error("Invalid byte sequence");y[C]=N}return y}function zl(c){return Xy(x0(c))}function Wy(c){if(!m1(c))throw new Error("Uint8Array expected");return Xy(x0(Uint8Array.from(c).reverse()))}function jd(c,d){return _0(c.toString(16).padStart(d*2,"0"))}function Yy(c,d){return jd(c,d).reverse()}function Mw(c){return _0(_b(c))}function Vo(c,d,y){let C;if(typeof d=="string")try{C=_0(d)}catch(P){throw new Error(`${c} must be valid hex string, got "${d}". Cause: ${P}`)}else if(m1(d))C=Uint8Array.from(d);else throw new Error(`${c} must be hex string or Uint8Array`);const D=C.length;if(typeof y=="number"&&D!==y)throw new Error(`${c} expected ${y} bytes, got ${D}`);return C}function np(...c){const d=new Uint8Array(c.reduce((C,D)=>C+D.length,0));let y=0;return c.forEach(C=>{if(!m1(C))throw new Error("Uint8Array expected");d.set(C,y),y+=C.length}),d}function kw(c,d){if(c.length!==d.length)return!1;for(let y=0;y<c.length;y++)if(c[y]!==d[y])return!1;return!0}function Nw(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function Dw(c){let d;for(d=0;c>xb;c>>=g1,d+=1);return d}function Rw(c,d){return c>>BigInt(d)&g1}const Pw=(c,d,y)=>c|(y?g1:xb)<<BigInt(d),$y=c=>(Tw<<BigInt(c-1))-g1,sy=c=>new Uint8Array(c),n_=c=>Uint8Array.from(c);function bb(c,d,y){if(typeof c!="number"||c<2)throw new Error("hashLen must be a number");if(typeof d!="number"||d<2)throw new Error("qByteLen must be a number");if(typeof y!="function")throw new Error("hmacFn must be a function");let C=sy(c),D=sy(c),P=0;const N=()=>{C.fill(1),D.fill(0),P=0},h=(...Q)=>y(D,C,...Q),U=(Q=sy())=>{D=h(n_([0]),Q),C=h(),Q.length!==0&&(D=h(n_([1]),Q),C=h())},H=()=>{if(P++>=1e3)throw new Error("drbg: tried 1000 values");let Q=0;const _e=[];for(;Q<d;){C=h();const we=C.slice();_e.push(we),Q+=C.length}return np(..._e)};return(Q,_e)=>{N(),U(Q);let we;for(;!(we=_e(H()));)U();return N(),we}}const Ow={bigint:c=>typeof c=="bigint",function:c=>typeof c=="function",boolean:c=>typeof c=="boolean",string:c=>typeof c=="string",stringOrUint8Array:c=>typeof c=="string"||c instanceof Uint8Array,isSafeInteger:c=>Number.isSafeInteger(c),array:c=>Array.isArray(c),field:(c,d)=>d.Fp.isValid(c),hash:c=>typeof c=="function"&&Number.isSafeInteger(c.outputLen)};function Ug(c,d,y={}){const C=(D,P,N)=>{const h=Ow[P];if(typeof h!="function")throw new Error(`Invalid validator "${P}", expected function`);const U=c[D];if(!(N&&U===void 0)&&!h(U,c))throw new Error(`Invalid param ${String(D)}=${U} (${typeof U}), expected ${P}`)};for(const[D,P]of Object.entries(d))C(D,P,!1);for(const[D,P]of Object.entries(y))C(D,P,!0);return c}const zw=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Rw,bitLen:Dw,bitMask:$y,bitSet:Pw,bytesToHex:x0,bytesToNumberBE:zl,bytesToNumberLE:Wy,concatBytes:np,createHmacDrbg:bb,ensureBytes:Vo,equalBytes:kw,hexToBytes:_0,hexToNumber:Xy,numberToBytesBE:jd,numberToBytesLE:Yy,numberToHexUnpadded:_b,numberToVarBytesBE:Mw,utf8ToBytes:Nw,validateObject:Ug},Symbol.toStringTag,{value:"Module"}));const io=BigInt(0),Aa=BigInt(1),$f=BigInt(2),Lw=BigInt(3),Ey=BigInt(4),i_=BigInt(5),r_=BigInt(8);BigInt(9);BigInt(16);function wo(c,d){const y=c%d;return y>=io?y:d+y}function Bw(c,d,y){if(y<=io||d<io)throw new Error("Expected power/modulo > 0");if(y===Aa)return io;let C=Aa;for(;d>io;)d&Aa&&(C=C*c%y),c=c*c%y,d>>=Aa;return C}function Pc(c,d,y){let C=c;for(;d-- >io;)C*=C,C%=y;return C}function Sy(c,d){if(c===io||d<=io)throw new Error(`invert: expected positive integers, got n=${c} mod=${d}`);let y=wo(c,d),C=d,D=io,P=Aa;for(;y!==io;){const h=C/y,U=C%y,H=D-P*h;C=y,y=U,D=P,P=H}if(C!==Aa)throw new Error("invert: does not exist");return wo(D,d)}function Fw(c){const d=(c-Aa)/$f;let y,C,D;for(y=c-Aa,C=0;y%$f===io;y/=$f,C++);for(D=$f;D<c&&Bw(D,d,c)!==c-Aa;D++);if(C===1){const N=(c+Aa)/Ey;return function(U,H){const Y=U.pow(H,N);if(!U.eql(U.sqr(Y),H))throw new Error("Cannot find square root");return Y}}const P=(y+Aa)/$f;return function(h,U){if(h.pow(U,d)===h.neg(h.ONE))throw new Error("Cannot find square root");let H=C,Y=h.pow(h.mul(h.ONE,D),y),Q=h.pow(U,P),_e=h.pow(U,y);for(;!h.eql(_e,h.ONE);){if(h.eql(_e,h.ZERO))return h.ZERO;let we=1;for(let me=h.sqr(_e);we<H&&!h.eql(me,h.ONE);we++)me=h.sqr(me);const ve=h.pow(Y,Aa<<BigInt(H-we-1));Y=h.sqr(ve),Q=h.mul(Q,ve),_e=h.mul(_e,Y),H=we}return Q}}function jw(c){if(c%Ey===Lw){const d=(c+Aa)/Ey;return function(C,D){const P=C.pow(D,d);if(!C.eql(C.sqr(P),D))throw new Error("Cannot find square root");return P}}if(c%r_===i_){const d=(c-i_)/r_;return function(C,D){const P=C.mul(D,$f),N=C.pow(P,d),h=C.mul(D,N),U=C.mul(C.mul(h,$f),N),H=C.mul(h,C.sub(U,C.ONE));if(!C.eql(C.sqr(H),D))throw new Error("Cannot find square root");return H}}return Fw(c)}const Uw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Vw(c){const d={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},y=Uw.reduce((C,D)=>(C[D]="function",C),d);return Ug(c,y)}function Gw(c,d,y){if(y<io)throw new Error("Expected power > 0");if(y===io)return c.ONE;if(y===Aa)return d;let C=c.ONE,D=d;for(;y>io;)y&Aa&&(C=c.mul(C,D)),D=c.sqr(D),y>>=Aa;return C}function Hw(c,d){const y=new Array(d.length),C=d.reduce((P,N,h)=>c.is0(N)?P:(y[h]=P,c.mul(P,N)),c.ONE),D=c.inv(C);return d.reduceRight((P,N,h)=>c.is0(N)?P:(y[h]=c.mul(P,y[h]),c.mul(P,N)),D),y}function vb(c,d){const y=d!==void 0?d:c.toString(2).length,C=Math.ceil(y/8);return{nBitLength:y,nByteLength:C}}function qw(c,d,y=!1,C={}){if(c<=io)throw new Error(`Expected Field ORDER > 0, got ${c}`);const{nBitLength:D,nByteLength:P}=vb(c,d);if(P>2048)throw new Error("Field lengths over 2048 bytes are not supported");const N=jw(c),h=Object.freeze({ORDER:c,BITS:D,BYTES:P,MASK:$y(D),ZERO:io,ONE:Aa,create:U=>wo(U,c),isValid:U=>{if(typeof U!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof U}`);return io<=U&&U<c},is0:U=>U===io,isOdd:U=>(U&Aa)===Aa,neg:U=>wo(-U,c),eql:(U,H)=>U===H,sqr:U=>wo(U*U,c),add:(U,H)=>wo(U+H,c),sub:(U,H)=>wo(U-H,c),mul:(U,H)=>wo(U*H,c),pow:(U,H)=>Gw(h,U,H),div:(U,H)=>wo(U*Sy(H,c),c),sqrN:U=>U*U,addN:(U,H)=>U+H,subN:(U,H)=>U-H,mulN:(U,H)=>U*H,inv:U=>Sy(U,c),sqrt:C.sqrt||(U=>N(h,U)),invertBatch:U=>Hw(h,U),cmov:(U,H,Y)=>Y?H:U,toBytes:U=>y?Yy(U,P):jd(U,P),fromBytes:U=>{if(U.length!==P)throw new Error(`Fp.fromBytes: expected ${P}, got ${U.length}`);return y?Wy(U):zl(U)}});return Object.freeze(h)}function wb(c){if(typeof c!="bigint")throw new Error("field order must be bigint");const d=c.toString(2).length;return Math.ceil(d/8)}function Ab(c){const d=wb(c);return d+Math.ceil(d/2)}function Zw(c,d,y=!1){const C=c.length,D=wb(d),P=Ab(d);if(C<16||C<P||C>1024)throw new Error(`expected ${P}-1024 bytes of input, got ${C}`);const N=y?zl(c):Wy(c),h=wo(N,d-Aa)+Aa;return y?Yy(h,D):jd(h,D)}const Xw=BigInt(0),ay=BigInt(1);function Ww(c,d){const y=(D,P)=>{const N=P.negate();return D?N:P},C=D=>{const P=Math.ceil(d/D)+1,N=2**(D-1);return{windows:P,windowSize:N}};return{constTimeNegate:y,unsafeLadder(D,P){let N=c.ZERO,h=D;for(;P>Xw;)P&ay&&(N=N.add(h)),h=h.double(),P>>=ay;return N},precomputeWindow(D,P){const{windows:N,windowSize:h}=C(P),U=[];let H=D,Y=H;for(let Q=0;Q<N;Q++){Y=H,U.push(Y);for(let _e=1;_e<h;_e++)Y=Y.add(H),U.push(Y);H=Y.double()}return U},wNAF(D,P,N){const{windows:h,windowSize:U}=C(D);let H=c.ZERO,Y=c.BASE;const Q=BigInt(2**D-1),_e=2**D,we=BigInt(D);for(let ve=0;ve<h;ve++){const me=ve*U;let he=Number(N&Q);N>>=we,he>U&&(he-=_e,N+=ay);const Re=me,tt=me+Math.abs(he)-1,Ye=ve%2!==0,pt=he<0;he===0?Y=Y.add(y(Ye,P[Re])):H=H.add(y(pt,P[tt]))}return{p:H,f:Y}},wNAFCached(D,P,N,h){const U=D._WINDOW_SIZE||1;let H=P.get(D);return H||(H=this.precomputeWindow(D,U),U!==1&&P.set(D,h(H))),this.wNAF(U,H,N)}}}function Eb(c){return Vw(c.Fp),Ug(c,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...vb(c.n,c.nBitLength),...c,p:c.Fp.ORDER})}function Yw(c){const d=Eb(c);Ug(d,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:y,Fp:C,a:D}=d;if(y){if(!C.eql(D,C.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof y!="object"||typeof y.beta!="bigint"||typeof y.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...d})}const{bytesToNumberBE:$w,hexToBytes:Qw}=zw,Kf={Err:class extends Error{constructor(d=""){super(d)}},_parseInt(c){const{Err:d}=Kf;if(c.length<2||c[0]!==2)throw new d("Invalid signature integer tag");const y=c[1],C=c.subarray(2,y+2);if(!y||C.length!==y)throw new d("Invalid signature integer: wrong length");if(C[0]&128)throw new d("Invalid signature integer: negative");if(C[0]===0&&!(C[1]&128))throw new d("Invalid signature integer: unnecessary leading zero");return{d:$w(C),l:c.subarray(y+2)}},toSig(c){const{Err:d}=Kf,y=typeof c=="string"?Qw(c):c;if(!(y instanceof Uint8Array))throw new Error("ui8a expected");let C=y.length;if(C<2||y[0]!=48)throw new d("Invalid signature tag");if(y[1]!==C-2)throw new d("Invalid signature: incorrect length");const{d:D,l:P}=Kf._parseInt(y.subarray(2)),{d:N,l:h}=Kf._parseInt(P);if(h.length)throw new d("Invalid signature: left bytes after parsing");return{r:D,s:N}},hexFromSig(c){const d=H=>Number.parseInt(H[0],16)&8?"00"+H:H,y=H=>{const Y=H.toString(16);return Y.length&1?`0${Y}`:Y},C=d(y(c.s)),D=d(y(c.r)),P=C.length/2,N=D.length/2,h=y(P),U=y(N);return`30${y(N+P+4)}02${U}${D}02${h}${C}`}},Bh=BigInt(0),zc=BigInt(1);BigInt(2);const s_=BigInt(3);BigInt(4);function Kw(c){const d=Yw(c),{Fp:y}=d,C=d.toBytes||((ve,me,he)=>{const Re=me.toAffine();return np(Uint8Array.from([4]),y.toBytes(Re.x),y.toBytes(Re.y))}),D=d.fromBytes||(ve=>{const me=ve.subarray(1),he=y.fromBytes(me.subarray(0,y.BYTES)),Re=y.fromBytes(me.subarray(y.BYTES,2*y.BYTES));return{x:he,y:Re}});function P(ve){const{a:me,b:he}=d,Re=y.sqr(ve),tt=y.mul(Re,ve);return y.add(y.add(tt,y.mul(ve,me)),he)}if(!y.eql(y.sqr(d.Gy),P(d.Gx)))throw new Error("bad generator point: equation left != right");function N(ve){return typeof ve=="bigint"&&Bh<ve&&ve<d.n}function h(ve){if(!N(ve))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function U(ve){const{allowedPrivateKeyLengths:me,nByteLength:he,wrapPrivateKey:Re,n:tt}=d;if(me&&typeof ve!="bigint"){if(ve instanceof Uint8Array&&(ve=x0(ve)),typeof ve!="string"||!me.includes(ve.length))throw new Error("Invalid key");ve=ve.padStart(he*2,"0")}let Ye;try{Ye=typeof ve=="bigint"?ve:zl(Vo("private key",ve,he))}catch{throw new Error(`private key must be ${he} bytes, hex or bigint, not ${typeof ve}`)}return Re&&(Ye=wo(Ye,tt)),h(Ye),Ye}const H=new Map;function Y(ve){if(!(ve instanceof Q))throw new Error("ProjectivePoint expected")}class Q{constructor(me,he,Re){if(this.px=me,this.py=he,this.pz=Re,me==null||!y.isValid(me))throw new Error("x required");if(he==null||!y.isValid(he))throw new Error("y required");if(Re==null||!y.isValid(Re))throw new Error("z required")}static fromAffine(me){const{x:he,y:Re}=me||{};if(!me||!y.isValid(he)||!y.isValid(Re))throw new Error("invalid affine point");if(me instanceof Q)throw new Error("projective point not allowed");const tt=Ye=>y.eql(Ye,y.ZERO);return tt(he)&&tt(Re)?Q.ZERO:new Q(he,Re,y.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(me){const he=y.invertBatch(me.map(Re=>Re.pz));return me.map((Re,tt)=>Re.toAffine(he[tt])).map(Q.fromAffine)}static fromHex(me){const he=Q.fromAffine(D(Vo("pointHex",me)));return he.assertValidity(),he}static fromPrivateKey(me){return Q.BASE.multiply(U(me))}_setWindowSize(me){this._WINDOW_SIZE=me,H.delete(this)}assertValidity(){if(this.is0()){if(d.allowInfinityPoint&&!y.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:me,y:he}=this.toAffine();if(!y.isValid(me)||!y.isValid(he))throw new Error("bad point: x or y not FE");const Re=y.sqr(he),tt=P(me);if(!y.eql(Re,tt))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:me}=this.toAffine();if(y.isOdd)return!y.isOdd(me);throw new Error("Field doesn't support isOdd")}equals(me){Y(me);const{px:he,py:Re,pz:tt}=this,{px:Ye,py:pt,pz:Wt}=me,Et=y.eql(y.mul(he,Wt),y.mul(Ye,tt)),it=y.eql(y.mul(Re,Wt),y.mul(pt,tt));return Et&&it}negate(){return new Q(this.px,y.neg(this.py),this.pz)}double(){const{a:me,b:he}=d,Re=y.mul(he,s_),{px:tt,py:Ye,pz:pt}=this;let Wt=y.ZERO,Et=y.ZERO,it=y.ZERO,at=y.mul(tt,tt),He=y.mul(Ye,Ye),xt=y.mul(pt,pt),Pe=y.mul(tt,Ye);return Pe=y.add(Pe,Pe),it=y.mul(tt,pt),it=y.add(it,it),Wt=y.mul(me,it),Et=y.mul(Re,xt),Et=y.add(Wt,Et),Wt=y.sub(He,Et),Et=y.add(He,Et),Et=y.mul(Wt,Et),Wt=y.mul(Pe,Wt),it=y.mul(Re,it),xt=y.mul(me,xt),Pe=y.sub(at,xt),Pe=y.mul(me,Pe),Pe=y.add(Pe,it),it=y.add(at,at),at=y.add(it,at),at=y.add(at,xt),at=y.mul(at,Pe),Et=y.add(Et,at),xt=y.mul(Ye,pt),xt=y.add(xt,xt),at=y.mul(xt,Pe),Wt=y.sub(Wt,at),it=y.mul(xt,He),it=y.add(it,it),it=y.add(it,it),new Q(Wt,Et,it)}add(me){Y(me);const{px:he,py:Re,pz:tt}=this,{px:Ye,py:pt,pz:Wt}=me;let Et=y.ZERO,it=y.ZERO,at=y.ZERO;const He=d.a,xt=y.mul(d.b,s_);let Pe=y.mul(he,Ye),ct=y.mul(Re,pt),vt=y.mul(tt,Wt),Zt=y.add(he,Re),Ne=y.add(Ye,pt);Zt=y.mul(Zt,Ne),Ne=y.add(Pe,ct),Zt=y.sub(Zt,Ne),Ne=y.add(he,tt);let Te=y.add(Ye,Wt);return Ne=y.mul(Ne,Te),Te=y.add(Pe,vt),Ne=y.sub(Ne,Te),Te=y.add(Re,tt),Et=y.add(pt,Wt),Te=y.mul(Te,Et),Et=y.add(ct,vt),Te=y.sub(Te,Et),at=y.mul(He,Ne),Et=y.mul(xt,vt),at=y.add(Et,at),Et=y.sub(ct,at),at=y.add(ct,at),it=y.mul(Et,at),ct=y.add(Pe,Pe),ct=y.add(ct,Pe),vt=y.mul(He,vt),Ne=y.mul(xt,Ne),ct=y.add(ct,vt),vt=y.sub(Pe,vt),vt=y.mul(He,vt),Ne=y.add(Ne,vt),Pe=y.mul(ct,Ne),it=y.add(it,Pe),Pe=y.mul(Te,Ne),Et=y.mul(Zt,Et),Et=y.sub(Et,Pe),Pe=y.mul(Zt,ct),at=y.mul(Te,at),at=y.add(at,Pe),new Q(Et,it,at)}subtract(me){return this.add(me.negate())}is0(){return this.equals(Q.ZERO)}wNAF(me){return we.wNAFCached(this,H,me,he=>{const Re=y.invertBatch(he.map(tt=>tt.pz));return he.map((tt,Ye)=>tt.toAffine(Re[Ye])).map(Q.fromAffine)})}multiplyUnsafe(me){const he=Q.ZERO;if(me===Bh)return he;if(h(me),me===zc)return this;const{endo:Re}=d;if(!Re)return we.unsafeLadder(this,me);let{k1neg:tt,k1:Ye,k2neg:pt,k2:Wt}=Re.splitScalar(me),Et=he,it=he,at=this;for(;Ye>Bh||Wt>Bh;)Ye&zc&&(Et=Et.add(at)),Wt&zc&&(it=it.add(at)),at=at.double(),Ye>>=zc,Wt>>=zc;return tt&&(Et=Et.negate()),pt&&(it=it.negate()),it=new Q(y.mul(it.px,Re.beta),it.py,it.pz),Et.add(it)}multiply(me){h(me);let he=me,Re,tt;const{endo:Ye}=d;if(Ye){const{k1neg:pt,k1:Wt,k2neg:Et,k2:it}=Ye.splitScalar(he);let{p:at,f:He}=this.wNAF(Wt),{p:xt,f:Pe}=this.wNAF(it);at=we.constTimeNegate(pt,at),xt=we.constTimeNegate(Et,xt),xt=new Q(y.mul(xt.px,Ye.beta),xt.py,xt.pz),Re=at.add(xt),tt=He.add(Pe)}else{const{p:pt,f:Wt}=this.wNAF(he);Re=pt,tt=Wt}return Q.normalizeZ([Re,tt])[0]}multiplyAndAddUnsafe(me,he,Re){const tt=Q.BASE,Ye=(Wt,Et)=>Et===Bh||Et===zc||!Wt.equals(tt)?Wt.multiplyUnsafe(Et):Wt.multiply(Et),pt=Ye(this,he).add(Ye(me,Re));return pt.is0()?void 0:pt}toAffine(me){const{px:he,py:Re,pz:tt}=this,Ye=this.is0();me==null&&(me=Ye?y.ONE:y.inv(tt));const pt=y.mul(he,me),Wt=y.mul(Re,me),Et=y.mul(tt,me);if(Ye)return{x:y.ZERO,y:y.ZERO};if(!y.eql(Et,y.ONE))throw new Error("invZ was invalid");return{x:pt,y:Wt}}isTorsionFree(){const{h:me,isTorsionFree:he}=d;if(me===zc)return!0;if(he)return he(Q,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:me,clearCofactor:he}=d;return me===zc?this:he?he(Q,this):this.multiplyUnsafe(d.h)}toRawBytes(me=!0){return this.assertValidity(),C(Q,this,me)}toHex(me=!0){return x0(this.toRawBytes(me))}}Q.BASE=new Q(d.Gx,d.Gy,y.ONE),Q.ZERO=new Q(y.ZERO,y.ONE,y.ZERO);const _e=d.nBitLength,we=Ww(Q,d.endo?Math.ceil(_e/2):_e);return{CURVE:d,ProjectivePoint:Q,normPrivateKeyToScalar:U,weierstrassEquation:P,isWithinCurveOrder:N}}function Jw(c){const d=Eb(c);return Ug(d,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...d})}function eA(c){const d=Jw(c),{Fp:y,n:C}=d,D=y.BYTES+1,P=2*y.BYTES+1;function N(Ne){return Bh<Ne&&Ne<y.ORDER}function h(Ne){return wo(Ne,C)}function U(Ne){return Sy(Ne,C)}const{ProjectivePoint:H,normPrivateKeyToScalar:Y,weierstrassEquation:Q,isWithinCurveOrder:_e}=Kw({...d,toBytes(Ne,Te,We){const wt=Te.toAffine(),zt=y.toBytes(wt.x),Gt=np;return We?Gt(Uint8Array.from([Te.hasEvenY()?2:3]),zt):Gt(Uint8Array.from([4]),zt,y.toBytes(wt.y))},fromBytes(Ne){const Te=Ne.length,We=Ne[0],wt=Ne.subarray(1);if(Te===D&&(We===2||We===3)){const zt=zl(wt);if(!N(zt))throw new Error("Point is not on curve");const Gt=Q(zt);let ke=y.sqrt(Gt);const nt=(ke&zc)===zc;return(We&1)===1!==nt&&(ke=y.neg(ke)),{x:zt,y:ke}}else if(Te===P&&We===4){const zt=y.fromBytes(wt.subarray(0,y.BYTES)),Gt=y.fromBytes(wt.subarray(y.BYTES,2*y.BYTES));return{x:zt,y:Gt}}else throw new Error(`Point of length ${Te} was invalid. Expected ${D} compressed bytes or ${P} uncompressed bytes`)}}),we=Ne=>x0(jd(Ne,d.nByteLength));function ve(Ne){const Te=C>>zc;return Ne>Te}function me(Ne){return ve(Ne)?h(-Ne):Ne}const he=(Ne,Te,We)=>zl(Ne.slice(Te,We));class Re{constructor(Te,We,wt){this.r=Te,this.s=We,this.recovery=wt,this.assertValidity()}static fromCompact(Te){const We=d.nByteLength;return Te=Vo("compactSignature",Te,We*2),new Re(he(Te,0,We),he(Te,We,2*We))}static fromDER(Te){const{r:We,s:wt}=Kf.toSig(Vo("DER",Te));return new Re(We,wt)}assertValidity(){if(!_e(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!_e(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Te){return new Re(this.r,this.s,Te)}recoverPublicKey(Te){const{r:We,s:wt,recovery:zt}=this,Gt=it(Vo("msgHash",Te));if(zt==null||![0,1,2,3].includes(zt))throw new Error("recovery id invalid");const ke=zt===2||zt===3?We+d.n:We;if(ke>=y.ORDER)throw new Error("recovery id 2 or 3 invalid");const nt=(zt&1)===0?"02":"03",Nt=H.fromHex(nt+we(ke)),_t=U(ke),tn=h(-Gt*_t),Bt=h(wt*_t),Kt=H.BASE.multiplyAndAddUnsafe(Nt,tn,Bt);if(!Kt)throw new Error("point at infinify");return Kt.assertValidity(),Kt}hasHighS(){return ve(this.s)}normalizeS(){return this.hasHighS()?new Re(this.r,h(-this.s),this.recovery):this}toDERRawBytes(){return _0(this.toDERHex())}toDERHex(){return Kf.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return _0(this.toCompactHex())}toCompactHex(){return we(this.r)+we(this.s)}}const tt={isValidPrivateKey(Ne){try{return Y(Ne),!0}catch{return!1}},normPrivateKeyToScalar:Y,randomPrivateKey:()=>{const Ne=Ab(d.n);return Zw(d.randomBytes(Ne),d.n)},precompute(Ne=8,Te=H.BASE){return Te._setWindowSize(Ne),Te.multiply(BigInt(3)),Te}};function Ye(Ne,Te=!0){return H.fromPrivateKey(Ne).toRawBytes(Te)}function pt(Ne){const Te=Ne instanceof Uint8Array,We=typeof Ne=="string",wt=(Te||We)&&Ne.length;return Te?wt===D||wt===P:We?wt===2*D||wt===2*P:Ne instanceof H}function Wt(Ne,Te,We=!0){if(pt(Ne))throw new Error("first arg must be private key");if(!pt(Te))throw new Error("second arg must be public key");return H.fromHex(Te).multiply(Y(Ne)).toRawBytes(We)}const Et=d.bits2int||function(Ne){const Te=zl(Ne),We=Ne.length*8-d.nBitLength;return We>0?Te>>BigInt(We):Te},it=d.bits2int_modN||function(Ne){return h(Et(Ne))},at=$y(d.nBitLength);function He(Ne){if(typeof Ne!="bigint")throw new Error("bigint expected");if(!(Bh<=Ne&&Ne<at))throw new Error(`bigint expected < 2^${d.nBitLength}`);return jd(Ne,d.nByteLength)}function xt(Ne,Te,We=Pe){if(["recovered","canonical"].some(sn=>sn in We))throw new Error("sign() legacy options not supported");const{hash:wt,randomBytes:zt}=d;let{lowS:Gt,prehash:ke,extraEntropy:nt}=We;Gt==null&&(Gt=!0),Ne=Vo("msgHash",Ne),ke&&(Ne=Vo("prehashed msgHash",wt(Ne)));const Nt=it(Ne),_t=Y(Te),tn=[He(_t),He(Nt)];if(nt!=null){const sn=nt===!0?zt(y.BYTES):nt;tn.push(Vo("extraEntropy",sn))}const Bt=np(...tn),Kt=Nt;function an(sn){const Nn=Et(sn);if(!_e(Nn))return;const Dn=U(Nn),si=H.BASE.multiply(Nn).toAffine(),kn=h(si.x);if(kn===Bh)return;const ui=h(Dn*h(Kt+kn*_t));if(ui===Bh)return;let _i=(si.x===kn?0:2)|Number(si.y&zc),Di=ui;return Gt&&ve(ui)&&(Di=me(ui),_i^=1),new Re(kn,Di,_i)}return{seed:Bt,k2sig:an}}const Pe={lowS:d.lowS,prehash:!1},ct={lowS:d.lowS,prehash:!1};function vt(Ne,Te,We=Pe){const{seed:wt,k2sig:zt}=xt(Ne,Te,We),Gt=d;return bb(Gt.hash.outputLen,Gt.nByteLength,Gt.hmac)(wt,zt)}H.BASE._setWindowSize(8);function Zt(Ne,Te,We,wt=ct){const zt=Ne;if(Te=Vo("msgHash",Te),We=Vo("publicKey",We),"strict"in wt)throw new Error("options.strict was renamed to lowS");const{lowS:Gt,prehash:ke}=wt;let nt,Nt;try{if(typeof zt=="string"||zt instanceof Uint8Array)try{nt=Re.fromDER(zt)}catch(si){if(!(si instanceof Kf.Err))throw si;nt=Re.fromCompact(zt)}else if(typeof zt=="object"&&typeof zt.r=="bigint"&&typeof zt.s=="bigint"){const{r:si,s:kn}=zt;nt=new Re(si,kn)}else throw new Error("PARSE");Nt=H.fromHex(We)}catch(si){if(si.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Gt&&nt.hasHighS())return!1;ke&&(Te=d.hash(Te));const{r:_t,s:tn}=nt,Bt=it(Te),Kt=U(tn),an=h(Bt*Kt),sn=h(_t*Kt),Nn=H.BASE.multiplyAndAddUnsafe(Nt,an,sn)?.toAffine();return Nn?h(Nn.x)===_t:!1}return{CURVE:d,getPublicKey:Ye,getSharedSecret:Wt,sign:vt,verify:Zt,ProjectivePoint:H,Signature:Re,utils:tt}}let Sb=class extends mb{constructor(d,y){super(),this.finished=!1,this.destroyed=!1,gw(d);const C=Zy(y);if(this.iHash=d.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const D=this.blockLen,P=new Uint8Array(D);P.set(C.length>D?d.create().update(C).digest():C);for(let N=0;N<P.length;N++)P[N]^=54;this.iHash.update(P),this.oHash=d.create();for(let N=0;N<P.length;N++)P[N]^=106;this.oHash.update(P),P.fill(0)}update(d){return t1(this),this.iHash.update(d),this}digestInto(d){t1(this),pb(d,this.outputLen),this.finished=!0,this.iHash.digestInto(d),this.oHash.update(d),this.oHash.digestInto(d),this.destroy()}digest(){const d=new Uint8Array(this.oHash.outputLen);return this.digestInto(d),d}_cloneInto(d){d||(d=Object.create(Object.getPrototypeOf(this),{}));const{oHash:y,iHash:C,finished:D,destroyed:P,blockLen:N,outputLen:h}=this;return d=d,d.finished=D,d.destroyed=P,d.blockLen=N,d.outputLen=h,d.oHash=y._cloneInto(d.oHash),d.iHash=C._cloneInto(d.iHash),d}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Cb=(c,d,y)=>new Sb(c,d).update(y).digest();Cb.create=(c,d)=>new Sb(c,d);function tA(c){return{hash:c,hmac:(d,...y)=>Cb(c,d,_w(...y)),randomBytes:yb}}function nA(c,d){const y=C=>eA({...c,...tA(C)});return Object.freeze({...y(d),create:y})}const y1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Tb=BigInt(1),i1=BigInt(2),a_=(c,d)=>(c+d/i1)/d;function Ib(c){const d=y1,y=BigInt(3),C=BigInt(6),D=BigInt(11),P=BigInt(22),N=BigInt(23),h=BigInt(44),U=BigInt(88),H=c*c*c%d,Y=H*H*c%d,Q=Pc(Y,y,d)*Y%d,_e=Pc(Q,y,d)*Y%d,we=Pc(_e,i1,d)*H%d,ve=Pc(we,D,d)*we%d,me=Pc(ve,P,d)*ve%d,he=Pc(me,h,d)*me%d,Re=Pc(he,U,d)*he%d,tt=Pc(Re,h,d)*me%d,Ye=Pc(tt,y,d)*Y%d,pt=Pc(Ye,N,d)*ve%d,Wt=Pc(pt,C,d)*H%d,Et=Pc(Wt,i1,d);if(!Cy.eql(Cy.sqr(Et),c))throw new Error("Cannot find square root");return Et}const Cy=qw(y1,void 0,void 0,{sqrt:Ib}),v0=nA({a:BigInt(0),b:BigInt(7),Fp:Cy,n:n1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:c=>{const d=n1,y=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),C=-Tb*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),D=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),P=y,N=BigInt("0x100000000000000000000000000000000"),h=a_(P*c,d),U=a_(-C*c,d);let H=wo(c-h*y-U*D,d),Y=wo(-h*C-U*P,d);const Q=H>N,_e=Y>N;if(Q&&(H=d-H),_e&&(Y=d-Y),H>N||Y>N)throw new Error("splitScalar: Endomorphism failed, k="+c);return{k1neg:Q,k1:H,k2neg:_e,k2:Y}}}},Ay),x1=BigInt(0),Mb=c=>typeof c=="bigint"&&x1<c&&c<y1,iA=c=>typeof c=="bigint"&&x1<c&&c<n1,o_={};function r1(c,...d){let y=o_[c];if(y===void 0){const C=Ay(Uint8Array.from(c,D=>D.charCodeAt(0)));y=np(C,C),o_[c]=y}return Ay(np(y,...d))}const Qy=c=>c.toRawBytes(!0).slice(1),Ty=c=>jd(c,32),oy=c=>wo(c,y1),Pg=c=>wo(c,n1),Ky=v0.ProjectivePoint,rA=(c,d,y)=>Ky.BASE.multiplyAndAddUnsafe(c,d,y);function Iy(c){let d=v0.utils.normPrivateKeyToScalar(c),y=Ky.fromPrivateKey(d);return{scalar:y.hasEvenY()?d:Pg(-d),bytes:Qy(y)}}function kb(c){if(!Mb(c))throw new Error("bad x: need 0 < x < p");const d=oy(c*c),y=oy(d*c+BigInt(7));let C=Ib(y);C%i1!==x1&&(C=oy(-C));const D=new Ky(c,C,Tb);return D.assertValidity(),D}function Nb(...c){return Pg(zl(r1("BIP0340/challenge",...c)))}function sA(c){return Iy(c).bytes}function aA(c,d,y=yb(32)){const C=Vo("message",c),{bytes:D,scalar:P}=Iy(d),N=Vo("auxRand",y,32),h=Ty(P^zl(r1("BIP0340/aux",N))),U=r1("BIP0340/nonce",h,D,C),H=Pg(zl(U));if(H===x1)throw new Error("sign failed: k is zero");const{bytes:Y,scalar:Q}=Iy(H),_e=Nb(Y,D,C),we=new Uint8Array(64);if(we.set(Y,0),we.set(Ty(Pg(Q+_e*P)),32),!Db(we,C,D))throw new Error("sign: Invalid signature produced");return we}function Db(c,d,y){const C=Vo("signature",c,64),D=Vo("message",d),P=Vo("publicKey",y,32);try{const N=kb(zl(P)),h=zl(C.subarray(0,32));if(!Mb(h))return!1;const U=zl(C.subarray(32,64));if(!iA(U))return!1;const H=Nb(Ty(h),Qy(N),D),Y=rA(N,U,Pg(-H));return!(!Y||!Y.hasEvenY()||Y.toAffine().x!==h)}catch{return!1}}const Qu={getPublicKey:sA,sign:aA,verify:Db,utils:{randomPrivateKey:v0.utils.randomPrivateKey,lift_x:kb,pointToBytes:Qy,numberToBytesBE:jd,bytesToNumberBE:zl,taggedHash:r1,mod:wo}},ly=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Jy=c=>c instanceof Uint8Array,cy=c=>new DataView(c.buffer,c.byteOffset,c.byteLength),$u=(c,d)=>c<<32-d|c>>>d,oA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!oA)throw new Error("Non little-endian hardware is not supported");const lA=Array.from({length:256},(c,d)=>d.toString(16).padStart(2,"0"));function Es(c){if(!Jy(c))throw new Error("Uint8Array expected");let d="";for(let y=0;y<c.length;y++)d+=lA[c[y]];return d}function Ud(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const d=c.length;if(d%2)throw new Error("padded hex string expected, got unpadded hex of length "+d);const y=new Uint8Array(d/2);for(let C=0;C<y.length;C++){const D=C*2,P=c.slice(D,D+2),N=Number.parseInt(P,16);if(Number.isNaN(N)||N<0)throw new Error("Invalid byte sequence");y[C]=N}return y}function cA(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function Og(c){if(typeof c=="string"&&(c=cA(c)),!Jy(c))throw new Error(`expected Uint8Array, got ${typeof c}`);return c}function _1(...c){const d=new Uint8Array(c.reduce((C,D)=>C+D.length,0));let y=0;return c.forEach(C=>{if(!Jy(C))throw new Error("Uint8Array expected");d.set(C,y),y+=C.length}),d}class Rb{clone(){return this._cloneInto()}}function Pb(c){const d=C=>c().update(Og(C)).digest(),y=c();return d.outputLen=y.outputLen,d.blockLen=y.blockLen,d.create=()=>c(),d}function Ob(c=32){if(ly&&typeof ly.getRandomValues=="function")return ly.getRandomValues(new Uint8Array(c));throw new Error("crypto.getRandomValues must be defined")}function My(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`Wrong positive integer: ${c}`)}function uA(c){if(typeof c!="boolean")throw new Error(`Expected boolean, not ${c}`)}function zb(c,...d){if(!(c instanceof Uint8Array))throw new Error("Expected Uint8Array");if(d.length>0&&!d.includes(c.length))throw new Error(`Expected Uint8Array of length ${d}, not of length=${c.length}`)}function hA(c){if(typeof c!="function"||typeof c.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");My(c.outputLen),My(c.blockLen)}function dA(c,d=!0){if(c.destroyed)throw new Error("Hash instance has been destroyed");if(d&&c.finished)throw new Error("Hash#digest() has already been called")}function fA(c,d){zb(c);const y=d.outputLen;if(c.length<y)throw new Error(`digestInto() expects output buffer of length at least ${y}`)}const Ku={number:My,bool:uA,bytes:zb,hash:hA,exists:dA,output:fA};function pA(c,d,y,C){if(typeof c.setBigUint64=="function")return c.setBigUint64(d,y,C);const D=BigInt(32),P=BigInt(4294967295),N=Number(y>>D&P),h=Number(y&P),U=C?4:0,H=C?0:4;c.setUint32(d+U,N,C),c.setUint32(d+H,h,C)}class gA extends Rb{constructor(d,y,C,D){super(),this.blockLen=d,this.outputLen=y,this.padOffset=C,this.isLE=D,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(d),this.view=cy(this.buffer)}update(d){Ku.exists(this);const{view:y,buffer:C,blockLen:D}=this;d=Og(d);const P=d.length;for(let N=0;N<P;){const h=Math.min(D-this.pos,P-N);if(h===D){const U=cy(d);for(;D<=P-N;N+=D)this.process(U,N);continue}C.set(d.subarray(N,N+h),this.pos),this.pos+=h,N+=h,this.pos===D&&(this.process(y,0),this.pos=0)}return this.length+=d.length,this.roundClean(),this}digestInto(d){Ku.exists(this),Ku.output(d,this),this.finished=!0;const{buffer:y,view:C,blockLen:D,isLE:P}=this;let{pos:N}=this;y[N++]=128,this.buffer.subarray(N).fill(0),this.padOffset>D-N&&(this.process(C,0),N=0);for(let Q=N;Q<D;Q++)y[Q]=0;pA(C,D-8,BigInt(this.length*8),P),this.process(C,0);const h=cy(d),U=this.outputLen;if(U%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const H=U/4,Y=this.get();if(H>Y.length)throw new Error("_sha2: outputLen bigger than state");for(let Q=0;Q<H;Q++)h.setUint32(4*Q,Y[Q],P)}digest(){const{buffer:d,outputLen:y}=this;this.digestInto(d);const C=d.slice(0,y);return this.destroy(),C}_cloneInto(d){d||(d=new this.constructor),d.set(...this.get());const{blockLen:y,buffer:C,length:D,finished:P,destroyed:N,pos:h}=this;return d.length=D,d.pos=h,d.finished=P,d.destroyed=N,D%y&&d.buffer.set(C),d}}const mA=(c,d,y)=>c&d^~c&y,yA=(c,d,y)=>c&d^c&y^d&y,xA=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Od=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),zd=new Uint32Array(64);class Lb extends gA{constructor(){super(64,32,8,!1),this.A=Od[0]|0,this.B=Od[1]|0,this.C=Od[2]|0,this.D=Od[3]|0,this.E=Od[4]|0,this.F=Od[5]|0,this.G=Od[6]|0,this.H=Od[7]|0}get(){const{A:d,B:y,C,D,E:P,F:N,G:h,H:U}=this;return[d,y,C,D,P,N,h,U]}set(d,y,C,D,P,N,h,U){this.A=d|0,this.B=y|0,this.C=C|0,this.D=D|0,this.E=P|0,this.F=N|0,this.G=h|0,this.H=U|0}process(d,y){for(let Q=0;Q<16;Q++,y+=4)zd[Q]=d.getUint32(y,!1);for(let Q=16;Q<64;Q++){const _e=zd[Q-15],we=zd[Q-2],ve=$u(_e,7)^$u(_e,18)^_e>>>3,me=$u(we,17)^$u(we,19)^we>>>10;zd[Q]=me+zd[Q-7]+ve+zd[Q-16]|0}let{A:C,B:D,C:P,D:N,E:h,F:U,G:H,H:Y}=this;for(let Q=0;Q<64;Q++){const _e=$u(h,6)^$u(h,11)^$u(h,25),we=Y+_e+mA(h,U,H)+xA[Q]+zd[Q]|0,me=($u(C,2)^$u(C,13)^$u(C,22))+yA(C,D,P)|0;Y=H,H=U,U=h,h=N+we|0,N=P,P=D,D=C,C=we+me|0}C=C+this.A|0,D=D+this.B|0,P=P+this.C|0,N=N+this.D|0,h=h+this.E|0,U=U+this.F|0,H=H+this.G|0,Y=Y+this.H|0,this.set(C,D,P,N,h,U,H,Y)}roundClean(){zd.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class _A extends Lb{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Gd=Pb(()=>new Lb);Pb(()=>new _A);function w0(c){if(!Number.isSafeInteger(c))throw new Error(`Wrong integer: ${c}`)}function Gh(...c){const d=(D,P)=>N=>D(P(N)),y=Array.from(c).reverse().reduce((D,P)=>D?d(D,P.encode):P.encode,void 0),C=c.reduce((D,P)=>D?d(D,P.decode):P.decode,void 0);return{encode:y,decode:C}}function Hh(c){return{encode:d=>{if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return d.map(y=>{if(w0(y),y<0||y>=c.length)throw new Error(`Digit index outside alphabet: ${y} (alphabet: ${c.length})`);return c[y]})},decode:d=>{if(!Array.isArray(d)||d.length&&typeof d[0]!="string")throw new Error("alphabet.decode input should be array of strings");return d.map(y=>{if(typeof y!="string")throw new Error(`alphabet.decode: not string element=${y}`);const C=c.indexOf(y);if(C===-1)throw new Error(`Unknown letter: "${y}". Allowed: ${c}`);return C})}}}function qh(c=""){if(typeof c!="string")throw new Error("join separator should be string");return{encode:d=>{if(!Array.isArray(d)||d.length&&typeof d[0]!="string")throw new Error("join.encode input should be array of strings");for(let y of d)if(typeof y!="string")throw new Error(`join.encode: non-string input=${y}`);return d.join(c)},decode:d=>{if(typeof d!="string")throw new Error("join.decode input should be string");return d.split(c)}}}function b1(c,d="="){if(w0(c),typeof d!="string")throw new Error("padding chr should be string");return{encode(y){if(!Array.isArray(y)||y.length&&typeof y[0]!="string")throw new Error("padding.encode input should be array of strings");for(let C of y)if(typeof C!="string")throw new Error(`padding.encode: non-string input=${C}`);for(;y.length*c%8;)y.push(d);return y},decode(y){if(!Array.isArray(y)||y.length&&typeof y[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of y)if(typeof D!="string")throw new Error(`padding.decode: non-string input=${D}`);let C=y.length;if(C*c%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;C>0&&y[C-1]===d;C--)if(!((C-1)*c%8))throw new Error("Invalid padding: string has too much padding");return y.slice(0,C)}}}function Bb(c){if(typeof c!="function")throw new Error("normalize fn should be function");return{encode:d=>d,decode:d=>c(d)}}function l_(c,d,y){if(d<2)throw new Error(`convertRadix: wrong from=${d}, base cannot be less than 2`);if(y<2)throw new Error(`convertRadix: wrong to=${y}, base cannot be less than 2`);if(!Array.isArray(c))throw new Error("convertRadix: data should be array");if(!c.length)return[];let C=0;const D=[],P=Array.from(c);for(P.forEach(N=>{if(w0(N),N<0||N>=d)throw new Error(`Wrong integer: ${N}`)});;){let N=0,h=!0;for(let U=C;U<P.length;U++){const H=P[U],Y=d*N+H;if(!Number.isSafeInteger(Y)||d*N/d!==N||Y-H!==d*N)throw new Error("convertRadix: carry overflow");if(N=Y%y,P[U]=Math.floor(Y/y),!Number.isSafeInteger(P[U])||P[U]*y+N!==Y)throw new Error("convertRadix: carry overflow");if(h)P[U]?h=!1:C=U;else continue}if(D.push(N),h)break}for(let N=0;N<c.length-1&&c[N]===0;N++)D.push(0);return D.reverse()}const Fb=(c,d)=>d?Fb(d,c%d):c,s1=(c,d)=>c+(d-Fb(c,d));function ky(c,d,y,C){if(!Array.isArray(c))throw new Error("convertRadix2: data should be array");if(d<=0||d>32)throw new Error(`convertRadix2: wrong from=${d}`);if(y<=0||y>32)throw new Error(`convertRadix2: wrong to=${y}`);if(s1(d,y)>32)throw new Error(`convertRadix2: carry overflow from=${d} to=${y} carryBits=${s1(d,y)}`);let D=0,P=0;const N=2**y-1,h=[];for(const U of c){if(w0(U),U>=2**d)throw new Error(`convertRadix2: invalid data word=${U} from=${d}`);if(D=D<<d|U,P+d>32)throw new Error(`convertRadix2: carry overflow pos=${P} from=${d}`);for(P+=d;P>=y;P-=y)h.push((D>>P-y&N)>>>0);D&=2**P-1}if(D=D<<y-P&N,!C&&P>=d)throw new Error("Excess padding");if(!C&&D)throw new Error(`Non-zero padding: ${D}`);return C&&P>0&&h.push(D>>>0),h}function bA(c){return w0(c),{encode:d=>{if(!(d instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return l_(Array.from(d),2**8,c)},decode:d=>{if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(l_(d,c,2**8))}}}function Hd(c,d=!1){if(w0(c),c<=0||c>32)throw new Error("radix2: bits should be in (0..32]");if(s1(8,c)>32||s1(c,8)>32)throw new Error("radix2: carry overflow");return{encode:y=>{if(!(y instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return ky(Array.from(y),8,c,!d)},decode:y=>{if(!Array.isArray(y)||y.length&&typeof y[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(ky(y,c,8,d))}}}function c_(c){if(typeof c!="function")throw new Error("unsafeWrapper fn should be function");return function(...d){try{return c.apply(null,d)}catch{}}}const vA=Gh(Hd(4),Hh("0123456789ABCDEF"),qh("")),wA=Gh(Hd(5),Hh("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),b1(5),qh(""));Gh(Hd(5),Hh("0123456789ABCDEFGHIJKLMNOPQRSTUV"),b1(5),qh(""));Gh(Hd(5),Hh("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),qh(""),Bb(c=>c.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Vh=Gh(Hd(6),Hh("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),b1(6),qh("")),AA=Gh(Hd(6),Hh("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),b1(6),qh("")),ex=c=>Gh(bA(58),Hh(c),qh("")),Ny=ex("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");ex("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");ex("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const u_=[0,2,3,5,6,7,9,10,11],EA={encode(c){let d="";for(let y=0;y<c.length;y+=8){const C=c.subarray(y,y+8);d+=Ny.encode(C).padStart(u_[C.length],"1")}return d},decode(c){let d=[];for(let y=0;y<c.length;y+=11){const C=c.slice(y,y+11),D=u_.indexOf(C.length),P=Ny.decode(C);for(let N=0;N<P.length-D;N++)if(P[N]!==0)throw new Error("base58xmr: wrong padding");d=d.concat(Array.from(P.slice(P.length-D)))}return Uint8Array.from(d)}},Dy=Gh(Hh("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),qh("")),h_=[996825010,642813549,513874426,1027748829,705979059];function Mg(c){const d=c>>25;let y=(c&33554431)<<5;for(let C=0;C<h_.length;C++)(d>>C&1)===1&&(y^=h_[C]);return y}function d_(c,d,y=1){const C=c.length;let D=1;for(let P=0;P<C;P++){const N=c.charCodeAt(P);if(N<33||N>126)throw new Error(`Invalid prefix (${c})`);D=Mg(D)^N>>5}D=Mg(D);for(let P=0;P<C;P++)D=Mg(D)^c.charCodeAt(P)&31;for(let P of d)D=Mg(D)^P;for(let P=0;P<6;P++)D=Mg(D);return D^=y,Dy.encode(ky([D%2**30],30,5,!1))}function jb(c){const d=c==="bech32"?1:734539939,y=Hd(5),C=y.decode,D=y.encode,P=c_(C);function N(Y,Q,_e=90){if(typeof Y!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof Y}`);if(!Array.isArray(Q)||Q.length&&typeof Q[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof Q}`);const we=Y.length+7+Q.length;if(_e!==!1&&we>_e)throw new TypeError(`Length ${we} exceeds limit ${_e}`);return Y=Y.toLowerCase(),`${Y}1${Dy.encode(Q)}${d_(Y,Q,d)}`}function h(Y,Q=90){if(typeof Y!="string")throw new Error(`bech32.decode input should be string, not ${typeof Y}`);if(Y.length<8||Q!==!1&&Y.length>Q)throw new TypeError(`Wrong string length: ${Y.length} (${Y}). Expected (8..${Q})`);const _e=Y.toLowerCase();if(Y!==_e&&Y!==Y.toUpperCase())throw new Error("String must be lowercase or uppercase");Y=_e;const we=Y.lastIndexOf("1");if(we===0||we===-1)throw new Error('Letter "1" must be present between prefix and data only');const ve=Y.slice(0,we),me=Y.slice(we+1);if(me.length<6)throw new Error("Data must be at least 6 characters long");const he=Dy.decode(me).slice(0,-6),Re=d_(ve,he,d);if(!me.endsWith(Re))throw new Error(`Invalid checksum in ${Y}: expected "${Re}"`);return{prefix:ve,words:he}}const U=c_(h);function H(Y){const{prefix:Q,words:_e}=h(Y,!1);return{prefix:Q,words:_e,bytes:C(_e)}}return{encode:N,decode:h,decodeToBytes:H,decodeUnsafe:U,fromWords:C,fromWordsUnsafe:P,toWords:D}}const th=jb("bech32");jb("bech32m");const SA={encode:c=>new TextDecoder().decode(c),decode:c=>new TextEncoder().encode(c)},CA=Gh(Hd(4),Hh("0123456789abcdef"),qh(""),Bb(c=>{if(typeof c!="string"||c.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof c} with length ${c.length}`);return c.toLowerCase()})),TA={utf8:SA,hex:CA,base16:vA,base32:wA,base64:Vh,base64url:AA,base58:Ny,base58xmr:EA};`${Object.keys(TA).join(", ")}`;function uy(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`positive integer expected, not ${c}`)}function f_(c){if(typeof c!="boolean")throw new Error(`boolean expected, not ${c}`)}function IA(c){return c instanceof Uint8Array||c!=null&&typeof c=="object"&&c.constructor.name==="Uint8Array"}function Ju(c,...d){if(!IA(c))throw new Error("Uint8Array expected");if(d.length>0&&!d.includes(c.length))throw new Error(`Uint8Array expected of length ${d}, not of length=${c.length}`)}const Go=c=>new Uint32Array(c.buffer,c.byteOffset,Math.floor(c.byteLength/4)),MA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!MA)throw new Error("Non little-endian hardware is not supported");const kA=Array.from({length:256},(c,d)=>d.toString(16).padStart(2,"0"));function f0(c){Ju(c);let d="";for(let y=0;y<c.length;y++)d+=kA[c[y]];return d}const Oh={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function p_(c){if(c>=Oh._0&&c<=Oh._9)return c-Oh._0;if(c>=Oh._A&&c<=Oh._F)return c-(Oh._A-10);if(c>=Oh._a&&c<=Oh._f)return c-(Oh._a-10)}function Ub(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const d=c.length,y=d/2;if(d%2)throw new Error("padded hex string expected, got unpadded hex of length "+d);const C=new Uint8Array(y);for(let D=0,P=0;D<y;D++,P+=2){const N=p_(c.charCodeAt(P)),h=p_(c.charCodeAt(P+1));if(N===void 0||h===void 0){const U=c[P]+c[P+1];throw new Error('hex string expected, got non-hex character "'+U+'" at index '+P)}C[D]=N*16+h}return C}function NA(c,d){if(d==null||typeof d!="object")throw new Error("options must be defined");return Object.assign(c,d)}function DA(c,d){if(c.length!==d.length)return!1;let y=0;for(let C=0;C<c.length;C++)y|=c[C]^d[C];return y===0}const RA=(c,d)=>(Object.assign(d,c),d),Bd=16,PA=283;function tx(c){return c<<1^PA&-(c>>7)}function p0(c,d){let y=0;for(;d>0;d>>=1)y^=c&-(d&1),c=tx(c);return y}const Ry=(()=>{let c=new Uint8Array(256);for(let y=0,C=1;y<256;y++,C^=tx(C))c[y]=C;const d=new Uint8Array(256);d[0]=99;for(let y=0;y<255;y++){let C=c[255-y];C|=C<<8,d[c[y]]=(C^C>>4^C>>5^C>>6^C>>7^99)&255}return d})(),OA=Ry.map((c,d)=>Ry.indexOf(d)),zA=c=>c<<24|c>>>8,hy=c=>c<<8|c>>>24;function Vb(c,d){if(c.length!==256)throw new Error("Wrong sbox length");const y=new Uint32Array(256).map((H,Y)=>d(c[Y])),C=y.map(hy),D=C.map(hy),P=D.map(hy),N=new Uint32Array(256*256),h=new Uint32Array(256*256),U=new Uint16Array(256*256);for(let H=0;H<256;H++)for(let Y=0;Y<256;Y++){const Q=H*256+Y;N[Q]=y[H]^C[Y],h[Q]=D[H]^P[Y],U[Q]=c[H]<<8|c[Y]}return{sbox:c,sbox2:U,T0:y,T1:C,T2:D,T3:P,T01:N,T23:h}}const nx=Vb(Ry,c=>p0(c,3)<<24|c<<16|c<<8|p0(c,2)),Gb=Vb(OA,c=>p0(c,11)<<24|p0(c,13)<<16|p0(c,9)<<8|p0(c,14)),LA=(()=>{const c=new Uint8Array(16);for(let d=0,y=1;d<16;d++,y=tx(y))c[d]=y;return c})();function Hb(c){Ju(c);const d=c.length;if(![16,24,32].includes(d))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${d}`);const{sbox2:y}=nx,C=Go(c),D=C.length,P=h=>eh(y,h,h,h,h),N=new Uint32Array(d+28);N.set(C);for(let h=D;h<N.length;h++){let U=N[h-1];h%D===0?U=P(zA(U))^LA[h/D-1]:D>6&&h%D===4&&(U=P(U)),N[h]=N[h-D]^U}return N}function BA(c){const d=Hb(c),y=d.slice(),C=d.length,{sbox2:D}=nx,{T0:P,T1:N,T2:h,T3:U}=Gb;for(let H=0;H<C;H+=4)for(let Y=0;Y<4;Y++)y[H+Y]=d[C-H-4+Y];d.fill(0);for(let H=4;H<C-4;H++){const Y=y[H],Q=eh(D,Y,Y,Y,Y);y[H]=P[Q&255]^N[Q>>>8&255]^h[Q>>>16&255]^U[Q>>>24]}return y}function Ld(c,d,y,C,D,P){return c[y<<8&65280|C>>>8&255]^d[D>>>8&65280|P>>>24&255]}function eh(c,d,y,C,D){return c[d&255|y&65280]|c[C>>>16&255|D>>>16&65280]<<16}function g_(c,d,y,C,D){const{sbox2:P,T01:N,T23:h}=nx;let U=0;d^=c[U++],y^=c[U++],C^=c[U++],D^=c[U++];const H=c.length/4-2;for(let ve=0;ve<H;ve++){const me=c[U++]^Ld(N,h,d,y,C,D),he=c[U++]^Ld(N,h,y,C,D,d),Re=c[U++]^Ld(N,h,C,D,d,y),tt=c[U++]^Ld(N,h,D,d,y,C);d=me,y=he,C=Re,D=tt}const Y=c[U++]^eh(P,d,y,C,D),Q=c[U++]^eh(P,y,C,D,d),_e=c[U++]^eh(P,C,D,d,y),we=c[U++]^eh(P,D,d,y,C);return{s0:Y,s1:Q,s2:_e,s3:we}}function FA(c,d,y,C,D){const{sbox2:P,T01:N,T23:h}=Gb;let U=0;d^=c[U++],y^=c[U++],C^=c[U++],D^=c[U++];const H=c.length/4-2;for(let ve=0;ve<H;ve++){const me=c[U++]^Ld(N,h,d,D,C,y),he=c[U++]^Ld(N,h,y,d,D,C),Re=c[U++]^Ld(N,h,C,y,d,D),tt=c[U++]^Ld(N,h,D,C,y,d);d=me,y=he,C=Re,D=tt}const Y=c[U++]^eh(P,d,D,C,y),Q=c[U++]^eh(P,y,d,D,C),_e=c[U++]^eh(P,C,y,d,D),we=c[U++]^eh(P,D,C,y,d);return{s0:Y,s1:Q,s2:_e,s3:we}}function qb(c,d){if(!d)return new Uint8Array(c);if(Ju(d),d.length<c)throw new Error(`aes: wrong destination length, expected at least ${c}, got: ${d.length}`);return d}function jA(c){if(Ju(c),c.length%Bd!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Bd}`)}function UA(c,d,y){let C=c.length;const D=C%Bd;if(!d&&D!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const P=Go(c);if(d){let U=Bd-D;U||(U=Bd),C=C+U}const N=qb(C,y),h=Go(N);return{b:P,o:h,out:N}}function VA(c,d){if(!d)return c;const y=c.length;if(!y)throw new Error("aes/pcks5: empty ciphertext not allowed");const C=c[y-1];if(C<=0||C>16)throw new Error(`aes/pcks5: wrong padding byte: ${C}`);const D=c.subarray(0,-C);for(let P=0;P<C;P++)if(c[y-P-1]!==C)throw new Error("aes/pcks5: wrong padding");return D}function GA(c){const d=new Uint8Array(16),y=Go(d);d.set(c);const C=Bd-c.length;for(let D=Bd-C;D<Bd;D++)d[D]=C;return y}const Zb=RA({blockSize:16,nonceLength:16},function(d,y,C={}){Ju(d),Ju(y,16);const D=!C.disablePadding;return{encrypt:(P,N)=>{const h=Hb(d),{b:U,o:H,out:Y}=UA(P,D,N),Q=Go(y);let _e=Q[0],we=Q[1],ve=Q[2],me=Q[3],he=0;for(;he+4<=U.length;)_e^=U[he+0],we^=U[he+1],ve^=U[he+2],me^=U[he+3],{s0:_e,s1:we,s2:ve,s3:me}=g_(h,_e,we,ve,me),H[he++]=_e,H[he++]=we,H[he++]=ve,H[he++]=me;if(D){const Re=GA(P.subarray(he*4));_e^=Re[0],we^=Re[1],ve^=Re[2],me^=Re[3],{s0:_e,s1:we,s2:ve,s3:me}=g_(h,_e,we,ve,me),H[he++]=_e,H[he++]=we,H[he++]=ve,H[he++]=me}return h.fill(0),Y},decrypt:(P,N)=>{jA(P);const h=BA(d),U=Go(y),H=qb(P.length,N),Y=Go(P),Q=Go(H);let _e=U[0],we=U[1],ve=U[2],me=U[3];for(let he=0;he+4<=Y.length;){const Re=_e,tt=we,Ye=ve,pt=me;_e=Y[he+0],we=Y[he+1],ve=Y[he+2],me=Y[he+3];const{s0:Wt,s1:Et,s2:it,s3:at}=FA(h,_e,we,ve,me);Q[he++]=Wt^Re,Q[he++]=Et^tt,Q[he++]=it^Ye,Q[he++]=at^pt}return h.fill(0),VA(H,D)}}}),Xb=c=>Uint8Array.from(c.split("").map(d=>d.charCodeAt(0))),HA=Xb("expand 16-byte k"),qA=Xb("expand 32-byte k"),ZA=Go(HA),Wb=Go(qA);Wb.slice();function Zr(c,d){return c<<d|c>>>32-d}function Py(c){return c.byteOffset%4===0}const Gm=64,XA=16,Yb=2**32-1,m_=new Uint32Array;function WA(c,d,y,C,D,P,N,h){const U=D.length,H=new Uint8Array(Gm),Y=Go(H),Q=Py(D)&&Py(P),_e=Q?Go(D):m_,we=Q?Go(P):m_;for(let ve=0;ve<U;N++){if(c(d,y,C,Y,N,h),N>=Yb)throw new Error("arx: counter overflow");const me=Math.min(Gm,U-ve);if(Q&&me===Gm){const he=ve/4;if(ve%4!==0)throw new Error("arx: invalid block position");for(let Re=0,tt;Re<XA;Re++)tt=he+Re,we[tt]=_e[tt]^Y[Re];ve+=Gm;continue}for(let he=0,Re;he<me;he++)Re=ve+he,P[Re]=D[Re]^H[he];ve+=me}}function YA(c,d){const{allowShortKeys:y,extendNonceFn:C,counterLength:D,counterRight:P,rounds:N}=NA({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},d);if(typeof c!="function")throw new Error("core must be a function");return uy(D),uy(N),f_(P),f_(y),(h,U,H,Y,Q=0)=>{Ju(h),Ju(U),Ju(H);const _e=H.length;if(Y||(Y=new Uint8Array(_e)),Ju(Y),uy(Q),Q<0||Q>=Yb)throw new Error("arx: counter overflow");if(Y.length<_e)throw new Error(`arx: output (${Y.length}) is shorter than data (${_e})`);const we=[];let ve=h.length,me,he;if(ve===32)me=h.slice(),we.push(me),he=Wb;else if(ve===16&&y)me=new Uint8Array(32),me.set(h),me.set(h,16),he=ZA,we.push(me);else throw new Error(`arx: invalid 32-byte key, got length=${ve}`);Py(U)||(U=U.slice(),we.push(U));const Re=Go(me);if(C){if(U.length!==24)throw new Error("arx: extended nonce must be 24 bytes");C(he,Re,Go(U.subarray(0,16)),Re),U=U.subarray(16)}const tt=16-D;if(tt!==U.length)throw new Error(`arx: nonce must be ${tt} or 16 bytes`);if(tt!==12){const pt=new Uint8Array(12);pt.set(U,P?0:12-U.length),U=pt,we.push(U)}const Ye=Go(U);for(WA(c,he,Re,Ye,H,Y,Q,N);we.length>0;)we.pop().fill(0);return Y}}function $A(c,d,y,C,D,P=20){let N=c[0],h=c[1],U=c[2],H=c[3],Y=d[0],Q=d[1],_e=d[2],we=d[3],ve=d[4],me=d[5],he=d[6],Re=d[7],tt=D,Ye=y[0],pt=y[1],Wt=y[2],Et=N,it=h,at=U,He=H,xt=Y,Pe=Q,ct=_e,vt=we,Zt=ve,Ne=me,Te=he,We=Re,wt=tt,zt=Ye,Gt=pt,ke=Wt;for(let Nt=0;Nt<P;Nt+=2)Et=Et+xt|0,wt=Zr(wt^Et,16),Zt=Zt+wt|0,xt=Zr(xt^Zt,12),Et=Et+xt|0,wt=Zr(wt^Et,8),Zt=Zt+wt|0,xt=Zr(xt^Zt,7),it=it+Pe|0,zt=Zr(zt^it,16),Ne=Ne+zt|0,Pe=Zr(Pe^Ne,12),it=it+Pe|0,zt=Zr(zt^it,8),Ne=Ne+zt|0,Pe=Zr(Pe^Ne,7),at=at+ct|0,Gt=Zr(Gt^at,16),Te=Te+Gt|0,ct=Zr(ct^Te,12),at=at+ct|0,Gt=Zr(Gt^at,8),Te=Te+Gt|0,ct=Zr(ct^Te,7),He=He+vt|0,ke=Zr(ke^He,16),We=We+ke|0,vt=Zr(vt^We,12),He=He+vt|0,ke=Zr(ke^He,8),We=We+ke|0,vt=Zr(vt^We,7),Et=Et+Pe|0,ke=Zr(ke^Et,16),Te=Te+ke|0,Pe=Zr(Pe^Te,12),Et=Et+Pe|0,ke=Zr(ke^Et,8),Te=Te+ke|0,Pe=Zr(Pe^Te,7),it=it+ct|0,wt=Zr(wt^it,16),We=We+wt|0,ct=Zr(ct^We,12),it=it+ct|0,wt=Zr(wt^it,8),We=We+wt|0,ct=Zr(ct^We,7),at=at+vt|0,zt=Zr(zt^at,16),Zt=Zt+zt|0,vt=Zr(vt^Zt,12),at=at+vt|0,zt=Zr(zt^at,8),Zt=Zt+zt|0,vt=Zr(vt^Zt,7),He=He+xt|0,Gt=Zr(Gt^He,16),Ne=Ne+Gt|0,xt=Zr(xt^Ne,12),He=He+xt|0,Gt=Zr(Gt^He,8),Ne=Ne+Gt|0,xt=Zr(xt^Ne,7);let nt=0;C[nt++]=N+Et|0,C[nt++]=h+it|0,C[nt++]=U+at|0,C[nt++]=H+He|0,C[nt++]=Y+xt|0,C[nt++]=Q+Pe|0,C[nt++]=_e+ct|0,C[nt++]=we+vt|0,C[nt++]=ve+Zt|0,C[nt++]=me+Ne|0,C[nt++]=he+Te|0,C[nt++]=Re+We|0,C[nt++]=tt+wt|0,C[nt++]=Ye+zt|0,C[nt++]=pt+Gt|0,C[nt++]=Wt+ke|0}const $b=YA($A,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Qb extends Rb{constructor(d,y){super(),this.finished=!1,this.destroyed=!1,Ku.hash(d);const C=Og(y);if(this.iHash=d.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const D=this.blockLen,P=new Uint8Array(D);P.set(C.length>D?d.create().update(C).digest():C);for(let N=0;N<P.length;N++)P[N]^=54;this.iHash.update(P),this.oHash=d.create();for(let N=0;N<P.length;N++)P[N]^=106;this.oHash.update(P),P.fill(0)}update(d){return Ku.exists(this),this.iHash.update(d),this}digestInto(d){Ku.exists(this),Ku.bytes(d,this.outputLen),this.finished=!0,this.iHash.digestInto(d),this.oHash.update(d),this.oHash.digestInto(d),this.destroy()}digest(){const d=new Uint8Array(this.oHash.outputLen);return this.digestInto(d),d}_cloneInto(d){d||(d=Object.create(Object.getPrototypeOf(this),{}));const{oHash:y,iHash:C,finished:D,destroyed:P,blockLen:N,outputLen:h}=this;return d=d,d.finished=D,d.destroyed=P,d.blockLen=N,d.outputLen=h,d.oHash=y._cloneInto(d.oHash),d.iHash=C._cloneInto(d.iHash),d}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const v1=(c,d,y)=>new Qb(c,d).update(y).digest();v1.create=(c,d)=>new Qb(c,d);function QA(c,d,y){return Ku.hash(c),v1(c,Og(y),Og(d))}const dy=new Uint8Array([0]),y_=new Uint8Array;function KA(c,d,y,C=32){if(Ku.hash(c),Ku.number(C),C>255*c.outputLen)throw new Error("Length should be <= 255*HashLen");const D=Math.ceil(C/c.outputLen);y===void 0&&(y=y_);const P=new Uint8Array(D*c.outputLen),N=v1.create(c,d),h=N._cloneInto(),U=new Uint8Array(N.outputLen);for(let H=0;H<D;H++)dy[0]=H+1,h.update(H===0?y_:U).update(y).update(dy).digestInto(U),P.set(U,c.outputLen*H),N._cloneInto(h);return N.destroy(),h.destroy(),U.fill(0),dy.fill(0),P.slice(0,C)}var JA=Object.defineProperty,js=(c,d)=>{for(var y in d)JA(c,y,{get:d[y],enumerable:!0})},Wf=Symbol("verified"),eE=c=>c instanceof Object;function ix(c){if(!eE(c)||typeof c.kind!="number"||typeof c.content!="string"||typeof c.created_at!="number"||typeof c.pubkey!="string"||!c.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(c.tags))return!1;for(let d=0;d<c.tags.length;d++){let y=c.tags[d];if(!Array.isArray(y))return!1;for(let C=0;C<y.length;C++)if(typeof y[C]!="string")return!1}return!0}var tE={};js(tE,{Queue:()=>Jb,QueueNode:()=>Kb,binarySearch:()=>rx,bytesToHex:()=>Es,hexToBytes:()=>Ud,insertEventIntoAscendingList:()=>iE,insertEventIntoDescendingList:()=>nE,normalizeURL:()=>Qf,utf8Decoder:()=>Uh,utf8Encoder:()=>xu});var Uh=new TextDecoder("utf-8"),xu=new TextEncoder;function Qf(c){try{c.indexOf("://")===-1&&(c="wss://"+c);let d=new URL(c);return d.protocol==="http:"?d.protocol="ws:":d.protocol==="https:"&&(d.protocol="wss:"),d.pathname=d.pathname.replace(/\/+/g,"/"),d.pathname.endsWith("/")&&(d.pathname=d.pathname.slice(0,-1)),(d.port==="80"&&d.protocol==="ws:"||d.port==="443"&&d.protocol==="wss:")&&(d.port=""),d.searchParams.sort(),d.hash="",d.toString()}catch{throw new Error(`Invalid URL: ${c}`)}}function nE(c,d){const[y,C]=rx(c,D=>d.id===D.id?0:d.created_at===D.created_at?-1:D.created_at-d.created_at);return C||c.splice(y,0,d),c}function iE(c,d){const[y,C]=rx(c,D=>d.id===D.id?0:d.created_at===D.created_at?-1:d.created_at-D.created_at);return C||c.splice(y,0,d),c}function rx(c,d){let y=0,C=c.length-1;for(;y<=C;){const D=Math.floor((y+C)/2),P=d(c[D]);if(P===0)return[D,!0];P<0?C=D-1:y=D+1}return[y,!1]}var Kb=class{value;next=null;prev=null;constructor(c){this.value=c}},Jb=class{first;last;constructor(){this.first=null,this.last=null}enqueue(c){const d=new Kb(c);return this.last?this.last===this.first?(this.last=d,this.last.prev=this.first,this.first.next=d):(d.prev=this.last,this.last.next=d,this.last=d):(this.first=d,this.last=d),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const d=this.first;return this.first=null,this.last=null,d.value}const c=this.first;return this.first=c.next,this.first&&(this.first.prev=null),c.value}},rE=class{generateSecretKey(){return Qu.utils.randomPrivateKey()}getPublicKey(d){return Es(Qu.getPublicKey(d))}finalizeEvent(d,y){const C=d;return C.pubkey=Es(Qu.getPublicKey(y)),C.id=$m(C),C.sig=Es(Qu.sign($m(C),y)),C[Wf]=!0,C}verifyEvent(d){if(typeof d[Wf]=="boolean")return d[Wf];const y=$m(d);if(y!==d.id)return d[Wf]=!1,!1;try{const C=Qu.verify(d.sig,y,d.pubkey);return d[Wf]=C,C}catch{return d[Wf]=!1,!1}}};function sE(c){if(!ix(c))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content])}function $m(c){let d=Gd(xu.encode(sE(c)));return Es(d)}var w1=new rE,ev=w1.generateSecretKey,zg=w1.getPublicKey,Lc=w1.finalizeEvent,A1=w1.verifyEvent,aE={};js(aE,{Application:()=>xS,BadgeAward:()=>pE,BadgeDefinition:()=>hS,BlockedRelaysList:()=>XE,BlossomServerList:()=>eS,BookmarkList:()=>HE,Bookmarksets:()=>lS,Calendar:()=>SS,CalendarEventRSVP:()=>CS,ChannelCreation:()=>av,ChannelHideMessage:()=>cv,ChannelMessage:()=>lv,ChannelMetadata:()=>ov,ChannelMuteUser:()=>uv,ChatMessage:()=>gE,ClassifiedListing:()=>vS,ClientAuth:()=>dv,Comment:()=>EE,CommunitiesList:()=>qE,CommunityDefinition:()=>kS,CommunityPostApproval:()=>DE,Contacts:()=>hE,CreateOrUpdateProduct:()=>pS,CreateOrUpdateStall:()=>fS,Curationsets:()=>cS,Date:()=>AS,DirectMessageRelaysList:()=>KE,DraftClassifiedListing:()=>wS,DraftLong:()=>mS,Emojisets:()=>yS,EncryptedDirectMessage:()=>dE,EventDeletion:()=>fE,FavoriteRelays:()=>YE,FileMessage:()=>yE,FileMetadata:()=>AE,FileServerPreference:()=>JE,Followsets:()=>sS,ForumThread:()=>mE,GenericRepost:()=>cx,Genericlists:()=>aS,GiftWrap:()=>hv,GroupMetadata:()=>NS,HTTPAuth:()=>ux,Handlerinformation:()=>MS,Handlerrecommendation:()=>IS,Highlights:()=>FE,InterestsList:()=>$E,Interestsets:()=>dS,JobFeedback:()=>OE,JobRequest:()=>RE,JobResult:()=>PE,Label:()=>NE,LightningPubRPC:()=>nS,LiveChatMessage:()=>SE,LiveEvent:()=>_S,LongFormArticle:()=>gS,Metadata:()=>cE,Mutelist:()=>UE,NWCWalletInfo:()=>tS,NWCWalletRequest:()=>fv,NWCWalletResponse:()=>iS,NormalVideo:()=>_E,NostrConnect:()=>rS,OpenTimestamps:()=>vE,Photo:()=>xE,Pinlist:()=>VE,Poll:()=>wE,PollResponse:()=>jE,PrivateDirectMessage:()=>sv,ProblemTracker:()=>IE,ProfileBadges:()=>uS,PublicChatsList:()=>ZE,Reaction:()=>lx,RecommendRelay:()=>uE,RelayList:()=>GE,RelayReview:()=>TS,Relaysets:()=>oS,Report:()=>ME,Reporting:()=>kE,Repost:()=>ox,Seal:()=>rv,SearchRelaysList:()=>WE,ShortTextNote:()=>iv,ShortVideo:()=>bE,Time:()=>ES,UserEmojiList:()=>QE,UserStatuses:()=>bS,Voice:()=>CE,VoiceComment:()=>TE,Zap:()=>BE,ZapGoal:()=>zE,ZapRequest:()=>LE,classifyKind:()=>oE,isAddressableKind:()=>ax,isEphemeralKind:()=>nv,isKind:()=>lE,isRegularKind:()=>tv,isReplaceableKind:()=>sx});function tv(c){return c<1e4&&c!==0&&c!==3}function sx(c){return c===0||c===3||1e4<=c&&c<2e4}function nv(c){return 2e4<=c&&c<3e4}function ax(c){return 3e4<=c&&c<4e4}function oE(c){return tv(c)?"regular":sx(c)?"replaceable":nv(c)?"ephemeral":ax(c)?"parameterized":"unknown"}function lE(c,d){const y=d instanceof Array?d:[d];return ix(c)&&y.includes(c.kind)||!1}var cE=0,iv=1,uE=2,hE=3,dE=4,fE=5,ox=6,lx=7,pE=8,gE=9,mE=11,rv=13,sv=14,yE=15,cx=16,xE=20,_E=21,bE=22,av=40,ov=41,lv=42,cv=43,uv=44,vE=1040,hv=1059,wE=1068,AE=1063,EE=1111,SE=1311,CE=1222,TE=1244,IE=1971,ME=1984,kE=1984,NE=1985,DE=4550,RE=5999,PE=6999,OE=7e3,zE=9041,LE=9734,BE=9735,FE=9802,jE=1018,UE=1e4,VE=10001,GE=10002,HE=10003,qE=10004,ZE=10005,XE=10006,WE=10007,YE=10012,$E=10015,QE=10030,KE=10050,JE=10096,eS=10063,tS=13194,nS=21e3,dv=22242,fv=23194,iS=23195,rS=24133,ux=27235,sS=3e4,aS=30001,oS=30002,lS=30003,cS=30004,uS=30008,hS=30009,dS=30015,fS=30017,pS=30018,gS=30023,mS=30024,yS=30030,xS=30078,_S=30311,bS=30315,vS=30402,wS=30403,AS=31922,ES=31923,SS=31924,CS=31925,TS=31987,IS=31989,MS=31990,kS=34550,NS=39e3;function DS(c,d){if(c.ids&&c.ids.indexOf(d.id)===-1||c.kinds&&c.kinds.indexOf(d.kind)===-1||c.authors&&c.authors.indexOf(d.pubkey)===-1)return!1;for(let y in c)if(y[0]==="#"){let C=y.slice(1),D=c[`#${C}`];if(D&&!d.tags.find(([P,N])=>P===y.slice(1)&&D.indexOf(N)!==-1))return!1}return!(c.since&&d.created_at<c.since||c.until&&d.created_at>c.until)}function RS(c,d){for(let y=0;y<c.length;y++)if(DS(c[y],d))return!0;return!1}var PS={};js(PS,{getHex64:()=>E1,getInt:()=>pv,getSubscriptionId:()=>gv,matchEventId:()=>OS,matchEventKind:()=>LS,matchEventPubkey:()=>zS});function E1(c,d){let y=d.length+3,C=c.indexOf(`"${d}":`)+y,D=c.slice(C).indexOf('"')+C+1;return c.slice(D,D+64)}function pv(c,d){let y=d.length,C=c.indexOf(`"${d}":`)+y+3,D=c.slice(C),P=Math.min(D.indexOf(","),D.indexOf("}"));return parseInt(D.slice(0,P),10)}function gv(c){let d=c.slice(0,22).indexOf('"EVENT"');if(d===-1)return null;let y=c.slice(d+7+1).indexOf('"');if(y===-1)return null;let C=d+7+1+y,D=c.slice(C+1,80).indexOf('"');if(D===-1)return null;let P=C+1+D;return c.slice(C+1,P)}function OS(c,d){return d===E1(c,"id")}function zS(c,d){return d===E1(c,"pubkey")}function LS(c,d){return d===pv(c,"kind")}var BS={};js(BS,{makeAuthEvent:()=>mv});function mv(c,d){return{kind:dv,created_at:Math.floor(Date.now()/1e3),tags:[["relay",c],["challenge",d]],content:""}}async function FS(){return new Promise((c,d)=>{try{if(typeof MessageChannel<"u"){const y=new MessageChannel,C=()=>{y.port1.removeEventListener("message",C),c()};y.port1.addEventListener("message",C),y.port2.postMessage(0),y.port1.start()}else typeof setImmediate<"u"?setImmediate(c):typeof setTimeout<"u"?setTimeout(c,0):c()}catch(y){console.error("during yield: ",y),d(y)}})}var jS=c=>(c[Wf]=!0,!0),yv=class extends Error{constructor(c,d){super(`Tried to send message '${c} on a closed connection to ${d}.`),this.name="SendingOnClosedConnection"}},xv=class{url;_connected=!1;onclose=null;onnotice=c=>console.debug(`NOTICE from ${this.url}: ${c}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Jb;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(c,d){this.url=Qf(c),this.verifyEvent=d.verifyEvent,this._WebSocket=d.websocketImplementation||WebSocket,this.enablePing=d.enablePing,this.enableReconnect=d.enableReconnect||!1}static async connect(c,d){const y=new xv(c,d);return await y.connect(),y}closeAllSubscriptions(c){for(let[d,y]of this.openSubs)y.close(c);this.openSubs.clear();for(let[d,y]of this.openEventPublishes)y.reject(new Error(c));this.openEventPublishes.clear();for(let[d,y]of this.openCountRequests)y.reject(new Error(c));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const c=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},c)}handleHardClose(c){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const d=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!d?this.reconnect():this.closeAllSubscriptions(c)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((c,d)=>{this.connectionTimeoutHandle=setTimeout(()=>{d("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(y){clearTimeout(this.connectionTimeoutHandle),d(y);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const y=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const C of this.openSubs.values()){if(C.eosed=!1,y)for(let D=0;D<C.filters.length;D++)C.lastEmitted&&(C.filters[D].since=C.lastEmitted+1);C.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),c()},this.ws.onerror=y=>{clearTimeout(this.connectionTimeoutHandle),d(y.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=y=>{clearTimeout(this.connectionTimeoutHandle),d(y.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(c=>{this.ws.once("pong",()=>c(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((c,d)=>{if(!this.connectionPromise)return d(new Error(`no connection to ${this.url}, can't ping`));try{const y=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{c(!0),y.close()},onclose(){c(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(y){d(y)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(d=>setTimeout(()=>d(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await FS();this.queueRunning=!1}handleNext(){const c=this.incomingMessageQueue.dequeue();if(!c)return!1;const d=gv(c);if(d){const y=this.openSubs.get(d);if(!y)return;const C=E1(c,"id"),D=y.alreadyHaveEvent?.(C);if(y.receivedEvent?.(this,C),D)return}try{let y=JSON.parse(c);switch(y[0]){case"EVENT":{const C=this.openSubs.get(y[1]),D=y[2];this.verifyEvent(D)&&RS(C.filters,D)&&C.onevent(D),(!C.lastEmitted||C.lastEmitted<D.created_at)&&(C.lastEmitted=D.created_at);return}case"COUNT":{const C=y[1],D=y[2],P=this.openCountRequests.get(C);P&&(P.resolve(D.count),this.openCountRequests.delete(C));return}case"EOSE":{const C=this.openSubs.get(y[1]);if(!C)return;C.receivedEose();return}case"OK":{const C=y[1],D=y[2],P=y[3],N=this.openEventPublishes.get(C);N&&(clearTimeout(N.timeout),D?N.resolve(P):N.reject(new Error(P)),this.openEventPublishes.delete(C));return}case"CLOSED":{const C=y[1],D=this.openSubs.get(C);if(!D)return;D.closed=!0,D.close(y[2]);return}case"NOTICE":{this.onnotice(y[1]);return}case"AUTH":{this.challenge=y[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(y[1])?.oncustom?.(y);return}}}catch{return}}async send(c){if(!this.connectionPromise)throw new yv(c,this.url);this.connectionPromise.then(()=>{this.ws?.send(c)})}async auth(c){const d=this.challenge;if(!d)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(y,C)=>{try{let D=await c(mv(this.url,d)),P=setTimeout(()=>{let N=this.openEventPublishes.get(D.id);N&&(N.reject(new Error("auth timed out")),this.openEventPublishes.delete(D.id))},this.publishTimeout);this.openEventPublishes.set(D.id,{resolve:y,reject:C,timeout:P}),this.send('["AUTH",'+JSON.stringify(D)+"]")}catch(D){console.warn("subscribe auth function failed:",D)}}),this.authPromise)}async publish(c){const d=new Promise((y,C)=>{const D=setTimeout(()=>{const P=this.openEventPublishes.get(c.id);P&&(P.reject(new Error("publish timed out")),this.openEventPublishes.delete(c.id))},this.publishTimeout);this.openEventPublishes.set(c.id,{resolve:y,reject:C,timeout:D})});return this.send('["EVENT",'+JSON.stringify(c)+"]"),d}async count(c,d){this.serial++;const y=d?.id||"count:"+this.serial,C=new Promise((D,P)=>{this.openCountRequests.set(y,{resolve:D,reject:P})});return this.send('["COUNT","'+y+'",'+JSON.stringify(c).substring(1)),C}subscribe(c,d){const y=this.prepareSubscription(c,d);return y.fire(),y}prepareSubscription(c,d){this.serial++;const y=d.id||(d.label?d.label+":":"sub:")+this.serial,C=new US(this,y,c,d);return this.openSubs.set(y,C),C}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(c){this.incomingMessageQueue.enqueue(c.data),this.queueRunning||this.runQueue()}},US=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(c,d,y,C){if(y.length===0)throw new Error("subscription can't be created with zero filters");this.relay=c,this.filters=y,this.id=d,this.alreadyHaveEvent=C.alreadyHaveEvent,this.receivedEvent=C.receivedEvent,this.eoseTimeout=C.eoseTimeout||c.baseEoseTimeout,this.oneose=C.oneose,this.onclose=C.onclose,this.onevent=C.onevent||(D=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,D)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(c="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(d){if(!(d instanceof yv))throw d}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(c)}},VS;try{VS=WebSocket}catch{}var GS=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(c){this.verifyEvent=c.verifyEvent,this._WebSocket=c.websocketImplementation,this.enablePing=c.enablePing,this.enableReconnect=c.enableReconnect||!1,this.automaticallyAuth=c.automaticallyAuth}async ensureRelay(c,d){c=Qf(c);let y=this.relays.get(c);if(y||(y=new xv(c,{verifyEvent:this.trustedRelayURLs.has(c)?jS:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),y.onclose=()=>{y&&!y.enableReconnect&&this.relays.delete(c)},d?.connectionTimeout&&(y.connectionTimeout=d.connectionTimeout),this.relays.set(c,y)),this.automaticallyAuth){const C=this.automaticallyAuth(c);C&&(y.onauth=C)}return await y.connect(),y}close(c){c.map(Qf).forEach(d=>{this.relays.get(d)?.close(),this.relays.delete(d)})}subscribe(c,d,y){const C=[];for(let D=0;D<c.length;D++){const P=Qf(c[D]);C.find(N=>N.url===P)||C.push({url:P,filter:d})}return this.subscribeMap(C,y)}subscribeMany(c,d,y){const C=[],D=[];for(let P=0;P<c.length;P++){const N=Qf(c[P]);D.indexOf(N)===-1&&(D.push(N),C.push({url:N,filter:d}))}return this.subscribeMap(C,y)}subscribeMap(c,d){const y=new Map;for(const _e of c){const{url:we,filter:ve}=_e;y.has(we)||y.set(we,[]),y.get(we).push(ve)}const C=Array.from(y.entries()).map(([_e,we])=>({url:_e,filters:we}));this.trackRelays&&(d.receivedEvent=(_e,we)=>{let ve=this.seenOn.get(we);ve||(ve=new Set,this.seenOn.set(we,ve)),ve.add(_e)});const D=new Set,P=[],N=[];let h=_e=>{N[_e]||(N[_e]=!0,N.filter(we=>we).length===C.length&&(d.oneose?.(),h=()=>{}))};const U=[];let H=(_e,we)=>{U[_e]||(h(_e),U[_e]=we,U.filter(ve=>ve).length===C.length&&(d.onclose?.(U),H=()=>{}))};const Y=_e=>{if(d.alreadyHaveEvent?.(_e))return!0;const we=D.has(_e);return D.add(_e),we},Q=Promise.all(C.map(async({url:_e,filters:we},ve)=>{let me;try{me=await this.ensureRelay(_e,{connectionTimeout:d.maxWait?Math.max(d.maxWait*.8,d.maxWait-1e3):void 0})}catch(Re){H(ve,Re?.message||String(Re));return}let he=me.subscribe(we,{...d,oneose:()=>h(ve),onclose:Re=>{Re.startsWith("auth-required: ")&&d.onauth?me.auth(d.onauth).then(()=>{me.subscribe(we,{...d,oneose:()=>h(ve),onclose:tt=>{H(ve,tt)},alreadyHaveEvent:Y,eoseTimeout:d.maxWait})}).catch(tt=>{H(ve,`auth was required and attempted, but failed with: ${tt}`)}):H(ve,Re)},alreadyHaveEvent:Y,eoseTimeout:d.maxWait});P.push(he)}));return{async close(_e){await Q,P.forEach(we=>{we.close(_e)})}}}subscribeEose(c,d,y){const C=this.subscribe(c,d,{...y,oneose(){C.close("closed automatically on eose")}});return C}subscribeManyEose(c,d,y){const C=this.subscribeMany(c,d,{...y,oneose(){C.close("closed automatically on eose")}});return C}async querySync(c,d,y){return new Promise(async C=>{const D=[];this.subscribeEose(c,d,{...y,onevent(P){D.push(P)},onclose(P){C(D)}})})}async get(c,d,y){d.limit=1;const C=await this.querySync(c,d,y);return C.sort((D,P)=>P.created_at-D.created_at),C[0]||null}publish(c,d,y){return c.map(Qf).map(async(C,D,P)=>{if(P.indexOf(C)!==D)return Promise.reject("duplicate url");let N=await this.ensureRelay(C);return N.publish(d).catch(async h=>{if(h instanceof Error&&h.message.startsWith("auth-required: ")&&y?.onauth)return await N.auth(y.onauth),N.publish(d);throw h}).then(h=>{if(this.trackRelays){let U=this.seenOn.get(d.id);U||(U=new Set,this.seenOn.set(d.id,U)),U.add(N)}return h})})}listConnectionStatus(){const c=new Map;return this.relays.forEach((d,y)=>c.set(y,d.connected)),c}destroy(){this.relays.forEach(c=>c.close()),this.relays=new Map}},_v;try{_v=WebSocket}catch{}var x_=class extends GS{constructor(c){super({verifyEvent:A1,websocketImplementation:_v,...c})}},Jf={};js(Jf,{BECH32_REGEX:()=>bv,Bech32MaxSize:()=>hx,NostrTypeGuard:()=>HS,decode:()=>S1,decodeNostrURI:()=>ZS,encodeBytes:()=>T1,naddrEncode:()=>KS,neventEncode:()=>QS,noteEncode:()=>YS,nprofileEncode:()=>$S,npubEncode:()=>WS,nsecEncode:()=>XS});var HS={isNProfile:c=>/^nprofile1[a-z\d]+$/.test(c||""),isNEvent:c=>/^nevent1[a-z\d]+$/.test(c||""),isNAddr:c=>/^naddr1[a-z\d]+$/.test(c||""),isNSec:c=>/^nsec1[a-z\d]{58}$/.test(c||""),isNPub:c=>/^npub1[a-z\d]{58}$/.test(c||""),isNote:c=>/^note1[a-z\d]+$/.test(c||""),isNcryptsec:c=>/^ncryptsec1[a-z\d]+$/.test(c||"")},hx=5e3,bv=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function qS(c){const d=new Uint8Array(4);return d[0]=c>>24&255,d[1]=c>>16&255,d[2]=c>>8&255,d[3]=c&255,d}function ZS(c){try{return c.startsWith("nostr:")&&(c=c.substring(6)),S1(c)}catch{return{type:"invalid",data:null}}}function S1(c){let{prefix:d,words:y}=th.decode(c,hx),C=new Uint8Array(th.fromWords(y));switch(d){case"nprofile":{let D=fy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(D[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Es(D[0][0]),relays:D[1]?D[1].map(P=>Uh.decode(P)):[]}}}case"nevent":{let D=fy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for nevent");if(D[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(D[2]&&D[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(D[3]&&D[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Es(D[0][0]),relays:D[1]?D[1].map(P=>Uh.decode(P)):[],author:D[2]?.[0]?Es(D[2][0]):void 0,kind:D[3]?.[0]?parseInt(Es(D[3][0]),16):void 0}}}case"naddr":{let D=fy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!D[2]?.[0])throw new Error("missing TLV 2 for naddr");if(D[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!D[3]?.[0])throw new Error("missing TLV 3 for naddr");if(D[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Uh.decode(D[0][0]),pubkey:Es(D[2][0]),kind:parseInt(Es(D[3][0]),16),relays:D[1]?D[1].map(P=>Uh.decode(P)):[]}}}case"nsec":return{type:d,data:C};case"npub":case"note":return{type:d,data:Es(C)};default:throw new Error(`unknown prefix ${d}`)}}function fy(c){let d={},y=c;for(;y.length>0;){let C=y[0],D=y[1],P=y.slice(2,2+D);if(y=y.slice(2+D),P.length<D)throw new Error(`not enough data to read on TLV ${C}`);d[C]=d[C]||[],d[C].push(P)}return d}function XS(c){return T1("nsec",c)}function WS(c){return T1("npub",Ud(c))}function YS(c){return T1("note",Ud(c))}function C1(c,d){let y=th.toWords(d);return th.encode(c,y,hx)}function T1(c,d){return C1(c,d)}function $S(c){let d=dx({0:[Ud(c.pubkey)],1:(c.relays||[]).map(y=>xu.encode(y))});return C1("nprofile",d)}function QS(c){let d;c.kind!==void 0&&(d=qS(c.kind));let y=dx({0:[Ud(c.id)],1:(c.relays||[]).map(C=>xu.encode(C)),2:c.author?[Ud(c.author)]:[],3:d?[new Uint8Array(d)]:[]});return C1("nevent",y)}function KS(c){let d=new ArrayBuffer(4);new DataView(d).setUint32(0,c.kind,!1);let y=dx({0:[xu.encode(c.identifier)],1:(c.relays||[]).map(C=>xu.encode(C)),2:[Ud(c.pubkey)],3:[new Uint8Array(d)]});return C1("naddr",y)}function dx(c){let d=[];return Object.entries(c).reverse().forEach(([y,C])=>{C.forEach(D=>{let P=new Uint8Array(D.length+2);P.set([parseInt(y)],0),P.set([D.length],1),P.set(D,2),d.push(P)})}),_1(...d)}var JS={};js(JS,{decrypt:()=>eC,encrypt:()=>vv});function vv(c,d,y){const C=c instanceof Uint8Array?Es(c):c,D=v0.getSharedSecret(C,"02"+d),P=wv(D);let N=Uint8Array.from(Ob(16)),h=xu.encode(y),U=Zb(P,N).encrypt(h),H=Vh.encode(new Uint8Array(U)),Y=Vh.encode(new Uint8Array(N.buffer));return`${H}?iv=${Y}`}function eC(c,d,y){const C=c instanceof Uint8Array?Es(c):c;let[D,P]=y.split("?iv="),N=v0.getSharedSecret(C,"02"+d),h=wv(N),U=Vh.decode(P),H=Vh.decode(D),Y=Zb(h,U).decrypt(H);return Uh.decode(Y)}function wv(c){return c.slice(1,33)}var tC={};js(tC,{NIP05_REGEX:()=>fx,isNip05:()=>nC,isValid:()=>sC,queryProfile:()=>Av,searchDomain:()=>rC,useFetchImplementation:()=>iC});var fx=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,nC=c=>fx.test(c||""),I1;try{I1=fetch}catch{}function iC(c){I1=c}async function rC(c,d=""){try{const y=`https://${c}/.well-known/nostr.json?name=${d}`,C=await I1(y,{redirect:"manual"});if(C.status!==200)throw Error("Wrong response code");return(await C.json()).names}catch{return{}}}async function Av(c){const d=c.match(fx);if(!d)return null;const[,y="_",C]=d;try{const D=`https://${C}/.well-known/nostr.json?name=${y}`,P=await I1(D,{redirect:"manual"});if(P.status!==200)throw Error("Wrong response code");const N=await P.json(),h=N.names[y];return h?{pubkey:h,relays:N.relays?.[h]}:null}catch{return null}}async function sC(c,d){const y=await Av(d);return y?y.pubkey===c:!1}var aC={};js(aC,{parse:()=>oC});function oC(c){const d={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let y,C;for(let D=c.tags.length-1;D>=0;D--){const P=c.tags[D];if(P[0]==="e"&&P[1]){const[N,h,U,H,Y]=P,Q={id:h,relays:U?[U]:[],author:Y};if(H==="root"){d.root=Q;continue}if(H==="reply"){d.reply=Q;continue}if(H==="mention"){d.mentions.push(Q);continue}y?C=Q:y=Q,d.mentions.push(Q);continue}if(P[0]==="q"&&P[1]){const[N,h,U]=P;d.quotes.push({id:h,relays:U?[U]:[]})}if(P[0]==="p"&&P[1]){d.profiles.push({pubkey:P[1],relays:P[2]?[P[2]]:[]});continue}}return d.root||(d.root=C||y||d.reply),d.reply||(d.reply=y||d.root),[d.reply,d.root].forEach(D=>{if(!D)return;let P=d.mentions.indexOf(D);if(P!==-1&&d.mentions.splice(P,1),D.author){let N=d.profiles.find(h=>h.pubkey===D.author);N&&N.relays&&(D.relays||(D.relays=[]),N.relays.forEach(h=>{D.relays?.indexOf(h)===-1&&D.relays.push(h)}),N.relays=D.relays)}}),d.mentions.forEach(D=>{if(D.author){let P=d.profiles.find(N=>N.pubkey===D.author);P&&P.relays&&(D.relays||(D.relays=[]),P.relays.forEach(N=>{D.relays.indexOf(N)===-1&&D.relays.push(N)}),P.relays=D.relays)}}),d}var lC={};js(lC,{fetchRelayInformation:()=>uC,useFetchImplementation:()=>cC});var Ev;try{Ev=fetch}catch{}function cC(c){Ev=c}async function uC(c){return await(await fetch(c.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var hC={};js(hC,{fastEventHash:()=>Cv,getPow:()=>Sv,minePow:()=>dC});function Sv(c){let d=0;for(let y=0;y<64;y+=8){const C=parseInt(c.substring(y,y+8),16);if(C===0)d+=32;else{d+=Math.clz32(C);break}}return d}function dC(c,d){let y=0;const C=c,D=["nonce",y.toString(),d.toString()];for(C.tags.push(D);;){const P=Math.floor(new Date().getTime()/1e3);if(P!==C.created_at&&(y=0,C.created_at=P),D[1]=(++y).toString(),C.id=Cv(C),Sv(C.id)>=d)break}return C}function Cv(c){return Es(Gd(xu.encode(JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content]))))}var fC={};js(fC,{unwrapEvent:()=>EC,unwrapManyEvents:()=>SC,wrapEvent:()=>Fv,wrapManyEvents:()=>AC});var pC={};js(pC,{createRumor:()=>Ov,createSeal:()=>zv,createWrap:()=>Lv,unwrapEvent:()=>xx,unwrapManyEvents:()=>Bv,wrapEvent:()=>a1,wrapManyEvents:()=>vC});var Lg={};js(Lg,{decrypt:()=>yx,encrypt:()=>mx,getConversationKey:()=>px,v2:()=>_C});var Tv=1,Iv=65535;function px(c,d){const y=v0.getSharedSecret(c,"02"+d).subarray(1,33);return QA(Gd,y,"nip44-v2")}function Mv(c,d){const y=KA(Gd,c,d,76);return{chacha_key:y.subarray(0,32),chacha_nonce:y.subarray(32,44),hmac_key:y.subarray(44,76)}}function gx(c){if(!Number.isSafeInteger(c)||c<1)throw new Error("expected positive integer");if(c<=32)return 32;const d=1<<Math.floor(Math.log2(c-1))+1,y=d<=256?32:d/8;return y*(Math.floor((c-1)/y)+1)}function gC(c){if(!Number.isSafeInteger(c)||c<Tv||c>Iv)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const d=new Uint8Array(2);return new DataView(d.buffer).setUint16(0,c,!1),d}function mC(c){const d=xu.encode(c),y=d.length,C=gC(y),D=new Uint8Array(gx(y)-y);return _1(C,d,D)}function yC(c){const d=new DataView(c.buffer).getUint16(0),y=c.subarray(2,2+d);if(d<Tv||d>Iv||y.length!==d||c.length!==2+gx(d))throw new Error("invalid padding");return Uh.decode(y)}function kv(c,d,y){if(y.length!==32)throw new Error("AAD associated data must be 32 bytes");const C=_1(y,d);return v1(Gd,c,C)}function xC(c){if(typeof c!="string")throw new Error("payload must be a valid string");const d=c.length;if(d<132||d>87472)throw new Error("invalid payload length: "+d);if(c[0]==="#")throw new Error("unknown encryption version");let y;try{y=Vh.decode(c)}catch(P){throw new Error("invalid base64: "+P.message)}const C=y.length;if(C<99||C>65603)throw new Error("invalid data length: "+C);const D=y[0];if(D!==2)throw new Error("unknown encryption version "+D);return{nonce:y.subarray(1,33),ciphertext:y.subarray(33,-32),mac:y.subarray(-32)}}function mx(c,d,y=Ob(32)){const{chacha_key:C,chacha_nonce:D,hmac_key:P}=Mv(d,y),N=mC(c),h=$b(C,D,N),U=kv(P,h,y);return Vh.encode(_1(new Uint8Array([2]),y,h,U))}function yx(c,d){const{nonce:y,ciphertext:C,mac:D}=xC(c),{chacha_key:P,chacha_nonce:N,hmac_key:h}=Mv(d,y),U=kv(h,C,y);if(!DA(U,D))throw new Error("invalid MAC");const H=$b(P,N,C);return yC(H)}var _C={utils:{getConversationKey:px,calcPaddedLen:gx},encrypt:mx,decrypt:yx},bC=2880*60,Nv=()=>Math.round(Date.now()/1e3),Dv=()=>Math.round(Nv()-Math.random()*bC),Rv=(c,d)=>px(c,d),Pv=(c,d,y)=>mx(JSON.stringify(c),Rv(d,y)),__=(c,d)=>JSON.parse(yx(c.content,Rv(d,c.pubkey)));function Ov(c,d){const y={created_at:Nv(),content:"",tags:[],...c,pubkey:zg(d)};return y.id=$m(y),y}function zv(c,d,y){return Lc({kind:rv,content:Pv(c,d,y),created_at:Dv(),tags:[]},d)}function Lv(c,d){const y=ev();return Lc({kind:hv,content:Pv(c,y,d),created_at:Dv(),tags:[["p",d]]},y)}function a1(c,d,y){const C=Ov(c,d),D=zv(C,d,y);return Lv(D,y)}function vC(c,d,y){if(!y||y.length===0)throw new Error("At least one recipient is required.");const C=zg(d),D=[a1(c,d,C)];return y.forEach(P=>{D.push(a1(c,d,P))}),D}function xx(c,d){const y=__(c,d);return __(y,d)}function Bv(c,d){let y=[];return c.forEach(C=>{y.push(xx(C,d))}),y.sort((C,D)=>C.created_at-D.created_at),y}function wC(c,d,y,C){const D={created_at:Math.ceil(Date.now()/1e3),kind:sv,tags:[],content:d};return(Array.isArray(c)?c:[c]).forEach(({publicKey:N,relayUrl:h})=>{D.tags.push(h?["p",N,h]:["p",N])}),C&&D.tags.push(["e",C.eventId,C.relayUrl||"","reply"]),y&&D.tags.push(["subject",y]),D}function Fv(c,d,y,C,D){const P=wC(d,y,C,D);return a1(P,c,d.publicKey)}function AC(c,d,y,C,D){if(!d||d.length===0)throw new Error("At least one recipient is required.");return[{publicKey:zg(c)},...d].map(N=>Fv(c,N,y,C,D))}var EC=xx,SC=Bv,CC={};js(CC,{finishRepostEvent:()=>TC,getRepostedEvent:()=>IC,getRepostedEventPointer:()=>jv});function TC(c,d,y,C){let D;const P=[...c.tags??[],["e",d.id,y],["p",d.pubkey]];return d.kind===iv?D=ox:(D=cx,P.push(["k",String(d.kind)])),Lc({kind:D,tags:P,content:c.content===""||d.tags?.find(N=>N[0]==="-")?"":JSON.stringify(d),created_at:c.created_at},C)}function jv(c){if(![ox,cx].includes(c.kind))return;let d,y;for(let C=c.tags.length-1;C>=0&&(d===void 0||y===void 0);C--){const D=c.tags[C];D.length>=2&&(D[0]==="e"&&d===void 0?d=D:D[0]==="p"&&y===void 0&&(y=D))}if(d!==void 0)return{id:d[1],relays:[d[2],y?.[2]].filter(C=>typeof C=="string"),author:y?.[1]}}function IC(c,{skipVerification:d}={}){const y=jv(c);if(y===void 0||c.content==="")return;let C;try{C=JSON.parse(c.content)}catch{return}if(C.id===y.id&&!(!d&&!A1(C)))return C}var MC={};js(MC,{NOSTR_URI_REGEX:()=>_x,parse:()=>NC,test:()=>kC});var _x=new RegExp(`nostr:(${bv.source})`);function kC(c){return typeof c=="string"&&new RegExp(`^${_x.source}$`).test(c)}function NC(c){const d=c.match(new RegExp(`^${_x.source}$`));if(!d)throw new Error(`Invalid Nostr URI: ${c}`);return{uri:d[0],value:d[1],decoded:S1(d[1])}}var DC={};js(DC,{finishReactionEvent:()=>RC,getReactedEventPointer:()=>PC});function RC(c,d,y){const C=d.tags.filter(D=>D.length>=2&&(D[0]==="e"||D[0]==="p"));return Lc({...c,kind:lx,tags:[...c.tags??[],...C,["e",d.id],["p",d.pubkey]],content:c.content??"+"},y)}function PC(c){if(c.kind!==lx)return;let d,y;for(let C=c.tags.length-1;C>=0&&(d===void 0||y===void 0);C--){const D=c.tags[C];D.length>=2&&(D[0]==="e"&&d===void 0?d=D:D[0]==="p"&&y===void 0&&(y=D))}if(!(d===void 0||y===void 0))return{id:d[1],relays:[d[2],y[2]].filter(C=>C!==void 0),author:y[1]}}var OC={};js(OC,{parse:()=>LC});var b_=/\W/m,v_=/[^\w\/] |[^\w\/]$|$|,| /m,zC=42;function*LC(c){let d=[];if(typeof c!="string"){for(let P=0;P<c.tags.length;P++){const N=c.tags[P];N[0]==="emoji"&&N.length>=3&&d.push({type:"emoji",shortcode:N[1],url:N[2]})}c=c.content}const y=c.length;let C=0,D=0;e:for(;D<y;){const P=c.indexOf(":",D),N=c.indexOf("#",D);if(P===-1&&N===-1)break e;if(P===-1||N>=0&&N<P){if(N===0||c[N-1]===" "){const h=c.slice(N+1,N+zC).match(b_),U=h?N+1+h.index:y;yield{type:"text",text:c.slice(C,N)},yield{type:"hashtag",value:c.slice(N+1,U)},D=U,C=D;continue e}D=N+1;continue e}if(c.slice(P-5,P)==="nostr"){const h=c.slice(P+60).match(b_),U=h?P+60+h.index:y;try{let H,{data:Y,type:Q}=S1(c.slice(P+1,U));switch(Q){case"npub":H={pubkey:Y};break;case"note":H={id:Y};break;case"nsec":D=U+1;continue;default:H=Y}C!==P-5&&(yield{type:"text",text:c.slice(C,P-5)}),yield{type:"reference",pointer:H},D=U,C=D;continue e}catch{D=P+1;continue e}}else if(c.slice(P-5,P)==="https"||c.slice(P-4,P)==="http"){const h=c.slice(P+4).match(v_),U=h?P+4+h.index:y,H=c[P-1]==="s"?5:4;try{let Y=new URL(c.slice(P-H,U));if(Y.hostname.indexOf(".")===-1)throw new Error("invalid url");if(C!==P-H&&(yield{type:"text",text:c.slice(C,P-H)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(Y.pathname)){yield{type:"image",url:Y.toString()},D=U,C=D;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(Y.pathname)){yield{type:"video",url:Y.toString()},D=U,C=D;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(Y.pathname)){yield{type:"audio",url:Y.toString()},D=U,C=D;continue e}yield{type:"url",url:Y.toString()},D=U,C=D;continue e}catch{D=U+1;continue e}}else if(c.slice(P-3,P)==="wss"||c.slice(P-2,P)==="ws"){const h=c.slice(P+4).match(v_),U=h?P+4+h.index:y,H=c[P-1]==="s"?3:2;try{let Y=new URL(c.slice(P-H,U));if(Y.hostname.indexOf(".")===-1)throw new Error("invalid ws url");C!==P-H&&(yield{type:"text",text:c.slice(C,P-H)}),yield{type:"relay",url:Y.toString()},D=U,C=D;continue e}catch{D=U+1;continue e}}else{for(let h=0;h<d.length;h++){const U=d[h];if(c[P+U.shortcode.length+1]===":"&&c.slice(P+1,P+U.shortcode.length+1)===U.shortcode){C!==P&&(yield{type:"text",text:c.slice(C,P)}),yield U,D=P+U.shortcode.length+2,C=D;continue e}}D=P+1;continue e}}C!==y&&(yield{type:"text",text:c.slice(C)})}var BC={};js(BC,{channelCreateEvent:()=>FC,channelHideMessageEvent:()=>VC,channelMessageEvent:()=>UC,channelMetadataEvent:()=>jC,channelMuteUserEvent:()=>GC});var FC=(c,d)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return Lc({kind:av,tags:[...c.tags??[]],content:y,created_at:c.created_at},d)},jC=(c,d)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return Lc({kind:ov,tags:[["e",c.channel_create_event_id],...c.tags??[]],content:y,created_at:c.created_at},d)},UC=(c,d)=>{const y=[["e",c.channel_create_event_id,c.relay_url,"root"]];return c.reply_to_channel_message_event_id&&y.push(["e",c.reply_to_channel_message_event_id,c.relay_url,"reply"]),Lc({kind:lv,tags:[...y,...c.tags??[]],content:c.content,created_at:c.created_at},d)},VC=(c,d)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return Lc({kind:cv,tags:[["e",c.channel_message_event_id],...c.tags??[]],content:y,created_at:c.created_at},d)},GC=(c,d)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return Lc({kind:uv,tags:[["p",c.pubkey_to_mute],...c.tags??[]],content:y,created_at:c.created_at},d)},HC={};js(HC,{EMOJI_SHORTCODE_REGEX:()=>Uv,matchAll:()=>qC,regex:()=>bx,replaceAll:()=>ZC});var Uv=/:(\w+):/,bx=()=>new RegExp(`\\B${Uv.source}\\B`,"g");function*qC(c){const d=c.matchAll(bx());for(const y of d)try{const[C,D]=y;yield{shortcode:C,name:D,start:y.index,end:y.index+C.length}}catch{}}function ZC(c,d){return c.replaceAll(bx(),(y,C)=>d({shortcode:y,name:C}))}var XC={};js(XC,{useFetchImplementation:()=>WC,validateGithub:()=>YC});var vx;try{vx=fetch}catch{}function WC(c){vx=c}async function YC(c,d,y){try{return await(await vx(`https://gist.github.com/${d}/${y}/raw`)).text()===`Verifying that I control the following Nostr public key: ${c}`}catch{return!1}}var $C={};js($C,{makeNwcRequestEvent:()=>KC,parseConnectionString:()=>QC});function QC(c){const{host:d,pathname:y,searchParams:C}=new URL(c),D=y||d,P=C.get("relay"),N=C.get("secret");if(!D||!P||!N)throw new Error("invalid connection string");return{pubkey:D,relay:P,secret:N}}async function KC(c,d,y){const D=vv(d,c,JSON.stringify({method:"pay_invoice",params:{invoice:y}})),P={kind:fv,created_at:Math.round(Date.now()/1e3),content:D,tags:[["p",c]]};return Lc(P,d)}var JC={};js(JC,{normalizeIdentifier:()=>e3});function e3(c){return c=c.trim().toLowerCase(),c=c.normalize("NFKC"),Array.from(c).map(d=>new RegExp("\\p{Letter}","u").test(d)||new RegExp("\\p{Number}","u").test(d)?d:"-").join("")}var t3={};js(t3,{getSatoshisAmountFromBolt11:()=>o3,getZapEndpoint:()=>i3,makeZapReceipt:()=>a3,makeZapRequest:()=>r3,useFetchImplementation:()=>n3,validateZapRequest:()=>s3});var wx;try{wx=fetch}catch{}function n3(c){wx=c}async function i3(c){try{let d="",{lud06:y,lud16:C}=JSON.parse(c.content);if(C){let[N,h]=C.split("@");d=new URL(`/.well-known/lnurlp/${N}`,`https://${h}`).toString()}else if(y){let{words:N}=th.decode(y,1e3),h=th.fromWords(N);d=Uh.decode(h)}else return null;let P=await(await wx(d)).json();if(P.allowsNostr&&P.nostrPubkey)return P.callback}catch{}return null}function r3(c){let d={kind:9734,created_at:Math.round(Date.now()/1e3),content:c.comment||"",tags:[["p","pubkey"in c?c.pubkey:c.event.pubkey],["amount",c.amount.toString()],["relays",...c.relays]]};if("event"in c){if(d.tags.push(["e",c.event.id]),sx(c.event.kind)){const y=["a",`${c.event.kind}:${c.event.pubkey}:`];d.tags.push(y)}else if(ax(c.event.kind)){let y=c.event.tags.find(([D,P])=>D==="d"&&P);if(!y)throw new Error("d tag not found or is empty");const C=["a",`${c.event.kind}:${c.event.pubkey}:${y[1]}`];d.tags.push(C)}d.tags.push(["k",c.event.kind.toString()])}return d}function s3(c){let d;try{d=JSON.parse(c)}catch{return"Invalid zap request JSON."}if(!ix(d))return"Zap request is not a valid Nostr event.";if(!A1(d))return"Invalid signature on zap request.";let y=d.tags.find(([P,N])=>P==="p"&&N);if(!y)return"Zap request doesn't have a 'p' tag.";if(!y[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let C=d.tags.find(([P,N])=>P==="e"&&N);return C&&!C[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":d.tags.find(([P,N])=>P==="relays"&&N)?null:"Zap request doesn't have a 'relays' tag."}function a3({zapRequest:c,preimage:d,bolt11:y,paidAt:C}){let D=JSON.parse(c),P=D.tags.filter(([h])=>h==="e"||h==="p"||h==="a"),N={kind:9735,created_at:Math.round(C.getTime()/1e3),content:"",tags:[...P,["P",D.pubkey],["bolt11",y],["description",c]]};return d&&N.tags.push(["preimage",d]),N}function o3(c){if(c.length<50)return 0;c=c.substring(0,50);const d=c.lastIndexOf("1");if(d===-1)return 0;const y=c.substring(0,d);if(!y.startsWith("lnbc"))return 0;const C=y.substring(4);if(C.length<1)return 0;const D=C[C.length-1],P=D.charCodeAt(0)-48,N=P>=0&&P<=9;let h=C.length-1;if(N&&h++,h<1)return 0;const U=parseInt(C.substring(0,h));switch(D){case"m":return U*1e5;case"u":return U*100;case"n":return U/10;case"p":return U/1e4;default:return U*1e8}}var l3={};js(l3,{Negentropy:()=>Gv,NegentropyStorageVector:()=>h3,NegentropySync:()=>d3});var py=97,y0=32,Vv=16,qf={Skip:0,Fingerprint:1,IdList:2},Fh=class{_raw;length;constructor(c){typeof c=="number"?(this._raw=new Uint8Array(c),this.length=0):c instanceof Uint8Array?(this._raw=new Uint8Array(c),this.length=c.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(c){if(c instanceof Fh&&(c=c.unwrap()),typeof c.length!="number")throw Error("bad length");const d=c.length+this.length;if(this.capacity<d){const y=this._raw,C=Math.max(this.capacity*2,d);this._raw=new Uint8Array(C),this._raw.set(y)}this._raw.set(c,this.length),this.length+=c.length}shift(){const c=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,c}shiftN(c=1){const d=this._raw.subarray(0,c);return this._raw=this._raw.subarray(c),this.length-=c,d}};function Hm(c){let d=0;for(;;){if(c.length===0)throw Error("parse ends prematurely");let y=c.shift();if(d=d<<7|y&127,(y&128)===0)break}return d}function zh(c){if(c===0)return new Fh(new Uint8Array([0]));let d=[];for(;c!==0;)d.push(c&127),c>>>=7;d.reverse();for(let y=0;y<d.length-1;y++)d[y]|=128;return new Fh(new Uint8Array(d))}function c3(c){return Qm(c,1)[0]}function Qm(c,d){if(c.length<d)throw Error("parse ends prematurely");return c.shiftN(d)}var u3=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(y0)}add(c){let d=0,y=0,C=new DataView(this.buf.buffer),D=new DataView(c.buffer);for(let P=0;P<8;P++){let N=P*4,h=C.getUint32(N,!0),U=D.getUint32(N,!0),H=h;H+=d,H+=U,H>4294967295&&(y=1),C.setUint32(N,H&4294967295,!0),d=y,y=0}}negate(){let c=new DataView(this.buf.buffer);for(let y=0;y<8;y++){let C=y*4;c.setUint32(C,~c.getUint32(C,!0))}let d=new Uint8Array(y0);d[0]=1,this.add(d)}getFingerprint(c){let d=new Fh;return d.extend(this.buf),d.extend(zh(c)),Gd(d.unwrap()).subarray(0,Vv)}},h3=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(c,d){if(this.sealed)throw Error("already sealed");const y=Ub(d);if(y.byteLength!==y0)throw Error("bad id size for added item");this.items.push({timestamp:c,id:y})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(gy);for(let c=1;c<this.items.length;c++)if(gy(this.items[c-1],this.items[c])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(c){if(this._checkSealed(),c>=this.items.length)throw Error("out of range");return this.items[c]}iterate(c,d,y){this._checkSealed(),this._checkBounds(c,d);for(let C=c;C<d&&y(this.items[C],C);++C);}findLowerBound(c,d,y){return this._checkSealed(),this._checkBounds(c,d),this._binarySearch(this.items,c,d,C=>gy(C,y)<0)}fingerprint(c,d){let y=new u3;return y.setToZero(),this.iterate(c,d,C=>(y.add(C.id),!0)),y.getFingerprint(d-c)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(c,d){if(c>d||d>this.items.length)throw Error("bad range")}_binarySearch(c,d,y,C){let D=y-d;for(;D>0;){let P=d,N=Math.floor(D/2);P+=N,C(c[P])?(d=++P,D-=N+1):D=N}return d}},Gv=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(c,d=6e4){if(d<4096)throw Error("frameSizeLimit too small");this.storage=c,this.frameSizeLimit=d,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(c,d){return{timestamp:c,id:d||new Uint8Array(0)}}initiate(){let c=new Fh;return c.extend(new Uint8Array([py])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),c),f0(c.unwrap())}reconcile(c,d,y){const C=new Fh(Ub(c));this.lastTimestampIn=this.lastTimestampOut=0;let D=new Fh;D.extend(new Uint8Array([py]));let P=c3(C);if(P<96||P>111)throw Error("invalid negentropy protocol version byte");if(P!==py)throw Error("unsupported negentropy protocol version requested: "+(P-96));let N=this.storage.size(),h=this._bound(0),U=0,H=!1;for(;C.length!==0;){let Y=new Fh,Q=()=>{H&&(H=!1,Y.extend(this.encodeBound(h)),Y.extend(zh(qf.Skip)))},_e=this.decodeBound(C),we=Hm(C),ve=U,me=this.storage.findLowerBound(U,N,_e);if(we===qf.Skip)H=!0;else if(we===qf.Fingerprint){let he=Qm(C,Vv),Re=this.storage.fingerprint(ve,me);Hv(he,Re)!==0?(Q(),this.splitRange(ve,me,_e,Y)):H=!0}else if(we===qf.IdList){let he=Hm(C),Re={};for(let tt=0;tt<he;tt++){let Ye=Qm(C,y0);Re[f0(Ye)]=Ye}if(H=!0,this.storage.iterate(ve,me,tt=>{let Ye=tt.id;const pt=f0(Ye);return Re[pt]?delete Re[f0(Ye)]:d?.(pt),!0}),y)for(let tt of Object.values(Re))y(f0(tt))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(D.length+Y.length)){let he=this.storage.fingerprint(me,N);D.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),D.extend(zh(qf.Fingerprint)),D.extend(he);break}else D.extend(Y);U=me,h=_e}return D.length===1?null:f0(D.unwrap())}splitRange(c,d,y,C){let D=d-c,P=16;if(D<P*2)C.extend(this.encodeBound(y)),C.extend(zh(qf.IdList)),C.extend(zh(D)),this.storage.iterate(c,d,N=>(C.extend(N.id),!0));else{let N=Math.floor(D/P),h=D%P,U=c;for(let H=0;H<P;H++){let Y=N+(H<h?1:0),Q=this.storage.fingerprint(U,U+Y);U+=Y;let _e;if(U===d)_e=y;else{let we,ve;this.storage.iterate(U-1,U+1,(me,he)=>(he===U-1?we=me:ve=me,!0)),_e=this.getMinimalBound(we,ve)}C.extend(this.encodeBound(_e)),C.extend(zh(qf.Fingerprint)),C.extend(Q)}}}exceededFrameSizeLimit(c){return c>this.frameSizeLimit-200}decodeTimestampIn(c){let d=Hm(c);return d=d===0?Number.MAX_VALUE:d-1,this.lastTimestampIn===Number.MAX_VALUE||d===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(d+=this.lastTimestampIn,this.lastTimestampIn=d,d)}decodeBound(c){let d=this.decodeTimestampIn(c),y=Hm(c);if(y>y0)throw Error("bound key too long");let C=Qm(c,y);return{timestamp:d,id:C}}encodeTimestampOut(c){if(c===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,zh(0);let d=c;return c-=this.lastTimestampOut,this.lastTimestampOut=d,zh(c+1)}encodeBound(c){let d=new Fh;return d.extend(this.encodeTimestampOut(c.timestamp)),d.extend(zh(c.id.length)),d.extend(c.id),d}getMinimalBound(c,d){if(d.timestamp!==c.timestamp)return this._bound(d.timestamp);{let y=0,C=d.id,D=c.id;for(let P=0;P<y0&&C[P]===D[P];P++)y++;return this._bound(d.timestamp,d.id.subarray(0,y+1))}}};function Hv(c,d){for(let y=0;y<c.byteLength;y++){if(c[y]<d[y])return-1;if(c[y]>d[y])return 1}return c.byteLength>d.byteLength?1:c.byteLength<d.byteLength?-1:0}function gy(c,d){return c.timestamp===d.timestamp?Hv(c.id,d.id):c.timestamp-d.timestamp}var d3=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(c,d,y,C={}){this.relay=c,this.storage=d,this.neg=new Gv(d),this.onhave=C.onhave,this.onneed=C.onneed,this.filter=y,this.subscription=this.relay.prepareSubscription([{}],{label:C.label||"negentropy"}),this.subscription.oncustom=D=>{switch(D[0]){case"NEG-MSG":{D.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${D}`);try{const P=this.neg.reconcile(D[2],this.onhave,this.onneed);P?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${P}"]`):(this.close(),C.onclose?.())}catch(P){console.error("negentropy reconcile error:",P),C?.onclose?.(`reconcile error: ${P}`)}break}case"NEG-CLOSE":{const P=D[2];console.warn("negentropy error:",P),C.onclose?.(P);break}case"NEG-ERR":C.onclose?.()}}}async start(){const c=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${c}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},f3={};js(f3,{getToken:()=>p3,hashPayload:()=>Ax,unpackEventFromToken:()=>Zv,validateEvent:()=>Kv,validateEventKind:()=>Wv,validateEventMethodTag:()=>$v,validateEventPayloadTag:()=>Qv,validateEventTimestamp:()=>Xv,validateEventUrlTag:()=>Yv,validateToken:()=>g3});var qv="Nostr ";async function p3(c,d,y,C=!1,D){const P={kind:ux,tags:[["u",c],["method",d]],created_at:Math.round(new Date().getTime()/1e3),content:""};D&&P.tags.push(["payload",Ax(D)]);const N=await y(P);return(C?qv:"")+Vh.encode(xu.encode(JSON.stringify(N)))}async function g3(c,d,y){const C=await Zv(c).catch(P=>{throw P});return await Kv(C,d,y).catch(P=>{throw P})}async function Zv(c){if(!c)throw new Error("Missing token");c=c.replace(qv,"");const d=Uh.decode(Vh.decode(c));if(!d||d.length===0||!d.startsWith("{"))throw new Error("Invalid token");return JSON.parse(d)}function Xv(c){return c.created_at?Math.round(new Date().getTime()/1e3)-c.created_at<60:!1}function Wv(c){return c.kind===ux}function Yv(c,d){const y=c.tags.find(C=>C[0]==="u");return y?y.length>0&&y[1]===d:!1}function $v(c,d){const y=c.tags.find(C=>C[0]==="method");return y?y.length>0&&y[1].toLowerCase()===d.toLowerCase():!1}function Ax(c){const d=Gd(xu.encode(JSON.stringify(c)));return Es(d)}function Qv(c,d){const y=c.tags.find(D=>D[0]==="payload");if(!y)return!1;const C=Ax(d);return y.length>0&&y[1]===C}async function Kv(c,d,y,C){if(!A1(c))throw new Error("Invalid nostr event, signature invalid");if(!Wv(c))throw new Error("Invalid nostr event, kind invalid");if(!Xv(c))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Yv(c,d))throw new Error("Invalid nostr event, url tag invalid");if(!$v(c,y))throw new Error("Invalid nostr event, method tag invalid");if(C&&typeof C=="object"&&Object.keys(C).length>0&&!Qv(c,C))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Ln={PARKING_LOG:31417,PARKING_AREA_INDICATOR:31714,ROUTE_LOG:34171,RELAY_LIST:10002,LISTED_PARKING_METADATA:31147,PARKING_SPOT_LISTING:37141,LISTED_SPOT_LOG:1714,PRIVATE_LOG_NOTE:1417,LABEL:1985},jh="f8ecf5df652f567970ec6d00538cc15c4cec9d0c88760cd8b4c86acd43542e5a",ei=["wss://relay.primal.net","wss://nos.lol","wss://relay.snort.social"];class m3{relayHealth=new Map;listeners=new Set;subscribe(d){return this.listeners.add(d),d(this.relayHealth),()=>this.listeners.delete(d)}notifyListeners(){this.listeners.forEach(d=>d(this.relayHealth))}initialize(d){d.forEach(y=>{this.relayHealth.has(y)||this.relayHealth.set(y,{url:y,connected:!0,lastSuccess:Date.now(),lastFailure:0,avgLatency:0,failureCount:0,successCount:0})})}recordSuccess(d,y){const C=this.relayHealth.get(d);C&&(C.connected=!0,C.lastSuccess=Date.now(),C.successCount++,C.avgLatency=C.avgLatency===0?y:C.avgLatency*.8+y*.2,this.notifyListeners())}recordFailure(d){const y=this.relayHealth.get(d);y&&(y.lastFailure=Date.now(),y.failureCount++,y.failureCount>=3&&Date.now()-y.lastSuccess>3e4&&(y.connected=!1,console.warn(`[Parlens] Relay ${d} marked unhealthy after ${y.failureCount} failures`)),this.notifyListeners())}getHealthyRelays(d){const y=d.filter(C=>{const D=this.relayHealth.get(C);return D?D.connected:!0});return y.length===0&&d.length>0?(this.resetAll(),d):y}getSortedByLatency(d){return[...d].sort((y,C)=>{const D=this.relayHealth.get(y),P=this.relayHealth.get(C),N=D?.avgLatency||0,h=P?.avgLatency||0;return N-h})}markConnected(d){const y=this.relayHealth.get(d);y&&(y.connected=!0,y.failureCount=0)}resetAll(){this.relayHealth.forEach(d=>{d.connected=!0,d.failureCount=0}),this.notifyListeners(),console.log("[Parlens] Relay health monitor reset")}getStats(){return Array.from(this.relayHealth.values())}}const vo=new m3,w_=c=>Array.from(c).map(d=>d.toString(16).padStart(2,"0")).join(""),Jv=ge.createContext(null),y3=({children:c})=>{const[d,y]=ge.useState(localStorage.getItem("parlens_pubkey")),[C,D]=ge.useState(()=>new x_({enablePing:!0,enableReconnect:!0}));ge.useEffect(()=>{vo.initialize(ei),console.log("[Parlens] Relay health monitor initialized for:",ei)},[]);const P=async()=>{console.log("[Parlens] Refreshing relay connections...");try{C.close(ei)}catch(Q){console.warn("[Parlens] Error closing connections:",Q)}vo.resetAll();const Y=new x_({enablePing:!0,enableReconnect:!0});await Promise.allSettled(ei.map(Q=>Y.ensureRelay(Q))),D(Y),console.log("[Parlens] Connections refreshed. New pool instance created.")};ge.useEffect(()=>{let Y=0;const Q=()=>{if(document.visibilityState==="hidden")Y=Date.now();else if(document.visibilityState==="visible"&&Y>0){const _e=Date.now()-Y;_e>5e3&&(console.log("[Parlens] App resumed after",_e,"ms - refreshing connections"),P())}};return document.addEventListener("visibilitychange",Q),()=>document.removeEventListener("visibilitychange",Q)},[C]);const N=async(Y,Q,_e)=>{let we="",ve=null;if(Y==="extension"){if(!window.nostr)throw new Error("Nostr extension not found");we=await window.nostr.getPublicKey()}else if(Y==="nsec"&&Q)try{const me=Jf.decode(Q);if(me.type!=="nsec")throw new Error("Not an nsec");ve=me.data,we=zg(ve),localStorage.setItem("parlens_privkey",w_(ve))}catch{throw new Error("Invalid nsec format")}else Y==="create"&&(ve=ev(),we=zg(ve),localStorage.setItem("parlens_privkey",w_(ve)));if(y(we),localStorage.setItem("parlens_pubkey",we),Y==="create"&&_e&&ve)try{const me=Lc({kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:_e,display_name:_e,picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${we}`})},ve);await Promise.any([C.publish(["wss://relay.damus.io","wss://nos.lol"],me)])}catch(me){console.warn("Failed to publish metadata:",me)}},h=()=>{y(null),localStorage.removeItem("parlens_pubkey"),localStorage.removeItem("parlens_privkey")},U=async()=>{if(d){try{const Y={kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:"Deleted User",about:"This account has been deleted by the user.",picture:"",deleted:!0})},Q=await H(Y);await Promise.allSettled(C.publish(ei,Q))}catch(Y){console.error("Failed to publish deletion metadata:",Y)}h()}},H=async Y=>{const Q=localStorage.getItem("parlens_privkey");if(Q){const _e=new Uint8Array(Q.match(/.{1,2}/g).map(we=>parseInt(we,16)));return Lc(Y,_e)}if(window.nostr)return await window.nostr.signEvent(Y);throw new Error("No signing method available")};return M.jsx(Jv.Provider,{value:{pubkey:d,login:N,logout:h,deleteAccount:U,pool:C,signEvent:H,refreshConnections:P},children:c})},nh=()=>{const c=ge.useContext(Jv);if(!c)throw new Error("useAuth must be used within AuthProvider");return c};const x3=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),_3=c=>c.replace(/^([A-Z])|[\s-_]+(\w)/g,(d,y,C)=>C?C.toUpperCase():y.toLowerCase()),A_=c=>{const d=_3(c);return d.charAt(0).toUpperCase()+d.slice(1)},e2=(...c)=>c.filter((d,y,C)=>!!d&&d.trim()!==""&&C.indexOf(d)===y).join(" ").trim(),b3=c=>{for(const d in c)if(d.startsWith("aria-")||d==="role"||d==="title")return!0};var v3={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const w3=ge.forwardRef(({color:c="currentColor",size:d=24,strokeWidth:y=2,absoluteStrokeWidth:C,className:D="",children:P,iconNode:N,...h},U)=>ge.createElement("svg",{ref:U,...v3,width:d,height:d,stroke:c,strokeWidth:C?Number(y)*24/Number(d):y,className:e2("lucide",D),...!P&&!b3(h)&&{"aria-hidden":"true"},...h},[...N.map(([H,Y])=>ge.createElement(H,Y)),...Array.isArray(P)?P:[P]]));const nr=(c,d)=>{const y=ge.forwardRef(({className:C,...D},P)=>ge.createElement(w3,{ref:P,iconNode:d,className:e2(`lucide-${x3(A_(c))}`,`lucide-${c}`,C),...D}));return y.displayName=A_(c),y};const A3=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ex=nr("arrow-left",A3);const E3=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],t2=nr("arrow-right",E3);const S3=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],C3=nr("arrow-up-down",S3);const T3=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],I3=nr("arrow-up",T3);const M3=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Sx=nr("ban",M3);const k3=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ep=nr("check",k3);const N3=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Fd=nr("chevron-down",N3);const D3=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ip=nr("chevron-right",D3);const R3=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],M1=nr("chevron-up",R3);const P3=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],n2=nr("clock",P3);const O3=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],i2=nr("copy",O3);const z3=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],L3=nr("ellipsis-vertical",z3);const B3=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Cx=nr("eye-off",B3);const F3=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],j3=nr("eye",F3);const U3=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],V3=nr("folder-open",U3);const G3=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],H3=nr("info",G3);const q3=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Oy=nr("key",q3);const Z3=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],X3=nr("locate-fixed",Z3);const W3=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],qm=nr("locate",W3);const Y3=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],to=nr("map-pin",Y3);const $3=[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]],Q3=nr("map-pinned",$3);const K3=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],J3=nr("navigation",K3);const eT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Vd=nr("pencil",eT);const tT=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],o1=nr("plus",tT);const nT=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],r2=nr("qr-code",nT);const iT=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],E_=nr("radio",iT);const rT=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],sT=nr("refresh-cw",rT);const aT=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],S_=nr("rotate-cw",aT);const oT=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],s2=nr("route",oT);const lT=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],cT=nr("save",lT);const uT=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],hT=nr("scan-line",uT);const dT=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],a2=nr("search",dT);const fT=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],pT=nr("share-2",fT);const gT=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],o2=nr("shield",gT);const mT=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],C_=nr("star",mT);const yT=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],rp=nr("trash-2",yT);const xT=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],T_=nr("trash",xT);const _T=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],bT=nr("triangle-alert",_T);const vT=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],wT=nr("user-plus",vT);const AT=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ET=nr("user",AT);const ST=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],CT=nr("users",ST);const TT=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],no=nr("x",TT),IT=ge.createContext(null);function MT(c,d){const y=Array.isArray(c)?c[0]:c?c.x:0,C=Array.isArray(c)?c[1]:c?c.y:0,D=Array.isArray(d)?d[0]:d?d.x:0,P=Array.isArray(d)?d[1]:d?d.y:0;return y===D&&C===P}function Pl(c,d){if(c===d)return!0;if(!c||!d)return!1;if(Array.isArray(c)){if(!Array.isArray(d)||c.length!==d.length)return!1;for(let y=0;y<c.length;y++)if(!Pl(c[y],d[y]))return!1;return!0}else if(Array.isArray(d))return!1;if(typeof c=="object"&&typeof d=="object"){const y=Object.keys(c),C=Object.keys(d);if(y.length!==C.length)return!1;for(const D of y)if(!d.hasOwnProperty(D)||!Pl(c[D],d[D]))return!1;return!0}return!1}function I_(c){return{longitude:c.center.lng,latitude:c.center.lat,zoom:c.zoom,pitch:c.pitch,bearing:c.bearing,padding:c.padding}}function M_(c,d){const y=d.viewState||d,C={};if("longitude"in y&&"latitude"in y&&(y.longitude!==c.center.lng||y.latitude!==c.center.lat)){const D=c.center.constructor;C.center=new D(y.longitude,y.latitude)}return"zoom"in y&&y.zoom!==c.zoom&&(C.zoom=y.zoom),"bearing"in y&&y.bearing!==c.bearing&&(C.bearing=y.bearing),"pitch"in y&&y.pitch!==c.pitch&&(C.pitch=y.pitch),y.padding&&c.padding&&!Pl(y.padding,c.padding)&&(C.padding=y.padding),C}const kT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function k_(c){if(!c)return null;if(typeof c=="string"||("toJS"in c&&(c=c.toJS()),!c.layers))return c;const d={};for(const C of c.layers)d[C.id]=C;const y=c.layers.map(C=>{let D=null;"interactive"in C&&(D=Object.assign({},C),delete D.interactive);const P=d[C.ref];if(P){D=D||Object.assign({},C),delete D.ref;for(const N of kT)N in P&&(D[N]=P[N])}return D||C});return{...c,layers:y}}const N_={version:8,sources:{},layers:[]},D_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},R_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},P_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},NT=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],DT=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class b0{constructor(d,y,C){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=D=>{const P=this.props[P_[D.type]];P?P(D):D.type==="error"&&console.error(D.error)},this._onCameraEvent=D=>{if(this._internalUpdate)return;D.viewState=this._propsedCameraUpdate||I_(this._map.transform);const P=this.props[R_[D.type]];P&&P(D)},this._onCameraUpdate=D=>this._internalUpdate?D:(this._propsedCameraUpdate=I_(D),M_(D,this.props)),this._onPointerEvent=D=>{(D.type==="mousemove"||D.type==="mouseout")&&this._updateHover(D);const P=this.props[D_[D.type]];P&&(this.props.interactiveLayerIds&&D.type!=="mouseover"&&D.type!=="mouseout"&&(D.features=this._hoveredFeatures||this._queryRenderedFeatures(D.point)),P(D),delete D.features)},this._MapClass=d,this.props=y,this._initialize(C)}get map(){return this._map}setProps(d){const y=this.props;this.props=d;const C=this._updateSettings(d,y),D=this._updateSize(d),P=this._updateViewState(d);this._updateStyle(d,y),this._updateStyleComponents(d),this._updateHandlers(d,y),(C||D||P&&!this._map.isMoving())&&this.redraw()}static reuse(d,y){const C=b0.savedMaps.pop();if(!C)return null;const D=C.map,P=D.getContainer();for(y.className=P.className;P.childNodes.length>0;)y.appendChild(P.childNodes[0]);D._container=y;const N=D._resizeObserver;N&&(N.disconnect(),N.observe(y)),C.setProps({...d,styleDiffing:!1}),D.resize();const{initialViewState:h}=d;return h&&(h.bounds?D.fitBounds(h.bounds,{...h.fitBoundsOptions,duration:0}):C._updateViewState(h)),D.isStyleLoaded()?D.fire("load"):D.once("style.load",()=>D.fire("load")),D._update(),C}_initialize(d){const{props:y}=this,{mapStyle:C=N_}=y,D={...y,...y.initialViewState,container:d,style:k_(C)},P=D.initialViewState||D.viewState||D;if(Object.assign(D,{center:[P.longitude||0,P.latitude||0],zoom:P.zoom||0,pitch:P.pitch||0,bearing:P.bearing||0}),y.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,y.gl)}const N=new this._MapClass(D);P.padding&&N.setPadding(P.padding),y.cursor&&(N.getCanvas().style.cursor=y.cursor),N.transformCameraUpdate=this._onCameraUpdate,N.on("style.load",()=>{this._styleComponents={light:N.getLight(),sky:N.getSky(),projection:N.getProjection?.(),terrain:N.getTerrain()},this._updateStyleComponents(this.props)}),N.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const h in D_)N.on(h,this._onPointerEvent);for(const h in R_)N.on(h,this._onCameraEvent);for(const h in P_)N.on(h,this._onEvent);this._map=N}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),b0.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const d=this._map;d.style&&(d._frame&&(d._frame.cancel(),d._frame=null),d._render())}_updateSize(d){const{viewState:y}=d;if(y){const C=this._map;if(y.width!==C.transform.width||y.height!==C.transform.height)return C.resize(),!0}return!1}_updateViewState(d){const y=this._map,C=y.transform;if(!y.isMoving()){const P=M_(C,d);if(Object.keys(P).length>0)return this._internalUpdate=!0,y.jumpTo(P),this._internalUpdate=!1,!0}return!1}_updateSettings(d,y){const C=this._map;let D=!1;for(const P of NT)P in d&&!Pl(d[P],y[P])&&(D=!0,C[`set${P[0].toUpperCase()}${P.slice(1)}`]?.call(C,d[P]));return D}_updateStyle(d,y){if(d.cursor!==y.cursor&&(this._map.getCanvas().style.cursor=d.cursor||""),d.mapStyle!==y.mapStyle){const{mapStyle:C=N_,styleDiffing:D=!0}=d,P={diff:D};"localIdeographFontFamily"in d&&(P.localIdeographFontFamily=d.localIdeographFontFamily),this._map.setStyle(k_(C),P)}}_updateStyleComponents({light:d,projection:y,sky:C,terrain:D}){const P=this._map,N=this._styleComponents;P.style._loaded&&(d&&!Pl(d,N.light)&&(N.light=d,P.setLight(d)),y&&!Pl(y,N.projection)&&y!==N.projection?.type&&(N.projection=typeof y=="string"?{type:y}:y,P.setProjection?.(N.projection)),C&&!Pl(C,N.sky)&&(N.sky=C,P.setSky(C)),D!==void 0&&!Pl(D,N.terrain)&&(!D||P.getSource(D.source))&&(N.terrain=D,P.setTerrain(D)))}_updateHandlers(d,y){const C=this._map;for(const D of DT){const P=d[D]??!0,N=y[D]??!0;Pl(P,N)||(P?C[D].enable(P):C[D].disable())}}_queryRenderedFeatures(d){const y=this._map,{interactiveLayerIds:C=[]}=this.props;try{return y.queryRenderedFeatures(d,{layers:C.filter(y.getLayer.bind(y))})}catch{return[]}}_updateHover(d){const{props:y}=this;if(y.interactiveLayerIds&&(y.onMouseMove||y.onMouseEnter||y.onMouseLeave)){const D=d.type,P=this._hoveredFeatures?.length>0,N=this._queryRenderedFeatures(d.point),h=N.length>0;!h&&P&&(d.type="mouseleave",this._onPointerEvent(d)),this._hoveredFeatures=N,h&&!P&&(d.type="mouseenter",this._onPointerEvent(d)),d.type=D}else this._hoveredFeatures=null}}b0.savedMaps=[];const RT=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function PT(c){if(!c)return null;const d=c.map,y={getMap:()=>d};for(const C of OT(d))!(C in y)&&!RT.includes(C)&&(y[C]=d[C].bind(d));return y}function OT(c){const d=new Set;let y=c;for(;y;){for(const C of Object.getOwnPropertyNames(y))C[0]!=="_"&&typeof c[C]=="function"&&C!=="fire"&&C!=="setEventedParent"&&d.add(C);y=Object.getPrototypeOf(y)}return Array.from(d)}const zT=typeof document<"u"?ge.useLayoutEffect:ge.useEffect;function LT(c,d){const{RTLTextPlugin:y,maxParallelImageRequests:C,workerCount:D,workerUrl:P}=d;if(y&&c.getRTLTextPluginStatus&&c.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:N,lazy:h=!0}=typeof y=="string"?{pluginUrl:y}:y;c.setRTLTextPlugin(N,U=>{U&&console.error(U)},h)}C!==void 0&&c.setMaxParallelImageRequests(C),D!==void 0&&c.setWorkerCount(D),P!==void 0&&c.setWorkerUrl(P)}const A0=ge.createContext(null);function BT(c,d){const y=ge.useContext(IT),[C,D]=ge.useState(null),P=ge.useRef(),{current:N}=ge.useRef({mapLib:null,map:null});ge.useEffect(()=>{const H=c.mapLib;let Y=!0,Q;return Promise.resolve(H||e1(()=>Promise.resolve().then(()=>n4),void 0)).then(_e=>{if(!Y)return;if(!_e)throw new Error("Invalid mapLib");const we="Map"in _e?_e:_e.default;if(!we.Map)throw new Error("Invalid mapLib");LT(we,c),c.reuseMaps&&(Q=b0.reuse(c,P.current)),Q||(Q=new b0(we.Map,c,P.current)),N.map=PT(Q),N.mapLib=we,D(Q),y?.onMapMount(N.map,c.id)}).catch(_e=>{const{onError:we}=c;we?we({type:"error",target:null,originalEvent:null,error:_e}):console.error(_e)}),()=>{Y=!1,Q&&(y?.onMapUnmount(c.id),c.reuseMaps?Q.recycle():Q.destroy())}},[]),zT(()=>{C&&C.setProps(c)}),ge.useImperativeHandle(d,()=>N.map,[C]);const h=ge.useMemo(()=>({position:"relative",width:"100%",height:"100%",...c.style}),[c.style]),U={height:"100%"};return ge.createElement("div",{id:c.id,ref:P,style:h},C&&ge.createElement(A0.Provider,{value:N},ge.createElement("div",{"mapboxgl-children":"",style:U},c.children)))}const FT=ge.forwardRef(BT);var l2=fb();const jT=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Zh(c,d){if(!c||!d)return;const y=c.style;for(const C in d){const D=d[C];Number.isFinite(D)&&!jT.test(C)?y[C]=`${D}px`:y[C]=D}}function c2(c,d){if(c===d)return null;const y=O_(c),C=O_(d),D=[];for(const P of C)y.has(P)||D.push(P);for(const P of y)C.has(P)||D.push(P);return D.length===0?null:D}function O_(c){return new Set(c?c.trim().split(/\s+/):[])}const Oc=ge.memo(ge.forwardRef((c,d)=>{const{map:y,mapLib:C}=ge.useContext(A0),D=ge.useRef({props:c}),P=ge.useMemo(()=>{let Re=!1;ge.Children.forEach(c.children,pt=>{pt&&(Re=!0)});const tt={...c,element:Re?document.createElement("div"):void 0},Ye=new C.Marker(tt);return Ye.setLngLat([c.longitude,c.latitude]),Ye.getElement().addEventListener("click",pt=>{D.current.props.onClick?.({type:"click",target:Ye,originalEvent:pt})}),Ye.on("dragstart",pt=>{const Wt=pt;Wt.lngLat=P.getLngLat(),D.current.props.onDragStart?.(Wt)}),Ye.on("drag",pt=>{const Wt=pt;Wt.lngLat=P.getLngLat(),D.current.props.onDrag?.(Wt)}),Ye.on("dragend",pt=>{const Wt=pt;Wt.lngLat=P.getLngLat(),D.current.props.onDragEnd?.(Wt)}),Ye},[]);ge.useEffect(()=>(P.addTo(y.getMap()),()=>{P.remove()}),[]);const{longitude:N,latitude:h,offset:U,style:H,draggable:Y=!1,popup:Q=null,rotation:_e=0,rotationAlignment:we="auto",pitchAlignment:ve="auto"}=c;ge.useEffect(()=>{Zh(P.getElement(),H)},[H]),ge.useImperativeHandle(d,()=>P,[]);const me=D.current.props;(P.getLngLat().lng!==N||P.getLngLat().lat!==h)&&P.setLngLat([N,h]),U&&!MT(P.getOffset(),U)&&P.setOffset(U),P.isDraggable()!==Y&&P.setDraggable(Y),P.getRotation()!==_e&&P.setRotation(_e),P.getRotationAlignment()!==we&&P.setRotationAlignment(we),P.getPitchAlignment()!==ve&&P.setPitchAlignment(ve),P.getPopup()!==Q&&P.setPopup(Q);const he=c2(me.className,c.className);if(he)for(const Re of he)P.toggleClassName(Re);return D.current.props=c,l2.createPortal(c.children,P.getElement())}));ge.memo(ge.forwardRef((c,d)=>{const{map:y,mapLib:C}=ge.useContext(A0),D=ge.useMemo(()=>document.createElement("div"),[]),P=ge.useRef({props:c}),N=ge.useMemo(()=>{const h={...c},U=new C.Popup(h);return U.setLngLat([c.longitude,c.latitude]),U.once("open",H=>{P.current.props.onOpen?.(H)}),U},[]);if(ge.useEffect(()=>{const h=U=>{P.current.props.onClose?.(U)};return N.on("close",h),N.setDOMContent(D).addTo(y.getMap()),()=>{N.off("close",h),N.isOpen()&&N.remove()}},[]),ge.useEffect(()=>{Zh(N.getElement(),c.style)},[c.style]),ge.useImperativeHandle(d,()=>N,[]),N.isOpen()){const h=P.current.props;(N.getLngLat().lng!==c.longitude||N.getLngLat().lat!==c.latitude)&&N.setLngLat([c.longitude,c.latitude]),c.offset&&!Pl(h.offset,c.offset)&&N.setOffset(c.offset),(h.anchor!==c.anchor||h.maxWidth!==c.maxWidth)&&(N.options.anchor=c.anchor,N.setMaxWidth(c.maxWidth));const U=c2(h.className,c.className);if(U)for(const H of U)N.toggleClassName(H);P.current.props=c}return l2.createPortal(c.children,D)}));function op(c,d,y,C){const D=ge.useContext(A0),P=ge.useMemo(()=>c(D),[]);return ge.useEffect(()=>{const N=d,h=null,U=typeof d=="function"?d:null,{map:H}=D;return H.hasControl(P)||(H.addControl(P,N?.position),h&&h(D)),()=>{U&&U(D),H.hasControl(P)&&H.removeControl(P)}},[]),P}function UT(c){const d=op(({mapLib:y})=>new y.AttributionControl(c),{position:c.position});return ge.useEffect(()=>{Zh(d._container,c.style)},[c.style]),null}ge.memo(UT);function VT(c){const d=op(({mapLib:y})=>new y.FullscreenControl({container:c.containerId&&document.getElementById(c.containerId)}),{position:c.position});return ge.useEffect(()=>{Zh(d._controlContainer,c.style)},[c.style]),null}ge.memo(VT);function GT(c,d){const y=ge.useRef({props:c}),C=op(({mapLib:D})=>{const P=new D.GeolocateControl(c),N=P._setupUI;return P._setupUI=()=>{P._container.hasChildNodes()||N()},P.on("geolocate",h=>{y.current.props.onGeolocate?.(h)}),P.on("error",h=>{y.current.props.onError?.(h)}),P.on("outofmaxbounds",h=>{y.current.props.onOutOfMaxBounds?.(h)}),P.on("trackuserlocationstart",h=>{y.current.props.onTrackUserLocationStart?.(h)}),P.on("trackuserlocationend",h=>{y.current.props.onTrackUserLocationEnd?.(h)}),P},{position:c.position});return y.current.props=c,ge.useImperativeHandle(d,()=>C,[]),ge.useEffect(()=>{Zh(C._container,c.style)},[c.style]),null}ge.memo(ge.forwardRef(GT));function HT(c){const d=op(({mapLib:y})=>new y.NavigationControl(c),{position:c.position});return ge.useEffect(()=>{Zh(d._container,c.style)},[c.style]),null}ge.memo(HT);function qT(c){const d=op(({mapLib:P})=>new P.ScaleControl(c),{position:c.position}),y=ge.useRef(c),C=y.current;y.current=c;const{style:D}=c;return c.maxWidth!==void 0&&c.maxWidth!==C.maxWidth&&(d.options.maxWidth=c.maxWidth),c.unit!==void 0&&c.unit!==C.unit&&d.setUnit(c.unit),ge.useEffect(()=>{Zh(d._container,D)},[D]),null}ge.memo(qT);function ZT(c){const d=op(({mapLib:y})=>new y.TerrainControl(c),{position:c.position});return ge.useEffect(()=>{Zh(d._container,c.style)},[c.style]),null}ge.memo(ZT);function XT(c){const d=op(({mapLib:y})=>new y.LogoControl(c),{position:c.position});return ge.useEffect(()=>{Zh(d._container,c.style)},[c.style]),null}ge.memo(XT);function l1(c,d){if(!c)throw new Error(d)}let WT=0;function YT(c,d,y){if(c.style&&c.style._loaded){const C={...y};return delete C.id,delete C.children,c.addSource(d,C),c.getSource(d)}return null}function $T(c,d,y){l1(d.id===y.id,"source id changed"),l1(d.type===y.type,"source type changed");let C="",D=0;for(const N in d)N!=="children"&&N!=="id"&&!Pl(y[N],d[N])&&(C=N,D++);if(!D)return;const P=d.type;if(P==="geojson")c.setData(d.data);else if(P==="image")c.updateImage({url:d.url,coordinates:d.coordinates});else switch(C){case"coordinates":c.setCoordinates?.(d.coordinates);break;case"url":c.setUrl?.(d.url);break;case"tiles":c.setTiles?.(d.tiles);break;default:console.warn(`Unable to update <Source> prop: ${C}`)}}function z_(c){const d=ge.useContext(A0).map.getMap(),y=ge.useRef(c),[,C]=ge.useState(0),D=ge.useMemo(()=>c.id||`jsx-source-${WT++}`,[]);ge.useEffect(()=>{if(d){const N=()=>setTimeout(()=>C(h=>h+1),0);return d.on("styledata",N),N(),()=>{if(d.off("styledata",N),d.style&&d.style._loaded&&d.getSource(D)){const h=d.getStyle()?.layers;if(h)for(const U of h)U.source===D&&d.removeLayer(U.id);d.removeSource(D)}}}},[d]);let P=d&&d.style&&d.getSource(D);return P?$T(P,c,y.current):P=YT(d,D,c),y.current=c,P&&ge.Children.map(c.children,N=>N&&ge.cloneElement(N,{source:D}))||null}function QT(c,d,y,C){if(l1(y.id===C.id,"layer id changed"),l1(y.type===C.type,"layer type changed"),y.type==="custom"||C.type==="custom")return;const{layout:D={},paint:P={},filter:N,minzoom:h,maxzoom:U,beforeId:H}=y;if(H!==C.beforeId&&c.moveLayer(d,H),D!==C.layout){const Y=C.layout||{};for(const Q in D)Pl(D[Q],Y[Q])||c.setLayoutProperty(d,Q,D[Q]);for(const Q in Y)D.hasOwnProperty(Q)||c.setLayoutProperty(d,Q,void 0)}if(P!==C.paint){const Y=C.paint||{};for(const Q in P)Pl(P[Q],Y[Q])||c.setPaintProperty(d,Q,P[Q]);for(const Q in Y)P.hasOwnProperty(Q)||c.setPaintProperty(d,Q,void 0)}Pl(N,C.filter)||c.setFilter(d,N),(h!==C.minzoom||U!==C.maxzoom)&&c.setLayerZoomRange(d,h,U)}function KT(c,d,y){if(c.style&&c.style._loaded&&(!("source"in y)||c.getSource(y.source))){const C={...y,id:d};delete C.beforeId,c.addLayer(C,y.beforeId)}}let JT=0;function L_(c){const d=ge.useContext(A0).map.getMap(),y=ge.useRef(c),[,C]=ge.useState(0),D=ge.useMemo(()=>c.id||`jsx-layer-${JT++}`,[]);if(ge.useEffect(()=>{if(d){const N=()=>C(h=>h+1);return d.on("styledata",N),N(),()=>{d.off("styledata",N),d.style&&d.style._loaded&&d.getLayer(D)&&d.removeLayer(D)}}},[d]),d&&d.style&&d.getLayer(D))try{QT(d,D,c,y.current)}catch(N){console.warn(N)}else KT(d,D,c);return y.current=c,null}var Km={exports:{}};var e4=Km.exports,B_;function t4(){return B_||(B_=1,(function(c,d){(function(y,C){c.exports=C()})(e4,(function(){var y={},C={};function D(N,h,U){if(C[N]=U,N==="index"){var H="var sharedModule = {}; ("+C.shared+")(sharedModule); ("+C.worker+")(sharedModule);",Y={};return C.shared(Y),C.index(y,Y),typeof window<"u"&&y.setWorkerUrl(window.URL.createObjectURL(new Blob([H],{type:"text/javascript"}))),y}}D("shared",["exports"],(function(N){function h(i,e,n,l){return new(n||(n=Promise))((function(p,_){function b(B){try{R(l.next(B))}catch(G){_(G)}}function T(B){try{R(l.throw(B))}catch(G){_(G)}}function R(B){var G;B.done?p(B.value):(G=B.value,G instanceof n?G:new n((function(X){X(G)}))).then(b,T)}R((l=l.apply(i,e||[])).next())}))}function U(i,e){this.x=i,this.y=e}function H(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Y,Q;typeof SuppressedError=="function"&&SuppressedError,U.prototype={clone(){return new U(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(i,e){const n=Math.cos(i),l=Math.sin(i),p=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:U},U.convert=function(i){if(i instanceof U)return i;if(Array.isArray(i))return new U(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new U(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var _e=(function(){if(Q)return Y;function i(e,n,l,p){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=p}return Q=1,Y=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,p=0;p<8;p++){var _=this.sampleCurveX(l)-e;if(Math.abs(_)<n)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=_/b}var T=0,R=1;for(l=e,p=0;p<20&&(_=this.sampleCurveX(l),!(Math.abs(_-e)<n));p++)e>_?T=l:R=l,l=.5*(R-T)+T;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Y})(),we=H(_e);let ve,me;function he(){return ve==null&&(ve=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ve}function Re(){if(me==null&&(me=!1,he())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<25;l++){const p=4*l;e.fillStyle=`rgb(${p},${p+1},${p+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&n[l]!==l){me=!0;break}}}return me||!1}var tt=1e-6,Ye=typeof Float32Array<"u"?Float32Array:Array;function pt(){var i=new Ye(9);return Ye!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Wt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Et(){var i=new Ye(3);return Ye!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function it(i){var e=i[0],n=i[1],l=i[2];return Math.sqrt(e*e+n*n+l*l)}function at(i,e,n){var l=new Ye(3);return l[0]=i,l[1]=e,l[2]=n,l}function He(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function xt(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function Pe(i,e,n){var l=e[0],p=e[1],_=e[2],b=n[0],T=n[1],R=n[2];return i[0]=p*R-_*T,i[1]=_*b-l*R,i[2]=l*T-p*b,i}var ct,vt=it;function Zt(i,e,n){var l=e[0],p=e[1],_=e[2],b=e[3];return i[0]=n[0]*l+n[4]*p+n[8]*_+n[12]*b,i[1]=n[1]*l+n[5]*p+n[9]*_+n[13]*b,i[2]=n[2]*l+n[6]*p+n[10]*_+n[14]*b,i[3]=n[3]*l+n[7]*p+n[11]*_+n[15]*b,i}function Ne(){var i=new Ye(4);return Ye!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Te(i,e,n,l){var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",_=Math.PI/360;e*=_,l*=_,n*=_;var b=Math.sin(e),T=Math.cos(e),R=Math.sin(n),B=Math.cos(n),G=Math.sin(l),X=Math.cos(l);switch(p){case"xyz":i[0]=b*B*X+T*R*G,i[1]=T*R*X-b*B*G,i[2]=T*B*G+b*R*X,i[3]=T*B*X-b*R*G;break;case"xzy":i[0]=b*B*X-T*R*G,i[1]=T*R*X-b*B*G,i[2]=T*B*G+b*R*X,i[3]=T*B*X+b*R*G;break;case"yxz":i[0]=b*B*X+T*R*G,i[1]=T*R*X-b*B*G,i[2]=T*B*G-b*R*X,i[3]=T*B*X+b*R*G;break;case"yzx":i[0]=b*B*X+T*R*G,i[1]=T*R*X+b*B*G,i[2]=T*B*G-b*R*X,i[3]=T*B*X-b*R*G;break;case"zxy":i[0]=b*B*X-T*R*G,i[1]=T*R*X+b*B*G,i[2]=T*B*G+b*R*X,i[3]=T*B*X-b*R*G;break;case"zyx":i[0]=b*B*X-T*R*G,i[1]=T*R*X+b*B*G,i[2]=T*B*G-b*R*X,i[3]=T*B*X+b*R*G;break;default:throw new Error("Unknown angle order "+p)}return i}function We(){var i=new Ye(2);return Ye!=Float32Array&&(i[0]=0,i[1]=0),i}function wt(i,e){var n=new Ye(2);return n[0]=i,n[1]=e,n}Et(),ct=new Ye(4),Ye!=Float32Array&&(ct[0]=0,ct[1]=0,ct[2]=0,ct[3]=0),Et(),at(1,0,0),at(0,1,0),Ne(),Ne(),pt(),We();const zt=8192;function Gt(i,e,n){return e*(zt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function ke(i,e){return(i%e+e)%e}function nt(i,e,n){return i*(1-n)+e*n}function Nt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function _t(i,e,n,l){const p=new we(i,e,n,l);return _=>p.solve(_)}const tn=_t(.25,.1,.25,1);function Bt(i,e,n){return Math.min(n,Math.max(e,i))}function Kt(i,e,n){const l=n-e,p=((i-e)%l+l)%l+e;return p===e?n:p}function an(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}let sn=1;function Nn(i,e,n){const l={};for(const p in i)l[p]=e.call(this,i[p],p,i);return l}function Dn(i,e,n){const l={};for(const p in i)e.call(this,i[p],p,i)&&(l[p]=i[p]);return l}function si(i){return Array.isArray(i)?i.map(si):typeof i=="object"&&i?Nn(i,si):i}const kn={};function ui(i){kn[i]||(typeof console<"u"&&console.warn(i),kn[i]=!0)}function _i(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Di(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let qn=null;function Gn(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const In="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function vi(i,e,n,l,p){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const b=_?.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const T=b.startsWith("BGR"),R=new Uint8ClampedArray(l*p*4);if(yield _.copyTo(R,(function(B,G,X,$,K){const ie=4*Math.max(-G,0),re=(Math.max(0,X)-X)*$*4+ie,ae=4*$,ye=Math.max(0,G),Fe=Math.max(0,X);return{rect:{x:ye,y:Fe,width:Math.min(B.width,G+$)-ye,height:Math.min(B.height,X+K)-Fe},layout:[{offset:re,stride:ae}]}})(i,e,n,l,p)),T)for(let B=0;B<R.length;B+=4){const G=R[B];R[B]=R[B+2],R[B+2]=G}return R}finally{_.close()}}))}let nn,Li;function Ki(i,e,n,l){return i.addEventListener(e,n,l),{unsubscribe:()=>{i.removeEventListener(e,n,l)}}}function Pi(i){return i*Math.PI/180}function xr(i){return i/Math.PI*180}const gt={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},oe={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ce="AbortError";class pe extends Error{constructor(e=ce){super(e instanceof Error?e.message:e),this.name=ce,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function je(i){return i.name===ce}const Je={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function St(i){return Je.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const rt="global-dispatcher";class de extends Error{constructor(e,n,l,p){super(`AJAXError: ${n} (${e}): ${l}`),this.status=e,this.statusText=n,this.url=l,this.body=p}}const Ze=()=>Di(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,yt=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=St(i.url);if(l)return l(i,e);if(Di(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:rt},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Ze())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,p){return h(this,void 0,void 0,(function*(){const _=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Ze(),signal:p.signal});let b,T;l.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{b=yield fetch(_)}catch(B){throw je(B)?B:new de(0,B.message,l.url,new Blob)}if(!b.ok){const B=yield b.blob();throw new de(b.status,b.statusText,l.url,B)}T=l.type==="arrayBuffer"||l.type==="image"?b.arrayBuffer():l.type==="json"?b.json():b.text();const R=yield T;return p.signal.throwIfAborted(),{data:R,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}}))})(i,e);if(Di(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:rt},e)}var n;return(function(l,p){return new Promise(((_,b)=>{var T;const R=new XMLHttpRequest;R.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(R.responseType="arraybuffer");for(const B in l.headers)R.setRequestHeader(B,l.headers[B]);l.type==="json"&&(R.responseType="text",!((T=l.headers)===null||T===void 0)&&T.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=l.credentials==="include",R.onerror=()=>{b(new Error(R.statusText))},R.onload=()=>{if(!p.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let B=R.response;if(l.type==="json")try{B=JSON.parse(R.response)}catch(G){return void b(G)}_({data:B,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const B=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});b(new de(R.status,R.statusText,l.url,B))}},p.signal.addEventListener("abort",(()=>{R.abort(),b(new pe(p.signal.reason))})),R.send(l.body)}))})(i,e)};function Oe(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function At(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function jt(i,e,n){if(n&&n[i]){const l=n[i].indexOf(e);l!==-1&&n[i].splice(l,1)}}class _n{constructor(e,n={}){an(this,n),this.type=e}}class mn extends _n{constructor(e,n={}){super("error",an({error:e},n))}}class ti{on(e,n){return this._listeners=this._listeners||{},At(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return jt(e,n,this._listeners),jt(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},At(e,n,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,n){typeof e=="string"&&(e=new _n(e,n||{}));const l=e.type;if(this.listens(l)){e.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const T of p)T.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const T of _)jt(l,T,this._oneTimeListeners),T.call(this,e);const b=this._eventedParent;b&&(an(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(e))}else e instanceof mn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ut={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const ai=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Qn(i,e){const n={};for(const l in i)l!=="ref"&&(n[l]=i[l]);return ai.forEach((l=>{l in e&&(n[l]=e[l])})),n}function Kn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!Kn(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!Kn(i[n],e[n]))return!1;return!0}return i===e}function Jn(i,e){i.push(e)}function lr(i,e,n){Jn(n,{command:"addSource",args:[i,e[i]]})}function Mi(i,e,n){Jn(e,{command:"removeSource",args:[i]}),n[i]=!0}function ni(i,e,n,l){Mi(i,n,l),lr(i,e,n)}function zi(i,e,n){let l;for(l in i[n])if(Object.prototype.hasOwnProperty.call(i[n],l)&&l!=="data"&&!Kn(i[n][l],e[n][l]))return!1;for(l in e[n])if(Object.prototype.hasOwnProperty.call(e[n],l)&&l!=="data"&&!Kn(i[n][l],e[n][l]))return!1;return!0}function Ei(i,e,n,l,p,_){i=i||{},e=e||{};for(const b in i)Object.prototype.hasOwnProperty.call(i,b)&&(Kn(i[b],e[b])||n.push({command:_,args:[l,b,e[b],p]}));for(const b in e)Object.prototype.hasOwnProperty.call(e,b)&&!Object.prototype.hasOwnProperty.call(i,b)&&(Kn(i[b],e[b])||n.push({command:_,args:[l,b,e[b],p]}))}function Bi(i){return i.id}function Cr(i,e){return i[e.id]=e,i}class Jt{constructor(e,n,l,p){this.message=(e?`${e}: `:"")+l,p&&(this.identifier=p),n!=null&&n.__line__&&(this.line=n.__line__)}}function gi(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}class An extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class ar{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,p]of n)this.bindings[l]=p}concat(e){return new ar(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Zi={kind:"null"},ln={kind:"number"},Ue={kind:"string"},mt={kind:"boolean"},$t={kind:"color"},gn={kind:"projectionDefinition"},un={kind:"object"},fn={kind:"value"},Rn={kind:"collator"},Hn={kind:"formatted"},Fn={kind:"padding"},ki={kind:"colorArray"},xi={kind:"numberArray"},bi={kind:"resolvedImage"},Ct={kind:"variableAnchorOffsetCollection"};function Zn(i,e){return{kind:"array",itemType:i,N:e}}function En(i){if(i.kind==="array"){const e=En(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Ri=[Zi,ln,Ue,mt,$t,gn,Hn,un,Zn(fn),Fn,xi,ki,bi,Ct];function ii(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ii(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Ri)if(!ii(n,e))return null}}return`Expected ${En(i)} but found ${En(e)} instead.`}function $n(i,e){return e.some((n=>n.kind===i.kind))}function jn(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function li(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const us=.96422,Xr=.82521,ci=4/29,Un=6/29,Tr=3*Un*Un,Ss=Un*Un*Un,Ji=Math.PI/180,Lr=180/Math.PI;function hs(i){return(i%=360)<0&&(i+=360),i}function Ho([i,e,n,l]){let p,_;const b=$r((.2225045*(i=Fi(i))+.7168786*(e=Fi(e))+.0606169*(n=Fi(n)))/1);i===e&&e===n?p=_=b:(p=$r((.4360747*i+.3850649*e+.1430804*n)/us),_=$r((.0139322*i+.0971045*e+.7141733*n)/Xr));const T=116*b-16;return[T<0?0:T,500*(p-b),200*(b-_),l]}function Fi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function $r(i){return i>Ss?Math.pow(i,1/3):i/Tr+ci}function Rt([i,e,n,l]){let p=(i+16)/116,_=isNaN(e)?p:p+e/500,b=isNaN(n)?p:p-n/200;return p=1*oi(p),_=us*oi(_),b=Xr*oi(b),[De(3.1338561*_-1.6168667*p-.4906146*b),De(-.9787684*_+1.9161415*p+.033454*b),De(.0719453*_-.2289914*p+1.4052427*b),l]}function De(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function oi(i){return i>Un?i*i*i:Tr*(i-ci)}const ds=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Ns(i,e){return ds(i,e)?i[e]:void 0}function Da(i){return parseInt(i.padEnd(2,i),16)/255}function uc(i,e){return Hr(e?i/100:i,0,1)}function Hr(i,e,n){return Math.min(Math.max(e,i),n)}function mi(i){return!i.some(Number.isNaN)}const fr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ao(i,e,n){return i+n*(e-i)}function cl(i,e,n){return i.map(((l,p)=>Ao(l,e[p],n)))}class Si{constructor(e,n,l,p=1,_=!0){this.r=e,this.g=n,this.b=l,this.a=p,_||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[e,n,l,p]))}static parse(e){if(e instanceof Si)return e;if(typeof e!="string")return;const n=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Ns(fr,l);if(p){const[b,T,R]=p;return[b/255,T/255,R/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const b=l.length<6?1:2;let T=1;return[Da(l.slice(T,T+=b)),Da(l.slice(T,T+=b)),Da(l.slice(T,T+=b)),Da(l.slice(T,T+b)||"ff")]}if(l.startsWith("rgb")){const b=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[T,R,B,G,X,$,K,ie,re,ae,ye,Fe]=b,be=[G||" ",K||" ",ae].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Se=[B,$,re].join(""),Ge=Se==="%%%"?100:Se===""?255:0;if(Ge){const Ke=[Hr(+R/Ge,0,1),Hr(+X/Ge,0,1),Hr(+ie/Ge,0,1),ye?uc(+ye,Fe):1];if(mi(Ke))return Ke}}return}}const _=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[b,T,R,B,G,X,$,K,ie]=_,re=[R||" ",G||" ",$].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ae=[+T,Hr(+B,0,100),Hr(+X,0,100),K?uc(+K,ie):1];if(mi(ae))return(function([ye,Fe,be,Se]){function Ge(Ke){const kt=(Ke+ye/30)%12,en=Fe*Math.min(be,1-be);return be-en*Math.max(-1,Math.min(kt-3,9-kt,1))}return ye=hs(ye),Fe/=100,be/=100,[Ge(0),Ge(8),Ge(4),Se]})(ae)}}})(e);return n?new Si(...n,!1):void 0}get rgb(){const{r:e,g:n,b:l,a:p}=this,_=p||1/0;return this.overwriteGetter("rgb",[e/_,n/_,l/_,p])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,l,p,_]=Ho(e),b=Math.sqrt(l*l+p*p);return[Math.round(1e4*b)?hs(Math.atan2(p,l)*Lr):NaN,b,n,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Ho(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,l,p]=this.rgb;return`rgba(${[e,n,l].map((_=>Math.round(255*_))).join(",")},${p})`}static interpolate(e,n,l,p="rgb"){switch(p){case"rgb":{const[_,b,T,R]=cl(e.rgb,n.rgb,l);return new Si(_,b,T,R,!1)}case"hcl":{const[_,b,T,R]=e.hcl,[B,G,X,$]=n.hcl;let K,ie;if(isNaN(_)||isNaN(B))isNaN(_)?isNaN(B)?K=NaN:(K=B,T!==1&&T!==0||(ie=G)):(K=_,X!==1&&X!==0||(ie=b));else{let be=B-_;B>_&&be>180?be-=360:B<_&&_-B>180&&(be+=360),K=_+l*be}const[re,ae,ye,Fe]=(function([be,Se,Ge,Ke]){return be=isNaN(be)?0:be*Ji,Rt([Ge,Math.cos(be)*Se,Math.sin(be)*Se,Ke])})([K,ie??Ao(b,G,l),Ao(T,X,l),Ao(R,$,l)]);return new Si(re,ae,ye,Fe,!1)}case"lab":{const[_,b,T,R]=Rt(cl(e.lab,n.lab,l));return new Si(_,b,T,R,!1)}}}}Si.black=new Si(0,0,0,1),Si.white=new Si(1,1,1,1),Si.transparent=new Si(0,0,0,0),Si.red=new Si(1,0,0,1);class Xs{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ll=["bottom","center","top"];class ul{constructor(e,n,l,p,_,b){this.text=e,this.image=n,this.scale=l,this.fontStack=p,this.textColor=_,this.verticalAlign=b}}class Xi{constructor(e){this.sections=e}static fromString(e){return new Xi([new ul(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Xi?e:Xi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Br{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Br)return e;if(typeof e=="number")return new Br([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Br(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new Br(cl(e.values,n.values,l))}}class er{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof er)return e;if(typeof e=="number")return new er([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new er(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new er(cl(e.values,n.values,l))}}class yn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof yn)return e;if(typeof e=="string"){const l=Si.parse(e);return l?new yn([l]):void 0}if(!Array.isArray(e))return;const n=[];for(const l of e){if(typeof l!="string")return;const p=Si.parse(l);if(!p)return;n.push(p)}return new yn(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l,p="rgb"){const _=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let b=0;b<e.values.length;b++)_.push(Si.interpolate(e.values[b],n.values[b],l,p));return new yn(_)}}class _r extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ci=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ji{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ji)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const l=e[n],p=e[n+1];if(typeof l!="string"||!Ci.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new ji(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){const p=e.values,_=n.values;if(p.length!==_.length)throw new _r(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const b=[];for(let T=0;T<p.length;T+=2){if(p[T]!==_[T])throw new _r(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${p[T]}, to[${T}]: ${_[T]}`);b.push(p[T]);const[R,B]=p[T+1],[G,X]=_[T+1];b.push([Ao(R,G,l),Ao(B,X,l)])}return new ji(b)}}class Ws{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ws({name:e,available:!1}):null}}class Qr{constructor(e,n,l){this.from=e,this.to=n,this.transition=l}static interpolate(e,n,l){return new Qr(e,n,l)}static parse(e){return e instanceof Qr?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Qr(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Qr(e.from,e.to,e.transition):typeof e=="string"?new Qr(e,e,1):void 0}}function Ys(i,e,n,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,n,l]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Us(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Qr||i instanceof Si||i instanceof Xs||i instanceof Xi||i instanceof Br||i instanceof er||i instanceof yn||i instanceof ji||i instanceof Ws)return!0;if(Array.isArray(i)){for(const e of i)if(!Us(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Us(i[e]))return!1;return!0}return!1}function Nr(i){if(i===null)return Zi;if(typeof i=="string")return Ue;if(typeof i=="boolean")return mt;if(typeof i=="number")return ln;if(i instanceof Si)return $t;if(i instanceof Qr)return gn;if(i instanceof Xs)return Rn;if(i instanceof Xi)return Hn;if(i instanceof Br)return Fn;if(i instanceof er)return xi;if(i instanceof yn)return ki;if(i instanceof ji)return Ct;if(i instanceof Ws)return bi;if(Array.isArray(i)){const e=i.length;let n;for(const l of i){const p=Nr(l);if(n){if(n===p)continue;n=fn;break}n=p}return Zn(n||fn,e)}return un}function ma(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Si||i instanceof Qr||i instanceof Xi||i instanceof Br||i instanceof er||i instanceof yn||i instanceof ji||i instanceof Ws?i.toString():JSON.stringify(i)}class ys{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Us(e[1]))return n.error("invalid value");const l=e[1];let p=Nr(l);const _=n.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new ys(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ea={string:Ue,number:ln,boolean:mt,object:un};class Ds{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,p=1;const _=e[0];if(_==="array"){let T,R;if(e.length>2){const B=e[1];if(typeof B!="string"||!(B in Ea)||B==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);T=Ea[B],p++}else T=fn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);R=e[2],p++}l=Zn(T,R)}else{if(!Ea[_])throw new Error(`Types doesn't contain name = ${_}`);l=Ea[_]}const b=[];for(;p<e.length;p++){const T=n.parse(e[p],p,fn);if(!T)return null;b.push(T)}return new Ds(l,b)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!ii(this.type,Nr(l)))return l;if(n===this.args.length-1)throw new _r(`Expected value to be of type ${En(this.type)}, but found ${En(Nr(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Dr={"to-boolean":mt,"to-color":$t,"to-number":ln,"to-string":Ue};class ns{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0];if(!Dr[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");const p=Dr[l],_=[];for(let b=1;b<e.length;b++){const T=n.parse(e[b],b,fn);if(!T)return null;_.push(T)}return new ns(p,_)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,l;for(const p of this.args){if(n=p.evaluate(e),l=null,n instanceof Si)return n;if(typeof n=="string"){const _=e.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ys(n[0],n[1],n[2],n[3]),!l))return new Si(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new _r(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(e);const p=Br.parse(n);if(p)return p}throw new _r(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const l of this.args){n=l.evaluate(e);const p=er.parse(n);if(p)return p}throw new _r(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const l of this.args){n=l.evaluate(e);const p=yn.parse(n);if(p)return p}throw new _r(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(e);const p=ji.parse(n);if(p)return p}throw new _r(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const p=Number(n);if(!isNaN(p))return p}throw new _r(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Xi.fromString(ma(this.args[0].evaluate(e)));case"resolvedImage":return Ws.fromString(ma(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return ma(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const ir=["Unknown","Point","LineString","Polygon"];class Eo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ir[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=Si.parse(e),this._parseColorCache.set(e,n)),n}}class So{constructor(e,n,l=[],p,_=new ar,b=[]){this.registry=e,this.path=l,this.key=l.map((T=>`[${T}]`)).join(""),this.scope=_,this.errors=b,this.expectedType=p,this._isConstant=n}parse(e,n,l,p,_={}){return n?this.concat(n,l,p)._parse(e,_):this._parse(e,_)}_parse(e,n){function l(p,_,b){return b==="assert"?new Ds(_,[p]):b==="coerce"?new ns(_,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let b=_.parse(e,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,R=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||R.kind!=="value"){if(T.kind==="projectionDefinition"&&["string","array"].includes(R.kind)||["color","formatted","resolvedImage"].includes(T.kind)&&["value","string"].includes(R.kind)||["padding","numberArray"].includes(T.kind)&&["value","number","array"].includes(R.kind)||T.kind==="colorArray"&&["value","string","array"].includes(R.kind)||T.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(R.kind))b=l(b,T,n.typeAnnotation||"coerce");else if(this.checkSubtype(T,R))return null}else b=l(b,T,n.typeAnnotation||"assert")}if(!(b instanceof ys)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const T=new Eo;try{b=new ys(b.type,b.evaluate(T))}catch(R){return this.error(R.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l){const p=typeof e=="number"?this.path.concat(e):this.path,_=l?this.scope.concat(l):this.scope;return new So(this.registry,this._isConstant,p,n||null,_,this.errors)}error(e,...n){const l=`${this.key}${n.map((p=>`[${p}]`)).join("")}`;this.errors.push(new An(l,e))}checkSubtype(e,n){const l=ii(e,n);return l&&this.error(l),l}}class cr{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let _=1;_<e.length-1;_+=2){const b=e[_];if(typeof b!="string")return n.error(`Expected string, but found ${typeof b} instead.`,_);if(/[^a-zA-Z0-9_]/.test(b))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const T=n.parse(e[_+1],_+1);if(!T)return null;l.push([b,T])}const p=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return p?new cr(l,p):null}outputDefined(){return this.result.outputDefined()}}class Ee{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new Ee(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class qe{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,ln),p=n.parse(e[2],2,Zn(n.expectedType||fn));return l&&p?new qe(p.type.itemType,l,p):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new _r(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new _r(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new _r(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Xe{constructor(e,n){this.type=mt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,fn),p=n.parse(e[2],2,fn);return l&&p?$n(l.type,[mt,Ue,ln,Zi,fn])?new Xe(l,p):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${En(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!jn(n,["boolean","string","number","null"]))throw new _r(`Expected first argument to be of type boolean, string, number or null, but found ${En(Nr(n))} instead.`);if(!jn(l,["string","array"]))throw new _r(`Expected second argument to be of type array or string, but found ${En(Nr(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class et{constructor(e,n,l){this.type=ln,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,fn),p=n.parse(e[2],2,fn);if(!l||!p)return null;if(!$n(l.type,[mt,Ue,ln,Zi,fn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${En(l.type)} instead`);if(e.length===4){const _=n.parse(e[3],3,ln);return _?new et(l,p,_):null}return new et(l,p)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!jn(n,["boolean","string","number","null"]))throw new _r(`Expected first argument to be of type boolean, string, number or null, but found ${En(Nr(n))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(e)),jn(l,["string"])){const _=l.indexOf(n,p);return _===-1?-1:[...l.slice(0,_)].length}if(jn(l,["array"]))return l.indexOf(n,p);throw new _r(`Expected second argument to be of type array or string, but found ${En(Nr(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class bt{constructor(e,n,l,p,_,b){this.inputType=e,this.type=n,this.input=l,this.cases=p,this.outputs=_,this.otherwise=b}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,p;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);const _={},b=[];for(let B=2;B<e.length-1;B+=2){let G=e[B];const X=e[B+1];Array.isArray(G)||(G=[G]);const $=n.concat(B);if(G.length===0)return $.error("Expected at least one branch label.");for(const ie of G){if(typeof ie!="number"&&typeof ie!="string")return $.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return $.error("Numeric branch labels must be integer values.");if(l){if($.checkSubtype(l,Nr(ie)))return null}else l=Nr(ie);if(_[String(ie)]!==void 0)return $.error("Branch labels must be unique.");_[String(ie)]=b.length}const K=n.parse(X,B,p);if(!K)return null;p=p||K.type,b.push(K)}const T=n.parse(e[1],1,fn);if(!T)return null;const R=n.parse(e[e.length-1],e.length-1,p);return R?T.type.kind!=="value"&&n.concat(1).checkSubtype(l,T.type)?null:new bt(l,p,T,_,b,R):null}evaluate(e){const n=this.input.evaluate(e);return(Nr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Mn{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const p=[];for(let b=1;b<e.length-1;b+=2){const T=n.parse(e[b],b,mt);if(!T)return null;const R=n.parse(e[b+1],b+1,l);if(!R)return null;p.push([T,R]),l=l||R.type}const _=n.parse(e[e.length-1],e.length-1,l);if(!_)return null;if(!l)throw new Error("Can't infer output type");return new Mn(l,p,_)}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Xn{constructor(e,n,l,p){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=p}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,fn),p=n.parse(e[2],2,ln);if(!l||!p)return null;if(!$n(l.type,[Zn(fn),Ue,fn]))return n.error(`Expected first argument to be of type array or string, but found ${En(l.type)} instead`);if(e.length===4){const _=n.parse(e[3],3,ln);return _?new Xn(l.type,l,p,_):null}return new Xn(l.type,l,p)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let p;if(this.endIndex&&(p=this.endIndex.evaluate(e)),jn(n,["string"]))return[...n].slice(l,p).join("");if(jn(n,["array"]))return n.slice(l,p);throw new _r(`Expected first argument to be of type array or string, but found ${En(Nr(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Ui(i,e){const n=i.length-1;let l,p,_=0,b=n,T=0;for(;_<=b;)if(T=Math.floor((_+b)/2),l=i[T],p=i[T+1],l<=e){if(T===n||e<p)return T;_=T+1}else{if(!(l>e))throw new _r("Input is not a number.");b=T-1}return 0}class It{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[p,_]of l)this.labels.push(p),this.outputs.push(_)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,ln);if(!l)return null;const p=[];let _=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let b=1;b<e.length;b+=2){const T=b===1?-1/0:e[b],R=e[b+1],B=b,G=b+1;if(typeof T!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(p.length&&p[p.length-1][0]>=T)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const X=n.parse(R,G,_);if(!X)return null;_=_||X.type,p.push([T,X])}return new It(_,l,p)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return l[0].evaluate(e);const _=n.length;return p>=n[_-1]?l[_-1].evaluate(e):l[Ui(n,p)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function hi(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Hi,ya,hc=(function(){if(ya)return Hi;function i(e,n,l,p){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=p}return ya=1,Hi=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,p=0;p<8;p++){var _=this.sampleCurveX(l)-e;if(Math.abs(_)<n)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=_/b}var T=0,R=1;for(l=e,p=0;p<20&&(_=this.sampleCurveX(l),!(Math.abs(_-e)<n));p++)e>_?T=l:R=l,l=.5*(R-T)+T;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Hi})(),qo=hi(hc);class Rs{constructor(e,n,l,p,_){this.type=e,this.operator=n,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[b,T]of _)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(e,n,l,p){let _=0;if(e.name==="exponential")_=Cs(n,e.base,l,p);else if(e.name==="linear")_=Cs(n,1,l,p);else if(e.name==="cubic-bezier"){const b=e.controlPoints;_=new qo(b[0],b[1],b[2],b[3]).solve(Cs(n,1,l,p))}return _}static parse(e,n){let[l,p,_,...b]=e;if(!Array.isArray(p)||p.length===0)return n.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const B=p[1];if(typeof B!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:B}}else{if(p[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const B=p.slice(1);if(B.length!==4||B.some((G=>typeof G!="number"||G<0||G>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:B}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,ln),!_)return null;const T=[];let R=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||n.expectedType==ki?n.expectedType&&n.expectedType.kind!=="value"&&(R=n.expectedType):R=$t;for(let B=0;B<b.length;B+=2){const G=b[B],X=b[B+1],$=B+3,K=B+4;if(typeof G!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(T.length&&T[T.length-1][0]>=G)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const ie=n.parse(X,K,R);if(!ie)return null;R=R||ie.type,T.push([G,ie])}return li(R,ln)||li(R,gn)||li(R,$t)||li(R,Fn)||li(R,xi)||li(R,ki)||li(R,Ct)||li(R,Zn(ln))?new Rs(R,l,p,_,T):n.error(`Type ${En(R)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return l[0].evaluate(e);const _=n.length;if(p>=n[_-1])return l[_-1].evaluate(e);const b=Ui(n,p),T=Rs.interpolationFactor(this.interpolation,p,n[b],n[b+1]),R=l[b].evaluate(e),B=l[b+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ao(R,B,T);case"color":return Si.interpolate(R,B,T);case"padding":return Br.interpolate(R,B,T);case"colorArray":return yn.interpolate(R,B,T);case"numberArray":return er.interpolate(R,B,T);case"variableAnchorOffsetCollection":return ji.interpolate(R,B,T);case"array":return cl(R,B,T);case"projectionDefinition":return Qr.interpolate(R,B,T)}case"interpolate-hcl":switch(this.type.kind){case"color":return Si.interpolate(R,B,T,"hcl");case"colorArray":return yn.interpolate(R,B,T,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Si.interpolate(R,B,T,"lab");case"colorArray":return yn.interpolate(R,B,T,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Cs(i,e,n,l){const p=l-n,_=i-n;return p===0?0:e===1?_/p:(Math.pow(e,_)-1)/(Math.pow(e,p)-1)}const rr={color:Si.interpolate,number:Ao,padding:Br.interpolate,numberArray:er.interpolate,colorArray:yn.interpolate,variableAnchorOffsetCollection:ji.interpolate,array:cl};class wr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l=null;const p=n.expectedType;p&&p.kind!=="value"&&(l=p);const _=[];for(const T of e.slice(1)){const R=n.parse(T,1+_.length,l,void 0,{typeAnnotation:"omit"});if(!R)return null;l=l||R.type,_.push(R)}if(!l)throw new Error("No output type");const b=p&&_.some((T=>ii(p,T.type)));return new wr(b?fn:l,_)}evaluate(e){let n,l=null,p=0;for(const _ of this.args)if(p++,l=_.evaluate(e),l&&l instanceof Ws&&!l.available&&(n||(n=l.name),l=null,p===this.args.length&&(l=n)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Ra(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function pr(i,e,n,l){return l.compare(e,n)===0}function br(i,e,n){const l=i!=="=="&&i!=="!=";return class u2{constructor(_,b,T){this.type=mt,this.lhs=_,this.rhs=b,this.collator=T,this.hasUntypedArgument=_.type.kind==="value"||b.type.kind==="value"}static parse(_,b){if(_.length!==3&&_.length!==4)return b.error("Expected two or three arguments.");const T=_[0];let R=b.parse(_[1],1,fn);if(!R)return null;if(!Ra(T,R.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${En(R.type)}'.`);let B=b.parse(_[2],2,fn);if(!B)return null;if(!Ra(T,B.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${En(B.type)}'.`);if(R.type.kind!==B.type.kind&&R.type.kind!=="value"&&B.type.kind!=="value")return b.error(`Cannot compare types '${En(R.type)}' and '${En(B.type)}'.`);l&&(R.type.kind==="value"&&B.type.kind!=="value"?R=new Ds(B.type,[R]):R.type.kind!=="value"&&B.type.kind==="value"&&(B=new Ds(R.type,[B])));let G=null;if(_.length===4){if(R.type.kind!=="string"&&B.type.kind!=="string"&&R.type.kind!=="value"&&B.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(G=b.parse(_[3],3,Rn),!G)return null}return new u2(R,B,G)}evaluate(_){const b=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(l&&this.hasUntypedArgument){const R=Nr(b),B=Nr(T);if(R.kind!==B.kind||R.kind!=="string"&&R.kind!=="number")throw new _r(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${R.kind}, ${B.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const R=Nr(b),B=Nr(T);if(R.kind!=="string"||B.kind!=="string")return e(_,b,T)}return this.collator?n(_,b,T,this.collator.evaluate(_)):e(_,b,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Pa=br("==",(function(i,e,n){return e===n}),pr),Wi=br("!=",(function(i,e,n){return e!==n}),(function(i,e,n,l){return!pr(0,e,n,l)})),wi=br("<",(function(i,e,n){return e<n}),(function(i,e,n,l){return l.compare(e,n)<0})),ih=br(">",(function(i,e,n){return e>n}),(function(i,e,n,l){return l.compare(e,n)>0})),gr=br("<=",(function(i,e,n){return e<=n}),(function(i,e,n,l){return l.compare(e,n)<=0})),Ua=br(">=",(function(i,e,n){return e>=n}),(function(i,e,n,l){return l.compare(e,n)>=0}));class Sa{constructor(e,n,l){this.type=Rn,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const p=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,mt);if(!p)return null;const _=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,mt);if(!_)return null;let b=null;return l.locale&&(b=n.parse(l.locale,1,Ue),!b)?null:new Sa(p,_,b)}evaluate(e){return new Xs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class dc{constructor(e,n,l,p,_){this.type=Ue,this.number=e,this.locale=n,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,ln);if(!l)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return n.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=n.parse(p.locale,1,Ue),!_))return null;let b=null;if(p.currency&&(b=n.parse(p.currency,1,Ue),!b))return null;let T=null;if(p["min-fraction-digits"]&&(T=n.parse(p["min-fraction-digits"],1,ln),!T))return null;let R=null;return p["max-fraction-digits"]&&(R=n.parse(p["max-fraction-digits"],1,ln),!R)?null:new dc(l,_,b,T,R)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class is{constructor(e){this.type=Hn,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const p=[];let _=!1;for(let b=1;b<=e.length-1;++b){const T=e[b];if(_&&typeof T=="object"&&!Array.isArray(T)){_=!1;let R=null;if(T["font-scale"]&&(R=n.parse(T["font-scale"],1,ln),!R))return null;let B=null;if(T["text-font"]&&(B=n.parse(T["text-font"],1,Zn(Ue)),!B))return null;let G=null;if(T["text-color"]&&(G=n.parse(T["text-color"],1,$t),!G))return null;let X=null;if(T["vertical-align"]){if(typeof T["vertical-align"]=="string"&&!Ll.includes(T["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${T["vertical-align"]}' instead.`);if(X=n.parse(T["vertical-align"],1,Ue),!X)return null}const $=p[p.length-1];$.scale=R,$.font=B,$.textColor=G,$.verticalAlign=X}else{const R=n.parse(e[b],1,fn);if(!R)return null;const B=R.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:R,scale:null,font:null,textColor:null,verticalAlign:null})}}return new is(p)}evaluate(e){return new Xi(this.sections.map((n=>{const l=n.content.evaluate(e);return Nr(l)===bi?new ul("",l,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new ul(ma(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class Co{constructor(e){this.type=bi,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Ue);return l?new Co(l):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),l=Ws.fromString(n);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(n)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class Zo{constructor(e){this.type=ln,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${En(l.type)} instead.`):new Zo(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new _r(`Expected value to be of type string or array, but found ${En(Nr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Kr=8192;function Bl(i,e){const n=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(n*p*Kr),Math.round(l*p*Kr)]}function Fl(i,e){const n=Math.pow(2,e.z);return[(p=(i[0]/Kr+e.x)/n,360*p-180),(l=(i[1]/Kr+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,p}function fc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Oa(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function _u(i,e,n){const l=i[0]-e[0],p=i[1]-e[1],_=i[0]-n[0],b=i[1]-n[1];return l*b-_*p==0&&l*_<=0&&p*b<=0}function Bc(i,e,n,l){return(p=[l[0]-n[0],l[1]-n[1]])[0]*(_=[e[0]-i[0],e[1]-i[1]])[1]-p[1]*_[0]!=0&&!(!jc(i,e,n,l)||!jc(n,l,i,e));var p,_}function pc(i,e,n){for(const l of n)for(let p=0;p<l.length-1;++p)if(Bc(i,e,l[p],l[p+1]))return!0;return!1}function ro(i,e,n=!1){let l=!1;for(const T of e)for(let R=0;R<T.length-1;R++){if(_u(i,T[R],T[R+1]))return n;(_=T[R])[1]>(p=i)[1]!=(b=T[R+1])[1]>p[1]&&p[0]<(b[0]-_[0])*(p[1]-_[1])/(b[1]-_[1])+_[0]&&(l=!l)}var p,_,b;return l}function so(i,e){for(const n of e)if(ro(i,n))return!0;return!1}function Fc(i,e){for(const n of i)if(!ro(n,e))return!1;for(let n=0;n<i.length-1;++n)if(pc(i[n],i[n+1],e))return!1;return!0}function za(i,e){for(const n of e)if(Fc(i,n))return!0;return!1}function jc(i,e,n,l){const p=l[0]-n[0],_=l[1]-n[1],b=(i[0]-n[0])*_-p*(i[1]-n[1]),T=(e[0]-n[0])*_-p*(e[1]-n[1]);return b>0&&T<0||b<0&&T>0}function La(i,e,n){const l=[];for(let p=0;p<i.length;p++){const _=[];for(let b=0;b<i[p].length;b++){const T=Bl(i[p][b],n);fc(e,T),_.push(T)}l.push(_)}return l}function jl(i,e,n){const l=[];for(let p=0;p<i.length;p++){const _=La(i[p],e,n);l.push(_)}return l}function hl(i,e,n,l){if(i[0]<n[0]||i[0]>n[2]){const p=.5*l;let _=i[0]-n[0]>p?-l:n[0]-i[0]>p?l:0;_===0&&(_=i[0]-n[2]>p?-l:n[2]-i[0]>p?l:0),i[0]+=_}fc(e,i)}function Xh(i,e,n,l){const p=Math.pow(2,l.z)*Kr,_=[l.x*Kr,l.y*Kr],b=[];for(const T of i)for(const R of T){const B=[R.x+_[0],R.y+_[1]];hl(B,e,n,p),b.push(B)}return b}function gc(i,e,n,l){const p=Math.pow(2,l.z)*Kr,_=[l.x*Kr,l.y*Kr],b=[];for(const R of i){const B=[];for(const G of R){const X=[G.x+_[0],G.y+_[1]];fc(e,X),B.push(X)}b.push(B)}if(e[2]-e[0]<=p/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const R of b)for(const B of R)hl(B,e,n,p)}var T;return b}class $s{constructor(e,n){this.type=mt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Us(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const p=[];for(const _ of l.features){const{type:b,coordinates:T}=_.geometry;b==="Polygon"&&p.push(T),b==="MultiPolygon"&&p.push(...T)}if(p.length)return new $s(l,{type:"MultiPolygon",coordinates:p})}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new $s(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new $s(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(l.type==="Polygon"){const T=La(l.coordinates,_,b),R=Xh(n.geometry(),p,_,b);if(!Oa(p,_))return!1;for(const B of R)if(!ro(B,T))return!1}if(l.type==="MultiPolygon"){const T=jl(l.coordinates,_,b),R=Xh(n.geometry(),p,_,b);if(!Oa(p,_))return!1;for(const B of R)if(!so(B,T))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(l.type==="Polygon"){const T=La(l.coordinates,_,b),R=gc(n.geometry(),p,_,b);if(!Oa(p,_))return!1;for(const B of R)if(!Fc(B,T))return!1}if(l.type==="MultiPolygon"){const T=jl(l.coordinates,_,b),R=gc(n.geometry(),p,_,b);if(!Oa(p,_))return!1;for(const B of R)if(!za(B,T))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let rh=class{constructor(i=[],e=(n,l)=>n<l?-1:n>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,l=e[i];for(;i>0;){const p=i-1>>1,_=e[p];if(n(l,_)>=0)break;e[i]=_,i=p}e[i]=l}_down(i){const{data:e,compare:n}=this,l=this.length>>1,p=e[i];for(;i<l;){let _=1+(i<<1);const b=_+1;if(b<this.length&&n(e[b],e[_])<0&&(_=b),n(e[_],p)>=0)break;e[i]=e[_],i=_}e[i]=p}};function Ul(i,e,n=0,l=i.length-1,p=sr){for(;l>n;){if(l-n>600){const R=l-n+1,B=e-n+1,G=Math.log(R),X=.5*Math.exp(2*G/3),$=.5*Math.sqrt(G*X*(R-X)/R)*(B-R/2<0?-1:1);Ul(i,e,Math.max(n,Math.floor(e-B*X/R+$)),Math.min(l,Math.floor(e+(R-B)*X/R+$)),p)}const _=i[e];let b=n,T=l;for(Va(i,n,e),p(i[l],_)>0&&Va(i,n,l);b<T;){for(Va(i,b,T),b++,T--;p(i[b],_)<0;)b++;for(;p(i[T],_)>0;)T--}p(i[n],_)===0?Va(i,n,T):(T++,Va(i,T,l)),T<=e&&(n=T+1),e<=T&&(l=T-1)}}function Va(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function sr(i,e){return i<e?-1:i>e?1:0}function dl(i,e){if(i.length<=1)return[i];const n=[];let l,p;for(const _ of i){const b=a(_);b!==0&&(_.area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(l&&n.push(l),l=[_]):l.push(_))}if(l&&n.push(l),e>1)for(let _=0;_<n.length;_++)n[_].length<=e||(Ul(n[_],e,1,n[_].length-1,le),n[_]=n[_].slice(0,e));return n}function le(i,e){return e.area-i.area}function a(i){let e=0;for(let n,l,p=0,_=i.length,b=_-1;p<_;b=p++)n=i[p],l=i[b],e+=(l.x-n.x)*(n.y+l.y);return e}const u=1/298.257223563,g=u*(2-u),v=Math.PI/180;class w{constructor(e){const n=6378.137*v*1e3,l=Math.cos(e*v),p=1/(1-g*(1-l*l)),_=Math.sqrt(p);this.kx=n*_*l,this.ky=n*_*p*(1-g)}distance(e,n){const l=this.wrap(e[0]-n[0])*this.kx,p=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+p*p)}pointOnLine(e,n){let l,p,_,b,T=1/0;for(let R=0;R<e.length-1;R++){let B=e[R][0],G=e[R][1],X=this.wrap(e[R+1][0]-B)*this.kx,$=(e[R+1][1]-G)*this.ky,K=0;X===0&&$===0||(K=(this.wrap(n[0]-B)*this.kx*X+(n[1]-G)*this.ky*$)/(X*X+$*$),K>1?(B=e[R+1][0],G=e[R+1][1]):K>0&&(B+=X/this.kx*K,G+=$/this.ky*K)),X=this.wrap(n[0]-B)*this.kx,$=(n[1]-G)*this.ky;const ie=X*X+$*$;ie<T&&(T=ie,l=B,p=G,_=R,b=K)}return{point:[l,p],index:_,t:Math.max(0,Math.min(1,b))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function I(i,e){return e[0]-i[0]}function O(i){return i[1]-i[0]+1}function F(i,e){return i[1]>=i[0]&&i[1]<e}function q(i,e){if(i[0]>i[1])return[null,null];const n=O(i);if(e){if(n===2)return[i,null];const p=Math.floor(n/2);return[[i[0],i[0]+p],[i[0]+p,i[1]]]}if(n===1)return[i,null];const l=Math.floor(n/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function te(i,e){if(!F(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)fc(n,i[l]);return n}function ue(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const l of n)fc(e,l);return e}function xe(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function ze(i,e,n){if(!xe(i)||!xe(e))return NaN;let l=0,p=0;return i[2]<e[0]&&(l=e[0]-i[2]),i[0]>e[2]&&(l=i[0]-e[2]),i[1]>e[3]&&(p=i[1]-e[3]),i[3]<e[1]&&(p=e[1]-i[3]),n.distance([0,0],[l,p])}function ot(i,e,n){const l=n.pointOnLine(e,i);return n.distance(i,l.point)}function ht(i,e,n,l,p){const _=Math.min(ot(i,[n,l],p),ot(e,[n,l],p)),b=Math.min(ot(n,[i,e],p),ot(l,[i,e],p));return Math.min(_,b)}function Dt(i,e,n,l,p){if(!F(e,i.length)||!F(l,n.length))return 1/0;let _=1/0;for(let b=e[0];b<e[1];++b){const T=i[b],R=i[b+1];for(let B=l[0];B<l[1];++B){const G=n[B],X=n[B+1];if(Bc(T,R,G,X))return 0;_=Math.min(_,ht(T,R,G,X,p))}}return _}function qt(i,e,n,l,p){if(!F(e,i.length)||!F(l,n.length))return NaN;let _=1/0;for(let b=e[0];b<=e[1];++b)for(let T=l[0];T<=l[1];++T)if(_=Math.min(_,p.distance(i[b],n[T])),_===0)return _;return _}function Sn(i,e,n){if(ro(i,e,!0))return 0;let l=1/0;for(const p of e){const _=p[0],b=p[p.length-1];if(_!==b&&(l=Math.min(l,ot(i,[b,_],n)),l===0))return l;const T=n.pointOnLine(p,i);if(l=Math.min(l,n.distance(i,T.point)),l===0)return l}return l}function wn(i,e,n,l){if(!F(e,i.length))return NaN;for(let _=e[0];_<=e[1];++_)if(ro(i[_],n,!0))return 0;let p=1/0;for(let _=e[0];_<e[1];++_){const b=i[_],T=i[_+1];for(const R of n)for(let B=0,G=R.length,X=G-1;B<G;X=B++){const $=R[X],K=R[B];if(Bc(b,T,$,K))return 0;p=Math.min(p,ht(b,T,$,K,l))}}return p}function xn(i,e){for(const n of i)for(const l of n)if(ro(l,e,!0))return!0;return!1}function Yi(i,e,n,l=1/0){const p=ue(i),_=ue(e);if(l!==1/0&&ze(p,_,n)>=l)return l;if(Oa(p,_)){if(xn(i,e))return 0}else if(xn(e,i))return 0;let b=1/0;for(const T of i)for(let R=0,B=T.length,G=B-1;R<B;G=R++){const X=T[G],$=T[R];for(const K of e)for(let ie=0,re=K.length,ae=re-1;ie<re;ae=ie++){const ye=K[ae],Fe=K[ie];if(Bc(X,$,ye,Fe))return 0;b=Math.min(b,ht(X,$,ye,Fe,n))}}return b}function Wn(i,e,n,l,p,_){if(!_)return;const b=ze(te(l,_),p,n);b<e&&i.push([b,_,[0,0]])}function rs(i,e,n,l,p,_,b){if(!_||!b)return;const T=ze(te(l,_),te(p,b),n);T<e&&i.push([T,_,b])}function xa(i,e,n,l,p=1/0){let _=Math.min(l.distance(i[0],n[0][0]),p);if(_===0)return _;const b=new rh([[0,[0,i.length-1],[0,0]]],I),T=ue(n);for(;b.length>0;){const R=b.pop();if(R[0]>=_)continue;const B=R[1],G=e?50:100;if(O(B)<=G){if(!F(B,i.length))return NaN;if(e){const X=wn(i,B,n,l);if(isNaN(X)||X===0)return X;_=Math.min(_,X)}else for(let X=B[0];X<=B[1];++X){const $=Sn(i[X],n,l);if(_=Math.min(_,$),_===0)return 0}}else{const X=q(B,e);Wn(b,_,l,i,T,X[0]),Wn(b,_,l,i,T,X[1])}}return _}function Vs(i,e,n,l,p,_=1/0){let b=Math.min(_,p.distance(i[0],n[0]));if(b===0)return b;const T=new rh([[0,[0,i.length-1],[0,n.length-1]]],I);for(;T.length>0;){const R=T.pop();if(R[0]>=b)continue;const B=R[1],G=R[2],X=e?50:100,$=l?50:100;if(O(B)<=X&&O(G)<=$){if(!F(B,i.length)&&F(G,n.length))return NaN;let K;if(e&&l)K=Dt(i,B,n,G,p),b=Math.min(b,K);else if(e&&!l){const ie=i.slice(B[0],B[1]+1);for(let re=G[0];re<=G[1];++re)if(K=ot(n[re],ie,p),b=Math.min(b,K),b===0)return b}else if(!e&&l){const ie=n.slice(G[0],G[1]+1);for(let re=B[0];re<=B[1];++re)if(K=ot(i[re],ie,p),b=Math.min(b,K),b===0)return b}else K=qt(i,B,n,G,p),b=Math.min(b,K)}else{const K=q(B,e),ie=q(G,l);rs(T,b,p,i,n,K[0],ie[0]),rs(T,b,p,i,n,K[0],ie[1]),rs(T,b,p,i,n,K[1],ie[0]),rs(T,b,p,i,n,K[1],ie[1])}}return b}function Ar(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class ss{constructor(e,n){this.type=ln,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Us(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new ss(l,l.features.map((p=>Ar(p.geometry))).flat());if(l.type==="Feature")return new ss(l,Ar(l.geometry));if("type"in l&&"coordinates"in l)return new ss(l,Ar(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const p=n.geometry(),_=p.flat().map((R=>Fl([R.x,R.y],n.canonical)));if(p.length===0)return NaN;const b=new w(_[0][1]);let T=1/0;for(const R of l){switch(R.type){case"Point":T=Math.min(T,Vs(_,!1,[R.coordinates],!1,b,T));break;case"LineString":T=Math.min(T,Vs(_,!1,R.coordinates,!0,b,T));break;case"Polygon":T=Math.min(T,xa(_,!1,R.coordinates,b,T))}if(T===0)return T}return T})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const p=n.geometry(),_=p.flat().map((R=>Fl([R.x,R.y],n.canonical)));if(p.length===0)return NaN;const b=new w(_[0][1]);let T=1/0;for(const R of l){switch(R.type){case"Point":T=Math.min(T,Vs(_,!0,[R.coordinates],!1,b,T));break;case"LineString":T=Math.min(T,Vs(_,!0,R.coordinates,!0,b,T));break;case"Polygon":T=Math.min(T,xa(_,!0,R.coordinates,b,T))}if(T===0)return T}return T})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,l){const p=n.geometry();if(p.length===0||p[0].length===0)return NaN;const _=dl(p,0).map((R=>R.map((B=>B.map((G=>Fl([G.x,G.y],n.canonical))))))),b=new w(_[0][0][0][1]);let T=1/0;for(const R of l)for(const B of _){switch(R.type){case"Point":T=Math.min(T,xa([R.coordinates],!1,B,b,T));break;case"LineString":T=Math.min(T,xa(R.coordinates,!0,B,b,T));break;case"Polygon":T=Math.min(T,Yi(B,R.coordinates,b,T))}if(T===0)return T}return T})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Qs{constructor(e){this.type=fn,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?n.error("Global state property must be defined."):typeof l!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Qs(l)}evaluate(e){var n;const l=(n=e.globals)===null||n===void 0?void 0:n.globalState;return l&&Object.keys(l).length!==0?Ns(l,this.key):null}eachChild(){}outputDefined(){return!1}}const ao={"==":Pa,"!=":Wi,">":ih,"<":wi,">=":Ua,"<=":gr,array:Ds,at:qe,boolean:Ds,case:Mn,coalesce:wr,collator:Sa,format:is,image:Co,in:Xe,"index-of":et,interpolate:Rs,"interpolate-hcl":Rs,"interpolate-lab":Rs,length:Zo,let:cr,literal:ys,match:bt,number:Ds,"number-format":dc,object:Ds,slice:Xn,step:It,string:Ds,"to-boolean":ns,"to-color":ns,"to-number":ns,"to-string":ns,var:Ee,within:$s,distance:ss,"global-state":Qs};class Gs{constructor(e,n,l,p){this.name=e,this.type=n,this._evaluate=l,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const l=e[0],p=Gs.definitions[l];if(!p)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=b.filter((([B])=>!Array.isArray(B)||B.length===e.length-1));let R=null;for(const[B,G]of T){R=new So(n.registry,Ba,n.path,null,n.scope);const X=[];let $=!1;for(let K=1;K<e.length;K++){const ie=e[K],re=Array.isArray(B)?B[K-1]:B.type,ae=R.parse(ie,1+X.length,re);if(!ae){$=!0;break}X.push(ae)}if(!$)if(Array.isArray(B)&&B.length!==X.length)R.error(`Expected ${B.length} arguments, but found ${X.length} instead.`);else{for(let K=0;K<X.length;K++){const ie=Array.isArray(B)?B[K]:B.type,re=X[K];R.concat(K+1).checkSubtype(ie,re.type)}if(R.errors.length===0)return new Gs(l,_,G,X)}}if(T.length===1)n.errors.push(...R.errors);else{const B=(T.length?T:b).map((([X])=>{return $=X,Array.isArray($)?`(${$.map(En).join(", ")})`:`(${En($.type)}...)`;var $})).join(" | "),G=[];for(let X=1;X<e.length;X++){const $=n.parse(e[X],1+G.length);if(!$)return null;G.push(En($.type))}n.error(`Expected arguments of type ${B}, but found (${G.join(", ")}) instead.`)}return null}static register(e,n){Gs.definitions=n;for(const l in n)e[l]=Gs}}function sh(i,[e,n,l,p]){e=e.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);const _=p?p.evaluate(i):1,b=Ys(e,n,l,_);if(b)throw new _r(b);return new Si(e/255,n/255,l/255,_,!1)}function bu(i,e){return i in e}function oo(i,e){const n=e[i];return n===void 0?null:n}function fl(i){return{type:i}}function Ba(i){if(i instanceof Ee)return Ba(i.boundExpression);if(i instanceof Gs&&i.name==="error"||i instanceof Sa||i instanceof $s||i instanceof ss||i instanceof Qs)return!1;const e=i instanceof ns||i instanceof Ds;let n=!0;return i.eachChild((l=>{n=e?n&&Ba(l):n&&l instanceof ys})),!!n&&Vl(i)&&Vc(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Vl(i){if(i instanceof Gs&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof $s||i instanceof ss)return!1;let e=!0;return i.eachChild((n=>{e&&!Vl(n)&&(e=!1)})),e}function Uc(i){if(i instanceof Gs&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!Uc(n)&&(e=!1)})),e}function Vc(i,e){if(i instanceof Gs&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((l=>{n&&!Vc(l,e)&&(n=!1)})),n}function ah(i){return{result:"success",value:i}}function mc(i){return{result:"error",value:i}}function To(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function qd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function vu(i){return!!i.expression&&i.expression.interpolated}function Oi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Wh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Nr(i)===un}function lo(i){return i}function Yh(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),p=i.type||(vu(e)?"exponential":"interval"),_=(function(G){switch(G.type){case"color":return Si.parse;case"padding":return Br.parse;case"numberArray":return er.parse;case"colorArray":return yn.parse;default:return null}})(e);if(_&&((i=gi({},i)).stops&&(i.stops=i.stops.map((G=>[G[0],_(G[1])]))),i.default=_(i.default?i.default:e.default)),i.colorSpace&&(b=i.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var b;const T=(function(G){switch(G){case"exponential":return yc;case"interval":return $h;case"categorical":return lp;case"identity":return Zd;default:throw new Error(`Unknown function type "${G}"`)}})(p);let R,B;if(p==="categorical"){R=Object.create(null);for(const G of i.stops)R[G[0]]=G[1];B=typeof i.stops[0][0]}if(n){const G={},X=[];for(let ie=0;ie<i.stops.length;ie++){const re=i.stops[ie],ae=re[0].zoom;G[ae]===void 0&&(G[ae]={zoom:ae,type:i.type,property:i.property,default:i.default,stops:[]},X.push(ae)),G[ae].stops.push([re[0].value,re[1]])}const $=[];for(const ie of X)$.push([G[ie].zoom,Yh(G[ie],e)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:Rs.interpolationFactor.bind(void 0,K),zoomStops:$.map((ie=>ie[0])),evaluate:({zoom:ie},re)=>yc({stops:$,base:i.base},e,ie).evaluate(ie,re)}}if(l){const G=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:G,interpolationFactor:Rs.interpolationFactor.bind(void 0,G),zoomStops:i.stops.map((X=>X[0])),evaluate:({zoom:X})=>T(i,e,X,R,B)}}return{kind:"source",evaluate(G,X){const $=X&&X.properties?X.properties[i.property]:void 0;return $===void 0?co(i.default,e.default):T(i,e,$,R,B)}}}function co(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function lp(i,e,n,l,p){return co(typeof n===p?l[n]:void 0,i.default,e.default)}function $h(i,e,n){if(Oi(n)!=="number")return co(i.default,e.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const p=Ui(i.stops.map((_=>_[0])),n);return i.stops[p][1]}function yc(i,e,n){const l=i.base!==void 0?i.base:1;if(Oi(n)!=="number")return co(i.default,e.default);const p=i.stops.length;if(p===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[p-1][0])return i.stops[p-1][1];const _=Ui(i.stops.map((G=>G[0])),n),b=(function(G,X,$,K){const ie=K-$,re=G-$;return ie===0?0:X===1?re/ie:(Math.pow(X,re)-1)/(Math.pow(X,ie)-1)})(n,l,i.stops[_][0],i.stops[_+1][0]),T=i.stops[_][1],R=i.stops[_+1][1],B=rr[e.type]||lo;return typeof T.evaluate=="function"?{evaluate(...G){const X=T.evaluate.apply(void 0,G),$=R.evaluate.apply(void 0,G);if(X!==void 0&&$!==void 0)return B(X,$,b,i.colorSpace)}}:B(T,R,b,i.colorSpace)}function Zd(i,e,n){switch(e.type){case"color":n=Si.parse(n);break;case"formatted":n=Xi.fromString(n.toString());break;case"resolvedImage":n=Ws.fromString(n.toString());break;case"padding":n=Br.parse(n);break;case"colorArray":n=yn.parse(n);break;case"numberArray":n=er.parse(n);break;default:Oi(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return co(n,i.default,e.default)}Gs.register(ao,{error:[{kind:"error"},[Ue],(i,[e])=>{throw new _r(e.evaluate(i))}],typeof:[Ue,[fn],(i,[e])=>En(Nr(e.evaluate(i)))],"to-rgba":[Zn(ln,4),[$t],(i,[e])=>{const[n,l,p,_]=e.evaluate(i).rgb;return[255*n,255*l,255*p,_]}],rgb:[$t,[ln,ln,ln],sh],rgba:[$t,[ln,ln,ln,ln],sh],has:{type:mt,overloads:[[[Ue],(i,[e])=>bu(e.evaluate(i),i.properties())],[[Ue,un],(i,[e,n])=>bu(e.evaluate(i),n.evaluate(i))]]},get:{type:fn,overloads:[[[Ue],(i,[e])=>oo(e.evaluate(i),i.properties())],[[Ue,un],(i,[e,n])=>oo(e.evaluate(i),n.evaluate(i))]]},"feature-state":[fn,[Ue],(i,[e])=>oo(e.evaluate(i),i.featureState||{})],properties:[un,[],i=>i.properties()],"geometry-type":[Ue,[],i=>i.geometryType()],id:[fn,[],i=>i.id()],zoom:[ln,[],i=>i.globals.zoom],"heatmap-density":[ln,[],i=>i.globals.heatmapDensity||0],elevation:[ln,[],i=>i.globals.elevation||0],"line-progress":[ln,[],i=>i.globals.lineProgress||0],accumulated:[fn,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ln,fl(ln),(i,e)=>{let n=0;for(const l of e)n+=l.evaluate(i);return n}],"*":[ln,fl(ln),(i,e)=>{let n=1;for(const l of e)n*=l.evaluate(i);return n}],"-":{type:ln,overloads:[[[ln,ln],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[ln],(i,[e])=>-e.evaluate(i)]]},"/":[ln,[ln,ln],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[ln,[ln,ln],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[ln,[],()=>Math.LN2],pi:[ln,[],()=>Math.PI],e:[ln,[],()=>Math.E],"^":[ln,[ln,ln],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[ln,[ln],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[ln,[ln],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[ln,[ln],(i,[e])=>Math.log(e.evaluate(i))],log2:[ln,[ln],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[ln,[ln],(i,[e])=>Math.sin(e.evaluate(i))],cos:[ln,[ln],(i,[e])=>Math.cos(e.evaluate(i))],tan:[ln,[ln],(i,[e])=>Math.tan(e.evaluate(i))],asin:[ln,[ln],(i,[e])=>Math.asin(e.evaluate(i))],acos:[ln,[ln],(i,[e])=>Math.acos(e.evaluate(i))],atan:[ln,[ln],(i,[e])=>Math.atan(e.evaluate(i))],min:[ln,fl(ln),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[ln,fl(ln),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[ln,[ln],(i,[e])=>Math.abs(e.evaluate(i))],round:[ln,[ln],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[ln,[ln],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[ln,[ln],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[mt,[Ue,fn],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[mt,[fn],(i,[e])=>i.id()===e.value],"filter-type-==":[mt,[Ue],(i,[e])=>i.geometryType()===e.value],"filter-<":[mt,[Ue,fn],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l<p}],"filter-id-<":[mt,[fn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[mt,[Ue,fn],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l>p}],"filter-id->":[mt,[fn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[mt,[Ue,fn],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[mt,[fn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[mt,[Ue,fn],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[mt,[fn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[mt,[fn],(i,[e])=>e.value in i.properties()],"filter-has-id":[mt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[mt,[Zn(Ue)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[mt,[Zn(fn)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[mt,[Ue,Zn(fn)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[mt,[Ue,Zn(fn)],(i,[e,n])=>(function(l,p,_,b){for(;_<=b;){const T=_+b>>1;if(p[T]===l)return!0;p[T]>l?b=T-1:_=T+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:mt,overloads:[[[mt,mt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[fl(mt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:mt,overloads:[[[mt,mt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[fl(mt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[mt,[mt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[mt,[Ue],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Ue,[Ue],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Ue,[Ue],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Ue,fl(fn),(i,e)=>e.map((n=>ma(n.evaluate(i)))).join("")],"resolved-locale":[Ue,[Rn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Qh{constructor(e,n,l){this.expression=e,this._warningHistory={},this._evaluator=new Eo,this._defaultValue=n?(function(p){if(p.type==="color"&&Wh(p.default))return new Si(0,0,0,0);switch(p.type){case"color":return Si.parse(p.default)||null;case"padding":return Br.parse(p.default)||null;case"numberArray":return er.parse(p.default)||null;case"colorArray":return yn.parse(p.default)||null;case"variableAnchorOffsetCollection":return ji.parse(p.default)||null;case"projectionDefinition":return Qr.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=na(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,p,_,b){this._globalState&&(e=na(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new _r(`Expected value to be one of ${Object.keys(this._enumValues).map((R=>JSON.stringify(R))).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function xc(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ao}function wu(i,e,n){const l=new So(ao,Ba,[],e?(function(_){const b={color:$t,string:Ue,number:ln,enum:Ue,boolean:mt,formatted:Hn,padding:Fn,numberArray:xi,colorArray:ki,projectionDefinition:gn,resolvedImage:bi,variableAnchorOffsetCollection:Ct};return _.type==="array"?Zn(b[_.value]||fn,_.length):b[_.type]})(e):void 0),p=l.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?ah(new Qh(p,e,n)):mc(l.errors)}class Fa{constructor(e,n,l){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Uc(n.expression),this.globalStateRefs=Ks(n.expression),this._globalState=l}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=na(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,p,_,b)}evaluate(e,n,l,p,_,b){return this._globalState&&(e=na(e,this._globalState)),this._styleExpression.evaluate(e,n,l,p,_,b)}}class _c{constructor(e,n,l,p,_){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Uc(n.expression),this.globalStateRefs=Ks(n.expression),this.interpolationType=p,this._globalState=_}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=na(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,p,_,b)}evaluate(e,n,l,p,_,b){return this._globalState&&(e=na(e,this._globalState)),this._styleExpression.evaluate(e,n,l,p,_,b)}interpolationFactor(e,n,l){return this.interpolationType?Rs.interpolationFactor(this.interpolationType,e,n,l):0}}function bc(i,e,n){const l=wu(i,e,n);if(l.result==="error")return l;const p=l.value.expression,_=Vl(p);if(!_&&!To(e))return mc([new An("","data expressions not supported")]);const b=Vc(p,["zoom"]);if(!b&&!qd(e))return mc([new An("","zoom expressions not supported")]);const T=vc(p);return T||b?T instanceof An?mc([T]):T instanceof Rs&&!vu(e)?mc([new An("",'"interpolate" expressions cannot be used with this property')]):ah(T?new _c(_?"camera":"composite",l.value,T.labels,T instanceof Rs?T.interpolation:void 0,n):new Fa(_?"constant":"source",l.value,n)):mc([new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Gc{constructor(e,n){this._parameters=e,this._specification=n,gi(this,Yh(this._parameters,this._specification))}static deserialize(e){return new Gc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function vc(i){let e=null;if(i instanceof cr)e=vc(i.result);else if(i instanceof wr){for(const n of i.args)if(e=vc(n),e)break}else(i instanceof It||i instanceof Rs)&&i.input instanceof Gs&&i.input.name==="zoom"&&(e=i);return e instanceof An||i.eachChild((n=>{const l=vc(n);l instanceof An?e=l:!e&&l?e=new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new An("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Ks(i,e=new Set){return i instanceof Qs&&e.add(i.key),i.eachChild((n=>{Ks(n,e)})),e}function na(i,e){const{zoom:n,heatmapDensity:l,elevation:p,lineProgress:_,isSupportedScript:b,accumulated:T}=i??{};return{zoom:n,heatmapDensity:l,elevation:p,lineProgress:_,isSupportedScript:b,accumulated:T,globalState:e}}function pl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!pl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const gl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ga(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};pl(i)||(i=Hc(i));const n=wu(i,gl,e);if(n.result==="error")throw new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,p,_)=>n.value.evaluate(l,p,{},_),needGeometry:Xd(i),getGlobalStateRefs:()=>Ks(n.value.expression)}}function Gl(i,e){return i<e?-1:i>e?1:0}function Xd(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Xd(i[e]))return!0;return!1}function Hc(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Au(i[1],i[2],"=="):e==="!="?Fr(Au(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Au(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Hc))):e==="all"?["all"].concat(i.slice(1).map(Hc)):e==="none"?["all"].concat(i.slice(1).map(Hc).map(Fr)):e==="in"?Wd(i[1],i.slice(2)):e==="!in"?Fr(Wd(i[1],i.slice(2))):e==="has"?ia(i[1]):e!=="!has"||Fr(ia(i[1]));var n}function Au(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Wd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Gl)]]:["filter-in-small",i,["literal",e]]}}function ia(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Fr(i){return["!",i]}function tr(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let p="[";for(const _ of i)p+=`${tr(_)},`;return`${p}]`}const n=Object.keys(i).sort();let l="{";for(let p=0;p<n.length;p++)l+=`${JSON.stringify(n[p])}:${tr(i[n[p]])},`;return`${l}}`}function Hl(i){let e="";for(const n of ai)e+=`/${tr(i[n])}`;return e}function uo(i){const e=i.value;return e?[new Jt(i.key,e,"constants have been deprecated as of v8")]:[]}function fs(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ha(i){if(Array.isArray(i))return i.map(Ha);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Ha(i[n]);return e}return fs(i)}function qa(i){const e=i.key,n=i.value,l=i.valueSpec||{},p=i.objectElementValidators||{},_=i.style,b=i.styleSpec,T=i.validateSpec;let R=[];const B=Oi(n);if(B!=="object")return[new Jt(e,n,`object expected, ${B} found`)];for(const G in n){const X=G.split(".")[0],$=Ns(l,X)||l["*"];let K;if(Ns(p,X))K=p[X];else if(Ns(l,X)){if(n[G]===void 0)continue;K=T}else if(p["*"])K=p["*"];else{if(!l["*"]){R.push(new Jt(e,n[G],`unknown property "${G}"`));continue}K=T}R=R.concat(K({key:(e&&`${e}.`)+G,value:n[G],valueSpec:$,style:_,styleSpec:b,object:n,objectKey:G,validateSpec:T},n))}for(const G in l)p[G]||l[G].required&&l[G].default===void 0&&n[G]===void 0&&R.push(new Jt(e,n,`missing required property "${G}"`));return R}function oh(i){const e=i.value,n=i.valueSpec,l=i.style,p=i.styleSpec,_=i.key,b=i.arrayElementValidator||i.validateSpec;if(Oi(e)!=="array")return[new Jt(_,e,`array expected, ${Oi(e)} found`)];if(n.length&&e.length!==n.length)return[new Jt(_,e,`array length ${n.length} expected, length ${e.length} found`)];let T={type:n.value,values:n.values};p.$version<7&&(T.function=n.function),Oi(n.value)==="object"&&(T=n.value);let R=[];for(let B=0;B<e.length;B++)R=R.concat(b({array:e,arrayIndex:B,value:e[B],valueSpec:T,validateSpec:i.validateSpec,style:l,styleSpec:p,key:`${_}[${B}]`}));return R}function ml(i){const e=i.key,n=i.value,l=i.valueSpec;let p=Oi(n);return p==="number"&&n!=n&&(p="NaN"),p!=="number"?[new Jt(e,n,`number expected, ${p} found`)]:"minimum"in l&&n<l.minimum?[new Jt(e,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new Jt(e,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function yl(i){const e=i.valueSpec,n=fs(i.value.type);let l,p,_,b={};const T=n!=="categorical"&&i.value.property===void 0,R=!T,B=Oi(i.value.stops)==="array"&&Oi(i.value.stops[0])==="array"&&Oi(i.value.stops[0][0])==="object",G=qa({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(K){if(n==="identity")return[new Jt(K.key,K.value,'identity function may not have a "stops" property')];let ie=[];const re=K.value;return ie=ie.concat(oh({key:K.key,value:re,valueSpec:K.valueSpec,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:X})),Oi(re)==="array"&&re.length===0&&ie.push(new Jt(K.key,re,"array must have at least one stop")),ie},default:function(K){return K.validateSpec({key:K.key,value:K.value,valueSpec:e,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec})}}});return n==="identity"&&T&&G.push(new Jt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||G.push(new Jt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!vu(i.valueSpec)&&G.push(new Jt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(R&&!To(i.valueSpec)?G.push(new Jt(i.key,i.value,"property functions not supported")):T&&!qd(i.valueSpec)&&G.push(new Jt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!B||i.value.property!==void 0||G.push(new Jt(i.key,i.value,'"property" property is required')),G;function X(K){let ie=[];const re=K.value,ae=K.key;if(Oi(re)!=="array")return[new Jt(ae,re,`array expected, ${Oi(re)} found`)];if(re.length!==2)return[new Jt(ae,re,`array length 2 expected, length ${re.length} found`)];if(B){if(Oi(re[0])!=="object")return[new Jt(ae,re,`object expected, ${Oi(re[0])} found`)];if(re[0].zoom===void 0)return[new Jt(ae,re,"object stop key must have zoom")];if(re[0].value===void 0)return[new Jt(ae,re,"object stop key must have value")];if(_&&_>fs(re[0].zoom))return[new Jt(ae,re[0].zoom,"stop zoom values must appear in ascending order")];fs(re[0].zoom)!==_&&(_=fs(re[0].zoom),p=void 0,b={}),ie=ie.concat(qa({key:`${ae}[0]`,value:re[0],valueSpec:{zoom:{}},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:ml,value:$}}))}else ie=ie.concat($({key:`${ae}[0]`,value:re[0],validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec},re));return xc(Ha(re[1]))?ie.concat([new Jt(`${ae}[1]`,re[1],"expressions are not allowed in function stops.")]):ie.concat(K.validateSpec({key:`${ae}[1]`,value:re[1],valueSpec:e,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec}))}function $(K,ie){const re=Oi(K.value),ae=fs(K.value),ye=K.value!==null?K.value:ie;if(l){if(re!==l)return[new Jt(K.key,ye,`${re} stop domain type must match previous stop domain type ${l}`)]}else l=re;if(re!=="number"&&re!=="string"&&re!=="boolean")return[new Jt(K.key,ye,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&n!=="categorical"){let Fe=`number expected, ${re} found`;return To(e)&&n===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Jt(K.key,ye,Fe)]}return n!=="categorical"||re!=="number"||isFinite(ae)&&Math.floor(ae)===ae?n!=="categorical"&&re==="number"&&p!==void 0&&ae<p?[new Jt(K.key,ye,"stop domain values must appear in ascending order")]:(p=ae,n==="categorical"&&ae in b?[new Jt(K.key,ye,"stop domain values must be unique")]:(b[ae]=!0,[])):[new Jt(K.key,ye,`integer expected, found ${ae}`)]}}function xl(i){const e=(i.expressionContext==="property"?bc:wu)(Ha(i.value),i.valueSpec);if(e.result==="error")return e.value.map((l=>new Jt(`${i.key}${l.key}`,i.value,l.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Jt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Uc(n))return[new Jt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Uc(n))return[new Jt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Vc(n,["zoom","feature-state"]))return[new Jt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Vl(n))return[new Jt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ql(i){const e=i.key,n=i.value,l=Oi(n);return l!=="string"?[new Jt(e,n,`color expected, ${l} found`)]:Si.parse(String(n))?[]:[new Jt(e,n,`color expected, "${n}" found`)]}function Zl(i){const e=i.key,n=i.value,l=i.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(fs(n))===-1&&p.push(new Jt(e,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(fs(n))===-1&&p.push(new Jt(e,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function Io(i){return pl(Ha(i.value))?xl(gi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):_l(i)}function _l(i){const e=i.value,n=i.key;if(Oi(e)!=="array")return[new Jt(n,e,`array expected, ${Oi(e)} found`)];const l=i.styleSpec;let p,_=[];if(e.length<1)return[new Jt(n,e,"filter array must have at least 1 element")];switch(_=_.concat(Zl({key:`${n}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),fs(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&fs(e[1])==="$type"&&_.push(new Jt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&_.push(new Jt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Oi(e[1]),p!=="string"&&_.push(new Jt(`${n}[1]`,e[1],`string expected, ${p} found`)));for(let b=2;b<e.length;b++)p=Oi(e[b]),fs(e[1])==="$type"?_=_.concat(Zl({key:`${n}[${b}]`,value:e[b],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new Jt(`${n}[${b}]`,e[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<e.length;b++)_=_.concat(_l({key:`${n}[${b}]`,value:e[b],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Oi(e[1]),e.length!==2?_.push(new Jt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new Jt(`${n}[1]`,e[1],`string expected, ${p} found`))}return _}function Xl(i,e){const n=i.key,l=i.validateSpec,p=i.style,_=i.styleSpec,b=i.value,T=i.objectKey,R=_[`${e}_${i.layerType}`];if(!R)return[];const B=T.match(/^(.*)-transition$/);if(e==="paint"&&B&&R[B[1]]&&R[B[1]].transition)return l({key:n,value:b,valueSpec:_.transition,style:p,styleSpec:_});const G=i.valueSpec||R[T];if(!G)return[new Jt(n,b,`unknown property "${T}"`)];let X;if(Oi(b)==="string"&&To(G)&&!G.tokens&&(X=/^{([^}]+)}$/.exec(b)))return[new Jt(n,b,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(X[1])} }\`.`)];const $=[];return i.layerType==="symbol"&&T==="text-font"&&Wh(Ha(b))&&fs(b.type)==="identity"&&$.push(new Jt(n,b,'"text-font" does not support identity functions')),$.concat(l({key:i.key,value:b,valueSpec:G,style:p,styleSpec:_,expressionContext:"property",propertyType:e,propertyKey:T}))}function bl(i){return Xl(i,"paint")}function Kh(i){return Xl(i,"layout")}function Jh(i){let e=[];const n=i.value,l=i.key,p=i.style,_=i.styleSpec;if(Oi(n)!=="object")return[new Jt(l,n,`object expected, ${Oi(n)} found`)];n.type||n.ref||e.push(new Jt(l,n,'either "type" or "ref" is required'));let b=fs(n.type);const T=fs(n.ref);if(n.id){const R=fs(n.id);for(let B=0;B<i.arrayIndex;B++){const G=p.layers[B];fs(G.id)===R&&e.push(new Jt(l,n.id,`duplicate layer id "${n.id}", previously used at line ${G.id.__line__}`))}}if("ref"in n){let R;["type","source","source-layer","filter","layout"].forEach((B=>{B in n&&e.push(new Jt(l,n[B],`"${B}" is prohibited for ref layers`))})),p.layers.forEach((B=>{fs(B.id)===T&&(R=B)})),R?R.ref?e.push(new Jt(l,n.ref,"ref cannot reference another ref layer")):b=fs(R.type):e.push(new Jt(l,n.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(n.source){const R=p.sources&&p.sources[n.source],B=R&&fs(R.type);R?B==="vector"&&b==="raster"?e.push(new Jt(l,n.source,`layer "${n.id}" requires a raster source`)):B!=="raster-dem"&&b==="hillshade"||B!=="raster-dem"&&b==="color-relief"?e.push(new Jt(l,n.source,`layer "${n.id}" requires a raster-dem source`)):B==="raster"&&b!=="raster"?e.push(new Jt(l,n.source,`layer "${n.id}" requires a vector source`)):B!=="vector"||n["source-layer"]?B==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?e.push(new Jt(l,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!n.paint||!n.paint["line-gradient"]||B==="geojson"&&R.lineMetrics||e.push(new Jt(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Jt(l,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Jt(l,n.source,`source "${n.source}" not found`))}else e.push(new Jt(l,n,'missing required property "source"'));return e=e.concat(qa({key:l,value:n,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:n.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Io,layout:R=>qa({layer:n,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":B=>Kh(gi({layerType:b},B))}}),paint:R=>qa({layer:n,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":B=>bl(gi({layerType:b},B))}})}})),e}function ho(i){const e=i.value,n=i.key,l=Oi(e);return l!=="string"?[new Jt(n,e,`string expected, ${l} found`)]:[]}const Eu={promoteId:function({key:i,value:e}){if(Oi(e)==="string")return ho({key:i,value:e});{const n=[];for(const l in e)n.push(...ho({key:`${i}.${l}`,value:e[l]}));return n}}};function Wl(i){const e=i.value,n=i.key,l=i.styleSpec,p=i.style,_=i.validateSpec;if(!e.type)return[new Jt(n,e,'"type" is required')];const b=fs(e.type);let T;switch(b){case"vector":case"raster":return T=qa({key:n,value:e,valueSpec:l[`source_${b.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Eu,validateSpec:_}),T;case"raster-dem":return T=(function(R){var B;const G=(B=R.sourceName)!==null&&B!==void 0?B:"",X=R.value,$=R.styleSpec,K=$.source_raster_dem,ie=R.style;let re=[];const ae=Oi(X);if(X===void 0)return re;if(ae!=="object")return re.push(new Jt("source_raster_dem",X,`object expected, ${ae} found`)),re;const ye=fs(X.encoding)==="custom",Fe=["redFactor","greenFactor","blueFactor","baseShift"],be=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Se in X)!ye&&Fe.includes(Se)?re.push(new Jt(Se,X[Se],`In "${G}": "${Se}" is only valid when "encoding" is set to "custom". ${be} encoding found`)):K[Se]?re=re.concat(R.validateSpec({key:Se,value:X[Se],valueSpec:K[Se],validateSpec:R.validateSpec,style:ie,styleSpec:$})):re.push(new Jt(Se,X[Se],`unknown property "${Se}"`));return re})({sourceName:n,value:e,style:i.style,styleSpec:l,validateSpec:_}),T;case"geojson":if(T=qa({key:n,value:e,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:_,objectElementValidators:Eu}),e.cluster)for(const R in e.clusterProperties){const[B,G]=e.clusterProperties[R],X=typeof B=="string"?[B,["accumulated"],["get",R]]:B;T.push(...xl({key:`${n}.${R}.map`,value:G,expressionContext:"cluster-map"})),T.push(...xl({key:`${n}.${R}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return T;case"video":return qa({key:n,value:e,valueSpec:l.source_video,style:p,validateSpec:_,styleSpec:l});case"image":return qa({key:n,value:e,valueSpec:l.source_image,style:p,validateSpec:_,styleSpec:l});case"canvas":return[new Jt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zl({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ps(i){const e=i.value,n=i.styleSpec,l=n.light,p=i.style;let _=[];const b=Oi(e);if(e===void 0)return _;if(b!=="object")return _=_.concat([new Jt("light",e,`object expected, ${b} found`)]),_;for(const T in e){const R=T.match(/^(.*)-transition$/);_=_.concat(R&&l[R[1]]&&l[R[1]].transition?i.validateSpec({key:T,value:e[T],valueSpec:n.transition,validateSpec:i.validateSpec,style:p,styleSpec:n}):l[T]?i.validateSpec({key:T,value:e[T],valueSpec:l[T],validateSpec:i.validateSpec,style:p,styleSpec:n}):[new Jt(T,e[T],`unknown property "${T}"`)])}return _}function lh(i){const e=i.value,n=i.styleSpec,l=n.sky,p=i.style,_=Oi(e);if(e===void 0)return[];if(_!=="object")return[new Jt("sky",e,`object expected, ${_} found`)];let b=[];for(const T in e)b=b.concat(l[T]?i.validateSpec({key:T,value:e[T],valueSpec:l[T],style:p,styleSpec:n}):[new Jt(T,e[T],`unknown property "${T}"`)]);return b}function ed(i){const e=i.value,n=i.styleSpec,l=n.terrain,p=i.style;let _=[];const b=Oi(e);if(e===void 0)return _;if(b!=="object")return _=_.concat([new Jt("terrain",e,`object expected, ${b} found`)]),_;for(const T in e)_=_.concat(l[T]?i.validateSpec({key:T,value:e[T],valueSpec:l[T],validateSpec:i.validateSpec,style:p,styleSpec:n}):[new Jt(T,e[T],`unknown property "${T}"`)]);return _}function Yd(i){let e=[];const n=i.value,l=i.key;if(Array.isArray(n)){const p=[],_=[];for(const b in n)n[b].id&&p.includes(n[b].id)&&e.push(new Jt(l,n,`all the sprites' ids must be unique, but ${n[b].id} is duplicated`)),p.push(n[b].id),n[b].url&&_.includes(n[b].url)&&e.push(new Jt(l,n,`all the sprites' URLs must be unique, but ${n[b].url} is duplicated`)),_.push(n[b].url),e=e.concat(qa({key:`${l}[${b}]`,value:n[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return ho({key:l,value:n})}function cp(i){return!!i&&i.constructor===Object}function $d(i){return cp(i.value)?[]:[new Jt(i.key,i.value,`object expected, ${Oi(i.value)} found`)]}const Ts={"*":()=>[],array:oh,boolean:function(i){const e=i.value,n=i.key,l=Oi(e);return l!=="boolean"?[new Jt(n,e,`boolean expected, ${l} found`)]:[]},number:ml,color:ql,constants:uo,enum:Zl,filter:Io,function:yl,layer:Jh,object:qa,source:Wl,light:Ps,sky:lh,terrain:ed,projection:function(i){const e=i.value,n=i.styleSpec,l=n.projection,p=i.style,_=Oi(e);if(e===void 0)return[];if(_!=="object")return[new Jt("projection",e,`object expected, ${_} found`)];let b=[];for(const T in e)b=b.concat(l[T]?i.validateSpec({key:T,value:e[T],valueSpec:l[T],style:p,styleSpec:n}):[new Jt(T,e[T],`unknown property "${T}"`)]);return b},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const l=Oi(n);return l!=="array"||(function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"})(n)||(function(p){return!!["interpolate","step","literal"].includes(p[0])})(n)?["array","string"].includes(l)?[]:[new Jt(e,n,`projection expected, invalid type "${l}" found`)]:[new Jt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:ho,formatted:function(i){return ho(i).length===0?[]:xl(i)},resolvedImage:function(i){return ho(i).length===0?[]:xl(i)},padding:function(i){const e=i.key,n=i.value;if(Oi(n)==="array"){if(n.length<1||n.length>4)return[new Jt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let p=[];for(let _=0;_<n.length;_++)p=p.concat(i.validateSpec({key:`${e}[${_}]`,value:n[_],validateSpec:i.validateSpec,valueSpec:l}));return p}return ml({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(Oi(n)==="array"){const l={type:"number"};if(n.length<1)return[new Jt(e,n,"array length at least 1 expected, length 0 found")];let p=[];for(let _=0;_<n.length;_++)p=p.concat(i.validateSpec({key:`${e}[${_}]`,value:n[_],validateSpec:i.validateSpec,valueSpec:l}));return p}return ml({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(Oi(n)==="array"){if(n.length<1)return[new Jt(e,n,"array length at least 1 expected, length 0 found")];let l=[];for(let p=0;p<n.length;p++)l=l.concat(ql({key:`${e}[${p}]`,value:n[p]}));return l}return ql({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,l=Oi(n),p=i.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new Jt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let b=0;b<n.length;b+=2)_=_.concat(Zl({key:`${e}[${b}]`,value:n[b],valueSpec:p.layout_symbol["text-anchor"]})),_=_.concat(oh({key:`${e}[${b+1}]`,value:n[b+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:p}));return _},sprite:Yd,state:$d,fontFaces:function(i){const e=i.key,n=i.value,l=i.validateSpec,p=i.styleSpec,_=i.style;if(!cp(n))return[new Jt(e,n,`object expected, ${Oi(n)} found`)];const b=[];for(const T in n){const R=n[T],B=Oi(R);if(B==="string")b.push(...ho({key:`${e}.${T}`,value:R}));else if(B==="array"){const G={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[X,$]of R.entries())b.push(...qa({key:`${e}.${T}[${X}]`,value:$,valueSpec:G,styleSpec:p,style:_,validateSpec:l}))}else b.push(new Jt(`${e}.${T}`,R,`string or array expected, ${B} found`))}return b}};function vl(i){const e=i.value,n=i.valueSpec,l=i.styleSpec;return i.validateSpec=vl,n.expression&&Wh(fs(e))?yl(i):n.expression&&xc(Ha(e))?xl(i):n.type&&Ts[n.type]?Ts[n.type](i):qa(gi({},i,{valueSpec:n.type?l[n.type]:n}))}function Su(i){const e=i.value,n=i.key,l=ho(i);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new Jt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new Jt(n,e,'"glyphs" url must include a "{range}" token'))),l}function Ca(i,e=ut){let n=[];return n=n.concat(vl({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:vl,objectElementValidators:{glyphs:Su,"*":()=>[]}})),i.constants&&(n=n.concat(uo({key:"constants",value:i.constants}))),qc(n)}function fo(i){return function(e){return i(Object.assign({},e,{validateSpec:vl}))}}function qc(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function Ta(i){return function(...e){return qc(i.apply(this,e))}}Ca.source=Ta(fo(Wl)),Ca.sprite=Ta(fo(Yd)),Ca.glyphs=Ta(fo(Su)),Ca.light=Ta(fo(Ps)),Ca.sky=Ta(fo(lh)),Ca.terrain=Ta(fo(ed)),Ca.state=Ta(fo($d)),Ca.layer=Ta(fo(Jh)),Ca.filter=Ta(fo(Io)),Ca.paintProperty=Ta(fo(bl)),Ca.layoutProperty=Ta(fo(Kh));const E0={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Cu{constructor(e,n){this._globalState=n,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=wu(e,E0,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=Ks(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const ch=ut,Js=Ca,Xo=Js.light,td=Js.sky,nd=Js.paintProperty,up=Js.layoutProperty;function Wo(i,e){let n=!1;if(e&&e.length)for(const l of e)i.fire(new mn(new Error(l.message))),n=!0;return n}class wc{constructor(e,n,l){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const b=new Int32Array(this.arrayBuffer);e=b[0],this.d=(n=b[1])+2*(l=b[2]);for(let R=0;R<this.d*this.d;R++){const B=b[3+R],G=b[3+R+1];p.push(B===G?null:b.subarray(B,G))}const T=b[3+p.length+1];this.keys=b.subarray(b[3+p.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let b=0;b<this.d*this.d;b++)p.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=l,this.scale=n/e,this.uid=0;const _=l/n*e;this.min=-_,this.max=e+_}insert(e,n,l,p,_){this._forEachCell(n,l,p,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,l,p,_,b){this.cells[_].push(b)}query(e,n,l,p,_){const b=this.min,T=this.max;if(e<=b&&n<=b&&T<=l&&T<=p&&!_)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(e,n,l,p,this._queryCell,R,{},_),R}}_queryCell(e,n,l,p,_,b,T,R){const B=this.cells[_];if(B!==null){const G=this.keys,X=this.bboxes;for(let $=0;$<B.length;$++){const K=B[$];if(T[K]===void 0){const ie=4*K;(R?R(X[ie+0],X[ie+1],X[ie+2],X[ie+3]):e<=X[ie+2]&&n<=X[ie+3]&&l>=X[ie+0]&&p>=X[ie+1])?(T[K]=!0,b.push(G[K])):T[K]=!1}}}}_forEachCell(e,n,l,p,_,b,T,R){const B=this._convertToCellCoord(e),G=this._convertToCellCoord(n),X=this._convertToCellCoord(l),$=this._convertToCellCoord(p);for(let K=B;K<=X;K++)for(let ie=G;ie<=$;ie++){const re=this.d*ie+K;if((!R||R(this._convertFromCellCoord(K),this._convertFromCellCoord(ie),this._convertFromCellCoord(K+1),this._convertFromCellCoord(ie+1)))&&_.call(this,e,n,l,p,re,b,T,R))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let l=0;for(let b=0;b<this.cells.length;b++)l+=this.cells[b].length;const p=new Int32Array(n+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let _=n;for(let b=0;b<e.length;b++){const T=e[b];p[3+b]=_,p.set(T,_),_+=T.length}return p[3+e.length]=_,p.set(this.keys,_),_+=this.keys.length,p[3+e.length+1]=_,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer}static serialize(e,n){const l=e.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(e){return new wc(e.buffer)}}const Za={};function On(i,e,n={}){if(Za[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Za[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}On("Object",Object),On("Set",Set),On("TransferableGridIndex",wc),On("Color",Si),On("Error",Error),On("AJAXError",de),On("ResolvedImage",Ws),On("StylePropertyFunction",Gc),On("StyleExpression",Qh,{omit:["_evaluator"]}),On("ZoomDependentExpression",_c),On("ZoomConstantExpression",Fa),On("CompoundExpression",Gs,{omit:["_evaluate"]});for(const i in ao)ao[i]._classRegistryKey||On(`Expression_${i}`,ao[i]);function uh(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function id(i){return i.$name||i.constructor._classRegistryKey}function Mo(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=id(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||uh(i)||Gn(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Yo(i,e){if(Mo(i))return(uh(i)||Gn(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const _=[];for(const b of i)_.push(Yo(b,e));return _}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=id(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Za[n])throw new Error(`${n} is not registered.`);const{klass:l}=Za[n],p=l.serialize?l.serialize(i,e):{};if(l.serialize){if(e&&p===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||Za[n].omit.indexOf(_)>=0)continue;const b=i[_];p[_]=Za[n].shallow.indexOf(_)>=0?b:Yo(b,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(p.$name=n),p}function Tu(i){if(Mo(i))return i;if(Array.isArray(i))return i.map(Tu);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=id(i)||"Object";if(!Za[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Za[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const l=Object.create(n.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const _=i[p];l[p]=Za[e].shallow.indexOf(p)>=0?_:Tu(_)}return l}class rd{constructor(){this.first=!0}update(e,n){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function wl(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Zc(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function hh(i){return/\s/u.test(String.fromCodePoint(i))}function Al(i){for(const e of i)if(Zc(e.codePointAt(0)))return!0;return!1}function sd(i){for(const e of i)if(!Qd(e.codePointAt(0)))return!1;return!0}function dh(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const El=dh(["Arab","Dupl","Mong","Ougr","Syrc"]);function Qd(i){return!El.test(String.fromCodePoint(i))}function Sl(i){return!(Zc(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const ad=dh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function fh(i){return ad.test(String.fromCodePoint(i))}function Cl(i,e){return!(!e&&fh(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Yl(i){for(const e of i)if(fh(e.codePointAt(0)))return!0;return!1}const ko=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(ko.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return h(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,l=new Promise((_=>{this.loadScriptResolve=_}));e(n);const p=new Promise((_=>setTimeout((()=>_()),this.TIMEOUT)));if(yield Promise.race([l,p]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:n};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class Ir{constructor(e,n){this.isSupportedScript=Kd,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new rd,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new rd,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}function Kd(i){return(function(e,n){for(const l of e)if(!Cl(l.codePointAt(0),n))return!1;return!0})(i,ko.getRTLTextPluginStatus()==="loaded")}const $l="-transition";class Ac{constructor(e,n,l){this.property=e,this.value=n,this.expression=(function(p,_,b){if(Wh(p))return new Gc(p,_);if(xc(p)){const T=bc(p,_,b);if(T.result==="error")throw new Error(T.value.map((R=>`${R.key}: ${R.message}`)).join(", "));return T.value}{let T=p;return _.type==="color"&&typeof p=="string"?T=Si.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?_.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?T=ji.parse(p):_.type==="projectionDefinition"&&typeof p=="string"&&(T=Qr.parse(p)):T=yn.parse(p):T=er.parse(p):T=Br.parse(p),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>T}}})(n===void 0?e.specification.default:n,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class ph{constructor(e,n){this.property=e,this.value=new Ac(e,void 0,n)}transitioned(e,n){return new Xc(this.property,this.value,n,an({},e.transition,this.transition),e.now)}untransitioned(){return new Xc(this.property,this.value,null,{},0)}}class od{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return si(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ph(this._values[e].property,this._globalState)),this._values[e].value=new Ac(this._values[e].property,n===null?void 0:si(n),this._globalState)}getTransition(e){return si(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ph(this._values[e].property,this._globalState)),this._values[e].transition=si(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const p=this.getTransition(n);p!==void 0&&(e[`${n}${$l}`]=p)}return e}transitioned(e,n){const l=new gh(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(e,n._values[p]);return l}untransitioned(){const e=new gh(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Xc{constructor(e,n,l,p,_){this.property=e,this.value=n,this.begin=_+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const p=e.now||0,_=this.value.possiblyEvaluate(e,n,l),b=this.prior;if(b){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return b.possiblyEvaluate(e,n,l);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(e,n,l),_,Nt(T))}}return _}}class gh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const p=new Wc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,n,l);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Jd{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return si(this._values[e].value)}setValue(e,n){this._values[e]=new Ac(this._values[e].property,n===null?void 0:si(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const p=new Wc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,n,l);return p}}class po{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,p){return this.property.evaluate(this.value,this.parameters,e,n,l,p)}}class Wc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Bn{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,l){const p=rr[this.specification.type];return p?p(e,n,l):e}}class ri{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,p){return new po(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,p)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new po(this,{kind:"constant",value:void 0},e.parameters);const p=rr[this.specification.type];if(p){const _=p(e.value.value,n.value.value,l);return new po(this,{kind:"constant",value:_},e.parameters)}return e}evaluate(e,n,l,p,_,b){return e.kind==="constant"?e.value:e.evaluate(n,l,p,_,b)}}class No extends ri{possiblyEvaluate(e,n,l,p){if(e.value===void 0)return new po(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const _=e.expression.evaluate(n,null,{},l,p),b=e.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,T=this._calculate(b,b,b,n);return new po(this,{kind:"constant",value:T},n)}if(e.expression.kind==="camera"){const _=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new po(this,{kind:"constant",value:_},n)}return new po(this,e.expression,n)}evaluate(e,n,l,p,_,b){if(e.kind==="source"){const T=e.evaluate(n,l,p,_,b);return this._calculate(T,T,T,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},l,p),e.evaluate({zoom:Math.floor(n.zoom)},l,p),e.evaluate({zoom:Math.floor(n.zoom)+1},l,p),n):e.value}_calculate(e,n,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class Iu{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const _=e.expression.evaluate(n,null,{},l,p);return this._calculate(_,_,_,n)}return this._calculate(e.expression.evaluate(new Ir(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Ir(Math.floor(n.zoom),n)),e.expression.evaluate(new Ir(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class mh{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,p){return!!e.expression.evaluate(n,null,{},l,p)}interpolate(){return!1}}class Is{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const l=e[n];l.specification.overridable&&this.overridableProperties.push(n);const p=this.defaultPropertyValues[n]=new Ac(l,void 0,void 0),_=this.defaultTransitionablePropertyValues[n]=new ph(l,void 0);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=p.possiblyEvaluate({})}}}On("DataDrivenProperty",ri),On("DataConstantProperty",Bn),On("CrossFadedDataDrivenProperty",No),On("CrossFadedProperty",Iu),On("ColorRampProperty",mh);class ps extends ti{constructor(e,n,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(p,_){return new Cu(p,_)})(this.visibility,l),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Ga(e.filter,l)),n.layout&&(this._unevaluatedLayout=new Jd(n.layout,l)),n.paint)){this._transitionablePaint=new od(n.paint,l);for(const p in e.paint)this.setPaintProperty(p,e.paint[p],{validate:!1});for(const p in e.layout)this.setLayoutProperty(p,e.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Wc(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=Ga(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())e.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[n];for(const p of l.getGlobalStateRefs())e.add(p)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const p=this._transitionablePaint._values[l].value;for(const _ of p.getGlobalStateRefs()){const b=(e=n.get(_))!==null&&e!==void 0?e:[];b.push({name:l,value:p.value}),n.set(_,b)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,n,l={}){if(n==null||!this._validate(up,`layers.${this.id}.layout.${e}`,e,n,l))return e==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,n)}getPaintProperty(e){return e.endsWith($l)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,l={}){if(n!=null&&this._validate(nd,`layers.${this.id}.paint.${e}`,e,n,l))return!1;if(e.endsWith($l))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const p=this._transitionablePaint._values[e],_=p.property.specification["property-type"]==="cross-faded-data-driven",b=p.value.isDataDriven(),T=p.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const R=this._transitionablePaint._values[e].value;return R.isDataDriven()||b||_||this._handleOverridablePaintPropertyUpdate(e,T,R)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e=this.minzoom,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Dn(e,((n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length)))}_validate(e,n,l,p,_={}){return(!_||_.validate!==!1)&&Wo(this,e.call(Js,{key:n,layerType:this.type,objectKey:l,value:p,styleSpec:ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof po&&To(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let xs;var yh={get paint(){return xs=xs||new Is({"raster-opacity":new Bn(ut.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bn(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bn(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bn(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new Bn(ut.paint_raster["raster-saturation"]),"raster-contrast":new Bn(ut.paint_raster["raster-contrast"]),"raster-resampling":new Bn(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new Bn(ut.paint_raster["raster-fade-duration"])})}};class Ql extends ps{constructor(e,n){super(e,yh,n)}}const Gi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Er{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Vi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function as(i,e=1){let n=0,l=0;return{members:i.map((p=>{const _=Gi[p.type].BYTES_PER_ELEMENT,b=n=Do(n,Math.max(e,_)),T=p.components||1;return l=Math.max(l,_),n+=_*T,{name:p.name,type:p.type,components:T,offset:b}})),size:Do(n,Math.max(l,e)),alignment:e}}function Do(i,e){return Math.ceil(i/e)*e}class $o extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.int16[p+0]=n,this.int16[p+1]=l,e}}$o.prototype.bytesPerElement=4,On("StructArrayLayout2i4",$o);class Yc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.int16[_+0]=n,this.int16[_+1]=l,this.int16[_+2]=p,e}}Yc.prototype.bytesPerElement=6,On("StructArrayLayout3i6",Yc);class $c extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,p)}emplace(e,n,l,p,_){const b=4*e;return this.int16[b+0]=n,this.int16[b+1]=l,this.int16[b+2]=p,this.int16[b+3]=_,e}}$c.prototype.bytesPerElement=8,On("StructArrayLayout4i8",$c);class Kl extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,T){const R=6*e;return this.int16[R+0]=n,this.int16[R+1]=l,this.int16[R+2]=p,this.int16[R+3]=_,this.int16[R+4]=b,this.int16[R+5]=T,e}}Kl.prototype.bytesPerElement=12,On("StructArrayLayout2i4i12",Kl);class ef extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,T){const R=4*e,B=8*e;return this.int16[R+0]=n,this.int16[R+1]=l,this.uint8[B+4]=p,this.uint8[B+5]=_,this.uint8[B+6]=b,this.uint8[B+7]=T,e}}ef.prototype.bytesPerElement=8,On("StructArrayLayout2i4ub8",ef);class Jr extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.float32[p+0]=n,this.float32[p+1]=l,e}}Jr.prototype.bytesPerElement=8,On("StructArrayLayout2f8",Jr);class Qo extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B,G){const X=this.length;return this.resize(X+1),this.emplace(X,e,n,l,p,_,b,T,R,B,G)}emplace(e,n,l,p,_,b,T,R,B,G,X){const $=10*e;return this.uint16[$+0]=n,this.uint16[$+1]=l,this.uint16[$+2]=p,this.uint16[$+3]=_,this.uint16[$+4]=b,this.uint16[$+5]=T,this.uint16[$+6]=R,this.uint16[$+7]=B,this.uint16[$+8]=G,this.uint16[$+9]=X,e}}Qo.prototype.bytesPerElement=20,On("StructArrayLayout10ui20",Qo);class Mu extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R){const B=this.length;return this.resize(B+1),this.emplace(B,e,n,l,p,_,b,T,R)}emplace(e,n,l,p,_,b,T,R,B){const G=8*e;return this.uint16[G+0]=n,this.uint16[G+1]=l,this.uint16[G+2]=p,this.uint16[G+3]=_,this.uint16[G+4]=b,this.uint16[G+5]=T,this.uint16[G+6]=R,this.uint16[G+7]=B,e}}Mu.prototype.bytesPerElement=16,On("StructArrayLayout8ui16",Mu);class ku extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B,G,X,$){const K=this.length;return this.resize(K+1),this.emplace(K,e,n,l,p,_,b,T,R,B,G,X,$)}emplace(e,n,l,p,_,b,T,R,B,G,X,$,K){const ie=12*e;return this.int16[ie+0]=n,this.int16[ie+1]=l,this.int16[ie+2]=p,this.int16[ie+3]=_,this.uint16[ie+4]=b,this.uint16[ie+5]=T,this.uint16[ie+6]=R,this.uint16[ie+7]=B,this.int16[ie+8]=G,this.int16[ie+9]=X,this.int16[ie+10]=$,this.int16[ie+11]=K,e}}ku.prototype.bytesPerElement=24,On("StructArrayLayout4i4ui4i24",ku);class xh extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.float32[_+0]=n,this.float32[_+1]=l,this.float32[_+2]=p,e}}xh.prototype.bytesPerElement=12,On("StructArrayLayout3f12",xh);class _h extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}_h.prototype.bytesPerElement=4,On("StructArrayLayout1ul4",_h);class bh extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,l,p,_,b,T,R,B)}emplace(e,n,l,p,_,b,T,R,B,G){const X=10*e,$=5*e;return this.int16[X+0]=n,this.int16[X+1]=l,this.int16[X+2]=p,this.int16[X+3]=_,this.int16[X+4]=b,this.int16[X+5]=T,this.uint32[$+3]=R,this.uint16[X+8]=B,this.uint16[X+9]=G,e}}bh.prototype.bytesPerElement=20,On("StructArrayLayout6i1ul2ui20",bh);class Ec extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,T){const R=6*e;return this.int16[R+0]=n,this.int16[R+1]=l,this.int16[R+2]=p,this.int16[R+3]=_,this.int16[R+4]=b,this.int16[R+5]=T,e}}Ec.prototype.bytesPerElement=12,On("StructArrayLayout2i2i2i12",Ec);class Jl extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,p,_)}emplace(e,n,l,p,_,b){const T=4*e,R=8*e;return this.float32[T+0]=n,this.float32[T+1]=l,this.float32[T+2]=p,this.int16[R+6]=_,this.int16[R+7]=b,e}}Jl.prototype.bytesPerElement=16,On("StructArrayLayout2f1f2i16",Jl);class _a extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,T){const R=16*e,B=4*e,G=8*e;return this.uint8[R+0]=n,this.uint8[R+1]=l,this.float32[B+1]=p,this.float32[B+2]=_,this.int16[G+6]=b,this.int16[G+7]=T,e}}_a.prototype.bytesPerElement=16,On("StructArrayLayout2ub2f2i16",_a);class os extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=l,this.uint16[_+2]=p,e}}os.prototype.bytesPerElement=6,On("StructArrayLayout3ui6",os);class Tl extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B,G,X,$,K,ie,re,ae,ye){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,n,l,p,_,b,T,R,B,G,X,$,K,ie,re,ae,ye)}emplace(e,n,l,p,_,b,T,R,B,G,X,$,K,ie,re,ae,ye,Fe){const be=24*e,Se=12*e,Ge=48*e;return this.int16[be+0]=n,this.int16[be+1]=l,this.uint16[be+2]=p,this.uint16[be+3]=_,this.uint32[Se+2]=b,this.uint32[Se+3]=T,this.uint32[Se+4]=R,this.uint16[be+10]=B,this.uint16[be+11]=G,this.uint16[be+12]=X,this.float32[Se+7]=$,this.float32[Se+8]=K,this.uint8[Ge+36]=ie,this.uint8[Ge+37]=re,this.uint8[Ge+38]=ae,this.uint32[Se+10]=ye,this.int16[be+22]=Fe,e}}Tl.prototype.bytesPerElement=48,On("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Tl);class Qc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B,G,X,$,K,ie,re,ae,ye,Fe,be,Se,Ge,Ke,kt,en,Xt,cn,Tn,dn){const Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,e,n,l,p,_,b,T,R,B,G,X,$,K,ie,re,ae,ye,Fe,be,Se,Ge,Ke,kt,en,Xt,cn,Tn,dn)}emplace(e,n,l,p,_,b,T,R,B,G,X,$,K,ie,re,ae,ye,Fe,be,Se,Ge,Ke,kt,en,Xt,cn,Tn,dn,Qt){const Ut=32*e,Vn=16*e;return this.int16[Ut+0]=n,this.int16[Ut+1]=l,this.int16[Ut+2]=p,this.int16[Ut+3]=_,this.int16[Ut+4]=b,this.int16[Ut+5]=T,this.int16[Ut+6]=R,this.int16[Ut+7]=B,this.uint16[Ut+8]=G,this.uint16[Ut+9]=X,this.uint16[Ut+10]=$,this.uint16[Ut+11]=K,this.uint16[Ut+12]=ie,this.uint16[Ut+13]=re,this.uint16[Ut+14]=ae,this.uint16[Ut+15]=ye,this.uint16[Ut+16]=Fe,this.uint16[Ut+17]=be,this.uint16[Ut+18]=Se,this.uint16[Ut+19]=Ge,this.uint16[Ut+20]=Ke,this.uint16[Ut+21]=kt,this.uint16[Ut+22]=en,this.uint32[Vn+12]=Xt,this.float32[Vn+13]=cn,this.float32[Vn+14]=Tn,this.uint16[Ut+30]=dn,this.uint16[Ut+31]=Qt,e}}Qc.prototype.bytesPerElement=64,On("StructArrayLayout8i15ui1ul2f2ui64",Qc);class Kc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Kc.prototype.bytesPerElement=4,On("StructArrayLayout1f4",Kc);class Nu extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.uint16[6*e+0]=n,this.float32[_+1]=l,this.float32[_+2]=p,e}}Nu.prototype.bytesPerElement=12,On("StructArrayLayout1ui2f12",Nu);class Ko extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=4*e;return this.uint32[2*e+0]=n,this.uint16[_+2]=l,this.uint16[_+3]=p,e}}Ko.prototype.bytesPerElement=8,On("StructArrayLayout1ul2ui8",Ko);class A extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.uint16[p+0]=n,this.uint16[p+1]=l,e}}A.prototype.bytesPerElement=4,On("StructArrayLayout2ui4",A);class t extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,On("StructArrayLayout1ui2",t);class s extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,p)}emplace(e,n,l,p,_){const b=4*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=p,this.float32[b+3]=_,e}}s.prototype.bytesPerElement=16,On("StructArrayLayout4f16",s);class f extends Er{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new U(this.anchorPointX,this.anchorPointY)}}f.prototype.size=20;class x extends bh{get(e){return new f(this,e)}}On("CollisionBoxArray",x);class S extends Er{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}S.prototype.size=48;class k extends Tl{get(e){return new S(this,e)}}On("PlacedSymbolArray",k);class z extends Er{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}z.prototype.size=64;class j extends Qc{get(e){return new z(this,e)}}On("SymbolInstanceArray",j);class Z extends Kc{getoffsetX(e){return this.float32[1*e+0]}}On("GlyphOffsetArray",Z);class W extends Yc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}On("SymbolLineVertexArray",W);class ee extends Er{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ee.prototype.size=12;class J extends Nu{get(e){return new ee(this,e)}}On("TextAnchorOffsetArray",J);class se extends Er{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}se.prototype.size=8;class fe extends Ko{get(e){return new se(this,e)}}On("FeatureIndexArray",fe);class Ce extends $o{}class Me extends $o{}class Ie extends $o{}class Be extends Kl{}class Qe extends ef{}class Le extends Jr{}class $e extends Qo{}class st extends Mu{}class Ve extends ku{}class dt extends xh{}class Lt extends _h{}class Mt extends Ec{}class Pt extends _a{}class Ot extends os{}class bn extends A{}const vn=as([{name:"a_pos",components:2,type:"Int16"}],4),{members:on}=vn;class Cn{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,l,p){const _=this.segments[this.segments.length-1];return e>Cn.MAX_VERTEX_ARRAY_LENGTH&&ui(`Max vertices per segment is ${Cn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Cn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+e>Cn.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p?this.createNewSegment(n,l,p):_}createNewSegment(e,n,l){const p={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(p.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(e,n,l){return this.prepareSegment(0,e,n,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,p){return new Cn([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function Ni(i,e){return 256*(i=Bt(Math.floor(i),0,255))+Bt(Math.floor(e),0,255)}Cn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,On("SegmentVector",Cn);const Sr=as([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),qr=as([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var jr,es,Rr,gs={exports:{}},ts={exports:{}},ra={exports:{}},_s=(function(){if(Rr)return gs.exports;Rr=1;var i=(jr||(jr=1,ts.exports=function(n,l){var p,_,b,T,R,B,G,X;for(_=n.length-(p=3&n.length),b=l,R=3432918353,B=461845907,X=0;X<_;)G=255&n.charCodeAt(X)|(255&n.charCodeAt(++X))<<8|(255&n.charCodeAt(++X))<<16|(255&n.charCodeAt(++X))<<24,++X,b=27492+(65535&(T=5*(65535&(b=(b^=G=(65535&(G=(G=(65535&G)*R+(((G>>>16)*R&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(G=0,p){case 3:G^=(255&n.charCodeAt(X+2))<<16;case 2:G^=(255&n.charCodeAt(X+1))<<8;case 1:b^=G=(65535&(G=(G=(65535&(G^=255&n.charCodeAt(X)))*R+(((G>>>16)*R&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295}return b^=n.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),ts.exports),e=(es||(es=1,ra.exports=function(n,l){for(var p,_=n.length,b=l^_,T=0;_>=4;)p=1540483477*(65535&(p=255&n.charCodeAt(T)|(255&n.charCodeAt(++T))<<8|(255&n.charCodeAt(++T))<<16|(255&n.charCodeAt(++T))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++T;switch(_){case 3:b^=(255&n.charCodeAt(T+2))<<16;case 2:b^=(255&n.charCodeAt(T+1))<<8;case 1:b=1540483477*(65535&(b^=255&n.charCodeAt(T)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),ra.exports);return gs.exports=i,gs.exports.murmur3=i,gs.exports.murmur2=e,gs.exports})(),bs=H(_s);class sa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,l,p){this.ids.push(Il(e)),this.positions.push(n,l,p)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Il(e);let l=0,p=this.ids.length-1;for(;l<p;){const b=l+p>>1;this.ids[b]>=n?p=b:l=b+1}const _=[];for(;this.ids[l]===n;)_.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return _}static serialize(e,n){const l=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Ml(l,p,0,l.length-1),n&&n.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(e){const n=new sa;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Il(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:bs(String(i))}function Ml(i,e,n,l){for(;n<l;){const p=i[n+l>>1];let _=n-1,b=l+1;for(;;){do _++;while(i[_]<p);do b--;while(i[b]>p);if(_>=b)break;Jo(i,_,b),Jo(e,3*_,3*b),Jo(e,3*_+1,3*b+1),Jo(e,3*_+2,3*b+2)}b-n<l-b?(Ml(i,e,n,b),n=b+1):(Ml(i,e,b+1,l),l=b)}}function Jo(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}On("FeaturePositionMap",sa);class Xa{constructor(e,n){this.gl=e.gl,this.location=n}}class Jc extends Xa{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Du extends Xa{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class el extends Xa{constructor(e,n){super(e,n),this.current=Si.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Wa=new Float32Array(16);function go(i){return[Ni(255*i.r,255*i.g),Ni(255*i.b,255*i.a)]}class Ro{constructor(e,n,l){this.value=e,this.uniformNames=n.map((p=>`u_${p}`)),this.type=l}setUniform(e,n,l){e.set(l.constantOr(this.value))}getBinding(e,n,l){return this.type==="color"?new el(e,n):new Jc(e,n)}}class Po{constructor(e,n){this.uniformNames=n.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,l,p){let _=null;p==="u_pattern_to"?_=this.patternTo:p==="u_pattern_from"?_=this.patternFrom:p==="u_dasharray_to"?_=this.dashTo:p==="u_dasharray_from"?_=this.dashFrom:p==="u_pixel_ratio_to"?_=this.pixelRatioTo:p==="u_pixel_ratio_from"&&(_=this.pixelRatioFrom),_!==null&&e.set(_)}getBinding(e,n,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new Du(e,n):new Jc(e,n)}}class Mr{constructor(e,n,l,p){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map((_=>({name:`a_${_}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,n,l){const p=this.paintVertexArray.length,_=this.expression.evaluate(new Ir(0,l),n,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(p,e,_)}updatePaintArray(e,n,l,p,_){const b=this.expression.evaluate(new Ir(0,_),l,p);this._setPaintValue(e,n,b)}_setPaintValue(e,n,l){if(this.type==="color"){const p=go(l);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ur{constructor(e,n,l,p,_,b){this.expression=e,this.uniformNames=n.map((T=>`u_${T}_t`)),this.type=l,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map((T=>({name:`a_${T}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(e,n,l){const p=this.expression.evaluate(new Ir(this.zoom,l),n,{},l.canonical,[],l.formattedSection),_=this.expression.evaluate(new Ir(this.zoom+1,l),n,{},l.canonical,[],l.formattedSection),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,p,_)}updatePaintArray(e,n,l,p,_){const b=this.expression.evaluate(new Ir(this.zoom,_),l,p),T=this.expression.evaluate(new Ir(this.zoom+1,_),l,p);this._setPaintValue(e,n,b,T)}_setPaintValue(e,n,l,p){if(this.type==="color"){const _=go(l),b=go(p);for(let T=e;T<n;T++)this.paintVertexArray.emplace(T,_[0],_[1],b[0],b[1])}else{for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,p=Bt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,n,l){return new Jc(e,n)}}class Os{constructor(e,n,l,p,_,b){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,n,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,this.getPositionIds(n),l)}updatePaintArray(e,n,l,p,_){this._setPaintValues(e,n,this.getPositionIds(l),_)}_setPaintValues(e,n,l,p){const _=this.getPositions(p);if(!_||!l)return;const b=_[l.min],T=_[l.mid],R=_[l.max];if(b&&T&&R)for(let B=e;B<n;B++)this.emplace(this.zoomInPaintVertexArray,B,T,b),this.emplace(this.zoomOutPaintVertexArray,B,T,R)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Hs extends Os{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Sr.members}emplace(e,n,l,p){e.emplace(n,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],l.pixelRatio,p.pixelRatio)}}class ld extends Os{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return qr.members}emplace(e,n,l,p){e.emplace(n,0,l.y,l.height,l.width,0,p.y,p.height,p.width)}}class cd{constructor(e,n,l){this.binders={},this._buffers=[];const p=[];for(const _ in e.paint._values){if(!l(_))continue;const b=e.paint.get(_);if(!(b instanceof po&&To(b.property.specification)))continue;const T=hp(_,e.type),R=b.value,B=b.property.specification.type,G=b.property.useIntegerZoom,X=b.property.specification["property-type"],$=X==="cross-faded"||X==="cross-faded-data-driven";if(R.kind==="constant")this.binders[_]=$?new Po(R.value,T):new Ro(R.value,T,B),p.push(`/u_${_}`);else if(R.kind==="source"||$){const K=Cc(_,B,"source");this.binders[_]=$?_==="line-dasharray"?new ld(R,B,G,n,K,e.id):new Hs(R,B,G,n,K,e.id):new Mr(R,T,B,K),p.push(`/a_${_}`)}else{const K=Cc(_,B,"composite");this.binders[_]=new Ur(R,T,B,G,n,K),p.push(`/z_${_}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Mr||n instanceof Ur?n.maxValue:0}populatePaintArrays(e,n,l){for(const p in this.binders){const _=this.binders[p];(_ instanceof Mr||_ instanceof Ur||_ instanceof Os)&&_.populatePaintArray(e,n,l)}}setConstantPatternPositions(e,n){for(const l in this.binders){const p=this.binders[l];p instanceof Po&&p.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const l in this.binders){const p=this.binders[l];p instanceof Po&&p.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,l,p,_){let b=!1;for(const T in e){const R=n.getPositions(T);for(const B of R){const G=l.feature(B.index);for(const X in this.binders){const $=this.binders[X];if(($ instanceof Mr||$ instanceof Ur||$ instanceof Os)&&$.expression.isStateDependent===!0){const K=p.paint.get(X);$.expression=K.value,$.updatePaintArray(B.start,B.end,G,e[T],_),b=!0}}}}return b}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof Ro||l instanceof Po)&&e.push(...l.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Mr||l instanceof Ur)for(let p=0;p<l.paintVertexAttributes.length;p++)e.push(l.paintVertexAttributes[p].name);else if(l instanceof Os){const p=l.getVertexAttributes();for(const _ of p)e.push(_.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Ro||l instanceof Po||l instanceof Ur)for(const p of l.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const l=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof Ro||_ instanceof Po||_ instanceof Ur){for(const b of _.uniformNames)if(n[b]){const T=_.getBinding(e,n[b],b);l.push({name:b,property:p,binding:T})}}}return l}setUniforms(e,n,l,p){for(const{name:_,property:b,binding:T}of n)this.binders[b].setUniform(T,p,l.get(b),_)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(e&&l instanceof Os){const p=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof Mr||l instanceof Ur)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof Mr||l instanceof Ur||l instanceof Os)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Mr||n instanceof Ur||n instanceof Os)&&n.destroy()}}}class Sc{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new cd(p,n,l);this.needsUpload=!1,this._featureMap=new sa,this._bufferOffset=0}populatePaintArrays(e,n,l,p){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,n,p);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,p){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,n,_,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function hp(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Cc(i,e,n){const l={color:{source:Jr,composite:s},number:{source:Kc,composite:Jr}},p=(function(_){return{"line-pattern":{source:$e,composite:$e},"fill-pattern":{source:$e,composite:$e},"fill-extrusion-pattern":{source:$e,composite:$e},"line-dasharray":{source:st,composite:st}}[_]})(i);return p&&p[n]||l[e][n]}On("ConstantBinder",Ro),On("CrossFadedConstantBinder",Po),On("SourceExpressionBinder",Mr),On("CrossFadedPatternBinder",Hs),On("CrossFadedDasharrayBinder",ld),On("CompositeExpressionBinder",Ur),On("ProgramConfiguration",cd,{omit:["_buffers"]}),On("ProgramConfigurationSet",Sc);const ud=Math.pow(2,14)-1,ec=-ud-1;function tc(i){const e=zt/i.extent,n=i.loadGeometry();for(let l=0;l<n.length;l++){const p=n[l];for(let _=0;_<p.length;_++){const b=p[_],T=Math.round(b.x*e),R=Math.round(b.y*e);b.x=Bt(T,ec,ud),b.y=Bt(R,ec,ud),(T<b.x||T>b.x+1||R<b.y||R>b.y+1)&&ui("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function tl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?tc(i):[]}}const hd=-32768;function vh(i,e,n,l,p){i.emplaceBack(hd+8*e+l,hd+8*n+p)}class wh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Me,this.indexArray=new Ot,this.segments=new Cn,this.programConfigurations=new Sc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){const p=this.layers[0],_=[];let b=null,T=!1,R=p.type==="heatmap";if(p.type==="circle"){const G=p;b=G.layout.get("circle-sort-key"),T=!b.isConstant(),R=R||G.paint.get("circle-pitch-alignment")==="map"}const B=R?n.subdivisionGranularity.circle:1;for(const{feature:G,id:X,index:$,sourceLayerIndex:K}of e){const ie=this.layers[0]._featureFilter.needGeometry,re=tl(G,ie);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),re,l))continue;const ae=T?b.evaluate(re,{},l):void 0,ye={id:X,properties:G.properties,type:G.type,sourceLayerIndex:K,index:$,geometry:ie?re.geometry:tc(G),patterns:{},sortKey:ae};_.push(ye)}T&&_.sort(((G,X)=>G.sortKey-X.sortKey));for(const G of _){const{geometry:X,index:$,sourceLayerIndex:K}=G,ie=e[$].feature;this.addFeature(G,X,$,l,B),n.featureIndex.insert(ie,X,$,K,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,on),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,p,_=1){let b;switch(_){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const T=b.length;for(const R of n)for(const B of R){const G=B.x,X=B.y;if(G<0||G>=zt||X<0||X>=zt)continue;const $=this.segments.prepareSegment(T*T,this.layoutVertexArray,this.indexArray,e.sortKey),K=$.vertexLength;for(let ie=0;ie<T;ie++)for(let re=0;re<T;re++)vh(this.layoutVertexArray,G,X,b[re],b[ie]);for(let ie=0;ie<T-1;ie++)for(let re=0;re<T-1;re++){const ae=K+ie*T+re,ye=K+(ie+1)*T+re;this.indexArray.emplaceBack(ae,ye+1,ae+1),this.indexArray.emplaceBack(ae,ye,ye+1)}$.vertexLength+=T*T,$.primitiveLength+=(T-1)*(T-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:p})}}function Ah(i,e){for(let n=0;n<i.length;n++)if(Tc(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Tc(i,e[n]))return!0;return!!ba(i,e)}function dp(i,e,n){return!!Tc(i,e)||!!pp(e,i,n)}function fp(i,e){if(i.length===1)return C0(e,i[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let p=0;p<l.length;p++)if(Tc(i,l[p]))return!0}for(let n=0;n<i.length;n++)if(C0(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(ba(i,e[n]))return!0;return!1}function aa(i,e,n){if(i.length>1){if(ba(i,e))return!0;for(let l=0;l<e.length;l++)if(pp(e[l],i,n))return!0}for(let l=0;l<i.length;l++)if(pp(i[l],e,n))return!0;return!1}function ba(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const l=i[n],p=i[n+1];for(let _=0;_<e.length-1;_++)if(Vg(l,p,e[_],e[_+1]))return!0}return!1}function Vg(i,e,n,l){return _i(i,n,l)!==_i(e,n,l)&&_i(i,e,n)!==_i(i,e,l)}function pp(i,e,n){const l=n*n;if(e.length===1)return i.distSqr(e[0])<l;for(let p=1;p<e.length;p++)if(S0(i,e[p-1],e[p])<l)return!0;return!1}function S0(i,e,n){const l=e.distSqr(n);if(l===0)return i.distSqr(e);const p=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/l;return i.distSqr(p<0?e:p>1?n:n.sub(e)._mult(p)._add(e))}function C0(i,e){let n,l,p,_=!1;for(let b=0;b<i.length;b++){n=i[b];for(let T=0,R=n.length-1;T<n.length;R=T++)l=n[T],p=n[R],l.y>e.y!=p.y>e.y&&e.x<(p.x-l.x)*(e.y-l.y)/(p.y-l.y)+l.x&&(_=!_)}return _}function Tc(i,e){let n=!1;for(let l=0,p=i.length-1;l<i.length;p=l++){const _=i[l],b=i[p];_.y>e.y!=b.y>e.y&&e.x<(b.x-_.x)*(e.y-_.y)/(b.y-_.y)+_.x&&(n=!n)}return n}function Gg(i,e,n){const l=n[0],p=n[2];if(i.x<l.x&&e.x<l.x||i.x>p.x&&e.x>p.x||i.y<l.y&&e.y<l.y||i.y>p.y&&e.y>p.y)return!1;const _=_i(i,e,n[0]);return _!==_i(i,e,n[1])||_!==_i(i,e,n[2])||_!==_i(i,e,n[3])}function eu(i,e,n){const l=e.paint.get(i).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(i)}function tf(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function gp(i,e,n,l,p){if(!e[0]&&!e[1])return i;const _=U.convert(e)._mult(p);n==="viewport"&&_._rotate(-l);const b=[];for(let T=0;T<i.length;T++)b.push(i[T].sub(_));return b}function mp(i){const e=[];for(let n=0;n<i.length;n++){const l=i[n],p=e.at(-1);(n===0||p&&!l.equals(p))&&e.push(l)}return e}function T0({queryGeometry:i,size:e},n){return dp(i,n,e)}function Hg({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){return dp(i,_,e*(n.projectTileCoordinates(_.x,_.y,l,p).signedDistanceFromCamera/n.cameraToCenterDistance))}function qg({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){const b=n.projectTileCoordinates(_.x,_.y,l,p).signedDistanceFromCamera,T=e*(n.cameraToCenterDistance/b);return dp(i,nf(_,n,l,p),T)}function Zg({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){return dp(i,nf(_,n,l,p),e)}function yp({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p,pitchAlignment:_="map",pitchScale:b="map"},T){const R=_==="map"?b==="map"?T0:Hg:b==="map"?qg:Zg,B={queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p};for(const G of T)for(const X of G)if(R(B,X))return!0;return!1}function nf(i,e,n,l){const p=e.projectTileCoordinates(i.x,i.y,n,l).point;return new U((.5*p.x+.5)*e.width,(.5*-p.y+.5)*e.height)}let xp,I0;On("CircleBucket",wh,{omit:["layers"]});var M0={get paint(){return I0=I0||new Is({"circle-radius":new ri(ut.paint_circle["circle-radius"]),"circle-color":new ri(ut.paint_circle["circle-color"]),"circle-blur":new ri(ut.paint_circle["circle-blur"]),"circle-opacity":new ri(ut.paint_circle["circle-opacity"]),"circle-translate":new Bn(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new Bn(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bn(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bn(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ri(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ri(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ri(ut.paint_circle["circle-stroke-opacity"])})},get layout(){return xp=xp||new Is({"circle-sort-key":new ri(ut.layout_circle["circle-sort-key"])})}};class _p extends ps{constructor(e,n){super(e,M0,n)}createBucket(e){return new wh(e)}queryRadius(e){const n=e;return eu("circle-radius",this,n)+eu("circle-stroke-width",this,n)+tf(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,unwrappedTileID:T,getElevation:R}){const B=gp(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,b),G=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),X=this.paint.get("circle-pitch-scale"),$=this.paint.get("circle-pitch-alignment");let K,ie;return $==="map"?(K=B,ie=G*b):(K=(function(re,ae,ye,Fe){return re.map((be=>nf(be,ae,ye,Fe)))})(B,_,T,R),ie=G),yp({queryGeometry:K,size:ie,transform:_,unwrappedTileID:T,getElevation:R,pitchAlignment:$,pitchScale:X},p)}}class bp extends wh{}let k0;On("HeatmapBucket",bp,{omit:["layers"]});var N0={get paint(){return k0=k0||new Is({"heatmap-radius":new ri(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ri(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bn(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mh(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bn(ut.paint_heatmap["heatmap-opacity"])})}};function vp(i,{width:e,height:n},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*n*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*n*l}`)}else p=new Uint8Array(e*n*l);return i.width=e,i.height=n,i.data=p,i}function Ic(i,{width:e,height:n},l){if(e===i.width&&n===i.height)return;const p=vp({},{width:e,height:n},l);rf(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},l),i.width=e,i.height=n,i.data=p.data}function rf(i,e,n,l,p,_){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||n.x>i.width-p.width||n.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||l.x>e.width-p.width||l.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=i.data,T=e.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<p.height;R++){const B=((n.y+R)*i.width+n.x)*_,G=((l.y+R)*e.width+l.x)*_;for(let X=0;X<p.width*_;X++)T[G+X]=b[B+X]}return e}class sf{constructor(e,n){vp(this,e,1,n)}resize(e){Ic(this,e,1)}clone(){return new sf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,p,_){rf(e,n,l,p,_,1)}}class Ya{constructor(e,n){vp(this,e,4,n)}resize(e){Ic(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,p,_){rf(e,n,l,p,_,4)}setPixel(e,n,l){const p=4*(e*this.width+n);this.data[p+0]=Math.round(255*l.r/l.a),this.data[p+1]=Math.round(255*l.g/l.a),this.data[p+2]=Math.round(255*l.b/l.a),this.data[p+3]=Math.round(255*l.a)}}function Mc(i){const e={},n=i.resolution||256,l=i.clips?i.clips.length:1,p=i.image||new Ya({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const _=(b,T,R)=>{e[i.evaluationKey]=R;const B=i.expression.evaluate(e);p.setPixel(b/4/n,T/4,B)};if(i.clips)for(let b=0,T=0;b<l;++b,T+=4*n)for(let R=0,B=0;R<n;R++,B+=4){const G=R/(n-1),{start:X,end:$}=i.clips[b];_(T,B,X*(1-G)+$*G)}else for(let b=0,T=0;b<n;b++,T+=4)_(0,T,b/(n-1));return p}On("AlphaImage",sf),On("RGBAImage",Ya);const af="big-fb";class Xg extends ps{createBucket(e){return new bp(e)}constructor(e,n){super(e,N0,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(af)&&this.heatmapFbos.delete(af)}queryRadius(e){return eu("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,unwrappedTileID:T,getElevation:R}){return yp({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,l)*b,transform:_,unwrappedTileID:T,getElevation:R},p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let of;var lf={get paint(){return of=of||new Is({"hillshade-illumination-direction":new Bn(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Bn(ut.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Bn(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bn(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bn(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bn(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bn(ut.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Bn(ut.paint_hillshade["hillshade-method"])})}};class vs extends ps{constructor(e,n){super(e,lf,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values;const _=Math.max(e.length,n.length,l.length,p.length);e=e.concat(Array(_-e.length).fill(e.at(-1))),n=n.concat(Array(_-n.length).fill(n.at(-1))),l=l.concat(Array(_-l.length).fill(l.at(-1))),p=p.concat(Array(_-p.length).fill(p.at(-1)));const b=n.map(Pi);return{directionRadians:e.map(Pi),altitudeRadians:b,shadowColor:p,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Wg;var P1={get paint(){return Wg=Wg||new Is({"color-relief-opacity":new Bn(ut["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new mh(ut["paint_color-relief"]["color-relief-color"])})}};class wp{constructor(e,n,l,p){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,p)}update(e,n,l){const{width:p,height:_}=e,b=!(this.size&&this.size[0]===p&&this.size[1]===_||l),{context:T}=this,{gl:R}=T;if(this.useMipmap=!!(n&&n.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!n||n.premultiply!==!1)),b)this.size=[p,_],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Gn(e)?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,e):R.texImage2D(R.TEXTURE_2D,0,this.format,p,_,0,this.format,R.UNSIGNED_BYTE,e.data);else{const{x:B,y:G}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Gn(e)?R.texSubImage2D(R.TEXTURE_2D,0,B,G,R.RGBA,R.UNSIGNED_BYTE,e):R.texSubImage2D(R.TEXTURE_2D,0,B,G,p,_,R.RGBA,R.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D),T.pixelStoreUnpackFlipY.setDefault(),T.pixelStoreUnpack.setDefault(),T.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,l){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),l!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=_.LINEAR),e!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,e),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l||e),this.filter=e),n!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class dd{constructor(e,n,l,p=1,_=1,b=1,T=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void ui(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const R=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=_,this.blueFactor=b,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let B=0;B<R;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(R,B)]=this.data[this._idx(R-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,R)]=this.data[this._idx(B,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let B=0;B<R;B++)for(let G=0;G<R;G++){const X=this.get(B,G);X>this.max&&(this.max=X),X<this.min&&(this.min=X)}}get(e,n){const l=new Uint8Array(this.data.buffer),p=4*this._idx(e,n);return this.unpack(l[p],l[p+1],l[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(e+1)}unpack(e,n,l){return e*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return tu(e,this.getUnpackVector())}getPixels(){return new Ya({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=n*this.dim,_=n*this.dim+this.dim,b=l*this.dim,T=l*this.dim+this.dim;switch(n){case-1:p=_-1;break;case 1:_=p+1}switch(l){case-1:b=T-1;break;case 1:T=b+1}const R=-n*this.dim,B=-l*this.dim;for(let G=b;G<T;G++)for(let X=p;X<_;X++)this.data[this._idx(X,G)]=e.data[this._idx(X+R,G+B)]}}function tu(i,e){const n=e[0],l=e[1],p=e[2],_=e[3],b=Math.min(n,l,p),T=Math.round((i+_)/b);return{r:Math.floor(T*b/n)%256,g:Math.floor(T*b/l)%256,b:Math.floor(T*b/p)%256}}On("DEMData",dd);class Yg extends ps{constructor(e,n){super(e,P1,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof Fa&&l._styleExpression.expression instanceof Rs){this.colorRampExpression=l;const b=l._styleExpression.expression;n.elevationStops=b.labels,n.colorStops=[];for(const T of n.elevationStops)n.colorStops.push(b.evaluate({globals:{elevation:T}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[Si.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const p={elevationStops:[],colorStops:[]},_=(n.elevationStops.length-1)/(e-1);for(let b=0;b<n.elevationStops.length-.5;b+=_)p.elevationStops.push(n.elevationStops[Math.round(b)]),p.colorStops.push(n.colorStops[Math.round(b)]);return ui(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const p=this._createColorRamp(n),_=new Ya({width:p.colorStops.length,height:1}),b=new Ya({width:p.colorStops.length,height:1});for(let T=0;T<p.elevationStops.length;T++){const R=tu(p.elevationStops[T],l);b.setPixel(0,T,new Si(R.r/255,R.g/255,R.b/255,1)),_.setPixel(0,T,p.colorStops[T])}return this.colorRampTextures={elevationTexture:new wp(e,b,e.gl.RGBA),colorTexture:new wp(e,_,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const $g=as([{name:"a_pos",components:2,type:"Int16"}],4),{members:cf}=$g;function nl(i,e,n){const l=n.patternDependencies;let p=!1;for(const _ of e){const b=_.paint.get(`${i}-pattern`);b.isConstant()||(p=!0);const T=b.constantOr(null);T&&(p=!0,l[T.to]=!0,l[T.from]=!0)}return p}function Ap(i,e,n,l,p){const{zoom:_}=l,b=p.patternDependencies;for(const T of e){const R=T.paint.get(`${i}-pattern`).value;if(R.kind!=="constant"){let B=R.evaluate({zoom:_-1},n,{},p.availableImages),G=R.evaluate({zoom:_},n,{},p.availableImages),X=R.evaluate({zoom:_+1},n,{},p.availableImages);B=B&&B.name?B.name:B,G=G&&G.name?G.name:G,X=X&&X.name?X.name:X,b[B]=!0,b[G]=!0,b[X]=!0,n.patterns[T.id]={min:B,mid:G,max:X}}}return n}function Ep(i,e,n,l,p){let _;if(p===(function(b,T,R,B){let G=0;for(let X=T,$=R-B;X<R;X+=B)G+=(b[$]-b[X])*(b[X+1]+b[$+1]),$=X;return G})(i,e,n,l)>0)for(let b=e;b<n;b+=l)_=mo(b/l|0,i[b],i[b+1],_);else for(let b=n-l;b>=e;b-=l)_=mo(b/l|0,i[b],i[b+1],_);return _&&Oo(_,_.next)&&(yo(_),_=_.next),_}function Ru(i,e){if(!i)return i;e||(e=i);let n,l=i;do if(n=!1,l.steiner||!Oo(l,l.next)&&mr(l.prev,l,l.next)!==0)l=l.next;else{if(yo(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function Eh(i,e,n,l,p,_,b){if(!i)return;!b&&_&&(function(R,B,G,X){let $=R;do $.z===0&&($.z=la($.x,$.y,B,G,X)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==R);$.prevZ.nextZ=null,$.prevZ=null,(function(K){let ie,re=1;do{let ae,ye=K;K=null;let Fe=null;for(ie=0;ye;){ie++;let be=ye,Se=0;for(let Ke=0;Ke<re&&(Se++,be=be.nextZ,be);Ke++);let Ge=re;for(;Se>0||Ge>0&&be;)Se!==0&&(Ge===0||!be||ye.z<=be.z)?(ae=ye,ye=ye.nextZ,Se--):(ae=be,be=be.nextZ,Ge--),Fe?Fe.nextZ=ae:K=ae,ae.prevZ=Fe,Fe=ae;ye=be}Fe.nextZ=null,re*=2}while(ie>1)})($)})(i,l,p,_);let T=i;for(;i.prev!==i.next;){const R=i.prev,B=i.next;if(_?Sp(i,l,p,_):D0(i))e.push(R.i,i.i,B.i),yo(i),i=B.next,T=B.next;else if((i=B)===T){b?b===1?Eh(i=Qg(Ru(i),e),e,n,l,p,_,2):b===2&&nu(i,e,n,l,p,_):Eh(Ru(i),e,n,l,p,_,1);break}}}function D0(i){const e=i.prev,n=i,l=i.next;if(mr(e,n,l)>=0)return!1;const p=e.x,_=n.x,b=l.x,T=e.y,R=n.y,B=l.y,G=Math.min(p,_,b),X=Math.min(T,R,B),$=Math.max(p,_,b),K=Math.max(T,R,B);let ie=l.next;for(;ie!==e;){if(ie.x>=G&&ie.x<=$&&ie.y>=X&&ie.y<=K&&fd(p,T,_,R,b,B,ie.x,ie.y)&&mr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function Sp(i,e,n,l){const p=i.prev,_=i,b=i.next;if(mr(p,_,b)>=0)return!1;const T=p.x,R=_.x,B=b.x,G=p.y,X=_.y,$=b.y,K=Math.min(T,R,B),ie=Math.min(G,X,$),re=Math.max(T,R,B),ae=Math.max(G,X,$),ye=la(K,ie,e,n,l),Fe=la(re,ae,e,n,l);let be=i.prevZ,Se=i.nextZ;for(;be&&be.z>=ye&&Se&&Se.z<=Fe;){if(be.x>=K&&be.x<=re&&be.y>=ie&&be.y<=ae&&be!==p&&be!==b&&fd(T,G,R,X,B,$,be.x,be.y)&&mr(be.prev,be,be.next)>=0||(be=be.prevZ,Se.x>=K&&Se.x<=re&&Se.y>=ie&&Se.y<=ae&&Se!==p&&Se!==b&&fd(T,G,R,X,B,$,Se.x,Se.y)&&mr(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;be&&be.z>=ye;){if(be.x>=K&&be.x<=re&&be.y>=ie&&be.y<=ae&&be!==p&&be!==b&&fd(T,G,R,X,B,$,be.x,be.y)&&mr(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;Se&&Se.z<=Fe;){if(Se.x>=K&&Se.x<=re&&Se.y>=ie&&Se.y<=ae&&Se!==p&&Se!==b&&fd(T,G,R,X,B,$,Se.x,Se.y)&&mr(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function Qg(i,e){let n=i;do{const l=n.prev,p=n.next.next;!Oo(l,p)&&O0(l,n,n.next,p)&&df(l,p)&&df(p,l)&&(e.push(l.i,n.i,p.i),yo(n),yo(n.next),n=i=p),n=n.next}while(n!==i);return Ru(n)}function nu(i,e,n,l,p,_){let b=i;do{let T=b.next.next;for(;T!==b.prev;){if(b.i!==T.i&&Ms(b,T)){let R=ff(b,T);return b=Ru(b,b.next),R=Ru(R,R.next),Eh(b,e,n,l,p,_,0),void Eh(R,e,n,l,p,_,0)}T=T.next}b=b.next}while(b!==i)}function oa(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function R0(i,e){const n=(function(p,_){let b=_;const T=p.x,R=p.y;let B,G=-1/0;if(Oo(p,b))return b;do{if(Oo(p,b.next))return b.next;if(R<=b.y&&R>=b.next.y&&b.next.y!==b.y){const re=b.x+(R-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(re<=T&&re>G&&(G=re,B=b.x<b.next.x?b:b.next,re===T))return B}b=b.next}while(b!==_);if(!B)return null;const X=B,$=B.x,K=B.y;let ie=1/0;b=B;do{if(T>=b.x&&b.x>=$&&T!==b.x&&P0(R<K?T:G,R,$,K,R<K?G:T,R,b.x,b.y)){const re=Math.abs(R-b.y)/(T-b.x);df(b,p)&&(re<ie||re===ie&&(b.x>B.x||b.x===B.x&&Kg(B,b)))&&(B=b,ie=re)}b=b.next}while(b!==X);return B})(i,e);if(!n)return e;const l=ff(n,i);return Ru(l,l.next),Ru(n,n.next)}function Kg(i,e){return mr(i.prev,i,e.prev)<0&&mr(e.next,i,i.next)<0}function la(i,e,n,l,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function O1(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function P0(i,e,n,l,p,_,b,T){return(p-b)*(e-T)>=(i-b)*(_-T)&&(i-b)*(l-T)>=(n-b)*(e-T)&&(n-b)*(_-T)>=(p-b)*(l-T)}function fd(i,e,n,l,p,_,b,T){return!(i===b&&e===T)&&P0(i,e,n,l,p,_,b,T)}function Ms(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,l){let p=n;do{if(p.i!==n.i&&p.next.i!==n.i&&p.i!==l.i&&p.next.i!==l.i&&O0(p,p.next,n,l))return!0;p=p.next}while(p!==n);return!1})(i,e)&&(df(i,e)&&df(e,i)&&(function(n,l){let p=n,_=!1;const b=(n.x+l.x)/2,T=(n.y+l.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&b<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==n);return _})(i,e)&&(mr(i.prev,i,e.prev)||mr(i,e.prev,e))||Oo(i,e)&&mr(i.prev,i,i.next)>0&&mr(e.prev,e,e.next)>0)}function mr(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Oo(i,e){return i.x===e.x&&i.y===e.y}function O0(i,e,n,l){const p=hf(mr(i,e,n)),_=hf(mr(i,e,l)),b=hf(mr(n,l,i)),T=hf(mr(n,l,e));return p!==_&&b!==T||!(p!==0||!uf(i,n,e))||!(_!==0||!uf(i,l,e))||!(b!==0||!uf(n,i,l))||!(T!==0||!uf(n,e,l))}function uf(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function hf(i){return i>0?1:i<0?-1:0}function df(i,e){return mr(i.prev,i,i.next)<0?mr(i,e,i.next)>=0&&mr(i,i.prev,e)>=0:mr(i,e,i.prev)<0||mr(i,i.next,e)<0}function ff(i,e){const n=Cp(i.i,i.x,i.y),l=Cp(e.i,e.x,e.y),p=i.next,_=e.prev;return i.next=e,e.prev=i,n.next=p,p.prev=n,l.next=n,n.prev=l,_.next=l,l.prev=_,l}function mo(i,e,n,l){const p=Cp(i,e,n);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function yo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Cp(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class va{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class pf{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}pf.noSubdivision=new pf({fill:new va(0,0),line:new va(0,0),tile:new va(0,0),stencil:new va(0,0),circle:1}),On("SubdivisionGranularityExpression",va),On("SubdivisionGranularitySetting",pf);const zo=-32768,nc=32767;class iu{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=zt/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),p=0|Math.round(n),_=this._getKey(l,p);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,b),this._vertexBuffer.push(l,p),b}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(p,_){const b=[];for(let T=0;T<_.length;T+=3){const R=_[T],B=_[T+1],G=_[T+2],X=p[2*R],$=p[2*R+1];(p[2*B]-X)*(p[2*G+1]-$)-(p[2*B+1]-$)*(p[2*G]-X)>0?(b.push(R),b.push(G),b.push(B)):(b.push(R),b.push(B),b.push(G))}return b})(this._vertexBuffer,e);const n=[],l=e.length;for(let p=0;p<l;p+=3){const _=[e[p+0],e[p+1],e[p+2]],b=[this._vertexBuffer[2*e[p+0]+0],this._vertexBuffer[2*e[p+0]+1],this._vertexBuffer[2*e[p+1]+0],this._vertexBuffer[2*e[p+1]+1],this._vertexBuffer[2*e[p+2]+0],this._vertexBuffer[2*e[p+2]+1]];let T=1/0,R=1/0,B=-1/0,G=-1/0;for(let re=0;re<3;re++){const ae=b[2*re],ye=b[2*re+1];T=Math.min(T,ae),B=Math.max(B,ae),R=Math.min(R,ye),G=Math.max(G,ye)}if(T===B||R===G)continue;const X=Math.floor(T/this._granularityCellSize),$=Math.ceil(B/this._granularityCellSize),K=Math.floor(R/this._granularityCellSize),ie=Math.ceil(G/this._granularityCellSize);if(X!==$||K!==ie)for(let re=K;re<ie;re++){const ae=this._scanlineGenerateVertexRingForCellRow(re,b,_);ic(this._vertexBuffer,ae,n)}else n.push(..._)}return n}_scanlineGenerateVertexRingForCellRow(e,n,l){const p=e*this._granularityCellSize,_=p+this._granularityCellSize,b=[];for(let T=0;T<3;T++){const R=n[2*T],B=n[2*T+1],G=n[2*(T+1)%6],X=n[(2*(T+1)+1)%6],$=n[2*(T+2)%6],K=n[(2*(T+2)+1)%6],ie=G-R,re=X-B,ae=ie===0,ye=re===0,Fe=(p-B)/re,be=(_-B)/re,Se=Math.min(Fe,be),Ge=Math.max(Fe,be);if(!ye&&(Se>=1||Ge<=0)||ye&&(B<p||B>_)){X>=p&&X<=_&&b.push(l[(T+1)%3]);continue}!ye&&Se>0&&b.push(this._vertexToIndex(R+ie*Se,B+re*Se));const Ke=R+ie*Math.max(Se,0),kt=R+ie*Math.min(Ge,1);ae||this._generateIntraEdgeVertices(b,R,B,G,X,Ke,kt),!ye&&Ge<1&&b.push(this._vertexToIndex(R+ie*Ge,B+re*Ge)),(ye||X>=p&&X<=_)&&b.push(l[(T+1)%3]),!ye&&(X<=p||X>=_)&&this._generateInterEdgeVertices(b,R,B,G,X,$,K,kt,p,_)}return b}_generateIntraEdgeVertices(e,n,l,p,_,b,T){const R=p-n,B=_-l,G=B===0,X=G?Math.min(n,p):Math.min(b,T),$=G?Math.max(n,p):Math.max(b,T),K=Math.floor(X/this._granularityCellSize)+1,ie=Math.ceil($/this._granularityCellSize)-1;if(G?n<p:b<T)for(let re=K;re<=ie;re++){const ae=re*this._granularityCellSize;e.push(this._vertexToIndex(ae,l+B*(ae-n)/R))}else for(let re=ie;re>=K;re--){const ae=re*this._granularityCellSize;e.push(this._vertexToIndex(ae,l+B*(ae-n)/R))}}_generateInterEdgeVertices(e,n,l,p,_,b,T,R,B,G){const X=_-l,$=b-p,K=T-_,ie=(B-_)/K,re=(G-_)/K,ae=Math.min(ie,re),ye=Math.max(ie,re),Fe=p+$*ae;let be=Math.floor(Math.min(Fe,R)/this._granularityCellSize)+1,Se=Math.ceil(Math.max(Fe,R)/this._granularityCellSize)-1,Ge=R<Fe;const Ke=K===0;if(Ke&&(T===B||T===G))return;if(Ke||ae>=1||ye<=0){const en=l-T,Xt=b+(n-b)*Math.min((B-T)/en,(G-T)/en);be=Math.floor(Math.min(Xt,R)/this._granularityCellSize)+1,Se=Math.ceil(Math.max(Xt,R)/this._granularityCellSize)-1,Ge=R<Xt}const kt=X>0?G:B;if(Ge)for(let en=be;en<=Se;en++)e.push(this._vertexToIndex(en*this._granularityCellSize,kt));else for(let en=Se;en>=be;en--)e.push(this._vertexToIndex(en*this._granularityCellSize,kt))}_generateOutline(e){const n=[];for(const l of e){const p=ru(l,this._granularity,!0),_=this._pointArrayToIndices(p),b=[];for(let T=1;T<_.length;T++)b.push(_[T-1]),b.push(_[T]);n.push(b)}return n}_handlePoles(e){let n=!1,l=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(n||l)&&this._fillPoles(e,n,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const l=e[n+1];l===zo&&(e[n+1]=-32767),l===nc&&(e[n+1]=32766)}}_generatePoleQuad(e,n,l,p,_,b){p>_!=(b===zo)?(e.push(n),e.push(l),e.push(this._vertexToIndex(p,b)),e.push(l),e.push(this._vertexToIndex(_,b)),e.push(this._vertexToIndex(p,b))):(e.push(l),e.push(n),e.push(this._vertexToIndex(p,b)),e.push(this._vertexToIndex(_,b)),e.push(l),e.push(this._vertexToIndex(p,b)))}_fillPoles(e,n,l){const p=this._vertexBuffer,_=zt,b=e.length;for(let T=2;T<b;T+=3){const R=e[T-2],B=e[T-1],G=e[T],X=p[2*R],$=p[2*R+1],K=p[2*B],ie=p[2*B+1],re=p[2*G],ae=p[2*G+1];n&&($===0&&ie===0&&this._generatePoleQuad(e,R,B,X,K,zo),ie===0&&ae===0&&this._generatePoleQuad(e,B,G,K,re,zo),ae===0&&$===0&&this._generatePoleQuad(e,G,R,re,X,zo)),l&&($===_&&ie===_&&this._generatePoleQuad(e,R,B,X,K,nc),ie===_&&ae===_&&this._generatePoleQuad(e,B,G,K,re,nc),ae===_&&$===_&&this._generatePoleQuad(e,G,R,re,X,nc))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:p}=(function(T){const R=[],B=[];for(const G of T)if(G.length!==0){G!==T[0]&&R.push(B.length/2);for(let X=0;X<G.length;X++)B.push(G[X].x),B.push(G[X].y)}return{flattened:B,holeIndices:R}})(e);let _;this._initializeVertices(l);try{const T=(function(B,G,X=2){const $=G&&G.length,K=$?G[0]*X:B.length;let ie=Ep(B,0,K,X,!0);const re=[];if(!ie||ie.next===ie.prev)return re;let ae,ye,Fe;if($&&(ie=(function(be,Se,Ge,Ke){const kt=[];for(let en=0,Xt=Se.length;en<Xt;en++){const cn=Ep(be,Se[en]*Ke,en<Xt-1?Se[en+1]*Ke:be.length,Ke,!1);cn===cn.next&&(cn.steiner=!0),kt.push(O1(cn))}kt.sort(oa);for(let en=0;en<kt.length;en++)Ge=R0(kt[en],Ge);return Ge})(B,G,ie,X)),B.length>80*X){ae=B[0],ye=B[1];let be=ae,Se=ye;for(let Ge=X;Ge<K;Ge+=X){const Ke=B[Ge],kt=B[Ge+1];Ke<ae&&(ae=Ke),kt<ye&&(ye=kt),Ke>be&&(be=Ke),kt>Se&&(Se=kt)}Fe=Math.max(be-ae,Se-ye),Fe=Fe!==0?32767/Fe:0}return Eh(ie,re,X,ae,ye,Fe,0),re})(l,p),R=this._convertIndices(l,T);_=this._subdivideTrianglesScanline(R)}catch(T){console.error(T)}let b=[];return n&&(b=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:b}}_convertIndices(e,n){const l=[];for(let p=0;p<n.length;p++)l.push(this._vertexToIndex(e[2*n[p]],e[2*n[p]+1]));return l}_pointArrayToIndices(e){const n=[];for(let l=0;l<e.length;l++){const p=e[l];n.push(this._vertexToIndex(p.x,p.y))}return n}}function Tp(i,e,n,l=!0){return new iu(n,e).subdividePolygonInternal(i,l)}function ru(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const l=i[0],p=i[i.length-1],_=n&&(l.x!==p.x||l.y!==p.y);if(e<2)return _?[...i,i[0]]:[...i];const b=Math.floor(zt/e),T=[];T.push(new U(i[0].x,i[0].y));const R=i.length,B=_?R:R-1;for(let G=0;G<B;G++){const X=i[G],$=G<R-1?i[G+1]:i[0],K=X.x,ie=X.y,re=$.x,ae=$.y,ye=K!==re,Fe=ie!==ae;if(!ye&&!Fe)continue;const be=re-K,Se=ae-ie,Ge=Math.abs(be),Ke=Math.abs(Se);let kt=K,en=ie;for(;;){const cn=be>0?(Math.floor(kt/b)+1)*b:(Math.ceil(kt/b)-1)*b,Tn=Se>0?(Math.floor(en/b)+1)*b:(Math.ceil(en/b)-1)*b,dn=Math.abs(kt-cn),Qt=Math.abs(en-Tn),Ut=Math.abs(kt-re),Vn=Math.abs(en-ae),zn=ye?dn/Ge:Number.POSITIVE_INFINITY,Yn=Fe?Qt/Ke:Number.POSITIVE_INFINITY;if((Ut<=dn||!ye)&&(Vn<=Qt||!Fe))break;if(zn<Yn&&ye||!Fe){kt=cn,en+=Se*zn;const Pn=new U(kt,Math.round(en));T[T.length-1].x===Pn.x&&T[T.length-1].y===Pn.y||T.push(Pn)}else{kt+=be*Yn,en=Tn;const Pn=new U(Math.round(kt),en);T[T.length-1].x===Pn.x&&T[T.length-1].y===Pn.y||T.push(Pn)}}const Xt=new U(re,ae);T[T.length-1].x===Xt.x&&T[T.length-1].y===Xt.y||T.push(Xt)}return T}function ic(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,p=i[2*e[0]];for(let R=1;R<e.length;R++){const B=i[2*e[R]];B<p&&(p=B,l=R)}const _=e.length;let b=l,T=(b+1)%_;for(;;){const R=b-1>=0?b-1:_-1,B=(T+1)%_,G=i[2*e[R]],X=i[2*e[B]],$=i[2*e[b]],K=i[2*e[b]+1],ie=i[2*e[T]+1];let re=!1;if(G<X)re=!0;else if(G>X)re=!1;else{const ae=ie-K,ye=-(i[2*e[T]]-$),Fe=K<ie?1:-1;((G-$)*ae+(i[2*e[R]+1]-K)*ye)*Fe>((X-$)*ae+(i[2*e[B]+1]-K)*ye)*Fe&&(re=!0)}if(re){const ae=e[R],ye=e[b],Fe=e[T];ae!==ye&&ae!==Fe&&ye!==Fe&&n.push(Fe,ye,ae),b--,b<0&&(b=_-1)}else{const ae=e[B],ye=e[b],Fe=e[T];ae!==ye&&ae!==Fe&&ye!==Fe&&n.push(Fe,ye,ae),T++,T>=_&&(T=0)}if(R===B)break}}function z0(i,e,n,l,p,_,b,T,R){const B=p.length/2,G=b&&T&&R;if(B<Cn.MAX_VERTEX_ARRAY_LENGTH){const X=e.prepareSegment(B,n,l),$=X.vertexLength;for(let re=0;re<_.length;re+=3)l.emplaceBack($+_[re],$+_[re+1],$+_[re+2]);let K,ie;X.vertexLength+=B,X.primitiveLength+=_.length/3,G&&(ie=b.prepareSegment(B,n,T),K=ie.vertexLength,ie.vertexLength+=B);for(let re=0;re<p.length;re+=2)i(p[re],p[re+1]);if(G)for(let re=0;re<R.length;re++){const ae=R[re];for(let ye=1;ye<ae.length;ye+=2)T.emplaceBack(K+ae[ye-1],K+ae[ye]);ie.primitiveLength+=ae.length/2}}else(function(X,$,K,ie,re,ae){const ye=[];for(let Ke=0;Ke<ie.length/2;Ke++)ye.push(-1);const Fe={count:0};let be=0,Se=X.getOrCreateLatestSegment($,K),Ge=Se.vertexLength;for(let Ke=2;Ke<re.length;Ke+=3){const kt=re[Ke-2],en=re[Ke-1],Xt=re[Ke];let cn=ye[kt]<be,Tn=ye[en]<be,dn=ye[Xt]<be;Se.vertexLength+((cn?1:0)+(Tn?1:0)+(dn?1:0))>Cn.MAX_VERTEX_ARRAY_LENGTH&&(Se=X.createNewSegment($,K),be=Fe.count,cn=!0,Tn=!0,dn=!0,Ge=0);const Qt=kc(ye,ie,ae,Fe,kt,cn,Se),Ut=kc(ye,ie,ae,Fe,en,Tn,Se),Vn=kc(ye,ie,ae,Fe,Xt,dn,Se);K.emplaceBack(Ge+Qt-be,Ge+Ut-be,Ge+Vn-be),Se.primitiveLength++}})(e,n,l,p,_,i),G&&(function(X,$,K,ie,re,ae){const ye=[];for(let Ke=0;Ke<ie.length/2;Ke++)ye.push(-1);const Fe={count:0};let be=0,Se=X.getOrCreateLatestSegment($,K),Ge=Se.vertexLength;for(let Ke=0;Ke<re.length;Ke++){const kt=re[Ke];for(let en=1;en<re[Ke].length;en+=2){const Xt=kt[en-1],cn=kt[en];let Tn=ye[Xt]<be,dn=ye[cn]<be;Se.vertexLength+((Tn?1:0)+(dn?1:0))>Cn.MAX_VERTEX_ARRAY_LENGTH&&(Se=X.createNewSegment($,K),be=Fe.count,Tn=!0,dn=!0,Ge=0);const Qt=kc(ye,ie,ae,Fe,Xt,Tn,Se),Ut=kc(ye,ie,ae,Fe,cn,dn,Se);K.emplaceBack(Ge+Qt-be,Ge+Ut-be),Se.primitiveLength++}}})(b,n,T,p,R,i),e.forceNewSegmentOnNextPrepare(),b?.forceNewSegmentOnNextPrepare()}function kc(i,e,n,l,p,_,b){if(_){const T=l.count;return n(e[2*p],e[2*p+1]),i[p]=l.count,l.count++,b.vertexLength++,T}return i[p]}class Sh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Ie,this.indexArray=new Ot,this.indexArray2=new bn,this.programConfigurations=new Sc(e.layers,e.zoom),this.segments=new Cn,this.segments2=new Cn,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=nl("fill",this.layers,n);const p=this.layers[0].layout.get("fill-sort-key"),_=!p.isConstant(),b=[];for(const{feature:T,id:R,index:B,sourceLayerIndex:G}of e){const X=this.layers[0]._featureFilter.needGeometry,$=tl(T,X);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),$,l))continue;const K=_?p.evaluate($,{},l,n.availableImages):void 0,ie={id:R,properties:T.properties,type:T.type,sourceLayerIndex:G,index:B,geometry:X?$.geometry:tc(T),patterns:{},sortKey:K};b.push(ie)}_&&b.sort(((T,R)=>T.sortKey-R.sortKey));for(const T of b){const{geometry:R,index:B,sourceLayerIndex:G}=T;if(this.hasDependencies){const X=Ap("fill",this.layers,T,{zoom:this.zoom},n);this.patternFeatures.push(X)}else this.addFeature(T,R,B,l,{},n.subdivisionGranularity);n.featureIndex.insert(e[B].feature,R,B,G,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,n,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,p,_,b){for(const T of dl(n,500)){const R=Tp(T,p,b.fill.getGranularityForZoomLevel(p.z)),B=this.layoutVertexArray;z0(((G,X)=>{B.emplaceBack(G,X)}),this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles,this.segments2,this.indexArray2,R.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,canonical:p})}}let pd,Ch;On("FillBucket",Sh,{omit:["layers","patternFeatures"]});var Jg={get paint(){return Ch=Ch||new Is({"fill-antialias":new Bn(ut.paint_fill["fill-antialias"]),"fill-opacity":new ri(ut.paint_fill["fill-opacity"]),"fill-color":new ri(ut.paint_fill["fill-color"]),"fill-outline-color":new ri(ut.paint_fill["fill-outline-color"]),"fill-translate":new Bn(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new Bn(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new No(ut.paint_fill["fill-pattern"])})},get layout(){return pd=pd||new Is({"fill-sort-key":new ri(ut.layout_fill["fill-sort-key"])})}};class em extends ps{constructor(e,n){super(e,Jg,n)}recalculate(e,n){super.recalculate(e,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Sh(e)}queryRadius(){return tf(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:l,pixelsToTileUnits:p}){return fp(gp(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,p),n)}isTileClipped(){return!0}}const gf=as([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),tm=as([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ip}=gf;class gd{constructor(e,n,l,p,_){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=p,this._values=_,e.readFields(z1,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let p,_=1,b=0,T=0,R=0;for(;e.pos<n;){if(b<=0){const B=e.readVarint();_=7&B,b=B>>3}if(b--,_===1||_===2)T+=e.readSVarint(),R+=e.readSVarint(),_===1&&(p&&l.push(p),p=[]),p&&p.push(new U(T,R));else{if(_!==7)throw new Error(`unknown command ${_}`);p&&p.push(p[0].clone())}}return p&&l.push(p),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,p=0,_=0,b=0,T=1/0,R=-1/0,B=1/0,G=-1/0;for(;e.pos<n;){if(p<=0){const X=e.readVarint();l=7&X,p=X>>3}if(p--,l===1||l===2)_+=e.readSVarint(),b+=e.readSVarint(),_<T&&(T=_),_>R&&(R=_),b<B&&(B=b),b>G&&(G=b);else if(l!==7)throw new Error(`unknown command ${l}`)}return[T,B,R,G]}toGeoJSON(e,n,l){const p=this.extent*Math.pow(2,l),_=this.extent*e,b=this.extent*n,T=this.loadGeometry();function R($){return[360*($.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*($.y+b)/p)*Math.PI))-90]}function B($){return $.map(R)}let G;if(this.type===1){const $=[];for(const ie of T)$.push(ie[0]);const K=B($);G=$.length===1?{type:"Point",coordinates:K[0]}:{type:"MultiPoint",coordinates:K}}else if(this.type===2){const $=T.map(B);G=$.length===1?{type:"LineString",coordinates:$[0]}:{type:"MultiLineString",coordinates:$}}else{if(this.type!==3)throw new Error("unknown feature type");{const $=nm(T),K=[];for(const ie of $)K.push(ie.map(B));G=K.length===1?{type:"Polygon",coordinates:K[0]}:{type:"MultiPolygon",coordinates:K}}}const X={type:"Feature",geometry:G,properties:this.properties};return this.id!=null&&(X.id=this.id),X}}function z1(i,e,n){i===1?e.id=n.readVarint():i===2?(function(l,p){const _=l.readVarint()+l.pos;for(;l.pos<_;){const b=p._keys[l.readVarint()],T=p._values[l.readVarint()];p.properties[b]=T}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function nm(i){const e=i.length;if(e<=1)return[i];const n=[];let l,p;for(let _=0;_<e;_++){const b=Vr(i[_]);b!==0&&(p===void 0&&(p=b<0),p===b<0?(l&&n.push(l),l=[i[_]]):l&&l.push(i[_]))}return l&&n.push(l),n}function Vr(i){let e=0;for(let n,l,p=0,_=i.length,b=_-1;p<_;b=p++)n=i[p],l=i[b],e+=(l.x-n.x)*(n.y+l.y);return e}gd.types=["Unknown","Point","LineString","Polygon"];class ls{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ur,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new gd(this._pbf,n,this.extent,this._keys,this._values)}}function ur(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(l){let p=null;const _=l.readVarint()+l.pos;for(;l.pos<_;){const b=l.readVarint()>>3;p=b===1?l.readString():b===2?l.readFloat():b===3?l.readDouble():b===4?l.readVarint64():b===5?l.readVarint():b===6?l.readSVarint():b===7?l.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p})(n))}class hr{constructor(e,n){this.layers=e.readFields(Wr,{},n)}}function Wr(i,e,n){if(i===3){const l=new ls(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const xo=Math.pow(2,13);function kl(i,e,n,l,p,_,b,T){i.emplaceBack(e,n,2*Math.floor(l*xo)+b,p*xo*2,_*xo*2,Math.round(T))}class Pu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Be,this.centroidVertexArray=new Ce,this.indexArray=new Ot,this.programConfigurations=new Sc(e.layers,e.zoom),this.segments=new Cn,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.features=[],this.hasDependencies=nl("fill-extrusion",this.layers,n);for(const{feature:p,id:_,index:b,sourceLayerIndex:T}of e){const R=this.layers[0]._featureFilter.needGeometry,B=tl(p,R);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),B,l))continue;const G={id:_,sourceLayerIndex:T,index:b,geometry:R?B.geometry:tc(p),properties:p.properties,type:p.type,patterns:{}};this.hasDependencies?this.features.push(Ap("fill-extrusion",this.layers,G,{zoom:this.zoom},n)):this.addFeature(G,G.geometry,b,l,{},n.subdivisionGranularity),n.featureIndex.insert(p,G.geometry,b,T,this.index,!0)}}addFeatures(e,n,l){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,n,l,e.subdivisionGranularity)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ip),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,tm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,l,p,_,b){for(const T of dl(n,500)){const R={x:0,y:0,sampleCount:0},B=this.layoutVertexArray.length;this.processPolygon(R,p,e,T,b);const G=this.layoutVertexArray.length-B,X=Math.floor(R.x/R.sampleCount),$=Math.floor(R.y/R.sampleCount);for(let K=0;K<G;K++)this.centroidVertexArray.emplaceBack(X,$)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,canonical:p})}processPolygon(e,n,l,p,_){if(p.length<1||zs(p[0]))return;for(const X of p)X.length!==0&&L0(e,X);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},T=_.fill.getGranularityForZoomLevel(n.z),R=gd.types[l.type]==="Polygon";for(const X of p){if(X.length===0||zs(X))continue;const $=ru(X,T,R);this._generateSideFaces($,b)}if(!R)return;const B=Tp(p,n,T,!1),G=this.layoutVertexArray;z0(((X,$)=>{kl(G,X,$,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,B.verticesFlattened,B.indicesTriangles)}_generateSideFaces(e,n){let l=0;for(let p=1;p<e.length;p++){const _=e[p],b=e[p-1];if(su(_,b))continue;n.segment.vertexLength+4>Cn.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const T=_.sub(b)._perp()._unit(),R=b.dist(_);l+R>32768&&(l=0),kl(this.layoutVertexArray,_.x,_.y,T.x,T.y,0,0,l),kl(this.layoutVertexArray,_.x,_.y,T.x,T.y,0,1,l),l+=R,kl(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,0,l),kl(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,1,l);const B=n.segment.vertexLength;this.indexArray.emplaceBack(B,B+2,B+1),this.indexArray.emplaceBack(B+1,B+2,B+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function L0(i,e){for(let n=0;n<e.length;n++){const l=e[n];n===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(i.x+=l.x,i.y+=l.y,i.sampleCount++)}}function su(i,e){return i.x===e.x&&(i.x<0||i.x>zt)||i.y===e.y&&(i.y<0||i.y>zt)}function zs(i){return i.every((e=>e.x<0))||i.every((e=>e.x>zt))||i.every((e=>e.y<0))||i.every((e=>e.y>zt))}let au;On("FillExtrusionBucket",Pu,{omit:["layers","features"]});var Th={get paint(){return au=au||new Is({"fill-extrusion-opacity":new Bn(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ri(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bn(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bn(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new No(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ri(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ri(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bn(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class B0 extends ps{constructor(e,n){super(e,Th,n)}createBucket(e){return new Pu(e)}queryRadius(){return tf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,pixelPosMatrix:T}){const R=gp(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,b),B=this.paint.get("fill-extrusion-height").evaluate(n,l),G=this.paint.get("fill-extrusion-base").evaluate(n,l),X=(function(K,ie){const re=[];for(const ae of K){const ye=[ae.x,ae.y,0,1];Zt(ye,ye,ie),re.push(new U(ye[0]/ye[3],ye[1]/ye[3]))}return re})(R,T),$=(function(K,ie,re,ae){const ye=[],Fe=[],be=ae[8]*ie,Se=ae[9]*ie,Ge=ae[10]*ie,Ke=ae[11]*ie,kt=ae[8]*re,en=ae[9]*re,Xt=ae[10]*re,cn=ae[11]*re;for(const Tn of K){const dn=[],Qt=[];for(const Ut of Tn){const Vn=Ut.x,zn=Ut.y,Yn=ae[0]*Vn+ae[4]*zn+ae[12],Pn=ae[1]*Vn+ae[5]*zn+ae[13],pi=ae[2]*Vn+ae[6]*zn+ae[14],yr=ae[3]*Vn+ae[7]*zn+ae[15],Qi=pi+Ge,ws=yr+Ke,Ja=Yn+kt,da=Pn+en,As=pi+Xt,ms=yr+cn,zr=new U((Yn+be)/ws,(Pn+Se)/ws);zr.z=Qi/ws,dn.push(zr);const Ls=new U(Ja/ms,da/ms);Ls.z=As/ms,Qt.push(Ls)}ye.push(dn),Fe.push(Qt)}return[ye,Fe]})(p,G,B,T);return(function(K,ie,re){let ae=1/0;fp(re,ie)&&(ae=Ih(re,ie[0]));for(let ye=0;ye<ie.length;ye++){const Fe=ie[ye],be=K[ye];for(let Se=0;Se<Fe.length-1;Se++){const Ge=Fe[Se],Ke=[Ge,Fe[Se+1],be[Se+1],be[Se],Ge];Ah(re,Ke)&&(ae=Math.min(ae,Ih(re,Ke)))}}return ae!==1/0&&ae})($[0],$[1],X)}}function ja(i,e){return i.x*e.x+i.y*e.y}function Ih(i,e){if(i.length===1){let n=0;const l=e[n++];let p;for(;!p||l.equals(p);)if(p=e[n++],!p)return 1/0;for(;n<e.length;n++){const _=e[n],b=i[0],T=p.sub(l),R=_.sub(l),B=b.sub(l),G=ja(T,T),X=ja(T,R),$=ja(R,R),K=ja(B,T),ie=ja(B,R),re=G*$-X*X,ae=($*K-X*ie)/re,ye=(G*ie-X*K)/re,Fe=l.z*(1-ae-ye)+p.z*ae+_.z*ye;if(isFinite(Fe))return Fe}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}const mf=as([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Lo}=mf,F0=as([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Mp}=F0,im=Math.cos(Math.PI/180*37.5),yf=Math.pow(2,14)/.5;class md{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Qe,this.layoutVertexArray2=new Le,this.indexArray=new Ot,this.programConfigurations=new Sc(e.layers,e.zoom),this.segments=new Cn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=nl("line",this.layers,n)||this.hasLineDasharray(this.layers);const p=this.layers[0].layout.get("line-sort-key"),_=!p.isConstant(),b=[];for(const{feature:T,id:R,index:B,sourceLayerIndex:G}of e){const X=this.layers[0]._featureFilter.needGeometry,$=tl(T,X);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),$,l))continue;const K=_?p.evaluate($,{},l):void 0,ie={id:R,properties:T.properties,type:T.type,sourceLayerIndex:G,index:B,geometry:X?$.geometry:tc(T),patterns:{},dashes:{},sortKey:K};b.push(ie)}_&&b.sort(((T,R)=>T.sortKey-R.sortKey));for(const T of b){const{geometry:R,index:B,sourceLayerIndex:G}=T;this.hasDependencies?(nl("line",this.layers,n)?Ap("line",this.layers,T,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,T,this.zoom,n),this.patternFeatures.push(T)):this.addFeature(T,R,B,l,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[B].feature,R,B,G,this.index)}}update(e,n,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l,dashPositions:p})}addFeatures(e,n,l,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,l,p,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Mp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lo),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,p,_,b,T){const R=this.layers[0].layout,B=R.get("line-join").evaluate(e,{}),G=R.get("line-cap"),X=R.get("line-miter-limit"),$=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const K of n)this.addLine(K,e,B,G,X,$,p,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,dashPositions:b,canonical:p})}addLine(e,n,l,p,_,b,T,R){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=ru(e,T?R.line.getGranularityForZoomLevel(T.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<e.length-1;be++)this.totalDistance+=e[be].dist(e[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const B=gd.types[n.type]==="Polygon";let G=e.length;for(;G>=2&&e[G-1].equals(e[G-2]);)G--;let X=0;for(;X<G-1&&e[X].equals(e[X+1]);)X++;if(G<(B?3:2))return;l==="bevel"&&(_=1.05);const $=this.overscaling<=16?122880/(512*this.overscaling):0,K=this.segments.prepareSegment(10*G,this.layoutVertexArray,this.indexArray);let ie,re,ae,ye,Fe;this.e1=this.e2=-1,B&&(ie=e[G-2],Fe=e[X].sub(ie)._unit()._perp());for(let be=X;be<G;be++){if(ae=be===G-1?B?e[X+1]:void 0:e[be+1],ae&&e[be].equals(ae))continue;Fe&&(ye=Fe),ie&&(re=ie),ie=e[be],Fe=ae?ae.sub(ie)._unit()._perp():ye,ye=ye||Fe;let Se=ye.add(Fe);Se.x===0&&Se.y===0||Se._unit();const Ge=ye.x*Fe.x+ye.y*Fe.y,Ke=Se.x*Fe.x+Se.y*Fe.y,kt=Ke!==0?1/Ke:1/0,en=2*Math.sqrt(2-2*Ke),Xt=Ke<im&&re&&ae,cn=ye.x*Fe.y-ye.y*Fe.x>0;if(Xt&&be>X){const Qt=ie.dist(re);if(Qt>2*$){const Ut=ie.sub(ie.sub(re)._mult($/Qt)._round());this.updateDistance(re,Ut),this.addCurrentVertex(Ut,ye,0,0,K),re=Ut}}const Tn=re&&ae;let dn=Tn?l:B?"butt":p;if(Tn&&dn==="round"&&(kt<b?dn="miter":kt<=2&&(dn="fakeround")),dn==="miter"&&kt>_&&(dn="bevel"),dn==="bevel"&&(kt>2&&(dn="flipbevel"),kt<_&&(dn="miter")),re&&this.updateDistance(re,ie),dn==="miter")Se._mult(kt),this.addCurrentVertex(ie,Se,0,0,K);else if(dn==="flipbevel"){if(kt>100)Se=Fe.mult(-1);else{const Qt=kt*ye.add(Fe).mag()/ye.sub(Fe).mag();Se._perp()._mult(Qt*(cn?-1:1))}this.addCurrentVertex(ie,Se,0,0,K),this.addCurrentVertex(ie,Se.mult(-1),0,0,K)}else if(dn==="bevel"||dn==="fakeround"){const Qt=-Math.sqrt(kt*kt-1),Ut=cn?Qt:0,Vn=cn?0:Qt;if(re&&this.addCurrentVertex(ie,ye,Ut,Vn,K),dn==="fakeround"){const zn=Math.round(180*en/Math.PI/20);for(let Yn=1;Yn<zn;Yn++){let Pn=Yn/zn;if(Pn!==.5){const yr=Pn-.5;Pn+=Pn*yr*(Pn-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*yr*yr+(.848013+Ge*(.215638*Ge-1.06021)))}const pi=Fe.sub(ye)._mult(Pn)._add(ye)._unit()._mult(cn?-1:1);this.addHalfVertex(ie,pi.x,pi.y,!1,cn,0,K)}}ae&&this.addCurrentVertex(ie,Fe,-Ut,-Vn,K)}else if(dn==="butt")this.addCurrentVertex(ie,Se,0,0,K);else if(dn==="square"){const Qt=re?1:-1;this.addCurrentVertex(ie,Se,Qt,Qt,K)}else dn==="round"&&(re&&(this.addCurrentVertex(ie,ye,0,0,K),this.addCurrentVertex(ie,ye,1,1,K,!0)),ae&&(this.addCurrentVertex(ie,Fe,-1,-1,K,!0),this.addCurrentVertex(ie,Fe,0,0,K)));if(Xt&&be<G-1){const Qt=ie.dist(ae);if(Qt>2*$){const Ut=ie.add(ae.sub(ie)._mult($/Qt)._round());this.updateDistance(ie,Ut),this.addCurrentVertex(Ut,Fe,0,0,K),ie=Ut}}}}addCurrentVertex(e,n,l,p,_,b=!1){const T=n.y*p-n.x,R=-n.y-n.x*p;this.addHalfVertex(e,n.x+n.y*l,n.y-n.x*l,b,!1,l,_),this.addHalfVertex(e,T,R,b,!0,-p,_),this.distance>yf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,l,p,_,b))}addHalfVertex({x:e,y:n},l,p,_,b,T,R){const B=.5*(this.lineClips?this.scaledDistance*(yf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(n<<1)+(b?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1)|(63&B)<<2,B>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const G=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,G,this.e2),R.primitiveLength++),b?this.e2=G:this.e1=G}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const l=n.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,n,l,p){for(const _ of e){const b=_.paint.get("line-dasharray");if(!b||b.value.kind==="constant")continue;const T=_.layout.get("line-cap")==="round",R={dasharray:b.value.evaluate({zoom:l-1},n,{}),round:T},B={dasharray:b.value.evaluate({zoom:l},n,{}),round:T},G={dasharray:b.value.evaluate({zoom:l+1},n,{}),round:T},X=`${R.dasharray.join(",")},${R.round}`,$=`${B.dasharray.join(",")},${B.round}`,K=`${G.dasharray.join(",")},${G.round}`;p.dashDependencies[X]=R,p.dashDependencies[$]=B,p.dashDependencies[K]=G,n.dashes[_.id]={min:X,mid:$,max:K}}}}let ou,ca;On("LineBucket",md,{omit:["layers","patternFeatures"]});var lu={get paint(){return ca=ca||new Is({"line-opacity":new ri(ut.paint_line["line-opacity"]),"line-color":new ri(ut.paint_line["line-color"]),"line-translate":new Bn(ut.paint_line["line-translate"]),"line-translate-anchor":new Bn(ut.paint_line["line-translate-anchor"]),"line-width":new ri(ut.paint_line["line-width"]),"line-gap-width":new ri(ut.paint_line["line-gap-width"]),"line-offset":new ri(ut.paint_line["line-offset"]),"line-blur":new ri(ut.paint_line["line-blur"]),"line-dasharray":new No(ut.paint_line["line-dasharray"]),"line-pattern":new No(ut.paint_line["line-pattern"]),"line-gradient":new mh(ut.paint_line["line-gradient"])})},get layout(){return ou=ou||new Is({"line-cap":new Bn(ut.layout_line["line-cap"]),"line-join":new ri(ut.layout_line["line-join"]),"line-miter-limit":new Bn(ut.layout_line["line-miter-limit"]),"line-round-limit":new Bn(ut.layout_line["line-round-limit"]),"line-sort-key":new ri(ut.layout_line["line-sort-key"])})}};class yd extends ri{possiblyEvaluate(e,n){return n=new Ir(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,p){return n=an({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,p)}}let Nl;class j0 extends ps{constructor(e,n){super(e,lu,n),this.gradientVersion=0,Nl||(Nl=new yd(lu.paint.properties["line-width"].specification),Nl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof It,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Nl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new md(e)}queryRadius(e){const n=e,l=kp(eu("line-width",this,n),eu("line-gap-width",this,n)),p=eu("line-offset",this,n);return l/2+Math.abs(p)+tf(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b}){const T=gp(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,b),R=b/2*kp(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),B=this.paint.get("line-offset").evaluate(n,l);return B&&(p=(function(G,X){const $=[];for(let K=0;K<G.length;K++){const ie=mp(G[K]),re=[];for(let ae=0;ae<ie.length;ae++){const ye=ie[ae],Fe=ie[ae-1],be=ie[ae+1],Se=ae===0?new U(0,0):ye.sub(Fe)._unit()._perp(),Ge=ae===ie.length-1?new U(0,0):be.sub(ye)._unit()._perp(),Ke=Se._add(Ge)._unit(),kt=Ke.x*Ge.x+Ke.y*Ge.y;kt!==0&&Ke._mult(1/kt),re.push(Ke._mult(X)._add(ye))}$.push(re)}return $})(p,B*b)),(function(G,X,$){for(let K=0;K<X.length;K++){const ie=X[K];if(G.length>=3){for(let re=0;re<ie.length;re++)if(Tc(G,ie[re]))return!0}if(aa(G,ie,$))return!0}return!1})(T,p,R)}isTileClipped(){return!0}}function kp(i,e){return e>0?e+2*i:i}const rm=as([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xf=as([{name:"a_projected_pos",components:3,type:"Float32"}],4);as([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const U0=as([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);as([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bo=as([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sm=as([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fo(i,e,n){return i.sections.forEach((l=>{l.text=(function(p,_,b){const T=_.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),ko.applyArabicShaping&&(p=ko.applyArabicShaping(p)),p})(l.text,e,n)})),i}as([{name:"triangle",components:3,type:"Uint16"}]),as([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),as([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),as([{type:"Float32",name:"offsetX"}]),as([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),as([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var ea=24;const xd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},L1={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ou={40:!0};function _f(i,e,n,l,p,_){if("fontStack"in e){const b=n[e.fontStack],T=b&&b[i];return T?T.metrics.advance*e.scale+p:0}{const b=l[e.imageName];return b?b.displaySize[0]*e.scale*ea/_+p:0}}function Np(i,e,n,l){const p=Math.pow(i-e,2);return l?i<e?p/2:2*p:p+Math.abs(n)*n}function _d(i,e,n){let l=0;return i===10&&(l-=1e4),n&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function V0(i,e,n,l,p,_){let b=null,T=Np(e,n,p,_);for(const R of l){const B=Np(e-R.x,n,p,_)+R.badness;B<=T&&(b=R,T=B)}return{index:i,x:e,priorBreak:b,badness:T}}function G0(i){return i?G0(i.priorBreak).concat(i.index):[]}class Mh{constructor(e="",n=[],l=[]){this.text=e,this.sections=n,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,n){const l=new Mh;for(let p=0;p<e.sections.length;p++){const _=e.sections[p];_.image?l.addImageSection(_):l.addTextSection(_,n)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",l={premature:!0,value:void 0};const p=e[Symbol.iterator]();let _=p.next();const b=e[Symbol.iterator]();b.next();let T=b.next();for(;!_.done;)n+=!T.done&&Sl(T.value.codePointAt(0))&&!xd[T.value]||!l.premature&&Sl(l.value.codePointAt(0))&&!xd[l.value]||!xd[_.value]?_.value:xd[_.value],l={value:_.value,premature:!1},_=p.next(),T=b.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,l=this.text.match(/\S\s*$/),p=l?l[0].length-1:0;this.text=this.text.substring(n,this.text.length-p),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-p)}substring(e,n){const l=[...this.text].slice(e,n).join(""),p=this.sectionIndex.slice(e,n);return new Mh(l,this.sections,p)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,l=0;for(let p=0;p<this.length();p++){const _=this.getSection(p);if("imageName"in _){const b=e[_.imageName];if(!b)continue;const T=b.displaySize;n=Math.max(n,T[0]),l=Math.max(l,T[1])}}return{maxImageWidth:n,maxImageHeight:l}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>l)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void ui("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):ui("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,l,p,_){const b=[],T=this.determineAverageLineWidth(e,n,l,p,_),R=this.hasZeroWidthSpaces();let B=0,G=0;const X=this.text[Symbol.iterator]();let $=X.next();const K=this.text[Symbol.iterator]();K.next();let ie=K.next();const re=this.text[Symbol.iterator]();re.next(),re.next();let ae=re.next();for(;!$.done;){const ye=this.getSection(G),Fe=$.value.codePointAt(0);if(hh(Fe)||(B+=_f(Fe,ye,l,p,e,_)),!ie.done){const be=wl(Fe),Se=ie.value.codePointAt(0);(L1[Fe]||be||"imageName"in ye||!ae.done&&Ou[Se])&&b.push(V0(G+1,B,T,b,_d(Fe,Se,be&&R),!1))}G++,$=X.next(),ie=K.next(),ae=re.next()}return G0(V0(this.length(),B,T,b,0,!0))}determineAverageLineWidth(e,n,l,p,_){let b=0,T=0;for(const R of this.text){const B=this.getSection(T);b+=_f(R.codePointAt(0),B,l,p,e,_),T++}return b/Math.max(1,Math.ceil(b/n))}}const Dp=4294967296,bf=1/Dp,Rp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Pp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,l=this.length){for(;this.pos<l;){const p=this.readVarint(),_=p>>3,b=this.pos;this.type=7&p,e(_,n,this),this.pos===b&&this.skip(p)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Dp;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Dp;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let l,p;return p=n[this.pos++],l=127&p,p<128?l:(p=n[this.pos++],l|=(127&p)<<7,p<128?l:(p=n[this.pos++],l|=(127&p)<<14,p<128?l:(p=n[this.pos++],l|=(127&p)<<21,p<128?l:(p=n[this.pos],l|=(15&p)<<28,(function(_,b,T){const R=T.buf;let B,G;if(G=R[T.pos++],B=(112&G)>>4,G<128||(G=R[T.pos++],B|=(127&G)<<3,G<128)||(G=R[T.pos++],B|=(127&G)<<10,G<128)||(G=R[T.pos++],B|=(127&G)<<17,G<128)||(G=R[T.pos++],B|=(127&G)<<24,G<128)||(G=R[T.pos++],B|=(1&G)<<31,G<128))return bd(_,B,b);throw new Error("Expected varint not more than 10 bytes")})(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&Rp?Rp.decode(this.buf.subarray(n,e)):(function(l,p,_){let b="",T=p;for(;T<_;){const R=l[T];let B,G,X,$=null,K=R>239?4:R>223?3:R>191?2:1;if(T+K>_)break;K===1?R<128&&($=R):K===2?(B=l[T+1],(192&B)==128&&($=(31&R)<<6|63&B,$<=127&&($=null))):K===3?(B=l[T+1],G=l[T+2],(192&B)==128&&(192&G)==128&&($=(15&R)<<12|(63&B)<<6|63&G,($<=2047||$>=55296&&$<=57343)&&($=null))):K===4&&(B=l[T+1],G=l[T+2],X=l[T+3],(192&B)==128&&(192&G)==128&&(192&X)==128&&($=(15&R)<<18|(63&B)<<12|(63&G)<<6|63&X,($<=65535||$>=1114112)&&($=null))),$===null?($=65533,K=1):$>65535&&($-=65536,b+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),b+=String.fromCharCode($),T+=K}return b})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*bf),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*bf),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,l){let p,_;if(n>=0?(p=n%4294967296|0,_=n/4294967296|0):(p=~(-n%4294967296),_=~(-n/4294967296),4294967295^p?p=p+1|0:(p=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(b,T,R){R.buf[R.pos++]=127&b|128,b>>>=7,R.buf[R.pos++]=127&b|128,b>>>=7,R.buf[R.pos++]=127&b|128,b>>>=7,R.buf[R.pos++]=127&b|128,R.buf[R.pos]=127&(b>>>=7)})(p,0,l),(function(b,T){const R=(7&b)<<4;T.buf[T.pos++]|=R|((b>>>=3)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b)))))})(_,l)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(p,_,b){for(let T,R,B=0;B<_.length;B++){if(T=_.charCodeAt(B),T>55295&&T<57344){if(!R){T>56319||B+1===_.length?(p[b++]=239,p[b++]=191,p[b++]=189):R=T;continue}if(T<56320){p[b++]=239,p[b++]=191,p[b++]=189,R=T;continue}T=R-55296<<10|T-56320|65536,R=null}else R&&(p[b++]=239,p[b++]=191,p[b++]=189,R=null);T<128?p[b++]=T:(T<2048?p[b++]=T>>6|192:(T<65536?p[b++]=T>>12|224:(p[b++]=T>>18|240,p[b++]=T>>12&63|128),p[b++]=T>>6&63|128),p[b++]=63&T|128)}return b})(this.buf,e,this.pos);const l=this.pos-n;l>=128&&am(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let l=0;l<n;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,n){this.pos++;const l=this.pos;e(n,this);const p=this.pos-l;p>=128&&am(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p}writeMessage(e,n,l){this.writeTag(e,2),this.writeRawMessage(n,l)}writePackedVarint(e,n){n.length&&this.writeMessage(e,om,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,lm,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,cm,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,vd,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,Op,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,um,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,hm,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,dm,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,fm,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function bd(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function am(i,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let p=n.pos-1;p>=i;p--)n.buf[p+l]=n.buf[p]}function om(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function lm(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function vd(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function Op(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function cm(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function um(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function hm(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function dm(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function fm(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function pm(i,e,n){i===1&&n.readMessage(zp,e)}function zp(i,e,n){if(i===3){const{id:l,bitmap:p,width:_,height:b,left:T,top:R,advance:B}=n.readMessage(gm,{});e.push({id:l,bitmap:new sf({width:_+6,height:b+6},p),metrics:{width:_,height:b,left:T,top:R,advance:B}})}}function gm(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function H0(i){let e=0,n=0;for(const b of i)e+=b.w*b.h,n=Math.max(n,b.w);i.sort(((b,T)=>T.h-b.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let p=0,_=0;for(const b of i)for(let T=l.length-1;T>=0;T--){const R=l[T];if(!(b.w>R.w||b.h>R.h)){if(b.x=R.x,b.y=R.y,_=Math.max(_,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===R.w&&b.h===R.h){const B=l.pop();B&&T<l.length&&(l[T]=B)}else b.h===R.h?(R.x+=b.w,R.w-=b.w):b.w===R.w?(R.y+=b.h,R.h-=b.h):(l.push({x:R.x+b.w,y:R.y,w:R.w-b.w,h:b.h}),R.y+=b.h,R.h-=b.h);break}}return{w:p,h:_,fill:e/(p*_)||0}}class Gr{constructor(e,{pixelRatio:n,version:l,stretchX:p,stretchY:_,content:b,textFitWidth:T,textFitHeight:R}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=p,this.stretchY=_,this.content=b,this.version=l,this.textFitWidth=T,this.textFitHeight=R}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Lp{constructor(e,n){const l={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,l,_),this.addImages(n,p,_);const{w:b,h:T}=H0(_),R=new Ya({width:b||1,height:T||1});for(const B in e){const G=e[B],X=l[B].paddedRect;Ya.copy(G.data,R,{x:0,y:0},{x:X.x+1,y:X.y+1},G.data)}for(const B in n){const G=n[B],X=p[B].paddedRect,$=X.x+1,K=X.y+1,ie=G.data.width,re=G.data.height;Ya.copy(G.data,R,{x:0,y:0},{x:$,y:K},G.data),Ya.copy(G.data,R,{x:0,y:re-1},{x:$,y:K-1},{width:ie,height:1}),Ya.copy(G.data,R,{x:0,y:0},{x:$,y:K+re},{width:ie,height:1}),Ya.copy(G.data,R,{x:ie-1,y:0},{x:$-1,y:K},{width:1,height:re}),Ya.copy(G.data,R,{x:0,y:0},{x:$+ie,y:K},{width:1,height:re})}this.image=R,this.iconPositions=l,this.patternPositions=p}addImages(e,n,l){for(const p in e){const _=e[p],b={x:0,y:0,w:_.data.width+2,h:_.data.height+2};l.push(b),n[p]=new Gr(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),n)}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[p,_]=e.tl;l.update(n.data,void 0,{x:p,y:_})}}var zu;function vf(i,e,n,l,p,_,b,T,R,B,G,X,$,K,ie){const re=Mh.fromFeature(i,p);let ae;X===N.az.vertical&&re.verticalizePunctuation();let ye=re.determineLineBreaks(B,_,e,l,K);const{processBidirectionalText:Fe,processStyledBidirectionalText:be}=ko;if(Fe&&re.sections.length===1){ae=[],ye=ye.map((kt=>re.toCodeUnitIndex(kt)));const Ke=Fe(re.toString(),ye);for(const kt of Ke){const en=[...kt].map((()=>0));ae.push(new Mh(kt,re.sections,en))}}else if(be){ae=[],ye=ye.map((Xt=>re.toCodeUnitIndex(Xt)));let Ke=0;const kt=[];for(const Xt of re.text)kt.push(...Array(Xt.length).fill(re.sectionIndex[Ke])),Ke++;const en=be(re.text,kt,ye);for(const Xt of en){const cn=[];let Tn="";for(const dn of Xt[0])cn.push(Xt[1][Tn.length]),Tn+=dn;ae.push(new Mh(Xt[0],re.sections,cn))}}else ae=(function(Ke,kt){const en=[];let Xt=0;for(const cn of kt)en.push(Ke.substring(Xt,cn)),Xt=cn;return Xt<Ke.length()&&en.push(Ke.substring(Xt,Ke.length())),en})(re,ye);const Se=[],Ge={positionedLines:Se,text:re.toString(),top:G[1],bottom:G[1],left:G[0],right:G[0],writingMode:X,iconsInText:!1,verticalizable:!1};return(function(Ke,kt,en,Xt,cn,Tn,dn,Qt,Ut,Vn,zn,Yn){let Pn=0,pi=0,yr=0,Qi=0;const ws=Qt==="right"?1:Qt==="left"?0:.5,Ja=ea/Yn;let da=0;for(const zr of cn){zr.trim();const Ls=zr.getMaxScale(),Zs={positionedGlyphs:[],lineOffset:0};Ke.positionedLines[da]=Zs;const cs=Zs.positionedGlyphs;let sl=0;if(!zr.length()){pi+=Tn,++da;continue}const eo=B1(Xt,zr,Ja);let al=0;for(const ka of zr.text){const ks=zr.getSection(al),fa=ka.codePointAt(0),Bs=Bp(Ut,zn,fa),Na={glyph:fa,imageName:null,x:Pn,y:pi+-17,vertical:Bs,scale:1,fontStack:"",sectionIndex:zr.getSectionIndex(al),metrics:null,rect:null};let Rh;if("fontStack"in ks){if(Rh=wd(ks,fa,Bs,eo,kt,en),!Rh)continue;Na.fontStack=ks.fontStack}else{if(Ke.iconsInText=!0,ks.scale*=Ja,Rh=Z0(ks,Bs,Ls,eo,Xt),!Rh)continue;sl=Math.max(sl,Rh.imageOffset),Na.imageName=ks.imageName}const{rect:pu,metrics:Cg,baselineOffset:Dd}=Rh;Na.y+=Dd,Na.scale=ks.scale,Na.metrics=Cg,Na.rect=pu,cs.push(Na),Bs?(Ke.verticalizable=!0,Pn+=("imageName"in ks?Cg.advance:ea)*ks.scale+Vn):Pn+=Cg.advance*ks.scale+Vn,al++}cs.length!==0&&(yr=Math.max(Pn-Vn,yr),Fp(cs,0,cs.length-1,ws)),Pn=0,Zs.lineOffset=Math.max(sl,(Ls-1)*ea);const Rc=Tn*Ls+sl;pi+=Rc,Qi=Math.max(Rc,Qi),++da}const{horizontalAlign:As,verticalAlign:ms}=q0(dn);(function(zr,Ls,Zs,cs,sl,eo,al,Rc,ka){const ks=(Ls-Zs)*sl;let fa=0;fa=eo!==al?-Rc*cs- -17:-cs*ka*al+.5*al;for(const Bs of zr)for(const Na of Bs.positionedGlyphs)Na.x+=ks,Na.y+=fa})(Ke.positionedLines,ws,As,ms,yr,Qi,Tn,pi,cn.length),Ke.top+=-ms*pi,Ke.bottom=Ke.top+pi,Ke.left+=-As*yr,Ke.right=Ke.left+yr})(Ge,e,n,l,ae,b,T,R,X,B,$,ie),!(function(Ke){for(const kt of Ke)if(kt.positionedGlyphs.length!==0)return!1;return!0})(Se)&&Ge}function q0(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function B1(i,e,n){const l=e.getMaxScale()*ea,{maxImageWidth:p,maxImageHeight:_}=e.getMaxImageSize(i),b=Math.max(l,_*n);return{verticalLineContentWidth:Math.max(l,p*n),horizontalLineContentHeight:b}}function mm(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function Bp(i,e,n){return!(i===N.az.horizontal||!e&&!Zc(n)||e&&(hh(n)||(l=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function wd(i,e,n,l,p,_){const b=_[i.fontStack],T=(function(B,G,X,$){if(B&&B.rect)return B;const K=G[X.fontStack],ie=K&&K[$];return ie?{rect:null,metrics:ie.metrics}:null})(b&&b[e],p,i,e);if(T===null)return null;let R;if(n)R=l.verticalLineContentWidth-i.scale*ea;else{const B=mm(i.verticalAlign);R=(l.horizontalLineContentHeight-i.scale*ea)*B}return{rect:T.rect,metrics:T.metrics,baselineOffset:R}}function Z0(i,e,n,l,p){const _=p[i.imageName];if(!_)return null;const b=_.paddedRect,T=_.displaySize,R={width:T[0],height:T[1],left:1,top:-3,advance:e?T[1]:T[0]};let B;if(e)B=l.verticalLineContentWidth-T[1]*i.scale;else{const G=mm(i.verticalAlign);B=(l.horizontalLineContentHeight-T[1]*i.scale)*G}return{rect:b,metrics:R,baselineOffset:B,imageOffset:(e?T[0]:T[1])*i.scale-ea*n}}function Fp(i,e,n,l){if(l===0)return;const p=i[n],_=(i[n].x+p.metrics.advance*p.scale)*l;for(let b=e;b<=n;b++)i[b].x-=_}function X0(i,e,n){const{horizontalAlign:l,verticalAlign:p}=q0(n),_=e[0]-i.displaySize[0]*l,b=e[1]-i.displaySize[1]*p;return{image:i,top:b,bottom:b+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function cu(i){var e,n;let l=i.left,p=i.top,_=i.right-l,b=i.bottom-p;const T=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",R=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",B=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(R==="proportional"){if(T==="stretchOnly"&&_/b<B||T==="proportional"){const G=Math.ceil(b*B);l*=G/_,_=G}}else if(T==="proportional"&&R==="stretchOnly"&&B!==0&&_/b>B){const G=Math.ceil(_/B);p*=G/b,b=G}return{x1:l,y1:p,x2:l+_,y2:p+b}}function rc(i,e,n,l,p,_){const b=i.image;let T;if(b.content){const ae=b.content,ye=b.pixelRatio||1;T=[ae[0]/ye,ae[1]/ye,b.displaySize[0]-ae[2]/ye,b.displaySize[1]-ae[3]/ye]}const R=e.left*_,B=e.right*_;let G,X,$,K;n==="width"||n==="both"?(K=p[0]+R-l[3],X=p[0]+B+l[1]):(K=p[0]+(R+B-b.displaySize[0])/2,X=K+b.displaySize[0]);const ie=e.top*_,re=e.bottom*_;return n==="height"||n==="both"?(G=p[1]+ie-l[0],$=p[1]+re+l[2]):(G=p[1]+(ie+re-b.displaySize[1])/2,$=G+b.displaySize[1]),{image:b,top:G,right:X,bottom:$,left:K,collisionPadding:T}}On("ImagePosition",Gr),On("ImageAtlas",Lp),N.az=void 0,(zu=N.az||(N.az={}))[zu.none=0]="none",zu[zu.horizontal=1]="horizontal",zu[zu.vertical=2]="vertical",zu[zu.horizontalOnly=3]="horizontalOnly";const il=128,Lu=32640;function W0(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Ir(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=n;let _=0;for(;_<l.length&&l[_]<=i;)_++;_=Math.max(0,_-1);let b=_;for(;b<l.length&&l[b]<i+1;)b++;b=Math.min(l.length-1,b);const T=l[_],R=l[b];return n.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:R,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:R,minSize:n.evaluate(new Ir(T)),maxSize:n.evaluate(new Ir(R)),interpolationType:p}}}function jp(i,e,n){let l="never";const p=i.get(e);return p?l=p:i.get(n)&&(l="always"),l}const ym=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wf(i,e,n,l,p,_,b,T,R,B,G,X,$){const K=T?Math.min(Lu,Math.round(T[0])):0,ie=T?Math.min(Lu,Math.round(T[1])):0;i.emplaceBack(e,n,Math.round(32*l),Math.round(32*p),_,b,(K<<1)+(R?1:0),ie,16*B,16*G,256*X,256*$)}function Y0(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function $0(i){for(const e of i.sections)if(Yl(e.text))return!0;return!1}class Up{constructor(e){this.layoutVertexArray=new Ve,this.indexArray=new Ot,this.programConfigurations=e,this.segments=new Cn,this.dynamicLayoutVertexArray=new dt,this.opacityVertexArray=new Lt,this.hasVisibleVertices=!1,this.placedSymbolArray=new k}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,xf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ym,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}On("SymbolBuffers",Up);class Vp{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new Cn,this.collisionVertexArray=new Pt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,U0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}On("CollisionBuffers",Vp);class Ad{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=W0(this.zoom,n["text-size"]),this.iconSizeData=W0(this.zoom,n["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=jp(l,"text-overlap","text-allow-overlap")!=="never"||jp(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((b=>N.az[b]))),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Up(new Sc(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Up(new Sc(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Z,this.lineVertexArray=new W,this.symbolInstances=new j,this.textAnchorOffsets=new J}calculateGlyphDependencies(e,n,l,p,_){for(const b of e)if(n[b.codePointAt(0)]=!0,(l||p)&&_){const T=xd[b];T&&(n[T.codePointAt(0)]=!0)}}populate(e,n,l){const p=this.layers[0],_=p.layout,b=_.get("text-font"),T=_.get("text-field"),R=_.get("icon-image"),B=(T.value.kind!=="constant"||T.value.value instanceof Xi&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),G=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,X=_.get("symbol-sort-key");if(this.features=[],!B&&!G)return;const $=n.iconDependencies,K=n.glyphDependencies,ie=n.availableImages,re=new Ir(this.zoom);for(const{feature:ae,id:ye,index:Fe,sourceLayerIndex:be}of e){const Se=p._featureFilter.needGeometry,Ge=tl(ae,Se);if(!p._featureFilter.filter(re,Ge,l))continue;let Ke,kt;if(Se||(Ge.geometry=tc(ae)),B){const Xt=p.getValueAndResolveTokens("text-field",Ge,l,ie),cn=Xi.factory(Xt),Tn=this.hasRTLText=this.hasRTLText||$0(cn);(!Tn||ko.getRTLTextPluginStatus()==="unavailable"||Tn&&ko.isParsed())&&(Ke=Fo(cn,p,Ge))}if(G){const Xt=p.getValueAndResolveTokens("icon-image",Ge,l,ie);kt=Xt instanceof Ws?Xt:Ws.fromString(Xt)}if(!Ke&&!kt)continue;const en=this.sortFeaturesByKey?X.evaluate(Ge,{},l):void 0;if(this.features.push({id:ye,text:Ke,icon:kt,index:Fe,sourceLayerIndex:be,geometry:Ge.geometry,properties:ae.properties,type:gd.types[ae.type],sortKey:en}),kt&&($[kt.name]=!0),Ke){const Xt=b.evaluate(Ge,{},l).join(","),cn=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(N.az.vertical)>=0;for(const Tn of Ke.sections)if(Tn.image)$[Tn.image.name]=!0;else{const dn=Al(Ke.toString()),Qt=Tn.fontStack||Xt,Ut=K[Qt]=K[Qt]||{};this.calculateGlyphDependencies(Tn.text,Ut,cn,this.allowVerticalPlacement,dn)}}}_.get("symbol-placement")==="line"&&(this.features=(function(ae){const ye={},Fe={},be=[];let Se=0;function Ge(Xt){be.push(ae[Xt]),Se++}function Ke(Xt,cn,Tn){const dn=Fe[Xt];return delete Fe[Xt],Fe[cn]=dn,be[dn].geometry[0].pop(),be[dn].geometry[0]=be[dn].geometry[0].concat(Tn[0]),dn}function kt(Xt,cn,Tn){const dn=ye[cn];return delete ye[cn],ye[Xt]=dn,be[dn].geometry[0].shift(),be[dn].geometry[0]=Tn[0].concat(be[dn].geometry[0]),dn}function en(Xt,cn,Tn){const dn=Tn?cn[0][cn[0].length-1]:cn[0][0];return`${Xt}:${dn.x}:${dn.y}`}for(let Xt=0;Xt<ae.length;Xt++){const cn=ae[Xt],Tn=cn.geometry,dn=cn.text?cn.text.toString():null;if(!dn){Ge(Xt);continue}const Qt=en(dn,Tn),Ut=en(dn,Tn,!0);if(Qt in Fe&&Ut in ye&&Fe[Qt]!==ye[Ut]){const Vn=kt(Qt,Ut,Tn),zn=Ke(Qt,Ut,be[Vn].geometry);delete ye[Qt],delete Fe[Ut],Fe[en(dn,be[zn].geometry,!0)]=zn,be[Vn].geometry=null}else Qt in Fe?Ke(Qt,Ut,Tn):Ut in ye?kt(Qt,Ut,Tn):(Ge(Xt),ye[Qt]=Se-1,Fe[Ut]=Se-1)}return be.filter((Xt=>Xt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ae,ye)=>ae.sortKey-ye.sortKey))}update(e,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(n[e.segment+1]),_=e.dist(n[e.segment]);const b={};for(let T=e.segment+1;T<n.length;T++)b[T]={x:n[T].x,y:n[T].y,tileUnitDistanceFromAnchor:p},T<n.length-1&&(p+=n[T+1].dist(n[T]));for(let T=e.segment||0;T>=0;T--)b[T]={x:n[T].x,y:n[T].y,tileUnitDistanceFromAnchor:_},T>0&&(_+=n[T-1].dist(n[T]));for(let T=0;T<n.length;T++){const R=b[T];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,p,_,b,T,R,B,G,X,$){const K=e.indexArray,ie=e.layoutVertexArray,re=e.segments.prepareSegment(4*n.length,ie,K,this.canOverlap?b.sortKey:void 0),ae=this.glyphOffsetArray.length,ye=re.vertexLength,Fe=this.allowVerticalPlacement&&T===N.az.vertical?Math.PI/2:0,be=b.text&&b.text.sections;for(let Se=0;Se<n.length;Se++){const{tl:Ge,tr:Ke,bl:kt,br:en,tex:Xt,pixelOffsetTL:cn,pixelOffsetBR:Tn,minFontScaleX:dn,minFontScaleY:Qt,glyphOffset:Ut,isSDF:Vn,sectionIndex:zn}=n[Se],Yn=re.vertexLength,Pn=Ut[1];wf(ie,R.x,R.y,Ge.x,Pn+Ge.y,Xt.x,Xt.y,l,Vn,cn.x,cn.y,dn,Qt),wf(ie,R.x,R.y,Ke.x,Pn+Ke.y,Xt.x+Xt.w,Xt.y,l,Vn,Tn.x,cn.y,dn,Qt),wf(ie,R.x,R.y,kt.x,Pn+kt.y,Xt.x,Xt.y+Xt.h,l,Vn,cn.x,Tn.y,dn,Qt),wf(ie,R.x,R.y,en.x,Pn+en.y,Xt.x+Xt.w,Xt.y+Xt.h,l,Vn,Tn.x,Tn.y,dn,Qt),Y0(e.dynamicLayoutVertexArray,R,Fe),K.emplaceBack(Yn,Yn+2,Yn+1),K.emplaceBack(Yn+1,Yn+2,Yn+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),Se!==n.length-1&&zn===n[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,b,b.index,{imagePositions:{},canonical:$,formattedSection:be&&be[zn]})}e.placedSymbolArray.emplaceBack(R.x,R.y,ae,this.glyphOffsetArray.length-ae,ye,B,G,R.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],T,0,!1,0,X)}_addCollisionDebugVertex(e,n,l,p,_,b){return n.emplaceBack(0,0),e.emplaceBack(l.x,l.y,p,_,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(e,n,l,p,_,b,T){const R=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),B=R.vertexLength,G=_.layoutVertexArray,X=_.collisionVertexArray,$=T.anchorX,K=T.anchorY;this._addCollisionDebugVertex(G,X,b,$,K,new U(e,n)),this._addCollisionDebugVertex(G,X,b,$,K,new U(l,n)),this._addCollisionDebugVertex(G,X,b,$,K,new U(l,p)),this._addCollisionDebugVertex(G,X,b,$,K,new U(e,p)),R.vertexLength+=4;const ie=_.indexArray;ie.emplaceBack(B,B+1),ie.emplaceBack(B+1,B+2),ie.emplaceBack(B+2,B+3),ie.emplaceBack(B+3,B),R.primitiveLength+=4}addDebugCollisionBoxes(e,n,l,p){for(let _=e;_<n;_++){const b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vp(Mt,Bo.members,bn),this.iconCollisionBox=new Vp(Mt,Bo.members,bn);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,l,p,_,b,T,R,B){const G={};for(let X=n;X<l;X++){const $=e.get(X);G.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},G.textFeatureIndex=$.featureIndex;break}for(let X=p;X<_;X++){const $=e.get(X);G.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},G.verticalTextFeatureIndex=$.featureIndex;break}for(let X=b;X<T;X++){const $=e.get(X);G.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},G.iconFeatureIndex=$.featureIndex;break}for(let X=R;X<B;X++){const $=e.get(X);G.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},G.verticalIconFeatureIndex=$.featureIndex;break}return G}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),p=l.vertexStartIndex+4*l.numGlyphs;for(let _=l.vertexStartIndex;_<p;_+=4)e.indexArray.emplaceBack(_,_+2,_+1),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),p=[],_=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const R=this.symbolInstances.get(T);p.push(0|Math.round(n*R.anchorX+l*R.anchorY)),_.push(R.featureIndex)}return b.sort(((T,R)=>p[T]-p[R]||_[R]-_[T])),b}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((p,_,b)=>{p>=0&&b.indexOf(p)===_&&this.addIndicesForPlacedSymbol(this.text,p)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Gp,Hp;On("SymbolBucket",Ad,{omit:["layers","collisionBoxArray","features","compareText"]}),Ad.MAX_GLYPHS=65535,Ad.addDynamicAttributes=Y0;var Q0={get paint(){return Hp=Hp||new Is({"icon-opacity":new ri(ut.paint_symbol["icon-opacity"]),"icon-color":new ri(ut.paint_symbol["icon-color"]),"icon-halo-color":new ri(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new ri(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ri(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new Bn(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bn(ut.paint_symbol["icon-translate-anchor"]),"text-opacity":new ri(ut.paint_symbol["text-opacity"]),"text-color":new ri(ut.paint_symbol["text-color"],{runtimeType:$t,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ri(ut.paint_symbol["text-halo-color"]),"text-halo-width":new ri(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new ri(ut.paint_symbol["text-halo-blur"]),"text-translate":new Bn(ut.paint_symbol["text-translate"]),"text-translate-anchor":new Bn(ut.paint_symbol["text-translate-anchor"])})},get layout(){return Gp=Gp||new Is({"symbol-placement":new Bn(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new Bn(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bn(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ri(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bn(ut.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bn(ut.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Bn(ut.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Bn(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bn(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bn(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new ri(ut.layout_symbol["icon-size"]),"icon-text-fit":new Bn(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bn(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new ri(ut.layout_symbol["icon-image"]),"icon-rotate":new ri(ut.layout_symbol["icon-rotate"]),"icon-padding":new ri(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new Bn(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new ri(ut.layout_symbol["icon-offset"]),"icon-anchor":new ri(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bn(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bn(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bn(ut.layout_symbol["text-rotation-alignment"]),"text-field":new ri(ut.layout_symbol["text-field"]),"text-font":new ri(ut.layout_symbol["text-font"]),"text-size":new ri(ut.layout_symbol["text-size"]),"text-max-width":new ri(ut.layout_symbol["text-max-width"]),"text-line-height":new Bn(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new ri(ut.layout_symbol["text-letter-spacing"]),"text-justify":new ri(ut.layout_symbol["text-justify"]),"text-radial-offset":new ri(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bn(ut.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ri(ut.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ri(ut.layout_symbol["text-anchor"]),"text-max-angle":new Bn(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new Bn(ut.layout_symbol["text-writing-mode"]),"text-rotate":new ri(ut.layout_symbol["text-rotate"]),"text-padding":new Bn(ut.layout_symbol["text-padding"]),"text-keep-upright":new Bn(ut.layout_symbol["text-keep-upright"]),"text-transform":new ri(ut.layout_symbol["text-transform"]),"text-offset":new ri(ut.layout_symbol["text-offset"]),"text-allow-overlap":new Bn(ut.layout_symbol["text-allow-overlap"]),"text-overlap":new Bn(ut.layout_symbol["text-overlap"]),"text-ignore-placement":new Bn(ut.layout_symbol["text-ignore-placement"]),"text-optional":new Bn(ut.layout_symbol["text-optional"])})}};class xm{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Zi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}On("FormatSectionOverride",xm,{omit:["defaultValue"]});class Bu extends ps{constructor(e,n){super(e,Q0,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const _ of l)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,l,p){const _=this.layout.get(e).evaluate(n,{},l,p),b=this._unevaluatedLayout._values[e];return b.isDataDriven()||xc(b.value)||!_?_:(function(T,R){return R.replace(/{([^{}]+)}/g,((B,G)=>T&&G in T?String(T[G]):""))})(n.properties,_)}createBucket(e){return new Ad(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Q0.paint.overridableProperties){if(!Bu.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new xm(n),p=new Qh(l,n.property.specification);let _=null;_=n.value.kind==="constant"||n.value.kind==="source"?new Fa("source",p):new _c("composite",p,n.value.zoomStops),this.paint._values[e]=new po(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&Bu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),p=Q0.paint.properties[n];let _=!1;const b=T=>{for(const R of T)if(p.overrides&&p.overrides.hasOverride(R))return void(_=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Xi)b(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const T=B=>{_||(B instanceof ys&&Nr(B.value)===Hn?b(B.value.sections):B instanceof is?b(B.sections):B.eachChild(T))},R=l.value;R._styleExpression&&T(R._styleExpression.expression)}return _}}let _m;var bm={get paint(){return _m=_m||new Is({"background-color":new Bn(ut.paint_background["background-color"]),"background-pattern":new Iu(ut.paint_background["background-pattern"]),"background-opacity":new Bn(ut.paint_background["background-opacity"])})}};class dr extends ps{constructor(e,n){super(e,bm,n)}}class K0 extends ps{constructor(e,n){super(e,{},n),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class qp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const J0={once:!0},Zp=63710088e-1;class Nc{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Nc(Kt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,p=e.lat*n,_=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((e.lng-this.lng)*n);return Zp*Math.acos(Math.min(_,1))}static convert(e){if(e instanceof Nc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Nc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Nc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ed=2*Math.PI*Zp;function Af(i){return Ed*Math.cos(i*Math.PI/180)}function vm(i){return(180+i)/360}function eg(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function wm(i,e){return i/Af(e)}function Am(i){return 360*i-180}function Ef(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function tg(i,e){return i*Af(Ef(e))}class Pr{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=Nc.convert(e);return new Pr(vm(l.lng),eg(l.lat),wm(n,l.lat))}toLngLat(){return new Nc(Am(this.x),Ef(this.y))}toAltitude(){return tg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ed*(e=Ef(this.y),1/Math.cos(e*Math.PI/180));var e}}function Xp(i,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class wa{constructor(e,n,l){if(!(function(p,_,b){return!(p<0||p>25||b<0||b>=Math.pow(2,p)||_<0||_>=Math.pow(2,p))})(e,n,l))throw new Error(`x=${n}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=l,this.key=Sd(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,l){const p=(function(b,T,R){var B=Xp(256*b,256*(T=Math.pow(2,R)-T-1),R),G=Xp(256*(b+1),256*(T+1),R);return B[0]+","+B[1]+","+G[0]+","+G[1]})(this.x,this.y,this.z),_=(function(b,T,R){let B,G="";for(let X=b;X>0;X--)B=1<<X-1,G+=(T&B?1:0)+(R&B?2:0);return G})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,_).replace(/{bbox-epsg-3857}/g,p)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new U((e.x*n-this.x)*zt,(e.y*n-this.y)*zt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Em{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Sd(e,n.z,n.z,n.x,n.y)}}class jo{constructor(e,n,l,p,_){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=n,this.canonical=new wa(l,+p,+_),this.key=Sd(n,e,l,p,_)}clone(){return new jo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new jo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jo(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?Sd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Sd(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new jo(n,this.wrap,n,l,p),new jo(n,this.wrap,n,l+1,p),new jo(n,this.wrap,n,l,p+1),new jo(n,this.wrap,n,l+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new jo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Em(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Pr(e.x-this.wrap,e.y))}}function Sd(i,e,n,l,p){(i*=2)<0&&(i=-1*i-1);const _=1<<n;return(_*_*i+_*p+l).toString(36)+n.toString(36)+e.toString(36)}function Sf(i,e){return e?i.properties[e]:i.id}function ng(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const p=i.addOrUpdateProperties.findIndex((_=>_.key===l));p>-1&&i.addOrUpdateProperties.splice(p,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function Cf(i){var e,n;if(!i)return{};const l={};return l.removeAll=i.removeAll,l.remove=new Set(i.remove||[]),l.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((p=>[p.id,p]))),l.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((p=>[p.id,p]))),l}On("CanonicalTileID",wa),On("OverscaledTileID",jo,{omit:["terrainRttPosMatrix32f"]});class Fu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new Fu;return n.extend(e(new U(this.minX,this.minY))),n.extend(e(new U(this.maxX,this.minY))),n.extend(e(new U(this.minX,this.maxY))),n.extend(e(new U(this.maxX,this.maxY))),n}static fromPoints(e){const n=new Fu;for(const l of e)n.extend(l);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class ig{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Wp{constructor(e,n,l,p,_){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=p,this._z=n,this.properties=e.properties,this.id=_}projectPoint(e,n,l,p){return[360*(e.x+n)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/p)*Math.PI))-90]}projectLine(e,n,l,p){return e.map((_=>this.projectPoint(_,n,l,p)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),l=e.extent*this._x,p=e.extent*this._y,_=e.loadGeometry();switch(e.type){case 1:{const b=[];for(const R of _)b.push(R[0]);const T=this.projectLine(b,l,p,n);this._geometry=b.length===1?{type:"Point",coordinates:T[0]}:{type:"MultiPoint",coordinates:T};break}case 2:{const b=_.map((T=>this.projectLine(T,l,p,n)));this._geometry=b.length===1?{type:"LineString",coordinates:b[0]}:{type:"MultiLineString",coordinates:b};break}case 3:{const b=nm(_),T=[];for(const R of b)T.push(R.map((B=>this.projectLine(B,l,p,n))));this._geometry=T.length===1?{type:"Polygon",coordinates:T[0]}:{type:"MultiPolygon",coordinates:T};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class ju{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,l){this._name=e,this.dataBuffer=n,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Yp extends ju{}class $p extends Yp{getValueFromBuffer(e){return this.dataBuffer[e]}}class rg extends Yp{getValueFromBuffer(e){return this.dataBuffer[e]}}class sg extends ju{delta;constructor(e,n,l,p){super(e,n,p),this.delta=l}}class ag extends sg{constructor(e,n,l,p){super(e,Int32Array.of(n),l,p)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class og extends ju{constructor(e,n,l){super(e,Int32Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Uu{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,l,p,_=4096){this._name=e,this._geometryVector=n,this._idVector=l,this._propertyVectors=p,this._extent=_}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const p=e?.next().value,_={};for(const b of this.propertyVectors){if(!b)continue;const T=b.name,R=b.getValue(n);R!==null&&(_[T]=R)}n++,yield{id:l,geometry:p,properties:_}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let p;this.idVector&&(p=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const _={coordinates:n[l],type:this.geometryVector.geometryType(l)},b={};for(const T of this.propertyVectors){if(!T)continue;const R=T.name,B=T.getValue(l);B!==null&&(b[R]=B)}e.push({id:p,geometry:_,properties:b})}return e}containsMaxSaveIntegerValues(e){return e instanceof $p||e instanceof og&&e instanceof ag||e instanceof rg}}class Sm{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var qi,sc,Ia,ac,Vu,$a,qs,ua,rl,_o;function ha(i,e,n){const l=new Int32Array(n);let p=0,_=e.get();for(let b=0;b<l.length;b++){let T=i[_++],R=127&T;T<128||(T=i[_++],R|=(127&T)<<7,T<128||(T=i[_++],R|=(127&T)<<14,T<128||(T=i[_++],R|=(127&T)<<21,T<128||(T=i[_++],R|=(15&T)<<28)))),l[p++]=R}return e.set(_),l}function Tf(i,e,n){const l=new BigInt64Array(n);for(let p=0;p<l.length;p++)l[p]=Qp(i,e);return l}function Cm(i,e){let n,l;return l=i[e.get()],e.increment(),n=127&l,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<7,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<14,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<21,l<128?n:(l=i[e.get()],n|=(15&l)<<28,(function(p,_,b){let T,R;if(R=_[b.get()],b.increment(),T=(112&R)>>4,R<128||(R=_[b.get()],b.increment(),T|=(127&R)<<3,R<128)||(R=_[b.get()],b.increment(),T|=(127&R)<<10,R<128)||(R=_[b.get()],b.increment(),T|=(127&R)<<17,R<128)||(R=_[b.get()],b.increment(),T|=(127&R)<<24,R<128)||(R=_[b.get()],b.increment(),T|=(1&R)<<31,R<128))return 4294967296*T+(p>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function Cd(i,e,n,l){throw new Error("FastPFor is not implemented yet.")}function Ma(i){return i>>>1^-(1&i)}function kh(i){return i>>1n^-(1n&i)}function Qp(i,e){let n=0n,l=0,p=e.get();for(;p<i.length;){const _=i[p++];if(n|=BigInt(127&_)<<BigInt(l),!(128&_))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(p),n}function Dc(i,e,n){const l=new Int32Array(n);let p=0;for(let _=0;_<e;_++){const b=i[_];l.fill(i[_+e],p,p+b),p+=b}return l}function Tm(i,e,n){const l=new BigInt64Array(n);let p=0;for(let _=0;_<e;_++){const b=Number(i[_]);l.fill(i[_+e],p,p+b),p+=b}return l}function Im(i,e,n){const l=new Float64Array(n);let p=0;for(let _=0;_<e;_++){const b=i[_];l.fill(i[_+e],p,p+b),p+=b}return l}function Gu(i){const e=i.length/4*4;let n=1;if(e>=4)for(let l=i[0];n<e-4;n+=4)l=i[n]+=l,l=i[n+1]+=l,l=i[n+2]+=l,l=i[n+3]+=l;for(;n!=i.length;)i[n]+=i[n-1],++n}function lg(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const l=i[n],p=i[n+1],_=i[n+2],b=i[n+3];i[n]=(l>>>1^-(1&l))+i[n-2],i[n+1]=(p>>>1^-(1&p))+i[n-1],i[n+2]=(_>>>1^-(1&_))+i[n],i[n+3]=(b>>>1^-(1&b))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(qi||(qi={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(sc||(sc={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(Ia||(Ia={}));class cg{_dictionaryType;_offsetType;_lengthType;constructor(e,n,l){this._dictionaryType=e,this._offsetType=n,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Qa(i,e){const n=(function(l,p){const _=l[p.get()],b=Object.values(Ia)[_>>4];let T=null;switch(b){case Ia.DATA:T=new cg(Object.values(ac)[15&_]);break;case Ia.OFFSET:T=new cg(null,Object.values(Vu)[15&_]);break;case Ia.LENGTH:T=new cg(null,null,Object.values($a)[15&_])}p.increment();const R=l[p.get()],B=Object.values(qi)[R>>5],G=Object.values(qi)[R>>2&7],X=Object.values(sc)[3&R];p.increment();const $=ha(l,p,2),K=$[0];return{physicalStreamType:b,logicalStreamType:T,logicalLevelTechnique1:B,logicalLevelTechnique2:G,physicalLevelTechnique:X,numValues:K,byteLength:$[1],decompressedCount:K}})(i,e);return n.logicalLevelTechnique1===qi.MORTON?(function(l,p,_){const b=ha(p,_,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:b[0],coordinateShift:b[1]}})(n,i,e):qi.RLE!==n.logicalLevelTechnique1&&qi.RLE!==n.logicalLevelTechnique2||sc.NONE===n.physicalLevelTechnique?n:(function(l,p,_){const b=ha(p,_,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:b[1],runs:b[0],numRleValues:b[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(ac||(ac={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(Vu||(Vu={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})($a||($a={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(qs||(qs={}));class oc{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const l=Math.floor(e/8);this.values[l]=this.values[l]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Ka(i,e,n,l,p){return(function(_,b,T){switch(b.logicalLevelTechnique1){case qi.DELTA:return b.logicalLevelTechnique2===qi.RLE?(function(R,B,G){const X=new Int32Array(G);let $=0,K=0;for(let ie=0;ie<B;ie++){const re=R[ie],ae=Ma(R[ie+B]);for(let ye=0;ye<re;ye++)K+=ae,X[$++]=K}return X})(_,b.runs,b.numRleValues):((function(R){R[0]=R[0]>>>1^-(1&R[0]);const B=R.length/4*4;let G=1;if(B>=4)for(;G<B-4;G+=4){const X=R[G],$=R[G+1],K=R[G+2],ie=R[G+3];R[G]=(X>>>1^-(1&X))+R[G-1],R[G+1]=($>>>1^-(1&$))+R[G],R[G+2]=(K>>>1^-(1&K))+R[G+1],R[G+3]=(ie>>>1^-(1&ie))+R[G+2]}for(;G!=R.length;++G)R[G]=(R[G]>>>1^-(1&R[G]))+R[G-1]})(_),_);case qi.RLE:return(function(R,B,G){return G?(function(X,$,K){const ie=new Int32Array(K);let re=0;for(let ae=0;ae<$;ae++){const ye=X[ae];let Fe=X[ae+$];Fe=Fe>>>1^-(1&Fe),ie.fill(Fe,re,re+ye),re+=ye}return ie})(R,B.runs,B.numRleValues):Dc(R,B.runs,B.numRleValues)})(_,b,T);case qi.MORTON:return Gu(_),_;case qi.COMPONENTWISE_DELTA:return lg(_),_;case qi.NONE:return T&&(function(R){for(let B=0;B<R.length;B++){const G=R[B];R[B]=G>>>1^-(1&G)}})(_),_;default:throw new Error(`The specified Logical level technique is not supported: ${b.logicalLevelTechnique1}`)}})(Kp(i,e,n),n,l)}function Hu(i,e,n){return(function(l,p){if(p.logicalLevelTechnique1===qi.DELTA&&p.logicalLevelTechnique2===qi.NONE)return(function(b){const T=new Int32Array(b.length+1);T[0]=0,T[1]=Ma(b[0]);let R=T[1],B=2;for(;B!=T.length;++B){const G=b[B-1];R+=G>>>1^-(1&G),T[B]=T[B-1]+R}return T})(l);if(p.logicalLevelTechnique1===qi.RLE&&p.logicalLevelTechnique2===qi.NONE)return(function(b,T,R){const B=new Int32Array(R+1);B[0]=0;let G=1,X=B[0];for(let $=0;$<T;$++){const K=b[$],ie=b[$+T];for(let re=G;re<G+K;re++)B[re]=ie+X,X=B[re];G+=K}return B})(l,p.runs,p.numRleValues);if(p.logicalLevelTechnique1===qi.NONE&&p.logicalLevelTechnique2===qi.NONE){(function(b){let T=0;for(let R=0;R<b.length;R++)b[R]+=T,T=b[R]})(l);const _=new Int32Array(p.numValues+1);return _[0]=0,_.set(l,1),_}if(p.logicalLevelTechnique1===qi.DELTA&&p.logicalLevelTechnique2===qi.RLE){const _=(function(b,T,R){const B=new Int32Array(R+1);B[0]=0;let G=1,X=B[0];for(let $=0;$<T;$++){const K=b[$];let ie=b[$+T];ie=ie>>>1^-(1&ie);for(let re=G;re<G+K;re++)B[re]=ie+X,X=B[re];G+=K}return B})(l,p.runs,p.numRleValues);return Gu(_),_}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Kp(i,e,n),n)}function Kp(i,e,n){const l=n.physicalLevelTechnique;if(l===sc.FAST_PFOR)return Cd();if(l===sc.VARINT)return ha(i,e,n.numValues);if(l===sc.NONE){const p=e.get();e.add(n.byteLength);const _=i.subarray(p,e.get());return new Int32Array(_)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function ug(i,e,n,l){const p=Kp(i,e,n);if(p.length===1){const _=p[0];return l?Ma(_):_}return l?(function(_){return Ma(_[1])})(p):(function(_){return _[1]})(p)}function hg(i,e,n){return(function(l){if(l.length==2){const p=Ma(l[1]);return[p,p]}return[Ma(l[2]),Ma(l[3])]})(Kp(i,e,n))}function Nh(i,e,n){return(function(l){if(l.length==2){const p=kh(l[1]);return[p,p]}return[kh(l[2]),kh(l[3])]})(Tf(i,e,n.numValues))}function Td(i,e,n,l){return(function(p,_,b){switch(_.logicalLevelTechnique1){case qi.DELTA:return _.logicalLevelTechnique2===qi.RLE?(function(T,R,B){const G=new BigInt64Array(B);let X=0,$=0n;for(let K=0;K<R;K++){const ie=Number(T[K]),re=kh(T[K+R]);for(let ae=0;ae<ie;ae++)$+=re,G[X++]=$}return G})(p,_.runs,_.numRleValues):((function(T){T[0]=T[0]>>1n^-(1n&T[0]);const R=T.length/4*4;let B=1;if(R>=4)for(;B<R-4;B+=4){const G=T[B],X=T[B+1],$=T[B+2],K=T[B+3];T[B]=(G>>1n^-(1n&G))+T[B-1],T[B+1]=(X>>1n^-(1n&X))+T[B],T[B+2]=($>>1n^-(1n&$))+T[B+1],T[B+3]=(K>>1n^-(1n&K))+T[B+2]}for(;B!=T.length;++B)T[B]=(T[B]>>1n^-(1n&T[B]))+T[B-1]})(p),p);case qi.RLE:return(function(T,R,B){return B?(function(G,X,$){const K=new BigInt64Array($);let ie=0;for(let re=0;re<X;re++){const ae=Number(G[re]);let ye=G[re+X];ye=ye>>1n^-(1n&ye),K.fill(ye,ie,ie+ae),ie+=ae}return K})(T,R.runs,R.numRleValues):Tm(T,R.runs,R.numRleValues)})(p,_,b);case qi.NONE:return b&&(function(T){for(let R=0;R<T.length;R++){const B=T[R];T[R]=B>>1n^-(1n&B)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${_.logicalLevelTechnique1}`)}})(Tf(i,e,n.numValues),n,l)}function dg(i,e,n,l){const p=Tf(i,e,n.numValues);if(p.length===1){const _=p[0];return l?kh(_):_}return l?(function(_){return kh(_[1])})(p):(function(_){return _[1]})(p)}function fg(i,e,n,l,p){return(function(_,b,T,R){switch(b.logicalLevelTechnique1){case qi.DELTA:return b.logicalLevelTechnique2===qi.RLE&&(_=Dc(_,b.runs,b.numRleValues)),(function(B,G){const X=new Int32Array(B.size());let $=0;B.get(0)?(X[0]=B.get(0)?G[0]>>>1^-(1&G[0]):0,$=1):X[0]=0;let K=1;for(;K!=X.length;++K)X[K]=B.get(K)?X[K-1]+(G[$]>>>1^-(1&G[$++])):X[K-1];return X})(R,_);case qi.RLE:return(function(B,G,X,$){const K=G;return X?(function(ie,re,ae){const ye=new Int32Array(ie.size());let Fe=0;for(let be=0;be<ae;be++){const Se=re[be];let Ge=re[be+ae];Ge=Ge>>>1^-(1&Ge);for(let Ke=Fe;Ke<Fe+Se;Ke++)ie.get(Ke)?ye[Ke]=Ge:(ye[Ke]=0,Fe++);Fe+=Se}return ye})($,B,K.runs):(function(ie,re,ae){const ye=new Int32Array(ie.size());let Fe=0;for(let be=0;be<ae;be++){const Se=re[be],Ge=re[be+ae];for(let Ke=Fe;Ke<Fe+Se;Ke++)ie.get(Ke)?ye[Ke]=Ge:(ye[Ke]=0,Fe++);Fe+=Se}return ye})($,B,K.runs)})(_,b,T,R);case qi.MORTON:return Gu(_),_;case qi.COMPONENTWISE_DELTA:return lg(_),_;case qi.NONE:return _=T?(function(B,G){const X=new Int32Array(B.size());let $=0,K=0;for(;K!=X.length;++K)if(B.get(K)){const ie=G[$++];X[K]=ie>>>1^-(1&ie)}else X[K]=0;return X})(R,_):(function(B,G){const X=new Int32Array(B.size());let $=0,K=0;for(;K!=X.length;++K)X[K]=B.get(K)?G[$++]:0;return X})(R,_),_;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===sc.FAST_PFOR?Cd():ha(i,e,n.numValues),n,l,p)}function uu(i,e,n,l){const p=i.logicalLevelTechnique1;if(p===qi.RLE)return i.runs===1?qs.CONST:qs.FLAT;const _=e instanceof oc?e.size():e;if(p===qi.DELTA&&i.logicalLevelTechnique2===qi.RLE){const b=i.runs,T=2;if(i.numRleValues!==_)return qs.FLAT;if(b===1)return qs.SEQUENCE;if(b===2){const R=l.get();let B;if(i.physicalLevelTechnique===sc.VARINT)B=ha(n,l,4);else{const G=l.get();B=new Int32Array(n.buffer,n.byteOffset+G,4)}if(l.set(R),B[2]===T&&B[3]===T)return qs.SEQUENCE}}return i.numValues===1?qs.CONST:qs.FLAT}class Id extends Yp{getValueFromBuffer(e){return this.dataBuffer[e]}}class pg extends sg{constructor(e,n,l,p){super(e,BigInt64Array.of(n),l,p)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class hu{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,l){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function If(i,e,n){return{x:Jp(i,e)-n,y:Jp(i>>1,e)-n}}function Jp(i,e){let n=0;for(let l=0;l<e;l++)n|=(i&1<<2*l)>>l;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(ua||(ua={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(rl||(rl={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(_o||(_o={}));class e0{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function gg(i){const e=new Array(i.numGeometries);let n=1,l=1,p=1,_=0;const b=new e0;let T=0,R=0;const B=i.mortonSettings,G=i.topologyVector,X=G.geometryOffsets,$=G.partOffsets,K=G.ringOffsets,ie=i.vertexOffsets,re=i.containsPolygonGeometry(),ae=i.vertexBuffer;for(let ye=0;ye<i.numGeometries;ye++){const Fe=i.geometryType(ye);if(Fe===ua.POINT){if(ie&&ie.length!==0)if(i.vertexBufferType===_o.VEC_2){const be=2*ie[R++],Se=new U(ae[be],ae[be+1]);e[_++]=b.createPoint(Se)}else{const be=If(ae[ie[R++]],B.numBits,B.coordinateShift),Se=new U(be.x,be.y);e[_++]=b.createPoint(Se)}else{const be=new U(ae[T++],ae[T++]);e[_++]=b.createPoint(be)}X&&p++,$&&n++,K&&l++}else if(Fe===ua.MULTIPOINT){const be=X[p]-X[p-1];p++;const Se=new Array(be);if(ie&&ie.length!==0){for(let Ge=0;Ge<be;Ge++){const Ke=2*ie[R++];Se[Ge]=new U(ae[Ke],ae[Ke+1])}e[_++]=b.createMultiPoint(Se)}else{for(let Ge=0;Ge<be;Ge++){const Ke=ae[T++],kt=ae[T++];Se[Ge]=new U(Ke,kt)}e[_++]=b.createMultiPoint(Se)}}else if(Fe===ua.LINESTRING){let be,Se=0;re?(Se=K[l]-K[l-1],l++):Se=$[n]-$[n-1],n++,ie&&ie.length!==0?(be=i.vertexBufferType===_o.VEC_2?Nf(ae,ie,R,Se,!1):yg(ae,ie,R,Se,!1,B),R+=Se):(be=mg(ae,T,Se,!1),T+=2*Se),e[_++]=b.createLineString(be),X&&p++}else if(Fe===ua.POLYGON){const be=$[n]-$[n-1];n++;const Se=new Array(be-1);let Ge=K[l]-K[l-1];if(l++,ie&&ie.length!==0){const Ke=i.vertexBufferType===_o.VEC_2?t0(ae,ie,R,Ge):kf(ae,ie,R,Ge,0,B);R+=Ge;for(let kt=0;kt<Se.length;kt++)Ge=K[l]-K[l-1],l++,Se[kt]=i.vertexBufferType===_o.VEC_2?t0(ae,ie,R,Ge):kf(ae,ie,R,Ge,0,B),R+=Ge;e[_++]=b.createPolygon(Ke,Se)}else{const Ke=Mf(ae,T,Ge);T+=2*Ge;for(let kt=0;kt<Se.length;kt++)Ge=K[l]-K[l-1],l++,Se[kt]=Mf(ae,T,Ge),T+=2*Ge;e[_++]=b.createPolygon(Ke,Se)}X&&p++}else if(Fe===ua.MULTILINESTRING){const be=X[p]-X[p-1];p++;const Se=new Array(be);if(ie&&ie.length!==0){for(let Ge=0;Ge<be;Ge++){let Ke=0;re?(Ke=K[l]-K[l-1],l++):Ke=$[n]-$[n-1],n++;const kt=i.vertexBufferType===_o.VEC_2?Nf(ae,ie,R,Ke,!1):yg(ae,ie,R,Ke,!1,B);Se[Ge]=kt,R+=Ke}e[_++]=b.createMultiLineString(Se)}else{for(let Ge=0;Ge<be;Ge++){let Ke=0;re?(Ke=K[l]-K[l-1],l++):Ke=$[n]-$[n-1],n++,Se[Ge]=mg(ae,T,Ke,!1),T+=2*Ke}e[_++]=b.createMultiLineString(Se)}}else{if(Fe!==ua.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const be=X[p]-X[p-1];p++;const Se=new Array(be);let Ge=0;if(ie&&ie.length!==0){for(let Ke=0;Ke<be;Ke++){const kt=$[n]-$[n-1];n++;const en=new Array(kt-1);Ge=K[l]-K[l-1],l++;const Xt=i.vertexBufferType===_o.VEC_2?t0(ae,ie,R,Ge):kf(ae,ie,R,Ge,0,B);R+=Ge;for(let cn=0;cn<en.length;cn++)Ge=K[l]-K[l-1],l++,en[cn]=i.vertexBufferType===_o.VEC_2?t0(ae,ie,R,Ge):kf(ae,ie,R,Ge,0,B),R+=Ge;Se[Ke]=b.createPolygon(Xt,en)}e[_++]=b.createMultiPolygon(Se)}else{for(let Ke=0;Ke<be;Ke++){const kt=$[n]-$[n-1];n++;const en=new Array(kt-1);Ge=K[l]-K[l-1],l++;const Xt=Mf(ae,T,Ge);T+=2*Ge;for(let cn=0;cn<en.length;cn++){const Tn=K[l]-K[l-1];l++,en[cn]=Mf(ae,T,Tn),T+=2*Tn}Se[Ke]=b.createPolygon(Xt,en)}e[_++]=b.createMultiPolygon(Se)}}}}return e}function Mf(i,e,n){return mg(i,e,n,!0)}function t0(i,e,n,l){return Nf(i,e,n,l,!0)}function kf(i,e,n,l,p,_){return yg(i,e,n,l,!0,_)}function mg(i,e,n,l){const p=new Array(l?n+1:n);for(let _=0;_<2*n;_+=2)p[_/2]=new U(i[e+_],i[e+_+1]);return l&&(p[p.length-1]=p[0]),p}function Nf(i,e,n,l,p){const _=new Array(p?l+1:l);for(let b=0;b<2*l;b+=2){const T=2*e[n+b/2];_[b/2]=new U(i[T],i[T+1])}return p&&(_[_.length-1]=_[0]),_}function yg(i,e,n,l,p,_){const b=new Array(p?l+1:l);for(let T=0;T<l;T++){const R=If(i[e[n+T]],_.numBits,_.coordinateShift);b[T]=new U(R.x,R.y)}return p&&(b[b.length-1]=b[0]),b}class Df{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,l,p,_){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=l,this._vertexBuffer=p,this._mortonSettings=_}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=gg(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=If(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return gg(this)}get mortonSettings(){return this._mortonSettings}}class Rf extends Df{_numGeometries;_geometryType;constructor(e,n,l,p,_,b,T){super(l,p,_,b,T),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ua.POLYGON||this._geometryType===ua.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Pf extends Df{_geometryTypes;constructor(e,n,l,p,_,b){super(e,l,p,_,b),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===ua.POLYGON||this.geometryType(e)===ua.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Mm{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,l,p){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=l,this._topologyVector=p}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,l=n.partOffsets,p=n.ringOffsets,_=n.geometryOffsets;let b=0,T=1,R=1,B=1;for(let G=0;G<this.numGeometries;G++)switch(this.geometryType(G)){case ua.POLYGON:{const X=l[T]-l[T-1];T++;const $=[];for(let K=0;K<X;K++){const ie=p[R]-p[R-1];R++;const re=[];for(let ae=0;ae<ie;ae++){const ye=this._vertexBuffer[b++],Fe=this._vertexBuffer[b++];re.push(new U(ye,Fe))}re.length>0&&re.push(re[0]),$.push(re)}e[G]=$,_&&B++}break;case ua.MULTIPOLYGON:{const X=_[B]-_[B-1];B++;const $=[];for(let K=0;K<X;K++){const ie=l[T]-l[T-1];T++;for(let re=0;re<ie;re++){const ae=p[R]-p[R-1];R++;const ye=[];for(let Fe=0;Fe<ae;Fe++){const be=this._vertexBuffer[b++],Se=this._vertexBuffer[b++];ye.push(new U(be,Se))}ye.length>0&&ye.push(ye[0]),$.push(ye)}}e[G]=$}}return e}[Symbol.iterator](){return null}}function Md(i,e,n,l,p,_){return new F1(i,e,n,l,p,_)}class F1 extends Mm{_numGeometries;_geometryType;constructor(e,n,l,p,_,b){super(l,p,_,b),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function xg(i,e,n,l,p){return new km(i,e,n,l,p)}class km extends Mm{_geometryTypes;constructor(e,n,l,p,_){super(n,l,p,_),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Nm(i,e,n,l,p){const _=Qa(i,n);let b=null,T=null,R=null,B=null,G=null,X=null,$=null,K=null;if(uu(_,l,i,n)===qs.CONST){const re=ug(i,n,_,!1);for(let ae=0;ae<e-1;ae++){const ye=Qa(i,n);switch(ye.physicalStreamType){case Ia.LENGTH:switch(ye.logicalStreamType.lengthType){case $a.GEOMETRIES:b=Hu(i,n,ye);break;case $a.PARTS:T=Hu(i,n,ye);break;case $a.RINGS:R=Hu(i,n,ye);break;case $a.TRIANGLES:$=Hu(i,n,ye)}break;case Ia.OFFSET:switch(ye.logicalStreamType.offsetType){case Vu.VERTEX:B=Ka(i,n,ye,!1);break;case Vu.INDEX:K=Ka(i,n,ye,!1)}break;case Ia.DATA:ac.VERTEX===ye.logicalStreamType.dictionaryType?G=Ka(i,n,ye,!0):(X={numBits:ye.numBits,coordinateShift:ye.coordinateShift},G=Ka(i,n,ye,!1))}}return K!==null?b!=null||T!=null?Md(l,re,$,K,G,new hu(b,T,R)):Md(l,re,$,K,G):X===null?(function(ae,ye,Fe,be,Se){return new Rf(ae,ye,_o.VEC_2,Fe,be,Se)})(l,re,new hu(b,T,R),B,G):(function(ae,ye,Fe,be,Se,Ge){return new Rf(ae,ye,_o.MORTON,Fe,be,Se,Ge)})(l,re,new hu(b,T,R),B,G,X)}const ie=Ka(i,n,_,!1);for(let re=0;re<e-1;re++){const ae=Qa(i,n);switch(ae.physicalStreamType){case Ia.LENGTH:switch(ae.logicalStreamType.lengthType){case $a.GEOMETRIES:b=Ka(i,n,ae,!1);break;case $a.PARTS:T=Ka(i,n,ae,!1);break;case $a.RINGS:R=Ka(i,n,ae,!1);break;case $a.TRIANGLES:$=Hu(i,n,ae)}break;case Ia.OFFSET:switch(ae.logicalStreamType.offsetType){case Vu.VERTEX:B=Ka(i,n,ae,!1);break;case Vu.INDEX:K=Ka(i,n,ae,!1)}break;case Ia.DATA:ac.VERTEX===ae.logicalStreamType.dictionaryType?G=Ka(i,n,ae,!0):(X={numBits:ae.numBits,coordinateShift:ae.coordinateShift},G=Ka(i,n,ae,!1))}}return K!==null&&T===null?xg(ie,$,K,G):(b!==null?(b=n0(ie,b,2),T!==null&&R!==null?(T=i0(ie,b,T,!1),R=(function(re,ae,ye,Fe){const be=new Int32Array(ye[ye.length-1]+1);let Se=0;be[0]=Se;let Ge=1,Ke=1,kt=0;for(let en=0;en<re.length;en++){const Xt=re[en],cn=ae[en+1]-ae[en];if(Xt!==0&&Xt!==3)for(let Tn=0;Tn<cn;Tn++){const dn=ye[Ge]-ye[Ge-1];Ge++;for(let Qt=0;Qt<dn;Qt++)Se=be[Ke++]=Se+Fe[kt++]}else for(let Tn=0;Tn<cn;Tn++)be[Ke++]=++Se,Ge++}return be})(ie,b,T,R)):T!==null&&(T=(function(re,ae,ye){const Fe=new Int32Array(ae[ae.length-1]+1);let be=0;Fe[0]=be;let Se=1,Ge=0;for(let Ke=0;Ke<re.length;Ke++){const kt=re[Ke],en=ae[Ke+1]-ae[Ke];if(kt===4||kt===1)for(let Xt=0;Xt<en;Xt++)be=Fe[Se++]=be+ye[Ge++];else for(let Xt=0;Xt<en;Xt++)Fe[Se++]=++be}return Fe})(ie,b,T))):T!==null&&R!==null?(T=n0(ie,T,1),R=i0(ie,T,R,!0)):T!==null&&(T=n0(ie,T,0)),K!==null?xg(ie,$,K,G,new hu(b,T,R)):X===null?(function(re,ae,ye,Fe){return new Pf(_o.VEC_2,re,ae,ye,Fe)})(ie,new hu(b,T,R),B,G):(function(re,ae,ye,Fe,be){return new Pf(_o.MORTON,re,ae,ye,Fe,be)})(ie,new hu(b,T,R),B,G,X))}function n0(i,e,n){const l=new Int32Array(i.length+1);let p=0;l[0]=p;let _=0;for(let b=0;b<i.length;b++)p=l[b+1]=p+(i[b]>n?e[_++]:1);return l}function i0(i,e,n,l){const p=new Int32Array(e[e.length-1]+1);let _=0;p[0]=_;let b=1,T=0;for(let R=0;R<i.length;R++){const B=i[R],G=e[R+1]-e[R];if(B===5||B===2||l&&(B===4||B===1))for(let X=0;X<G;X++)_=p[b++]=_+n[T++];else for(let X=0;X<G;X++)p[b++]=++_}return p}class Dm extends ju{dataVector;constructor(e,n,l){super(e,n.getBuffer(),l),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class Rm extends Yp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Of extends ju{constructor(e,n,l){super(e,BigInt64Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function zf(i,e,n){return Pm(i,Math.ceil(e/8),n)}function Pm(i,e,n){const l=new Uint8Array(e);let p=0;for(;p<e;){const _=i[n.increment()];if(_<=127){const b=_+3,T=i[n.increment()],R=p+b;l.fill(T,p,R),p=R}else{const b=256-_;for(let T=0;T<b;T++)l[p++]=i[n.increment()]}}return l}const _g=new TextDecoder;function Lf(i,e,n){return n-e>=12?_g.decode(i.subarray(e,n)):(function(l,p,_){let b="",T=p;for(;T<_;){const R=l[T];let B,G,X,$=null,K=R>239?4:R>223?3:R>191?2:1;if(T+K>_)break;K===1?R<128&&($=R):K===2?(B=l[T+1],(192&B)==128&&($=(31&R)<<6|63&B,$<=127&&($=null))):K===3?(B=l[T+1],G=l[T+2],(192&B)==128&&(192&G)==128&&($=(15&R)<<12|(63&B)<<6|63&G,($<=2047||$>=55296&&$<=57343)&&($=null))):K===4&&(B=l[T+1],G=l[T+2],X=l[T+3],(192&B)==128&&(192&G)==128&&(192&X)==128&&($=(15&R)<<18|(63&B)<<12|(63&G)<<6|63&X,($<=65535||$>=1114112)&&($=null))),$===null?($=65533,K=1):$>65535&&($-=65536,b+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),b+=String.fromCharCode($),T+=K}return b})(i,e,n)}class kd extends ju{offsetBuffer;constructor(e,n,l,p){super(e,l,p),this.offsetBuffer=n}}class r0 extends kd{textEncoder;constructor(e,n,l,p){super(e,n,l,p??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Lf(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Dh extends kd{indexBuffer;textEncoder;constructor(e,n,l,p,_){super(e,l,p,_??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return Lf(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class s0 extends kd{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,l,p,_,b,T){super(e,l,p,T),this.indexBuffer=n,this.symbolOffsetBuffer=_,this.symbolTableBuffer=b,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(l,p,_){const b=[],T=new Array(p.length).fill(0);for(let R=1;R<p.length;R++)T[R]=T[R-1]+p[R-1];for(let R=0;R<_.length;R++)if(_[R]===255)b.push(_[++R]);else{const B=p[_[R]],G=T[_[R]];for(let X=0;X<B;X++)b.push(l[G+X])}return new Uint8Array(b)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return Lf(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let l=e[0];for(let p=1;p<e.length;p++){const _=e[p];n[p-1]=_-l,l=_}return n}}function qu(i,e,n,l,p,_){return n.type==="scalarType"?(function(b,T,R,B,G,X){let $=null,K=0;if(b===0)return null;if(X.nullable){const re=Qa(T,R);K=re.numValues;const ae=R.get(),ye=zf(T,K,R);R.set(ae+re.byteLength),$=new oc(ye,re.numValues)}const ie=$??B;switch(G.physicalType){case 4:case 3:return(function(re,ae,ye,Fe,be){const Se=Qa(re,ae),Ge=uu(Se,be,re,ae),Ke=Fe.physicalType===3;if(Ge===qs.FLAT){const kt=Dl(be)?fg(re,ae,Se,Ke,be):Ka(re,ae,Se,Ke);return new $p(ye.name,kt,be)}if(Ge===qs.SEQUENCE){const kt=hg(re,ae,Se);return new ag(ye.name,kt[0],kt[1],Se.numRleValues)}{const kt=ug(re,ae,Se,Ke);return new og(ye.name,kt,be)}})(T,R,X,G,ie);case 9:return(function(re,ae,ye,Fe,be){let Se=null,Ge=null,Ke=null,kt=null,en=null,Xt=null,cn=null,Tn=null;for(let dn=0;dn<Fe;dn++){const Qt=Qa(ae,ye);if(Qt.byteLength!==0)switch(Qt.physicalStreamType){case Ia.PRESENT:{const Ut=zf(ae,Qt.numValues,ye);Xt=new oc(Ut,Qt.numValues);break}case Ia.OFFSET:Ge=be!=null||Xt!=null?fg(ae,ye,Qt,!1,be??Xt):Ka(ae,ye,Qt,!1);break;case Ia.LENGTH:{const Ut=Hu(ae,ye,Qt);$a.DICTIONARY===Qt.logicalStreamType.lengthType?Se=Ut:$a.SYMBOL===Qt.logicalStreamType.lengthType?kt=Ut:cn=Ut;break}case Ia.DATA:{const Ut=ae.subarray(ye.get(),ye.get()+Qt.byteLength);ye.add(Qt.byteLength);const Vn=Qt.logicalStreamType.dictionaryType;ac.FSST===Vn?en=Ut:ac.SINGLE===Vn||ac.SHARED===Vn?Ke=Ut:ac.NONE===Vn&&(Tn=Ut);break}}}return(function(dn,Qt,Ut,Vn,zn,Yn,Pn){return Qt?new s0(dn,Ut,Vn,zn,Yn,Qt,Pn):null})(re,en,Ge,Se,Ke,kt,be??Xt)??(function(dn,Qt,Ut,Vn,zn){return Qt?zn?new Dh(dn,Ut,Vn,Qt,zn):new Dh(dn,Ut,Vn,Qt):null})(re,Ke,Ge,Se,be??Xt)??(function(dn,Qt,Ut,Vn,zn){if(!Qt||!Ut)return null;if(Vn)return zn?new Dh(dn,Vn,Qt,Ut,zn):new Dh(dn,Vn,Qt,Ut);if(zn&&zn.size()!==Qt.length-1){const Yn=new Int32Array(zn.size());let Pn=0;for(let pi=0;pi<zn.size();pi++)Yn[pi]=zn.get(pi)?Pn++:0;return new Dh(dn,Yn,Qt,Ut,zn)}return zn?new r0(dn,Qt,Ut,zn):new r0(dn,Qt,Ut)})(re,cn,Tn,Ge,be??Xt)})(X.name,T,R,X.nullable?b-1:b,$);case 0:return(function(re,ae,ye,Fe,be){const Se=Qa(re,ae),Ge=Se.numValues,Ke=ae.get(),kt=Dl(be)?(function(Xt,cn,Tn,dn){const Qt=Pm(Xt,Math.ceil(cn/8),Tn),Ut=new oc(Qt,cn),Vn=dn.size(),zn=new oc(new Uint8Array(Vn),Vn);let Yn=0;for(let Pn=0;Pn<dn.size();Pn++){const pi=!!dn.get(Pn)&&Ut.get(Yn++);zn.set(Pn,pi)}return zn.getBuffer()})(re,Ge,ae,be):zf(re,Ge,ae);ae.set(Ke+Se.byteLength);const en=new oc(kt,Ge);return new Dm(ye.name,en,be)})(T,R,X,0,ie);case 6:case 5:return(function(re,ae,ye,Fe,be){const Se=Qa(re,ae),Ge=uu(Se,Fe,re,ae),Ke=be.physicalType===5;if(Ge===qs.FLAT){const kt=Dl(Fe)?(function(en,Xt,cn,Tn,dn){return(function(Qt,Ut,Vn,zn){switch(Ut.logicalLevelTechnique1){case qi.DELTA:return Ut.logicalLevelTechnique2===qi.RLE&&(Qt=Tm(Qt,Ut.runs,Ut.numRleValues)),(function(Yn,Pn){const pi=new BigInt64Array(Yn.size());let yr=0;Yn.get(0)?(pi[0]=Yn.get(0)?Pn[0]>>1n^-(1n&Pn[0]):0n,yr=1):pi[0]=0n;let Qi=1;for(;Qi!=pi.length;++Qi)pi[Qi]=Yn.get(Qi)?pi[Qi-1]+(Pn[yr]>>1n^-(1n&Pn[yr++])):pi[Qi-1];return pi})(zn,Qt);case qi.RLE:return(function(Yn,Pn,pi,yr){const Qi=Pn;return pi?(function(ws,Ja,da){const As=new BigInt64Array(ws.size());let ms=0;for(let zr=0;zr<da;zr++){const Ls=Number(Ja[zr]);let Zs=Ja[zr+da];Zs=Zs>>1n^-(1n&Zs);for(let cs=ms;cs<ms+Ls;cs++)ws.get(cs)?As[cs]=Zs:(As[cs]=0n,ms++);ms+=Ls}return As})(yr,Yn,Qi.runs):(function(ws,Ja,da){const As=new BigInt64Array(ws.size());let ms=0;for(let zr=0;zr<da;zr++){const Ls=Number(Ja[zr]),Zs=Ja[zr+da];for(let cs=ms;cs<ms+Ls;cs++)ws.get(cs)?As[cs]=Zs:(As[cs]=0n,ms++);ms+=Ls}return As})(yr,Yn,Qi.runs)})(Qt,Ut,Vn,zn);case qi.NONE:return Qt=Vn?(function(Yn,Pn){const pi=new BigInt64Array(Yn.size());let yr=0,Qi=0;for(;Qi!=pi.length;++Qi)if(Yn.get(Qi)){const ws=Pn[yr++];pi[Qi]=ws>>1n^-(1n&ws)}else pi[Qi]=0n;return pi})(zn,Qt):(function(Yn,Pn){const pi=new BigInt64Array(Yn.size());let yr=0,Qi=0;for(;Qi!=pi.length;++Qi)pi[Qi]=Yn.get(Qi)?Pn[yr++]:0n;return pi})(zn,Qt),Qt;default:throw new Error("The specified Logical level technique is not supported")}})(Tf(en,Xt,cn.numValues),cn,Tn,dn)})(re,ae,Se,Ke,Fe):Td(re,ae,Se,Ke);return new Id(ye.name,kt,Fe)}if(Ge===qs.SEQUENCE){const kt=Nh(re,ae,Se);return new pg(ye.name,kt[0],kt[1],Se.numRleValues)}{const kt=dg(re,ae,Se,Ke);return new Of(ye.name,kt,Fe)}})(T,R,X,ie,G);case 7:return(function(re,ae,ye,Fe){const be=Qa(re,ae),Se=Dl(Fe)?(function(Ge,Ke,kt,en){const Xt=Ke.get(),cn=Xt+en*Float32Array.BYTES_PER_ELEMENT,Tn=new Uint8Array(Ge.subarray(Xt,cn)).buffer,dn=new Float32Array(Tn);Ke.set(cn);const Qt=kt.size(),Ut=new Float32Array(Qt);let Vn=0;for(let zn=0;zn<Qt;zn++)Ut[zn]=kt.get(zn)?dn[Vn++]:0;return Ut})(re,ae,Fe,be.numValues):(function(Ge,Ke,kt){const en=Ke.get(),Xt=en+kt*Float32Array.BYTES_PER_ELEMENT,cn=new Uint8Array(Ge.subarray(en,Xt)).buffer,Tn=new Float32Array(cn);return Ke.set(Xt),Tn})(re,ae,be.numValues);return new Rm(ye.name,Se,Fe)})(T,R,X,ie);case 8:return(function(re,ae,ye,Fe){const be=Qa(re,ae),Se=Dl(Fe)?(function(Ge,Ke,kt,en){const Xt=Ke.get(),cn=Xt+en*Float64Array.BYTES_PER_ELEMENT,Tn=new Uint8Array(Ge.subarray(Xt,cn)).buffer,dn=new Float64Array(Tn);Ke.set(cn);const Qt=kt.size(),Ut=new Float64Array(Qt);let Vn=0;for(let zn=0;zn<Qt;zn++)Ut[zn]=kt.get(zn)?dn[Vn++]:0;return Ut})(re,ae,Fe,be.numValues):(function(Ge,Ke,kt){const en=Ke.get(),Xt=en+kt*Float64Array.BYTES_PER_ELEMENT,cn=new Uint8Array(Ge.subarray(en,Xt)).buffer,Tn=new Float64Array(cn);return Ke.set(Xt),Tn})(re,ae,be.numValues);return new rg(ye.name,Se,Fe)})(T,R,X,ie);default:throw new Error(`The specified data type for the field is currently not supported: ${G}`)}})(l,i,e,p,n.scalarType,n):l!=1?null:(function(b,T,R,B){let G=null,X=null,$=null,K=null,ie=!1;for(;!ie;){const Fe=Qa(b,T);switch(Fe.physicalStreamType){case Ia.LENGTH:$a.DICTIONARY===Fe.logicalStreamType.lengthType?G=Hu(b,T,Fe):$=Hu(b,T,Fe);break;case Ia.DATA:ac.SINGLE===Fe.logicalStreamType.dictionaryType||ac.SHARED===Fe.logicalStreamType.dictionaryType?(X=b.subarray(T.get(),T.get()+Fe.byteLength),ie=!0):K=b.subarray(T.get(),T.get()+Fe.byteLength),T.add(Fe.byteLength)}}const re=R.complexType.children,ae=[];let ye=0;for(const Fe of re){const be=ha(b,T,1)[0];if(be==0)continue;const Se=`${R.name}${Fe.name==="default"?"":":"+Fe.name}`;if(be!==2||Fe.type!=="scalarField"||Fe.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Ge=Qa(b,T),Ke=zf(b,Ge.numValues,T),kt=Qa(b,T),en=kt.decompressedCount!==B?fg(b,T,kt,!1,new oc(Ke,Ge.numValues)):Ka(b,T,kt,!1);ae[ye++]=K?new s0(Se,en,G,X,$,K,new oc(Ke,Ge.numValues)):new Dh(Se,en,G,X,new oc(Ke,Ge.numValues))}return ae})(i,e,n,p)}function Dl(i){return i instanceof oc}function Zu(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Bf=new TextDecoder;function Nd(i,e){const n=ha(i,e,1)[0];if(n===0)return"";const l=e.get(),p=i.subarray(l,l+n);return e.add(n),Bf.decode(p)}function du(i,e){const n=ha(i,e,1)[0]>>>0,l=!!(4&n),p=!!(2&n),_=ha(i,e,1)[0]>>>0,b={};if(1&n&&(b.nullable=!0),p){const T={};if(l?(T.type="logicalType",T.logicalType=_):(T.type="physicalType",T.physicalType=_),8&n){const R=ha(i,e,1)[0]>>>0;T.children=new Array(R);for(let B=0;B<R;B++)T.children[B]=du(i,e)}b.type="complexField",b.complexField=T}else{const T={};l?(T.type="logicalType",T.logicalType=_):(T.type="physicalType",T.physicalType=_),b.type="scalarField",b.scalarField=T}return b}function j1(i,e){const n=ha(i,e,1)[0]>>>0,l=(function(p){switch(p){case 0:case 1:case 2:case 3:{const _={};_.nullable=!!(1&p),_.columnScope=0;const b={};return b.physicalType=p>1?6:4,b.type="physicalType",_.scalarType=b,_.type="scalarType",_}case 4:{const _={nullable:!1,columnScope:0},b={type:"physicalType",physicalType:0};return _.type="complexType",_.complexType=b,_}case 30:{const _={nullable:!1,columnScope:0},b={type:"physicalType",physicalType:1};return _.type="complexType",_.complexType=b,_}default:return(function(_){let b=null;switch(_){case 10:case 11:b=0;break;case 12:case 13:b=1;break;case 14:case 15:b=2;break;case 16:case 17:b=3;break;case 18:case 19:b=4;break;case 20:case 21:b=5;break;case 22:case 23:b=6;break;case 24:case 25:b=7;break;case 26:case 27:b=8;break;case 28:case 29:b=9;break;default:return null}const T={};T.nullable=!!(1&_),T.columnScope=0;const R={type:"physicalType"};return R.physicalType=b,T.type="scalarType",T.scalarType=R,T})(p)}})(n);if(!l)throw new Error(`Unsupported column type code: ${n}`);if((function(p){return p>=10})(n)?l.name=Nd(i,e):n>=0&&n<=3?l.name="id":n===4&&(l.name="geometry"),(function(p){return p===30})(n)){const p=ha(i,e,1)[0]>>>0,_=l.complexType;_.children=new Array(p);for(let b=0;b<p;b++)_.children[b]=du(i,e)}return l}function Om(i,e){const n={featureTables:[]},l={};l.name=Nd(i,e);const p=ha(i,e,1)[0]>>>0,_=ha(i,e,1)[0]>>>0;l.columns=new Array(_);for(let b=0;b<_;b++)l.columns[b]=j1(i,e);return n.featureTables.push(l),[n,p]}function Ff(i,e,n,l,p,_,b=!1){const T=e.scalarType.physicalType,R=uu(p,_,i,n);if(T===4)switch(R){case qs.FLAT:{const B=Ka(i,n,p,!1);return new $p(l,B,_)}case qs.SEQUENCE:{const B=hg(i,n,p);return new ag(l,B[0],B[1],p.numRleValues)}case qs.CONST:{const B=ug(i,n,p,!1);return new og(l,B,_)}}else switch(R){case qs.FLAT:{if(b){const G=(function(X,$,K,ie){const re=(function(ae,ye,Fe){const be=new Float64Array(ye);for(let Se=0;Se<ye;Se++)be[Se]=Cm(ae,Fe);return be})(X,K.numValues,$);return(function(ae,ye,Fe){switch(ye.logicalLevelTechnique1){case qi.DELTA:return ye.logicalLevelTechnique2===qi.RLE&&(ae=Im(ae,ye.runs,ye.numRleValues)),(function(be){be[0]=be[0]%2==1?(be[0]+1)/-2:be[0]/2;const Se=be.length/4*4;let Ge=1;if(Se>=4)for(;Ge<Se-4;Ge+=4){const Ke=be[Ge],kt=be[Ge+1],en=be[Ge+2],Xt=be[Ge+3];be[Ge]=(Ke%2==1?(Ke+1)/-2:Ke/2)+be[Ge-1],be[Ge+1]=(kt%2==1?(kt+1)/-2:kt/2)+be[Ge],be[Ge+2]=(en%2==1?(en+1)/-2:en/2)+be[Ge+1],be[Ge+3]=(Xt%2==1?(Xt+1)/-2:Xt/2)+be[Ge+2]}for(;Ge!=be.length;++Ge)be[Ge]=(be[Ge]%2==1?(be[Ge]+1)/-2:be[Ge]/2)+be[Ge-1]})(ae),ae;case qi.RLE:return(function(be,Se,Ge){return Im(be,Se.runs,Se.numRleValues)})(ae,ye);case qi.NONE:return ae;default:throw new Error(`The specified Logical level technique is not supported: ${ye.logicalLevelTechnique1}`)}})(re,K)})(i,n,p);return new rg(l,G,_)}const B=Td(i,n,p,!1);return new Id(l,B,_)}case qs.SEQUENCE:{const B=Nh(i,n,p);return new pg(l,B[0],B[1],p.numRleValues)}case qs.CONST:{const B=dg(i,n,p,!1);return new Of(l,B,_)}}throw new Error("Vector type not supported for id column.")}class U1{constructor(e,n){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case ua.POINT:case ua.MULTIPOINT:this.type=1;break;case ua.LINESTRING:case ua.MULTILINESTRING:this.type=2;break;case ua.POLYGON:case ua.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const l=[];for(const p of n)l.push(new U(p.x,p.y));e.push(l)}return e}}class zm{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new U1(this.features[e],this.extent)}}class jf{constructor(e){this.layers={};const n=(function(l,p,_=!0){const b=new Sm(0),T=[];for(;b.get()<l.length;){const R=ha(l,b,1)[0]>>>0,B=b.get()+R;if(B>l.length)throw new Error(`Block overruns tile: ${B} > ${l.length}`);if(ha(l,b,1)[0]>>>0!=1){b.set(B);continue}const G=Om(l,b),X=G[1],$=G[0].featureTables[0];let K=null,ie=null;const re=[];let ae=0;for(const Fe of $.columns){const be=Fe.name;if(be==="id"){let Se=null;if(Fe.nullable){const Ke=Qa(l,b),kt=b.get(),en=zf(l,Ke.numValues,b);b.set(kt+Ke.byteLength),Se=new oc(en,Ke.numValues)}const Ge=Qa(l,b);ae=Ge.decompressedCount,K=Ff(l,Fe,b,be,Ge,Se??ae,_)}else if(be==="geometry"){const Se=ha(l,b,1)[0];if(ae===0){const Ge=b.get();ae=Qa(l,b).decompressedCount,b.set(Ge)}ie=Nm(l,Se,b,ae)}else{const Se=Zu(Fe)?ha(l,b,1)[0]:1;if(Se===0&&Fe.type==="scalarType")continue;const Ge=qu(l,b,Fe,Se,ae);if(Ge)if(Array.isArray(Ge))for(const Ke of Ge)re.push(Ke);else re.push(Ge)}}const ye=new Uu($.name,ie,K,re,X);T.push(ye),b.set(B)}return T})(new Uint8Array(e));this.layers=n.reduce(((l,p)=>Object.assign(Object.assign({},l),{[p.name]:new zm(p)})),{})}}class Lm{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of n){const p=[];for(const _ of l)p.push(new U(_[0],_[1]));e.push(p)}return e}}const Uf="_geojsonTileLayer";function a0(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let _=0;_<i.length;_++)n.feature=i.feature(_),e.writeMessage(2,o0,n);const l=n.keys;for(const _ of l)e.writeStringField(3,_);const p=n.values;for(const _ of p)e.writeMessage(4,l0,_)}function o0(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,Bm,i),e.writeVarintField(3,n.type),e.writeMessage(4,vg,n)}function Bm(i,e){for(const n in i.feature?.properties){let l=i.feature.properties[n],p=i.keycache[n];if(l==null)continue;p===void 0&&(i.keys.push(n),p=i.keys.length-1,i.keycache[n]=p),e.writeVarint(p),typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"&&(l=JSON.stringify(l));const _=typeof l+":"+l;let b=i.valuecache[_];b===void 0&&(i.values.push(l),b=i.values.length-1,i.valuecache[_]=b),e.writeVarint(b)}}function Xu(i,e){return(e<<3)+(7&i)}function bg(i){return i<<1^i>>31}function vg(i,e){const n=i.loadGeometry(),l=i.type;let p=0,_=0;for(const b of n){let T=1;l===1&&(T=b.length),e.writeVarint(Xu(1,T));const R=l===3?b.length-1:b.length;for(let B=0;B<R;B++){B===1&&l!==1&&e.writeVarint(Xu(2,R-1));const G=b[B].x-p,X=b[B].y-_;e.writeVarint(bg(G)),e.writeVarint(bg(X)),p+=G,_+=X}i.type===3&&e.writeVarint(Xu(7,1))}}function l0(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class wg{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wc(zt,16,0),this.grid3D=new wc(zt,16,0),this.featureIndexArray=new fe,this.promoteId=n}insert(e,n,l,p,_,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,_);const R=b?this.grid3D:this.grid;for(let B=0;B<n.length;B++){const G=n[B],X=[1/0,1/0,-1/0,-1/0];for(let $=0;$<G.length;$++){const K=G[$];X[0]=Math.min(X[0],K.x),X[1]=Math.min(X[1],K.y),X[2]=Math.max(X[2],K.x),X[3]=Math.max(X[3],K.y)}X[0]<zt&&X[1]<zt&&X[2]>=0&&X[3]>=0&&R.insert(T,X[0],X[1],X[2],X[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new hr(new Pp(this.rawTileData)).layers:new jf(this.rawTileData).layers,this.sourceLayerCoder=new ig(this.vtLayers?Object.keys(this.vtLayers).sort():[Uf])),this.vtLayers}query(e,n,l,p){this.loadVTLayers();const _=e.params,b=zt/e.tileSize/e.scale,T=Ga(_.filter,_.globalState),R=e.queryGeometry,B=e.queryPadding*b,G=Fu.fromPoints(R),X=this.grid.query(G.minX-B,G.minY-B,G.maxX+B,G.maxY+B),$=Fu.fromPoints(e.cameraQueryGeometry).expandBy(B),K=this.grid3D.query($.minX,$.minY,$.maxX,$.maxY,((ae,ye,Fe,be)=>(function(Se,Ge,Ke,kt,en){for(const cn of Se)if(Ge<=cn.x&&Ke<=cn.y&&kt>=cn.x&&en>=cn.y)return!0;const Xt=[new U(Ge,Ke),new U(Ge,en),new U(kt,en),new U(kt,Ke)];if(Se.length>2){for(const cn of Xt)if(Tc(Se,cn))return!0}for(let cn=0;cn<Se.length-1;cn++)if(Gg(Se[cn],Se[cn+1],Xt))return!0;return!1})(e.cameraQueryGeometry,ae-B,ye-B,Fe+B,be+B)));for(const ae of K)X.push(ae);X.sort(c0);const ie={};let re;for(let ae=0;ae<X.length;ae++){const ye=X[ae];if(ye===re)continue;re=ye;const Fe=this.featureIndexArray.get(ye);let be=null;this.loadMatchingFeature(ie,Fe.bucketIndex,Fe.sourceLayerIndex,Fe.featureIndex,T,_.layers,_.availableImages,n,l,p,((Se,Ge,Ke)=>(be||(be=tc(Se)),Ge.queryIntersectsFeature({queryGeometry:R,feature:Se,featureState:Ke,geometry:be,zoom:this.z,transform:e.transform,pixelsToTileUnits:b,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return ie}loadMatchingFeature(e,n,l,p,_,b,T,R,B,G,X){const $=this.bucketLayerIDs[n];if(b&&!$.some((ae=>b.has(ae))))return;const K=this.sourceLayerCoder.decode(l),ie=this.vtLayers[K].feature(p);if(_.needGeometry){const ae=tl(ie,!0);if(!_.filter(new Ir(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!_.filter(new Ir(this.tileID.overscaledZ),ie))return;const re=this.getId(ie,K);for(let ae=0;ae<$.length;ae++){const ye=$[ae];if(b&&!b.has(ye))continue;const Fe=R[ye];if(!Fe)continue;let be={};re&&G&&(be=G.getState(Fe.sourceLayer||Uf,re));const Se=an({},B[ye]);Se.paint=Fm(Se.paint,Fe.paint,ie,be,T),Se.layout=Fm(Se.layout,Fe.layout,ie,be,T);const Ge=!X||X(ie,Fe,be);if(!Ge)continue;const Ke=new Wp(ie,this.z,this.x,this.y,re);Ke.layer=Se;let kt=e[ye];kt===void 0&&(kt=e[ye]=[]),kt.push({featureIndex:p,feature:Ke,intersectionZ:Ge})}}lookupSymbolFeatures(e,n,l,p,_,b,T,R){const B={};this.loadVTLayers();const G=Ga(_.filterSpec,_.globalState);for(const X of e)this.loadMatchingFeature(B,l,p,X,G,b,T,R,n);return B}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){var l;let p=e.id;return this.promoteId&&(p=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(p=Number(e.properties.cluster_id))),p}}function Fm(i,e,n,l,p){return Nn(i,((_,b)=>{const T=e instanceof Wc?e.get(b):null;return T&&T.evaluate?T.evaluate(n,l,p):T}))}function c0(i,e){return e-i}function r(i,e,n,l,p){const _=[];for(let b=0;b<i.length;b++){const T=i[b];let R;for(let B=0;B<T.length-1;B++){let G=T[B],X=T[B+1];G.x<e&&X.x<e||(G.x<e?G=new U(e,G.y+(e-G.x)/(X.x-G.x)*(X.y-G.y))._round():X.x<e&&(X=new U(e,G.y+(e-G.x)/(X.x-G.x)*(X.y-G.y))._round()),G.y<n&&X.y<n||(G.y<n?G=new U(G.x+(n-G.y)/(X.y-G.y)*(X.x-G.x),n)._round():X.y<n&&(X=new U(G.x+(n-G.y)/(X.y-G.y)*(X.x-G.x),n)._round()),G.x>=l&&X.x>=l||(G.x>=l?G=new U(l,G.y+(l-G.x)/(X.x-G.x)*(X.y-G.y))._round():X.x>=l&&(X=new U(l,G.y+(l-G.x)/(X.x-G.x)*(X.y-G.y))._round()),G.y>=p&&X.y>=p||(G.y>=p?G=new U(G.x+(p-G.y)/(X.y-G.y)*(X.x-G.x),p)._round():X.y>=p&&(X=new U(G.x+(p-G.y)/(X.y-G.y)*(X.x-G.x),p)._round()),R&&G.equals(R[R.length-1])||(R=[G],_.push(R)),R.push(X)))))}}return _}function o(i,e,n,l,p){switch(e){case 1:return(function(_,b,T,R){const B=[];for(const G of _)for(const X of G){const $=R===0?X.x:X.y;$>=b&&$<=T&&B.push([X])}return B})(i,n,l,p);case 2:return E(i,n,l,p,!1);case 3:return E(i,n,l,p,!0)}return[]}function m(i,e,n,l,p){const _=l===0?L:V;let b=[];const T=[];for(let G=0;G<i.length-1;G++){const X=i[G],$=i[G+1],K=l===0?X.x:X.y,ie=l===0?$.x:$.y;let re=!1;K<e?ie>e&&b.push(_(X,$,e)):K>n?ie<n&&b.push(_(X,$,n)):b.push(X),ie<e&&K>=e&&(b.push(_(X,$,e)),re=!0),ie>n&&K<=n&&(b.push(_(X,$,n)),re=!0),!p&&re&&(T.push(b),b=[])}const R=i.length-1,B=l===0?i[R].x:i[R].y;return B>=e&&B<=n&&b.push(i[R]),p&&b.length>0&&!b[0].equals(b[b.length-1])&&b.push(new U(b[0].x,b[0].y)),b.length>0&&T.push(b),T}function E(i,e,n,l,p){const _=[];for(const b of i){const T=m(b,e,n,l,p);T.length>0&&_.push(...T)}return _}function L(i,e,n){return new U(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function V(i,e,n){return new U(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}On("FeatureIndex",wg,{omit:["rawTileData","sourceLayerCoder"]});class ne extends U{constructor(e,n,l,p){super(e,n),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new ne(this.x,this.y,this.angle,this.segment)}}function Ae(i,e,n,l,p){if(e.segment===void 0||n===0)return!0;let _=e,b=e.segment+1,T=0;for(;T>-n/2;){if(b--,b<0)return!1;T-=i[b].dist(_),_=i[b]}T+=i[b].dist(i[b+1]),b++;const R=[];let B=0;for(;T<n/2;){const G=i[b],X=i[b+1];if(!X)return!1;let $=i[b-1].angleTo(G)-G.angleTo(X);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:T,angleDelta:$}),B+=$;T-R[0].distance>l;)B-=R.shift().angleDelta;if(B>p)return!1;b++,T+=G.dist(X)}return!0}function lt(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function Vt(i,e,n){return i?.6*e*n:0}function rn(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function pn(i,e,n,l,p,_){const b=Vt(n,p,_),T=rn(n,l)*_;let R=0;const B=lt(i)/2;for(let G=0;G<i.length-1;G++){const X=i[G],$=i[G+1],K=X.dist($);if(R+K>B){const ie=(B-R)/K,re=rr.number(X.x,$.x,ie),ae=rr.number(X.y,$.y,ie),ye=new ne(re,ae,$.angleTo(X),G);return ye._round(),!b||Ae(i,ye,T,b,e)?ye:void 0}R+=K}}function Ht(i,e,n,l,p,_,b,T,R){const B=Vt(l,_,b),G=rn(l,p),X=G*b,$=i[0].x===0||i[0].x===R||i[0].y===0||i[0].y===R;return e-X<e/4&&(e=X+e/4),Yt(i,$?e/2*T%e:(G/2+2*_)*b*T%e,e,B,n,X,$,!1,R)}function Yt(i,e,n,l,p,_,b,T,R){const B=_/2,G=lt(i);let X=0,$=e-n,K=[];for(let ie=0;ie<i.length-1;ie++){const re=i[ie],ae=i[ie+1],ye=re.dist(ae),Fe=ae.angleTo(re);for(;$+n<X+ye;){$+=n;const be=($-X)/ye,Se=rr.number(re.x,ae.x,be),Ge=rr.number(re.y,ae.y,be);if(Se>=0&&Se<R&&Ge>=0&&Ge<R&&$-B>=0&&$+B<=G){const Ke=new ne(Se,Ge,Fe,ie);Ke._round(),l&&!Ae(i,Ke,_,l,p)||K.push(Ke)}}X+=ye}return T||K.length||b||(K=Yt(i,X/2,n,l,p,_,b,!0,R)),K}function di(i,e,n,l){const p=[],_=i.image,b=_.pixelRatio,T=_.paddedRect.w-2,R=_.paddedRect.h-2;let B={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const G=_.stretchX||[[0,T]],X=_.stretchY||[[0,R]],$=(Ut,Vn)=>Ut+Vn[1]-Vn[0],K=G.reduce($,0),ie=X.reduce($,0),re=T-K,ae=R-ie;let ye=0,Fe=K,be=0,Se=ie,Ge=0,Ke=re,kt=0,en=ae;if(_.content&&l){const Ut=_.content,Vn=Ut[2]-Ut[0],zn=Ut[3]-Ut[1];(_.textFitWidth||_.textFitHeight)&&(B=cu(i)),ye=Ii(G,0,Ut[0]),be=Ii(X,0,Ut[1]),Fe=Ii(G,Ut[0],Ut[2]),Se=Ii(X,Ut[1],Ut[3]),Ge=Ut[0]-ye,kt=Ut[1]-be,Ke=Vn-Fe,en=zn-Se}const Xt=B.x1,cn=B.y1,Tn=B.x2-Xt,dn=B.y2-cn,Qt=(Ut,Vn,zn,Yn)=>{const Pn=Tt(Ut.stretch-ye,Fe,Tn,Xt),pi=ft(Ut.fixed-Ge,Ke,Ut.stretch,K),yr=Tt(Vn.stretch-be,Se,dn,cn),Qi=ft(Vn.fixed-kt,en,Vn.stretch,ie),ws=Tt(zn.stretch-ye,Fe,Tn,Xt),Ja=ft(zn.fixed-Ge,Ke,zn.stretch,K),da=Tt(Yn.stretch-be,Se,dn,cn),As=ft(Yn.fixed-kt,en,Yn.stretch,ie),ms=new U(Pn,yr),zr=new U(ws,yr),Ls=new U(ws,da),Zs=new U(Pn,da),cs=new U(pi/b,Qi/b),sl=new U(Ja/b,As/b),eo=e*Math.PI/180;if(eo){const ka=Math.sin(eo),ks=Math.cos(eo),fa=[ks,-ka,ka,ks];ms._matMult(fa),zr._matMult(fa),Zs._matMult(fa),Ls._matMult(fa)}const al=Ut.stretch+Ut.fixed,Rc=Vn.stretch+Vn.fixed;return{tl:ms,tr:zr,bl:Zs,br:Ls,tex:{x:_.paddedRect.x+1+al,y:_.paddedRect.y+1+Rc,w:zn.stretch+zn.fixed-al,h:Yn.stretch+Yn.fixed-Rc},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cs,pixelOffsetBR:sl,minFontScaleX:Ke/b/Tn,minFontScaleY:en/b/dn,isSDF:n}};if(l&&(_.stretchX||_.stretchY)){const Ut=Yr(G,re,K),Vn=Yr(X,ae,ie);for(let zn=0;zn<Ut.length-1;zn++){const Yn=Ut[zn],Pn=Ut[zn+1];for(let pi=0;pi<Vn.length-1;pi++)p.push(Qt(Yn,Vn[pi],Pn,Vn[pi+1]))}}else p.push(Qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:R+1}));return p}function Ii(i,e,n){let l=0;for(const p of i)l+=Math.max(e,Math.min(n,p[1]))-Math.max(e,Math.min(n,p[0]));return l}function Yr(i,e,n){const l=[{fixed:-1,stretch:0}];for(const[p,_]of i){const b=l[l.length-1];l.push({fixed:p-b.stretch,stretch:b.stretch}),l.push({fixed:p-b.stretch,stretch:b.stretch+(_-p)})}return l.push({fixed:e+1,stretch:n}),l}function Tt(i,e,n,l){return i/e*n+l}function ft(i,e,n,l){return i-e*n/l}On("Anchor",ne);class Ft{constructor(e,n,l,p,_,b,T,R,B,G){var X;if(this.boxStartIndex=e.length,B){let $=b.top,K=b.bottom;const ie=b.collisionPadding;ie&&($-=ie[1],K+=ie[3]);let re=K-$;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{const $=!((X=b.image)===null||X===void 0)&&X.content&&(b.image.textFitWidth||b.image.textFitHeight)?cu(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};$.y1=$.y1*T-R[0],$.y2=$.y2*T+R[2],$.x1=$.x1*T-R[3],$.x2=$.x2*T+R[1];const K=b.collisionPadding;if(K&&($.x1-=K[0]*T,$.y1-=K[1]*T,$.x2+=K[2]*T,$.y2+=K[3]*T),G){const ie=new U($.x1,$.y1),re=new U($.x2,$.y1),ae=new U($.x1,$.y2),ye=new U($.x2,$.y2),Fe=G*Math.PI/180;ie._rotate(Fe),re._rotate(Fe),ae._rotate(Fe),ye._rotate(Fe),$.x1=Math.min(ie.x,re.x,ae.x,ye.x),$.x2=Math.max(ie.x,re.x,ae.x,ye.x),$.y1=Math.min(ie.y,re.y,ae.y,ye.y),$.y2=Math.max(ie.y,re.y,ae.y,ye.y)}e.emplaceBack(n.x,n.y,$.x1,$.y1,$.x2,$.y2,l,p,_)}this.boxEndIndex=e.length}}class hn{constructor(e=[],n=(l,p)=>l<p?-1:l>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,p=n[e];for(;e>0;){const _=e-1>>1,b=n[_];if(l(p,b)>=0)break;n[e]=b,e=_}n[e]=p}_down(e){const{data:n,compare:l}=this,p=this.length>>1,_=n[e];for(;e<p;){let b=1+(e<<1);const T=b+1;if(T<this.length&&l(n[T],n[b])<0&&(b=T),l(n[b],_)>=0)break;n[e]=n[b],e=b}n[e]=_}}function Ti(i,e=1,n=!1){const l=Fu.fromPoints(i[0]),p=Math.min(l.width(),l.height());let _=p/2;const b=new hn([],Or),{minX:T,minY:R,maxX:B,maxY:G}=l;if(p===0)return new U(T,R);for(let K=T;K<B;K+=p)for(let ie=R;ie<G;ie+=p)b.push(new fi(K+_,ie+_,_,i));let X=(function(K){let ie=0,re=0,ae=0;const ye=K[0];for(let Fe=0,be=ye.length,Se=be-1;Fe<be;Se=Fe++){const Ge=ye[Fe],Ke=ye[Se],kt=Ge.x*Ke.y-Ke.x*Ge.y;re+=(Ge.x+Ke.x)*kt,ae+=(Ge.y+Ke.y)*kt,ie+=3*kt}return new fi(re/ie,ae/ie,0,K)})(i),$=b.length;for(;b.length;){const K=b.pop();(K.d>X.d||!X.d)&&(X=K,n&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,$)),K.max-X.d<=e||(_=K.h/2,b.push(new fi(K.p.x-_,K.p.y-_,_,i)),b.push(new fi(K.p.x+_,K.p.y-_,_,i)),b.push(new fi(K.p.x-_,K.p.y+_,_,i)),b.push(new fi(K.p.x+_,K.p.y+_,_,i)),$+=4)}return n&&(console.log(`num probes: ${$}`),console.log(`best distance: ${X.d}`)),X.p}function Or(i,e){return e.max-i.max}function fi(i,e,n,l){this.p=new U(i,e),this.h=n,this.d=(function(p,_){let b=!1,T=1/0;for(let R=0;R<_.length;R++){const B=_[R];for(let G=0,X=B.length,$=X-1;G<X;$=G++){const K=B[G],ie=B[$];K.y>p.y!=ie.y>p.y&&p.x<(ie.x-K.x)*(p.y-K.y)/(ie.y-K.y)+K.x&&(b=!b),T=Math.min(T,S0(p,K,ie))}}return(b?1:-1)*Math.sqrt(T)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var Ai;N.aP=void 0,(Ai=N.aP||(N.aP={}))[Ai.center=1]="center",Ai[Ai.left=2]="left",Ai[Ai.right=3]="right",Ai[Ai.top=4]="top",Ai[Ai.bottom=5]="bottom",Ai[Ai["top-left"]=6]="top-left",Ai[Ai["top-right"]=7]="top-right",Ai[Ai["bottom-left"]=8]="bottom-left",Ai[Ai["bottom-right"]=9]="bottom-right";const or=Number.POSITIVE_INFINITY;function kr(i,e){return e[1]!==or?(function(n,l,p){let _=0,b=0;switch(l=Math.abs(l),p=Math.abs(p),n){case"top-right":case"top-left":case"top":b=p-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-p}switch(n){case"top-right":case"bottom-right":case"right":_=-l;break;case"top-left":case"bottom-left":case"left":_=l}return[_,b]})(i,e[0],e[1]):(function(n,l){let p=0,_=0;l<0&&(l=0);const b=l/Math.SQRT2;switch(n){case"top-right":case"top-left":_=b-7;break;case"bottom-right":case"bottom-left":_=7-b;break;case"bottom":_=7-l;break;case"top":_=l-7}switch(n){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=l;break;case"right":p=-l}return[p,_]})(i,e[0])}function fu(i,e,n){var l;const p=i.layout,_=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},n);if(_){const T=_.values,R=[];for(let B=0;B<T.length;B+=2){const G=R[B]=T[B],X=T[B+1].map(($=>$*ea));G.startsWith("top")?X[1]-=7:G.startsWith("bottom")&&(X[1]+=7),R[B+1]=X}return new ji(R)}const b=p.get("text-variable-anchor");if(b){let T;T=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(e,{},n)*ea,or]:p.get("text-offset").evaluate(e,{},n).map((B=>B*ea));const R=[];for(const B of b)R.push(B,kr(B,T));return new ji(R)}return null}function Ag(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function G2(i,e,n,l,p,_,b,T,R,B,G,X){let $=_.textMaxSize.evaluate(e,{});$===void 0&&($=b);const K=i.layers[0].layout,ie=K.get("icon-offset").evaluate(e,{},G),re=Rx(n.horizontal),ae=b/24,ye=i.tilePixelRatio*ae,Fe=i.tilePixelRatio*$/24,be=i.tilePixelRatio*T,Se=i.tilePixelRatio*K.get("symbol-spacing"),Ge=K.get("text-padding")*i.tilePixelRatio,Ke=(function(zn,Yn,Pn,pi=1){const yr=zn.get("icon-padding").evaluate(Yn,{},Pn),Qi=yr&&yr.values;return[Qi[0]*pi,Qi[1]*pi,Qi[2]*pi,Qi[3]*pi]})(K,e,G,i.tilePixelRatio),kt=K.get("text-max-angle")/180*Math.PI,en=K.get("text-rotation-alignment")!=="viewport"&&K.get("symbol-placement")!=="point",Xt=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",cn=K.get("symbol-placement"),Tn=Se/2,dn=K.get("icon-text-fit");let Qt;l&&dn!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Qt=rc(l,n.vertical,dn,K.get("icon-text-fit-padding"),ie,ae)),re&&(l=rc(l,re,dn,K.get("icon-text-fit-padding"),ie,ae)));const Ut=G?X.line.getGranularityForZoomLevel(G.z):1,Vn=(zn,Yn)=>{Yn.x<0||Yn.x>=zt||Yn.y<0||Yn.y>=zt||(function(Pn,pi,yr,Qi,ws,Ja,da,As,ms,zr,Ls,Zs,cs,sl,eo,al,Rc,ka,ks,fa,Bs,Na,Rh,pu,Cg){const Dd=Pn.addToLineVertexArray(pi,yr);let Vf,u0,h0,d0,Lx=0,Bx=0,Fx=0,jx=0,Y1=-1,$1=-1;const Ph={};let Ux=bs("");if(Pn.allowVerticalPlacement&&Qi.vertical){const bo=As.layout.get("text-rotate").evaluate(Bs,{},pu)+90;h0=new Ft(ms,pi,zr,Ls,Zs,Qi.vertical,cs,sl,eo,bo),da&&(d0=new Ft(ms,pi,zr,Ls,Zs,da,Rc,ka,eo,bo))}if(ws){const bo=As.layout.get("icon-rotate").evaluate(Bs,{}),lc=As.layout.get("icon-text-fit")!=="none",Gf=di(ws,bo,Rh,lc),mu=da?di(da,bo,Rh,lc):void 0;u0=new Ft(ms,pi,zr,Ls,Zs,ws,Rc,ka,!1,bo),Lx=4*Gf.length;const Hf=Pn.iconSizeData;let Wu=null;Hf.kind==="source"?(Wu=[il*As.layout.get("icon-size").evaluate(Bs,{})],Wu[0]>Lu&&ui(`${Pn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Hf.kind==="composite"&&(Wu=[il*Na.compositeIconSizes[0].evaluate(Bs,{},pu),il*Na.compositeIconSizes[1].evaluate(Bs,{},pu)],(Wu[0]>Lu||Wu[1]>Lu)&&ui(`${Pn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Pn.addSymbols(Pn.icon,Gf,Wu,fa,ks,Bs,N.az.none,pi,Dd.lineStartIndex,Dd.lineLength,-1,pu),Y1=Pn.icon.placedSymbolArray.length-1,mu&&(Bx=4*mu.length,Pn.addSymbols(Pn.icon,mu,Wu,fa,ks,Bs,N.az.vertical,pi,Dd.lineStartIndex,Dd.lineLength,-1,pu),$1=Pn.icon.placedSymbolArray.length-1)}const Vx=Object.keys(Qi.horizontal);for(const bo of Vx){const lc=Qi.horizontal[bo];if(!Vf){Ux=bs(lc.text);const mu=As.layout.get("text-rotate").evaluate(Bs,{},pu);Vf=new Ft(ms,pi,zr,Ls,Zs,lc,cs,sl,eo,mu)}const Gf=lc.positionedLines.length===1;if(Fx+=Dx(Pn,pi,lc,Ja,As,eo,Bs,al,Dd,Qi.vertical?N.az.horizontal:N.az.horizontalOnly,Gf?Vx:[bo],Ph,Y1,Na,pu),Gf)break}Qi.vertical&&(jx+=Dx(Pn,pi,Qi.vertical,Ja,As,eo,Bs,al,Dd,N.az.vertical,["vertical"],Ph,$1,Na,pu));const Z2=Vf?Vf.boxStartIndex:Pn.collisionBoxArray.length,X2=Vf?Vf.boxEndIndex:Pn.collisionBoxArray.length,W2=h0?h0.boxStartIndex:Pn.collisionBoxArray.length,Y2=h0?h0.boxEndIndex:Pn.collisionBoxArray.length,$2=u0?u0.boxStartIndex:Pn.collisionBoxArray.length,Q2=u0?u0.boxEndIndex:Pn.collisionBoxArray.length,K2=d0?d0.boxStartIndex:Pn.collisionBoxArray.length,J2=d0?d0.boxEndIndex:Pn.collisionBoxArray.length;let gu=-1;const Um=(bo,lc)=>bo&&bo.circleDiameter?Math.max(bo.circleDiameter,lc):lc;gu=Um(Vf,gu),gu=Um(h0,gu),gu=Um(u0,gu),gu=Um(d0,gu);const Gx=gu>-1?1:0;Gx&&(gu*=Cg/ea),Pn.glyphOffsetArray.length>=Ad.MAX_GLYPHS&&ui("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bs.sortKey!==void 0&&Pn.addToSortKeyRanges(Pn.symbolInstances.length,Bs.sortKey);const ew=fu(As,Bs,pu),[tw,nw]=(function(bo,lc){const Gf=bo.length,mu=lc?.values;if(mu?.length>0)for(let Hf=0;Hf<mu.length;Hf+=2){const Wu=mu[Hf+1];bo.emplaceBack(N.aP[mu[Hf]],Wu[0],Wu[1])}return[Gf,bo.length]})(Pn.textAnchorOffsets,ew);Pn.symbolInstances.emplaceBack(pi.x,pi.y,Ph.right>=0?Ph.right:-1,Ph.center>=0?Ph.center:-1,Ph.left>=0?Ph.left:-1,Ph.vertical||-1,Y1,$1,Ux,Z2,X2,W2,Y2,$2,Q2,K2,J2,zr,Fx,jx,Lx,Bx,Gx,0,cs,gu,tw,nw)})(i,Yn,zn,n,l,p,Qt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ye,[Ge,Ge,Ge,Ge],en,R,be,Ke,Xt,ie,e,_,B,G,b)};if(cn==="line")for(const zn of r(e.geometry,0,0,zt,zt)){const Yn=ru(zn,Ut),Pn=Ht(Yn,Se,kt,n.vertical||re,l,24,Fe,i.overscaling,zt);for(const pi of Pn)re&&H2(i,re.text,Tn,pi)||Vn(Yn,pi)}else if(cn==="line-center"){for(const zn of e.geometry)if(zn.length>1){const Yn=ru(zn,Ut),Pn=pn(Yn,kt,n.vertical||re,l,24,Fe);Pn&&Vn(Yn,Pn)}}else if(e.type==="Polygon")for(const zn of dl(e.geometry,0)){const Yn=Ti(zn,16);Vn(ru(zn[0],Ut,!0),new ne(Yn.x,Yn.y,0))}else if(e.type==="LineString")for(const zn of e.geometry){const Yn=ru(zn,Ut);Vn(Yn,new ne(Yn[0].x,Yn[0].y,0))}else if(e.type==="Point")for(const zn of e.geometry)for(const Yn of zn)Vn([Yn],new ne(Yn.x,Yn.y,0))}function Dx(i,e,n,l,p,_,b,T,R,B,G,X,$,K,ie){const re=(function(Fe,be,Se,Ge,Ke,kt,en,Xt){const cn=Ge.layout.get("text-rotate").evaluate(kt,{})*Math.PI/180,Tn=[];for(const dn of be.positionedLines)for(const Qt of dn.positionedGlyphs){if(!Qt.rect)continue;const Ut=Qt.rect||{};let Vn=4,zn=!0,Yn=1,Pn=0;const pi=(Ke||Xt)&&Qt.vertical,yr=Qt.metrics.advance*Qt.scale/2;if(Xt&&be.verticalizable&&(Pn=dn.lineOffset/2-(Qt.imageName?-(ea-Qt.metrics.width*Qt.scale)/2:(Qt.scale-1)*ea)),Qt.imageName){const ka=en[Qt.imageName];zn=ka.sdf,Yn=ka.pixelRatio,Vn=1/Yn}const Qi=Ke?[Qt.x+yr,Qt.y]:[0,0];let ws=Ke?[0,0]:[Qt.x+yr+Se[0],Qt.y+Se[1]-Pn],Ja=[0,0];pi&&(Ja=ws,ws=[0,0]);const da=Qt.metrics.isDoubleResolution?2:1,As=(Qt.metrics.left-Vn)*Qt.scale-yr+ws[0],ms=(-Qt.metrics.top-Vn)*Qt.scale+ws[1],zr=As+Ut.w/da*Qt.scale/Yn,Ls=ms+Ut.h/da*Qt.scale/Yn,Zs=new U(As,ms),cs=new U(zr,ms),sl=new U(As,Ls),eo=new U(zr,Ls);if(pi){const ka=new U(-yr,yr- -17),ks=-Math.PI/2,fa=12-yr,Bs=new U(22-fa,-(Qt.imageName?fa:0)),Na=new U(...Ja);Zs._rotateAround(ks,ka)._add(Bs)._add(Na),cs._rotateAround(ks,ka)._add(Bs)._add(Na),sl._rotateAround(ks,ka)._add(Bs)._add(Na),eo._rotateAround(ks,ka)._add(Bs)._add(Na)}if(cn){const ka=Math.sin(cn),ks=Math.cos(cn),fa=[ks,-ka,ka,ks];Zs._matMult(fa),cs._matMult(fa),sl._matMult(fa),eo._matMult(fa)}const al=new U(0,0),Rc=new U(0,0);Tn.push({tl:Zs,tr:cs,bl:sl,br:eo,tex:Ut,writingMode:be.writingMode,glyphOffset:Qi,sectionIndex:Qt.sectionIndex,isSDF:zn,pixelOffsetTL:al,pixelOffsetBR:Rc,minFontScaleX:0,minFontScaleY:0})}return Tn})(0,n,T,p,_,b,l,i.allowVerticalPlacement),ae=i.textSizeData;let ye=null;ae.kind==="source"?(ye=[il*p.layout.get("text-size").evaluate(b,{})],ye[0]>Lu&&ui(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(ye=[il*K.compositeTextSizes[0].evaluate(b,{},ie),il*K.compositeTextSizes[1].evaluate(b,{},ie)],(ye[0]>Lu||ye[1]>Lu)&&ui(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,re,ye,T,_,b,B,e,R.lineStartIndex,R.lineLength,$,ie);for(const Fe of G)X[Fe]=i.text.placedSymbolArray.length-1;return 4*re.length}function Rx(i){for(const e in i)return i[e];return null}function H2(i,e,n,l){const p=i.compareText;if(e in p){const _=p[e];for(let b=_.length-1;b>=0;b--)if(l.dist(_[b])<n)return!0}else p[e]=[];return p[e].push(l),!1}const Px=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class V1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=Px[15&l];if(!_)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(e,2,1),[T]=new Uint32Array(e,4,1);return new V1(T,b,_,e)}constructor(e,n=64,l=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const _=Px.indexOf(this.ArrayType),b=2*e*this.ArrayType.BYTES_PER_ELEMENT,T=e*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-T%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+R,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+b+T+R),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+R,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return G1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:T}=this,R=[0,_.length-1,0],B=[];for(;R.length;){const G=R.pop()||0,X=R.pop()||0,$=R.pop()||0;if(X-$<=T){for(let ae=$;ae<=X;ae++){const ye=b[2*ae],Fe=b[2*ae+1];ye>=e&&ye<=l&&Fe>=n&&Fe<=p&&B.push(_[ae])}continue}const K=$+X>>1,ie=b[2*K],re=b[2*K+1];ie>=e&&ie<=l&&re>=n&&re<=p&&B.push(_[K]),(G===0?e<=ie:n<=re)&&(R.push($),R.push(K-1),R.push(1-G)),(G===0?l>=ie:p>=re)&&(R.push(K+1),R.push(X),R.push(1-G))}return B}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:b}=this,T=[0,p.length-1,0],R=[],B=l*l;for(;T.length;){const G=T.pop()||0,X=T.pop()||0,$=T.pop()||0;if(X-$<=b){for(let ae=$;ae<=X;ae++)zx(_[2*ae],_[2*ae+1],e,n)<=B&&R.push(p[ae]);continue}const K=$+X>>1,ie=_[2*K],re=_[2*K+1];zx(ie,re,e,n)<=B&&R.push(p[K]),(G===0?e-l<=ie:n-l<=re)&&(T.push($),T.push(K-1),T.push(1-G)),(G===0?e+l>=ie:n+l>=re)&&(T.push(K+1),T.push(X),T.push(1-G))}return R}}function G1(i,e,n,l,p,_){if(p-l<=n)return;const b=l+p>>1;Ox(i,e,b,l,p,_),G1(i,e,n,l,b-1,1-_),G1(i,e,n,b+1,p,1-_)}function Ox(i,e,n,l,p,_){for(;p>l;){if(p-l>600){const B=p-l+1,G=n-l+1,X=Math.log(B),$=.5*Math.exp(2*X/3),K=.5*Math.sqrt(X*$*(B-$)/B)*(G-B/2<0?-1:1);Ox(i,e,n,Math.max(l,Math.floor(n-G*$/B+K)),Math.min(p,Math.floor(n+(B-G)*$/B+K)),_)}const b=e[2*n+_];let T=l,R=p;for(Eg(i,e,l,n),e[2*p+_]>b&&Eg(i,e,l,p);T<R;){for(Eg(i,e,T,R),T++,R--;e[2*T+_]<b;)T++;for(;e[2*R+_]>b;)R--}e[2*l+_]===b?Eg(i,e,l,R):(R++,Eg(i,e,R,p)),R<=n&&(l=R+1),n<=R&&(p=R-1)}}function Eg(i,e,n,l){H1(i,n,l),H1(e,2*n,2*l),H1(e,2*n+1,2*l+1)}function H1(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function zx(i,e,n,l){const p=i-n,_=e-l;return p*p+_*_}var q1;N.cH=void 0,(q1=N.cH||(N.cH={})).create="create",q1.load="load",q1.fullLoad="fullLoad";let jm=null,Sg=[];const Z1=1e3/60,X1="loadTime",W1="fullLoadTime",q2={mark(i){performance.mark(i)},frame(i){const e=i;jm!=null&&Sg.push(e-jm),jm=e},clearMetrics(){jm=null,Sg=[],performance.clearMeasures(X1),performance.clearMeasures(W1);for(const i in N.cH)performance.clearMarks(N.cH[i])},getPerformanceMetrics(){performance.measure(X1,N.cH.create,N.cH.load),performance.measure(W1,N.cH.create,N.cH.fullLoad);const i=performance.getEntriesByName(X1)[0].duration,e=performance.getEntriesByName(W1)[0].duration,n=Sg.length,l=1/(Sg.reduce(((_,b)=>_+b),0)/n/1e3),p=Sg.filter((_=>_>Z1)).reduce(((_,b)=>_+(b-Z1)/Z1),0);return{loadTime:i,fullLoadTime:e,fps:l,percentDroppedFrames:p/(n+p)*100,totalFrames:n}}};N.$=he,N.A=Ye,N.B=Wo,N.C=Js,N.D=Bn,N.E=ti,N.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},N.G=rr,N.H=Ir,N.I=Gr,N.J=td,N.K=function(i){if(qn==null){const e=i.navigator?i.navigator.userAgent:null;qn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return qn},N.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new qp((()=>this.process())),this.subscription=Ki(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Di(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,l)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=e?Ki(e.signal,"abort",(()=>{_?.unsubscribe(),delete this.resolveRejects[p];const R={id:p,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(R)}),J0):null;this.resolveRejects[p]={resolve:R=>{_?.unsubscribe(),n(R)},reject:R=>{_?.unsubscribe(),l(R)}};const b=[],T=Object.assign(Object.assign({},i),{id:p,sourceMapId:this.mapId,origin:location.origin,data:Yo(i.data,b)});this.target.postMessage(T,{transfer:b})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(Di(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return h(this,void 0,void 0,(function*(){if(e.type==="<response>"){const p=this.resolveRejects[i];return delete this.resolveRejects[i],p?void(e.error?p.reject(Tu(e.error)):p.resolve(Tu(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Tu(e.data),l=new AbortController;this.abortControllers[i]=l;try{const p=yield this.messageHandlers[e.type](e.sourceMapId,n,l);this.completeTask(i,null,p)}catch(p){this.completeTask(i,p)}}))}completeTask(i,e,n){const l=[];delete this.abortControllers[i];const p={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Yo(e):null,data:Yo(n,l)};this.target.postMessage(p,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},N.M=rt,N.N=function(){var i=new Ye(16);return Ye!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},N.O=function(i,e,n){var l,p,_,b,T,R,B,G,X,$,K,ie,re=n[0],ae=n[1],ye=n[2];return e===i?(i[12]=e[0]*re+e[4]*ae+e[8]*ye+e[12],i[13]=e[1]*re+e[5]*ae+e[9]*ye+e[13],i[14]=e[2]*re+e[6]*ae+e[10]*ye+e[14],i[15]=e[3]*re+e[7]*ae+e[11]*ye+e[15]):(p=e[1],_=e[2],b=e[3],T=e[4],R=e[5],B=e[6],G=e[7],X=e[8],$=e[9],K=e[10],ie=e[11],i[0]=l=e[0],i[1]=p,i[2]=_,i[3]=b,i[4]=T,i[5]=R,i[6]=B,i[7]=G,i[8]=X,i[9]=$,i[10]=K,i[11]=ie,i[12]=l*re+T*ae+X*ye+e[12],i[13]=p*re+R*ae+$*ye+e[13],i[14]=_*re+B*ae+K*ye+e[14],i[15]=b*re+G*ae+ie*ye+e[15]),i},N.P=U,N.Q=function(i,e,n){var l=n[0],p=n[1],_=n[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*_,i[9]=e[9]*_,i[10]=e[10]*_,i[11]=e[11]*_,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},N.R=Ya,N.S=function(i,e,n){var l=e[0],p=e[1],_=e[2],b=e[3],T=e[4],R=e[5],B=e[6],G=e[7],X=e[8],$=e[9],K=e[10],ie=e[11],re=e[12],ae=e[13],ye=e[14],Fe=e[15],be=n[0],Se=n[1],Ge=n[2],Ke=n[3];return i[0]=be*l+Se*T+Ge*X+Ke*re,i[1]=be*p+Se*R+Ge*$+Ke*ae,i[2]=be*_+Se*B+Ge*K+Ke*ye,i[3]=be*b+Se*G+Ge*ie+Ke*Fe,i[4]=(be=n[4])*l+(Se=n[5])*T+(Ge=n[6])*X+(Ke=n[7])*re,i[5]=be*p+Se*R+Ge*$+Ke*ae,i[6]=be*_+Se*B+Ge*K+Ke*ye,i[7]=be*b+Se*G+Ge*ie+Ke*Fe,i[8]=(be=n[8])*l+(Se=n[9])*T+(Ge=n[10])*X+(Ke=n[11])*re,i[9]=be*p+Se*R+Ge*$+Ke*ae,i[10]=be*_+Se*B+Ge*K+Ke*ye,i[11]=be*b+Se*G+Ge*ie+Ke*Fe,i[12]=(be=n[12])*l+(Se=n[13])*T+(Ge=n[14])*X+(Ke=n[15])*re,i[13]=be*p+Se*R+Ge*$+Ke*ae,i[14]=be*_+Se*B+Ge*K+Ke*ye,i[15]=be*b+Se*G+Ge*ie+Ke*Fe,i},N.T=wp,N.U=function(i,e){const n={};for(let l=0;l<e.length;l++){const p=e[l];p in i&&(n[p]=i[p])}return n},N.V=Nc,N.W=Kt,N.X=eg,N.Y=vm,N.Z=je,N._=h,N.a=pe,N.a$=xt,N.a0=Re,N.a1=vi,N.a2=jo,N.a3=Am,N.a4=Ef,N.a5=zt,N.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const l=Cf(i),p=Cf(e);(function(b,T){T.removeAll&&(b.add.clear(),b.update.clear(),b.remove.clear(),T.remove.clear());for(const R of T.remove)b.add.delete(R),b.update.delete(R);for(const[R,B]of T.update){const G=b.update.get(R);G&&(T.update.set(R,ng(G,B)),b.update.delete(R))}})(l,p);const _={};if((l.removeAll||p.removeAll)&&(_.removeAll=!0),_.remove=new Set([...l.remove,...p.remove]),_.add=new Map([...l.add,...p.add]),_.update=new Map([...l.update,...p.update]),_.remove.size&&_.add.size)for(const b of _.add.keys())_.remove.delete(b);return(function(b){const T={};return b.removeAll&&(T.removeAll=b.removeAll),b.remove&&(T.remove=Array.from(b.remove)),b.add&&(T.add=Array.from(b.add.values())),b.update&&(T.update=Array.from(b.update.values())),T})(_)},N.a7=function(i,e){const n=new Map;if(i==null||i.type==null)return n;if(i.type==="Feature"){const l=Sf(i,e);return l==null?void 0:(n.set(l,i),n)}if(i.type==="FeatureCollection"){const l=new Set;for(const p of i.features){const _=Sf(p,e);if(_==null||l.has(_))return;l.add(_),n.set(_,p)}return n}},N.a8=function(i,e,n){var l,p;const _=[];if(e.removeAll)i.clear();else if(e.remove)for(const b of e.remove){const T=i.get(b);T&&(_.push(T.geometry),i.delete(b))}if(e.add)for(const b of e.add){const T=Sf(b,n);if(T==null)continue;const R=i.get(T);R&&_.push(R.geometry),_.push(b.geometry),i.set(T,b)}if(e.update)for(const b of e.update){const T=i.get(b.id);if(!T)continue;const R=!!b.newGeometry,B=b.removeAllProperties||((l=b.removeProperties)===null||l===void 0?void 0:l.length)>0||((p=b.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0;if(!R&&!B)continue;_.push(T.geometry);const G=Object.assign({},T);if(i.set(b.id,G),R&&(_.push(b.newGeometry),G.geometry=b.newGeometry),B){if(G.properties=b.removeAllProperties?{}:Object.assign({},G.properties||{}),b.removeProperties)for(const X of b.removeProperties)delete G.properties[X];if(b.addOrUpdateProperties)for(const{key:X,value:$}of b.addOrUpdateProperties)G.properties[X]=$}}return _},N.a9=Pr,N.aA=function(i,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:p}){return i.kind==="source"?l/il:i.kind==="composite"?rr.number(l/il,p/il,n):e},N.aB=function(i,e){var n=e[0],l=e[1],p=e[2],_=e[3],b=e[4],T=e[5],R=e[6],B=e[7],G=e[8],X=e[9],$=e[10],K=e[11],ie=e[12],re=e[13],ae=e[14],ye=e[15],Fe=n*T-l*b,be=n*R-p*b,Se=n*B-_*b,Ge=l*R-p*T,Ke=l*B-_*T,kt=p*B-_*R,en=G*re-X*ie,Xt=G*ae-$*ie,cn=G*ye-K*ie,Tn=X*ae-$*re,dn=X*ye-K*re,Qt=$*ye-K*ae,Ut=Fe*Qt-be*dn+Se*Tn+Ge*cn-Ke*Xt+kt*en;return Ut?(i[0]=(T*Qt-R*dn+B*Tn)*(Ut=1/Ut),i[1]=(p*dn-l*Qt-_*Tn)*Ut,i[2]=(re*kt-ae*Ke+ye*Ge)*Ut,i[3]=($*Ke-X*kt-K*Ge)*Ut,i[4]=(R*cn-b*Qt-B*Xt)*Ut,i[5]=(n*Qt-p*cn+_*Xt)*Ut,i[6]=(ae*Se-ie*kt-ye*be)*Ut,i[7]=(G*kt-$*Se+K*be)*Ut,i[8]=(b*dn-T*cn+B*en)*Ut,i[9]=(l*cn-n*dn-_*en)*Ut,i[10]=(ie*Ke-re*Se+ye*Fe)*Ut,i[11]=(X*Se-G*Ke-K*Fe)*Ut,i[12]=(T*Xt-b*Tn-R*en)*Ut,i[13]=(n*Tn-l*Xt+p*en)*Ut,i[14]=(re*be-ie*Ge-ae*Fe)*Ut,i[15]=(G*Ge-X*be+$*Fe)*Ut,i):null},N.aC=We,N.aD=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},N.aE=function(i){return i[0]=0,i[1]=0,i},N.aF=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},N.aG=Y0,N.aH=Zt,N.aI=function(i,e,n,l){const p=e.y-i.y,_=e.x-i.x,b=l.y-n.y,T=l.x-n.x,R=b*_-T*p;if(R===0)return null;const B=(T*(i.y-n.y)-b*(i.x-n.x))/R;return new U(i.x+B*_,i.y+B*p)},N.aJ=r,N.aK=Ah,N.aL=function(i){let e=1/0,n=1/0,l=-1/0,p=-1/0;for(const _ of i)e=Math.min(e,_.x),n=Math.min(n,_.y),l=Math.max(l,_.x),p=Math.max(p,_.y);return[e,n,l,p]},N.aM=ea,N.aN=Gt,N.aO=function(i,e,n,l,p=!1){if(!n[0]&&!n[1])return[0,0];const _=p?l==="map"?-i.bearingInRadians:0:l==="viewport"?i.bearingInRadians:0;if(_){const b=Math.sin(_),T=Math.cos(_);n=[n[0]*T-n[1]*b,n[0]*b+n[1]*T]}return[p?n[0]:Gt(e,n[0],i.zoom),p?n[1]:Gt(e,n[1],i.zoom)]},N.aQ=jp,N.aR=Ag,N.aS=q0,N.aT=V1,N.aU=as,N.aV=pf,N.aW=Ce,N.aX=Cn,N.aY=Ot,N.aZ=xr,N.a_=tg,N.aa=Fu,N.ab=25,N.ac=wa,N.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const l of i){const p=window.document.createElement("source");Oe(l)||(e.crossOrigin="Anonymous"),p.src=l,e.appendChild(p)}}))},N.ae=Jt,N.af=function(){return sn++},N.ag=x,N.ah=Ad,N.ai=Uf,N.aj=Ga,N.ak=tl,N.al=Wp,N.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,l,p,_)=>{const b=p||_;return e[l]=!b||b.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},N.an=Bt,N.ao=85.051129,N.ap=Pi,N.aq=function(i){return Math.pow(2,i)},N.ar=Wt,N.as=wm,N.at=function(i){return Math.log(i)/Math.LN2},N.au=function(i){var e=i[0],n=i[1];return e*e+n*n},N.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((R=>R.canonical.z)));let n=1/0,l=-1/0,p=1/0,_=-1/0;const b=[];for(const R of i){const{x:B,y:G,z:X}=R.canonical,$=Math.pow(2,e-X),K=B*$,ie=G*$;b.push({id:R,x:K,y:ie}),K<n&&(n=K),K>l&&(l=K),ie<p&&(p=ie),ie>_&&(_=ie)}const T=new Set;for(const R of b)R.x!==n&&R.x!==l&&R.y!==p&&R.y!==_||T.add(R.id);return T},N.aw=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},N.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const l=i.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const p={value:e,timeout:void 0};if(n!==void 0&&(p.timeout=setTimeout((()=>{this.remove(i,p)}),n)),this.data[l].push(p),this.order.push(l),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,l=e===void 0?0:this.data[n].indexOf(e),p=this.data[n][l];return this.data[n].splice(l,1),p.timeout&&clearTimeout(p.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(p.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const l of this.data[n])i(l.value)||e.push(l);for(const n of e)this.remove(n.value.tileID,n)}},N.ay=function(i,e){let n=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:b}=i,T=p?Bt(Rs.interpolationFactor(p,e,_,b),0,1):0;i.kind==="camera"?l=rr.number(i.minSize,i.maxSize,T):n=T}return{uSizeT:n,uSize:l}},N.b=Gn,N.b$=el,N.b0=He,N.b1=function(i){var e=new Ye(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},N.b2=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},N.b3=function(i,e){var n=e[0],l=e[1],p=e[2],_=n*n+l*l+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=e[0]*_,i[1]=e[1]*_,i[2]=e[2]*_,i},N.b4=Pe,N.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},N.b6=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},N.b7=it,N.b8=function(i,e,n){const l=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return l===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/l},N.b9=vt,N.bA=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i},N.bB=Te,N.bC=function(i,e,n){var l=n[0],p=n[1],_=n[2],b=n[3],T=e[0],R=e[1],B=e[2],G=p*B-_*R,X=_*T-l*B,$=l*R-p*T;return i[0]=T+b*(G+=G)+p*($+=$)-_*(X+=X),i[1]=R+b*X+_*G-l*$,i[2]=B+b*$+l*X-p*G,i},N.bD=function(i,e,n){const l=(function(R){var B=R[3],G=R[4],X=R[5],$=R[6],K=R[7],ie=R[8];return R[0]*(ie*G-X*K)+R[1]*(-ie*B+X*$)+R[2]*(K*B-G*$)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(l===0)return null;const p=Pe([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),_=Pe([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),b=Pe([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),T=xt([],p,-i[3]);return He(T,T,xt([],_,-e[3])),He(T,T,xt([],b,-n[3])),xt(T,T,1/l),T},N.bE=Zp,N.bF=function(){return new Float64Array(4)},N.bG=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[0]*Math.cos(l)-p[1]*Math.sin(l),_[1]=p[0]*Math.sin(l)+p[1]*Math.cos(l),_[2]=p[2],i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},N.bH=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[0],_[1]=p[1]*Math.cos(l)-p[2]*Math.sin(l),_[2]=p[1]*Math.sin(l)+p[2]*Math.cos(l),i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},N.bI=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[2]*Math.sin(l)+p[0]*Math.cos(l),_[1]=p[1],_[2]=p[2]*Math.cos(l)-p[0]*Math.sin(l),i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},N.bJ=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[0],b=e[1],T=e[2],R=e[3],B=e[8],G=e[9],X=e[10],$=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*p-B*l,i[1]=b*p-G*l,i[2]=T*p-X*l,i[3]=R*p-$*l,i[8]=_*l+B*p,i[9]=b*l+G*p,i[10]=T*l+X*p,i[11]=R*l+$*p,i},N.bK=function(i,e){const n=ke(i,360),l=ke(e,360),p=l-n,_=l>n?p-360:p+360;return Math.abs(p)<Math.abs(_)?p:_},N.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},N.bM=function(i,e,n,l){const p=Math.sqrt(i*i+e*e),_=Math.sqrt(n*n+l*l);i/=p,e/=p,n/=_,l/=_;const b=Math.acos(i*n+e*l);return-e*n+i*l>0?b:-b},N.bN=function(i,e){const n=ke(i,2*Math.PI),l=ke(e,2*Math.PI);return Math.min(Math.abs(n-l),Math.abs(n-l+2*Math.PI),Math.abs(n-l-2*Math.PI))},N.bO=function(){const i={},e=ut.$version;for(const n in ut.$root){const l=ut.$root[n];if(l.required){let p=null;p=n==="version"?e:l.type==="array"?[]:{},p!=null&&(i[n]=p)}}return i},N.bP=Ze,N.bQ=rd,N.bR=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let l=0;l<e.length;l++)if(!i(e[l],n[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const l in e)if(!i(e[l],n[l]))return!1;return!0}return e===n},N.bS=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Qn(i[n],e[i[n].ref]));return i},N.bT=function(i,e){if(i.type==="custom")return new K0(i,e);switch(i.type){case"background":return new dr(i,e);case"circle":return new _p(i,e);case"color-relief":return new Yg(i,e);case"fill":return new em(i,e);case"fill-extrusion":return new B0(i,e);case"heatmap":return new Xg(i,e);case"hillshade":return new vs(i,e);case"line":return new j0(i,e);case"raster":return new Ql(i,e);case"symbol":return new Bu(i,e)}},N.bU=i=>i.type==="raster",N.bV=si,N.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!Kn(i.version,e.version))return[{command:"setStyle",args:[e]}];Kn(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),Kn(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),Kn(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Kn(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),Kn(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),Kn(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),Kn(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),Kn(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),Kn(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),Kn(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),Kn(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),Kn(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),Kn(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),Kn(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const l={},p=[];(function(b,T,R,B){let G;for(G in T=T||{},b=b||{})Object.prototype.hasOwnProperty.call(b,G)&&(Object.prototype.hasOwnProperty.call(T,G)||Mi(G,R,B));for(G in T)Object.prototype.hasOwnProperty.call(T,G)&&(Object.prototype.hasOwnProperty.call(b,G)?Kn(b[G],T[G])||(b[G].type==="geojson"&&T[G].type==="geojson"&&zi(b,T,G)?Jn(R,{command:"setGeoJSONSourceData",args:[G,T[G].data]}):ni(G,T,R,B)):lr(G,T,R))})(i.sources,e.sources,p,l);const _=[];i.layers&&i.layers.forEach((b=>{"source"in b&&l[b.source]?n.push({command:"removeLayer",args:[b.id]}):_.push(b)})),n=n.concat(p),(function(b,T,R){T=T||[];const B=(b=b||[]).map(Bi),G=T.map(Bi),X=b.reduce(Cr,{}),$=T.reduce(Cr,{}),K=B.slice(),ie=Object.create(null);let re,ae,ye,Fe,be;for(let Se=0,Ge=0;Se<B.length;Se++)re=B[Se],Object.prototype.hasOwnProperty.call($,re)?Ge++:(Jn(R,{command:"removeLayer",args:[re]}),K.splice(K.indexOf(re,Ge),1));for(let Se=0,Ge=0;Se<G.length;Se++)re=G[G.length-1-Se],K[K.length-1-Se]!==re&&(Object.prototype.hasOwnProperty.call(X,re)?(Jn(R,{command:"removeLayer",args:[re]}),K.splice(K.lastIndexOf(re,K.length-Ge),1)):Ge++,Fe=K[K.length-Se],Jn(R,{command:"addLayer",args:[$[re],Fe]}),K.splice(K.length-Se,0,re),ie[re]=!0);for(let Se=0;Se<G.length;Se++)if(re=G[Se],ae=X[re],ye=$[re],!ie[re]&&!Kn(ae,ye))if(Kn(ae.source,ye.source)&&Kn(ae["source-layer"],ye["source-layer"])&&Kn(ae.type,ye.type)){for(be in Ei(ae.layout,ye.layout,R,re,null,"setLayoutProperty"),Ei(ae.paint,ye.paint,R,re,null,"setPaintProperty"),Kn(ae.filter,ye.filter)||Jn(R,{command:"setFilter",args:[re,ye.filter]}),Kn(ae.minzoom,ye.minzoom)&&Kn(ae.maxzoom,ye.maxzoom)||Jn(R,{command:"setLayerZoomRange",args:[re,ye.minzoom,ye.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Ei(ae[be],ye[be],R,re,be.slice(6),"setPaintProperty"):Kn(ae[be],ye[be])||Jn(R,{command:"setLayerProperty",args:[re,be,ye[be]]}));for(be in ye)Object.prototype.hasOwnProperty.call(ye,be)&&!Object.prototype.hasOwnProperty.call(ae,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Ei(ae[be],ye[be],R,re,be.slice(6),"setPaintProperty"):Kn(ae[be],ye[be])||Jn(R,{command:"setLayerProperty",args:[re,be,ye[be]]}))}else Jn(R,{command:"removeLayer",args:[re]}),Fe=K[K.lastIndexOf(re)+1],Jn(R,{command:"addLayer",args:[ye,Fe]})})(_,e.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[e]}]}return n},N.bX=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},N.bY=Nn,N.bZ=Dn,N.b_=class extends Xa{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},N.ba=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},N.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},N.bc=Em,N.bd=Sd,N.be=function(i,e,n,l,p){var _=1/Math.tan(e/2);if(i[0]=_/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0){var b=1/(l-p);i[10]=(p+l)*b,i[14]=2*p*l*b}else i[10]=-1,i[14]=-2*l;return i},N.bf=function(i){var e=new Ye(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},N.bg=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[0],b=e[1],T=e[2],R=e[3],B=e[4],G=e[5],X=e[6],$=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*p+B*l,i[1]=b*p+G*l,i[2]=T*p+X*l,i[3]=R*p+$*l,i[4]=B*p-_*l,i[5]=G*p-b*l,i[6]=X*p-T*l,i[7]=$*p-R*l,i},N.bh=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[4],b=e[5],T=e[6],R=e[7],B=e[8],G=e[9],X=e[10],$=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=_*p+B*l,i[5]=b*p+G*l,i[6]=T*p+X*l,i[7]=R*p+$*l,i[8]=B*p-_*l,i[9]=G*p-b*l,i[10]=X*p-T*l,i[11]=$*p-R*l,i},N.bi=function(){const i=new Float32Array(16);return Wt(i),i},N.bj=function(){const i=new Float64Array(16);return Wt(i),i},N.bk=function(){return new Float64Array(16)},N.bl=function(i,e,n){const l=new Float64Array(4);return Te(l,i,e-90,n),l},N.bm=function(i,e,n,l){var p,_,b,T,R,B=e[0],G=e[1],X=e[2],$=e[3],K=n[0],ie=n[1],re=n[2],ae=n[3];return(_=B*K+G*ie+X*re+$*ae)<0&&(_=-_,K=-K,ie=-ie,re=-re,ae=-ae),1-_>tt?(p=Math.acos(_),b=Math.sin(p),T=Math.sin((1-l)*p)/b,R=Math.sin(l*p)/b):(T=1-l,R=l),i[0]=T*B+R*K,i[1]=T*G+R*ie,i[2]=T*X+R*re,i[3]=T*$+R*ae,i},N.bn=function(i){const e=new Float64Array(9);(function(_,b){var T=b[0],R=b[1],B=b[2],G=b[3],X=T+T,$=R+R,K=B+B,ie=T*X,re=R*X,ae=R*$,ye=B*X,Fe=B*$,be=B*K,Se=G*X,Ge=G*$,Ke=G*K;_[0]=1-ae-be,_[3]=re-Ke,_[6]=ye+Ge,_[1]=re+Ke,_[4]=1-ie-be,_[7]=Fe-Se,_[2]=ye-Ge,_[5]=Fe+Se,_[8]=1-ie-ae})(e,i);const n=xr(-Math.asin(Bt(e[2],-1,1)));let l,p;return Math.hypot(e[5],e[8])<.001?(l=0,p=-xr(Math.atan2(e[3],e[4]))):(l=xr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),p=xr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:l,pitch:n+90,bearing:p}},N.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},N.bp=Si,N.bq=Jc,N.br=zo,N.bs=nc,N.bt=va,N.bu=nt,N.bv=Nt,N.bw=Qr,N.bx=function(i,e,n,l,p){return nt(l,p,Bt((i-e)/(n-e),0,1))},N.by=ke,N.bz=function(){return new Float64Array(3)},N.c=Je,N.c$=function(i,e,n,l,p){return h(this,void 0,void 0,(function*(){if(Re())try{return yield vi(i,e,n,l,p)}catch{}return(function(_,b,T,R,B){const G=_.width,X=_.height;nn&&Li||(nn=new OffscreenCanvas(G,X),Li=nn.getContext("2d",{willReadFrequently:!0})),nn.width=G,nn.height=X,Li.drawImage(_,0,0,G,X);const $=Li.getImageData(b,T,R,B);return Li.clearRect(0,0,G,X),$.data})(i,e,n,l,p)}))},N.c0=class extends Xa{constructor(i,e){super(i,e),this.current=Wa}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},N.c1=Du,N.c2=class extends Xa{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},N.c3=class extends Xa{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},N.c4=pt,N.c5=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=0,i[3]=-n,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},N.c6=function(i,e,n){var l=e[0],p=e[1],_=e[2];return i[0]=l*n[0]+p*n[3]+_*n[6],i[1]=l*n[1]+p*n[4]+_*n[7],i[2]=l*n[2]+p*n[5]+_*n[8],i},N.c7=function(i,e,n,l,p,_,b){var T=1/(e-n),R=1/(l-p),B=1/(_-b);return i[0]=-2*T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*R,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*B,i[11]=0,i[12]=(e+n)*T,i[13]=(p+l)*R,i[14]=(b+_)*B,i[15]=1,i},N.c8=class extends Xa{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},N.c9=class extends Xa{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},N.cA=function(i,e){return gt[e]&&"touches"in i},N.cB=function(i){return gt[i]||oe[i]},N.cC=function(i,e,n){var l=e[0],p=e[1];return i[0]=n[0]*l+n[4]*p+n[12],i[1]=n[1]*l+n[5]*p+n[13],i},N.cD=function(i,e){const{x:n,y:l}=Pr.fromLngLat(e);return!(i<0||i>25||l<0||l>=1||n<0||n>=1)},N.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},N.cF=class extends Yc{},N.cG=q2,N.cI=de,N.cJ=function(i,e){Je.REGISTERED_PROTOCOLS[i]=e},N.cK=function(i){delete Je.REGISTERED_PROTOCOLS[i]},N.cL=function(i,e){const n={};for(let p=0;p<i.length;p++){const _=e&&e[i[p].id]||Hl(i[p]);e&&(e[i[p].id]=_);let b=n[_];b||(b=n[_]=[]),b.push(i[p])}const l=[];for(const p in n)l.push(n[p]);return l},N.cM=On,N.cN=ig,N.cO=wg,N.cP=Lp,N.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=zt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,l=e._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new Ir(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Ir(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Ir(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:G}=i.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Ir(B),i.canonical),l["text-size"].possiblyEvaluate(new Ir(G),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:G}=i.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Ir(B),i.canonical),l["icon-size"].possiblyEvaluate(new Ir(G),i.canonical)]}const _=n.get("text-line-height")*ea,b=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",T=n.get("text-keep-upright"),R=n.get("text-size");for(const B of i.bucket.features){const G=n.get("text-font").evaluate(B,{},i.canonical).join(","),X=R.evaluate(B,{},i.canonical),$=p.layoutTextSize.evaluate(B,{},i.canonical),K=p.layoutIconSize.evaluate(B,{},i.canonical),ie={horizontal:{},vertical:void 0},re=B.text;let ae,ye=[0,0];if(re){const Se=re.toString(),Ge=n.get("text-letter-spacing").evaluate(B,{},i.canonical)*ea,Ke=sd(Se)?Ge:0,kt=n.get("text-anchor").evaluate(B,{},i.canonical),en=fu(e,B,i.canonical);if(!en){const dn=n.get("text-radial-offset").evaluate(B,{},i.canonical);ye=dn?kr(kt,[dn*ea,or]):n.get("text-offset").evaluate(B,{},i.canonical).map((Qt=>Qt*ea))}let Xt=b?"center":n.get("text-justify").evaluate(B,{},i.canonical);const cn=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(B,{},i.canonical)*ea:1/0,Tn=()=>{i.bucket.allowVerticalPlacement&&Al(Se)&&(ie.vertical=vf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,cn,_,kt,"left",Ke,ye,N.az.vertical,!0,$,X))};if(!b&&en){const dn=new Set;if(Xt==="auto")for(let Ut=0;Ut<en.values.length;Ut+=2)dn.add(Ag(en.values[Ut]));else dn.add(Xt);let Qt=!1;for(const Ut of dn)if(!ie.horizontal[Ut])if(Qt)ie.horizontal[Ut]=ie.horizontal[0];else{const Vn=vf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,cn,_,"center",Ut,Ke,ye,N.az.horizontal,!1,$,X);Vn&&(ie.horizontal[Ut]=Vn,Qt=Vn.positionedLines.length===1)}Tn()}else{Xt==="auto"&&(Xt=Ag(kt));const dn=vf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,cn,_,kt,Xt,Ke,ye,N.az.horizontal,!1,$,X);dn&&(ie.horizontal[Xt]=dn),Tn(),Al(Se)&&b&&T&&(ie.vertical=vf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,cn,_,kt,Xt,Ke,ye,N.az.vertical,!1,$,X))}}let Fe=!1;if(B.icon&&B.icon.name){const Se=i.imageMap[B.icon.name];Se&&(ae=X0(i.imagePositions[B.icon.name],n.get("icon-offset").evaluate(B,{},i.canonical),n.get("icon-anchor").evaluate(B,{},i.canonical)),Fe=!!Se.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Fe:i.bucket.sdfIcons!==Fe&&ui("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const be=Rx(ie.horizontal)||ie.vertical;i.bucket.iconsInText=!!be&&be.iconsInText,(be||ae)&&G2(i.bucket,B,ie,ae,i.imageMap,p,$,K,ye,Fe,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},N.cR=Sh,N.cS=Pu,N.cT=md,N.cU=function(i){const e=new Pp;return(function(n,l){for(const p in n.layers)l.writeMessage(3,a0,n.layers[p])})(i,e),e.finish()},N.cV=function(i,e,n,l,p,_){let b=o(i,e,n,p,0);return b=o(b,e,l,_,1),b},N.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},N.cX=hr,N.cY=Pp,N.cZ=jf,N.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},N.ca=class extends Jl{},N.cb=sm,N.cc=class extends os{},N.cd=af,N.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},N.cf=Mc,N.cg=function(i,e,n){var l=e[0],p=e[1],_=e[2],b=n[3]*l+n[7]*p+n[11]*_+n[15];return i[0]=(n[0]*l+n[4]*p+n[8]*_+n[12])/(b=b||1),i[1]=(n[1]*l+n[5]*p+n[9]*_+n[13])/b,i[2]=(n[2]*l+n[6]*p+n[10]*_+n[14])/b,i},N.ch=class extends $c{},N.ci=class extends t{},N.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},N.ck=function(i,e){var n=i[0],l=i[1],p=i[2],_=i[3],b=i[4],T=i[5],R=i[6],B=i[7],G=i[8],X=i[9],$=i[10],K=i[11],ie=i[12],re=i[13],ae=i[14],ye=i[15],Fe=e[0],be=e[1],Se=e[2],Ge=e[3],Ke=e[4],kt=e[5],en=e[6],Xt=e[7],cn=e[8],Tn=e[9],dn=e[10],Qt=e[11],Ut=e[12],Vn=e[13],zn=e[14],Yn=e[15];return Math.abs(n-Fe)<=tt*Math.max(1,Math.abs(n),Math.abs(Fe))&&Math.abs(l-be)<=tt*Math.max(1,Math.abs(l),Math.abs(be))&&Math.abs(p-Se)<=tt*Math.max(1,Math.abs(p),Math.abs(Se))&&Math.abs(_-Ge)<=tt*Math.max(1,Math.abs(_),Math.abs(Ge))&&Math.abs(b-Ke)<=tt*Math.max(1,Math.abs(b),Math.abs(Ke))&&Math.abs(T-kt)<=tt*Math.max(1,Math.abs(T),Math.abs(kt))&&Math.abs(R-en)<=tt*Math.max(1,Math.abs(R),Math.abs(en))&&Math.abs(B-Xt)<=tt*Math.max(1,Math.abs(B),Math.abs(Xt))&&Math.abs(G-cn)<=tt*Math.max(1,Math.abs(G),Math.abs(cn))&&Math.abs(X-Tn)<=tt*Math.max(1,Math.abs(X),Math.abs(Tn))&&Math.abs($-dn)<=tt*Math.max(1,Math.abs($),Math.abs(dn))&&Math.abs(K-Qt)<=tt*Math.max(1,Math.abs(K),Math.abs(Qt))&&Math.abs(ie-Ut)<=tt*Math.max(1,Math.abs(ie),Math.abs(Ut))&&Math.abs(re-Vn)<=tt*Math.max(1,Math.abs(re),Math.abs(Vn))&&Math.abs(ae-zn)<=tt*Math.max(1,Math.abs(ae),Math.abs(zn))&&Math.abs(ye-Yn)<=tt*Math.max(1,Math.abs(ye),Math.abs(Yn))},N.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},N.cm=i=>i.type==="symbol",N.cn=i=>i.type==="circle",N.co=i=>i.type==="heatmap",N.cp=i=>i.type==="line",N.cq=i=>i.type==="fill",N.cr=i=>i.type==="fill-extrusion",N.cs=i=>i.type==="hillshade",N.ct=i=>i.type==="color-relief",N.cu=i=>i.type==="background",N.cv=i=>i.type==="custom",N.cw=_t,N.cx=function(i,e,n){const l=wt(e.x-n.x,e.y-n.y),p=wt(i.x-n.x,i.y-n.y),_=Math.atan2(l[0]*p[1]-l[1]*p[0],(function(b,T){return b[0]*T[0]+b[1]*T[1]})(l,p));return xr(_)},N.cy=tn,N.cz=function(i,e){return oe[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},N.d=Oe,N.d0=dd,N.d1=H,N.d2=class{constructor(i,e){this.layers={[Uf]:this},this.name=Uf,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new Lm(this.features[i],this.extent)}},N.d3=wu,N.d4=ko,N.e=an,N.f=i=>h(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),N.g=St,N.h=i=>new Promise(((e,n)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=In}))},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(p):In})),N.i=Di,N.j=(i,e)=>yt(an(i,{type:"json"}),e),N.k=mn,N.l=_n,N.m=yt,N.n=(i,e)=>yt(an(i,{type:"arrayBuffer"}),e),N.o=function(i){return new Pp(i).readFields(pm,[])},N.p=H0,N.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},N.r=sf,N.s=Ki,N.t=Is,N.u=ut,N.v=ch,N.w=ui,N.x=od,N.y=Xo,N.z=$l})),D("worker",["./shared"],(function(N){class h{constructor(oe,ce){this.keyCache={},oe&&this.replace(oe,ce)}replace(oe,ce){this._layerConfigs={},this._layers={},this.update(oe,[],ce)}update(oe,ce,pe){for(const Je of oe){this._layerConfigs[Je.id]=Je;const St=this._layers[Je.id]=N.bT(Je,pe);St._featureFilter=N.aj(St.filter,pe),this.keyCache[Je.id]&&delete this.keyCache[Je.id]}for(const Je of ce)delete this.keyCache[Je],delete this._layerConfigs[Je],delete this._layers[Je];this.familiesBySource={};const je=N.cL(Object.values(this._layerConfigs),this.keyCache);for(const Je of je){const St=Je.map((At=>this._layers[At.id])),rt=St[0];if(rt.isHidden())continue;const de=rt.source||"";let Ze=this.familiesBySource[de];Ze||(Ze=this.familiesBySource[de]={});const yt=rt.sourceLayer||N.ai;let Oe=Ze[yt];Oe||(Oe=Ze[yt]=[]),Oe.push(St)}}}class U{constructor(oe){const ce={},pe=[];for(const rt in oe){const de=oe[rt],Ze=ce[rt]={};for(const yt in de){const Oe=de[+yt];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const At={x:0,y:0,w:Oe.bitmap.width+2,h:Oe.bitmap.height+2};pe.push(At),Ze[yt]={rect:At,metrics:Oe.metrics}}}const{w:je,h:Je}=N.p(pe),St=new N.r({width:je||1,height:Je||1});for(const rt in oe){const de=oe[rt];for(const Ze in de){const yt=de[+Ze];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const Oe=ce[rt][Ze].rect;N.r.copy(yt.bitmap,St,{x:0,y:0},{x:Oe.x+1,y:Oe.y+1},yt.bitmap)}}this.image=St,this.positions=ce}}N.cM("GlyphAtlas",U);class H{constructor(oe){this.tileID=new N.a2(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.uid=oe.uid,this.zoom=oe.zoom,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.collectResourceTiming,this.returnDependencies=!!oe.returnDependencies,this.promoteId=oe.promoteId,this.inFlightDependencies=[]}parse(oe,ce,pe,je,Je){return N._(this,void 0,void 0,(function*(){this.status="parsing",this.data=oe,this.collisionBoxArray=new N.ag;const St=new N.cN(Object.keys(oe.layers).sort()),rt=new N.cO(this.tileID,this.promoteId);rt.bucketLayerIDs=[];const de={},Ze={featureIndex:rt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:pe,subdivisionGranularity:Je},yt=ce.familiesBySource[this.source];for(const zi in yt){const Ei=oe.layers[zi];if(!Ei)continue;Ei.version===1&&N.w(`Vector tile source "${this.source}" layer "${zi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bi=St.encode(zi),Cr=[];for(let Jt=0;Jt<Ei.length;Jt++){const gi=Ei.feature(Jt),An=rt.getId(gi,zi);Cr.push({feature:gi,id:An,index:Jt,sourceLayerIndex:Bi})}for(const Jt of yt[zi]){const gi=Jt[0];gi.source!==this.source&&N.w(`layer.source = ${gi.source} does not equal this.source = ${this.source}`),gi.isHidden(this.zoom,!0)||(Y(Jt,this.zoom,pe),(de[gi.id]=gi.createBucket({index:rt.bucketLayerIDs.length,layers:Jt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bi,sourceID:this.source})).populate(Cr,Ze,this.tileID.canonical),rt.bucketLayerIDs.push(Jt.map((An=>An.id))))}}const Oe=N.bY(Ze.glyphDependencies,(zi=>Object.keys(zi).map(Number)));this.inFlightDependencies.forEach((zi=>zi?.abort())),this.inFlightDependencies=[];let At=Promise.resolve({});if(Object.keys(Oe).length){const zi=new AbortController;this.inFlightDependencies.push(zi),At=je.sendAsync({type:"GG",data:{stacks:Oe,source:this.source,tileID:this.tileID,type:"glyphs"}},zi)}const jt=Object.keys(Ze.iconDependencies);let _n=Promise.resolve({});if(jt.length){const zi=new AbortController;this.inFlightDependencies.push(zi),_n=je.sendAsync({type:"GI",data:{icons:jt,source:this.source,tileID:this.tileID,type:"icons"}},zi)}const mn=Object.keys(Ze.patternDependencies);let ti=Promise.resolve({});if(mn.length){const zi=new AbortController;this.inFlightDependencies.push(zi),ti=je.sendAsync({type:"GI",data:{icons:mn,source:this.source,tileID:this.tileID,type:"patterns"}},zi)}const ut=Ze.dashDependencies;let ai=Promise.resolve({});if(Object.keys(ut).length){const zi=new AbortController;this.inFlightDependencies.push(zi),ai=je.sendAsync({type:"GDA",data:{dashes:ut}},zi)}const[Qn,Kn,Jn,lr]=yield Promise.all([At,_n,ti,ai]),Mi=new U(Qn),ni=new N.cP(Kn,Jn);for(const zi in de){const Ei=de[zi];Ei instanceof N.ah?(Y(Ei.layers,this.zoom,pe),N.cQ({bucket:Ei,glyphMap:Qn,glyphPositions:Mi.positions,imageMap:Kn,imagePositions:ni.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ze.subdivisionGranularity})):Ei.hasDependencies&&(Ei instanceof N.cR||Ei instanceof N.cS||Ei instanceof N.cT)&&(Y(Ei.layers,this.zoom,pe),Ei.addFeatures(Ze,this.tileID.canonical,ni.patternPositions,lr))}return this.status="done",{buckets:Object.values(de).filter((zi=>!zi.isEmpty())),featureIndex:rt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mi.image,imageAtlas:ni,dashPositions:lr,glyphMap:this.returnDependencies?Qn:null,iconMap:this.returnDependencies?Kn:null,glyphPositions:this.returnDependencies?Mi.positions:null}}))}}function Y(gt,oe,ce){const pe=new N.H(oe);for(const je of gt)je.recalculate(pe,ce)}class Q{constructor(oe,ce,pe,je,Je){this.type=oe,this.properties=pe||{},this.extent=Je,this.pointsArray=ce,this.id=je}loadGeometry(){return this.pointsArray.map((oe=>oe.map((ce=>new N.P(ce.x,ce.y)))))}}class _e{constructor(oe,ce,pe){this.version=2,this._myFeatures=oe,this.name=ce,this.length=oe.length,this.extent=pe}feature(oe){return this._myFeatures[oe]}}class we{constructor(){this.layers={}}addLayer(oe){this.layers[oe.name]=oe}}function ve(gt){let oe=N.cU(gt);return oe.byteOffset===0&&oe.byteLength===oe.buffer.byteLength||(oe=new Uint8Array(oe)),{vectorTile:gt,rawData:oe.buffer}}function me(gt,oe,ce){const{extent:pe}=gt,je=Math.pow(2,ce.z-oe.z),Je=(ce.x-oe.x*je)*pe,St=(ce.y-oe.y*je)*pe,rt=[];for(let de=0;de<gt.length;de++){const Ze=gt.feature(de);let yt=Ze.loadGeometry();for(const At of yt)for(const jt of At)jt.x=jt.x*je-Je,jt.y=jt.y*je-St;const Oe=128;yt=N.cV(yt,Ze.type,-Oe,-Oe,pe+Oe,pe+Oe),yt.length!==0&&rt.push(new Q(Ze.type,yt,Ze.properties,Ze.id,pe))}return new _e(rt,gt.name,pe)}class he{constructor(oe,ce,pe){this.actor=oe,this.layerIndex=ce,this.availableImages=pe,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new N.cW(1e3)}loadVectorTile(oe,ce){return N._(this,void 0,void 0,(function*(){const pe=yield N.n(oe.request,ce);try{return{vectorTile:oe.encoding!=="mlt"?new N.cX(new N.cY(pe.data)):new N.cZ(pe.data),rawData:pe.data,cacheControl:pe.cacheControl,expires:pe.expires}}catch(je){const Je=new Uint8Array(pe.data);let St=`Unable to parse the tile at ${oe.request.url}, `;throw St+=Je[0]===31&&Je[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${je.message}`,new Error(St)}}))}loadTile(oe){return N._(this,void 0,void 0,(function*(){const{uid:ce,overzoomParameters:pe}=oe;pe&&(oe.request=pe.overzoomRequest);const je=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new N.c_(oe.request),Je=new H(oe);this.loading[ce]=Je;const St=new AbortController;Je.abort=St;try{const rt=yield this.loadVectorTile(oe,St);if(delete this.loading[ce],!rt)return null;if(pe){const At=this._getOverzoomTile(oe,rt.vectorTile);rt.rawData=At.rawData,rt.vectorTile=At.vectorTile}const de=rt.rawData,Ze={};rt.expires&&(Ze.expires=rt.expires),rt.cacheControl&&(Ze.cacheControl=rt.cacheControl);const yt={};if(je){const At=je.finish();At&&(yt.resourceTiming=JSON.parse(JSON.stringify(At)))}Je.vectorTile=rt.vectorTile;const Oe=Je.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity);this.loaded[ce]=Je,this.fetching[ce]={rawTileData:de,cacheControl:Ze,resourceTiming:yt};try{const At=yield Oe;return N.e({rawTileData:de.slice(0),encoding:oe.encoding},At,Ze,yt)}finally{delete this.fetching[ce]}}catch(rt){throw delete this.loading[ce],Je.status="done",this.loaded[ce]=Je,rt}}))}_getOverzoomTile(oe,ce){const{tileID:pe,source:je,overzoomParameters:Je}=oe,{maxZoomTileID:St}=Je,rt=`${St.key}_${pe.key}`,de=this.overzoomedTileResultCache.get(rt);if(de)return de;const Ze=new we,yt=this.layerIndex.familiesBySource[je];for(const At in yt){const jt=ce.layers[At];if(!jt)continue;const _n=me(jt,St,pe.canonical);_n.length>0&&Ze.addLayer(_n)}const Oe=ve(Ze);return this.overzoomedTileResultCache.set(rt,Oe),Oe}reloadTile(oe){return N._(this,void 0,void 0,(function*(){const ce=oe.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const pe=this.loaded[ce];if(pe.showCollisionBoxes=oe.showCollisionBoxes,pe.status==="parsing"){const je=yield pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity);let Je;if(this.fetching[ce]){const{rawTileData:St,cacheControl:rt,resourceTiming:de}=this.fetching[ce];delete this.fetching[ce],Je=N.e({rawTileData:St.slice(0),encoding:oe.encoding},je,rt,de)}else Je=je;return Je}if(pe.status==="done"&&pe.vectorTile)return pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity)}))}abortTile(oe){return N._(this,void 0,void 0,(function*(){const ce=this.loading,pe=oe.uid;ce&&ce[pe]&&ce[pe].abort&&(ce[pe].abort.abort(),delete ce[pe])}))}removeTile(oe){return N._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[oe.uid]&&delete this.loaded[oe.uid]}))}}class Re{constructor(){this.loaded={}}loadTile(oe){return N._(this,void 0,void 0,(function*(){const{uid:ce,encoding:pe,rawImageData:je,redFactor:Je,greenFactor:St,blueFactor:rt,baseShift:de}=oe,Ze=je.width+2,yt=je.height+2,Oe=N.b(je)?new N.R({width:Ze,height:yt},yield N.c$(je,-1,-1,Ze,yt)):je,At=new N.d0(ce,Oe,pe,Je,St,rt,de);return this.loaded=this.loaded||{},this.loaded[ce]=At,At}))}removeTile(oe){const ce=this.loaded,pe=oe.uid;ce&&ce[pe]&&delete ce[pe]}}var tt,Ye,pt=(function(){if(Ye)return tt;function gt(ce,pe){if(ce.length!==0){oe(ce[0],pe);for(var je=1;je<ce.length;je++)oe(ce[je],!pe)}}function oe(ce,pe){for(var je=0,Je=0,St=0,rt=ce.length,de=rt-1;St<rt;de=St++){var Ze=(ce[St][0]-ce[de][0])*(ce[de][1]+ce[St][1]),yt=je+Ze;Je+=Math.abs(je)>=Math.abs(Ze)?je-yt+Ze:Ze-yt+je,je=yt}je+Je>=0!=!!pe&&ce.reverse()}return Ye=1,tt=function ce(pe,je){var Je,St=pe&&pe.type;if(St==="FeatureCollection")for(Je=0;Je<pe.features.length;Je++)ce(pe.features[Je],je);else if(St==="GeometryCollection")for(Je=0;Je<pe.geometries.length;Je++)ce(pe.geometries[Je],je);else if(St==="Feature")ce(pe.geometry,je);else if(St==="Polygon")gt(pe.coordinates,je);else if(St==="MultiPolygon")for(Je=0;Je<pe.coordinates.length;Je++)gt(pe.coordinates[Je],je);return pe}})(),Wt=N.d1(pt);const Et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:gt=>gt},it=Math.fround||(at=new Float32Array(1),gt=>(at[0]=+gt,at[0]));var at;class He{constructor(oe){this.options=Object.assign(Object.create(Et),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:ce,minZoom:pe,maxZoom:je}=this.options;ce&&console.time("total time");const Je=`prepare ${oe.length} points`;ce&&console.time(Je),this.points=oe;const St=[];for(let de=0;de<oe.length;de++){const Ze=oe[de];if(!Ze.geometry)continue;const[yt,Oe]=Ze.geometry.coordinates,At=it(ct(yt)),jt=it(vt(Oe));St.push(At,jt,1/0,de,-1,1),this.options.reduce&&St.push(0)}let rt=this.trees[je+1]=this._createTree(St);ce&&console.timeEnd(Je);for(let de=je;de>=pe;de--){const Ze=+Date.now();rt=this.trees[de]=this._createTree(this._cluster(rt,de)),ce&&console.log("z%d: %d clusters in %dms",de,rt.numItems,+Date.now()-Ze)}return ce&&console.timeEnd("total time"),this}getClusters(oe,ce){let pe=((oe[0]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,oe[1]));let Je=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const St=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)pe=-180,Je=180;else if(pe>Je){const Oe=this.getClusters([pe,je,180,St],ce),At=this.getClusters([-180,je,Je,St],ce);return Oe.concat(At)}const rt=this.trees[this._limitZoom(ce)],de=rt.range(ct(pe),vt(St),ct(Je),vt(je)),Ze=rt.data,yt=[];for(const Oe of de){const At=this.stride*Oe;yt.push(Ze[At+5]>1?xt(Ze,At,this.clusterProps):this.points[Ze[At+3]])}return yt}getChildren(oe){const ce=this._getOriginId(oe),pe=this._getOriginZoom(oe),je="No cluster with the specified id.",Je=this.trees[pe];if(!Je)throw new Error(je);const St=Je.data;if(ce*this.stride>=St.length)throw new Error(je);const rt=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),de=Je.within(St[ce*this.stride],St[ce*this.stride+1],rt),Ze=[];for(const yt of de){const Oe=yt*this.stride;St[Oe+4]===oe&&Ze.push(St[Oe+5]>1?xt(St,Oe,this.clusterProps):this.points[St[Oe+3]])}if(Ze.length===0)throw new Error(je);return Ze}getLeaves(oe,ce,pe){const je=[];return this._appendLeaves(je,oe,ce=ce||10,pe=pe||0,0),je}getTile(oe,ce,pe){const je=this.trees[this._limitZoom(oe)],Je=Math.pow(2,oe),{extent:St,radius:rt}=this.options,de=rt/St,Ze=(pe-de)/Je,yt=(pe+1+de)/Je,Oe={features:[]};return this._addTileFeatures(je.range((ce-de)/Je,Ze,(ce+1+de)/Je,yt),je.data,ce,pe,Je,Oe),ce===0&&this._addTileFeatures(je.range(1-de/Je,Ze,1,yt),je.data,Je,pe,Je,Oe),ce===Je-1&&this._addTileFeatures(je.range(0,Ze,de/Je,yt),je.data,-1,pe,Je,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(oe){let ce=this._getOriginZoom(oe)-1;for(;ce<=this.options.maxZoom;){const pe=this.getChildren(oe);if(ce++,pe.length!==1)break;oe=pe[0].properties.cluster_id}return ce}_appendLeaves(oe,ce,pe,je,Je){const St=this.getChildren(ce);for(const rt of St){const de=rt.properties;if(de&&de.cluster?Je+de.point_count<=je?Je+=de.point_count:Je=this._appendLeaves(oe,de.cluster_id,pe,je,Je):Je<je?Je++:oe.push(rt),oe.length===pe)break}return Je}_createTree(oe){const ce=new N.aT(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<oe.length;pe+=this.stride)ce.add(oe[pe],oe[pe+1]);return ce.finish(),ce.data=oe,ce}_addTileFeatures(oe,ce,pe,je,Je,St){for(const rt of oe){const de=rt*this.stride,Ze=ce[de+5]>1;let yt,Oe,At;if(Ze)yt=Pe(ce,de,this.clusterProps),Oe=ce[de],At=ce[de+1];else{const mn=this.points[ce[de+3]];yt=mn.properties;const[ti,ut]=mn.geometry.coordinates;Oe=ct(ti),At=vt(ut)}const jt={type:1,geometry:[[Math.round(this.options.extent*(Oe*Je-pe)),Math.round(this.options.extent*(At*Je-je))]],tags:yt};let _n;_n=Ze||this.options.generateId?ce[de+3]:this.points[ce[de+3]].id,_n!==void 0&&(jt.id=_n),St.features.push(jt)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,ce){const{radius:pe,extent:je,reduce:Je,minPoints:St}=this.options,rt=pe/(je*Math.pow(2,ce)),de=oe.data,Ze=[],yt=this.stride;for(let Oe=0;Oe<de.length;Oe+=yt){if(de[Oe+2]<=ce)continue;de[Oe+2]=ce;const At=de[Oe],jt=de[Oe+1],_n=oe.within(de[Oe],de[Oe+1],rt),mn=de[Oe+5];let ti=mn;for(const ut of _n){const ai=ut*yt;de[ai+2]>ce&&(ti+=de[ai+5])}if(ti>mn&&ti>=St){let ut,ai=At*mn,Qn=jt*mn,Kn=-1;const Jn=(Oe/yt<<5)+(ce+1)+this.points.length;for(const lr of _n){const Mi=lr*yt;if(de[Mi+2]<=ce)continue;de[Mi+2]=ce;const ni=de[Mi+5];ai+=de[Mi]*ni,Qn+=de[Mi+1]*ni,de[Mi+4]=Jn,Je&&(ut||(ut=this._map(de,Oe,!0),Kn=this.clusterProps.length,this.clusterProps.push(ut)),Je(ut,this._map(de,Mi)))}de[Oe+4]=Jn,Ze.push(ai/ti,Qn/ti,1/0,Jn,-1,ti),Je&&Ze.push(Kn)}else{for(let ut=0;ut<yt;ut++)Ze.push(de[Oe+ut]);if(ti>1)for(const ut of _n){const ai=ut*yt;if(!(de[ai+2]<=ce)){de[ai+2]=ce;for(let Qn=0;Qn<yt;Qn++)Ze.push(de[ai+Qn])}}}}return Ze}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,ce,pe){if(oe[ce+5]>1){const St=this.clusterProps[oe[ce+6]];return pe?Object.assign({},St):St}const je=this.points[oe[ce+3]].properties,Je=this.options.map(je);return pe&&Je===je?Object.assign({},Je):Je}}function xt(gt,oe,ce){return{type:"Feature",id:gt[oe+3],properties:Pe(gt,oe,ce),geometry:{type:"Point",coordinates:[(pe=gt[oe],360*(pe-.5)),Zt(gt[oe+1])]}};var pe}function Pe(gt,oe,ce){const pe=gt[oe+5],je=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,Je=gt[oe+6],St=Je===-1?{}:Object.assign({},ce[Je]);return Object.assign(St,{cluster:!0,cluster_id:gt[oe+3],point_count:pe,point_count_abbreviated:je})}function ct(gt){return gt/360+.5}function vt(gt){const oe=Math.sin(gt*Math.PI/180),ce=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ce<0?0:ce>1?1:ce}function Zt(gt){const oe=(180-360*gt)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Ne(gt,oe,ce,pe){let je=pe;const Je=oe+(ce-oe>>1);let St,rt=ce-oe;const de=gt[oe],Ze=gt[oe+1],yt=gt[ce],Oe=gt[ce+1];for(let At=oe+3;At<ce;At+=3){const jt=Te(gt[At],gt[At+1],de,Ze,yt,Oe);if(jt>je)St=At,je=jt;else if(jt===je){const _n=Math.abs(At-Je);_n<rt&&(St=At,rt=_n)}}je>pe&&(St-oe>3&&Ne(gt,oe,St,pe),gt[St+2]=je,ce-St>3&&Ne(gt,St,ce,pe))}function Te(gt,oe,ce,pe,je,Je){let St=je-ce,rt=Je-pe;if(St!==0||rt!==0){const de=((gt-ce)*St+(oe-pe)*rt)/(St*St+rt*rt);de>1?(ce=je,pe=Je):de>0&&(ce+=St*de,pe+=rt*de)}return St=gt-ce,rt=oe-pe,St*St+rt*rt}function We(gt,oe,ce,pe){const je={id:gt??null,type:oe,geometry:ce,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")wt(je,ce);else if(oe==="Polygon")wt(je,ce[0]);else if(oe==="MultiLineString")for(const Je of ce)wt(je,Je);else if(oe==="MultiPolygon")for(const Je of ce)wt(je,Je[0]);return je}function wt(gt,oe){for(let ce=0;ce<oe.length;ce+=3)gt.minX=Math.min(gt.minX,oe[ce]),gt.minY=Math.min(gt.minY,oe[ce+1]),gt.maxX=Math.max(gt.maxX,oe[ce]),gt.maxY=Math.max(gt.maxY,oe[ce+1])}function zt(gt,oe,ce,pe){if(!oe.geometry)return;const je=oe.geometry.coordinates;if(je&&je.length===0)return;const Je=oe.geometry.type,St=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let rt=[],de=oe.id;if(ce.promoteId?de=oe.properties[ce.promoteId]:ce.generateId&&(de=pe||0),Je==="Point")Gt(je,rt);else if(Je==="MultiPoint")for(const Ze of je)Gt(Ze,rt);else if(Je==="LineString")ke(je,rt,St,!1);else if(Je==="MultiLineString"){if(ce.lineMetrics){for(const Ze of je)rt=[],ke(Ze,rt,St,!1),gt.push(We(de,"LineString",rt,oe.properties));return}nt(je,rt,St,!1)}else if(Je==="Polygon")nt(je,rt,St,!0);else{if(Je!=="MultiPolygon"){if(Je==="GeometryCollection"){for(const Ze of oe.geometry.geometries)zt(gt,{id:de,geometry:Ze,properties:oe.properties},ce,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ze of je){const yt=[];nt(Ze,yt,St,!0),rt.push(yt)}}gt.push(We(de,Je,rt,oe.properties))}function Gt(gt,oe){oe.push(Nt(gt[0]),_t(gt[1]),0)}function ke(gt,oe,ce,pe){let je,Je,St=0;for(let de=0;de<gt.length;de++){const Ze=Nt(gt[de][0]),yt=_t(gt[de][1]);oe.push(Ze,yt,0),de>0&&(St+=pe?(je*yt-Ze*Je)/2:Math.sqrt(Math.pow(Ze-je,2)+Math.pow(yt-Je,2))),je=Ze,Je=yt}const rt=oe.length-3;oe[2]=1,Ne(oe,0,rt,ce),oe[rt+2]=1,oe.size=Math.abs(St),oe.start=0,oe.end=oe.size}function nt(gt,oe,ce,pe){for(let je=0;je<gt.length;je++){const Je=[];ke(gt[je],Je,ce,pe),oe.push(Je)}}function Nt(gt){return gt/360+.5}function _t(gt){const oe=Math.sin(gt*Math.PI/180),ce=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ce<0?0:ce>1?1:ce}function tn(gt,oe,ce,pe,je,Je,St,rt){if(pe/=oe,Je>=(ce/=oe)&&St<pe)return gt;if(St<ce||Je>=pe)return null;const de=[];for(const Ze of gt){const yt=Ze.geometry;let Oe=Ze.type;const At=je===0?Ze.minX:Ze.minY,jt=je===0?Ze.maxX:Ze.maxY;if(At>=ce&&jt<pe){de.push(Ze);continue}if(jt<ce||At>=pe)continue;let _n=[];if(Oe==="Point"||Oe==="MultiPoint")Bt(yt,_n,ce,pe,je);else if(Oe==="LineString")Kt(yt,_n,ce,pe,je,!1,rt.lineMetrics);else if(Oe==="MultiLineString")sn(yt,_n,ce,pe,je,!1);else if(Oe==="Polygon")sn(yt,_n,ce,pe,je,!0);else if(Oe==="MultiPolygon")for(const mn of yt){const ti=[];sn(mn,ti,ce,pe,je,!0),ti.length&&_n.push(ti)}if(_n.length){if(rt.lineMetrics&&Oe==="LineString"){for(const mn of _n)de.push(We(Ze.id,Oe,mn,Ze.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(_n.length===1?(Oe="LineString",_n=_n[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=_n.length===3?"Point":"MultiPoint"),de.push(We(Ze.id,Oe,_n,Ze.tags))}}return de.length?de:null}function Bt(gt,oe,ce,pe,je){for(let Je=0;Je<gt.length;Je+=3){const St=gt[Je+je];St>=ce&&St<=pe&&Nn(oe,gt[Je],gt[Je+1],gt[Je+2])}}function Kt(gt,oe,ce,pe,je,Je,St){let rt=an(gt);const de=je===0?Dn:si;let Ze,yt,Oe=gt.start;for(let ti=0;ti<gt.length-3;ti+=3){const ut=gt[ti],ai=gt[ti+1],Qn=gt[ti+2],Kn=gt[ti+3],Jn=gt[ti+4],lr=je===0?ut:ai,Mi=je===0?Kn:Jn;let ni=!1;St&&(Ze=Math.sqrt(Math.pow(ut-Kn,2)+Math.pow(ai-Jn,2))),lr<ce?Mi>ce&&(yt=de(rt,ut,ai,Kn,Jn,ce),St&&(rt.start=Oe+Ze*yt)):lr>pe?Mi<pe&&(yt=de(rt,ut,ai,Kn,Jn,pe),St&&(rt.start=Oe+Ze*yt)):Nn(rt,ut,ai,Qn),Mi<ce&&lr>=ce&&(yt=de(rt,ut,ai,Kn,Jn,ce),ni=!0),Mi>pe&&lr<=pe&&(yt=de(rt,ut,ai,Kn,Jn,pe),ni=!0),!Je&&ni&&(St&&(rt.end=Oe+Ze*yt),oe.push(rt),rt=an(gt)),St&&(Oe+=Ze)}let At=gt.length-3;const jt=gt[At],_n=gt[At+1],mn=je===0?jt:_n;mn>=ce&&mn<=pe&&Nn(rt,jt,_n,gt[At+2]),At=rt.length-3,Je&&At>=3&&(rt[At]!==rt[0]||rt[At+1]!==rt[1])&&Nn(rt,rt[0],rt[1],rt[2]),rt.length&&oe.push(rt)}function an(gt){const oe=[];return oe.size=gt.size,oe.start=gt.start,oe.end=gt.end,oe}function sn(gt,oe,ce,pe,je,Je){for(const St of gt)Kt(St,oe,ce,pe,je,Je,!1)}function Nn(gt,oe,ce,pe){gt.push(oe,ce,pe)}function Dn(gt,oe,ce,pe,je,Je){const St=(Je-oe)/(pe-oe);return Nn(gt,Je,ce+(je-ce)*St,1),St}function si(gt,oe,ce,pe,je,Je){const St=(Je-ce)/(je-ce);return Nn(gt,oe+(pe-oe)*St,Je,1),St}function kn(gt,oe){const ce=[];for(let pe=0;pe<gt.length;pe++){const je=gt[pe],Je=je.type;let St;if(Je==="Point"||Je==="MultiPoint"||Je==="LineString")St=ui(je.geometry,oe);else if(Je==="MultiLineString"||Je==="Polygon"){St=[];for(const rt of je.geometry)St.push(ui(rt,oe))}else if(Je==="MultiPolygon"){St=[];for(const rt of je.geometry){const de=[];for(const Ze of rt)de.push(ui(Ze,oe));St.push(de)}}ce.push(We(je.id,Je,St,je.tags))}return ce}function ui(gt,oe){const ce=[];ce.size=gt.size,gt.start!==void 0&&(ce.start=gt.start,ce.end=gt.end);for(let pe=0;pe<gt.length;pe+=3)ce.push(gt[pe]+oe,gt[pe+1],gt[pe+2]);return ce}function _i(gt,oe){if(gt.transformed)return gt;const ce=1<<gt.z,pe=gt.x,je=gt.y;for(const Je of gt.features){const St=Je.geometry,rt=Je.type;if(Je.geometry=[],rt===1)for(let de=0;de<St.length;de+=2)Je.geometry.push(Di(St[de],St[de+1],oe,ce,pe,je));else for(let de=0;de<St.length;de++){const Ze=[];for(let yt=0;yt<St[de].length;yt+=2)Ze.push(Di(St[de][yt],St[de][yt+1],oe,ce,pe,je));Je.geometry.push(Ze)}}return gt.transformed=!0,gt}function Di(gt,oe,ce,pe,je,Je){return[Math.round(ce*(gt*pe-je)),Math.round(ce*(oe*pe-Je))]}function qn(gt,oe,ce,pe,je){const Je=oe===je.maxZoom?0:je.tolerance/((1<<oe)*je.extent),St={features:[],numPoints:0,numSimplified:0,numFeatures:gt.length,source:null,x:ce,y:pe,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of gt)Gn(St,rt,Je,je);return St}function Gn(gt,oe,ce,pe){const je=oe.geometry,Je=oe.type,St=[];if(gt.minX=Math.min(gt.minX,oe.minX),gt.minY=Math.min(gt.minY,oe.minY),gt.maxX=Math.max(gt.maxX,oe.maxX),gt.maxY=Math.max(gt.maxY,oe.maxY),Je==="Point"||Je==="MultiPoint")for(let rt=0;rt<je.length;rt+=3)St.push(je[rt],je[rt+1]),gt.numPoints++,gt.numSimplified++;else if(Je==="LineString")In(St,je,gt,ce,!1,!1);else if(Je==="MultiLineString"||Je==="Polygon")for(let rt=0;rt<je.length;rt++)In(St,je[rt],gt,ce,Je==="Polygon",rt===0);else if(Je==="MultiPolygon")for(let rt=0;rt<je.length;rt++){const de=je[rt];for(let Ze=0;Ze<de.length;Ze++)In(St,de[Ze],gt,ce,!0,Ze===0)}if(St.length){let rt=oe.tags||null;if(Je==="LineString"&&pe.lineMetrics){rt={};for(const Ze in oe.tags)rt[Ze]=oe.tags[Ze];rt.mapbox_clip_start=je.start/je.size,rt.mapbox_clip_end=je.end/je.size}const de={geometry:St,type:Je==="Polygon"||Je==="MultiPolygon"?3:Je==="LineString"||Je==="MultiLineString"?2:1,tags:rt};oe.id!==null&&(de.id=oe.id),gt.features.push(de)}}function In(gt,oe,ce,pe,je,Je){const St=pe*pe;if(pe>0&&oe.size<(je?St:pe))return void(ce.numPoints+=oe.length/3);const rt=[];for(let de=0;de<oe.length;de+=3)(pe===0||oe[de+2]>St)&&(ce.numSimplified++,rt.push(oe[de],oe[de+1])),ce.numPoints++;je&&(function(de,Ze){let yt=0;for(let Oe=0,At=de.length,jt=At-2;Oe<At;jt=Oe,Oe+=2)yt+=(de[Oe]-de[jt])*(de[Oe+1]+de[jt+1]);if(yt>0===Ze)for(let Oe=0,At=de.length;Oe<At/2;Oe+=2){const jt=de[Oe],_n=de[Oe+1];de[Oe]=de[At-2-Oe],de[Oe+1]=de[At-1-Oe],de[At-2-Oe]=jt,de[At-1-Oe]=_n}})(rt,Je),gt.push(rt)}const vi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class nn{constructor(oe,ce){const pe=(ce=this.options=(function(Je,St){for(const rt in St)Je[rt]=St[rt];return Je})(Object.create(vi),ce)).debug;if(pe&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let je=(function(Je,St){const rt=[];if(Je.type==="FeatureCollection")for(let de=0;de<Je.features.length;de++)zt(rt,Je.features[de],St,de);else zt(rt,Je.type==="Feature"?Je:{geometry:Je},St);return rt})(oe,ce);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),je=(function(Je,St){const rt=St.buffer/St.extent;let de=Je;const Ze=tn(Je,1,-1-rt,rt,0,-1,2,St),yt=tn(Je,1,1-rt,2+rt,0,-1,2,St);return(Ze||yt)&&(de=tn(Je,1,-rt,1+rt,0,-1,2,St)||[],Ze&&(de=kn(Ze,1).concat(de)),yt&&(de=de.concat(kn(yt,-1)))),de})(je,ce),je.length&&this.splitTile(je,0,0,0),pe&&(je.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,ce,pe,je,Je,St,rt){const de=[oe,ce,pe,je],Ze=this.options,yt=Ze.debug;for(;de.length;){je=de.pop(),pe=de.pop(),ce=de.pop(),oe=de.pop();const Oe=1<<ce,At=Li(ce,pe,je);let jt=this.tiles[At];if(!jt&&(yt>1&&console.time("creation"),jt=this.tiles[At]=qn(oe,ce,pe,je,Ze),this.tileCoords.push({z:ce,x:pe,y:je}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,pe,je,jt.numFeatures,jt.numPoints,jt.numSimplified),console.timeEnd("creation"));const ni=`z${ce}`;this.stats[ni]=(this.stats[ni]||0)+1,this.total++}if(jt.source=oe,Je==null){if(ce===Ze.indexMaxZoom||jt.numPoints<=Ze.indexMaxPoints)continue}else{if(ce===Ze.maxZoom||ce===Je)continue;if(Je!=null){const ni=Je-ce;if(pe!==St>>ni||je!==rt>>ni)continue}}if(jt.source=null,oe.length===0)continue;yt>1&&console.time("clipping");const _n=.5*Ze.buffer/Ze.extent,mn=.5-_n,ti=.5+_n,ut=1+_n;let ai=null,Qn=null,Kn=null,Jn=null,lr=tn(oe,Oe,pe-_n,pe+ti,0,jt.minX,jt.maxX,Ze),Mi=tn(oe,Oe,pe+mn,pe+ut,0,jt.minX,jt.maxX,Ze);oe=null,lr&&(ai=tn(lr,Oe,je-_n,je+ti,1,jt.minY,jt.maxY,Ze),Qn=tn(lr,Oe,je+mn,je+ut,1,jt.minY,jt.maxY,Ze),lr=null),Mi&&(Kn=tn(Mi,Oe,je-_n,je+ti,1,jt.minY,jt.maxY,Ze),Jn=tn(Mi,Oe,je+mn,je+ut,1,jt.minY,jt.maxY,Ze),Mi=null),yt>1&&console.timeEnd("clipping"),de.push(ai||[],ce+1,2*pe,2*je),de.push(Qn||[],ce+1,2*pe,2*je+1),de.push(Kn||[],ce+1,2*pe+1,2*je),de.push(Jn||[],ce+1,2*pe+1,2*je+1)}}getTile(oe,ce,pe){oe=+oe,ce=+ce,pe=+pe;const je=this.options,{extent:Je,debug:St}=je;if(oe<0||oe>24)return null;const rt=1<<oe,de=Li(oe,ce=ce+rt&rt-1,pe);if(this.tiles[de])return _i(this.tiles[de],Je);St>1&&console.log("drilling down to z%d-%d-%d",oe,ce,pe);let Ze,yt=oe,Oe=ce,At=pe;for(;!Ze&&yt>0;)yt--,Oe>>=1,At>>=1,Ze=this.tiles[Li(yt,Oe,At)];return Ze&&Ze.source?(St>1&&(console.log("found parent tile z%d-%d-%d",yt,Oe,At),console.time("drilling down")),this.splitTile(Ze.source,yt,Oe,At,oe,ce,pe),St>1&&console.timeEnd("drilling down"),this.tiles[de]?_i(this.tiles[de],Je):null):null}}function Li(gt,oe,ce){return 32*((1<<gt)*ce+oe)+gt}class Ki extends he{constructor(oe,ce,pe,je=Pi){super(oe,ce,pe),this._dataUpdateable=new Map,this._createGeoJSONIndex=je}loadVectorTile(oe,ce){return N._(this,void 0,void 0,(function*(){const pe=oe.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const je=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);return je?ve(new N.d2(je.features,{version:2,extent:N.a5})):null}))}loadData(oe){return N._(this,void 0,void 0,(function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const pe=this._startPerformance(oe);this._pendingRequest=new AbortController;try{(!this._pendingData||oe.request||oe.data||oe.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(oe,this._pendingRequest));const je=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(je,oe),this.loaded={};const Je={};return oe.request&&(Je.data=je),this._finishPerformance(pe,oe,Je),Je}catch(je){if(delete this._pendingRequest,N.Z(je))return{abandoned:!0};throw je}}))}_startPerformance(oe){var ce;if(!((ce=oe?.request)===null||ce===void 0)&&ce.collectResourceTiming)return new N.c_(oe.request)}_finishPerformance(oe,ce,pe){if(!oe)return;const je=oe.finish();je&&(pe.resourceTiming={},pe.resourceTiming[ce.source]=JSON.parse(JSON.stringify(je)))}getData(){return N._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(oe){const ce=this.loaded;return ce&&ce[oe.uid]?super.reloadTile(oe):this.loadTile(oe)}loadAndProcessGeoJSON(oe,ce){return N._(this,void 0,void 0,(function*(){let pe;if(oe.request?pe=yield this.loadGeoJSONFromUrl(oe.request,oe.promoteId,ce):oe.data?pe=this._loadGeoJSONFromObject(oe.data,oe.promoteId):oe.dataDiff&&(pe=this._loadGeoJSONFromDiff(oe.dataDiff,oe.promoteId,oe.source)),delete this._pendingRequest,typeof pe!="object")throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`);return Wt(pe,!0),oe.filter&&(pe=this._filterGeoJSON(pe,oe.filter)),pe}))}loadGeoJSONFromUrl(oe,ce,pe){return N._(this,void 0,void 0,(function*(){const je=yield N.j(oe,pe);return this._dataUpdateable=N.a7(je.data,ce),je.data}))}_loadGeoJSONFromObject(oe,ce){return this._dataUpdateable=N.a7(oe,ce),oe}_loadGeoJSONFromDiff(oe,ce,pe){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${pe}`);N.a8(this._dataUpdateable,oe,ce);const je=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(je)}_filterGeoJSON(oe,ce){const pe=N.d3(ce,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map((Je=>`${Je.key}: ${Je.message}`)).join(", "));const je=oe.features.filter((Je=>pe.value.evaluate({zoom:0},Je)));return this._toFeatureCollection(je)}_toFeatureCollection(oe){return{type:"FeatureCollection",features:oe}}removeSource(oe){return N._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(oe){return this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId)}getClusterChildren(oe){return this._geoJSONIndex.getChildren(oe.clusterId)}getClusterLeaves(oe){return this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset)}}function Pi(gt,oe){return oe.cluster?new He((function({superclusterOptions:ce,clusterProperties:pe}){if(!pe||!ce)return ce;const je={},Je={},St={accumulated:null,zoom:0},rt={properties:null},de=Object.keys(pe);for(const Ze of de){const[yt,Oe]=pe[Ze],At=N.d3(Oe),jt=N.d3(typeof yt=="string"?[yt,["accumulated"],["get",Ze]]:yt);je[Ze]=At.value,Je[Ze]=jt.value}return ce.map=Ze=>{rt.properties=Ze;const yt={};for(const Oe of de)yt[Oe]=je[Oe].evaluate(St,rt);return yt},ce.reduce=(Ze,yt)=>{rt.properties=yt;for(const Oe of de)St.accumulated=Ze[Oe],Ze[Oe]=Je[Oe].evaluate(St,rt)},ce})(oe)).load(gt.features):(function(ce,pe){return new nn(ce,pe)})(gt,oe.geojsonVtOptions)}class xr{constructor(oe){this.self=oe,this.actor=new N.L(oe),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(ce,pe)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=pe},this.self.addProtocol=N.cJ,this.self.removeProtocol=N.cK,this.self.registerRTLTextPlugin=ce=>{N.d4.setMethods(ce)},this.actor.registerMessageHandler("LDT",((ce,pe)=>this._getDEMWorkerSource(ce,pe.source).loadTile(pe))),this.actor.registerMessageHandler("RDT",((ce,pe)=>N._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(ce,pe.source).removeTile(pe)})))),this.actor.registerMessageHandler("GCEZ",((ce,pe)=>N._(this,void 0,void 0,(function*(){return this._getWorkerSource(ce,pe.type,pe.source).getClusterExpansionZoom(pe)})))),this.actor.registerMessageHandler("GCC",((ce,pe)=>N._(this,void 0,void 0,(function*(){return this._getWorkerSource(ce,pe.type,pe.source).getClusterChildren(pe)})))),this.actor.registerMessageHandler("GCL",((ce,pe)=>N._(this,void 0,void 0,(function*(){return this._getWorkerSource(ce,pe.type,pe.source).getClusterLeaves(pe)})))),this.actor.registerMessageHandler("LD",((ce,pe)=>this._getWorkerSource(ce,pe.type,pe.source).loadData(pe))),this.actor.registerMessageHandler("GD",((ce,pe)=>this._getWorkerSource(ce,pe.type,pe.source).getData())),this.actor.registerMessageHandler("LT",((ce,pe)=>this._getWorkerSource(ce,pe.type,pe.source).loadTile(pe))),this.actor.registerMessageHandler("RT",((ce,pe)=>this._getWorkerSource(ce,pe.type,pe.source).reloadTile(pe))),this.actor.registerMessageHandler("AT",((ce,pe)=>this._getWorkerSource(ce,pe.type,pe.source).abortTile(pe))),this.actor.registerMessageHandler("RMT",((ce,pe)=>this._getWorkerSource(ce,pe.type,pe.source).removeTile(pe))),this.actor.registerMessageHandler("RS",((ce,pe)=>N._(this,void 0,void 0,(function*(){if(!this.workerSources[ce]||!this.workerSources[ce][pe.type]||!this.workerSources[ce][pe.type][pe.source])return;const je=this.workerSources[ce][pe.type][pe.source];delete this.workerSources[ce][pe.type][pe.source],je.removeSource!==void 0&&je.removeSource(pe)})))),this.actor.registerMessageHandler("RM",(ce=>N._(this,void 0,void 0,(function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce],this.globalStates.delete(ce)})))),this.actor.registerMessageHandler("SR",((ce,pe)=>N._(this,void 0,void 0,(function*(){this.referrer=pe})))),this.actor.registerMessageHandler("SRPS",((ce,pe)=>this._syncRTLPluginState(ce,pe))),this.actor.registerMessageHandler("IS",((ce,pe)=>N._(this,void 0,void 0,(function*(){this.self.importScripts(pe)})))),this.actor.registerMessageHandler("SI",((ce,pe)=>this._setImages(ce,pe))),this.actor.registerMessageHandler("UL",((ce,pe)=>N._(this,void 0,void 0,(function*(){this._getLayerIndex(ce).update(pe.layers,pe.removedIds,this._getGlobalState(ce))})))),this.actor.registerMessageHandler("UGS",((ce,pe)=>N._(this,void 0,void 0,(function*(){const je=this._getGlobalState(ce);for(const Je in pe)je[Je]=pe[Je]})))),this.actor.registerMessageHandler("SL",((ce,pe)=>N._(this,void 0,void 0,(function*(){this._getLayerIndex(ce).replace(pe,this._getGlobalState(ce))}))))}_getGlobalState(oe){let ce=this.globalStates.get(oe);return ce||(ce={},this.globalStates.set(oe,ce)),ce}_setImages(oe,ce){return N._(this,void 0,void 0,(function*(){this.availableImages[oe]=ce;for(const pe in this.workerSources[oe]){const je=this.workerSources[oe][pe];for(const Je in je)je[Je].availableImages=ce}}))}_syncRTLPluginState(oe,ce){return N._(this,void 0,void 0,(function*(){return yield N.d4.syncState(ce,this.self.importScripts)}))}_getAvailableImages(oe){let ce=this.availableImages[oe];return ce||(ce=[]),ce}_getLayerIndex(oe){let ce=this.layerIndexes[oe];return ce||(ce=this.layerIndexes[oe]=new h),ce}_getWorkerSource(oe,ce,pe){if(this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][ce]||(this.workerSources[oe][ce]={}),!this.workerSources[oe][ce][pe]){const je={sendAsync:(Je,St)=>(Je.targetMapId=oe,this.actor.sendAsync(Je,St))};switch(ce){case"vector":this.workerSources[oe][ce][pe]=new he(je,this._getLayerIndex(oe),this._getAvailableImages(oe));break;case"geojson":this.workerSources[oe][ce][pe]=new Ki(je,this._getLayerIndex(oe),this._getAvailableImages(oe));break;default:this.workerSources[oe][ce][pe]=new this.externalWorkerSourceTypes[ce](je,this._getLayerIndex(oe),this._getAvailableImages(oe))}}return this.workerSources[oe][ce][pe]}_getDEMWorkerSource(oe,ce){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][ce]||(this.demWorkerSources[oe][ce]=new Re),this.demWorkerSources[oe][ce]}}return N.i(self)&&(self.worker=new xr(self)),xr})),D("index",["exports","./shared"],(function(N,h){var U="5.15.0";function H(){var A=new h.A(4);return h.A!=Float32Array&&(A[1]=0,A[2]=0),A[0]=1,A[3]=1,A}let Y,Q,_e;const we={frame(A,t,s){const f=requestAnimationFrame((S=>{x(),t(S)})),{unsubscribe:x}=h.s(A.signal,"abort",(()=>{x(),cancelAnimationFrame(f),s(new h.a(A.signal.reason))}),!1)},frameAsync(A){return new Promise(((t,s)=>{this.frame(A,t,s)}))},getImageData(A,t=0){return this.getImageCanvasContext(A).getImageData(-t,-t,A.width+2*t,A.height+2*t)},getImageCanvasContext(A){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=A.width,t.height=A.height,s.drawImage(A,0,0,A.width,A.height),s},resolveURL:A=>(Y||(Y=document.createElement("a")),Y.href=A,Y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return _e!==void 0?_e:!!matchMedia&&(Q==null&&(Q=matchMedia("(prefers-reduced-motion: reduce)")),Q.matches)},set prefersReducedMotion(A){_e=A}},ve=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(A){this._frozenAt=A}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function me(){return ve.getCurrentTime()}class he{static testProp(t){if(!he.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in he.docStyle)return t[s];return t[0]}static create(t,s,f){const x=window.document.createElement(t);return s!==void 0&&(x.className=s),f&&f.appendChild(x),x}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){he.docStyle&&he.selectProp&&(he.userSelect=he.docStyle[he.selectProp],he.docStyle[he.selectProp]="none")}static enableDrag(){he.docStyle&&he.selectProp&&(he.docStyle[he.selectProp]=he.userSelect)}static setTransform(t,s){t.style[he.transformProp]=s}static addEventListener(t,s,f,x={}){t.addEventListener(s,f,"passive"in x?x:x.capture)}static removeEventListener(t,s,f,x={}){t.removeEventListener(s,f,"passive"in x?x:x.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",he.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",he.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",he.suppressClickInternal,!0)}),0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,f){const x=s.boundingClientRect;return new h.P((f.clientX-x.left)/s.x-t.clientLeft,(f.clientY-x.top)/s.y-t.clientTop)}static mousePos(t,s){const f=he.getScale(t);return he.getPoint(t,f,s)}static touchPos(t,s){const f=[],x=he.getScale(t);for(let S=0;S<s.length;S++)f.push(he.getPoint(t,x,s[S]));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const s=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),f=s.querySelectorAll("script");for(const x of f)x.remove();return he.clean(s),s.innerHTML}static isPossiblyDangerous(t,s){const f=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!f.includes("javascript:")&&!f.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const s=t.children;for(const f of s)he.removeAttributes(f),he.clean(f)}static removeAttributes(t){for(const{name:s,value:f}of t.attributes)he.isPossiblyDangerous(s,f)&&t.removeAttribute(s)}}he.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,he.selectProp=he.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),he.transformProp=he.testProp(["transform","WebkitTransform"]);const Re={supported:!1,testSupport:function(A){!pt&&Ye&&(Wt?Et(A):tt=A)}};let tt,Ye,pt=!1,Wt=!1;function Et(A){const t=A.createTexture();A.bindTexture(A.TEXTURE_2D,t);try{if(A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,Ye),A.isContextLost())return;Re.supported=!0}catch{}A.deleteTexture(t),pt=!0}var it;typeof document<"u"&&(Ye=document.createElement("img"),Ye.onload=()=>{tt&&Et(tt),tt=null,Wt=!0},Ye.onerror=()=>{pt=!0,tt=null},Ye.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(A){let t,s,f,x;A.resetRequestQueue=()=>{t=[],s=0,f=0,x={}},A.addThrottleControl=j=>{const Z=f++;return x[Z]=j,Z},A.removeThrottleControl=j=>{delete x[j],k()},A.getImage=(j,Z,W=!0)=>new Promise(((ee,J)=>{Re.supported&&(j.headers||(j.headers={}),j.headers.accept="image/webp,*/*"),h.e(j,{type:"image"}),t.push({abortController:Z,requestParameters:j,supportImageRefresh:W,state:"queued",onError:se=>{J(se)},onSuccess:se=>{ee(se)}}),k()}));const S=j=>h._(this,void 0,void 0,(function*(){j.state="running";const{requestParameters:Z,supportImageRefresh:W,onError:ee,onSuccess:J,abortController:se}=j,fe=W===!1&&!h.i(self)&&!h.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce(((Ie,Be)=>Ie&&Be==="accept"),!0));s++;const Ce=fe?z(Z,se):h.m(Z,se);try{const Ie=yield Ce;delete j.abortController,j.state="completed",Ie.data instanceof HTMLImageElement||h.b(Ie.data)?J(Ie):Ie.data&&J({data:yield(Me=Ie.data,typeof createImageBitmap=="function"?h.f(Me):h.h(Me)),cacheControl:Ie.cacheControl,expires:Ie.expires})}catch(Ie){delete j.abortController,ee(Ie)}finally{s--,k()}var Me})),k=()=>{const j=(()=>{for(const Z of Object.keys(x))if(x[Z]())return!0;return!1})()?h.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=s;Z<j&&t.length>0;Z++){const W=t.shift();W.abortController.signal.aborted?Z--:S(W)}},z=(j,Z)=>new Promise(((W,ee)=>{const J=new Image,se=j.url,fe=j.credentials;fe&&fe==="include"?J.crossOrigin="use-credentials":(fe&&fe==="same-origin"||!h.d(se))&&(J.crossOrigin="anonymous"),Z.signal.addEventListener("abort",(()=>{J.src="",ee(new h.a(Z.signal.reason))})),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,W({data:J})},J.onerror=()=>{J.onerror=J.onload=null,Z.signal.aborted||ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=se}))})(it||(it={})),it.resetRequestQueue();class at{constructor(t){this._transformRequestFn=t??null}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function He(A){const t=[];if(typeof A=="string")t.push({id:"default",url:A});else if(A&&A.length>0){const s=[];for(const{id:f,url:x}of A){const S=`${f}${x}`;s.indexOf(S)===-1&&(s.push(S),t.push({id:f,url:x}))}}return t}function xt(A,t,s){try{const f=new URL(A);return f.pathname+=`${t}${s}`,f.toString()}catch{throw new Error(`Invalid sprite URL "${A}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Pe(A){const{userImage:t}=A;return!!(t&&t.render&&t.render())&&(A.data.replace(new Uint8Array(t.data.buffer)),!0)}class ct extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:f}of this.requestors)f(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const f=s.spriteData;s.data=new h.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let f=!0;const x=s.data||s.spriteData;return this._validateStretch(s.stretchX,x&&x.width)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(s.stretchY,x&&x.height)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(s.content,s)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,s){if(!t)return!0;let f=0;for(const x of t){if(x[0]<f||x[1]<x[0]||s<x[1])return!1;f=x[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const f=s.spriteData,x=f&&f.width||s.data.width,S=f&&f.height||s.data.height;return!(t[0]<0||x<t[0]||t[1]<0||S<t[1]||t[2]<0||x<t[2]||t[3]<0||S<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,f=!0){const x=this.getImage(t);if(f&&(x.data.width!==s.data.width||x.data.height!==s.data.height))throw new Error(`size mismatch between old image (${x.data.width}x${x.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=x.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((s,f)=>{let x=!0;if(!this.isLoaded())for(const S of t)this.images[S]||(x=!1);this.isLoaded()||x?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})}))}_getImagesForIds(t){const s={};for(const f of t){let x=this.getImage(f);x||(this.fire(new h.l("styleimagemissing",{id:f})),x=this.getImage(f)),x?s[f]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,textFitWidth:x.textFitWidth,textFitHeight:x.textFitHeight,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:h.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],f=this.getImage(t);if(!f)return null;if(s&&s.position.version===f.version)return s.position;if(s)s.position.version=f.version;else{const x={w:f.data.width+2,h:f.data.height+2,x:0,y:0},S=new h.I(x,f);this.patterns[t]={bin:x,position:S}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.T(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const S in this.patterns)t.push(this.patterns[S].bin);const{w:s,h:f}=h.p(t),x=this.atlasImage;x.resize({width:s||1,height:f||1});for(const S in this.patterns){const{bin:k}=this.patterns[S],z=k.x+1,j=k.y+1,Z=this.getImage(S).data,W=Z.width,ee=Z.height;h.R.copy(Z,x,{x:0,y:0},{x:z,y:j},{width:W,height:ee}),h.R.copy(Z,x,{x:0,y:ee-1},{x:z,y:j-1},{width:W,height:1}),h.R.copy(Z,x,{x:0,y:0},{x:z,y:j+ee},{width:W,height:1}),h.R.copy(Z,x,{x:W-1,y:0},{x:z-1,y:j},{width:1,height:ee}),h.R.copy(Z,x,{x:0,y:0},{x:z+W,y:j},{width:1,height:ee})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const f=this.getImage(s);f||h.w(`Image with ID: "${s}" was not found`),Pe(f)&&this.updateImage(s,f)}}cloneImages(){const t={};for(const s in this.images){const f=this.images[s];t[s]=Object.assign(Object.assign({},f),{data:f.data?f.data.clone():null})}return t}}const vt=1e20;function Zt(A,t,s,f,x,S,k,z,j){for(let Z=t;Z<t+f;Z++)Ne(A,s*S+Z,S,x,k,z,j);for(let Z=s;Z<s+x;Z++)Ne(A,Z*S+t,1,f,k,z,j)}function Ne(A,t,s,f,x,S,k){S[0]=0,k[0]=-vt,k[1]=vt,x[0]=A[t];for(let z=1,j=0,Z=0;z<f;z++){x[z]=A[t+z*s];const W=z*z;do{const ee=S[j];Z=(x[z]-x[ee]+W-ee*ee)/(z-ee)/2}while(Z<=k[j]&&--j>-1);j++,S[j]=z,k[j]=Z,k[j+1]=vt}for(let z=0,j=0;z<f;z++){for(;k[j+1]<z;)j++;const Z=S[j],W=z-Z;A[t+z*s]=x[Z]+W*W}}const Te=h.v.layout_symbol["text-font"].default.join(",");class We{constructor(t,s,f){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={},this.lang=f}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,(function*(){const s=[];for(const S in t)for(const k of t[S])s.push(this._getAndCacheGlyphsPromise(S,k));const f=yield Promise.all(s),x={};for(const{stack:S,id:k,glyph:z}of f)x[S]||(x[S]={}),x[S][k]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};return x}))}_getAndCacheGlyphsPromise(t,s){return h._(this,void 0,void 0,(function*(){let f=this.entries[t];f||(f=this.entries[t]={glyphs:{},requests:{},ranges:{}});let x=f.glyphs[s];return x!==void 0?{stack:t,id:s,glyph:x}:!this.url||this._charUsesLocalIdeographFontFamily(s)?(x=f.glyphs[s]=this._drawGlyph(f,t,s),{stack:t,id:s,glyph:x}):yield this._downloadAndCacheRangePromise(t,s)}))}_downloadAndCacheRangePromise(t,s){return h._(this,void 0,void 0,(function*(){const f=this.entries[t],x=Math.floor(s/256);if(f.ranges[x])return{stack:t,id:s,glyph:null};if(!f.requests[x]){const S=We.loadGlyphRange(t,x,this.url,this.requestManager);f.requests[x]=S}try{const S=yield f.requests[x];for(const k in S)f.glyphs[+k]=S[+k];return f.ranges[x]=!0,{stack:t,id:s,glyph:S[s]||null}}catch(S){const k=f.glyphs[s]=this._drawGlyph(f,t,s);return this._warnOnMissingGlyphRange(k,x,s,S),{stack:t,id:s,glyph:k}}}))}_warnOnMissingGlyphRange(t,s,f,x){const S=256*s,k=S+255,z=f.toString(16).padStart(4,"0").toUpperCase();h.w(`Unable to load glyph range ${s}, ${S}-${k}. Rendering codepoint U+${z} locally instead. ${x}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&h.q(t)}_drawGlyph(t,s,f){const x=s===Te&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(f),S=x?"ideographTinySDF":"tinySDF";t[S]||(t[S]=this._createTinySDF(x?this.localIdeographFontFamily:s));const k=t[S].draw(String.fromCodePoint(f));return{id:f,bitmap:new h.r({width:k.width||60,height:k.height||60},k.data),metrics:{width:k.glyphWidth/2||24,height:k.glyphHeight/2||24,left:k.glyphLeft/2+.5||0,top:k.glyphTop/2-27.5||-8,advance:k.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const s=t?t.split(","):[];s.push("sans-serif");const f=s.map((x=>/[-\w]+/.test(x)?x:`'${CSS.escape(x)}'`)).join(",");return new We.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:this._fontWeight(s[0]),fontStyle:this._fontStyle(s[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const s={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let f;for(const[x,S]of Object.entries(s))new RegExp(`\\b${x}\\b`,"i").test(t)&&(f=`${S}`);return f}destroy(){for(const t in this.entries){const s=this.entries[t];s.tinySDF&&(s.tinySDF=null),s.ideographTinySDF&&(s.ideographTinySDF=null),s.glyphs={},s.requests={},s.ranges={}}this.entries={}}}We.loadGlyphRange=function(A,t,s,f){return h._(this,void 0,void 0,(function*(){const x=256*t,S=x+255,k=f.transformRequest(s.replace("{fontstack}",A).replace("{range}",`${x}-${S}`),"Glyphs"),z=yield h.n(k,new AbortController);if(!z||!z.data)throw new Error(`Could not load glyph range. range: ${t}, ${x}-${S}`);const j={};for(const Z of h.o(z.data))j[Z.id]=Z;return j}))},We.TinySDF=class{constructor({fontSize:A=24,buffer:t=3,radius:s=8,cutoff:f=.25,fontFamily:x="sans-serif",fontWeight:S="normal",fontStyle:k="normal",lang:z=null}={}){this.buffer=t,this.cutoff=f,this.radius=s,this.lang=z;const j=this.size=A+4*t,Z=this._createCanvas(j),W=this.ctx=Z.getContext("2d",{willReadFrequently:!0});W.font=`${k} ${S} ${A}px ${x}`,W.textBaseline="alphabetic",W.textAlign="left",W.fillStyle="black",this.gridOuter=new Float64Array(j*j),this.gridInner=new Float64Array(j*j),this.f=new Float64Array(j),this.z=new Float64Array(j+1),this.v=new Uint16Array(j)}_createCanvas(A){const t=document.createElement("canvas");return t.width=t.height=A,t}draw(A){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:f,actualBoundingBoxLeft:x,actualBoundingBoxRight:S}=this.ctx.measureText(A),k=Math.ceil(s),z=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-x))),j=Math.min(this.size-this.buffer,k+Math.ceil(f)),Z=z+2*this.buffer,W=j+2*this.buffer,ee=Math.max(Z*W,0),J=new Uint8ClampedArray(ee),se={data:J,width:Z,height:W,glyphWidth:z,glyphHeight:j,glyphTop:k,glyphLeft:0,glyphAdvance:t};if(z===0||j===0)return se;const{ctx:fe,buffer:Ce,gridInner:Me,gridOuter:Ie}=this;this.lang&&(fe.lang=this.lang),fe.clearRect(Ce,Ce,z,j),fe.fillText(A,Ce,Ce+k);const Be=fe.getImageData(Ce,Ce,z,j);Ie.fill(vt,0,ee),Me.fill(0,0,ee);for(let Qe=0;Qe<j;Qe++)for(let Le=0;Le<z;Le++){const $e=Be.data[4*(Qe*z+Le)+3]/255;if($e===0)continue;const st=(Qe+Ce)*Z+Le+Ce;if($e===1)Ie[st]=0,Me[st]=vt;else{const Ve=.5-$e;Ie[st]=Ve>0?Ve*Ve:0,Me[st]=Ve<0?Ve*Ve:0}}Zt(Ie,0,0,Z,W,Z,this.f,this.v,this.z),Zt(Me,Ce,Ce,z,j,Z,this.f,this.v,this.z);for(let Qe=0;Qe<ee;Qe++){const Le=Math.sqrt(Ie[Qe])-Math.sqrt(Me[Qe]);J[Qe]=Math.round(255-255*(Le/this.radius+this.cutoff))}return se}};class wt{constructor(){this.specification=h.u.light.position}possiblyEvaluate(t,s){return h.F(t.expression.evaluate(s))}interpolate(t,s,f){return{x:h.G.number(t.x,s.x,f),y:h.G.number(t.y,s.y,f),z:h.G.number(t.z,s.z,f)}}}let zt;class Gt extends h.E{constructor(t){super(),zt=zt||new h.t({anchor:new h.D(h.u.light.anchor),position:new wt,color:new h.D(h.u.light.color),intensity:new h.D(h.u.light.intensity)}),this._transitionable=new h.x(zt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(h.y,t,s))for(const f in t){const x=t[f];f.endsWith(h.z)?this._transitionable.setTransition(f.slice(0,-h.z.length),x):this._transitionable.setValue(f,x)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,f){return(!f||f.validate!==!1)&&h.B(this,t.call(h.C,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.u}))}}const ke=new h.t({"sky-color":new h.D(h.u.sky["sky-color"]),"horizon-color":new h.D(h.u.sky["horizon-color"]),"fog-color":new h.D(h.u.sky["fog-color"]),"fog-ground-blend":new h.D(h.u.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.u.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.u.sky["atmosphere-blend"])});class nt extends h.E{constructor(t){super(),this._transitionable=new h.x(ke,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0))}setSky(t,s={}){if(!this._validate(h.J,t,s)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in t){const x=t[f];f.endsWith(h.z)?this._transitionable.setTransition(f.slice(0,-h.z.length),x):this._transitionable.setValue(f,x)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,f={}){return f?.validate!==!1&&h.B(this,t.call(h.C,h.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Nt{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const f=t.join(",")+String(s);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(t,s)),this.dashEntry[f]}getDashRanges(t,s,f){const x=[];let S=t.length%2==1?-t[t.length-1]*f:0,k=t[0]*f,z=!0;x.push({left:S,right:k,isDash:z,zeroLength:t[0]===0});let j=t[0];for(let Z=1;Z<t.length;Z++){z=!z;const W=t[Z];S=j*f,j+=W,k=j*f,x.push({left:S,right:k,isDash:z,zeroLength:W===0})}return x}addRoundDash(t,s,f){const x=s/2;for(let S=-f;S<=f;S++){const k=this.width*(this.nextRow+f+S);let z=0,j=t[z];for(let Z=0;Z<this.width;Z++){Z/j.right>1&&(j=t[++z]);const W=Math.abs(Z-j.left),ee=Math.abs(Z-j.right),J=Math.min(W,ee);let se;const fe=S/f*(x+1);if(j.isDash){const Ce=x-Math.abs(fe);se=Math.sqrt(J*J+Ce*Ce)}else se=x-Math.sqrt(J*J+fe*fe);this.data[k+Z]=Math.max(0,Math.min(255,se+128))}}}addRegularDash(t){for(let z=t.length-1;z>=0;--z){const j=t[z],Z=t[z+1];j.zeroLength?t.splice(z,1):Z&&Z.isDash===j.isDash&&(Z.left=j.left,t.splice(z,1))}const s=t[0],f=t[t.length-1];s.isDash===f.isDash&&(s.left=f.left-this.width,f.right=s.right+this.width);const x=this.width*this.nextRow;let S=0,k=t[S];for(let z=0;z<this.width;z++){z/k.right>1&&(k=t[++S]);const j=Math.abs(z-k.left),Z=Math.abs(z-k.right),W=Math.min(j,Z);this.data[x+z]=Math.max(0,Math.min(255,(k.isDash?W:-W)+128))}}addDash(t,s){const f=s?7:0,x=2*f+1;if(this.nextRow+x>this.height)return h.w("LineAtlas out of space"),null;let S=0;for(let z=0;z<t.length;z++)S+=t[z];if(S!==0){const z=this.width/S,j=this.getDashRanges(t,this.width,z);s?this.addRoundDash(j,z,f):this.addRegularDash(j)}const k={y:this.nextRow+f,height:2*f,width:S};return this.nextRow+=x,this.dirty=!0,k}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const _t="maplibre_preloaded_worker_pool";class tn{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<tn.workerCount;)this.workers.push(new Worker(h.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[_t]}numActive(){return Object.keys(this.active).length}}const Bt=Math.floor(we.hardwareConcurrency/2);let Kt,an;function sn(){return Kt||(Kt=new tn),Kt}tn.workerCount=h.K(globalThis)?Math.max(Math.min(Bt,3),1):1;class Nn{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const f=this.workerPool.acquire(s);for(let x=0;x<f.length;x++){const S=new h.L(f[x],s);S.name=`Worker ${x}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const f=[];for(const x of this.actors)f.push(x.sendAsync({type:t,data:s}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const f of this.actors)f.registerMessageHandler(t,s)}unregisterMessageHandler(t){for(const s of this.actors)s.unregisterMessageHandler(t)}}function Dn(){return an||(an=new Nn(sn(),h.M),an.registerMessageHandler("GR",((A,t,s)=>h.m(t,s)))),an}function si(A,t){const s=h.N();return h.O(s,s,[1,1,0]),h.Q(s,s,[.5*A.width,.5*A.height,1]),A.calculatePosMatrix?h.S(s,s,A.calculatePosMatrix(t.toUnwrapped())):s}function kn(A,t,s,f,x,S,k){var z;const j=(function(J,se,fe){if(J)for(const Ce of J){const Me=se[Ce];if(Me&&Me.source===fe&&Me.type==="fill-extrusion")return!0}else for(const Ce in se){const Me=se[Ce];if(Me.source===fe&&Me.type==="fill-extrusion")return!0}return!1})((z=x?.layers)!==null&&z!==void 0?z:null,t,A.id),Z=S.maxPitchScaleFactor(),W=A.tilesIn(f,Z,j);W.sort(ui);const ee=[];for(const J of W)ee.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(t,s,A.getState(),J.queryGeometry,J.cameraQueryGeometry,J.scale,x,S,Z,si(S,J.tileID),k?(se,fe)=>k(J.tileID,se,fe):void 0)});return(function(J,se){for(const fe in J)for(const Ce of J[fe])_i(Ce,se);return J})((function(J){const se={},fe={};for(const Ce of J){const Me=Ce.queryResults,Ie=Ce.wrappedTileID,Be=fe[Ie]=fe[Ie]||{};for(const Qe in Me){const Le=Me[Qe],$e=Be[Qe]=Be[Qe]||{},st=se[Qe]=se[Qe]||[];for(const Ve of Le)$e[Ve.featureIndex]||($e[Ve.featureIndex]=!0,st.push(Ve))}}return se})(ee),A)}function ui(A,t){const s=A.tileID,f=t.tileID;return s.overscaledZ-f.overscaledZ||s.canonical.y-f.canonical.y||s.wrap-f.wrap||s.canonical.x-f.canonical.x}function _i(A,t){const s=A.feature,f=t.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=f}function Di(A,t,s){return h._(this,void 0,void 0,(function*(){let f=A;if(A.url?f=(yield h.j(t.transformRequest(A.url,"Source"),s)).data:yield we.frameAsync(s),!f)return null;const x=h.U(h.e(f,A),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(x.vectorLayerIds=f.vector_layers.map((S=>S.id))),x}))}class qn{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.V?new h.V(t.lng,t.lat):h.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.V?new h.V(t.lng,t.lat):h.V.convert(t),this}extend(t){const s=this._sw,f=this._ne;let x,S;if(t instanceof h.V)x=t,S=t;else{if(!(t instanceof qn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(qn.convert(t)):this.extend(h.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.V.convert(t)):this;if(x=t._sw,S=t._ne,!x||!S)return this}return s||f?(s.lng=Math.min(x.lng,s.lng),s.lat=Math.min(x.lat,s.lat),f.lng=Math.max(S.lng,f.lng),f.lat=Math.max(S.lat,f.lat)):(this._sw=new h.V(x.lng,x.lat),this._ne=new h.V(S.lng,S.lat)),this}getCenter(){return new h.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.V(this.getWest(),this.getNorth())}getSouthEast(){return new h.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:f}=h.V.convert(t);let x=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&x}intersects(t){if(!((t=qn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const s=Math.abs(this.getEast()-this.getWest()),f=Math.abs(t.getEast()-t.getWest());if(s>=360||f>=360)return!0;const x=h.W(this.getWest(),-180,180),S=h.W(this.getEast(),-180,180),k=h.W(t.getWest(),-180,180),z=h.W(t.getEast(),-180,180),j=x>=S,Z=k>=z;return!(!j||!Z)||(j?z>=x||k<=S:Z?S>=k||x<=z:k<=S&&z>=x)}static convert(t){return t instanceof qn?t:t&&new qn(t)}static fromLngLat(t,s=0){const f=360*s/40075017,x=f/Math.cos(Math.PI/180*t.lat);return new qn(new h.V(t.lng-x,t.lat-f),new h.V(t.lng+x,t.lat+f))}adjustAntiMeridian(){const t=new h.V(this._sw.lng,this._sw.lat),s=new h.V(this._ne.lng,this._ne.lat);return new qn(t,t.lng>s.lng?new h.V(s.lng+360,s.lat):s)}}class Gn{constructor(t,s,f){this.bounds=qn.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),f=Math.floor(h.Y(this.bounds.getWest())*s),x=Math.floor(h.X(this.bounds.getNorth())*s),S=Math.ceil(h.Y(this.bounds.getEast())*s),k=Math.ceil(h.X(this.bounds.getSouth())*s);return t.x>=f&&t.x<S&&t.y>=x&&t.y<k}}class In extends h.E{constructor(t,s,f,x){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.U(s,["url","scheme","tileSize","promoteId","encoding"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Di(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new Gn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,h.Z(t)||this.fire(new h.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};f.request.collectResourceTiming=this._collectResourceTiming;let x="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((S,k)=>{t.reloadPromise={resolve:S,reject:k}}))}else t.actor=this.dispatcher.getActor(),x="LT";t.abortController=new AbortController;try{const S=yield t.actor.sendAsync({type:x,data:f},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,S)}catch(S){if(delete t.abortController,t.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const s=t.tileID.scaledTo(this.maxzoom).canonical,f=s.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:s,overzoomRequest:this.map._requestManager.transformRequest(f,"Tile")}}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const f=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(f.resolve).catch(f.reject)}}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class vi extends h.E{constructor(t,s,f,x){super(),this.id=t,this.dispatcher=f,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.U(s,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Di(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(h.e(this,s),s.bounds&&(this.tileBounds=new Gn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,h.Z(s)||this.fire(new h.k(s))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const f=yield it.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const x=this.map.painter.context,S=x.gl,k=f.data;t.texture=this.map.painter.getTileTexture(k.width),t.texture?t.texture.update(k,{useMipmap:!0}):(t.texture=new h.T(x,k,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class nn extends vi{constructor(t,s,f,x){super(t,s,f,x),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const x=yield it.getImage(f,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(x&&x.data){const S=x.data;this.map._refreshExpiredTiles&&(x.cacheControl||x.expires)&&t.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const k=h.b(S)&&h.$()?S:yield this.readImageNow(S),z={type:this.type,uid:t.uid,source:this.id,rawImageData:k,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const j=yield t.actor.sendAsync({type:"LDT",data:z});t.dem=j,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(x){if(delete t.abortController,t.aborted)t.state="unloaded";else if(x)throw t.state="errored",x}}))}readImageNow(t){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.a0()){const s=t.width+2,f=t.height+2;try{return new h.R({width:s,height:f},yield h.a1(t,-1,-1,s,f))}catch{}}return we.getImageData(t,1)}))}_getNeighboringTiles(t){const s=t.canonical,f=Math.pow(2,s.z),x=(s.x-1+f)%f,S=s.x===0?t.wrap-1:t.wrap,k=(s.x+1+f)%f,z=s.x+1===f?t.wrap+1:t.wrap,j={};return j[new h.a2(t.overscaledZ,S,s.z,x,s.y).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,k,s.y).key]={backfilled:!1},s.y>0&&(j[new h.a2(t.overscaledZ,S,s.z,x,s.y-1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,k,s.y-1).key]={backfilled:!1}),s.y+1<f&&(j[new h.a2(t.overscaledZ,S,s.z,x,s.y+1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,k,s.y+1).key]={backfilled:!1}),j}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Li(A){return A.type==="GeometryCollection"?A.geometries.map((t=>t.coordinates)).flat(1/0):A.coordinates.flat(1/0)}function Ki(A){const t=new qn;let s;switch(A.type){case"FeatureCollection":s=A.features.map((f=>Li(f.geometry))).flat(1/0);break;case"Feature":s=Li(A.geometry);break;default:s=Li(A)}if(s.length==0)return t;for(let f=0;f<s.length-1;f+=2)t.extend([s[f],s[f+1]]);return t}class Pi extends h.E{constructor(t,s,f,x){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:s.data},this.actor=f.getActor(),this.setEventedParent(x),this._data=typeof s.data=="string"?{url:s.data}:{geojson:s.data},this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:h.a5,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.a5,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(h.a5/this.tileSize)}_getClusterMaxZoom(t){const s=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||h.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${s}"`),s}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,s){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const f=this._updateWorkerData();return s?f:this}updateData(t,s){this._pendingWorkerUpdate.diff=h.a6(this._pendingWorkerUpdate.diff,t);const f=this._updateWorkerData();return s?f:this}getData(){return h._(this,void 0,void 0,(function*(){const t=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return h._(this,void 0,void 0,(function*(){return Ki(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:f}})}_updateWorkerData(){return h._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void h.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:s}=this._pendingWorkerUpdate,f=h.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(f.request=this.map._requestManager.transformRequest(we.resolveURL(t),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=t,this._pendingWorkerUpdate.data=void 0):s&&(f.dataDiff=s,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new h.l("dataloading",{dataType:"source"}));try{const x=yield this.actor.sendAsync({type:"LD",data:f});if(this._isUpdatingWorker=!1,this._removed||x.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));x.data&&(this._data={geojson:x.data});const S=this._applyDiffToSource(s),k=this._getShouldReloadTileOptions(S);let z=null;x.resourceTiming&&x.resourceTiming[this.id]&&(z=x.resourceTiming[this.id].slice(0));const j={dataType:"source"};this._collectResourceTiming&&z&&z.length>0&&h.e(j,{resourceTiming:z}),this.fire(new h.l("data",Object.assign(Object.assign({},j),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},j),{sourceDataType:"content",shouldReloadTileOptions:k})))}catch(x){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(x))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const s=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const x=h.a7(this._data.geojson,s);if(!x)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:x}}if(!this._data.updateable)return;const f=h.a8(this._data.updateable,t,s);return t.removeAll||this._options.cluster?void 0:f}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((s=>Ki(s)))}}shouldReloadTile(t,{affectedBounds:s}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:f,extent:x}=this.workerOptions.geojsonVtOptions,S=(function({x:k,y:z,z:j},Z=0){const W=h.a3((k-Z)/Math.pow(2,j)),ee=h.a4((z+1+Z)/Math.pow(2,j)),J=h.a3((k+1+Z)/Math.pow(2,j)),se=h.a4((z-Z)/Math.pow(2,j));return new qn([W,ee],[J,se])})(t.tileID.canonical,f/x);for(const k of s)if(S.intersects(k))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const x=yield this.actor.sendAsync({type:s,data:f},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(x,this.map.painter,s==="RT")}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class xr extends h.E{constructor(t,s,f,x){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=f,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=s}load(t){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield it.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,h.Z(s)||this.fire(new h.k(s))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(h.a9.fromLngLat);var f;return this.tileID=(function(x){const S=h.aa.fromPoints(x),k=S.width(),z=S.height(),j=Math.max(k,z),Z=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),W=Math.pow(2,Z);return new h.ac(Z,Math.floor((S.minX+S.maxX)/2*W),Math.floor((S.minY+S.maxY)/2*W))})(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map((x=>this.tileID.getTilePoint(x)._round())),this.flippedWindingOrder=((f=this.tileCoords)[1].x-f[0].x)*(f[2].y-f[0].y)-(f[1].y-f[0].y)*(f[2].x-f[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture||(this.texture=new h.T(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let f=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,f=!0)}f&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:s,minY:f,maxX:x,maxY:S}=h.aa.fromPoints(t),k={};for(let z=0;z<=h.ab;z++){const j=Math.pow(2,z),Z=Math.floor(s*j),W=Math.floor(f*j),ee=Math.floor(x*j),J=Math.floor(S*j);k[z]={minTileX:Z,minTileY:W,maxTileX:ee,maxTileY:J}}return k}}class gt extends xr{constructor(t,s,f,x){super(t,s,f,x),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.ad(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.k(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new h.k(new h.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let f=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,f=!0)}f&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class oe extends xr{constructor(t,s,f,x){super(t,s,f,x),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((k=>typeof k!="number"))))||this.fire(new h.k(new h.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.ae(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.k(new h.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,f=s.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new h.T(s,this.canvas,f.RGBA,{premultiply:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let x=!1;for(const S in this.tiles){const k=this.tiles[S];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,x=!0)}x&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const ce={},pe=A=>{switch(A){case"geojson":return Pi;case"image":return xr;case"raster":return vi;case"raster-dem":return nn;case"vector":return In;case"video":return gt;case"canvas":return oe}return ce[A]},je="RTLPluginLoaded";class Je extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Dn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return h._(this,arguments,void 0,(function*(s,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=we.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(je))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let St=null;function rt(){return St||(St=new Je),St}var de,Ze;(function(A){A[A.Base=0]="Base",A[A.Parent=1]="Parent"})(de||(de={})),(function(A){A[A.Departing=0]="Departing",A[A.Incoming=1]="Incoming"})(Ze||(Ze={}));class yt{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=h.af(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:s,fadingParentID:f,fadeEndTime:x}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=s,this.fadingParentID=f,this.fadeEndTime=x}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=me(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(x,S){const k={};if(!S)return k;for(const z of x){const j=z.layerIds.map((Z=>S.getLayer(Z))).filter(Boolean);if(j.length!==0){z.layers=j,z.stateDependentLayerIds&&(z.stateDependentLayers=z.stateDependentLayerIds.map((Z=>j.filter((W=>W.id===Z))[0])));for(const Z of j)k[Z.id]=z}}return k})(t.buckets,s?.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const S=this.buckets[x];if(S instanceof h.ah){if(this.hasSymbolBuckets=!0,!f)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const S=this.buckets[x];if(S instanceof h.ah&&S.hasRTLText){this.hasRTLText=!0,rt().lazyLoad();break}}this.queryPadding=0;for(const x in this.buckets){const S=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(x).queryRadius(S))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new h.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const f in this.buckets){const x=this.buckets[f];x.uploadPending()&&x.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h.T(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,f,x,S,k,z,j,Z,W,ee){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:S,scale:k,tileSize:this.tileSize,pixelPosMatrix:W,transform:j,params:z,queryPadding:this.queryPadding*Z,getElevation:ee},t,s,f):{}}querySourceFeatures(t,s){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const x=f.loadVTLayers(),S=s&&s.sourceLayer?s.sourceLayer:"",k=x[h.ai]||x[S];if(!k)return;const z=h.aj(s?.filter,s?.globalState),{z:j,x:Z,y:W}=this.tileID.canonical,ee={z:j,x:Z,y:W};for(let J=0;J<k.length;J++){const se=k.feature(J);if(z.needGeometry){const Me=h.ak(se,!0);if(!z.filter(new h.H(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!z.filter(new h.H(this.tileID.overscaledZ),se))continue;const fe=f.getId(se,S),Ce=new h.al(se,j,Z,W,fe);Ce.tile=ee,t.push(Ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const f=h.am(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let x=!1;if(this.expirationTime>f)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{const S=this.expirationTime-s;S?this.expirationTime=f+Math.max(S,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!s.style.hasLayer(x))continue;const S=this.buckets[x],k=S.layers[0].sourceLayer||h.ai,z=f[k],j=t[k];if(!z||!j||Object.keys(j).length===0)continue;S.update(j,z,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const Z=s&&s.style&&s.style.getLayer(x);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(S)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<me()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=me()+t}setDependencies(t,s){const f={};for(const x of s)f[x]=!0;this.dependencies[t]=f}hasDependency(t,s){for(const f of t){const x=this.dependencies[f];if(x){for(const S of s)if(x[S])return!0}}return!1}}class Oe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,f){const x=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][x]=this.stateChanges[t][x]||{},h.e(this.stateChanges[t][x],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const S in this.state[t])S!==x&&(this.deletedStates[t][S]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][x]===null){this.deletedStates[t][x]={};for(const S in this.state[t][x])f[S]||(this.deletedStates[t][x][S]=null)}else for(const S in f)this.deletedStates[t]&&this.deletedStates[t][x]&&this.deletedStates[t][x][S]===null&&delete this.deletedStates[t][x][S]}removeFeatureState(t,s,f){if(this.deletedStates[t]===null)return;const x=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&s!==void 0)this.deletedStates[t][x]!==null&&(this.deletedStates[t][x]=this.deletedStates[t][x]||{},this.deletedStates[t][x][f]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][x])for(f in this.deletedStates[t][x]={},this.stateChanges[t][x])this.deletedStates[t][x][f]=null;else this.deletedStates[t][x]=null;else this.deletedStates[t]=null}getState(t,s){const f=String(s),x=h.e({},(this.state[t]||{})[f],(this.stateChanges[t]||{})[f]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const S=this.deletedStates[t][s];if(S===null)return{};for(const k in S)delete x[k]}return x}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const f={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const S={};for(const k in this.stateChanges[x])this.state[x][k]||(this.state[x][k]={}),h.e(this.state[x][k],this.stateChanges[x][k]),S[k]=this.state[x][k];f[x]=S}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const S={};if(this.deletedStates[x]===null)for(const k in this.state[x])S[k]={},this.state[x][k]={};else for(const k in this.deletedStates[x]){if(this.deletedStates[x][k]===null)this.state[x][k]={};else for(const z of Object.keys(this.deletedStates[x][k]))delete this.state[x][k][z];S[k]=this.state[x][k]}f[x]=f[x]||{},h.e(f[x],S)}this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0&&t.setFeatureState(f,s)}}const At=89.25;function jt(A,t){const s=h.an(t.lat,-h.ao,h.ao);return new h.P(h.Y(t.lng)*A,h.X(s)*A)}function _n(A,t){return new h.a9(t.x/A,t.y/A).toLngLat()}function mn(A){return A.cameraToCenterDistance*Math.min(.85*Math.tan(h.ap(90-A.pitch)),Math.tan(h.ap(At-A.pitch)))}function ti(A,t){const s=A.canonical,f=t/h.aq(s.z),x=s.x+Math.pow(2,s.z)*A.wrap,S=h.ar(new Float64Array(16));return h.O(S,S,[x*f,s.y*f,0]),h.Q(S,S,[f/h.a5,f/h.a5,1]),S}function ut(A,t,s,f,x){const S=h.a9.fromLngLat(A,t),k=x*h.as(1,A.lat),{x:z,y:j,z:Z}=ai(s,f);return new h.a9(S.x+k*-z,S.y+k*-j,S.z+k*-Z)}function ai(A,t){const s=h.ap(A),f=h.ap(t),x=Math.cos(-s),S=Math.sin(s);return{x:S*Math.sin(f),y:-S*Math.cos(f),z:x}}function Qn(A,t,s){const f=t.intersectsFrustum(A);if(!s||f===0)return f;const x=t.intersectsPlane(s);return x===0?0:f===2&&x===2?2:1}function Kn(A,t,s){let f=0;const x=(s-t)/10;for(let S=0;S<10;S++)f+=x*Math.pow(Math.cos(t+(S+.5)/10*(s-t)),A);return f}function Jn(A,t){return function(s,f,x,S,k){const z=2*((A-1)/h.at(Math.cos(h.ap(At-k))/Math.cos(h.ap(At)))-1),j=Math.acos(x/S),Z=2*Kn(z-1,0,h.ap(k/2)),W=Math.min(h.ap(At),j+h.ap(k/2)),ee=Kn(z-1,Math.min(W,j-h.ap(k/2)),W),J=Math.atan(f/x),se=Math.hypot(f,x);let fe=s;return fe+=h.at(S/se/Math.max(.5,Math.cos(h.ap(k/2)))),fe+=z*h.at(Math.cos(J))/2,fe-=h.at(Math.max(1,ee/Z/t))/2,fe}}const lr=Jn(9.314,3);function Mi(A,t){const s=(t.roundZoom?Math.round:Math.floor)(A.zoom+h.at(A.tileSize/t.tileSize));return Math.max(0,s)}function ni(A,t){const s=A.getCameraFrustum(),f=A.getClippingPlane(),x=A.screenPointToMercatorCoordinate(A.getCameraPoint()),S=h.a9.fromLngLat(A.center,A.elevation);x.z=S.z+Math.cos(A.pitchInRadians)*A.cameraToCenterDistance/A.worldSize;const k=A.getCoveringTilesDetailsProvider(),z=k.allowVariableZoom(A,t),j=Mi(A,t),Z=t.minzoom||0,W=t.maxzoom!==void 0?t.maxzoom:A.maxZoom,ee=Math.min(Math.max(0,j),W),J=Math.pow(2,ee),se=[J*x.x,J*x.y,0],fe=[J*S.x,J*S.y,0],Ce=Math.hypot(S.x-x.x,S.y-x.y),Me=Math.abs(S.z-x.z),Ie=Math.hypot(Ce,Me),Be=$e=>({zoom:0,x:0,y:0,wrap:$e,fullyVisible:!1}),Qe=[],Le=[];if(A.renderWorldCopies&&k.allowWorldCopies())for(let $e=1;$e<=3;$e++)Qe.push(Be(-$e)),Qe.push(Be($e));for(Qe.push(Be(0));Qe.length>0;){const $e=Qe.pop(),st=$e.x,Ve=$e.y;let dt=$e.fullyVisible;const Lt={x:st,y:Ve,z:$e.zoom},Mt=k.getTileBoundingVolume(Lt,$e.wrap,A.elevation,t);if(!dt){const vn=Qn(s,Mt,f);if(vn===0)continue;dt=vn===2}const Pt=k.distanceToTile2d(x.x,x.y,Lt,Mt);let Ot=j;z&&(Ot=(t.calculateTileZoom||lr)(A.zoom+h.at(A.tileSize/t.tileSize),Pt,Me,Ie,A.fov)),Ot=(t.roundZoom?Math.round:Math.floor)(Ot),Ot=Math.max(0,Ot);const bn=Math.min(Ot,W);if($e.wrap=k.getWrap(S,Lt,$e.wrap),$e.zoom>=bn){if($e.zoom<Z)continue;const vn=ee-$e.zoom,on=se[0]-.5-(st<<vn),Cn=se[1]-.5-(Ve<<vn),Ni=t.reparseOverscaled?Math.max($e.zoom,Ot):$e.zoom;Le.push({tileID:new h.a2($e.zoom===W?Ni:$e.zoom,$e.wrap,$e.zoom,st,Ve),distanceSq:h.au([fe[0]-.5-st,fe[1]-.5-Ve]),tileDistanceToCamera:Math.sqrt(on*on+Cn*Cn)})}else for(let vn=0;vn<4;vn++)Qe.push({zoom:$e.zoom+1,x:(st<<1)+vn%2,y:(Ve<<1)+(vn>>1),wrap:$e.wrap,fullyVisible:dt})}return Le.sort((($e,st)=>$e.distanceSq-st.distanceSq)).map(($e=>$e.tileID))}const zi=h.aa.fromPoints([new h.P(0,0),new h.P(h.a5,h.a5)]);function Ei(A){return A==="raster"||A==="image"||A==="video"}function Bi(A,t,s,f,x,S,k){if(!t.hasData())return!1;const{tileID:z,fadingRole:j,fadingDirection:Z,fadingParentID:W}=t;if(j===de.Base&&Z===Ze.Incoming&&W)return s[W.key]=W,!0;const ee=Math.max(z.overscaledZ-x,S);for(let J=z.overscaledZ-1;J>=ee;J--){const se=z.scaledTo(J),fe=A.getLoadedTile(se);if(fe)return t.setCrossFadeLogic({fadingRole:de.Base,fadingDirection:Ze.Incoming,fadingParentID:fe.tileID,fadeEndTime:f+k}),fe.setCrossFadeLogic({fadingRole:de.Parent,fadingDirection:Ze.Departing,fadeEndTime:f+k}),s[se.key]=se,!0}return!1}function Cr(A,t,s,f,x,S){if(!t.hasData())return!1;const k=t.tileID.children(x);let z=Jt(A,t,k,s,f,x,S);if(z)return!0;for(const j of k)Jt(A,t,j.children(x),s,f,x,S)&&(z=!0);return z}function Jt(A,t,s,f,x,S,k){if(s[0].overscaledZ>=S)return!1;let z=!1;for(const j of s){const Z=A.getLoadedTile(j);if(!Z)continue;const{fadingRole:W,fadingDirection:ee,fadingParentID:J}=Z;W===de.Base&&ee===Ze.Departing&&J||(Z.setCrossFadeLogic({fadingRole:de.Base,fadingDirection:Ze.Departing,fadingParentID:t.tileID,fadeEndTime:x+k}),t.setCrossFadeLogic({fadingRole:de.Parent,fadingDirection:Ze.Incoming,fadeEndTime:x+k})),f[j.key]=j,z=!0}return z}function gi(A,t,s,f){const x=A.tileID;return!!A.selfFading||!A.hasData()&&!!t.has(x)&&(A.setSelfFadeLogic(s+f),!0)}function An(A,t){var s;A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0;let f=t.tileID.canonical.x-A.tileID.canonical.x;const x=t.tileID.canonical.y-A.tileID.canonical.y,S=Math.pow(2,A.tileID.canonical.z),k=t.tileID.key;f===0&&x===0||Math.abs(x)>1||(Math.abs(f)>1&&(Math.abs(f+S)===1?f+=S:Math.abs(f-S)===1&&(f-=S)),t.dem&&A.dem&&(A.dem.backfillBorder(t.dem,f,x),!((s=A.neighboringTiles)===null||s===void 0)&&s[k]&&(A.neighboringTiles[k].backfilled=!0)))}class ar{constructor(){this._tiles={}}handleWrapJump(t){const s={};for(const f in this._tiles){const x=this._tiles[f];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+t),s[x.tileID.key]=x}this._tiles=s}setFeatureState(t,s){for(const f in this._tiles)this._tiles[f].setFeatureState(t,s)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((s=>s.tileID)).sort(h.aw).map((s=>s.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,s){this._tiles[t]=s}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const s=this.getTileById(t.key);return s?.hasData()?s:null}isIdRenderable(t,s=!1){var f;return(f=this.getTileById(t))===null||f===void 0?void 0:f.isRenderable(s)}getRenderableIds(t=0,s){const f=[];for(const x of this.getAllIds())this.isIdRenderable(x,s)&&f.push(this.getTileById(x));return s?f.sort(((x,S)=>{const k=x.tileID,z=S.tileID,j=new h.P(k.canonical.x,k.canonical.y)._rotate(-t),Z=new h.P(z.canonical.x,z.canonical.y)._rotate(-t);return k.overscaledZ-z.overscaledZ||Z.y-j.y||Z.x-j.x})).map((x=>x.tileID.key)):f.map((x=>x.tileID)).sort(h.aw).map((x=>x.key))}}class Zi extends h.E{constructor(t,s,f){super(),this.id=t,this.dispatcher=f,this.on("data",(x=>this._dataHandler(x))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((x,S,k,z)=>{const j=new(pe(S.type))(x,S,k,z);if(j.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${j.id}`);return j})(t,s,f,this),this._inViewTiles=new ar,this._outOfViewCache=new h.ax(0,(x=>this._unloadTile(x))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Oe,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const s of this._inViewTiles.getAllTiles())s.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new ar}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,f){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,f)}catch(x){t.state="errored",x.status!==404?this._source.fire(new h.k(x,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const s of this._inViewTiles.getAllTiles())s.upload(t),s.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var s;return this._inViewTiles.getRenderableIds((s=this.transform)===null||s===void 0?void 0:s.bearingInRadians,t)}hasRenderableParent(t){const s=t.overscaledZ-1;if(s>=this._source.minzoom){const f=this.getLoadedTile(t.scaledTo(s));if(f)return this._inViewTiles.isIdRenderable(f.tileID.key)}return!1}reload(t,s=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const f of this._inViewTiles.getAllIds()){const x=this._inViewTiles.getTileById(f);s&&!this._source.shouldReloadTile(x,s)||(t?this._reloadTile(f,"expired"):x.state!=="errored"&&this._reloadTile(f,"reloading"))}}}_reloadTile(t,s){return h._(this,void 0,void 0,(function*(){const f=this._inViewTiles.getTileById(t);f&&(f.state!=="loading"&&(f.state=s),yield this._loadTile(f,t,s))}))}_tileLoaded(t,s,f){t.timeAdded=me(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&(function(x,S){var k,z;const j=S.getRenderableIds();for(const Z of j){if(!x.neighboringTiles||!x.neighboringTiles[Z])continue;const W=S.getTileById(Z);x.neighboringTiles[Z].backfilled||An(x,W),!((z=(k=W.neighboringTiles)===null||k===void 0?void 0:k[x.tileID.key])===null||z===void 0)&&z.backfilled||An(W,x)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,s){const f=this._getLoadedDescendents(s),x=new Set;for(const S of s){const k=f[S.key];if(!k?.length){x.add(S);continue}const z=S.overscaledZ+Zi.maxOverzooming,j=k.filter((ee=>ee.tileID.overscaledZ<=z));if(!j.length){x.add(S);continue}const Z=Math.min(...j.map((ee=>ee.tileID.overscaledZ))),W=j.filter((ee=>ee.tileID.overscaledZ===Z)).map((ee=>ee.tileID));for(const ee of W)t[ee.key]=ee;this._areDescendentsComplete(W,Z,S.overscaledZ)||x.add(S)}return x}_getLoadedDescendents(t){var s;const f={};for(const x of this._inViewTiles.getAllTiles().filter((S=>S.hasData())))for(const S of t)x.tileID.isChildOf(S)&&(f[s=S.key]||(f[s]=[])).push(x);return f}_areDescendentsComplete(t,s,f){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===s:Math.pow(4,s-f)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,f=Math.ceil(t.height/this._source.tileSize)+1,x=Math.floor(s*f*(this._maxTileCacheZoomLevels===null?h.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._outOfViewCache.setMaxSize(S)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,s&&(this._inViewTiles.handleWrapJump(s),this._resetTileReloadTimers())}update(t,s){if(!this._sourceLoaded||this._paused)return;let f;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?f=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((j=>new h.a2(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y))):(f=ni(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(f=f.filter((j=>this._source.hasTile(j))))):f=[],this.usedForTerrain&&(f=this._addTerrainIdealTiles(f));const x=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=Mi(t,this._source),k=this._updateRetainedTiles(f,S),z=Ei(this._source.type);z&&this._rasterFadeDuration>0&&!s&&(function(j,Z,W,ee,J,se,fe){const Ce=me(),Me=h.av(Z);for(const Ie of Z){const Be=j.getTileById(Ie.key);Be.fadingDirection!==Ze.Departing&&Be.fadeOpacity!==0||Be.resetFadeLogic(),Bi(j,Be,W,Ce,ee,J,fe)||Cr(j,Be,W,Ce,se,fe)||gi(Be,Me,Ce,fe)||Be.resetFadeLogic()}})(this._inViewTiles,f,k,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),z?this._cleanUpRasterTiles(k):this._cleanUpVectorTiles(k)}_cleanUpRasterTiles(t){for(const s of this._inViewTiles.getAllIds())t[s]||this._removeTile(s)}_cleanUpVectorTiles(t){for(const s of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(s);t[s]?f.clearSymbolFadeHold():f.hasSymbolBuckets?f.holdingForSymbolFade()?f.symbolFadeFinished()&&this._removeTile(s):f.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(s)}}_addTerrainIdealTiles(t){const s=[];for(const f of t)if(f.canonical.z>this._source.minzoom){const x=f.scaledTo(f.canonical.z-1);s.push(x);const S=f.scaledTo(Math.max(this._source.minzoom,Math.min(f.canonical.z,5)));s.push(S)}return t.concat(s)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var f;const x=new Set;for(const Z of t)this._addTile(Z).hasData()||x.add(Z);const S=t.reduce(((Z,W)=>(Z[W.key]=W,Z)),{}),k=this._retainLoadedChildren(S,x),z={},j=Math.max(s-Zi.maxUnderzooming,this._source.minzoom);for(const Z of k){let W=this._inViewTiles.getTileById(Z.key),ee=W?.wasRequested();for(let J=Z.overscaledZ-1;J>=j;--J){const se=Z.scaledTo(J);if(z[se.key])break;if(z[se.key]=!0,W=this.getTile(se),!W&&ee&&(W=this._addTile(se)),W){const fe=W.hasData();if((fe||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||ee)&&(S[se.key]=se),ee=W.wasRequested(),fe)break}}}return S}_addTile(t){let s=this._inViewTiles.getTileById(t.key);if(s)return s;s=this._outOfViewCache.getAndRemove(t),s&&(s.resetFadeLogic(),this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null));const f=s;return s||(s=new yt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._inViewTiles.setTile(t.key,s),f||this._source.fire(new h.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){this._clearTileReloadTimer(t);const f=s.getExpiryTimeout();f&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),f))}_clearTileReloadTimer(t){const s=this._timers[t];s&&(clearTimeout(s),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const s=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,s)}}refreshTiles(t){for(const s of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(s);(this._inViewTiles.isIdRenderable(s)||f.state=="errored")&&t.some((x=>x.equals(f.tileID.canonical)))&&this._reloadTile(s,"expired")}}_removeTile(t){const s=this._inViewTiles.getTileById(t);s&&(s.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._outOfViewCache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,s,f){const x=[],S=this.transform;if(!S)return x;const k=S.getCoveringTilesDetailsProvider().allowWorldCopies(),z=f?S.getCameraQueryGeometry(t):t,j=se=>S.screenPointToMercatorCoordinate(se,this.terrain),Z=this.transformBbox(t,j,!k),W=this.transformBbox(z,j,!k),ee=this.getIds(),J=h.aa.fromPoints(W);for(let se=0;se<ee.length;se++){const fe=this._inViewTiles.getTileById(ee[se]);if(fe.holdingForSymbolFade())continue;const Ce=k?[fe.tileID]:[fe.tileID.unwrapTo(-1),fe.tileID.unwrapTo(0)],Me=Math.pow(2,S.zoom-fe.tileID.overscaledZ),Ie=s*fe.queryPadding*h.a5/fe.tileSize/Me;for(const Be of Ce){const Qe=J.map((Le=>Be.getTilePoint(new h.a9(Le.x,Le.y))));if(Qe.expandBy(Ie),Qe.intersects(zi)){const Le=Z.map((st=>Be.getTilePoint(st))),$e=W.map((st=>Be.getTilePoint(st)));x.push({tile:fe,tileID:k?Be:Be.unwrapTo(0),queryGeometry:Le,cameraQueryGeometry:$e,scale:Me})}}}return x}transformBbox(t,s,f){let x=t.map(s);if(f){const S=h.aa.fromPoints(t);S.shrinkBy(.001*Math.min(S.width(),S.height()));const k=S.map(s);h.aa.fromPoints(x).covers(k)||(x=x.map((z=>z.x>.5?new h.a9(z.x-1,z.y,z.z):z)))}return x}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map((f=>this._inViewTiles.getTileById(f).tileID));return this.transform&&this.transform.populateCache(s),s}hasTransition(){return!!this._source.hasTransition()||!(!Ei(this._source.type)||!(function(t,s){if(s<=0)return!1;const f=me();for(const x of t.getAllTiles())if(x.fadeEndTime>=f)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,s,f){this._state.updateState(t=t||h.ai,s,f)}removeFeatureState(t,s,f){this._state.removeFeatureState(t=t||h.ai,s,f)}getFeatureState(t,s){return this._state.getState(t=t||h.ai,s)}setDependencies(t,s,f){const x=this._inViewTiles.getTileById(t);x&&x.setDependencies(s,f)}reloadTilesForDependencies(t,s){for(const f of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(f).hasDependency(t,s)&&this._reloadTile(f,"reloading");this._outOfViewCache.filter((f=>!f.hasDependency(t,s)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Zi.maxUnderzooming=10,Zi.maxOverzooming=3;class ln{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.an(t,0,1);let s=1,f=this._distances[s];const x=t*this.paddedLength+this.padding;for(;f<x&&s<this._distances.length;)f=this._distances[++s];const S=s-1,k=this._distances[S],z=f-k,j=z>0?(x-k)/z:0;return this.points[S].mult(1-j).add(this.points[s].mult(j))}}function Ue(A,t){let s=!0;return A==="always"||A!=="never"&&t!=="never"||(s=!1),s}class mt{constructor(t,s,f){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(s/f);for(let k=0;k<this.xCellCount*this.yCellCount;k++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,f,x,S){this._forEachCell(s,f,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(f),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(t,s,f,x){this._forEachCell(s-x,f-x,s+x,f+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(f),this.circles.push(x)}_insertBoxCell(t,s,f,x,S,k){this.boxCells[S].push(k)}_insertCircleCell(t,s,f,x,S,k){this.circleCells[S].push(k)}_query(t,s,f,x,S,k,z){if(f<0||t>this.width||x<0||s>this.height)return[];const j=[];if(t<=0&&s<=0&&this.width<=f&&this.height<=x){if(S)return[{key:null,x1:t,y1:s,x2:f,y2:x}];for(let Z=0;Z<this.boxKeys.length;Z++)j.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const W=this.circles[3*Z],ee=this.circles[3*Z+1],J=this.circles[3*Z+2];j.push({key:this.circleKeys[Z],x1:W-J,y1:ee-J,x2:W+J,y2:ee+J})}}else this._forEachCell(t,s,f,x,this._queryCell,j,{hitTest:S,overlapMode:k,seenUids:{box:{},circle:{}}},z);return j}query(t,s,f,x){return this._query(t,s,f,x,!1,null)}hitTest(t,s,f,x,S,k){return this._query(t,s,f,x,!0,S,k).length>0}hitTestCircle(t,s,f,x,S){const k=t-f,z=t+f,j=s-f,Z=s+f;if(z<0||k>this.width||Z<0||j>this.height)return!1;const W=[];return this._forEachCell(k,j,z,Z,this._queryCellCircle,W,{hitTest:!0,overlapMode:x,circle:{x:t,y:s,radius:f},seenUids:{box:{},circle:{}}},S),W.length>0}_queryCell(t,s,f,x,S,k,z,j){const{seenUids:Z,hitTest:W,overlapMode:ee}=z,J=this.boxCells[S];if(J!==null){const fe=this.bboxes;for(const Ce of J)if(!Z.box[Ce]){Z.box[Ce]=!0;const Me=4*Ce,Ie=this.boxKeys[Ce];if(t<=fe[Me+2]&&s<=fe[Me+3]&&f>=fe[Me+0]&&x>=fe[Me+1]&&(!j||j(Ie))&&(!W||!Ue(ee,Ie.overlapMode))&&(k.push({key:Ie,x1:fe[Me],y1:fe[Me+1],x2:fe[Me+2],y2:fe[Me+3]}),W))return!0}}const se=this.circleCells[S];if(se!==null){const fe=this.circles;for(const Ce of se)if(!Z.circle[Ce]){Z.circle[Ce]=!0;const Me=3*Ce,Ie=this.circleKeys[Ce];if(this._circleAndRectCollide(fe[Me],fe[Me+1],fe[Me+2],t,s,f,x)&&(!j||j(Ie))&&(!W||!Ue(ee,Ie.overlapMode))){const Be=fe[Me],Qe=fe[Me+1],Le=fe[Me+2];if(k.push({key:Ie,x1:Be-Le,y1:Qe-Le,x2:Be+Le,y2:Qe+Le}),W)return!0}}}return!1}_queryCellCircle(t,s,f,x,S,k,z,j){const{circle:Z,seenUids:W,overlapMode:ee}=z,J=this.boxCells[S];if(J!==null){const fe=this.bboxes;for(const Ce of J)if(!W.box[Ce]){W.box[Ce]=!0;const Me=4*Ce,Ie=this.boxKeys[Ce];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,fe[Me+0],fe[Me+1],fe[Me+2],fe[Me+3])&&(!j||j(Ie))&&!Ue(ee,Ie.overlapMode))return k.push(!0),!0}}const se=this.circleCells[S];if(se!==null){const fe=this.circles;for(const Ce of se)if(!W.circle[Ce]){W.circle[Ce]=!0;const Me=3*Ce,Ie=this.circleKeys[Ce];if(this._circlesCollide(fe[Me],fe[Me+1],fe[Me+2],Z.x,Z.y,Z.radius)&&(!j||j(Ie))&&!Ue(ee,Ie.overlapMode))return k.push(!0),!0}}}_forEachCell(t,s,f,x,S,k,z,j){const Z=this._convertToXCellCoord(t),W=this._convertToYCellCoord(s),ee=this._convertToXCellCoord(f),J=this._convertToYCellCoord(x);for(let se=Z;se<=ee;se++)for(let fe=W;fe<=J;fe++)if(S.call(this,t,s,f,x,this.xCellCount*fe+se,k,z,j))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,f,x,S,k){const z=x-t,j=S-s,Z=f+k;return Z*Z>z*z+j*j}_circleAndRectCollide(t,s,f,x,S,k,z){const j=(k-x)/2,Z=Math.abs(t-(x+j));if(Z>j+f)return!1;const W=(z-S)/2,ee=Math.abs(s-(S+W));if(ee>W+f)return!1;if(Z<=j||ee<=W)return!0;const J=Z-j,se=ee-W;return J*J+se*se<=f*f}}function $t(A,t,s){const f=h.N();if(!A){const{vecSouth:ee,vecEast:J}=un(t),se=H();se[0]=J[0],se[1]=J[1],se[2]=ee[0],se[3]=ee[1],x=se,(W=(k=(S=se)[0])*(Z=S[3])-(j=S[2])*(z=S[1]))&&(x[0]=Z*(W=1/W),x[1]=-z*W,x[2]=-j*W,x[3]=k*W),f[0]=se[0],f[1]=se[1],f[4]=se[2],f[5]=se[3]}var x,S,k,z,j,Z,W;return h.Q(f,f,[1/s,1/s,1]),f}function gn(A,t,s,f){if(A){const x=h.N();if(!t){const{vecSouth:S,vecEast:k}=un(s);x[0]=k[0],x[1]=k[1],x[4]=S[0],x[5]=S[1]}return h.Q(x,x,[f,f,1]),x}return s.pixelsToClipSpaceMatrix}function un(A){const t=Math.cos(A.rollInRadians),s=Math.sin(A.rollInRadians),f=Math.cos(A.pitchInRadians),x=Math.cos(A.bearingInRadians),S=Math.sin(A.bearingInRadians),k=h.aC();k[0]=-x*f*s-S*t,k[1]=-S*f*s+x*t;const z=h.aD(k);z<1e-9?h.aE(k):h.aF(k,k,1/z);const j=h.aC();j[0]=x*f*t-S*s,j[1]=S*f*t+x*s;const Z=h.aD(j);return Z<1e-9?h.aE(j):h.aF(j,j,1/Z),{vecEast:j,vecSouth:k}}function fn(A,t,s,f){let x;f?(x=[A,t,f(A,t),1],h.aH(x,x,s)):(x=[A,t,0,1],ci(x,x,s));const S=x[3];return{point:new h.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function Rn(A,t){return .5+A/t*.5}function Hn(A,t){return A.x>=-t[0]&&A.x<=t[0]&&A.y>=-t[1]&&A.y<=t[1]}function Fn(A,t,s,f,x,S,k,z,j,Z,W,ee,J){const se=s?A.textSizeData:A.iconSizeData,fe=h.ay(se,t.transform.zoom),Ce=[256/t.width*2+1,256/t.height*2+1],Me=s?A.text.dynamicLayoutVertexArray:A.icon.dynamicLayoutVertexArray;Me.clear();const Ie=A.lineVertexArray,Be=s?A.text.placedSymbolArray:A.icon.placedSymbolArray,Qe=t.transform.width/t.transform.height;let Le=!1;for(let $e=0;$e<Be.length;$e++){const st=Be.get($e);if(st.hidden||st.writingMode===h.az.vertical&&!Le){Xr(st.numGlyphs,Me);continue}Le=!1;const Ve=new h.P(st.anchorX,st.anchorY),dt={getElevation:J,pitchedLabelPlaneMatrix:f,lineVertexArray:Ie,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Ve,unwrappedTileID:j,width:Z,height:W,translation:ee},Lt=ii(st.anchorX,st.anchorY,dt);if(!Hn(Lt.point,Ce)){Xr(st.numGlyphs,Me);continue}const Mt=Rn(t.transform.cameraToCenterDistance,Lt.signedDistanceFromCamera),Pt=h.aA(se,fe,st),Ot=S?Pt*t.transform.getPitchedTextCorrection(st.anchorX,st.anchorY,j)/Mt:Pt*Mt,bn=bi({projectionContext:dt,pitchedLabelPlaneMatrixInverse:x,symbol:st,fontSize:Ot,flip:!1,keepUpright:k,glyphOffsetArray:A.glyphOffsetArray,dynamicLayoutVertexArray:Me,aspectRatio:Qe,rotateToLine:z});Le=bn.useVertical,(bn.notEnoughRoom||Le||bn.needsFlipping&&bi({projectionContext:dt,pitchedLabelPlaneMatrixInverse:x,symbol:st,fontSize:Ot,flip:!0,keepUpright:k,glyphOffsetArray:A.glyphOffsetArray,dynamicLayoutVertexArray:Me,aspectRatio:Qe,rotateToLine:z}).notEnoughRoom)&&Xr(st.numGlyphs,Me)}s?A.text.dynamicLayoutVertexBuffer.updateData(Me):A.icon.dynamicLayoutVertexBuffer.updateData(Me)}function ki(A,t,s,f,x,S,k,z){const j=S.glyphStartIndex+S.numGlyphs,Z=S.lineStartIndex,W=S.lineStartIndex+S.lineLength,ee=t.getoffsetX(S.glyphStartIndex),J=t.getoffsetX(j-1),se=li(A*ee,s,f,x,S.segment,Z,W,z,k);if(!se)return null;const fe=li(A*J,s,f,x,S.segment,Z,W,z,k);return fe?z.projectionCache.anyProjectionOccluded?null:{first:se,last:fe}:null}function xi(A,t,s,f){return A===h.az.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*f?{useVertical:!0}:(A===h.az.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function bi(A){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:s,symbol:f,fontSize:x,flip:S,keepUpright:k,glyphOffsetArray:z,dynamicLayoutVertexArray:j,aspectRatio:Z,rotateToLine:W}=A,ee=x/24,J=f.lineOffsetX*ee,se=f.lineOffsetY*ee;let fe;if(f.numGlyphs>1){const Ce=f.glyphStartIndex+f.numGlyphs,Me=f.lineStartIndex,Ie=f.lineStartIndex+f.lineLength,Be=ki(ee,z,J,se,S,f,W,t);if(!Be)return{notEnoughRoom:!0};const Qe=Ri(Be.first.point.x,Be.first.point.y,t,s),Le=Ri(Be.last.point.x,Be.last.point.y,t,s);if(k&&!S){const $e=xi(f.writingMode,Qe,Le,Z);if($e)return $e}fe=[Be.first];for(let $e=f.glyphStartIndex+1;$e<Ce-1;$e++){const st=li(ee*z.getoffsetX($e),J,se,S,f.segment,Me,Ie,t,W);if(!st)return{notEnoughRoom:!0};fe.push(st)}fe.push(Be.last)}else{if(k&&!S){const Me=En(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Ie=f.lineStartIndex+f.segment+1,Be=new h.P(t.lineVertexArray.getx(Ie),t.lineVertexArray.gety(Ie)),Qe=En(Be.x,Be.y,t),Le=Qe.signedDistanceFromCamera>0?Qe.point:Ct(t.tileAnchorPoint,Be,Me,1,t),$e=Ri(Me.x,Me.y,t,s),st=Ri(Le.x,Le.y,t,s),Ve=xi(f.writingMode,$e,st,Z);if(Ve)return Ve}const Ce=li(ee*z.getoffsetX(f.glyphStartIndex),J,se,S,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,t,W);if(!Ce||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};fe=[Ce]}for(const Ce of fe)h.aG(j,Ce.point,Ce.angle);return{}}function Ct(A,t,s,f,x){const S=A.add(A.sub(t)._unit()),k=En(S.x,S.y,x).point,z=s.sub(k);return s.add(z._mult(f/z.mag()))}function Zn(A,t,s){const f=t.projectionCache;if(f.projections[A])return f.projections[A];const x=new h.P(t.lineVertexArray.getx(A),t.lineVertexArray.gety(A)),S=En(x.x,x.y,t);if(S.signedDistanceFromCamera>0)return f.projections[A]=S.point,f.anyProjectionOccluded=f.anyProjectionOccluded||S.isOccluded,S.point;const k=A-s.direction;return Ct(s.distanceFromAnchor===0?t.tileAnchorPoint:new h.P(t.lineVertexArray.getx(k),t.lineVertexArray.gety(k)),x,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function En(A,t,s){const f=A+s.translation[0],x=t+s.translation[1];let S;return s.pitchWithMap?(S=fn(f,x,s.pitchedLabelPlaneMatrix,s.getElevation),S.isOccluded=!1):(S=s.transform.projectTileCoordinates(f,x,s.unwrappedTileID,s.getElevation),S.point.x=(.5*S.point.x+.5)*s.width,S.point.y=(.5*-S.point.y+.5)*s.height),S}function Ri(A,t,s,f){if(s.pitchWithMap){const x=[A,t,0,1];return h.aH(x,x,f),s.transform.projectTileCoordinates(x[0]/x[3],x[1]/x[3],s.unwrappedTileID,s.getElevation).point}return{x:A/s.width*2-1,y:1-t/s.height*2}}function ii(A,t,s){return s.transform.projectTileCoordinates(A,t,s.unwrappedTileID,s.getElevation)}function $n(A,t,s){return A._unit()._perp()._mult(t*s)}function jn(A,t,s,f,x,S,k,z,j){if(z.projectionCache.offsets[A])return z.projectionCache.offsets[A];const Z=s.add(t);if(A+j.direction<f||A+j.direction>=x)return z.projectionCache.offsets[A]=Z,Z;const W=Zn(A+j.direction,z,j),ee=$n(W.sub(s),k,j.direction),J=s.add(ee),se=W.add(ee);return z.projectionCache.offsets[A]=h.aI(S,Z,J,se)||Z,z.projectionCache.offsets[A]}function li(A,t,s,f,x,S,k,z,j){const Z=f?A-t:A+t;let W=Z>0?1:-1,ee=0;f&&(W*=-1,ee=Math.PI),W<0&&(ee+=Math.PI);let J,se=W>0?S+x:S+x+1;z.projectionCache.cachedAnchorPoint?J=z.projectionCache.cachedAnchorPoint:(J=En(z.tileAnchorPoint.x,z.tileAnchorPoint.y,z).point,z.projectionCache.cachedAnchorPoint=J);let fe,Ce,Me=J,Ie=J,Be=0,Qe=0;const Le=Math.abs(Z),$e=[];let st;for(;Be+Qe<=Le;){if(se+=W,se<S||se>=k)return null;Be+=Qe,Ie=Me,Ce=fe;const Lt={absOffsetX:Le,direction:W,distanceFromAnchor:Be,previousVertex:Ie};if(Me=Zn(se,z,Lt),s===0)$e.push(Ie),st=Me.sub(Ie);else{let Mt;const Pt=Me.sub(Ie);Mt=Pt.mag()===0?$n(Zn(se+W,z,Lt).sub(Me),s,W):$n(Pt,s,W),Ce||(Ce=Ie.add(Mt)),fe=jn(se,Mt,Me,S,k,Ce,s,z,Lt),$e.push(Ce),st=fe.sub(Ce)}Qe=st.mag()}const Ve=st._mult((Le-Be)/Qe)._add(Ce||Ie),dt=ee+Math.atan2(Me.y-Ie.y,Me.x-Ie.x);return $e.push(Ve),{point:Ve,angle:j?dt:0,path:$e}}const us=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Xr(A,t){for(let s=0;s<A;s++){const f=t.length;t.resize(f+4),t.float32.set(us,3*f)}}function ci(A,t,s){const f=t[0],x=t[1];return A[0]=s[0]*f+s[4]*x+s[12],A[1]=s[1]*f+s[5]*x+s[13],A[3]=s[3]*f+s[7]*x+s[15],A}const Un=100;class Tr{constructor(t,s=new mt(t.width+200,t.height+200,25),f=new mt(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=f,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Un,this.screenBottomBoundary=t.height+Un,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,f,x,S,k,z,j,Z,W,ee,J){const se=this.projectAndGetPerspectiveRatio(t.anchorPointX+j[0],t.anchorPointY+j[1],S,W,J),fe=f*se.perspectiveRatio;let Ce;if(k||z)Ce=this._projectCollisionBox(t,fe,x,S,k,z,j,se,W,ee,J);else{const st=se.x+(ee?ee.x*fe:0),Ve=se.y+(ee?ee.y*fe:0);Ce={allPointsOccluded:!1,box:[st+t.x1*fe,Ve+t.y1*fe,st+t.x2*fe,Ve+t.y2*fe]}}const[Me,Ie,Be,Qe]=Ce.box,Le=k?Ce.allPointsOccluded:se.isOccluded;let $e=Le;return $e||($e=se.perspectiveRatio<this.perspectiveRatioCutoff),$e||($e=!this.isInsideGrid(Me,Ie,Be,Qe)),$e||s!=="always"&&this.grid.hitTest(Me,Ie,Be,Qe,s,Z)?{box:[Me,Ie,Be,Qe],placeable:!1,offscreen:!1,occluded:Le}:{box:[Me,Ie,Be,Qe],placeable:!0,offscreen:this.isOffscreen(Me,Ie,Be,Qe),occluded:Le}}placeCollisionCircles(t,s,f,x,S,k,z,j,Z,W,ee,J,se,fe){const Ce=[],Me=new h.P(s.anchorX,s.anchorY),Ie=this.getPerspectiveRatio(Me.x,Me.y,k,fe),Be=(Z?S*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,k)/Ie:S*Ie)/h.aM,Qe={getElevation:fe,pitchedLabelPlaneMatrix:z,lineVertexArray:f,pitchWithMap:Z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Me,unwrappedTileID:k,width:this.transform.width,height:this.transform.height,translation:se},Le=ki(Be,x,s.lineOffsetX*Be,s.lineOffsetY*Be,!1,s,!1,Qe);let $e=!1,st=!1,Ve=!0;if(Le){const dt=.5*ee*Ie+J,Lt=new h.P(-100,-100),Mt=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Pt=new ln,Ot=Le.first,bn=Le.last;let vn=[];for(let Ni=Ot.path.length-1;Ni>=1;Ni--)vn.push(Ot.path[Ni]);for(let Ni=1;Ni<bn.path.length;Ni++)vn.push(bn.path[Ni]);const on=2.5*dt;if(Z){const Ni=this.projectPathToScreenSpace(vn,Qe);vn=Ni.some((Sr=>Sr.signedDistanceFromCamera<=0))?[]:Ni.map((Sr=>Sr.point))}let Cn=[];if(vn.length>0){const Ni=vn[0].clone(),Sr=vn[0].clone();for(let qr=1;qr<vn.length;qr++)Ni.x=Math.min(Ni.x,vn[qr].x),Ni.y=Math.min(Ni.y,vn[qr].y),Sr.x=Math.max(Sr.x,vn[qr].x),Sr.y=Math.max(Sr.y,vn[qr].y);Cn=Ni.x>=Lt.x&&Sr.x<=Mt.x&&Ni.y>=Lt.y&&Sr.y<=Mt.y?[vn]:Sr.x<Lt.x||Ni.x>Mt.x||Sr.y<Lt.y||Ni.y>Mt.y?[]:h.aJ([vn],Lt.x,Lt.y,Mt.x,Mt.y)}for(const Ni of Cn){Pt.reset(Ni,.25*dt);let Sr=0;Sr=Pt.length<=.5*dt?1:Math.ceil(Pt.paddedLength/on)+1;for(let qr=0;qr<Sr;qr++){const jr=qr/Math.max(Sr-1,1),es=Pt.lerp(jr),Rr=es.x+Un,gs=es.y+Un;Ce.push(Rr,gs,dt,0);const ts=Rr-dt,ra=gs-dt,_s=Rr+dt,bs=gs+dt;if(Ve=Ve&&this.isOffscreen(ts,ra,_s,bs),st=st||this.isInsideGrid(ts,ra,_s,bs),t!=="always"&&this.grid.hitTestCircle(Rr,gs,dt,t,W)&&($e=!0,!j))return{circles:[],offscreen:!1,collisionDetected:$e}}}}return{circles:!j&&$e||!st||Ie<this.perspectiveRatioCutoff?[]:Ce,offscreen:Ve,collisionDetected:$e}}projectPathToScreenSpace(t,s){const f=(function(x,S){const k=h.N();return h.aB(k,S.pitchedLabelPlaneMatrix),x.map((z=>{const j=fn(z.x,z.y,k,S.getElevation),Z=S.transform.projectTileCoordinates(j.point.x,j.point.y,S.unwrappedTileID,S.getElevation);return Z.point.x=(.5*Z.point.x+.5)*S.width,Z.point.y=(.5*-Z.point.y+.5)*S.height,Z}))})(t,s);return(function(x){let S=0,k=0,z=0,j=0;for(let Z=0;Z<x.length;Z++)x[Z].isOccluded?(z=Z+1,j=0):(j++,j>k&&(k=j,S=z));return x.slice(S,S+k)})(f)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],f=new h.aa;for(const ee of t){const J=new h.P(ee.x+Un,ee.y+Un);f.extend(J),s.push(J)}const{minX:x,minY:S,maxX:k,maxY:z}=f,j=this.grid.query(x,S,k,z).concat(this.ignoredGrid.query(x,S,k,z)),Z={},W={};for(const ee of j){const J=ee.key;if(Z[J.bucketInstanceId]===void 0&&(Z[J.bucketInstanceId]={}),Z[J.bucketInstanceId][J.featureIndex])continue;const se=[new h.P(ee.x1,ee.y1),new h.P(ee.x2,ee.y1),new h.P(ee.x2,ee.y2),new h.P(ee.x1,ee.y2)];h.aK(s,se)&&(Z[J.bucketInstanceId][J.featureIndex]=!0,W[J.bucketInstanceId]===void 0&&(W[J.bucketInstanceId]=[]),W[J.bucketInstanceId].push(J.featureIndex))}return W}insertCollisionBox(t,s,f,x,S,k){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:S,collisionGroupID:k,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,f,x,S,k){const z=f?this.ignoredGrid:this.grid,j={bucketInstanceId:x,featureIndex:S,collisionGroupID:k,overlapMode:s};for(let Z=0;Z<t.length;Z+=4)z.insertCircle(j,t[Z],t[Z+1],t[Z+2])}projectAndGetPerspectiveRatio(t,s,f,x,S){if(S){let k;x?(k=[t,s,x(t,s),1],h.aH(k,k,S)):(k=[t,s,0,1],ci(k,k,S));const z=k[3];return{x:(k[0]/z+1)/2*this.transform.width+Un,y:(-k[1]/z+1)/2*this.transform.height+Un,perspectiveRatio:.5+this.transform.cameraToCenterDistance/z*.5,isOccluded:!1,signedDistanceFromCamera:z}}{const k=this.transform.projectTileCoordinates(t,s,f,x);return{x:(k.point.x+1)/2*this.transform.width+Un,y:(1-k.point.y)/2*this.transform.height+Un,perspectiveRatio:.5+this.transform.cameraToCenterDistance/k.signedDistanceFromCamera*.5,isOccluded:k.isOccluded,signedDistanceFromCamera:k.signedDistanceFromCamera}}}getPerspectiveRatio(t,s,f,x){const S=this.transform.projectTileCoordinates(t,s,f,x);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(t,s,f,x){return f<Un||t>=this.screenRightBoundary||x<Un||s>this.screenBottomBoundary}isInsideGrid(t,s,f,x){return f>=0&&t<this.gridRightBoundary&&x>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=h.ar([]);return h.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,f,x,S,k,z,j,Z,W,ee){let J=1,se=0,fe=0,Ce=1;const Me=t.anchorPointX+z[0],Ie=t.anchorPointY+z[1];if(k&&!S){const vn=this.projectAndGetPerspectiveRatio(Me+1,Ie,x,Z,ee),on=vn.x-j.x,Cn=Math.atan((vn.y-j.y)/on)+(on<0?Math.PI:0),Ni=Math.sin(Cn),Sr=Math.cos(Cn);J=Sr,se=Ni,fe=-Ni,Ce=Sr}else if(!k&&S){const vn=un(this.transform);J=vn.vecEast[0],se=vn.vecEast[1],fe=vn.vecSouth[0],Ce=vn.vecSouth[1]}let Be=j.x,Qe=j.y,Le=s;S&&(Be=Me,Qe=Ie,Le=Math.pow(2,-(this.transform.zoom-f.overscaledZ)),Le*=this.transform.getPitchedTextCorrection(Me,Ie,x),W||(Le*=h.an(.5+j.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),W&&(Be+=J*W.x*Le+fe*W.y*Le,Qe+=se*W.x*Le+Ce*W.y*Le);const $e=t.x1*Le,st=t.x2*Le,Ve=($e+st)/2,dt=t.y1*Le,Lt=t.y2*Le,Mt=(dt+Lt)/2,Pt=[{offsetX:$e,offsetY:dt},{offsetX:Ve,offsetY:dt},{offsetX:st,offsetY:dt},{offsetX:st,offsetY:Mt},{offsetX:st,offsetY:Lt},{offsetX:Ve,offsetY:Lt},{offsetX:$e,offsetY:Lt},{offsetX:$e,offsetY:Mt}];let Ot=[];for(const{offsetX:vn,offsetY:on}of Pt)Ot.push(new h.P(Be+J*vn+fe*on,Qe+se*vn+Ce*on));let bn=!1;if(S){const vn=Ot.map((on=>this.projectAndGetPerspectiveRatio(on.x,on.y,x,Z,ee)));bn=vn.some((on=>!on.isOccluded)),Ot=vn.map((on=>new h.P(on.x,on.y)))}else bn=!0;return{box:h.aL(Ot),allPointsOccluded:!bn}}}class Ss{constructor(t,s,f,x){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):x&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Ji{constructor(t,s,f,x,S){this.text=new Ss(t?t.text:null,s,f,S),this.icon=new Ss(t?t.icon:null,s,x,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Lr{constructor(t,s,f){this.text=t,this.icon=s,this.skipFade=f}}class hs{constructor(t,s,f,x,S){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=f,this.bucketIndex=x,this.tileID=S}}class Ho{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:f=>f.collisionGroupID===s}}return this.collisionGroups[t]}}function Fi(A,t,s,f,x){const{horizontalAlign:S,verticalAlign:k}=h.aS(A);return new h.P(-(S-.5)*t+f[0]*x,-(k-.5)*s+f[1]*x)}class $r{constructor(t,s,f,x,S){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Tr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Ho(x),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(f,x)=>s.getElevation(t,f,x):null}getBucketParts(t,s,f,x){const S=f.getBucket(s),k=f.latestFeatureIndex;if(!S||!k||s.id!==S.layerIds[0])return;const z=f.collisionBoxArray,j=S.layers[0].layout,Z=S.layers[0].paint,W=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),ee=f.tileSize/h.a5,J=f.tileID.toUnwrapped(),se=j.get("text-rotation-alignment")==="map",fe=h.aN(f,1,this.transform.zoom),Ce=h.aO(this.collisionIndex.transform,f,Z.get("text-translate"),Z.get("text-translate-anchor")),Me=h.aO(this.collisionIndex.transform,f,Z.get("icon-translate"),Z.get("icon-translate-anchor")),Ie=$t(se,this.transform,fe);this.retainedQueryData[S.bucketInstanceId]=new hs(S.bucketInstanceId,k,S.sourceLayerIndex,S.index,f.tileID);const Be={bucket:S,layout:j,translationText:Ce,translationIcon:Me,unwrappedTileID:J,pitchedLabelPlaneMatrix:Ie,scale:W,textPixelRatio:ee,holdingForFade:f.holdingForSymbolFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:h.ay(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(x)for(const Qe of S.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:$e,symbolInstanceEnd:st}=Qe;t.push({sortKey:Le,symbolInstanceStart:$e,symbolInstanceEnd:st,parameters:Be})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(t,s,f,x,S,k,z,j,Z,W,ee,J,se,fe,Ce,Me,Ie,Be,Qe,Le){const $e=h.aP[t.textAnchor],st=[t.textOffset0,t.textOffset1],Ve=Fi($e,f,x,st,S),dt=this.collisionIndex.placeCollisionBox(s,J,j,Z,W,z,k,Me,ee.predicate,Qe,Ve,Le);if((!Be||this.collisionIndex.placeCollisionBox(Be,J,j,Z,W,z,k,Ie,ee.predicate,Qe,Ve,Le).placeable)&&dt.placeable){let Lt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Lt=this.prevPlacement.variableOffsets[se.crossTileID].anchor),se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[se.crossTileID]={textOffset:st,width:f,height:x,anchor:$e,textBoxScale:S,prevAnchor:Lt},this.markUsedJustification(fe,$e,se,Ce),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,Ce,se),this.placedOrientations[se.crossTileID]=Ce),{shift:Ve,placedGlyphBoxes:dt}}}placeLayerBucketPart(t,s,f){const{bucket:x,layout:S,translationText:k,translationIcon:z,unwrappedTileID:j,pitchedLabelPlaneMatrix:Z,textPixelRatio:W,holdingForFade:ee,collisionBoxArray:J,partiallyEvaluatedTextSize:se,collisionGroup:fe}=t.parameters,Ce=S.get("text-optional"),Me=S.get("icon-optional"),Ie=h.aQ(S,"text-overlap","text-allow-overlap"),Be=Ie==="always",Qe=h.aQ(S,"icon-overlap","icon-allow-overlap"),Le=Qe==="always",$e=S.get("text-rotation-alignment")==="map",st=S.get("text-pitch-alignment")==="map",Ve=S.get("icon-text-fit")!=="none",dt=S.get("symbol-z-order")==="viewport-y",Lt=Be&&(Le||!x.hasIconData()||Me),Mt=Le&&(Be||!x.hasTextData()||Ce);!x.collisionArrays&&J&&x.deserializeCollisionBoxes(J);const Pt=this.retainedQueryData[x.bucketInstanceId].tileID,Ot=this._getTerrainElevationFunc(Pt),bn=this.transform.getFastPathSimpleProjectionMatrix(Pt),vn=(on,Cn,Ni)=>{var Sr,qr;if(s[on.crossTileID])return;if(ee)return void(this.placements[on.crossTileID]=new Lr(!1,!1,!1));let jr=!1,es=!1,Rr=!0,gs=null,ts={box:null,placeable:!1,offscreen:null,occluded:!1},ra={placeable:!1},_s=null,bs=null,sa=null,Il=0,Ml=0,Jo=0;Cn.textFeatureIndex?Il=Cn.textFeatureIndex:on.useRuntimeCollisionCircles&&(Il=on.featureIndex),Cn.verticalTextFeatureIndex&&(Ml=Cn.verticalTextFeatureIndex);const Xa=Cn.textBox;if(Xa){const Wa=Mr=>{let Ur=h.az.horizontal;if(x.allowVerticalPlacement&&!Mr&&this.prevPlacement){const Os=this.prevPlacement.placedOrientations[on.crossTileID];Os&&(this.placedOrientations[on.crossTileID]=Os,Ur=Os,this.markUsedOrientation(x,Ur,on))}return Ur},go=(Mr,Ur)=>{if(x.allowVerticalPlacement&&on.numVerticalGlyphVertices>0&&Cn.verticalTextBox){for(const Os of x.writingModes)if(Os===h.az.vertical?(ts=Ur(),ra=ts):ts=Mr(),ts&&ts.placeable)break}else ts=Mr()},Ro=on.textAnchorOffsetStartIndex,Po=on.textAnchorOffsetEndIndex;if(Po===Ro){const Mr=(Ur,Os)=>{const Hs=this.collisionIndex.placeCollisionBox(Ur,Ie,W,Pt,j,st,$e,k,fe.predicate,Ot,void 0,bn);return Hs&&Hs.placeable&&(this.markUsedOrientation(x,Os,on),this.placedOrientations[on.crossTileID]=Os),Hs};go((()=>Mr(Xa,h.az.horizontal)),(()=>{const Ur=Cn.verticalTextBox;return x.allowVerticalPlacement&&on.numVerticalGlyphVertices>0&&Ur?Mr(Ur,h.az.vertical):{box:null,offscreen:null}})),Wa(ts&&ts.placeable)}else{let Mr=h.aP[(qr=(Sr=this.prevPlacement)===null||Sr===void 0?void 0:Sr.variableOffsets[on.crossTileID])===null||qr===void 0?void 0:qr.anchor];const Ur=(Hs,ld,cd)=>{const Sc=Hs.x2-Hs.x1,hp=Hs.y2-Hs.y1,Cc=on.textBoxScale,ud=Ve&&Qe==="never"?ld:null;let ec=null,tc=Ie==="never"?1:2,tl="never";Mr&&tc++;for(let hd=0;hd<tc;hd++){for(let vh=Ro;vh<Po;vh++){const wh=x.textAnchorOffsets.get(vh);if(Mr&&wh.textAnchor!==Mr)continue;const Ah=this.attemptAnchorPlacement(wh,Hs,Sc,hp,Cc,$e,st,W,Pt,j,fe,tl,on,x,cd,k,z,ud,Ot);if(Ah&&(ec=Ah.placedGlyphBoxes,ec&&ec.placeable))return jr=!0,gs=Ah.shift,ec}Mr?Mr=null:tl=Ie}return f&&!ec&&(ec={box:this.collisionIndex.placeCollisionBox(Xa,"always",W,Pt,j,st,$e,k,fe.predicate,Ot,void 0,bn).box,offscreen:!1,placeable:!1,occluded:!1}),ec};go((()=>Ur(Xa,Cn.iconBox,h.az.horizontal)),(()=>{const Hs=Cn.verticalTextBox;return x.allowVerticalPlacement&&(!ts||!ts.placeable)&&on.numVerticalGlyphVertices>0&&Hs?Ur(Hs,Cn.verticalIconBox,h.az.vertical):{box:null,occluded:!0,offscreen:null}})),ts&&(jr=ts.placeable,Rr=ts.offscreen);const Os=Wa(ts&&ts.placeable);if(!jr&&this.prevPlacement){const Hs=this.prevPlacement.variableOffsets[on.crossTileID];Hs&&(this.variableOffsets[on.crossTileID]=Hs,this.markUsedJustification(x,Hs.anchor,on,Os))}}}if(_s=ts,jr=_s&&_s.placeable,Rr=_s&&_s.offscreen,on.useRuntimeCollisionCircles&&on.centerJustifiedTextSymbolIndex>=0){const Wa=x.text.placedSymbolArray.get(on.centerJustifiedTextSymbolIndex),go=h.aA(x.textSizeData,se,Wa),Ro=S.get("text-padding");bs=this.collisionIndex.placeCollisionCircles(Ie,Wa,x.lineVertexArray,x.glyphOffsetArray,go,j,Z,f,st,fe.predicate,on.collisionCircleDiameter,Ro,k,Ot),bs.circles.length&&bs.collisionDetected&&!f&&h.w("Collisions detected, but collision boxes are not shown"),jr=Be||bs.circles.length>0&&!bs.collisionDetected,Rr=Rr&&bs.offscreen}if(Cn.iconFeatureIndex&&(Jo=Cn.iconFeatureIndex),Cn.iconBox){const Wa=go=>this.collisionIndex.placeCollisionBox(go,Qe,W,Pt,j,st,$e,z,fe.predicate,Ot,Ve&&gs?gs:void 0,bn);ra&&ra.placeable&&Cn.verticalIconBox?(sa=Wa(Cn.verticalIconBox),es=sa.placeable):(sa=Wa(Cn.iconBox),es=sa.placeable),Rr=Rr&&sa.offscreen}const Jc=Ce||on.numHorizontalGlyphVertices===0&&on.numVerticalGlyphVertices===0,Du=Me||on.numIconVertices===0;Jc||Du?Du?Jc||(es=es&&jr):jr=es&&jr:es=jr=es&&jr;const el=es&&sa.placeable;if(jr&&_s.placeable&&this.collisionIndex.insertCollisionBox(_s.box,Ie,S.get("text-ignore-placement"),x.bucketInstanceId,ra&&ra.placeable&&Ml?Ml:Il,fe.ID),el&&this.collisionIndex.insertCollisionBox(sa.box,Qe,S.get("icon-ignore-placement"),x.bucketInstanceId,Jo,fe.ID),bs&&jr&&this.collisionIndex.insertCollisionCircles(bs.circles,Ie,S.get("text-ignore-placement"),x.bucketInstanceId,Il,fe.ID),f&&this.storeCollisionData(x.bucketInstanceId,Ni,Cn,_s,sa,bs),on.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(x.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[on.crossTileID]=new Lr((jr||Lt)&&!_s?.occluded,(es||Mt)&&!sa?.occluded,Rr||x.justReloaded),s[on.crossTileID]=!0};if(dt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const on=x.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Cn=on.length-1;Cn>=0;--Cn){const Ni=on[Cn];vn(x.symbolInstances.get(Ni),x.collisionArrays[Ni],Ni)}}else for(let on=t.symbolInstanceStart;on<t.symbolInstanceEnd;on++)vn(x.symbolInstances.get(on),x.collisionArrays[on],on);x.justReloaded=!1}storeCollisionData(t,s,f,x,S,k){if(f.textBox||f.iconBox){let z,j;this.collisionBoxArrays.has(t)?z=this.collisionBoxArrays.get(t):(z=new Map,this.collisionBoxArrays.set(t,z)),z.has(s)?j=z.get(s):(j={text:null,icon:null},z.set(s,j)),f.textBox&&(j.text=x.box),f.iconBox&&(j.icon=S.box)}if(k){let z=this.collisionCircleArrays[t];z===void 0&&(z=this.collisionCircleArrays[t]=[]);for(let j=0;j<k.circles.length;j+=4)z.push(k.circles[j+0]-Un),z.push(k.circles[j+1]-Un),z.push(k.circles[j+2]),z.push(k.collisionDetected?1:0)}}markUsedJustification(t,s,f,x){let S;S=x===h.az.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[h.aR(s)];const k=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const z of k)z>=0&&(t.text.placedSymbolArray.get(z).crossTileID=S>=0&&z!==S?0:f.crossTileID)}markUsedOrientation(t,s,f){const x=s===h.az.horizontal||s===h.az.horizontalOnly?s:0,S=s===h.az.vertical?s:0,k=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const z of k)t.text.placedSymbolArray.get(z).placedOrientation=x;f.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let f=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const x=s?s.symbolFadeChange(t):1,S=s?s.opacities:{},k=s?s.variableOffsets:{},z=s?s.placedOrientations:{};for(const j in this.placements){const Z=this.placements[j],W=S[j];W?(this.opacities[j]=new Ji(W,x,Z.text,Z.icon),f=f||Z.text!==W.text.placed||Z.icon!==W.icon.placed):(this.opacities[j]=new Ji(null,x,Z.text,Z.icon,Z.skipFade),f=f||Z.text||Z.icon)}for(const j in S){const Z=S[j];if(!this.opacities[j]){const W=new Ji(Z,x,!1,!1);W.isHidden()||(this.opacities[j]=W,f=f||Z.text.placed||Z.icon.placed)}}for(const j in k)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=k[j]);for(const j in z)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=z[j]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const f={};for(const x of s){const S=x.getBucket(t);S&&x.latestFeatureIndex&&t.id===S.layerIds[0]&&this.updateBucketOpacities(S,x.tileID,f,x.collisionBoxArray)}}updateBucketOpacities(t,s,f,x){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const S=t.layers[0],k=S.layout,z=new Ji(null,0,!1,!1,!0),j=k.get("text-allow-overlap"),Z=k.get("icon-allow-overlap"),W=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ee=k.get("text-rotation-alignment")==="map",J=k.get("text-pitch-alignment")==="map",se=k.get("icon-text-fit")!=="none",fe=new Ji(null,0,j&&(Z||!t.hasIconData()||k.get("icon-optional")),Z&&(j||!t.hasTextData()||k.get("text-optional")),!0);!t.collisionArrays&&x&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(x);const Ce=(Ie,Be,Qe)=>{for(let Le=0;Le<Be/4;Le++)Ie.opacityVertexArray.emplaceBack(Qe);Ie.hasVisibleVertices=Ie.hasVisibleVertices||Qe!==fr},Me=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Ie=0;Ie<t.symbolInstances.length;Ie++){const Be=t.symbolInstances.get(Ie),{numHorizontalGlyphVertices:Qe,numVerticalGlyphVertices:Le,crossTileID:$e}=Be;let st=this.opacities[$e];f[$e]?st=z:st||(st=fe,this.opacities[$e]=st),f[$e]=!0;const Ve=Be.numIconVertices>0,dt=this.placedOrientations[Be.crossTileID],Lt=dt===h.az.vertical,Mt=dt===h.az.horizontal||dt===h.az.horizontalOnly;if(Qe>0||Le>0){const Ot=mi(st.text);Ce(t.text,Qe,Lt?fr:Ot),Ce(t.text,Le,Mt?fr:Ot);const bn=st.text.isHidden();[Be.rightJustifiedTextSymbolIndex,Be.centerJustifiedTextSymbolIndex,Be.leftJustifiedTextSymbolIndex].forEach((Cn=>{Cn>=0&&(t.text.placedSymbolArray.get(Cn).hidden=bn||Lt?1:0)})),Be.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Be.verticalPlacedTextSymbolIndex).hidden=bn||Mt?1:0);const vn=this.variableOffsets[Be.crossTileID];vn&&this.markUsedJustification(t,vn.anchor,Be,dt);const on=this.placedOrientations[Be.crossTileID];on&&(this.markUsedJustification(t,"left",Be,on),this.markUsedOrientation(t,on,Be))}if(Ve){const Ot=mi(st.icon),bn=!(se&&Be.verticalPlacedIconSymbolIndex&&Lt);Be.placedIconSymbolIndex>=0&&(Ce(t.icon,Be.numIconVertices,bn?Ot:fr),t.icon.placedSymbolArray.get(Be.placedIconSymbolIndex).hidden=st.icon.isHidden()),Be.verticalPlacedIconSymbolIndex>=0&&(Ce(t.icon,Be.numVerticalIconVertices,bn?fr:Ot),t.icon.placedSymbolArray.get(Be.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}const Pt=Me&&Me.has(Ie)?Me.get(Ie):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ot=t.collisionArrays[Ie];if(Ot){let bn=new h.P(0,0);if(Ot.textBox||Ot.verticalTextBox){let vn=!0;if(W){const on=this.variableOffsets[$e];on?(bn=Fi(on.anchor,on.width,on.height,on.textOffset,on.textBoxScale),ee&&bn._rotate(J?-this.transform.bearingInRadians:this.transform.bearingInRadians)):vn=!1}if(Ot.textBox||Ot.verticalTextBox){let on;Ot.textBox&&(on=Lt),Ot.verticalTextBox&&(on=Mt),Rt(t.textCollisionBox.collisionVertexArray,st.text.placed,!vn||on,Pt.text,bn.x,bn.y)}}if(Ot.iconBox||Ot.verticalIconBox){const vn=!!(!Mt&&Ot.verticalIconBox);let on;Ot.iconBox&&(on=vn),Ot.verticalIconBox&&(on=!vn),Rt(t.iconCollisionBox.collisionVertexArray,st.icon.placed,on,Pt.icon,se?bn.x:0,se?bn.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const f=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function Rt(A,t,s,f,x,S){f&&f.length!==0||(f=[0,0,0,0]);const k=f[0]-Un,z=f[1]-Un,j=f[2]-Un,Z=f[3]-Un;A.emplaceBack(t?1:0,s?1:0,x||0,S||0,k,z),A.emplaceBack(t?1:0,s?1:0,x||0,S||0,j,z),A.emplaceBack(t?1:0,s?1:0,x||0,S||0,j,Z),A.emplaceBack(t?1:0,s?1:0,x||0,S||0,k,Z)}const De=Math.pow(2,25),oi=Math.pow(2,24),ds=Math.pow(2,17),Ns=Math.pow(2,16),Da=Math.pow(2,9),uc=Math.pow(2,8),Hr=Math.pow(2,1);function mi(A){if(A.opacity===0&&!A.placed)return 0;if(A.opacity===1&&A.placed)return 4294967295;const t=A.placed?1:0,s=Math.floor(127*A.opacity);return s*De+t*oi+s*ds+t*Ns+s*Da+t*uc+s*Hr+t}const fr=0;class Ao{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,f,x,S){const k=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(k,x,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort(((z,j)=>z.sortKey-j.sortKey)));this._currentPartIndex<k.length;)if(s.placeLayerBucketPart(k[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1}}class cl{constructor(t,s,f,x,S,k,z,j){this.placement=new $r(t,s,k,z,j),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(t,s,f){const x=me(),S=()=>!this._forceFullPlacement&&me()-x>2;for(;this._currentPlacementIndex>=0;){const k=s[t[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=z)&&(!k.maxzoom||k.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Ao(k)),this._inProgressLayer.continuePlacement(f[k.source],this.placement,this._showCollisionBoxes,k,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Si=512/h.a5/2;class Xs{constructor(t,s,f){this.tileID=t,this.bucketInstanceId=f,this._symbolsByKey={};const x=new Map;for(let S=0;S<s.length;S++){const k=s.get(S),z=k.key,j=x.get(z);j?j.push(k):x.set(z,[k])}for(const[S,k]of x){const z={positions:k.map((j=>({x:Math.floor(j.anchorX*Si),y:Math.floor(j.anchorY*Si)}))),crossTileIDs:k.map((j=>j.crossTileID))};if(z.positions.length>128){const j=new h.aT(z.positions.length,16,Uint16Array);for(const{x:Z,y:W}of z.positions)j.add(Z,W);j.finish(),delete z.positions,z.index=j}this._symbolsByKey[S]=z}}getScaledCoordinates(t,s){const{x:f,y:x,z:S}=this.tileID.canonical,{x:k,y:z,z:j}=s.canonical,Z=Si/Math.pow(2,j-S),W=(z*h.a5+t.anchorY)*Z,ee=x*h.a5*Si;return{x:Math.floor((k*h.a5+t.anchorX)*Z-f*h.a5*Si),y:Math.floor(W-ee)}}findMatches(t,s,f){const x=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let S=0;S<t.length;S++){const k=t.get(S);if(k.crossTileID)continue;const z=this._symbolsByKey[k.key];if(!z)continue;const j=this.getScaledCoordinates(k,s);if(z.index){const Z=z.index.range(j.x-x,j.y-x,j.x+x,j.y+x).sort();for(const W of Z){const ee=z.crossTileIDs[W];if(!f[ee]){f[ee]=!0,k.crossTileID=ee;break}}}else if(z.positions)for(let Z=0;Z<z.positions.length;Z++){const W=z.positions[Z],ee=z.crossTileIDs[Z];if(Math.abs(W.x-j.x)<=x&&Math.abs(W.y-j.y)<=x&&!f[ee]){f[ee]=!0,k.crossTileID=ee;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Ll{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ul{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const f in this.indexes){const x=this.indexes[f],S={};for(const k in x){const z=x[k];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+s),S[z.tileID.key]=z}this.indexes[f]=S}this.lng=t}addBucket(t,s,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let S=0;S<s.symbolInstances.length;S++)s.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const x=this.usedCrossTileIDs[t.overscaledZ];for(const S in this.indexes){const k=this.indexes[S];if(Number(S)>t.overscaledZ)for(const z in k){const j=k[z];j.tileID.isChildOf(t)&&j.findMatches(s.symbolInstances,t,x)}else{const z=k[t.scaledTo(Number(S)).key];z&&z.findMatches(s.symbolInstances,t,x)}}for(let S=0;S<s.symbolInstances.length;S++){const k=s.symbolInstances.get(S);k.crossTileID||(k.crossTileID=f.generate(),x[k.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Xs(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const f of s.getCrossTileIDsLists())for(const x of f)delete this.usedCrossTileIDs[t][x]}removeStaleBuckets(t){let s=!1;for(const f in this.indexes){const x=this.indexes[f];for(const S in x)t[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,x[S]),delete x[S],s=!0)}return s}}class Xi{constructor(){this.layerIndexes={},this.crossTileIDs=new Ll,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,f){let x=this.layerIndexes[t.id];x===void 0&&(x=this.layerIndexes[t.id]=new ul);let S=!1;const k={};x.handleWrapJump(f);for(const z of s){const j=z.getBucket(t);j&&t.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(z.tileID,j,this.crossTileIDs)&&(S=!0),k[j.bucketInstanceId]=!0)}return x.removeStaleBuckets(k)&&(S=!0),S}pruneUnusedLayers(t){const s={};t.forEach((f=>{s[f]=!0}));for(const f in this.layerIndexes)s[f]||delete this.layerIndexes[f]}}var Br="void main() {fragColor=vec4(1.0);}";const er={prelude:yn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:yn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:yn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:yn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:yn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:yn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:yn(Br,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:yn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:yn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:yn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:yn(Br,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:yn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:yn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:yn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:yn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:yn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:yn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:yn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:yn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:yn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:yn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:yn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:yn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:yn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:yn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:yn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:yn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:yn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:yn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:yn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function yn(A,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=t.match(/in ([\w]+) ([\w]+)/g),x=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=S?S.concat(x):x,z={};return{fragmentSource:A=A.replace(s,((j,Z,W,ee,J)=>(z[J]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
in ${W} ${ee} ${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = u_${J};
#endif
`))),vertexSource:t=t.replace(s,((j,Z,W,ee,J)=>{const se=ee==="float"?"vec2":"vec4",fe=J.match(/color/)?"color":se;return z[J]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${W} ${se} a_${J};
out ${W} ${ee} ${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${fe}(a_${J}, u_${J}_t);
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${W} ${se} a_${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = a_${J};
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = unpack_mix_${fe}(a_${J}, u_${J}_t);
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`})),staticAttributes:f,staticUniforms:k}}class _r{constructor(t,s,f){this.vertexBuffer=t,this.indexBuffer=s,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ci=h.aU([{name:"a_pos",type:"Int16",components:2}]);const ji="#define PROJECTION_MERCATOR",Ws="mercator";class Qr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ws}get shaderDefine(){return ji}get shaderPreludeCode(){return er.projectionMercator}get vertexShaderPreludeCode(){return er.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,s,f,x,S){if(this._cachedMesh)return this._cachedMesh;const k=new h.aW;k.emplaceBack(0,0),k.emplaceBack(h.a5,0),k.emplaceBack(0,h.a5),k.emplaceBack(h.a5,h.a5);const z=t.createVertexBuffer(k,Ci.members),j=h.aX.simpleSegment(0,0,4,2),Z=new h.aY;Z.emplaceBack(1,0,2),Z.emplaceBack(1,2,3);const W=t.createIndexBuffer(Z);return this._cachedMesh=new _r(z,W,j),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Ys{constructor(t=0,s=0,f=0,x=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(f)||f<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=f,this.right=x}interpolate(t,s,f){return s.top!=null&&t.top!=null&&(this.top=h.G.number(t.top,s.top,f)),s.bottom!=null&&t.bottom!=null&&(this.bottom=h.G.number(t.bottom,s.bottom,f)),s.left!=null&&t.left!=null&&(this.left=h.G.number(t.left,s.left,f)),s.right!=null&&t.right!=null&&(this.right=h.G.number(t.right,s.right,f)),this}getCenter(t,s){const f=h.an((this.left+t-this.right)/2,0,t),x=h.an((this.top+s-this.bottom)/2,0,s);return new h.P(f,x)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ys(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Us(A,t){if(!A.renderWorldCopies||A.lngRange)return;const s=t.lng-A.center.lng;t.lng+=s>180?-360:s<-180?360:0}function Nr(A){return Math.max(0,Math.floor(A))}class ma{constructor(t,s){var f;this.applyConstrain=(x,S)=>this._constrainOverride!==null?this._constrainOverride(x,S):this._callbacks.defaultConstrain(x,S),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=s?.renderWorldCopies===void 0||!!s?.renderWorldCopies,this._minZoom=s?.minZoom||0,this._maxZoom=s?.maxZoom||22,this._minPitch=s?.minPitch==null?0:s?.minPitch,this._maxPitch=s?.maxPitch==null?60:s?.maxPitch,this._constrainOverride=(f=s?.constrainOverride)!==null&&f!==void 0?f:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Nr(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ys,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,s,f){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Nr(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Ys(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!f&&t.autoCalculateNearFarZ,s&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const s=h.W(t,-180,180)*Math.PI/180;var f,x,S,k,z,j,Z,W,ee;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=H(),f=this._rotationMatrix,S=-this._bearingInRadians,k=(x=this._rotationMatrix)[0],z=x[1],j=x[2],Z=x[3],W=Math.sin(S),ee=Math.cos(S),f[0]=k*ee+j*W,f[1]=z*ee+Z*W,f[2]=k*-W+j*ee,f[3]=z*-W+Z*ee)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const s=h.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const s=t/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aZ(this._fovInRadians)}setFov(t){t=h.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=h.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const s=this.applyConstrain(this._center,t).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=h.aq(s),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,s){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,f){this._unmodified=!1,this._edgeInsets.interpolate(t,s,f),this.constrainInternal(),this._calcMatrices()}resize(t,s,f=!0){this._width=t,this._height=s,f&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new qn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-h.ao,h.ao])}getCameraQueryGeometry(t,s){if(s.length===1)return[s[0],t];{const{minX:f,minY:x,maxX:S,maxY:k}=h.aa.fromPoints(s).extend(t);return[new h.P(f,x),new h.P(S,x),new h.P(S,k),new h.P(f,k),new h.P(f,x)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:f}=this.applyConstrain(this.center,this.zoom);this.setCenter(s),this.setZoom(f),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=h.ar(new Float64Array(16));h.Q(t,t,[this._width/2,-this._height/2,1]),h.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=h.ar(new Float64Array(16)),h.Q(t,t,[1,-1,1]),h.O(t,t,[-1,-1,0]),h.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,s,f,x){const S=f!==void 0?f:this.bearing,k=x=x!==void 0?x:this.pitch,{distanceToCenter:z,clampedElevation:j}=this._distanceToCenterFromAltElevationPitch(s,this.elevation,k),{x:Z,y:W}=ai(k,S),ee=h.a9.fromLngLat(t,s);let J,se,fe=h.a_(1,ee.y),Ce=0;do{if(Ce+=1,Ce>10)break;se=z/fe,J=new h.a9(ee.x+Z*se,ee.y+W*se),fe=1/J.meterInMercatorCoordinateUnits()}while(Math.abs(z-se*fe)>1e-12);return{center:J.toLngLat(),elevation:j,zoom:h.at(this.height/2/Math.tan(this.fovInRadians/2)/se/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const s=1/this.worldSize,f=h.as(1,this.center.lat)*this.worldSize,x=h.a9.fromLngLat(this.center,this.elevation),S=x.x/s,k=x.y/s,z=x.z/s,j=this.pitch,Z=this.bearing,{x:W,y:ee,z:J}=ai(j,Z),se=this.cameraToCenterDistance,fe=S+se*-W,Ce=k+se*-ee,Me=z+se*J,{distanceToCenter:Ie,clampedElevation:Be}=this._distanceToCenterFromAltElevationPitch(Me/f,t,j),Qe=Ie*f,Le=new h.a9((fe+W*Qe)*s,(Ce+ee*Qe)*s,0).toLngLat(),$e=h.as(1,Le.lat),st=h.at(this.height/2/Math.tan(this.fovInRadians/2)/Ie/$e/this.tileSize);this._elevation=Be,this._center=Le,this.setZoom(st)}_distanceToCenterFromAltElevationPitch(t,s,f){const x=-Math.cos(h.ap(f)),S=t-s;let k,z=s;return x*S>=0||Math.abs(x)<.1?(k=1e4,z=t+k*x):k=-S/x,{distanceToCenter:k,clampedElevation:z}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=h.as(1,this.center.lat)*this.worldSize;return ut(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const s=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/s,t.canonical.y/s,1/s/h.a5,1/s/h.a5]}}class ys{constructor(t,s){this.min=t,this.max=s,this.center=h.a$([],h.b0([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],f=h.b1(this.min),x=h.b1(this.max);for(let S=0;S<s.length;S++)f[S]=s[S]?this.min[S]:this.center[S],x[S]=s[S]?this.center[S]:this.max[S];return x[2]=this.max[2],new ys(f,x)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let s=!0;for(let f=0;f<t.planes.length;f++){const x=this.intersectsPlane(t.planes[f]);if(x===0)return 0;x===1&&(s=!1)}return s?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let s=t[3],f=t[3];for(let x=0;x<3;x++)t[x]>0?(s+=t[x]*this.min[x],f+=t[x]*this.max[x]):(f+=t[x]*this.min[x],s+=t[x]*this.max[x]);return s>=0?2:f<0?0:1}}class Ea{distanceToTile2d(t,s,f,x){const S=x.distanceX([t,s]),k=x.distanceY([t,s]);return Math.hypot(S,k)}getWrap(t,s,f){return f}getTileBoundingVolume(t,s,f,x){var S,k;let z=0,j=0;if(x?.terrain){const W=new h.a2(t.z,s,t.z,t.x,t.y),ee=x.terrain.getMinMaxElevation(W);z=(S=ee.minElevation)!==null&&S!==void 0?S:Math.min(0,f),j=(k=ee.maxElevation)!==null&&k!==void 0?k:Math.max(0,f)}const Z=1<<t.z;return new ys([s+t.x/Z,t.y/Z,z],[s+(t.x+1)/Z,(t.y+1)/Z,j])}allowVariableZoom(t,s){const f=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,x=h.an(78.5-f/2,0,60);return!!s.terrain||t.pitch>x}allowWorldCopies(){return!0}prepareNextFrame(){}}class Ds{constructor(t,s,f){this.points=t,this.planes=s,this.aabb=f}static fromInvProjectionMatrix(t,s=1,f=0,x,S){const k=S?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],z=Math.pow(2,f),j=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((J=>(function(se,fe,Ce,Me){const Ie=h.aH([],se,fe),Be=1/Ie[3]/Ce*Me;return h.b6(Ie,Ie,[Be,Be,1/Ie[3],Be])})(J,t,s,z)));x&&(function(J,se,fe,Ce){const Me=Ce?4:0,Ie=Ce?0:4;let Be=0;const Qe=[],Le=[];for(let Ve=0;Ve<4;Ve++){const dt=h.b2([],J[Ve+Ie],J[Ve+Me]),Lt=h.b7(dt);h.a$(dt,dt,1/Lt),Qe.push(Lt),Le.push(dt)}for(let Ve=0;Ve<4;Ve++){const dt=h.b8(J[Ve+Me],Le[Ve],fe);Be=dt!==null&&dt>=0?Math.max(Be,dt):Math.max(Be,Qe[Ve])}const $e=(function(Ve,dt){const Lt=h.b2([],Ve[dt[0]],Ve[dt[1]]),Mt=h.b2([],Ve[dt[2]],Ve[dt[1]]),Pt=[0,0,0,0];return h.b3(Pt,h.b4([],Lt,Mt)),Pt[3]=-h.b5(Pt,Ve[dt[0]]),Pt})(J,se),st=(function(Ve,dt){const Lt=h.b9(Ve),Mt=h.ba([],Ve,1/Lt),Pt=h.b2([],dt,h.a$([],Mt,h.b5(dt,Mt))),Ot=h.b9(Pt);if(Ot>0){const bn=Math.sqrt(1-Mt[3]*Mt[3]),vn=h.a$([],Mt,-Mt[3]),on=h.b0([],vn,h.a$([],Pt,bn/Ot));return h.bb(dt,on)}return null})(fe,$e);if(st!==null){const Ve=st/h.b5(Le[0],$e);Be=Math.min(Be,Ve)}for(let Ve=0;Ve<4;Ve++){const dt=Math.min(Be,Qe[Ve]);J[Ve+Ie]=[J[Ve+Me][0]+Le[Ve][0]*dt,J[Ve+Me][1]+Le[Ve][1]*dt,J[Ve+Me][2]+Le[Ve][2]*dt,1]}})(j,k[0],x,S);const Z=k.map((J=>{const se=h.b2([],j[J[0]],j[J[1]]),fe=h.b2([],j[J[2]],j[J[1]]),Ce=h.b3([],h.b4([],se,fe)),Me=-h.b5(Ce,j[J[1]]);return Ce.concat(Me)})),W=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],ee=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const J of j)for(let se=0;se<3;se++)W[se]=Math.min(W[se],J[se]),ee[se]=Math.max(ee[se],J[se]);return new Ds(j,Z,new ys(W,ee))}}class Dr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,f=!0){this._helper.resize(t,s,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,s){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(s,f)=>{f=h.an(+f,this.minZoom,this.maxZoom);const x={center:new h.V(s.lng,s.lat),zoom:f};let S=this._helper._lngRange;if(!this._helper._renderWorldCopies&&S===null){const Le=179.9999999999;S=[-Le,Le]}const k=this.tileSize*h.aq(x.zoom);let z=0,j=k,Z=0,W=k,ee=0,J=0;const{x:se,y:fe}=this.size;if(this._helper._latRange){const Le=this._helper._latRange;z=h.X(Le[1])*k,j=h.X(Le[0])*k,j-z<fe&&(ee=fe/(j-z))}S&&(Z=h.W(h.Y(S[0])*k,0,k),W=h.W(h.Y(S[1])*k,0,k),W<Z&&(W+=k),W-Z<se&&(J=se/(W-Z)));const{x:Ce,y:Me}=jt(k,s);let Ie,Be;const Qe=Math.max(J||0,ee||0);if(Qe){const Le=new h.P(J?(W+Z)/2:Ce,ee?(j+z)/2:Me);return x.center=_n(k,Le).wrap(),x.zoom+=h.at(Qe),x}if(this._helper._latRange){const Le=fe/2;Me-Le<z&&(Be=z+Le),Me+Le>j&&(Be=j-Le)}if(S){const Le=(Z+W)/2;let $e=Ce;this._helper._renderWorldCopies&&($e=h.W(Ce,Le-k/2,Le+k/2));const st=se/2;$e-st<Z&&(Ie=Z+st),$e+st>W&&(Ie=W-st)}if(Ie!==void 0||Be!==void 0){const Le=new h.P(Ie??Ce,Be??Me);x.center=_n(k,Le).wrap()}return x},this.applyConstrain=(s,f)=>this._helper.applyConstrain(s,f),this._helper=new ma({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,f)=>this.defaultConstrain(s,f)},t),this._coveringTilesDetailsProvider=new Ea}clone(){const t=new Dr;return t.apply(this),t}apply(t,s,f){this._helper.apply(t,s,f)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const s=[new h.bc(0,t)];if(this._helper._renderWorldCopies){const f=this.screenPointToMercatorCoordinate(new h.P(0,0)),x=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),k=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),z=Math.floor(Math.min(f.x,x.x,S.x,k.x)),j=Math.floor(Math.max(f.x,x.x,S.x,k.x)),Z=1;for(let W=z-Z;W<=j+Z;W++)W!==0&&s.push(new h.bc(W,t))}return s}getCameraFrustum(){return Ds.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const s=this.screenPointToLocation(this.centerPoint,t),f=t?t.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(f)}setLocationAtPoint(t,s){const f=h.as(this.elevation,this.center.lat),x=this.screenPointToMercatorCoordinateAtZ(s,f),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,f),k=h.a9.fromLngLat(t),z=new h.a9(k.x-(x.x-S.x),k.y-(x.y-S.y));this.setCenter(z?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,s){return s?this.coordinatePoint(h.a9.fromLngLat(t),s.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(h.a9.fromLngLat(t))}screenPointToLocation(t,s){var f;return(f=this.screenPointToMercatorCoordinate(t,s))===null||f===void 0?void 0:f.toLngLat()}screenPointToMercatorCoordinate(t,s){if(s){const f=s.pointCoordinate(t);if(f!=null)return f}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,s){const f=s||0,x=[t.x,t.y,0,1],S=[t.x,t.y,1,1];h.aH(x,x,this._pixelMatrixInverse),h.aH(S,S,this._pixelMatrixInverse);const k=x[3],z=S[3],j=x[1]/k,Z=S[1]/z,W=x[2]/k,ee=S[2]/z,J=W===ee?0:(f-W)/(ee-W);return new h.a9(h.G.number(x[0]/k,S[0]/z,J)/this.worldSize,h.G.number(j,Z,J)/this.worldSize,f)}coordinatePoint(t,s=0,f=this._pixelMatrix){const x=[t.x*this.worldSize,t.y*this.worldSize,s,1];return h.aH(x,x,f),new h.P(x[0]/x[3],x[1]/x[3])}getBounds(){const t=Math.max(0,this._helper._height/2-mn(this));return new qn().extend(this.screenPointToLocation(new h.P(0,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(t,s){return s?s.pointCoordinate(t)!=null:t.y>this.height/2-mn(this)}calculatePosMatrix(t,s=!1,f){var x;const S=(x=t.key)!==null&&x!==void 0?x:h.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),k=s?this._alignedPosMatrixCache:this._posMatrixCache;if(k.has(S)){const Z=k.get(S);return f?Z.f32:Z.f64}const z=ti(t,this.worldSize);h.S(z,s?this._alignedProjMatrix:this._viewProjMatrix,z);const j={f64:z,f32:new Float32Array(z)};return k.set(S,j),f?j.f32:j.f64}calculateFogMatrix(t){const s=t.key,f=this._fogMatrixCacheF32;if(f.has(s))return f.get(s);const x=ti(t,this.worldSize);return h.S(x,this._fogMatrix,x),f.set(s,new Float32Array(x)),f.get(s)}calculateCenterFromCameraLngLatAlt(t,s,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,x)}_calculateNearFarZIfNeeded(t,s,f){if(!this._helper.autoCalculateNearFarZ)return;const x=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=t-x*this._helper._pixelPerMeter/Math.cos(s),k=x<0?S:t,z=Math.PI/2+this.pitchInRadians,j=h.ap(this.fov)*(Math.abs(Math.cos(h.ap(this.roll)))*this.height+Math.abs(Math.sin(h.ap(this.roll)))*this.width)/this.height*(.5+f.y/this.height),Z=Math.sin(j)*k/Math.sin(h.an(Math.PI-z-j,.01,Math.PI-.01)),W=mn(this),ee=Math.atan(W/this._helper.cameraToCenterDistance),J=h.ap(.75),se=ee>J?2*ee*(.5+f.y/(2*W)):J,fe=Math.sin(se)*k/Math.sin(h.an(Math.PI-z-se,.01,Math.PI-.01)),Ce=Math.min(Z,fe);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*Ce+k),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,s=jt(this.worldSize,this.center),f=s.x,x=s.y;this._helper._pixelPerMeter=h.as(1,this.center.lat)*this.worldSize;const S=h.ap(Math.min(this.pitch,At)),k=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S));let z;this._calculateNearFarZIfNeeded(k,S,t),z=new Float64Array(16),h.be(z,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.aB(this._invProjMatrix,z),z[8]=2*-t.x/this._helper._width,z[9]=2*t.y/this._helper._height,this._projectionMatrix=h.bf(z),h.Q(z,z,[1,-1,1]),h.O(z,z,[0,0,-this._helper.cameraToCenterDistance]),h.bg(z,z,-this.rollInRadians),h.bh(z,z,this.pitchInRadians),h.bg(z,z,-this.bearingInRadians),h.O(z,z,[-f,-x,0]),this._mercatorMatrix=h.Q([],z,[this.worldSize,this.worldSize,this.worldSize]),h.Q(z,z,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,z),h.O(z,z,[0,0,-this.elevation]),this._viewProjMatrix=z,this._invViewProjMatrix=h.aB([],z);const j=[0,0,-1,1];h.aH(j,j,this._invViewProjMatrix),this._cameraPosition=[j[0]/j[3],j[1]/j[3],j[2]/j[3]],this._fogMatrix=new Float64Array(16),h.be(this._fogMatrix,this.fovInRadians,this.width/this.height,k,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,h.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.O(this._fogMatrix,this._fogMatrix,[-f,-x,0]),h.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,z);const Z=this._helper._width%2/2,W=this._helper._height%2/2,ee=Math.cos(this.bearingInRadians),J=Math.sin(-this.bearingInRadians),se=f-Math.round(f)+ee*Z+J*W,fe=x-Math.round(x)+ee*W+J*Z,Ce=new Float64Array(z);if(h.O(Ce,Ce,[se>.5?se-1:se,fe>.5?fe-1:fe,0]),this._alignedProjMatrix=Ce,z=h.aB(new Float64Array(16),this._pixelMatrix),!z)throw new Error("failed to invert matrix");this._pixelMatrixInverse=z,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new h.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.aH(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=h.as(1,this.center.lat)*this.worldSize;return ut(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,s){const f=h.a9.fromLngLat(t),x=[f.x*this.worldSize,f.y*this.worldSize,s,1];return h.aH(x,x,this._viewProjMatrix),x[2]/x[3]}getProjectionData(t){const{overscaledTileID:s,aligned:f,applyTerrainMatrix:x}=t,S=this._helper.getMercatorTileCoordinates(s),k=s?this.calculatePosMatrix(s,f,!0):null;let z;return z=s&&s.terrainRttPosMatrix32f&&x?s.terrainRttPosMatrix32f:k||h.bi(),{mainMatrix:z,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:z}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,s,f){return 1}transformLightDirection(t){return h.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,s,f,x){const S=this.calculatePosMatrix(f);let k;x?(k=[t,s,x(t,s),1],h.aH(k,k,S)):(k=[t,s,0,1],ci(k,k,S));const z=k[3];return{point:new h.P(k[0]/z,k[1]/z),signedDistanceFromCamera:z,isOccluded:!1}}populateCache(t){for(const s of t)this.calculatePosMatrix(s)}getMatrixForModel(t,s){const f=h.a9.fromLngLat(t,s),x=f.meterInMercatorCoordinateUnits(),S=h.bj();return h.O(S,S,[f.x,f.y,f.z]),h.bg(S,S,Math.PI),h.bh(S,S,Math.PI/2),h.Q(S,S,[-x,x,x]),S}getProjectionDataForCustomLayer(t=!0){const s=new h.a2(0,0,0,0,0),f=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:t}),x=ti(s,this.worldSize);h.S(x,this._viewProjMatrix,x),f.tileMercatorCoords=[0,0,1,1];const S=[h.a5,h.a5,this.worldSize/this._helper.pixelsPerMeter],k=h.bk();return h.Q(k,x,S),f.fallbackMatrix=k,f.mainMatrix=k,f}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function ns(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ir(A){if(A.useSlerp)if(A.k<1){const t=h.bl(A.startEulerAngles.roll,A.startEulerAngles.pitch,A.startEulerAngles.bearing),s=h.bl(A.endEulerAngles.roll,A.endEulerAngles.pitch,A.endEulerAngles.bearing),f=new Float64Array(4);h.bm(f,t,s,A.k);const x=h.bn(f);A.tr.setRoll(x.roll),A.tr.setPitch(x.pitch),A.tr.setBearing(x.bearing)}else A.tr.setRoll(A.endEulerAngles.roll),A.tr.setPitch(A.endEulerAngles.pitch),A.tr.setBearing(A.endEulerAngles.bearing);else A.tr.setRoll(h.G.number(A.startEulerAngles.roll,A.endEulerAngles.roll,A.k)),A.tr.setPitch(h.G.number(A.startEulerAngles.pitch,A.endEulerAngles.pitch,A.k)),A.tr.setBearing(h.G.number(A.startEulerAngles.bearing,A.endEulerAngles.bearing,A.k))}function Eo(A,t,s,f,x){const S=x.padding,k=jt(x.worldSize,s.getNorthWest()),z=jt(x.worldSize,s.getNorthEast()),j=jt(x.worldSize,s.getSouthEast()),Z=jt(x.worldSize,s.getSouthWest()),W=h.ap(-f),ee=k.rotate(W),J=z.rotate(W),se=j.rotate(W),fe=Z.rotate(W),Ce=new h.P(Math.max(ee.x,J.x,fe.x,se.x),Math.max(ee.y,J.y,fe.y,se.y)),Me=new h.P(Math.min(ee.x,J.x,fe.x,se.x),Math.min(ee.y,J.y,fe.y,se.y)),Ie=Ce.sub(Me),Be=(x.width-(S.left+S.right+t.left+t.right))/Ie.x,Qe=(x.height-(S.top+S.bottom+t.top+t.bottom))/Ie.y;if(Qe<0||Be<0)return void ns();const Le=Math.min(h.at(x.scale*Math.min(Be,Qe)),A.maxZoom),$e=h.P.convert(A.offset),st=new h.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(h.ap(f)),Ve=$e.add(st).mult(x.scale/h.aq(Le));return{center:_n(x.worldSize,k.add(j).div(2).sub(Ve)),zoom:Le,bearing:f}}class So{get useGlobeControls(){return!1}handlePanInertia(t,s){const f=t.mag(),x=Math.abs(mn(s));return{easingOffset:t.mult(Math.min(.75*x/f,1)),easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(t,s){t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta),t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta)}handleMapControlsPan(t,s,f){t.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(f,t.around)}cameraForBoxAndBearing(t,s,f,x,S){return Eo(t,s,f,x,S)}handleJumpToCenterZoom(t,s){t.zoom!==(s.zoom!==void 0?+s.zoom:t.zoom)&&t.setZoom(+s.zoom),s.center!==void 0&&t.setCenter(h.V.convert(s.center))}handleEaseTo(t,s){const f=t.zoom,x=t.padding,S={roll:t.roll,pitch:t.pitch,bearing:t.bearing},k={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},z=s.zoom!==void 0,j=!t.isPaddingEqual(s.padding);let Z=!1;const W=z?+s.zoom:t.zoom;let ee=t.centerPoint.add(s.offsetAsPoint);const J=t.screenPointToLocation(ee),{center:se,zoom:fe}=t.applyConstrain(h.V.convert(s.center||J),W??f);Us(t,se);const Ce=jt(t.worldSize,J),Me=jt(t.worldSize,se).sub(Ce),Ie=h.aq(fe-f);return Z=fe!==f,{easeFunc:Be=>{if(Z&&t.setZoom(h.G.number(f,fe,Be)),h.bo(S,k)||ir({startEulerAngles:S,endEulerAngles:k,tr:t,k:Be,useSlerp:S.roll!=k.roll}),j&&(t.interpolatePadding(x,s.padding,Be),ee=t.centerPoint.add(s.offsetAsPoint)),s.around)t.setLocationAtPoint(s.around,s.aroundPoint);else{const Qe=h.aq(t.zoom-f),Le=fe>f?Math.min(2,Ie):Math.max(.5,Ie),$e=Math.pow(Le,1-Be),st=_n(t.worldSize,Ce.add(Me.mult(Be*$e)).mult(Qe));t.setLocationAtPoint(t.renderWorldCopies?st.wrap():st,ee)}},isZooming:Z,elevationCenter:se}}handleFlyTo(t,s){const f=s.zoom!==void 0,x=t.zoom,S=t.applyConstrain(h.V.convert(s.center||s.locationAtOffset),f?+s.zoom:x),k=S.center,z=S.zoom;Us(t,k);const j=jt(t.worldSize,s.locationAtOffset),Z=jt(t.worldSize,k).sub(j),W=Z.mag(),ee=h.aq(z-x);let J;if(s.minZoom!==void 0){const se=Math.min(+s.minZoom,x,z),fe=t.applyConstrain(k,se).zoom;J=h.aq(fe-x)}return{easeFunc:(se,fe,Ce,Me)=>{t.setZoom(se===1?z:x+h.at(fe));const Ie=se===1?k:_n(t.worldSize,j.add(Z.mult(Ce)).mult(fe));t.setLocationAtPoint(t.renderWorldCopies?Ie.wrap():Ie,Me)},scaleOfZoom:ee,targetCenter:k,scaleOfMinZoom:J,pixelPathLength:W}}}class cr{constructor(t,s,f){this.blendFunction=t,this.blendColor=s,this.mask=f}}cr.Replace=[1,0],cr.disabled=new cr(cr.Replace,h.bp.transparent,[!1,!1,!1,!1]),cr.unblended=new cr(cr.Replace,h.bp.transparent,[!0,!0,!0,!0]),cr.alphaBlended=new cr([1,771],h.bp.transparent,[!0,!0,!0,!0]);const Ee=2305;class qe{constructor(t,s,f){this.enable=t,this.mode=s,this.frontFace=f}}qe.disabled=new qe(!1,1029,Ee),qe.backCCW=new qe(!0,1029,Ee),qe.frontCCW=new qe(!0,1028,Ee);class Xe{constructor(t,s,f){this.func=t,this.mask=s,this.range=f}}Xe.ReadOnly=!1,Xe.ReadWrite=!0,Xe.disabled=new Xe(519,Xe.ReadOnly,[0,1]);const et=7680;class bt{constructor(t,s,f,x,S,k){this.test=t,this.ref=s,this.mask=f,this.fail=x,this.depthFail=S,this.pass=k}}bt.disabled=new bt({func:519,mask:0},0,0,et,et,et);const Mn=new WeakMap;function Xn(A){var t;if(Mn.has(A))return Mn.get(A);{const s=(t=A.getParameter(A.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Mn.set(A,s),s}}class Ui{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const s=t.context,f=s.gl;this._texFormat=f.RGBA,this._texType=f.UNSIGNED_BYTE;const x=new h.aW;x.emplaceBack(-1,-1),x.emplaceBack(2,-1),x.emplaceBack(-1,2);const S=new h.aY;S.emplaceBack(0,1,2),this._fullscreenTriangle=new _r(s.createVertexBuffer(x,Ci.members),s.createIndexBuffer(S),h.aX.simpleSegment(0,0,x.length,S.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(f.TEXTURE1);const k=f.createTexture();f.bindTexture(f.TEXTURE_2D,k),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texImage2D(f.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(k),Xn(f)&&(this._pbo=f.createBuffer(),f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.bufferData(f.PIXEL_PACK_BUFFER,4,f.STREAM_READ),f.bindBuffer(f.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,s){const f=this._updateCount;return this._readbackQueue?f>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():f>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,s=t.gl;t.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,s){const f=this._cachedRenderContext.context,x=f.gl;if(this._bindFramebuffer(),f.viewport.set([0,0,this._texWidth,this._texHeight]),f.clear({color:h.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(f,x.TRIANGLES,Xe.disabled,bt.disabled,cr.unblended,qe.disabled,((S,k)=>({u_input:S,u_output_expected:k}))(t,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Xn(x)){x.bindBuffer(x.PIXEL_PACK_BUFFER,this._pbo),x.readBuffer(x.COLOR_ATTACHMENT0),x.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),x.bindBuffer(x.PIXEL_PACK_BUFFER,null);const S=x.fenceSync(x.SYNC_GPU_COMMANDS_COMPLETE,0);x.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Xn(t)){const s=t.clientWaitSync(this._readbackQueue.sync,0,0);if(s===t.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ui._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let s=0;return s+=t[0]/256,s+=t[1]/65536,s+=t[2]/16777216,t[3]<127&&(s=-s),s/128}}const It=h.a5/128;function hi(A,t){const s=A.granularity!==void 0?Math.max(A.granularity,1):1,f=s+(A.generateBorders?2:0),x=s+(A.extendToNorthPole||A.generateBorders?1:0)+(A.extendToSouthPole||A.generateBorders?1:0),S=f+1,k=x+1,z=A.generateBorders?-1:0,j=A.generateBorders||A.extendToNorthPole?-1:0,Z=s+(A.generateBorders?1:0),W=s+(A.generateBorders||A.extendToSouthPole?1:0),ee=S*k,J=f*x*6,se=S*k>65536;if(se&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const fe=se||t==="32bit",Ce=new Int16Array(2*ee);let Me=0;for(let Qe=j;Qe<=W;Qe++)for(let Le=z;Le<=Z;Le++){let $e=Le/s*h.a5;Le===-1&&($e=-It),Le===s+1&&($e=h.a5+It);let st=Qe/s*h.a5;Qe===-1&&(st=A.extendToNorthPole?h.br:-It),Qe===s+1&&(st=A.extendToSouthPole?h.bs:h.a5+It),Ce[Me++]=$e,Ce[Me++]=st}const Ie=fe?new Uint32Array(J):new Uint16Array(J);let Be=0;for(let Qe=0;Qe<x;Qe++)for(let Le=0;Le<f;Le++){const $e=Le+1+Qe*S,st=Le+(Qe+1)*S,Ve=Le+1+(Qe+1)*S;Ie[Be++]=Le+Qe*S,Ie[Be++]=st,Ie[Be++]=$e,Ie[Be++]=$e,Ie[Be++]=st,Ie[Be++]=Ve}return{vertices:Ce.buffer.slice(0),indices:Ie.buffer.slice(0),uses32bitIndices:fe}}const Hi=new h.aV({fill:new h.bt(128,2),line:new h.bt(512,0),tile:new h.bt(128,32),stencil:new h.bt(128,1),circle:3});class ya{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return er.projectionGlobe}get vertexShaderPreludeCode(){return er.projectionMercator.vertexSource}get subdivisionGranularity(){return Hi}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Ui(t));const s=h.X(this._errorQueryLatitudeDegrees),f=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,x=this._errorMeasurement.updateErrorLoop(s,f),S=me();x!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=x,this._errorMeasurementLastChangeTime=S);const k=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bv(k))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,s,f,x,S){const k=(S==="stencil"?Hi.stencil:Hi.tile).getGranularityForZoomLevel(s.z);return this._getMesh(t,{granularity:k,generateBorders:f,extendToNorthPole:s.y===0&&x,extendToSouthPole:s.y===(1<<s.z)-1&&x})}_getMesh(t,s){const f=this._getMeshKey(s);if(f in this._tileMeshCache)return this._tileMeshCache[f];const x=(function(S,k){const z=hi(k,"16bit"),j=h.aW.deserialize({arrayBuffer:z.vertices,length:z.vertices.byteLength/2/2}),Z=h.aY.deserialize({arrayBuffer:z.indices,length:z.indices.byteLength/2/3});return new _r(S.createVertexBuffer(j,Ci.members),S.createIndexBuffer(Z),h.aX.simpleSegment(0,0,j.length,Z.length))})(t,s);return this._tileMeshCache[f]=x,x}recalculate(t){}hasTransition(){const t=me();let s=!1;return s=s||(t-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const hc=new h.t({type:new h.D(h.u.projection.type)});class qo extends h.E{constructor(t){super(),this._transitionable=new h.x(hc,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0)),this._mercatorProjection=new Qr,this._verticalPerspectiveProjection=new ya}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof h.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,s,f,x,S){return this.currentProjection.getMeshFromTileID(t,s,f,x,S)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Rs(A){const t=wr(A.worldSize,A.center.lat);return 2*Math.PI*t}function Cs(A,t,s,f,x){const S=1/(1<<x),k=t/h.a5*S+f*S,z=h.by((A/h.a5*S+s*S)*Math.PI*2+Math.PI,2*Math.PI),j=2*Math.atan(Math.exp(Math.PI-k*Math.PI*2))-.5*Math.PI,Z=Math.cos(j),W=new Float64Array(3);return W[0]=Math.sin(z)*Z,W[1]=Math.sin(j),W[2]=Math.cos(z)*Z,W}function rr(A){return(function(t,s){const f=Math.cos(s),x=new Float64Array(3);return x[0]=Math.sin(t)*f,x[1]=Math.sin(s),x[2]=Math.cos(t)*f,x})(A.lng*Math.PI/180,A.lat*Math.PI/180)}function wr(A,t){return A/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Ra(A){const t=Math.asin(A[1])/Math.PI*180,s=Math.sqrt(A[0]*A[0]+A[2]*A[2]);if(s>1e-6){const f=A[0]/s,x=Math.acos(A[2]/s),S=(f>0?x:-x)/Math.PI*180;return new h.V(h.W(S,-180,180),t)}return new h.V(0,t)}function pr(A){return Math.cos(A*Math.PI/180)}function br(A,t){const s=pr(A),f=pr(t);return h.at(f/s)}function Pa(A,t){const s=A.rotate(t.bearingInRadians),f=t.zoom+br(t.center.lat,0),x=h.bu(1/pr(t.center.lat),1/pr(Math.min(Math.abs(t.center.lat),60)),h.bx(f,7,3,0,1)),S=360/Rs({worldSize:t.worldSize,center:{lat:t.center.lat}});return new h.V(t.center.lng-s.x*S*x,h.an(t.center.lat+s.y*S,-h.ao,h.ao))}function Wi(A){const t=.5*A,s=Math.sin(t),f=Math.cos(t);return Math.log(s+f)-Math.log(f-s)}function wi(A,t,s,f){const x=A.lat+s*f;if(Math.abs(s)>1){const S=(Math.sign(A.lat+s)!==Math.sign(A.lat)?-Math.abs(A.lat):Math.abs(A.lat))*Math.PI/180,k=Math.abs(A.lat+s)*Math.PI/180,z=Wi(S+f*(k-S)),j=Wi(S),Z=Wi(k);return new h.V(A.lng+t*((z-j)/(Z-j)),x)}return new h.V(A.lng+t*f,x)}class ih{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,s,f,x){const S=`${t.z}_${t.x}_${t.y}_${x?.terrain?"t":""}`,k=this._cache.get(S);if(k)return k;const z=this._cachePrevious.get(S);if(z)return this._cache.set(S,z),z;const j=this._boundingVolumeFactory(t,s,f,x);return this._cache.set(S,j),this._hadAnyChanges=!0,j}}class gr{constructor(t,s,f,x){this.min=f,this.max=x,this.points=t,this.planes=s}static fromAabb(t,s){const f=[];for(let x=0;x<8;x++)f.push([1&~x?t[0]:s[0],(x>>1&1)==1?s[1]:t[1],(x>>2&1)==1?s[2]:t[2]]);return new gr(f,[[-1,0,0,s[0]],[1,0,0,-t[0]],[0,-1,0,s[1]],[0,1,0,-t[1]],[0,0,-1,s[2]],[0,0,1,-t[2]]],t,s)}static fromCenterSizeAngles(t,s,f){const x=h.bB([],f[0],f[1],f[2]),S=h.bC([],[s[0],0,0],x),k=h.bC([],[0,s[1],0],x),z=h.bC([],[0,0,s[2]],x),j=[...t],Z=[...t];for(let ee=0;ee<8;ee++)for(let J=0;J<3;J++){const se=t[J]+S[J]*(1&~ee?-1:1)+k[J]*((ee>>1&1)==1?1:-1)+z[J]*((ee>>2&1)==1?1:-1);j[J]=Math.min(j[J],se),Z[J]=Math.max(Z[J],se)}const W=[];for(let ee=0;ee<8;ee++){const J=[...t];h.b0(J,J,h.a$([],S,1&~ee?-1:1)),h.b0(J,J,h.a$([],k,(ee>>1&1)==1?1:-1)),h.b0(J,J,h.a$([],z,(ee>>2&1)==1?1:-1)),W.push(J)}return new gr(W,[[...S,-h.b5(S,W[0])],[...k,-h.b5(k,W[0])],[...z,-h.b5(z,W[0])],[-S[0],-S[1],-S[2],-h.b5(S,W[7])],[-k[0],-k[1],-k[2],-h.b5(k,W[7])],[-z[0],-z[1],-z[2],-h.b5(z,W[7])]],j,Z)}intersectsFrustum(t){let s=!0;const f=this.points.length,x=this.planes.length,S=t.planes.length,k=t.points.length;for(let z=0;z<S;z++){const j=t.planes[z];let Z=0;for(let W=0;W<f;W++){const ee=this.points[W];j[0]*ee[0]+j[1]*ee[1]+j[2]*ee[2]+j[3]>=0&&Z++}if(Z===0)return 0;Z<f&&(s=!1)}if(s)return 2;for(let z=0;z<x;z++){const j=this.planes[z];let Z=0;for(let W=0;W<k;W++){const ee=t.points[W];j[0]*ee[0]+j[1]*ee[1]+j[2]*ee[2]+j[3]>=0&&Z++}if(Z===0)return 0}return 1}intersectsPlane(t){const s=this.points.length;let f=0;for(let x=0;x<s;x++){const S=this.points[x];t[0]*S[0]+t[1]*S[1]+t[2]*S[2]+t[3]>=0&&f++}return f===s?2:f===0?0:1}}function Ua(A,t,s){const f=A-t;return f<0?-f:Math.max(0,f-s)}function Sa(A,t,s,f,x){const S=A-s;let k;return k=S<0?Math.min(-S,1+S-x):S>1?Math.min(Math.max(S-x,0),1-S):0,Math.max(k,Ua(t,f,x))}class dc{constructor(){this._boundingVolumeCache=new ih(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,s,f,x){const S=1<<f.z,k=1/S,z=f.x/S,j=f.y/S;let Z=2;return Z=Math.min(Z,Sa(t,s,z,j,k)),Z=Math.min(Z,Sa(t,s,z+.5,-j-k,k)),Z=Math.min(Z,Sa(t,s,z+.5,2-j-k,k)),Z}getWrap(t,s,f){const x=1<<s.z,S=1/x,k=s.x/x,z=Ua(t.x,k,S),j=Ua(t.x,k-1,S),Z=Ua(t.x,k+1,S),W=Math.min(z,j,Z);return W===Z?1:W===j?-1:0}allowVariableZoom(t,s){return Mi(t,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,s,f,x){return this._boundingVolumeCache.getTileBoundingVolume(t,s,f,x)}_computeTileBoundingVolume(t,s,f,x){var S,k;let z=0,j=0;if(x?.terrain){const Z=new h.a2(t.z,s,t.z,t.x,t.y),W=x.terrain.getMinMaxElevation(Z);z=(S=W.minElevation)!==null&&S!==void 0?S:Math.min(0,f),j=(k=W.maxElevation)!==null&&k!==void 0?k:Math.max(0,f)}if(z/=h.bE,j/=h.bE,z+=1,j+=1,t.z<=0)return gr.fromAabb([-j,-j,-j],[j,j,j]);if(t.z===1)return gr.fromAabb([t.x===0?-j:0,t.y===0?0:-j,-j],[t.x===0?0:j,t.y===0?j:0,j]);{const Z=[Cs(0,0,t.x,t.y,t.z),Cs(h.a5,0,t.x,t.y,t.z),Cs(h.a5,h.a5,t.x,t.y,t.z),Cs(0,h.a5,t.x,t.y,t.z)],W=[];for(const Pt of Z)W.push(h.a$([],Pt,j));if(j!==z)for(const Pt of Z)W.push(h.a$([],Pt,z));t.y===0&&W.push([0,1,0]),t.y===(1<<t.z)-1&&W.push([0,-1,0]);const ee=[1,1,1],J=[-1,-1,-1];for(const Pt of W)for(let Ot=0;Ot<3;Ot++)ee[Ot]=Math.min(ee[Ot],Pt[Ot]),J[Ot]=Math.max(J[Ot],Pt[Ot]);const se=Cs(h.a5/2,h.a5/2,t.x,t.y,t.z),fe=h.b4([],[0,1,0],se);h.b3(fe,fe);const Ce=h.b4([],se,fe);h.b3(Ce,Ce);const Me=h.b4([],Z[2],Z[1]);h.b3(Me,Me);const Ie=h.b4([],Z[0],Z[3]);h.b3(Ie,Ie),W.push(h.a$([],se,j)),t.y>=(1<<t.z)/2&&W.push(h.a$([],Cs(h.a5/2,0,t.x,t.y,t.z),j)),t.y<(1<<t.z)/2&&W.push(h.a$([],Cs(h.a5/2,h.a5,t.x,t.y,t.z),j));const Be=is(se,W),Qe=is(Ce,W),Le=[-se[0],-se[1],-se[2],Be.max],$e=[se[0],se[1],se[2],-Be.min],st=[-Ce[0],-Ce[1],-Ce[2],Qe.max],Ve=[Ce[0],Ce[1],Ce[2],-Qe.min],dt=[...Me,0],Lt=[...Ie,0],Mt=[];return t.y===0?Mt.push(h.bD(Lt,dt,Le),h.bD(Lt,dt,$e)):Mt.push(h.bD(st,dt,Le),h.bD(st,dt,$e),h.bD(st,Lt,Le),h.bD(st,Lt,$e)),t.y===(1<<t.z)-1?Mt.push(h.bD(Lt,dt,Le),h.bD(Lt,dt,$e)):Mt.push(h.bD(Ve,dt,Le),h.bD(Ve,dt,$e),h.bD(Ve,Lt,Le),h.bD(Ve,Lt,$e)),new gr(Mt,[Le,$e,st,Ve,dt,Lt],ee,J)}}}function is(A,t){let s=1/0,f=-1/0;for(const x of t){const S=h.b5(A,x);s=Math.min(s,S),f=Math.max(f,S)}return{min:s,max:f}}class Co{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s){this._helper.resize(t,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=h.bF(),this._projectionMatrix=h.bj(),this._globeViewProjMatrix32f=h.bi(),this._globeViewProjMatrixNoCorrection=h.bj(),this._globeViewProjMatrixNoCorrectionInverted=h.bj(),this._globeProjMatrixInverted=h.bj(),this._cameraPosition=h.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(s,f)=>{const x=h.an(s.lat,-h.ao,h.ao),S=h.an(+f,this.minZoom+br(0,x),this.maxZoom);return{center:new h.V(s.lng,x),zoom:S}},this.applyConstrain=(s,f)=>this._helper.applyConstrain(s,f),this._helper=new ma({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,f)=>this.defaultConstrain(s,f)},t),this._coveringTilesDetailsProvider=new dc}clone(){const t=new Co;return t.apply(this),t}apply(t,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=h.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:s,applyGlobeMatrix:f}=t,x=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:x,clippingPlane:this._cachedClippingPlane,projectionTransition:f?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const s=this.pitchInRadians,f=this.cameraToCenterDistance/t,x=Math.sin(s)*f,S=Math.cos(s)*f+1,k=1/Math.sqrt(x*x+S*S)*1;let z=-x,j=S;const Z=Math.sqrt(z*z+j*j);z/=Z,j/=Z;const W=[0,z,j];h.bG(W,W,[0,0,0],-this.bearingInRadians),h.bH(W,W,[0,0,0],-1*this.center.lat*Math.PI/180),h.bI(W,W,[0,0,0],this.center.lng*Math.PI/180);const ee=1/h.b7(W);return h.a$(W,W,ee),[...W,-k*ee]}isLocationOccluded(t){return!this.isSurfacePointVisible(rr(t))}transformLightDirection(t){const s=this._helper._center.lng*Math.PI/180,f=this._helper._center.lat*Math.PI/180,x=Math.cos(f),S=[Math.sin(s)*x,Math.sin(f),Math.cos(s)*x],k=[S[2],0,-S[0]],z=[0,0,0];h.b4(z,k,S),h.b3(k,k),h.b3(z,z);const j=[0,0,0];return h.b3(j,[k[0]*t[0]+z[0]*t[1]+S[0]*t[2],k[1]*t[0]+z[1]*t[1]+S[1]*t[2],k[2]*t[0]+z[2]*t[1]+S[2]*t[2]]),j}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,s,f){const x=(function(z,j,Z){const W=1/(1<<Z.z);return new h.a9(z/h.a5*W+Z.x*W,j/h.a5*W+Z.y*W)})(t,s,f.canonical),S=(k=x.y,[h.by(x.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-k*Math.PI*2))-.5*Math.PI]);var k;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(t,s,f,x){const S=f.canonical,k=Cs(t,s,S.x,S.y,S.z),z=1+(x?x(t,s):0)/h.bE,j=[k[0]*z,k[1]*z,k[2]*z,1];h.aH(j,j,this._globeViewProjMatrixNoCorrection);const Z=this._cachedClippingPlane,W=Z[0]*k[0]+Z[1]*k[1]+Z[2]*k[2]+Z[3]<0;return{point:new h.P(j[0]/j[3],j[1]/j[3]),signedDistanceFromCamera:j[3],isOccluded:W}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=wr(this.worldSize,this.center.lat),s=h.bk(),f=h.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),h.be(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const x=this.centerOffset;s[8]=2*-x.x/this._helper._width,s[9]=2*x.y/this._helper._height,this._projectionMatrix=h.bf(s),this._globeProjMatrixInverted=h.bk(),h.aB(this._globeProjMatrixInverted,s),h.O(s,s,[0,0,-this.cameraToCenterDistance]),h.bg(s,s,this.rollInRadians),h.bh(s,s,-this.pitchInRadians),h.bg(s,s,this.bearingInRadians),h.O(s,s,[0,0,-t]);const S=h.bz();S[0]=t,S[1]=t,S[2]=t,h.bh(f,s,this.center.lat*Math.PI/180),h.bJ(f,f,-this.center.lng*Math.PI/180),h.Q(f,f,S),this._globeViewProjMatrixNoCorrection=f,h.bh(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bJ(s,s,-this.center.lng*Math.PI/180),h.Q(s,s,S),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=h.bk(),h.aB(this._globeViewProjMatrixNoCorrectionInverted,f);const k=h.bz();this._cameraPosition=h.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,h.bG(this._cameraPosition,this._cameraPosition,k,-this.rollInRadians),h.bH(this._cameraPosition,this._cameraPosition,k,this.pitchInRadians),h.bG(this._cameraPosition,this._cameraPosition,k,-this.bearingInRadians),h.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bH(this._cameraPosition,this._cameraPosition,k,-this.center.lat*Math.PI/180),h.bI(this._cameraPosition,this._cameraPosition,k,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const z=h.bf(this._globeViewProjMatrixNoCorrectionInverted);h.Q(z,z,[1,1,-1]),this._cachedFrustum=Ds.fromInvProjectionMatrix(z,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){h.w("calculateFogMatrix is not supported on globe projection.");const s=h.bk();return h.ar(s),s}getVisibleUnwrappedCoordinates(t){return[new h.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const f=rr(t);h.a$(f,f,1+s/h.bE);const x=h.bF();return h.aH(x,[f[0],f[1],f[2],1],this._globeViewProjMatrixNoCorrection),x[2]/x[3]}populateCache(t){}getBounds(){const t=.5*this.width,s=.5*this.height,f=[new h.P(0,0),new h.P(t,0),new h.P(this.width,0),new h.P(this.width,s),new h.P(this.width,this.height),new h.P(t,this.height),new h.P(0,this.height),new h.P(0,s)],x=[];for(const ee of f)x.push(this.unprojectScreenPoint(ee));let S=0,k=0,z=0,j=0;const Z=this.center;for(const ee of x){const J=h.bK(Z.lng,ee.lng),se=h.bK(Z.lat,ee.lat);J<k&&(k=J),J>S&&(S=J),se<j&&(j=se),se>z&&(z=se)}const W=[Z.lng+k,Z.lat+j,Z.lng+S,Z.lat+z];return this.isSurfacePointOnScreen([0,1,0])&&(W[3]=90,W[0]=-180,W[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(W[1]=-90,W[0]=-180,W[2]=180),new qn(W)}calculateCenterFromCameraLngLatAlt(t,s,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,x)}setLocationAtPoint(t,s){const f=rr(this.unprojectScreenPoint(s)),x=rr(t),S=h.bz();h.bL(S);const k=h.bz();h.bI(k,f,S,-this.center.lng*Math.PI/180),h.bH(k,k,S,this.center.lat*Math.PI/180);const z=x[0]*x[0]+x[2]*x[2],j=k[0]*k[0];if(z<j)return;const Z=Math.sqrt(z-j),W=-Z,ee=h.bM(x[0],x[2],k[0],Z),J=h.bM(x[0],x[2],k[0],W),se=h.bz();h.bI(se,x,S,-ee);const fe=h.bM(se[1],se[2],k[1],k[2]),Ce=h.bz();h.bI(Ce,x,S,-J);const Me=h.bM(Ce[1],Ce[2],k[1],k[2]),Ie=.5*Math.PI,Be=fe>=-Ie&&fe<=Ie,Qe=Me>=-Ie&&Me<=Ie;let Le,$e;if(Be&&Qe){const Lt=this.center.lng*Math.PI/180,Mt=this.center.lat*Math.PI/180;h.bN(ee,Lt)+h.bN(fe,Mt)<h.bN(J,Lt)+h.bN(Me,Mt)?(Le=ee,$e=fe):(Le=J,$e=Me)}else if(Be)Le=ee,$e=fe;else{if(!Qe)return;Le=J,$e=Me}const st=Le/Math.PI*180,Ve=$e/Math.PI*180,dt=this.center.lat;this.setCenter(new h.V(st,h.an(Ve,-90,90))),this.setZoom(this.zoom+br(dt,this.center.lat))}locationToScreenPoint(t,s){const f=rr(t);if(s){const x=s.getElevationForLngLatZoom(t,this._helper._tileZoom);h.a$(f,f,1+x/h.bE)}return this._projectSurfacePointToScreen(f)}_projectSurfacePointToScreen(t){const s=h.bF();return h.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new h.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,s){if(s){const f=s.pointCoordinate(t);if(f)return f}return h.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,s){var f;return(f=this.screenPointToMercatorCoordinate(t,s))===null||f===void 0?void 0:f.toLngLat()}isPointOnMapSurface(t,s){const f=this._cameraPosition,x=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(f,x)}getRayDirectionFromPixel(t){const s=h.bF();s[0]=t.x/this.width*2-1,s[1]=-1*(t.y/this.height*2-1),s[2]=1,s[3]=1,h.aH(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const f=h.bz();f[0]=s[0]-this._cameraPosition[0],f[1]=s[1]-this._cameraPosition[1],f[2]=s[2]-this._cameraPosition[2];const x=h.bz();return h.b3(x,f),x}isSurfacePointVisible(t){const s=this._cachedClippingPlane;return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const s=h.bF();return h.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(t,s){const f=h.b5(t,s),x=h.bz(),S=h.bz();h.a$(S,s,f),h.b2(x,t,S);const k=1-h.b5(x,x);if(k<0)return null;const z=h.b5(t,t)-1,j=-f+(f<0?1:-1)*Math.sqrt(k),Z=z/j,W=j;return{tMin:Math.min(Z,W),tMax:Math.max(Z,W)}}unprojectScreenPoint(t){const s=this._cameraPosition,f=this.getRayDirectionFromPixel(t),x=this.rayPlanetIntersection(s,f);if(x){const W=h.bz();h.b0(W,s,[f[0]*x.tMin,f[1]*x.tMin,f[2]*x.tMin]);const ee=h.bz();return h.b3(ee,W),Ra(ee)}const S=this._cachedClippingPlane,k=S[0]*f[0]+S[1]*f[1]+S[2]*f[2],z=-h.bb(S,s)/k,j=h.bz();if(z>0)h.b0(j,s,[f[0]*z,f[1]*z,f[2]*z]);else{const W=h.bz();h.b0(W,s,[2*f[0],2*f[1],2*f[2]]);const ee=h.bb(this._cachedClippingPlane,W);h.b2(j,W,[this._cachedClippingPlane[0]*ee,this._cachedClippingPlane[1]*ee,this._cachedClippingPlane[2]*ee])}const Z=(function(W){const ee=h.bz();return ee[0]=W[0]*-W[3],ee[1]=W[1]*-W[3],ee[2]=W[2]*-W[3],{center:ee,radius:Math.sqrt(1-W[3]*W[3])}})(S);return Ra((function(W,ee,J){const se=h.bz();h.b2(se,J,W);const fe=h.bz();return h.bA(fe,W,se,ee/h.b9(se)),fe})(Z.center,Z.radius,j))}getMatrixForModel(t,s){const f=h.V.convert(t),x=1/h.bE,S=h.bj();return h.bJ(S,S,f.lng/180*Math.PI),h.bh(S,S,-f.lat/180*Math.PI),h.O(S,S,[0,0,1+s/h.bE]),h.bh(S,S,.5*Math.PI),h.Q(S,S,[x,x,x]),S}getProjectionDataForCustomLayer(t=!0){const s=this.getProjectionData({overscaledTileID:new h.a2(0,0,0,0,0),applyGlobeMatrix:t});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(t){}}class Zo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,f=!0){this._helper.resize(t,s,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,s){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(s,f)=>this.currentTransform.defaultConstrain(s,f),this.applyConstrain=(s,f)=>this._helper.applyConstrain(s,f),this._helper=new ma({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,f)=>this.defaultConstrain(s,f)},t),this._globeness=1,this._mercatorTransform=new Dr,this._verticalPerspectiveTransform=new Co}clone(){const t=new Zo;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const s=this._mercatorTransform.getProjectionData(t),f=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?f.mainMatrix:s.mainMatrix,clippingPlane:f.clippingPlane,tileMercatorCoords:f.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return h.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,s,f){const x=this._mercatorTransform.getPitchedTextCorrection(t,s,f),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,s,f);return h.bu(x,S,this._globeness)}projectTileCoordinates(t,s,f,x){return this.currentTransform.projectTileCoordinates(t,s,f,x)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){return this.currentTransform.lngLatToCameraDepth(t,s)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,s,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,x)}setLocationAtPoint(t,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,s){return this.currentTransform.locationToScreenPoint(t,s)}screenPointToMercatorCoordinate(t,s){return this.currentTransform.screenPointToMercatorCoordinate(t,s)}screenPointToLocation(t,s){return this.currentTransform.screenPointToLocation(t,s)}isPointOnMapSurface(t,s){return this.currentTransform.isPointOnMapSurface(t,s)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,s){return this.currentTransform.getMatrixForModel(t,s)}getProjectionDataForCustomLayer(t=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return s;const f=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return f.fallbackMatrix=s.mainMatrix,f}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Kr{get useGlobeControls(){return!0}handlePanInertia(t,s){const f=Pa(t,s);return Math.abs(f.lng-s.center.lng)>180&&(f.lng=s.center.lng+179.5*Math.sign(f.lng-s.center.lng)),{easingCenter:f,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,s){const f=t.around,x=s.screenPointToLocation(f);t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta);const S=s.zoom;t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta);const k=s.zoom-S;if(k===0)return;const z=h.bK(s.center.lng,x.lng),j=z/(Math.abs(z/180)+1),Z=h.bK(s.center.lat,x.lat),W=s.getRayDirectionFromPixel(f),ee=s.cameraPosition,J=-1*h.b5(ee,W),se=h.bz();h.b0(se,ee,[W[0]*J,W[1]*J,W[2]*J]);const fe=h.b7(se)-1,Ce=Math.exp(.5*-Math.max(fe-.3,0)),Me=wr(s.worldSize,s.center.lat)/Math.min(s.width,s.height),Ie=h.bx(Me,.9,.5,1,.25),Be=(1-h.aq(-k))*Math.min(Ce,Ie),Qe=s.center.lat,Le=s.zoom,$e=new h.V(s.center.lng+j*Be,h.an(s.center.lat+Z*Be,-h.ao,h.ao));s.setLocationAtPoint(x,f);const st=s.center,Ve=h.bx(Math.abs(z),45,85,0,1),dt=h.bx(Me,.75,.35,0,1),Lt=Math.pow(Math.max(Ve,dt),.25),Mt=h.bK(st.lng,$e.lng),Pt=h.bK(st.lat,$e.lat);s.setCenter(new h.V(st.lng+Mt*Lt,st.lat+Pt*Lt).wrap()),s.setZoom(Le+br(Qe,s.center.lat))}handleMapControlsPan(t,s,f){if(!t.panDelta)return;const x=s.center.lat,S=s.zoom;s.setCenter(Pa(t.panDelta,s).wrap()),s.setZoom(S+br(x,s.center.lat))}cameraForBoxAndBearing(t,s,f,x,S){const k=Eo(t,s,f,x,S),z=s.left/S.width*2-1,j=(S.width-s.right)/S.width*2-1,Z=s.top/S.height*-2+1,W=(S.height-s.bottom)/S.height*-2+1,ee=h.bK(f.getWest(),f.getEast())<0,J=ee?f.getEast():f.getWest(),se=ee?f.getWest():f.getEast(),fe=Math.max(f.getNorth(),f.getSouth()),Ce=Math.min(f.getNorth(),f.getSouth()),Me=J+.5*h.bK(J,se),Ie=fe+.5*h.bK(fe,Ce),Be=S.clone();Be.setCenter(k.center),Be.setBearing(k.bearing),Be.setPitch(0),Be.setRoll(0),Be.setZoom(k.zoom);const Qe=Be.modelViewProjectionMatrix,Le=[rr(f.getNorthWest()),rr(f.getNorthEast()),rr(f.getSouthWest()),rr(f.getSouthEast()),rr(new h.V(se,Ie)),rr(new h.V(J,Ie)),rr(new h.V(Me,fe)),rr(new h.V(Me,Ce))],$e=rr(k.center);let st=Number.POSITIVE_INFINITY;for(const Ve of Le)z<0&&(st=Kr.getLesserNonNegativeNonNull(st,Kr.solveVectorScale(Ve,$e,Qe,"x",z))),j>0&&(st=Kr.getLesserNonNegativeNonNull(st,Kr.solveVectorScale(Ve,$e,Qe,"x",j))),Z>0&&(st=Kr.getLesserNonNegativeNonNull(st,Kr.solveVectorScale(Ve,$e,Qe,"y",Z))),W<0&&(st=Kr.getLesserNonNegativeNonNull(st,Kr.solveVectorScale(Ve,$e,Qe,"y",W)));if(Number.isFinite(st)&&st!==0)return k.zoom=Be.zoom+h.at(st),k;ns()}handleJumpToCenterZoom(t,s){const f=t.center.lat,x=t.applyConstrain(s.center?h.V.convert(s.center):t.center,t.zoom).center;t.setCenter(x.wrap());const S=s.zoom!==void 0?+s.zoom:t.zoom+br(f,x.lat);t.zoom!==S&&t.setZoom(S)}handleEaseTo(t,s){const f=t.zoom,x=t.center,S=t.padding,k={roll:t.roll,pitch:t.pitch,bearing:t.bearing},z={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},j=s.zoom!==void 0,Z=!t.isPaddingEqual(s.padding);let W=!1;const ee=s.center?h.V.convert(s.center):x,J=t.applyConstrain(ee,f).center;Us(t,J);const se=t.clone();se.setCenter(J),se.setZoom(j?+s.zoom:f+br(x.lat,ee.lat)),se.setBearing(s.bearing);const fe=new h.P(h.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),h.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));se.setLocationAtPoint(J,fe);const Ce=(s.offset&&s.offsetAsPoint.mag())>0?se.center:J,Me=j?+s.zoom:f+br(x.lat,Ce.lat),Ie=f+br(x.lat,0),Be=Me+br(Ce.lat,0),Qe=h.bK(x.lng,Ce.lng),Le=h.bK(x.lat,Ce.lat),$e=h.aq(Be-Ie);return W=Me!==f,{easeFunc:st=>{if(h.bo(k,z)||ir({startEulerAngles:k,endEulerAngles:z,tr:t,k:st,useSlerp:k.roll!=z.roll}),Z&&t.interpolatePadding(S,s.padding,st),s.around)h.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(s.around,s.aroundPoint);else{const Ve=Be>Ie?Math.min(2,$e):Math.max(.5,$e),dt=Math.pow(Ve,1-st),Lt=wi(x,Qe,Le,st*dt);t.setCenter(Lt.wrap())}if(W){const Ve=h.G.number(Ie,Be,st)+br(0,t.center.lat);t.setZoom(Ve)}},isZooming:W,elevationCenter:Ce}}handleFlyTo(t,s){const f=s.zoom!==void 0,x=t.center,S=t.zoom,k=t.padding,z=!t.isPaddingEqual(s.padding),j=t.applyConstrain(h.V.convert(s.center||s.locationAtOffset),S).center,Z=f?+s.zoom:t.zoom+br(t.center.lat,j.lat),W=t.clone();W.setCenter(j),W.setZoom(Z),W.setBearing(s.bearing);const ee=new h.P(h.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),h.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));W.setLocationAtPoint(j,ee);const J=W.center;Us(t,J);const se=(function(Le,$e,st){const Ve=rr($e),dt=rr(st),Lt=h.b5(Ve,dt),Mt=Math.acos(Lt),Pt=Rs(Le);return Mt/(2*Math.PI)*Pt})(t,x,J),fe=S+br(x.lat,0),Ce=Z+br(J.lat,0),Me=h.aq(Ce-fe);let Ie;if(typeof s.minZoom=="number"){const Le=+s.minZoom+br(J.lat,0),$e=Math.min(Le,fe,Ce)+br(0,J.lat),st=t.applyConstrain(J,$e).zoom+br(J.lat,0);Ie=h.aq(st-fe)}const Be=h.bK(x.lng,J.lng),Qe=h.bK(x.lat,J.lat);return{easeFunc:(Le,$e,st,Ve)=>{const dt=wi(x,Be,Qe,st);z&&t.interpolatePadding(k,s.padding,Le);const Lt=Le===1?J:dt;t.setCenter(Lt.wrap());const Mt=fe+h.at($e);t.setZoom(Le===1?Z:Mt+br(0,Lt.lat))},scaleOfZoom:Me,targetCenter:J,scaleOfMinZoom:Ie,pixelPathLength:se}}static solveVectorScale(t,s,f,x,S){const k=x==="x"?[f[0],f[4],f[8],f[12]]:[f[1],f[5],f[9],f[13]],z=[f[3],f[7],f[11],f[15]],j=t[0]*k[0]+t[1]*k[1]+t[2]*k[2],Z=t[0]*z[0]+t[1]*z[1]+t[2]*z[2],W=s[0]*k[0]+s[1]*k[1]+s[2]*k[2],ee=s[0]*z[0]+s[1]*z[1]+s[2]*z[2];return W+S*Z===j+S*ee||z[3]*(j-W)+k[3]*(ee-Z)+j*ee==W*Z?null:(W+k[3]-S*ee-S*z[3])/(W-j-S*ee+S*Z)}static getLesserNonNegativeNonNull(t,s){return s!==null&&s>=0&&s<t?s:t}}class Bl{constructor(t){this._globe=t,this._mercatorCameraHelper=new So,this._verticalPerspectiveCameraHelper=new Kr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,s){return this.currentHelper.handlePanInertia(t,s)}handleMapControlsRollPitchBearingZoom(t,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,s)}handleMapControlsPan(t,s,f){this.currentHelper.handleMapControlsPan(t,s,f)}cameraForBoxAndBearing(t,s,f,x,S){return this.currentHelper.cameraForBoxAndBearing(t,s,f,x,S)}handleJumpToCenterZoom(t,s){this.currentHelper.handleJumpToCenterZoom(t,s)}handleEaseTo(t,s){return this.currentHelper.handleEaseTo(t,s)}handleFlyTo(t,s){return this.currentHelper.handleFlyTo(t,s)}}const Fl=(A,t)=>h.B(A,t&&t.filter((s=>s.identifier!=="source.canvas"))),fc=h.bO();class Oa extends h.E{constructor(t,s={}){var f,x;super(),this._rtlPluginLoaded=()=>{for(const k in this.tileManagers){const z=this.tileManagers[k].getSource().type;z!=="vector"&&z!=="geojson"||this.tileManagers[k].reload()}},this.map=t,this.dispatcher=new Nn(sn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((k,z)=>this.getGlyphs(k,z))),this.dispatcher.registerMessageHandler("GI",((k,z)=>this.getImages(k,z))),this.dispatcher.registerMessageHandler("GDA",((k,z)=>this.getDashes(k,z))),this.imageManager=new ct,this.imageManager.setEventedParent(this);const S=((f=t._container)===null||f===void 0?void 0:f.lang)||typeof document<"u"&&((x=document.documentElement)===null||x===void 0?void 0:x.lang)||void 0;this.glyphManager=new We(t._requestManager,s.localIdeographFontFamily,S),this.lineAtlas=new Nt(256,512),this.crossTileSymbolIndex=new Xi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",h.bP()),rt().on(je,this._rtlPluginLoaded),this.on("data",(k=>{if(k.dataType!=="source"||k.sourceDataType!=="metadata")return;const z=this.tileManagers[k.sourceId];if(!z)return;const j=z.getSource();if(j&&j.vectorLayerIds)for(const Z in this._layers){const W=this._layers[Z];W.source===j.id&&this._validateLayer(W)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new h.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,s){var f,x,S;this._checkLoaded();const k=s===null?(S=(x=(f=this.stylesheet.state)===null||f===void 0?void 0:f[t])===null||x===void 0?void 0:x.default)!==null&&S!==void 0?S:null:s;if(h.bR(k,this._globalState[t]))return this;this._globalState[t]=k,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const s=[];for(const f in t)!h.bR(this._globalState[f],t[f].default)&&(s.push(f),this._globalState[f]=t[f].default);this._applyGlobalStateChanges(s)}_applyGlobalStateChanges(t){if(t.length===0)return;const s=new Set,f={};for(const x of t){f[x]=this._globalState[x];for(const S in this._layers){const k=this._layers[S],z=k.getLayoutAffectingGlobalStateRefs(),j=k.getPaintAffectingGlobalStateRefs(),Z=k.getVisibilityAffectingGlobalStateRefs();if(z.has(x)&&s.add(k.source),j.has(x))for(const{name:W,value:ee}of j.get(x))this._updatePaintProperty(k,W,ee);Z?.has(x)&&(k.recalculateVisibility(),this._updateLayer(k))}}this.dispatcher.broadcast("UGS",f);for(const x in this.tileManagers)s.has(x)&&(this._reloadSource(x),this._changed=!0)}loadURL(t,s={},f){this.fire(new h.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const x=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;h.j(x,this._loadStyleRequest).then((k=>{this._loadStyleRequest=null,this._load(k.data,s,f)})).catch((k=>{this._loadStyleRequest=null,k&&!S.signal.aborted&&this.fire(new h.k(k))}))}loadJSON(t,s={},f){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,we.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,f)})).catch((()=>{}))}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(fc,{validate:!1})}_load(t,s,f){var x,S;let k=s.transformStyle?s.transformStyle(f,t):t;if(!s.validate||!Fl(this,h.C(k))){k=Object.assign({},k),this._loaded=!0,this.stylesheet=k;for(const z in k.sources)this.addSource(z,k.sources[z],{validate:!1});k.sprite?this._loadSprite(k.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(k.glyphs),this._createLayers(),this.light=new Gt(this.stylesheet.light),this._setProjectionInternal(((x=this.stylesheet.projection)===null||x===void 0?void 0:x.type)||"mercator"),this.sky=new nt(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){var t,s,f;const x=h.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",x),this._order=x.map((S=>S.id)),this._layers={},this._serializedLayers=null;for(const S of x){const k=h.bT(S,this._globalState);if(k.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=k,h.bU(k)&&this.tileManagers[k.source]){const z=(f=(s=S.paint)===null||s===void 0?void 0:s["raster-fade-duration"])!==null&&f!==void 0?f:k.paint.get("raster-fade-duration");this.tileManagers[k.source].setRasterFadeDuration(z)}}}_loadSprite(t,s=!1,f=void 0){this.imageManager.setLoaded(!1);const x=new AbortController;let S;this._spriteRequest=x,(function(k,z,j,Z){return h._(this,void 0,void 0,(function*(){const W=He(k),ee=j>1?"@2x":"",J={},se={};for(const{id:fe,url:Ce}of W){const Me=z.transformRequest(xt(Ce,ee,".json"),"SpriteJSON");J[fe]=h.j(Me,Z);const Ie=z.transformRequest(xt(Ce,ee,".png"),"SpriteImage");se[fe]=it.getImage(Ie,Z)}return yield Promise.all([...Object.values(J),...Object.values(se)]),(function(fe,Ce){return h._(this,void 0,void 0,(function*(){const Me={};for(const Ie in fe){Me[Ie]={};const Be=we.getImageCanvasContext((yield Ce[Ie]).data),Qe=(yield fe[Ie]).data;for(const Le in Qe){const{width:$e,height:st,x:Ve,y:dt,sdf:Lt,pixelRatio:Mt,stretchX:Pt,stretchY:Ot,content:bn,textFitWidth:vn,textFitHeight:on}=Qe[Le];Me[Ie][Le]={data:null,pixelRatio:Mt,sdf:Lt,stretchX:Pt,stretchY:Ot,content:bn,textFitWidth:vn,textFitHeight:on,spriteData:{width:$e,height:st,x:Ve,y:dt,context:Be}}}}return Me}))})(J,se)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((k=>{if(this._spriteRequest=null,k)for(const z in k){this._spritesImagesIds[z]=[];const j=this._spritesImagesIds[z]?this._spritesImagesIds[z].filter((Z=>!(Z in k))):[];for(const Z of j)this.imageManager.removeImage(Z),this._changedImages[Z]=!0;for(const Z in k[z]){const W=z==="default"?Z:`${z}:${Z}`;this._spritesImagesIds[z].push(W),W in this.imageManager.images?this.imageManager.updateImage(W,k[z][Z],!1):this.imageManager.addImage(W,k[z][Z]),s&&(this._changedImages[W]=!0)}}})).catch((k=>{this._spriteRequest=null,S=k,x.signal.aborted||this.fire(new h.k(S))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),f&&f(S)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(t){const s=this.tileManagers[t.source];if(!s)return;const f=t.sourceLayer;if(!f)return;const x=s.getSource();(x.type==="geojson"||x.vectorLayerIds&&x.vectorLayerIds.indexOf(f)===-1)&&this.fire(new h.k(new Error(`Source layer "${f}" does not exist on source "${x.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,s=!1){const f=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s?h.bV(f):f);const x=[];for(const S of t)if(f[S]){const k=s?h.bV(f[S]):f[S];x.push(k)}return x}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const f of s){const x=this._layers[f];x.type!=="custom"&&(t[f]=x.serialize())}return t}hasTransitions(){var t,s,f;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((f=this.projection)===null||f===void 0)&&f.hasTransition())return!0;for(const x in this.tileManagers)if(this.tileManagers[x].hasTransition())return!0;for(const x in this._layers)if(this._layers[x].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(x.length||S.length)&&this._updateWorkerLayers(x,S);for(const k in this._updatedSources){const z=this._updatedSources[k];if(z==="reload")this._reloadSource(k);else{if(z!=="clear")throw new Error(`Invalid action ${z}`);this._clearSource(k)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const k in this._updatedPaintProps)this._layers[k].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const f={};for(const x in this.tileManagers){const S=this.tileManagers[x];f[x]=S.used,S.used=!1}for(const x of this._order){const S=this._layers[x];S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)&&S.source&&(this.tileManagers[S.source].used=!0)}for(const x in f){const S=this.tileManagers[x];!!f[x]!=!!S.used&&S.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,s&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var f;this._checkLoaded();const x=this.serialize();if(t=s.transformStyle?s.transformStyle(x,t):t,((f=s.validate)===null||f===void 0||f)&&Fl(this,h.C(t)))return!1;(t=h.bV(t)).layers=h.bS(t.layers);const S=h.bW(x,t),k=this._getOperationsToPerform(S);if(k.unimplemented.length>0)throw new Error(`Unimplemented: ${k.unimplemented.join(", ")}.`);if(k.operations.length===0)return!1;for(const z of k.operations)z();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],f=[];for(const x of t)switch(x.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,x.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,x.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,x.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,x.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,x.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,x.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,x.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,x.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,x.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,x.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,x.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,x.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,x.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,x.args)));break;case"setProjection":this.setProjection.apply(this,x.args);break;case"setGlobalState":s.push((()=>this.setGlobalState.apply(this,x.args)));break;case"setTransition":s.push((()=>{}));break;default:f.push(x.command)}return{operations:s,unimplemented:f}}addImage(t,s){if(this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,f={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.C.source,`sources.${t}`,s,null,f))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const x=this.tileManagers[t]=new Zi(t,s,this.dispatcher);x.style=this,x.setEventedParent(this,(()=>({isSourceLoaded:x.loaded(),source:x.serialize(),sourceId:t}))),x.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new h.k(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));const s=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],s.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const f=this.tileManagers[t].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(s),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,s,f={}){this._checkLoaded();const x=t.id;if(this.getLayer(x))return void this.fire(new h.k(new Error(`Layer "${x}" already exists on this map.`)));let S;if(t.type==="custom"){if(Fl(this,h.bX(t)))return;S=h.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(x,t.source),t=h.bV(t),t=h.e(t,{source:x})),this._validate(h.C.layer,`layers.${x}`,t,{arrayIndex:-1},f))return;S=h.bT(t,this._globalState),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}})}const k=s?this._order.indexOf(s):this._order.length;if(s&&k===-1)this.fire(new h.k(new Error(`Cannot add layer "${x}" before non-existing layer "${s}".`)));else{if(this._order.splice(k,0,x),this._layerOrderChanged=!0,this._layers[x]=S,this._removedLayers[x]&&S.source&&S.type!=="custom"){const z=this._removedLayers[x];delete this._removedLayers[x],z.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.tileManagers[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const f=this._order.indexOf(t);this._order.splice(f,1);const x=s?this._order.indexOf(s):this._order.length;s&&x===-1?this.fire(new h.k(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(x,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,f){this._checkLoaded();const x=this.getLayer(t);x?x.minzoom===s&&x.maxzoom===f||(s!=null&&(x.minzoom=s),f!=null&&(x.maxzoom=f),this._updateLayer(x)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,f={}){this._checkLoaded();const x=this.getLayer(t);if(x){if(!h.bR(x.filter,s))return s==null?(x.setFilter(void 0),void this._updateLayer(x)):void(this._validate(h.C.filter,`layers.${x.id}.filter`,s,null,f)||(x.setFilter(h.bV(s)),this._updateLayer(x)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.bV(this.getLayer(t).filter)}setLayoutProperty(t,s,f,x={}){this._checkLoaded();const S=this.getLayer(t);S?h.bR(S.getLayoutProperty(s),f)||(S.setLayoutProperty(s,f,x),this._updateLayer(S)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const f=this.getLayer(t);if(f)return f.getLayoutProperty(s);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,f,x={}){this._checkLoaded();const S=this.getLayer(t);S?h.bR(S.getPaintProperty(s),f)||this._updatePaintProperty(S,s,f,x):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,s,f,x={}){t.setPaintProperty(s,f,x)&&this._updateLayer(t),h.bU(t)&&s==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(f),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const f=t.source,x=t.sourceLayer,S=this.tileManagers[f];if(S===void 0)return void this.fire(new h.k(new Error(`The source '${f}' does not exist in the map's style.`)));const k=S.getSource().type;k==="geojson"&&x?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||x?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(x,t.id,s)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const f=t.source,x=this.tileManagers[f];if(x===void 0)return void this.fire(new h.k(new Error(`The source '${f}' does not exist in the map's style.`)));const S=x.getSource().type,k=S==="vector"?t.sourceLayer:void 0;S!=="vector"||k?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(k,t.id,s):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,f=t.sourceLayer,x=this.tileManagers[s];if(x!==void 0)return x.getSource().type!=="vector"||f?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),x.getFeatureState(f,t.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.bY(this.tileManagers,(S=>S.serialize())),s=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,x=this.stylesheet;return h.bZ({version:x.version,name:x.name,metadata:x.metadata,light:x.light,sky:x.sky,center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,sprite:x.sprite,glyphs:x.glyphs,transition:x.transition,projection:x.projection,sources:t,layers:s,terrain:f},(S=>S!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=k=>this._layers[k].type==="fill-extrusion",f={},x=[];for(let k=this._order.length-1;k>=0;k--){const z=this._order[k];if(s(z)){f[z]=k;for(const j of t){const Z=j[z];if(Z)for(const W of Z)x.push(W)}}}x.sort(((k,z)=>z.intersectionZ-k.intersectionZ));const S=[];for(let k=this._order.length-1;k>=0;k--){const z=this._order[k];if(s(z))for(let j=x.length-1;j>=0;j--){const Z=x[j].feature;if(f[Z.layer.id]<k)break;S.push(Z),x.pop()}else for(const j of t){const Z=j[z];if(Z)for(const W of Z)S.push(W.feature)}}return S}queryRenderedFeatures(t,s,f){s&&s.filter&&this._validate(h.C.filter,"queryRenderedFeatures.filter",s.filter,null,s);const x={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const Z of s.layers){const W=this._layers[Z];if(!W)return this.fire(new h.k(new Error(`The layer '${Z}' does not exist in the map's style and cannot be queried for features.`))),[];x[W.source]=!0}}const S=[];s.availableImages=this._availableImages;const k=this._serializedAllLayers(),z=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,j=Object.assign(Object.assign({},s),{layers:z,globalState:this._globalState});for(const Z in this.tileManagers)s.layers&&!x[Z]||S.push(kn(this.tileManagers[Z],this._layers,k,t,j,f,this.map.terrain?(W,ee,J)=>this.map.terrain.getElevation(W,ee,J):void 0));return this.placement&&S.push((function(Z,W,ee,J,se,fe,Ce){const Me={},Ie=fe.queryRenderedSymbols(J),Be=[];for(const Qe of Object.keys(Ie).map(Number))Be.push(Ce[Qe]);Be.sort(ui);for(const Qe of Be){const Le=Qe.featureIndex.lookupSymbolFeatures(Ie[Qe.bucketInstanceId],W,Qe.bucketIndex,Qe.sourceLayerIndex,{filterSpec:se.filter,globalState:se.globalState},se.layers,se.availableImages,Z);for(const $e in Le){const st=Me[$e]=Me[$e]||[],Ve=Le[$e];Ve.sort(((dt,Lt)=>{const Mt=Qe.featureSortOrder;if(Mt){const Pt=Mt.indexOf(dt.featureIndex);return Mt.indexOf(Lt.featureIndex)-Pt}return Lt.featureIndex-dt.featureIndex}));for(const dt of Ve)st.push(dt)}}return(function(Qe,Le,$e){for(const st in Qe)for(const Ve of Qe[st])_i(Ve,$e[Le[st].source]);return Qe})(Me,Z,ee)})(this._layers,k,this.tileManagers,t,j,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(t,s){s?.filter&&this._validate(h.C.filter,"querySourceFeatures.filter",s.filter,null,s);const f=this.tileManagers[t];return f?(function(x,S){const k=x.getRenderableIds().map((Z=>x.getTileByID(Z))),z=[],j={};for(let Z=0;Z<k.length;Z++){const W=k[Z],ee=W.tileID.canonical.key;j[ee]||(j[ee]=!0,W.querySourceFeatures(z,S))}return z})(f,s?Object.assign(Object.assign({},s),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const f=this.light.getLight();let x=!1;for(const k in t)if(!h.bR(t[k],f[k])){x=!0;break}if(!x)return;const S={now:me(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(S)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,s={}){this._checkLoaded();const f=this.getSky();let x=!1;if(!t&&!f)return;if(t&&!f)x=!0;else if(!t&&f)x=!0;else for(const k in t)if(!h.bR(t[k],f[k])){x=!0;break}if(!x)return;const S={now:me(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,s),this.sky.updateTransitions(S)}_setProjectionInternal(t){const s=(function(f,x){const S={constrainOverride:x};if(Array.isArray(f)){const k=new qo({type:f});return{projection:k,transform:new Zo(S),cameraHelper:new Bl(k)}}switch(f){case"mercator":return{projection:new Qr,transform:new Dr(S),cameraHelper:new So};case"globe":{const k=new qo({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:k,transform:new Zo(S),cameraHelper:new Bl(k)}}case"vertical-perspective":return{projection:new ya,transform:new Co(S),cameraHelper:new Kr};default:return h.w(`Unknown projection name: ${f}. Falling back to mercator projection.`),{projection:new Qr,transform:new Dr(S),cameraHelper:new So}}})(t,this.map.transformConstrain);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const f in this.tileManagers)this.tileManagers[f].reload()}_validate(t,s,f,x,S={}){return(!S||S.validate!==!1)&&Fl(this,t.call(h.C,h.e({key:s,style:this.serialize(),value:f,styleSpec:h.u},x)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),rt().off(je,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.tileManagers){const f=this.tileManagers[s];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const s in this.tileManagers)this.tileManagers[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,s,f,x,S=!1){let k=!1,z=!1;const j={};for(const Z of this._order){const W=this._layers[Z];if(W.type!=="symbol")continue;if(!j[W.source]){const J=this.tileManagers[W.source];j[W.source]=J.getRenderableIds(!0).map((se=>J.getTileByID(se))).sort(((se,fe)=>fe.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(fe.tileID)?-1:1)))}const ee=this.crossTileSymbolIndex.addLayer(W,j[W.source],t.center.lng);k=k||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(me(),t.zoom))&&(this.pauseablePlacement=new cl(t,this.map.terrain,this._order,S,s,f,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(me()),z=!0),k&&this.pauseablePlacement.placement.setStale()),z||k)for(const Z of this._order){const W=this._layers[Z];W.type==="symbol"&&this.placement.updateLayerOpacities(W,j[W.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(me())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,s){return h._(this,void 0,void 0,(function*(){const f=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const x=this.tileManagers[s.source];return x&&x.setDependencies(s.tileID.key,s.type,s.icons),f}))}getGlyphs(t,s){return h._(this,void 0,void 0,(function*(){const f=yield this.glyphManager.getGlyphs(s.stacks),x=this.tileManagers[s.source];return x&&x.setDependencies(s.tileID.key,s.type,[""]),f}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(h.C.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,s){return h._(this,void 0,void 0,(function*(){const f={};for(const[x,S]of Object.entries(s.dashes))f[x]=this.lineAtlas.getDash(S.dasharray,S.round);return f}))}addSprite(t,s,f={},x){this._checkLoaded();const S=[{id:t,url:s}],k=[...He(this.stylesheet.sprite),...S];this._validate(h.C.sprite,"sprite",k,null,f)||(this.stylesheet.sprite=k,this._loadSprite(S,!0,x))}removeSprite(t){this._checkLoaded();const s=He(this.stylesheet.sprite);if(s.find((f=>f.id===t))){if(this._spritesImagesIds[t])for(const f of this._spritesImagesIds[t])this.imageManager.removeImage(f),this._changedImages[f]=!0;s.splice(s.findIndex((f=>f.id===t)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return He(this.stylesheet.sprite)}setSprite(t,s={},f){this._checkLoaded(),t&&this._validate(h.C.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,f):(this._unloadSprite(),f&&f(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const s=this.tileManagers[t];s.setEventedParent(null),s.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const s=this._layers[t];s.setEventedParent(null),s.onRemove&&s.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var _u=h.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Bc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,f,x,S,k,z,j,Z){this.context=t;let W=this.boundPaintVertexBuffers.length!==x.length;for(let ee=0;!W&&ee<x.length;ee++)this.boundPaintVertexBuffers[ee]!==x[ee]&&(W=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==f||W||this.boundIndexBuffer!==S||this.boundVertexOffset!==k||this.boundDynamicVertexBuffer!==z||this.boundDynamicVertexBuffer2!==j||this.boundDynamicVertexBuffer3!==Z?this.freshBind(s,f,x,S,k,z,j,Z):(t.bindVertexArray.set(this.vao),z&&z.bind(),S&&S.dynamicDraw&&S.bind(),j&&j.bind(),Z&&Z.bind())}freshBind(t,s,f,x,S,k,z,j){const Z=t.numAttributes,W=this.context,ee=W.gl;this.vao&&this.destroy(),this.vao=W.createVertexArray(),W.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=k,this.boundDynamicVertexBuffer2=z,this.boundDynamicVertexBuffer3=j,s.enableAttributes(ee,t);for(const J of f)J.enableAttributes(ee,t);k&&k.enableAttributes(ee,t),z&&z.enableAttributes(ee,t),j&&j.enableAttributes(ee,t),s.bind(),s.setVertexAttribPointers(ee,t,S);for(const J of f)J.bind(),J.setVertexAttribPointers(ee,t,S);k&&(k.bind(),k.setVertexAttribPointers(ee,t,S)),x&&x.bind(),z&&(z.bind(),z.setVertexAttribPointers(ee,t,S)),j&&(j.bind(),j.setVertexAttribPointers(ee,t,S)),W.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const pc=(A,t,s,f,x)=>({u_texture:0,u_ele_delta:A,u_fog_matrix:t,u_fog_color:s?s.properties.get("fog-color"):h.bp.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:x?0:s?s.calculateFogBlendOpacity(f):0,u_horizon_color:s?s.properties.get("horizon-color"):h.bp.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:x?1:0}),ro={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function so(A){const t=[];for(let s=0;s<A.length;s++){if(A[s]===null)continue;const f=A[s].split(" ");t.push(f.pop())}return t}class Fc{constructor(t,s,f,x,S,k,z,j,Z=[]){const W=t.gl;this.program=W.createProgram();const ee=so(s.staticAttributes),J=f?f.getBinderAttributes():[],se=ee.concat(J),fe=er.prelude.staticUniforms?so(er.prelude.staticUniforms):[],Ce=z.staticUniforms?so(z.staticUniforms):[],Me=s.staticUniforms?so(s.staticUniforms):[],Ie=f?f.getBinderUniforms():[],Be=fe.concat(Ce).concat(Me).concat(Ie),Qe=[];for(const Mt of Be)Qe.indexOf(Mt)<0&&Qe.push(Mt);const Le=f?f.defines():[];Xn(W)&&Le.unshift("#version 300 es"),S&&Le.push("#define OVERDRAW_INSPECTOR;"),k&&Le.push("#define TERRAIN3D;"),j&&Le.push(j),Z&&Le.push(...Z);let $e=Le.concat(er.prelude.fragmentSource,z.fragmentSource,s.fragmentSource).join(`
`),st=Le.concat(er.prelude.vertexSource,z.vertexSource,s.vertexSource).join(`
`);Xn(W)||($e=(function(Mt){return Mt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})($e),st=(function(Mt){return Mt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(st));const Ve=W.createShader(W.FRAGMENT_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);if(W.shaderSource(Ve,$e),W.compileShader(Ve),!W.getShaderParameter(Ve,W.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${W.getShaderInfoLog(Ve)}`);W.attachShader(this.program,Ve);const dt=W.createShader(W.VERTEX_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);if(W.shaderSource(dt,st),W.compileShader(dt),!W.getShaderParameter(dt,W.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${W.getShaderInfoLog(dt)}`);W.attachShader(this.program,dt),this.attributes={};const Lt={};this.numAttributes=se.length;for(let Mt=0;Mt<this.numAttributes;Mt++)se[Mt]&&(W.bindAttribLocation(this.program,Mt,se[Mt]),this.attributes[se[Mt]]=Mt);if(W.linkProgram(this.program),!W.getProgramParameter(this.program,W.LINK_STATUS))throw new Error(`Program failed to link: ${W.getProgramInfoLog(this.program)}`);W.deleteShader(dt),W.deleteShader(Ve);for(let Mt=0;Mt<Qe.length;Mt++){const Pt=Qe[Mt];if(Pt&&!Lt[Pt]){const Ot=W.getUniformLocation(this.program,Pt);Ot&&(Lt[Pt]=Ot)}}this.fixedUniforms=x(t,Lt),this.terrainUniforms=((Mt,Pt)=>({u_depth:new h.b_(Mt,Pt.u_depth),u_terrain:new h.b_(Mt,Pt.u_terrain),u_terrain_dim:new h.bq(Mt,Pt.u_terrain_dim),u_terrain_matrix:new h.c0(Mt,Pt.u_terrain_matrix),u_terrain_unpack:new h.c1(Mt,Pt.u_terrain_unpack),u_terrain_exaggeration:new h.bq(Mt,Pt.u_terrain_exaggeration)}))(t,Lt),this.projectionUniforms=((Mt,Pt)=>({u_projection_matrix:new h.c0(Mt,Pt.u_projection_matrix),u_projection_tile_mercator_coords:new h.c1(Mt,Pt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.c1(Mt,Pt.u_projection_clipping_plane),u_projection_transition:new h.bq(Mt,Pt.u_projection_transition),u_projection_fallback_matrix:new h.c0(Mt,Pt.u_projection_fallback_matrix)}))(t,Lt),this.binderUniforms=f?f.getUniforms(t,Lt):[]}draw(t,s,f,x,S,k,z,j,Z,W,ee,J,se,fe,Ce,Me,Ie,Be,Qe){const Le=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(f),t.setStencilMode(x),t.setColorMode(S),t.setCullFace(k),j){t.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,j.depthTexture),t.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,j.texture);for(const st in this.terrainUniforms)this.terrainUniforms[st].set(j[st])}if(Z)for(const st in Z)this.projectionUniforms[ro[st]].set(Z[st]);if(z)for(const st in this.fixedUniforms)this.fixedUniforms[st].set(z[st]);Me&&Me.setUniforms(t,this.binderUniforms,fe,{zoom:Ce});let $e=0;switch(s){case Le.LINES:$e=2;break;case Le.TRIANGLES:$e=3;break;case Le.LINE_STRIP:$e=1}for(const st of se.get()){const Ve=st.vaos||(st.vaos={});(Ve[W]||(Ve[W]=new Bc)).bind(t,this,ee,Me?Me.getPaintVertexBuffers():[],J,st.vertexOffset,Ie,Be,Qe),Le.drawElements(s,st.primitiveLength*$e,Le.UNSIGNED_SHORT,st.primitiveOffset*$e*2)}}}function za(A,t,s){const f=1/h.aN(s,1,t.transform.tileZoom),x=Math.pow(2,s.tileID.overscaledZ),S=s.tileSize*Math.pow(2,t.transform.tileZoom)/x,k=S*(s.tileID.canonical.x+s.tileID.wrap*x),z=S*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[f,A.fromScale,A.toScale],u_fade:A.t,u_pixel_coord_upper:[k>>16,z>>16],u_pixel_coord_lower:[65535&k,65535&z]}}const jc=(A,t,s,f)=>{const x=A.style.light,S=x.properties.get("position"),k=[S.x,S.y,S.z],z=h.c4();x.properties.get("anchor")==="viewport"&&h.c5(z,A.transform.bearingInRadians),h.c6(k,k,z);const j=A.transform.transformLightDirection(k),Z=x.properties.get("color");return{u_lightpos:k,u_lightpos_globe:j,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+t,u_opacity:s,u_fill_translate:f}},La=(A,t,s,f,x,S,k)=>h.e(jc(A,t,s,f),za(S,A,k),{u_height_factor:-Math.pow(2,x.overscaledZ)/k.tileSize/8}),jl=(A,t,s,f)=>h.e(za(t,A,s),{u_fill_translate:f}),hl=(A,t)=>({u_world:A,u_fill_translate:t}),Xh=(A,t,s,f,x)=>h.e(jl(A,t,s,x),{u_world:f}),gc=(A,t,s,f,x)=>{const S=A.transform;let k,z,j=0;if(s.paint.get("circle-pitch-alignment")==="map"){const Z=h.aN(t,1,S.zoom);k=!0,z=[Z,Z],j=Z/(h.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*x}else k=!1,z=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+k,u_device_pixel_ratio:A.pixelRatio,u_extrude_scale:z,u_globe_extrude_scale:j,u_translate:f}},$s=A=>({u_pixel_extrude_scale:[1/A.width,1/A.height]}),rh=A=>({u_viewport_size:[A.width,A.height]}),Ul=(A,t=1)=>({u_color:A,u_overlay:0,u_overlay_scale:t}),Va=(A,t,s,f)=>{const x=h.aN(A,1,t)/(h.a5*Math.pow(2,A.tileID.overscaledZ))*2*Math.PI*f;return{u_extrude_scale:h.aN(A,1,t),u_intensity:s,u_globe_extrude_scale:x}},sr=(A,t,s,f)=>{const x=h.N();h.c7(x,0,A.width,A.height,0,0,1);const S=A.context.gl;return{u_matrix:x,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:s,u_color_ramp:f,u_opacity:t.paint.get("heatmap-opacity")}},dl=(A,t,s)=>{const f=s.paint.get("hillshade-accent-color");let x;switch(s.paint.get("hillshade-method")){case"basic":x=4;break;case"combined":x=1;break;case"igor":x=2;break;case"multidirectional":x=3;break;default:x=0}const S=s.getIlluminationProperties();for(let k=0;k<S.directionRadians.length;k++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(S.directionRadians[k]+=A.transform.bearingInRadians);return{u_image:0,u_latrange:a(0,t.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:S.altitudeRadians,u_azimuths:S.directionRadians,u_accent:f,u_method:x,u_highlights:S.highlightColor,u_shadows:S.shadowColor}},le=(A,t)=>{const s=t.stride,f=h.N();return h.c7(f,0,h.a5,-h.a5,0,0,1),h.O(f,f,[0,-h.a5,0]),{u_matrix:f,u_image:1,u_dimension:[s,s],u_zoom:A.overscaledZ,u_unpack:t.getUnpackVector()}};function a(A,t){const s=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new h.a9(0,f/s).toLngLat().lat,new h.a9(0,(f+1)/s).toLngLat().lat]}const u=(A,t,s=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:A.paint.get("color-relief-opacity")}),g=(A,t,s,f)=>{const x=A.transform;return{u_translation:q(A,t,s),u_ratio:f/h.aN(t,1,x.zoom),u_device_pixel_ratio:A.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},v=(A,t,s,f,x)=>h.e(g(A,t,s,f),{u_image:0,u_image_height:x}),w=(A,t,s,f,x)=>{const S=A.transform,k=F(t,S);return{u_translation:q(A,t,s),u_texsize:t.imageAtlasTexture.size,u_ratio:f/h.aN(t,1,S.zoom),u_device_pixel_ratio:A.pixelRatio,u_image:0,u_scale:[k,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},I=(A,t,s,f,x)=>{const S=F(t,A.transform);return h.e(g(A,t,s,f),{u_tileratio:S,u_crossfade_from:x.fromScale,u_crossfade_to:x.toScale,u_image:0,u_mix:x.t,u_lineatlas_width:A.lineAtlas.width,u_lineatlas_height:A.lineAtlas.height})},O=(A,t,s,f,x,S)=>{const k=F(t,A.transform);return h.e(g(A,t,s,f),{u_image:0,u_image_height:S,u_tileratio:k,u_crossfade_from:x.fromScale,u_crossfade_to:x.toScale,u_image_dash:1,u_mix:x.t,u_lineatlas_width:A.lineAtlas.width,u_lineatlas_height:A.lineAtlas.height})};function F(A,t){return 1/h.aN(A,1,t.tileZoom)}function q(A,t,s){return h.aO(A.transform,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const te=(A,t,s,f,x)=>{return{u_tl_parent:A,u_scale_parent:t,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(k=f.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(S=f.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ue(f.paint.get("raster-hue-rotate")),u_coords_top:[x[0].x,x[0].y,x[1].x,x[1].y],u_coords_bottom:[x[3].x,x[3].y,x[2].x,x[2].y]};var S,k};function ue(A){A*=Math.PI/180;const t=Math.sin(A),s=Math.cos(A);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const xe=(A,t,s,f,x,S,k,z,j,Z,W,ee,J)=>{const se=k.transform;return{u_is_size_zoom_constant:+(A==="constant"||A==="source"),u_is_size_feature_constant:+(A==="constant"||A==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_pitch:se.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:se.width/se.height,u_fade_change:k.options.fadeDuration?k.symbolFadeChange:1,u_label_plane_matrix:z,u_coord_matrix:j,u_is_text:+W,u_pitch_with_map:+f,u_is_along_line:x,u_is_variable_anchor:S,u_texsize:ee,u_texture:0,u_translation:Z,u_pitched_scale:J}},ze=(A,t,s,f,x,S,k,z,j,Z,W,ee,J,se)=>{const fe=k.transform;return h.e(xe(A,t,s,f,x,S,k,z,j,Z,W,ee,se),{u_gamma_scale:f?Math.cos(fe.pitch*Math.PI/180)*fe.cameraToCenterDistance:1,u_device_pixel_ratio:k.pixelRatio,u_is_halo:1})},ot=(A,t,s,f,x,S,k,z,j,Z,W,ee,J)=>h.e(ze(A,t,s,f,x,S,k,z,j,Z,!0,W,0,J),{u_texsize_icon:ee,u_texture_icon:1}),ht=(A,t)=>({u_opacity:A,u_color:t}),Dt=(A,t,s,f,x)=>h.e((function(S,k,z,j){const Z=z.imageManager.getPattern(S.from.toString()),W=z.imageManager.getPattern(S.to.toString()),{width:ee,height:J}=z.imageManager.getPixelSize(),se=Math.pow(2,j.tileID.overscaledZ),fe=j.tileSize*Math.pow(2,z.transform.tileZoom)/se,Ce=fe*(j.tileID.canonical.x+j.tileID.wrap*se),Me=fe*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:W.tl,u_pattern_br_b:W.br,u_texsize:[ee,J],u_mix:k.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:W.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/h.aN(j,1,z.transform.tileZoom),u_pixel_coord_upper:[Ce>>16,Me>>16],u_pixel_coord_lower:[65535&Ce,65535&Me]}})(s,x,t,f),{u_opacity:A}),qt=(A,t)=>{},Sn={fillExtrusion:(A,t)=>({u_lightpos:new h.c2(A,t.u_lightpos),u_lightpos_globe:new h.c2(A,t.u_lightpos_globe),u_lightintensity:new h.bq(A,t.u_lightintensity),u_lightcolor:new h.c2(A,t.u_lightcolor),u_vertical_gradient:new h.bq(A,t.u_vertical_gradient),u_opacity:new h.bq(A,t.u_opacity),u_fill_translate:new h.c3(A,t.u_fill_translate)}),fillExtrusionPattern:(A,t)=>({u_lightpos:new h.c2(A,t.u_lightpos),u_lightpos_globe:new h.c2(A,t.u_lightpos_globe),u_lightintensity:new h.bq(A,t.u_lightintensity),u_lightcolor:new h.c2(A,t.u_lightcolor),u_vertical_gradient:new h.bq(A,t.u_vertical_gradient),u_height_factor:new h.bq(A,t.u_height_factor),u_opacity:new h.bq(A,t.u_opacity),u_fill_translate:new h.c3(A,t.u_fill_translate),u_image:new h.b_(A,t.u_image),u_texsize:new h.c3(A,t.u_texsize),u_pixel_coord_upper:new h.c3(A,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(A,t.u_pixel_coord_lower),u_scale:new h.c2(A,t.u_scale),u_fade:new h.bq(A,t.u_fade)}),fill:(A,t)=>({u_fill_translate:new h.c3(A,t.u_fill_translate)}),fillPattern:(A,t)=>({u_image:new h.b_(A,t.u_image),u_texsize:new h.c3(A,t.u_texsize),u_pixel_coord_upper:new h.c3(A,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(A,t.u_pixel_coord_lower),u_scale:new h.c2(A,t.u_scale),u_fade:new h.bq(A,t.u_fade),u_fill_translate:new h.c3(A,t.u_fill_translate)}),fillOutline:(A,t)=>({u_world:new h.c3(A,t.u_world),u_fill_translate:new h.c3(A,t.u_fill_translate)}),fillOutlinePattern:(A,t)=>({u_world:new h.c3(A,t.u_world),u_image:new h.b_(A,t.u_image),u_texsize:new h.c3(A,t.u_texsize),u_pixel_coord_upper:new h.c3(A,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(A,t.u_pixel_coord_lower),u_scale:new h.c2(A,t.u_scale),u_fade:new h.bq(A,t.u_fade),u_fill_translate:new h.c3(A,t.u_fill_translate)}),circle:(A,t)=>({u_camera_to_center_distance:new h.bq(A,t.u_camera_to_center_distance),u_scale_with_map:new h.b_(A,t.u_scale_with_map),u_pitch_with_map:new h.b_(A,t.u_pitch_with_map),u_extrude_scale:new h.c3(A,t.u_extrude_scale),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_globe_extrude_scale:new h.bq(A,t.u_globe_extrude_scale),u_translate:new h.c3(A,t.u_translate)}),collisionBox:(A,t)=>({u_pixel_extrude_scale:new h.c3(A,t.u_pixel_extrude_scale)}),collisionCircle:(A,t)=>({u_viewport_size:new h.c3(A,t.u_viewport_size)}),debug:(A,t)=>({u_color:new h.b$(A,t.u_color),u_overlay:new h.b_(A,t.u_overlay),u_overlay_scale:new h.bq(A,t.u_overlay_scale)}),depth:qt,clippingMask:qt,heatmap:(A,t)=>({u_extrude_scale:new h.bq(A,t.u_extrude_scale),u_intensity:new h.bq(A,t.u_intensity),u_globe_extrude_scale:new h.bq(A,t.u_globe_extrude_scale)}),heatmapTexture:(A,t)=>({u_matrix:new h.c0(A,t.u_matrix),u_world:new h.c3(A,t.u_world),u_image:new h.b_(A,t.u_image),u_color_ramp:new h.b_(A,t.u_color_ramp),u_opacity:new h.bq(A,t.u_opacity)}),hillshade:(A,t)=>({u_image:new h.b_(A,t.u_image),u_latrange:new h.c3(A,t.u_latrange),u_exaggeration:new h.bq(A,t.u_exaggeration),u_altitudes:new h.c9(A,t.u_altitudes),u_azimuths:new h.c9(A,t.u_azimuths),u_accent:new h.b$(A,t.u_accent),u_method:new h.b_(A,t.u_method),u_shadows:new h.c8(A,t.u_shadows),u_highlights:new h.c8(A,t.u_highlights)}),hillshadePrepare:(A,t)=>({u_matrix:new h.c0(A,t.u_matrix),u_image:new h.b_(A,t.u_image),u_dimension:new h.c3(A,t.u_dimension),u_zoom:new h.bq(A,t.u_zoom),u_unpack:new h.c1(A,t.u_unpack)}),colorRelief:(A,t)=>({u_image:new h.b_(A,t.u_image),u_unpack:new h.c1(A,t.u_unpack),u_dimension:new h.c3(A,t.u_dimension),u_elevation_stops:new h.b_(A,t.u_elevation_stops),u_color_stops:new h.b_(A,t.u_color_stops),u_color_ramp_size:new h.b_(A,t.u_color_ramp_size),u_opacity:new h.bq(A,t.u_opacity)}),line:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels)}),lineGradient:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels),u_image:new h.b_(A,t.u_image),u_image_height:new h.bq(A,t.u_image_height)}),linePattern:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_texsize:new h.c3(A,t.u_texsize),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_image:new h.b_(A,t.u_image),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels),u_scale:new h.c2(A,t.u_scale),u_fade:new h.bq(A,t.u_fade)}),lineSDF:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels),u_image:new h.b_(A,t.u_image),u_mix:new h.bq(A,t.u_mix),u_tileratio:new h.bq(A,t.u_tileratio),u_crossfade_from:new h.bq(A,t.u_crossfade_from),u_crossfade_to:new h.bq(A,t.u_crossfade_to),u_lineatlas_width:new h.bq(A,t.u_lineatlas_width),u_lineatlas_height:new h.bq(A,t.u_lineatlas_height)}),lineGradientSDF:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels),u_image:new h.b_(A,t.u_image),u_image_height:new h.bq(A,t.u_image_height),u_tileratio:new h.bq(A,t.u_tileratio),u_crossfade_from:new h.bq(A,t.u_crossfade_from),u_crossfade_to:new h.bq(A,t.u_crossfade_to),u_image_dash:new h.b_(A,t.u_image_dash),u_mix:new h.bq(A,t.u_mix),u_lineatlas_width:new h.bq(A,t.u_lineatlas_width),u_lineatlas_height:new h.bq(A,t.u_lineatlas_height)}),raster:(A,t)=>({u_tl_parent:new h.c3(A,t.u_tl_parent),u_scale_parent:new h.bq(A,t.u_scale_parent),u_buffer_scale:new h.bq(A,t.u_buffer_scale),u_fade_t:new h.bq(A,t.u_fade_t),u_opacity:new h.bq(A,t.u_opacity),u_image0:new h.b_(A,t.u_image0),u_image1:new h.b_(A,t.u_image1),u_brightness_low:new h.bq(A,t.u_brightness_low),u_brightness_high:new h.bq(A,t.u_brightness_high),u_saturation_factor:new h.bq(A,t.u_saturation_factor),u_contrast_factor:new h.bq(A,t.u_contrast_factor),u_spin_weights:new h.c2(A,t.u_spin_weights),u_coords_top:new h.c1(A,t.u_coords_top),u_coords_bottom:new h.c1(A,t.u_coords_bottom)}),symbolIcon:(A,t)=>({u_is_size_zoom_constant:new h.b_(A,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(A,t.u_is_size_feature_constant),u_size_t:new h.bq(A,t.u_size_t),u_size:new h.bq(A,t.u_size),u_camera_to_center_distance:new h.bq(A,t.u_camera_to_center_distance),u_pitch:new h.bq(A,t.u_pitch),u_rotate_symbol:new h.b_(A,t.u_rotate_symbol),u_aspect_ratio:new h.bq(A,t.u_aspect_ratio),u_fade_change:new h.bq(A,t.u_fade_change),u_label_plane_matrix:new h.c0(A,t.u_label_plane_matrix),u_coord_matrix:new h.c0(A,t.u_coord_matrix),u_is_text:new h.b_(A,t.u_is_text),u_pitch_with_map:new h.b_(A,t.u_pitch_with_map),u_is_along_line:new h.b_(A,t.u_is_along_line),u_is_variable_anchor:new h.b_(A,t.u_is_variable_anchor),u_texsize:new h.c3(A,t.u_texsize),u_texture:new h.b_(A,t.u_texture),u_translation:new h.c3(A,t.u_translation),u_pitched_scale:new h.bq(A,t.u_pitched_scale)}),symbolSDF:(A,t)=>({u_is_size_zoom_constant:new h.b_(A,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(A,t.u_is_size_feature_constant),u_size_t:new h.bq(A,t.u_size_t),u_size:new h.bq(A,t.u_size),u_camera_to_center_distance:new h.bq(A,t.u_camera_to_center_distance),u_pitch:new h.bq(A,t.u_pitch),u_rotate_symbol:new h.b_(A,t.u_rotate_symbol),u_aspect_ratio:new h.bq(A,t.u_aspect_ratio),u_fade_change:new h.bq(A,t.u_fade_change),u_label_plane_matrix:new h.c0(A,t.u_label_plane_matrix),u_coord_matrix:new h.c0(A,t.u_coord_matrix),u_is_text:new h.b_(A,t.u_is_text),u_pitch_with_map:new h.b_(A,t.u_pitch_with_map),u_is_along_line:new h.b_(A,t.u_is_along_line),u_is_variable_anchor:new h.b_(A,t.u_is_variable_anchor),u_texsize:new h.c3(A,t.u_texsize),u_texture:new h.b_(A,t.u_texture),u_gamma_scale:new h.bq(A,t.u_gamma_scale),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_is_halo:new h.b_(A,t.u_is_halo),u_translation:new h.c3(A,t.u_translation),u_pitched_scale:new h.bq(A,t.u_pitched_scale)}),symbolTextAndIcon:(A,t)=>({u_is_size_zoom_constant:new h.b_(A,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(A,t.u_is_size_feature_constant),u_size_t:new h.bq(A,t.u_size_t),u_size:new h.bq(A,t.u_size),u_camera_to_center_distance:new h.bq(A,t.u_camera_to_center_distance),u_pitch:new h.bq(A,t.u_pitch),u_rotate_symbol:new h.b_(A,t.u_rotate_symbol),u_aspect_ratio:new h.bq(A,t.u_aspect_ratio),u_fade_change:new h.bq(A,t.u_fade_change),u_label_plane_matrix:new h.c0(A,t.u_label_plane_matrix),u_coord_matrix:new h.c0(A,t.u_coord_matrix),u_is_text:new h.b_(A,t.u_is_text),u_pitch_with_map:new h.b_(A,t.u_pitch_with_map),u_is_along_line:new h.b_(A,t.u_is_along_line),u_is_variable_anchor:new h.b_(A,t.u_is_variable_anchor),u_texsize:new h.c3(A,t.u_texsize),u_texsize_icon:new h.c3(A,t.u_texsize_icon),u_texture:new h.b_(A,t.u_texture),u_texture_icon:new h.b_(A,t.u_texture_icon),u_gamma_scale:new h.bq(A,t.u_gamma_scale),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_is_halo:new h.b_(A,t.u_is_halo),u_translation:new h.c3(A,t.u_translation),u_pitched_scale:new h.bq(A,t.u_pitched_scale)}),background:(A,t)=>({u_opacity:new h.bq(A,t.u_opacity),u_color:new h.b$(A,t.u_color)}),backgroundPattern:(A,t)=>({u_opacity:new h.bq(A,t.u_opacity),u_image:new h.b_(A,t.u_image),u_pattern_tl_a:new h.c3(A,t.u_pattern_tl_a),u_pattern_br_a:new h.c3(A,t.u_pattern_br_a),u_pattern_tl_b:new h.c3(A,t.u_pattern_tl_b),u_pattern_br_b:new h.c3(A,t.u_pattern_br_b),u_texsize:new h.c3(A,t.u_texsize),u_mix:new h.bq(A,t.u_mix),u_pattern_size_a:new h.c3(A,t.u_pattern_size_a),u_pattern_size_b:new h.c3(A,t.u_pattern_size_b),u_scale_a:new h.bq(A,t.u_scale_a),u_scale_b:new h.bq(A,t.u_scale_b),u_pixel_coord_upper:new h.c3(A,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(A,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.bq(A,t.u_tile_units_to_pixels)}),terrain:(A,t)=>({u_texture:new h.b_(A,t.u_texture),u_ele_delta:new h.bq(A,t.u_ele_delta),u_fog_matrix:new h.c0(A,t.u_fog_matrix),u_fog_color:new h.b$(A,t.u_fog_color),u_fog_ground_blend:new h.bq(A,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.bq(A,t.u_fog_ground_blend_opacity),u_horizon_color:new h.b$(A,t.u_horizon_color),u_horizon_fog_blend:new h.bq(A,t.u_horizon_fog_blend),u_is_globe_mode:new h.bq(A,t.u_is_globe_mode)}),terrainDepth:(A,t)=>({u_ele_delta:new h.bq(A,t.u_ele_delta)}),terrainCoords:(A,t)=>({u_texture:new h.b_(A,t.u_texture),u_terrain_coords_id:new h.bq(A,t.u_terrain_coords_id),u_ele_delta:new h.bq(A,t.u_ele_delta)}),projectionErrorMeasurement:(A,t)=>({u_input:new h.bq(A,t.u_input),u_output_expected:new h.bq(A,t.u_output_expected)}),atmosphere:(A,t)=>({u_sun_pos:new h.c2(A,t.u_sun_pos),u_atmosphere_blend:new h.bq(A,t.u_atmosphere_blend),u_globe_position:new h.c2(A,t.u_globe_position),u_globe_radius:new h.bq(A,t.u_globe_radius),u_inv_proj_matrix:new h.c0(A,t.u_inv_proj_matrix)}),sky:(A,t)=>({u_sky_color:new h.b$(A,t.u_sky_color),u_horizon_color:new h.b$(A,t.u_horizon_color),u_horizon:new h.c3(A,t.u_horizon),u_horizon_normal:new h.c3(A,t.u_horizon_normal),u_sky_horizon_blend:new h.bq(A,t.u_sky_horizon_blend),u_sky_blend:new h.bq(A,t.u_sky_blend)})};class wn{constructor(t,s,f){this.context=t;const x=t.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yi{constructor(t,s,f,x){this.length=s.length,this.attributes=f,this.itemSize=s.bytesPerElement,this.dynamicDraw=x,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let f=0;f<this.attributes.length;f++){const x=s.attributes[this.attributes[f].name];x!==void 0&&t.enableVertexAttribArray(x)}}setVertexAttribPointers(t,s,f){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],k=s.attributes[S.name];k!==void 0&&t.vertexAttribPointer(k,S.components,t[xn[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class rs extends Wn{getDefault(){return h.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class xa extends Wn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Vs extends Wn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ar extends Wn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ss extends Wn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Qs extends Wn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ao extends Wn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Gs extends Wn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class sh extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class bu extends Wn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class oo extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class fl extends Wn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ba extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Vl extends Wn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Uc extends Wn{getDefault(){return h.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vc extends Wn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ah extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class mc extends Wn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class To extends Wn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class qd extends Wn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class vu extends Wn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Oi extends Wn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wh extends Wn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class lo extends Wn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Yh extends Wn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class co extends Wn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class lp extends Wn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $h extends Wn{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const f=this.gl;Xn(f)?f.bindVertexArray(t):(s=f.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class yc extends Wn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Zd extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Qh extends Wn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xc extends Wn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class wu extends xc{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Fa extends xc{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _c extends xc{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const bc="Framebuffer is not complete";class Gc{constructor(t,s,f,x,S){this.context=t,this.width=s,this.height=f;const k=t.gl,z=this.framebuffer=k.createFramebuffer();if(this.colorAttachment=new wu(t,z),x)this.depthAttachment=S?new _c(t,z):new Fa(t,z);else if(S)throw new Error("Stencil cannot be set without depth");if(k.checkFramebufferStatus(k.FRAMEBUFFER)!==k.FRAMEBUFFER_COMPLETE)throw new Error(bc)}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const f=this.depthAttachment.get();f&&t.deleteRenderbuffer(f)}t.deleteFramebuffer(this.framebuffer)}}class vc{constructor(t){var s,f;if(this.gl=t,this.clearColor=new rs(this),this.clearDepth=new xa(this),this.clearStencil=new Vs(this),this.colorMask=new Ar(this),this.depthMask=new ss(this),this.stencilMask=new Qs(this),this.stencilFunc=new ao(this),this.stencilOp=new Gs(this),this.stencilTest=new sh(this),this.depthRange=new bu(this),this.depthTest=new oo(this),this.depthFunc=new fl(this),this.blend=new Ba(this),this.blendFunc=new Vl(this),this.blendColor=new Uc(this),this.blendEquation=new Vc(this),this.cullFace=new ah(this),this.cullFaceSide=new mc(this),this.frontFace=new To(this),this.program=new qd(this),this.activeTexture=new vu(this),this.viewport=new Oi(this),this.bindFramebuffer=new Wh(this),this.bindRenderbuffer=new lo(this),this.bindTexture=new Yh(this),this.bindVertexBuffer=new co(this),this.bindElementBuffer=new lp(this),this.bindVertexArray=new $h(this),this.pixelStoreUnpack=new yc(this),this.pixelStoreUnpackPremultiplyAlpha=new Zd(this),this.pixelStoreUnpackFlipY=new Qh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Xn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const x=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:x?.RGBA16F_EXT,this.RGB16F=(f=t.RGB16F)!==null&&f!==void 0?f:x?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const x=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=x?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new wn(this,t,s)}createVertexBuffer(t,s,f){return new Yi(this,t,s,f)}createRenderbuffer(t,s,f){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,t,s,f),this.bindRenderbuffer.set(null),S}createFramebuffer(t,s,f,x){return new Gc(this,t,s,f,x)}clear({color:t,depth:s,stencil:f}){const x=this.gl;let S=0;t&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),f!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.bR(t.blendFunction,cr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Xn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return Xn(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ks;function na(A,t,s,f,x){const S=A.context,k=A.transform,z=S.gl,j=A.useProgram("collisionBox"),Z=[];let W=0,ee=0;for(let Ie=0;Ie<f.length;Ie++){const Be=f[Ie],Qe=t.getTile(Be).getBucket(s);if(!Qe)continue;const Le=x?Qe.textCollisionBox:Qe.iconCollisionBox,$e=Qe.collisionCircleArray;$e.length>0&&(Z.push({circleArray:$e,circleOffset:ee,coord:Be}),W+=$e.length/4,ee=W),Le&&j.draw(S,z.LINES,Xe.disabled,bt.disabled,A.colorModeForRenderPass(),qe.disabled,$s(A.transform),A.style.map.terrain&&A.style.map.terrain.getTerrainData(Be),k.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,A.transform.zoom,null,null,Le.collisionVertexBuffer)}if(!x||!Z.length)return;const J=A.useProgram("collisionCircle"),se=new h.ca;se.resize(4*W),se._trim();let fe=0;for(const Ie of Z)for(let Be=0;Be<Ie.circleArray.length/4;Be++){const Qe=4*Be,Le=Ie.circleArray[Qe+0],$e=Ie.circleArray[Qe+1],st=Ie.circleArray[Qe+2],Ve=Ie.circleArray[Qe+3];se.emplace(fe++,Le,$e,st,Ve,0),se.emplace(fe++,Le,$e,st,Ve,1),se.emplace(fe++,Le,$e,st,Ve,2),se.emplace(fe++,Le,$e,st,Ve,3)}(!Ks||Ks.length<2*W)&&(Ks=(function(Ie){const Be=2*Ie,Qe=new h.cc;Qe.resize(Be),Qe._trim();for(let Le=0;Le<Be;Le++){const $e=6*Le;Qe.uint16[$e+0]=4*Le+0,Qe.uint16[$e+1]=4*Le+1,Qe.uint16[$e+2]=4*Le+2,Qe.uint16[$e+3]=4*Le+2,Qe.uint16[$e+4]=4*Le+3,Qe.uint16[$e+5]=4*Le+0}return Qe})(W));const Ce=S.createIndexBuffer(Ks,!0),Me=S.createVertexBuffer(se,h.cb.members,!0);for(const Ie of Z){const Be=rh(A.transform);J.draw(S,z.TRIANGLES,Xe.disabled,bt.disabled,A.colorModeForRenderPass(),qe.disabled,Be,A.style.map.terrain&&A.style.map.terrain.getTerrainData(Ie.coord),null,s.id,Me,Ce,h.aX.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,A.transform.zoom,null,null,null)}Me.destroy(),Ce.destroy()}const pl=h.ar(new Float32Array(16));function gl(A,t,s,f,x,S){const{horizontalAlign:k,verticalAlign:z}=h.aS(A);return new h.P((-(k-.5)*t/x+f[0])*S,(-(z-.5)*s/x+f[1])*S)}function Ga(A,t,s,f,x,S){const k=t.tileAnchorPoint.add(new h.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let z=f.mult(S);s||(z=z.rotate(-x));const j=k.add(z);return fn(j.x,j.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(s){const z=En(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(A),j=Math.atan(z.y/z.x)+(z.x<0?Math.PI:0);return A.add(f.rotate(j))}return A.add(f)}function Gl(A,t,s,f,x,S,k,z,j,Z,W,ee){const J=A.text.placedSymbolArray,se=A.text.dynamicLayoutVertexArray,fe=A.icon.dynamicLayoutVertexArray,Ce={};se.clear();for(let Me=0;Me<J.length;Me++){const Ie=J.get(Me),Be=Ie.hidden||!Ie.crossTileID||A.allowVerticalPlacement&&!Ie.placedOrientation?null:f[Ie.crossTileID];if(Be){const Qe=new h.P(Ie.anchorX,Ie.anchorY),Le={getElevation:ee,width:x.width,height:x.height,pitchedLabelPlaneMatrix:S,pitchWithMap:s,transform:x,tileAnchorPoint:Qe,translation:Z,unwrappedTileID:W},$e=s?ii(Qe.x,Qe.y,Le):En(Qe.x,Qe.y,Le),st=Rn(x.cameraToCenterDistance,$e.signedDistanceFromCamera);let Ve=h.aA(A.textSizeData,z,Ie)*st/h.aM;s&&(Ve*=A.tilePixelRatio/k);const{width:dt,height:Lt,anchor:Mt,textOffset:Pt,textBoxScale:Ot}=Be,bn=gl(Mt,dt,Lt,Pt,Ot,Ve),vn=x.getPitchedTextCorrection(Qe.x+Z[0],Qe.y+Z[1],W),on=Ga($e.point,Le,t,bn,-x.bearingInRadians,vn),Cn=A.allowVerticalPlacement&&Ie.placedOrientation===h.az.vertical?Math.PI/2:0;for(let Ni=0;Ni<Ie.numGlyphs;Ni++)h.aG(se,on,Cn);j&&Ie.associatedIconIndex>=0&&(Ce[Ie.associatedIconIndex]={shiftedAnchor:on,angle:Cn})}else Xr(Ie.numGlyphs,se)}if(j){fe.clear();const Me=A.icon.placedSymbolArray;for(let Ie=0;Ie<Me.length;Ie++){const Be=Me.get(Ie);if(Be.hidden)Xr(Be.numGlyphs,fe);else{const Qe=Ce[Ie];if(Qe)for(let Le=0;Le<Be.numGlyphs;Le++)h.aG(fe,Qe.shiftedAnchor,Qe.angle);else Xr(Be.numGlyphs,fe)}}A.icon.dynamicLayoutVertexBuffer.updateData(fe)}A.text.dynamicLayoutVertexBuffer.updateData(se)}function Xd(A,t,s){return s.iconsInText&&t?"symbolTextAndIcon":A?"symbolSDF":"symbolIcon"}function Hc(A,t,s,f,x,S,k,z,j,Z,W,ee,J){const se=A.context,fe=se.gl,Ce=A.transform,Me=z==="map",Ie=j==="map",Be=z!=="viewport"&&s.layout.get("symbol-placement")!=="point",Qe=Me&&!Ie&&!Be,Le=!s.layout.get("symbol-sort-key").isConstant();let $e=!1;const st=A.getDepthModeForSublayer(0,Xe.ReadOnly),Ve=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),dt=[],Lt=Ce.getCircleRadiusCorrection();for(const Mt of f){const Pt=t.getTile(Mt),Ot=Pt.getBucket(s);if(!Ot)continue;const bn=x?Ot.text:Ot.icon;if(!bn||!bn.segments.get().length||!bn.hasVisibleVertices)continue;const vn=bn.programConfigurations.get(s.id),on=x||Ot.sdfIcons,Cn=x?Ot.textSizeData:Ot.iconSizeData,Ni=Ie||Ce.pitch!==0,Sr=A.useProgram(Xd(on,x,Ot),vn),qr=h.ay(Cn,Ce.zoom),jr=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Mt);let es,Rr,gs,ts,ra=[0,0],_s=null;if(x)Rr=Pt.glyphAtlasTexture,gs=fe.LINEAR,es=Pt.glyphAtlasTexture.size,Ot.iconsInText&&(ra=Pt.imageAtlasTexture.size,_s=Pt.imageAtlasTexture,ts=Ni||A.options.rotating||A.options.zooming||Cn.kind==="composite"||Cn.kind==="camera"?fe.LINEAR:fe.NEAREST);else{const Mr=s.layout.get("icon-size").constantOr(0)!==1||Ot.iconsNeedLinear;Rr=Pt.imageAtlasTexture,gs=on||A.options.rotating||A.options.zooming||Mr||Ni?fe.LINEAR:fe.NEAREST,es=Pt.imageAtlasTexture.size}const bs=h.aN(Pt,1,A.transform.zoom),sa=$t(Me,A.transform,bs),Il=h.N();h.aB(Il,sa);const Ml=gn(Ie,Me,A.transform,bs),Jo=h.aO(Ce,Pt,S,k),Xa=Ce.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),Jc=Ve&&Ot.hasTextData(),Du=s.layout.get("icon-text-fit")!=="none"&&Jc&&Ot.hasIconData();if(Be){const Mr=A.style.map.terrain?(Os,Hs)=>A.style.map.terrain.getElevation(Mt,Os,Hs):null,Ur=s.layout.get("text-rotation-alignment")==="map";Fn(Ot,A,x,sa,Il,Ie,Z,Ur,Mt.toUnwrapped(),Ce.width,Ce.height,Jo,Mr)}const el=x&&Ve||Du,Wa=Be||el?pl:Ie?sa:A.transform.clipSpaceToPixelsMatrix,go=on&&s.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ro;Ro=on?Ot.iconsInText?ot(Cn.kind,qr,Qe,Ie,Be,el,A,Wa,Ml,Jo,es,ra,Lt):ze(Cn.kind,qr,Qe,Ie,Be,el,A,Wa,Ml,Jo,x,es,0,Lt):xe(Cn.kind,qr,Qe,Ie,Be,el,A,Wa,Ml,Jo,x,es,Lt);const Po={program:Sr,buffers:bn,uniformValues:Ro,projectionData:Xa,atlasTexture:Rr,atlasTextureIcon:_s,atlasInterpolation:gs,atlasInterpolationIcon:ts,isSDF:on,hasHalo:go};if(Le&&Ot.canOverlap){$e=!0;const Mr=bn.segments.get();for(const Ur of Mr)dt.push({segments:new h.aX([Ur]),sortKey:Ur.sortKey,state:Po,terrainData:jr})}else dt.push({segments:bn.segments,sortKey:0,state:Po,terrainData:jr})}$e&&dt.sort(((Mt,Pt)=>Mt.sortKey-Pt.sortKey));for(const Mt of dt){const Pt=Mt.state;if(se.activeTexture.set(fe.TEXTURE0),Pt.atlasTexture.bind(Pt.atlasInterpolation,fe.CLAMP_TO_EDGE),Pt.atlasTextureIcon&&(se.activeTexture.set(fe.TEXTURE1),Pt.atlasTextureIcon&&Pt.atlasTextureIcon.bind(Pt.atlasInterpolationIcon,fe.CLAMP_TO_EDGE)),Pt.isSDF){const Ot=Pt.uniformValues;Pt.hasHalo&&(Ot.u_is_halo=1,Au(Pt.buffers,Mt.segments,s,A,Pt.program,st,W,ee,Ot,Pt.projectionData,Mt.terrainData)),Ot.u_is_halo=0}Au(Pt.buffers,Mt.segments,s,A,Pt.program,st,W,ee,Pt.uniformValues,Pt.projectionData,Mt.terrainData)}}function Au(A,t,s,f,x,S,k,z,j,Z,W){const ee=f.context;x.draw(ee,ee.gl.TRIANGLES,S,k,z,qe.backCCW,j,W,Z,s.id,A.layoutVertexBuffer,A.indexBuffer,t,s.paint,f.transform.zoom,A.programConfigurations.get(s.id),A.dynamicLayoutVertexBuffer,A.opacityVertexBuffer)}function Wd(A,t,s,f,x){const S=A.context,k=S.gl,z=bt.disabled,j=new cr([k.ONE,k.ONE],h.bp.transparent,[!0,!0,!0,!0]),Z=t.getBucket(s);if(!Z)return;const W=f.key;let ee=s.heatmapFbos.get(W);ee||(ee=Fr(S,t.tileSize,t.tileSize),s.heatmapFbos.set(W,ee)),S.bindFramebuffer.set(ee.framebuffer),S.viewport.set([0,0,t.tileSize,t.tileSize]),S.clear({color:h.bp.transparent});const J=Z.programConfigurations.get(s.id),se=A.useProgram("heatmap",J,!x),fe=A.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ce=A.style.map.terrain.getTerrainData(f);se.draw(S,k.TRIANGLES,Xe.disabled,z,j,qe.disabled,Va(t,A.transform.zoom,s.paint.get("heatmap-intensity"),1),Ce,fe,s.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,s.paint,A.transform.zoom,J)}function ia(A,t,s,f,x){const S=A.context,k=S.gl,z=A.transform;S.setColorMode(A.colorModeForRenderPass());const j=tr(S,t),Z=s.key,W=t.heatmapFbos.get(Z);if(!W)return;S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,W.colorAttachment.get()),S.activeTexture.set(k.TEXTURE1),j.bind(k.LINEAR,k.CLAMP_TO_EDGE);const ee=z.getProjectionData({overscaledTileID:s,applyTerrainMatrix:x,applyGlobeMatrix:!f});A.useProgram("heatmapTexture").draw(S,k.TRIANGLES,Xe.disabled,bt.disabled,A.colorModeForRenderPass(),qe.disabled,sr(A,t,0,1),null,ee,t.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments,t.paint,z.zoom),W.destroy(),t.heatmapFbos.delete(Z)}function Fr(A,t,s){var f,x;const S=A.gl,k=S.createTexture();S.bindTexture(S.TEXTURE_2D,k),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const z=(f=A.HALF_FLOAT)!==null&&f!==void 0?f:S.UNSIGNED_BYTE,j=(x=A.RGBA16F)!==null&&x!==void 0?x:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,j,t,s,0,S.RGBA,z,null);const Z=A.createFramebuffer(t,s,!1,!1);return Z.colorAttachment.set(k),Z}function tr(A,t){return t.colorRampTexture||(t.colorRampTexture=new h.T(A,t.colorRamp,A.gl.RGBA)),t.colorRampTexture}function Hl(A,t,s,f,x,S,k,z){let j=256;if(x.stepInterpolant){const Z=t.getSource().maxzoom,W=k.canonical.z===Z?Math.ceil(1<<A.transform.maxZoom-k.canonical.z):1;j=h.an(h.ce(S.maxLineLength/h.a5*1024*W),256,s.maxTextureSize)}return z.gradient=h.cf({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:j,image:z.gradient||void 0,clips:S.lineClipsArray}),z.texture?z.texture.update(z.gradient):z.texture=new h.T(s,z.gradient,f.RGBA),z.version=x.gradientVersion,z.texture}function uo(A,t,s,f,x){A.activeTexture.set(t.TEXTURE0),s.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),f.updatePaintBuffers(x)}function fs(A,t,s,f,x,S){(x||A.lineAtlas.dirty)&&(t.activeTexture.set(s.TEXTURE0),A.lineAtlas.bind(t)),f.updatePaintBuffers(S)}function Ha(A,t,s,f,x,S,k){const z=S.gradients[x.id];let j=z.texture;x.gradientVersion!==z.version&&(j=Hl(A,t,s,f,x,S,k,z)),s.activeTexture.set(f.TEXTURE0),j.bind(x.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE)}function qa(A,t,s,f,x,S,k,z,j){const Z=S.gradients[x.id];let W=Z.texture;x.gradientVersion!==Z.version&&(W=Hl(A,t,s,f,x,S,k,Z)),s.activeTexture.set(f.TEXTURE0),W.bind(x.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE),s.activeTexture.set(f.TEXTURE1),A.lineAtlas.bind(s),z.updatePaintBuffers(j)}function oh(A,t,s,f,x){if(!s||!f||!f.imageAtlas)return;const S=f.imageAtlas.patternPositions;let k=S[s.to.toString()],z=S[s.from.toString()];if(!k&&z&&(k=z),!z&&k&&(z=k),!k||!z){const j=x.getPaintProperty(t);k=S[j],z=S[j]}k&&z&&A.setConstantPatternPositions(k,z)}function ml(A,t,s,f,x,S,k,z){const j=A.context.gl,Z="fill-pattern",W=s.paint.get(Z),ee=W&&W.constantOr(1),J=s.getCrossfadeParameters();let se,fe,Ce,Me,Ie;const Be=A.transform,Qe=s.paint.get("fill-translate"),Le=s.paint.get("fill-translate-anchor");k?(fe=ee&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",se=j.LINES):(fe=ee?"fillPattern":"fill",se=j.TRIANGLES);const $e=W.constantOr(null);for(const st of f){const Ve=t.getTile(st);if(ee&&!Ve.patternsLoaded())continue;const dt=Ve.getBucket(s);if(!dt)continue;const Lt=dt.programConfigurations.get(s.id),Mt=A.useProgram(fe,Lt),Pt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(st);ee&&(A.context.activeTexture.set(j.TEXTURE0),Ve.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Lt.updatePaintBuffers(J)),oh(Lt,Z,$e,Ve,s);const Ot=Be.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),bn=h.aO(Be,Ve,Qe,Le);if(k){Me=dt.indexBuffer2,Ie=dt.segments2;const on=[j.drawingBufferWidth,j.drawingBufferHeight];Ce=fe==="fillOutlinePattern"&&ee?Xh(A,J,Ve,on,bn):hl(on,bn)}else Me=dt.indexBuffer,Ie=dt.segments,Ce=ee?jl(A,J,Ve,bn):{u_fill_translate:bn};const vn=A.stencilModeForClipping(st);Mt.draw(A.context,se,x,vn,S,qe.backCCW,Ce,Pt,Ot,s.id,dt.layoutVertexBuffer,Me,Ie,s.paint,A.transform.zoom,Lt)}}function yl(A,t,s,f,x,S,k,z){const j=A.context,Z=j.gl,W="fill-extrusion-pattern",ee=s.paint.get(W),J=ee.constantOr(1),se=s.getCrossfadeParameters(),fe=s.paint.get("fill-extrusion-opacity"),Ce=ee.constantOr(null),Me=A.transform;for(const Ie of f){const Be=t.getTile(Ie),Qe=Be.getBucket(s);if(!Qe)continue;const Le=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Ie),$e=Qe.programConfigurations.get(s.id),st=A.useProgram(J?"fillExtrusionPattern":"fillExtrusion",$e);J&&(A.context.activeTexture.set(Z.TEXTURE0),Be.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),$e.updatePaintBuffers(se));const Ve=Me.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!z,applyTerrainMatrix:!0});oh($e,W,Ce,Be,s);const dt=h.aO(Me,Be,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Lt=s.paint.get("fill-extrusion-vertical-gradient"),Mt=J?La(A,Lt,fe,dt,Ie,se,Be):jc(A,Lt,fe,dt);st.draw(j,j.gl.TRIANGLES,x,S,k,qe.backCCW,Mt,Le,Ve,s.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,s.paint,A.transform.zoom,$e,A.style.map.terrain&&Qe.centroidVertexBuffer)}}function xl(A,t,s,f,x,S,k,z,j){var Z;const W=A.style.projection,ee=A.context,J=A.transform,se=ee.gl,fe=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],Ce=A.useProgram("hillshade",null,!1,fe),Me=!A.options.moving;for(const Ie of f){const Be=t.getTile(Ie),Qe=Be.fbo;if(!Qe)continue;const Le=W.getMeshFromTileID(ee,Ie.canonical,z,!0,"raster"),$e=(Z=A.style.map.terrain)===null||Z===void 0?void 0:Z.getTerrainData(Ie);ee.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,Qe.colorAttachment.get());const st=J.getProjectionData({overscaledTileID:Ie,aligned:Me,applyGlobeMatrix:!j,applyTerrainMatrix:!0});Ce.draw(ee,se.TRIANGLES,S,x[Ie.overscaledZ],k,qe.backCCW,dl(A,Be,s),$e,st,s.id,Le.vertexBuffer,Le.indexBuffer,Le.segments)}}function ql(A,t,s,f,x,S,k,z,j){var Z;const W=A.style.projection,ee=A.context,J=A.transform,se=ee.gl,fe=A.useProgram("colorRelief"),Ce=!A.options.moving;let Me=!0,Ie=0;for(const Be of f){const Qe=t.getTile(Be),Le=Qe.dem;if(Me){const Mt=se.getParameter(se.MAX_TEXTURE_SIZE),{elevationTexture:Pt,colorTexture:Ot}=s.getColorRampTextures(ee,Mt,Le.getUnpackVector());ee.activeTexture.set(se.TEXTURE1),Pt.bind(se.NEAREST,se.CLAMP_TO_EDGE),ee.activeTexture.set(se.TEXTURE4),Ot.bind(se.LINEAR,se.CLAMP_TO_EDGE),Me=!1,Ie=Pt.size[0]}if(!Le||!Le.data)continue;const $e=Le.stride,st=Le.getPixels();if(ee.activeTexture.set(se.TEXTURE0),ee.pixelStoreUnpackPremultiplyAlpha.set(!1),Qe.demTexture=Qe.demTexture||A.getTileTexture($e),Qe.demTexture){const Mt=Qe.demTexture;Mt.update(st,{premultiply:!1}),Mt.bind(se.LINEAR,se.CLAMP_TO_EDGE)}else Qe.demTexture=new h.T(ee,st,se.RGBA,{premultiply:!1}),Qe.demTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Ve=W.getMeshFromTileID(ee,Be.canonical,z,!0,"raster"),dt=(Z=A.style.map.terrain)===null||Z===void 0?void 0:Z.getTerrainData(Be),Lt=J.getProjectionData({overscaledTileID:Be,aligned:Ce,applyGlobeMatrix:!j,applyTerrainMatrix:!0});fe.draw(ee,se.TRIANGLES,S,x[Be.overscaledZ],k,qe.backCCW,u(s,Qe.dem,Ie),dt,Lt,s.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}const Zl=[new h.P(0,0),new h.P(h.a5,0),new h.P(h.a5,h.a5),new h.P(0,h.a5)];function Io(A,t,s,f,x,S,k,z,j=!1,Z=!1){const W=f[f.length-1].overscaledZ,ee=A.context,J=ee.gl,se=A.useProgram("raster"),fe=A.transform,Ce=A.style.projection,Me=A.colorModeForRenderPass(),Ie=!A.options.moving,Be=s.paint.get("raster-opacity"),Qe=s.paint.get("raster-resampling"),Le=s.paint.get("raster-fade-duration"),$e=!!A.style.map.terrain;for(const st of f){const Ve=A.getDepthModeForSublayer(st.overscaledZ-W,Be===1?Xe.ReadWrite:Xe.ReadOnly,J.LESS),dt=t.getTile(st),Lt=Qe==="nearest"?J.NEAREST:J.LINEAR;ee.activeTexture.set(J.TEXTURE0),dt.texture.bind(Lt,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),ee.activeTexture.set(J.TEXTURE1);const{parentTile:Mt,parentScaleBy:Pt,parentTopLeft:Ot,fadeValues:bn}=_l(dt,t,Le,$e);dt.fadeOpacity=bn.tileOpacity,Mt?(Mt.fadeOpacity=bn.parentTileOpacity,Mt.texture.bind(Lt,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST)):dt.texture.bind(Lt,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),dt.texture.useMipmap&&ee.extTextureFilterAnisotropic&&A.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);const vn=A.style.map.terrain&&A.style.map.terrain.getTerrainData(st),on=fe.getProjectionData({overscaledTileID:st,aligned:Ie,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Cn=te(Ot,Pt,bn.fadeMix,s,z),Ni=Ce.getMeshFromTileID(ee,st.canonical,S,k,"raster");se.draw(ee,J.TRIANGLES,Ve,x?x[st.overscaledZ]:bt.disabled,Me,j?qe.frontCCW:qe.backCCW,Cn,vn,on,s.id,Ni.vertexBuffer,Ni.indexBuffer,Ni.segments)}}function _l(A,t,s,f){const x={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(s===0||f)return x;if(A.fadingParentID){const S=t.getLoadedTile(A.fadingParentID);if(!S)return x;const k=Math.pow(2,S.tileID.overscaledZ-A.tileID.overscaledZ),z=[A.tileID.canonical.x*k%1,A.tileID.canonical.y*k%1],j=(function(Z,W,ee){const J=me(),se=(J-W.timeAdded)/ee,fe=Z.fadingDirection===Ze.Incoming,Ce=h.an((J-Z.timeAdded)/ee,0,1),Me=h.an(1-se,0,1),Ie=fe?Ce:Me;return{tileOpacity:Ie,parentTileOpacity:fe?Me:Ce,fadeMix:{opacity:1,mix:1-Ie}}})(A,S,s);return{parentTile:S,parentScaleBy:k,parentTopLeft:z,fadeValues:j}}if(A.selfFading){const S=(function(k,z){const j=(me()-k.timeAdded)/z,Z=h.an(j,0,1);return{tileOpacity:Z,fadeMix:{opacity:Z,mix:0}}})(A,s);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:S}}return x}const Xl=new h.bp(1,0,0,1),bl=new h.bp(0,1,0,1),Kh=new h.bp(0,0,1,1),Jh=new h.bp(1,0,1,1),ho=new h.bp(0,1,1,1);function Eu(A,t,s,f){Ps(A,0,t+s/2,A.transform.width,s,f)}function Wl(A,t,s,f){Ps(A,t-s/2,0,s,A.transform.height,f)}function Ps(A,t,s,f,x,S){const k=A.context,z=k.gl;z.enable(z.SCISSOR_TEST),z.scissor(t*A.pixelRatio,s*A.pixelRatio,f*A.pixelRatio,x*A.pixelRatio),k.clear({color:S}),z.disable(z.SCISSOR_TEST)}function lh(A,t,s){const f=A.context,x=f.gl,S=A.useProgram("debug"),k=Xe.disabled,z=bt.disabled,j=A.colorModeForRenderPass(),Z="$debug",W=A.style.map.terrain&&A.style.map.terrain.getTerrainData(s);f.activeTexture.set(x.TEXTURE0);const ee=t.getTileByID(s.key).latestRawTileData,J=Math.floor((ee&&ee.byteLength||0)/1024),se=t.getTile(s).tileSize,fe=512/Math.min(se,512)*(s.overscaledZ/A.transform.zoom)*.5;let Ce=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Ce+=` => ${s.overscaledZ}`),(function(Ie,Be){Ie.initDebugOverlayCanvas();const Qe=Ie.debugOverlayCanvas,Le=Ie.context.gl,$e=Ie.debugOverlayCanvas.getContext("2d");$e.clearRect(0,0,Qe.width,Qe.height),$e.shadowColor="white",$e.shadowBlur=2,$e.lineWidth=1.5,$e.strokeStyle="white",$e.textBaseline="top",$e.font="bold 36px Open Sans, sans-serif",$e.fillText(Be,5,5),$e.strokeText(Be,5,5),Ie.debugOverlayTexture.update(Qe),Ie.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)})(A,`${Ce} ${J}kB`);const Me=A.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(f,x.TRIANGLES,k,z,cr.alphaBlended,qe.disabled,Ul(h.bp.transparent,fe),null,Me,Z,A.debugBuffer,A.quadTriangleIndexBuffer,A.debugSegments),S.draw(f,x.LINE_STRIP,k,z,j,qe.disabled,Ul(h.bp.red),W,Me,Z,A.debugBuffer,A.tileBorderIndexBuffer,A.debugSegments)}function ed(A,t,s,f){const{isRenderingGlobe:x}=f,S=A.context,k=S.gl,z=A.transform,j=A.colorModeForRenderPass(),Z=A.getDepthModeFor3D(),W=A.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,A.width,A.height]);for(const ee of s){const J=t.getTerrainMesh(ee.tileID),se=A.renderToTexture.getTexture(ee),fe=t.getTerrainData(ee.tileID);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,se.texture);const Ce=t.getMeshFrameDelta(z.zoom),Me=z.calculateFogMatrix(ee.tileID.toUnwrapped()),Ie=pc(Ce,Me,A.style.sky,z.pitch,x),Be=z.getProjectionData({overscaledTileID:ee.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(S,k.TRIANGLES,Z,bt.disabled,j,qe.backCCW,Ie,fe,Be,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}}function Yd(A,t){if(!t.mesh){const s=new h.aW;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const f=new h.aY;f.emplaceBack(0,1,2),f.emplaceBack(0,2,3),t.mesh=new _r(A.createVertexBuffer(s,Ci.members),A.createIndexBuffer(f),h.aX.simpleSegment(0,0,s.length,f.length))}return t.mesh}class cp{constructor(t,s){this.context=new vc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Zi.maxOverzooming+Zi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xi}resize(t,s,f){if(this.width=Math.floor(t*f),this.height=Math.floor(s*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const t=this.context,s=new h.aW;s.emplaceBack(0,0),s.emplaceBack(h.a5,0),s.emplaceBack(0,h.a5),s.emplaceBack(h.a5,h.a5),this.tileExtentBuffer=t.createVertexBuffer(s,Ci.members),this.tileExtentSegments=h.aX.simpleSegment(0,0,4,2);const f=new h.aW;f.emplaceBack(0,0),f.emplaceBack(h.a5,0),f.emplaceBack(0,h.a5),f.emplaceBack(h.a5,h.a5),this.debugBuffer=t.createVertexBuffer(f,Ci.members),this.debugSegments=h.aX.simpleSegment(0,0,4,5);const x=new h.ch;x.emplaceBack(0,0,0,0),x.emplaceBack(h.a5,0,h.a5,0),x.emplaceBack(0,h.a5,0,h.a5),x.emplaceBack(h.a5,h.a5,h.a5,h.a5),this.rasterBoundsBuffer=t.createVertexBuffer(x,_u.members),this.rasterBoundsSegments=h.aX.simpleSegment(0,0,4,2);const S=new h.aW;S.emplaceBack(0,0),S.emplaceBack(h.a5,0),S.emplaceBack(0,h.a5),S.emplaceBack(h.a5,h.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(S,Ci.members),this.rasterBoundsSegmentsPosOnly=h.aX.simpleSegment(0,0,4,5);const k=new h.aW;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(k,Ci.members),this.viewportSegments=h.aX.simpleSegment(0,0,4,2);const z=new h.ci;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(z);const j=new h.aY;j.emplaceBack(1,0,2),j.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(j);const Z=this.context.gl;this.stencilClearMode=new bt({func:Z.ALWAYS,mask:0},0,255,Z.ZERO,Z.ZERO,Z.ZERO),this.tileExtentMesh=new _r(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=h.N();h.c7(f,0,this.width,this.height,0,0,1),h.Q(f,f,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const x={mainMatrix:f,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:f};this.useProgram("clippingMask",null,!0).draw(t,s.TRIANGLES,Xe.disabled,this.stencilClearMode,cr.disabled,qe.disabled,null,null,x,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,f){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source,this.nextStencilID+s.length>256&&this.clearStencil();const x=this.context;x.setColorMode(cr.disabled),x.setDepthMode(Xe.disabled);const S={};for(const k of s)S[k.key]=this.nextStencilID++;this._renderTileMasks(S,s,f,!0),this._renderTileMasks(S,s,f,!1),this._tileClippingMaskIDs=S}_renderTileMasks(t,s,f,x){const S=this.context,k=S.gl,z=this.style.projection,j=this.transform,Z=this.useProgram("clippingMask");for(const W of s){const ee=t[W.key],J=this.style.map.terrain&&this.style.map.terrain.getTerrainData(W),se=z.getMeshFromTileID(this.context,W.canonical,x,!0,"stencil"),fe=j.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!f,applyTerrainMatrix:!0});Z.draw(S,k.TRIANGLES,Xe.disabled,new bt({func:k.ALWAYS,mask:0},ee,255,k.KEEP,k.KEEP,k.REPLACE),cr.disabled,f?qe.disabled:qe.backCCW,null,J,fe,"$clipping",se.vertexBuffer,se.indexBuffer,se.segments)}}_renderTilesDepthBuffer(){const t=this.context,s=t.gl,f=this.style.projection,x=this.transform,S=this.useProgram("depth"),k=this.getDepthModeFor3D(),z=ni(x,{tileSize:x.tileSize});for(const j of z){const Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j),W=f.getMeshFromTileID(this.context,j.canonical,!0,!0,"raster"),ee=x.getProjectionData({overscaledTileID:j,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(t,s.TRIANGLES,k,bt.disabled,cr.disabled,qe.backCCW,null,Z,ee,"$clipping",W.vertexBuffer,W.indexBuffer,W.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new bt({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new bt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const s=this.context.gl,f=t.sort(((k,z)=>z.overscaledZ-k.overscaledZ)),x=f[f.length-1].overscaledZ,S=f[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const k={};for(let z=0;z<S;z++)k[z+x]=new bt({func:s.GEQUAL,mask:255},z+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=S,[k,f]}return[{[x]:bt.disabled},f]}stencilConfigForOverlapTwoPass(t){const s=this.context.gl,f=t.sort(((k,z)=>z.overscaledZ-k.overscaledZ)),x=f[f.length-1].overscaledZ,S=f[0].overscaledZ-x+1;if(this.clearStencil(),S>1){const k={},z={};for(let j=0;j<S;j++)k[j+x]=new bt({func:s.GREATER,mask:255},S+1+j,255,s.KEEP,s.KEEP,s.REPLACE),z[j+x]=new bt({func:s.GREATER,mask:255},1+j,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*S+1,[k,z,f]}return this.nextStencilID=3,[{[x]:new bt({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[x]:new bt({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new cr([t.CONSTANT_COLOR,t.ONE],new h.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cr.unblended:cr.alphaBlended}getDepthModeForSublayer(t,s,f){if(!this.opaquePassEnabledForLayer())return Xe.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Xe(f||this.context.gl.LEQUAL,s,[x,x])}getDepthModeFor3D(){return new Xe(this.context.gl.LEQUAL,Xe.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){var f,x;this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(me()),this.imageManager.beginFrame();const S=this.style._order,k=this.style.tileManagers,z={},j={},Z={},W={isRenderingToTexture:!1,isRenderingGlobe:((f=t.projection)===null||f===void 0?void 0:f.transitionState)>0};for(const J in k){const se=k[J];se.used&&se.prepare(this.context),z[J]=se.getVisibleCoordinates(!1),j[J]=z[J].slice().reverse(),Z[J]=se.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let J=0;J<S.length;J++)if(this.style._layers[S[J]].is3D()){this.opaquePassCutoff=J;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const J of S){const se=this.style._layers[J];if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;const fe=j[se.source];(se.type==="custom"||fe.length)&&this.renderLayer(this,k[se.source],se,fe,W)}if((x=this.style.projection)===null||x===void 0||x.updateGPUdependent({context:this.context,useProgram:J=>this.useProgram(J)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.bp.black:h.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(J,se){const fe=J.context,Ce=fe.gl,Me=((st,Ve,dt)=>{const Lt=Math.cos(Ve.rollInRadians),Mt=Math.sin(Ve.rollInRadians),Pt=mn(Ve),Ot=Ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:st.properties.get("sky-color"),u_horizon_color:st.properties.get("horizon-color"),u_horizon:[(Ve.width/2-Pt*Mt)*dt,(Ve.height/2+Pt*Lt)*dt],u_horizon_normal:[-Mt,Lt],u_sky_horizon_blend:st.properties.get("sky-horizon-blend")*Ve.height/2*dt,u_sky_blend:Ot}})(se,J.style.map.transform,J.pixelRatio),Ie=new Xe(Ce.LEQUAL,Xe.ReadWrite,[0,1]),Be=bt.disabled,Qe=J.colorModeForRenderPass(),Le=J.useProgram("sky"),$e=Yd(fe,se);Le.draw(fe,Ce.TRIANGLES,Ie,Be,Qe,qe.disabled,Me,null,void 0,"sky",$e.vertexBuffer,$e.indexBuffer,$e.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const J=this.style._layers[S[this.currentLayer]],se=k[J.source],fe=z[J.source];this._renderTileClippingMasks(J,fe,!1),this.renderLayer(this,se,J,fe,W)}this.renderPass="translucent";let ee=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const J=this.style._layers[S[this.currentLayer]],se=k[J.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(J,W))continue;this.opaquePassEnabledForLayer()||ee||(ee=!0,W.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const fe=(J.type==="symbol"?Z:j)[J.source];this._renderTileClippingMasks(J,z[J.source],!!this.renderToTexture),this.renderLayer(this,se,J,fe,W)}if(W.isRenderingGlobe&&(function(J,se,fe){const Ce=J.context,Me=Ce.gl,Ie=J.useProgram("atmosphere"),Be=new Xe(Me.LEQUAL,Xe.ReadOnly,[0,1]),Qe=J.transform,Le=(function(Ot,bn){const vn=Ot.properties.get("position"),on=[-vn.x,-vn.y,-vn.z],Cn=h.ar(new Float64Array(16));return Ot.properties.get("anchor")==="map"&&(h.bg(Cn,Cn,bn.rollInRadians),h.bh(Cn,Cn,-bn.pitchInRadians),h.bg(Cn,Cn,bn.bearingInRadians),h.bh(Cn,Cn,bn.center.lat*Math.PI/180),h.bJ(Cn,Cn,-bn.center.lng*Math.PI/180)),h.cg(on,on,Cn),on})(fe,J.transform),$e=Qe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),st=se.properties.get("atmosphere-blend")*$e.projectionTransition;if(st===0)return;const Ve=wr(Qe.worldSize,Qe.center.lat),dt=Qe.inverseProjectionMatrix,Lt=new Float64Array(4);Lt[3]=1,h.aH(Lt,Lt,Qe.modelViewProjectionMatrix),Lt[0]/=Lt[3],Lt[1]/=Lt[3],Lt[2]/=Lt[3],Lt[3]=1,h.aH(Lt,Lt,dt),Lt[0]/=Lt[3],Lt[1]/=Lt[3],Lt[2]/=Lt[3],Lt[3]=1;const Mt=((Ot,bn,vn,on,Cn)=>({u_sun_pos:Ot,u_atmosphere_blend:bn,u_globe_position:vn,u_globe_radius:on,u_inv_proj_matrix:Cn}))(Le,st,[Lt[0],Lt[1],Lt[2]],Ve,dt),Pt=Yd(Ce,se);Ie.draw(Ce,Me.TRIANGLES,Be,bt.disabled,cr.alphaBlended,qe.disabled,Mt,null,null,"atmosphere",Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const J=(function(se,fe){let Ce=null;const Me=Object.values(se._layers).flatMap((Le=>Le.source&&!Le.isHidden(fe)?[se.tileManagers[Le.source]]:[])),Ie=Me.filter((Le=>Le.getSource().type==="vector")),Be=Me.filter((Le=>Le.getSource().type!=="vector")),Qe=Le=>{(!Ce||Ce.getSource().maxzoom<Le.getSource().maxzoom)&&(Ce=Le)};return Ie.forEach((Le=>Qe(Le))),Ce||Be.forEach((Le=>Qe(Le))),Ce})(this.style,this.transform.zoom);J&&(function(se,fe,Ce){for(let Me=0;Me<Ce.length;Me++)lh(se,fe,Ce[Me])})(this,J,J.getVisibleCoordinates())}this.options.showPadding&&(function(J){const se=J.transform.padding;Eu(J,J.transform.height-(se.top||0),3,Xl),Eu(J,se.bottom||0,3,bl),Wl(J,se.left||0,3,Kh),Wl(J,J.transform.width-(se.right||0),3,Jh);const fe=J.transform.centerPoint;(function(Ce,Me,Ie,Be){Ps(Ce,Me-1,Ie-10,2,20,Be),Ps(Ce,Me-10,Ie-1,20,2,Be)})(J,fe.x,J.transform.height-fe.y,ho)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let x=this.terrainFacilitator.dirty;x||(x=t?!h.cj(s,f):!h.ck(s,f)),x||(x=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),x&&(h.cl(s,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(S,k){const z=S.context,j=z.gl,Z=S.transform,W=cr.unblended,ee=new Xe(j.LEQUAL,Xe.ReadWrite,[0,1]),J=k.tileManager.getRenderableTiles(),se=S.useProgram("terrainDepth");z.bindFramebuffer.set(k.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),z.clear({color:h.bp.transparent,depth:1});for(const fe of J){const Ce=k.getTerrainMesh(fe.tileID),Me=k.getTerrainData(fe.tileID),Ie=Z.getProjectionData({overscaledTileID:fe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Be={u_ele_delta:k.getMeshFrameDelta(Z.zoom)};se.draw(z,j.TRIANGLES,ee,bt.disabled,W,qe.backCCW,Be,Me,Ie,"terrain",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain),(function(S,k){const z=S.context,j=z.gl,Z=S.transform,W=cr.unblended,ee=new Xe(j.LEQUAL,Xe.ReadWrite,[0,1]),J=k.getCoordsTexture(),se=k.tileManager.getRenderableTiles(),fe=S.useProgram("terrainCoords");z.bindFramebuffer.set(k.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),z.clear({color:h.bp.transparent,depth:1}),k.coordsIndex=[];for(const Ce of se){const Me=k.getTerrainMesh(Ce.tileID),Ie=k.getTerrainData(Ce.tileID);z.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,J.texture);const Be={u_terrain_coords_id:(255-k.coordsIndex.length)/255,u_texture:0,u_ele_delta:k.getMeshFrameDelta(Z.zoom)},Qe=Z.getProjectionData({overscaledTileID:Ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});fe.draw(z,j.TRIANGLES,ee,bt.disabled,W,qe.backCCW,Be,Ie,Qe,"terrain",Me.vertexBuffer,Me.indexBuffer,Me.segments),k.coordsIndex.push(Ce.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain))}renderLayer(t,s,f,x,S){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(x||[]).length)&&(this.id=f.id,h.cm(f)?(function(k,z,j,Z,W,ee){if(k.renderPass!=="translucent")return;const{isRenderingToTexture:J}=ee,se=bt.disabled,fe=k.colorModeForRenderPass();(j._unevaluatedLayout.hasValue("text-variable-anchor")||j._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Ce,Me,Ie,Be,Qe,Le,$e,st,Ve){const dt=Me.transform,Lt=Me.style.map.terrain,Mt=Qe==="map",Pt=Le==="map";for(const Ot of Ce){const bn=Be.getTile(Ot),vn=bn.getBucket(Ie);if(!vn||!vn.text||!vn.text.segments.get().length)continue;const on=h.ay(vn.textSizeData,dt.zoom),Cn=h.aN(bn,1,Me.transform.zoom),Ni=$t(Mt,Me.transform,Cn),Sr=Ie.layout.get("icon-text-fit")!=="none"&&vn.hasIconData();if(on){const qr=Math.pow(2,dt.zoom-bn.tileID.overscaledZ),jr=Lt?(es,Rr)=>Lt.getElevation(Ot,es,Rr):null;Gl(vn,Mt,Pt,Ve,dt,Ni,qr,on,Sr,h.aO(dt,bn,$e,st),Ot.toUnwrapped(),jr)}}})(Z,k,j,z,j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),W),j.paint.get("icon-opacity").constantOr(1)!==0&&Hc(k,z,j,Z,!1,j.paint.get("icon-translate"),j.paint.get("icon-translate-anchor"),j.layout.get("icon-rotation-alignment"),j.layout.get("icon-pitch-alignment"),j.layout.get("icon-keep-upright"),se,fe,J),j.paint.get("text-opacity").constantOr(1)!==0&&Hc(k,z,j,Z,!0,j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.layout.get("text-keep-upright"),se,fe,J),z.map.showCollisionBoxes&&(na(k,z,j,Z,!0),na(k,z,j,Z,!1))})(t,s,f,x,this.style.placement.variableOffsets,S):h.cn(f)?(function(k,z,j,Z,W){if(k.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=j.paint.get("circle-opacity"),se=j.paint.get("circle-stroke-width"),fe=j.paint.get("circle-stroke-opacity"),Ce=!j.layout.get("circle-sort-key").isConstant();if(J.constantOr(1)===0&&(se.constantOr(1)===0||fe.constantOr(1)===0))return;const Me=k.context,Ie=Me.gl,Be=k.transform,Qe=k.getDepthModeForSublayer(0,Xe.ReadOnly),Le=bt.disabled,$e=k.colorModeForRenderPass(),st=[],Ve=Be.getCircleRadiusCorrection();for(let dt=0;dt<Z.length;dt++){const Lt=Z[dt],Mt=z.getTile(Lt),Pt=Mt.getBucket(j);if(!Pt)continue;const Ot=j.paint.get("circle-translate"),bn=j.paint.get("circle-translate-anchor"),vn=h.aO(Be,Mt,Ot,bn),on=Pt.programConfigurations.get(j.id),Cn=k.useProgram("circle",on),Ni=Pt.layoutVertexBuffer,Sr=Pt.indexBuffer,qr=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Lt),jr={programConfiguration:on,program:Cn,layoutVertexBuffer:Ni,indexBuffer:Sr,uniformValues:gc(k,Mt,j,vn,Ve),terrainData:qr,projectionData:Be.getProjectionData({overscaledTileID:Lt,applyGlobeMatrix:!ee,applyTerrainMatrix:!0})};if(Ce){const es=Pt.segments.get();for(const Rr of es)st.push({segments:new h.aX([Rr]),sortKey:Rr.sortKey,state:jr})}else st.push({segments:Pt.segments,sortKey:0,state:jr})}Ce&&st.sort(((dt,Lt)=>dt.sortKey-Lt.sortKey));for(const dt of st){const{programConfiguration:Lt,program:Mt,layoutVertexBuffer:Pt,indexBuffer:Ot,uniformValues:bn,terrainData:vn,projectionData:on}=dt.state;Mt.draw(Me,Ie.TRIANGLES,Qe,Le,$e,qe.backCCW,bn,vn,on,j.id,Pt,Ot,dt.segments,j.paint,k.transform.zoom,Lt)}})(t,s,f,x,S):h.co(f)?(function(k,z,j,Z,W){if(j.paint.get("heatmap-opacity")===0)return;const ee=k.context,{isRenderingToTexture:J,isRenderingGlobe:se}=W;if(k.style.map.terrain){for(const fe of Z){const Ce=z.getTile(fe);z.hasRenderableParent(fe)||(k.renderPass==="offscreen"?Wd(k,Ce,j,fe,se):k.renderPass==="translucent"&&ia(k,j,fe,J,se))}ee.viewport.set([0,0,k.width,k.height])}else k.renderPass==="offscreen"?(function(fe,Ce,Me,Ie){const Be=fe.context,Qe=Be.gl,Le=fe.transform,$e=bt.disabled,st=new cr([Qe.ONE,Qe.ONE],h.bp.transparent,[!0,!0,!0,!0]);(function(Ve,dt,Lt){const Mt=Ve.gl;Ve.activeTexture.set(Mt.TEXTURE1),Ve.viewport.set([0,0,dt.width/4,dt.height/4]);let Pt=Lt.heatmapFbos.get(h.cd);Pt?(Mt.bindTexture(Mt.TEXTURE_2D,Pt.colorAttachment.get()),Ve.bindFramebuffer.set(Pt.framebuffer)):(Pt=Fr(Ve,dt.width/4,dt.height/4),Lt.heatmapFbos.set(h.cd,Pt))})(Be,fe,Me),Be.clear({color:h.bp.transparent});for(let Ve=0;Ve<Ie.length;Ve++){const dt=Ie[Ve];if(Ce.hasRenderableParent(dt))continue;const Lt=Ce.getTile(dt),Mt=Lt.getBucket(Me);if(!Mt)continue;const Pt=Mt.programConfigurations.get(Me.id),Ot=fe.useProgram("heatmap",Pt),bn=Le.getProjectionData({overscaledTileID:dt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),vn=Le.getCircleRadiusCorrection();Ot.draw(Be,Qe.TRIANGLES,Xe.disabled,$e,st,qe.backCCW,Va(Lt,Le.zoom,Me.paint.get("heatmap-intensity"),vn),null,bn,Me.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,Me.paint,Le.zoom,Pt)}Be.viewport.set([0,0,fe.width,fe.height])})(k,z,j,Z):k.renderPass==="translucent"&&(function(fe,Ce){const Me=fe.context,Ie=Me.gl;Me.setColorMode(fe.colorModeForRenderPass());const Be=Ce.heatmapFbos.get(h.cd);Be&&(Me.activeTexture.set(Ie.TEXTURE0),Ie.bindTexture(Ie.TEXTURE_2D,Be.colorAttachment.get()),Me.activeTexture.set(Ie.TEXTURE1),tr(Me,Ce).bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),fe.useProgram("heatmapTexture").draw(Me,Ie.TRIANGLES,Xe.disabled,bt.disabled,fe.colorModeForRenderPass(),qe.disabled,sr(fe,Ce,0,1),null,null,Ce.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments,Ce.paint,fe.transform.zoom))})(k,j)})(t,s,f,x,S):h.cp(f)?(function(k,z,j,Z,W){if(k.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=j.paint.get("line-opacity"),se=j.paint.get("line-width");if(J.constantOr(1)===0||se.constantOr(1)===0)return;const fe=k.getDepthModeForSublayer(0,Xe.ReadOnly),Ce=k.colorModeForRenderPass(),Me=j.paint.get("line-dasharray"),Ie=Me.constantOr(1),Be=j.paint.get("line-pattern"),Qe=Be.constantOr(1),Le=j.paint.get("line-gradient"),$e=j.getCrossfadeParameters();let st;st=Qe?"linePattern":Ie&&Le?"lineGradientSDF":Ie?"lineSDF":Le?"lineGradient":"line";const Ve=k.context,dt=Ve.gl,Lt=k.transform;let Mt=!0;for(const Pt of Z){const Ot=z.getTile(Pt);if(Qe&&!Ot.patternsLoaded())continue;const bn=Ot.getBucket(j);if(!bn)continue;const vn=bn.programConfigurations.get(j.id),on=k.context.program.get(),Cn=k.useProgram(st,vn),Ni=Mt||Cn.program!==on,Sr=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Pt),qr=Be.constantOr(null),jr=Me&&Me.constantOr(null);if(qr&&Ot.imageAtlas){const ra=Ot.imageAtlas,_s=ra.patternPositions[qr.to.toString()],bs=ra.patternPositions[qr.from.toString()];_s&&bs&&vn.setConstantPatternPositions(_s,bs)}else if(jr){const ra=j.layout.get("line-cap")==="round",_s=k.lineAtlas.getDash(jr.to,ra),bs=k.lineAtlas.getDash(jr.from,ra);vn.setConstantDashPositions(_s,bs)}const es=Lt.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!ee,applyTerrainMatrix:!0}),Rr=Lt.getPixelScale();let gs;Qe?(gs=w(k,Ot,j,Rr,$e),uo(Ve,dt,Ot,vn,$e)):Ie&&Le?(gs=O(k,Ot,j,Rr,$e,bn.lineClipsArray.length),qa(k,z,Ve,dt,j,bn,Pt,vn,$e)):Ie?(gs=I(k,Ot,j,Rr,$e),fs(k,Ve,dt,vn,Ni,$e)):Le?(gs=v(k,Ot,j,Rr,bn.lineClipsArray.length),Ha(k,z,Ve,dt,j,bn,Pt)):gs=g(k,Ot,j,Rr);const ts=k.stencilModeForClipping(Pt);Cn.draw(Ve,dt.TRIANGLES,fe,ts,Ce,qe.disabled,gs,Sr,es,j.id,bn.layoutVertexBuffer,bn.indexBuffer,bn.segments,j.paint,k.transform.zoom,vn,bn.layoutVertexBuffer2),Mt=!1}})(t,s,f,x,S):h.cq(f)?(function(k,z,j,Z,W){const ee=j.paint.get("fill-color"),J=j.paint.get("fill-opacity");if(J.constantOr(1)===0)return;const{isRenderingToTexture:se}=W,fe=k.colorModeForRenderPass(),Ce=j.paint.get("fill-pattern"),Me=k.opaquePassEnabledForLayer()&&!Ce.constantOr(1)&&ee.constantOr(h.bp.transparent).a===1&&J.constantOr(0)===1?"opaque":"translucent";if(k.renderPass===Me){const Ie=k.getDepthModeForSublayer(1,k.renderPass==="opaque"?Xe.ReadWrite:Xe.ReadOnly);ml(k,z,j,Z,Ie,fe,!1,se)}if(k.renderPass==="translucent"&&j.paint.get("fill-antialias")){const Ie=k.getDepthModeForSublayer(j.getPaintProperty("fill-outline-color")?2:0,Xe.ReadOnly);ml(k,z,j,Z,Ie,fe,!0,se)}})(t,s,f,x,S):h.cr(f)?(function(k,z,j,Z,W){const ee=j.paint.get("fill-extrusion-opacity");if(ee===0)return;const{isRenderingToTexture:J}=W;if(k.renderPass==="translucent"){const se=new Xe(k.context.gl.LEQUAL,Xe.ReadWrite,k.depthRangeFor3D);if(ee!==1||j.paint.get("fill-extrusion-pattern").constantOr(1))yl(k,z,j,Z,se,bt.disabled,cr.disabled,J),yl(k,z,j,Z,se,k.stencilModeFor3D(),k.colorModeForRenderPass(),J);else{const fe=k.colorModeForRenderPass();yl(k,z,j,Z,se,bt.disabled,fe,J)}}})(t,s,f,x,S):h.cs(f)?(function(k,z,j,Z,W){if(k.renderPass!=="offscreen"&&k.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=k.context,se=k.style.projection.useSubdivision,fe=k.getDepthModeForSublayer(0,Xe.ReadOnly),Ce=k.colorModeForRenderPass();if(k.renderPass==="offscreen")(function(Me,Ie,Be,Qe,Le,$e,st){const Ve=Me.context,dt=Ve.gl;for(const Lt of Be){const Mt=Ie.getTile(Lt),Pt=Mt.dem;if(!Pt||!Pt.data||!Mt.needsHillshadePrepare)continue;const Ot=Pt.dim,bn=Pt.stride,vn=Pt.getPixels();if(Ve.activeTexture.set(dt.TEXTURE1),Ve.pixelStoreUnpackPremultiplyAlpha.set(!1),Mt.demTexture=Mt.demTexture||Me.getTileTexture(bn),Mt.demTexture){const Cn=Mt.demTexture;Cn.update(vn,{premultiply:!1}),Cn.bind(dt.NEAREST,dt.CLAMP_TO_EDGE)}else Mt.demTexture=new h.T(Ve,vn,dt.RGBA,{premultiply:!1}),Mt.demTexture.bind(dt.NEAREST,dt.CLAMP_TO_EDGE);Ve.activeTexture.set(dt.TEXTURE0);let on=Mt.fbo;if(!on){const Cn=new h.T(Ve,{width:Ot,height:Ot,data:null},dt.RGBA);Cn.bind(dt.LINEAR,dt.CLAMP_TO_EDGE),on=Mt.fbo=Ve.createFramebuffer(Ot,Ot,!0,!1),on.colorAttachment.set(Cn.texture)}Ve.bindFramebuffer.set(on.framebuffer),Ve.viewport.set([0,0,Ot,Ot]),Me.useProgram("hillshadePrepare").draw(Ve,dt.TRIANGLES,Le,$e,st,qe.disabled,le(Mt.tileID,Pt),null,null,Qe.id,Me.rasterBoundsBuffer,Me.quadTriangleIndexBuffer,Me.rasterBoundsSegments),Mt.needsHillshadePrepare=!1}})(k,z,Z,j,fe,bt.disabled,Ce),J.viewport.set([0,0,k.width,k.height]);else if(k.renderPass==="translucent")if(se){const[Me,Ie,Be]=k.stencilConfigForOverlapTwoPass(Z);xl(k,z,j,Be,Me,fe,Ce,!1,ee),xl(k,z,j,Be,Ie,fe,Ce,!0,ee)}else{const[Me,Ie]=k.getStencilConfigForOverlapAndUpdateStencilID(Z);xl(k,z,j,Ie,Me,fe,Ce,!1,ee)}})(t,s,f,x,S):h.ct(f)?(function(k,z,j,Z,W){if(k.renderPass!=="translucent"||!Z.length)return;const{isRenderingToTexture:ee}=W,J=k.style.projection.useSubdivision,se=k.getDepthModeForSublayer(0,Xe.ReadOnly),fe=k.colorModeForRenderPass();if(J){const[Ce,Me,Ie]=k.stencilConfigForOverlapTwoPass(Z);ql(k,z,j,Ie,Ce,se,fe,!1,ee),ql(k,z,j,Ie,Me,se,fe,!0,ee)}else{const[Ce,Me]=k.getStencilConfigForOverlapAndUpdateStencilID(Z);ql(k,z,j,Me,Ce,se,fe,!1,ee)}})(t,s,f,x,S):h.bU(f)?(function(k,z,j,Z,W){if(k.renderPass!=="translucent"||j.paint.get("raster-opacity")===0||!Z.length)return;const{isRenderingToTexture:ee}=W,J=z.getSource(),se=k.style.projection.useSubdivision;if(J instanceof xr)Io(k,z,j,Z,null,!1,!1,J.tileCoords,J.flippedWindingOrder,ee);else if(se){const[fe,Ce,Me]=k.stencilConfigForOverlapTwoPass(Z);Io(k,z,j,Me,fe,!1,!0,Zl,!1,ee),Io(k,z,j,Me,Ce,!0,!0,Zl,!1,ee)}else{const[fe,Ce]=k.getStencilConfigForOverlapAndUpdateStencilID(Z);Io(k,z,j,Ce,fe,!1,!0,Zl,!1,ee)}})(t,s,f,x,S):h.cu(f)?(function(k,z,j,Z,W){const ee=j.paint.get("background-color"),J=j.paint.get("background-opacity");if(J===0)return;const{isRenderingToTexture:se}=W,fe=k.context,Ce=fe.gl,Me=k.style.projection,Ie=k.transform,Be=Ie.tileSize,Qe=j.paint.get("background-pattern");if(k.isPatternMissing(Qe))return;const Le=!Qe&&ee.a===1&&J===1&&k.opaquePassEnabledForLayer()?"opaque":"translucent";if(k.renderPass!==Le)return;const $e=bt.disabled,st=k.getDepthModeForSublayer(0,Le==="opaque"?Xe.ReadWrite:Xe.ReadOnly),Ve=k.colorModeForRenderPass(),dt=k.useProgram(Qe?"backgroundPattern":"background"),Lt=Z||ni(Ie,{tileSize:Be,terrain:k.style.map.terrain});Qe&&(fe.activeTexture.set(Ce.TEXTURE0),k.imageManager.bind(k.context));const Mt=j.getCrossfadeParameters();for(const Pt of Lt){const Ot=Ie.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!se,applyTerrainMatrix:!0}),bn=Qe?Dt(J,k,Qe,{tileID:Pt,tileSize:Be},Mt):ht(J,ee),vn=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Pt),on=Me.getMeshFromTileID(fe,Pt.canonical,!1,!0,"raster");dt.draw(fe,Ce.TRIANGLES,st,$e,Ve,qe.backCCW,bn,vn,Ot,j.id,on.vertexBuffer,on.indexBuffer,on.segments)}})(t,0,f,x,S):h.cv(f)&&(function(k,z,j,Z){const{isRenderingGlobe:W}=Z,ee=k.context,J=j.implementation,se=k.style.projection,fe=k.transform,Ce=fe.getProjectionDataForCustomLayer(W),Me={farZ:fe.farZ,nearZ:fe.nearZ,fov:fe.fov*Math.PI/180,modelViewProjectionMatrix:fe.modelViewProjectionMatrix,projectionMatrix:fe.projectionMatrix,shaderData:{variantName:se.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${se.shaderPreludeCode.vertexSource}`,define:se.shaderDefine},defaultProjectionData:Ce},Ie=J.renderingMode?J.renderingMode:"2d";if(k.renderPass==="offscreen"){const Be=J.prerender;Be&&(k.setCustomLayerDefaults(),ee.setColorMode(k.colorModeForRenderPass()),Be.call(J,ee.gl,Me),ee.setDirty(),k.setBaseState())}else if(k.renderPass==="translucent"){k.setCustomLayerDefaults(),ee.setColorMode(k.colorModeForRenderPass()),ee.setStencilMode(bt.disabled);const Be=Ie==="3d"?k.getDepthModeFor3D():k.getDepthModeForSublayer(0,Xe.ReadOnly);ee.setDepthMode(Be),J.render(ee.gl,Me),ee.setDirty(),k.setBaseState(),ee.bindFramebuffer.set(null)}})(t,0,f,S))}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),f=this.imageManager.getPattern(t.to.toString());return!s||!f}useProgram(t,s,f=!1,x=[]){this.cache=this.cache||{};const S=!!this.style.map.terrain,k=this.style.projection,z=f?er.projectionMercator:k.shaderPreludeCode,j=f?ji:k.shaderDefine,Z=t+(s?s.cacheKey:"")+`/${f?Ws:k.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(S?"/terrain":"")+(x?`/${x.join("/")}`:"");return this.cache[Z]||(this.cache[Z]=new Fc(this.context,er[t],s,Sn[t],this._showOverdrawInspector,S,z,j,x)),this.cache[Z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,s;if(this._tileTextures){for(const f in this._tileTextures){const x=this._tileTextures[f];if(x)for(const S of x)S.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((s=this.tileExtentMesh.indexBuffer)===null||s===void 0||s.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const f in this.cache){const x=this.cache[f];x&&x.program&&this.context.gl.deleteProgram(x.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}function $d(A,t){let s,f=!1,x=null,S=null;const k=()=>{x=null,f&&(A.apply(S,s),x=setTimeout(k,t),f=!1)};return(...z)=>(f=!0,S=this,s=z,x||k(),x)}class Ts{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let f;return s.split("&").map((x=>x.split("="))).forEach((x=>{x[0]===this._hashName&&(f=x)})),(f&&f[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:f,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const f=s.join("/");let x=f;x.split("&").length>0&&(x=x.split("&")[0]),this._hashName&&(x=`${this._hashName}=${f}`);let S=window.location.hash.replace(x,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let k=window.location.href.replace(/(#.+)?$/,S);k=k.replace("&&","&"),window.history.replaceState(window.history.state,null,k)},this._updateHash=$d(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const s=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,x=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),k=Math.round(s.lng*S)/S,z=Math.round(s.lat*S)/S,j=this._map.getBearing(),Z=this._map.getPitch();let W="";if(W+=t?`/${k}/${z}/${f}`:`${f}/${z}/${k}`,(j||Z)&&(W+="/"+Math.round(10*j)/10),Z&&(W+=`/${Math.round(Z)}`),this._hashName){const ee=this._hashName;let J=!1;const se=window.location.hash.slice(1).split("&").map((fe=>{const Ce=fe.split("=")[0];return Ce===ee?(J=!0,`${Ce}=${W}`):fe})).filter((fe=>fe));return J||se.push(`${ee}=${W}`),`#${se.join("&")}`}return`#${W}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new h.V(+t[2],+t[1])}catch{return!1}const s=+t[0],f=+(t[3]||0),x=+(t[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&f>=-180&&f<=180&&x>=this._map.getMinPitch()&&x<=this._map.getMaxPitch()}}const vl={linearity:.3,easing:h.cw(0,0,.3,1)},Su=h.e({deceleration:2500,maxSpeed:1400},vl),Ca=h.e({deceleration:20,maxSpeed:1400},vl),fo=h.e({deceleration:1e3,maxSpeed:360},vl),qc=h.e({deceleration:1e3,maxSpeed:90},vl),Ta=h.e({deceleration:1e3,maxSpeed:360},vl);class E0{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:me(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=me();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)s.zoom+=S.zoomDelta||0,s.bearing+=S.bearingDelta||0,s.pitch+=S.pitchDelta||0,s.roll+=S.rollDelta||0,S.panDelta&&s.pan._add(S.panDelta),S.around&&(s.around=S.around),S.pinchAround&&(s.pinchAround=S.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(s.pan.mag()){const S=ch(s.pan.mag(),f,h.e({},Su,t||{})),k=s.pan.mult(S.amount/s.pan.mag()),z=this._map.cameraHelper.handlePanInertia(k,this._map.transform);x.center=z.easingCenter,x.offset=z.easingOffset,Cu(x,S)}if(s.zoom){const S=ch(s.zoom,f,Ca);x.zoom=this._map.transform.zoom+S.amount,Cu(x,S)}if(s.bearing){const S=ch(s.bearing,f,fo);x.bearing=this._map.transform.bearing+h.an(S.amount,-179,179),Cu(x,S)}if(s.pitch){const S=ch(s.pitch,f,qc);x.pitch=this._map.transform.pitch+S.amount,Cu(x,S)}if(s.roll){const S=ch(s.roll,f,Ta);x.roll=this._map.transform.roll+h.an(S.amount,-179,179),Cu(x,S)}if(x.zoom||x.bearing){const S=s.pinchAround===void 0?s.around:s.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),h.e(x,{noMoveStart:!0})}}function Cu(A,t){(!A.duration||A.duration<t.duration)&&(A.duration=t.duration,A.easing=t.easing)}function ch(A,t,s){const{maxSpeed:f,linearity:x,deceleration:S}=s,k=h.an(A*x/(t/1e3),-f,f),z=Math.abs(k)/(S*x);return{easing:s.easing,duration:1e3*z,amount:k*(z/2)}}class Js extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f,x={}){f=f instanceof MouseEvent?f:new MouseEvent(t,f);const S=he.mousePos(s.getCanvas(),f),k=s.unproject(S);super(t,h.e({point:S,lngLat:k,originalEvent:f},x)),this._defaultPrevented=!1,this.target=s}}class Xo extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f){const x=t==="touchend"?f.changedTouches:f.touches,S=he.touchPos(s.getCanvasContainer(),x),k=S.map((j=>s.unproject(j))),z=S.reduce(((j,Z,W,ee)=>j.add(Z.div(ee.length))),new h.P(0,0));super(t,{points:S,point:z,lngLats:k,lngLat:s.unproject(z),originalEvent:f}),this._defaultPrevented=!1}}class td extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f){super(t,{originalEvent:f}),this._defaultPrevented=!1}}class nd{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new td(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Js(t.type,this._map,t))}mouseup(t){this._map.fire(new Js(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Js(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Js(t.type,this._map,t))}mouseover(t){this._map.fire(new Js(t.type,this._map,t))}mouseout(t){this._map.fire(new Js(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Xo(t.type,this._map,t))}touchmove(t){this._map.fire(new Xo(t.type,this._map,t))}touchend(t){this._map.fire(new Xo(t.type,this._map,t))}touchcancel(t){this._map.fire(new Xo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class up{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Js(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Js("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Js(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wo{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(h.P.convert(t),this._map.terrain)}}class wc{constructor(t,s){this._map=t,this._tr=new Wo(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(he.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const f=s;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=f,this._box||(this._box=he.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(x.x,f.x),k=Math.max(x.x,f.x),z=Math.min(x.y,f.y),j=Math.max(x.y,f.y);he.setTransform(this._box,`translate(${S}px,${z}px)`),this._box.style.width=k-S+"px",this._box.style.height=j-z+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const f=this._startPos,x=s;if(this.reset(),he.suppressClick(),f.x!==x.x||f.y!==x.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:t})),{cameraAnimation:S=>S.fitScreenCoordinates(f,x,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(he.remove(this._box),this._box=null),he.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new h.l(t,{originalEvent:s}))}}function Za(A,t){if(A.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${A.length}, points ${t.length}`);const s={};for(let f=0;f<A.length;f++)s[A[f].identifier]=t[f];return s}class On{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=(function(x){const S=new h.P(0,0);for(const k of x)S._add(k);return S.div(x.length)})(s),this.touches=Za(f,s)))}touchmove(t,s,f){if(this.aborted||!this.centroid)return;const x=Za(f,s);for(const S in this.touches){const k=x[S];(!k||k.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(t,s,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class uh{constructor(t){this.singleTap=new On(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,f){this.singleTap.touchstart(t,s,f)}touchmove(t,s,f){this.singleTap.touchmove(t,s,f)}touchend(t,s,f){const x=this.singleTap.touchend(t,s,f);if(x){const S=t.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(x)<30;if(S&&k||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class id{constructor(t){this._tr=new Wo(t),this._zoomIn=new uh({numTouches:1,numTaps:2}),this._zoomOut=new uh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,f){this._zoomIn.touchstart(t,s,f),this._zoomOut.touchstart(t,s,f)}touchmove(t,s,f){this._zoomIn.touchmove(t,s,f),this._zoomOut.touchmove(t,s,f)}touchend(t,s,f){const x=this._zoomIn.touchend(t,s,f),S=this._zoomOut.touchend(t,s,f),k=this._tr;return x?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:k.zoom+1,around:k.unproject(x)},{originalEvent:t})}):S?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:k.zoom-1,around:k.unproject(S)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mo{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const x=Array.isArray(s)?s[0]:s;return!this._moved&&x.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=x,this._move(f,x))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&he.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Yo=0,Tu=2,rd={[Yo]:1,[Tu]:2};class wl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=he.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(s,f){const x=rd[f];return s.buttons===void 0||(s.buttons&x)!==x})(t,this._eventButton)}isValidEndEvent(t){return he.mouseButton(t)===this._eventButton}}class Zc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class hh{constructor(t=new wl({checkCorrectEvent:()=>!0}),s=new Zc){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(t,s,f){return t instanceof MouseEvent?s(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?f(t):void 0}startMove(t){this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.startMove(s)),(s=>this.oneFingerTouchMoveStateManager.startMove(s)))}endMove(t){this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.endMove(s)),(s=>this.oneFingerTouchMoveStateManager.endMove(s)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidStartEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidMoveEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidEndEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s)))}}const Al=A=>{A.mousedown=A.dragStart,A.mousemoveWindow=A.dragMove,A.mouseup=A.dragEnd,A.contextmenu=t=>{t.preventDefault()}};class sd{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,s,f){return this._calculateTransform(t,s,f)}touchmove(t,s,f){if(this._active){if(!this._shouldBePrevented(f.length))return t.preventDefault(),this._calculateTransform(t,s,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,s,f){this._calculateTransform(t,s,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,f){f.length>0&&(this._active=!0);const x=Za(f,s),S=new h.P(0,0),k=new h.P(0,0);let z=0;for(const Z in x){const W=x[Z],ee=this._touches[Z];ee&&(S._add(W),k._add(W.sub(ee)),z++,x[Z]=W)}if(this._touches=x,this._shouldBePrevented(z)||!k.mag())return;const j=k.div(z);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(z),panDelta:j}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,f){if(!this._firstTwoTouches)return;t.preventDefault();const[x,S]=this._firstTwoTouches,k=El(f,s,x),z=El(f,s,S);if(!k||!z)return;const j=this._aroundCenter?null:k.add(z).div(2);return this._move([k,z],j,t)}touchend(t,s,f){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,k=El(f,s,x),z=El(f,s,S);k&&z||(this._active&&he.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function El(A,t,s){for(let f=0;f<A.length;f++)if(A[f].identifier===s)return t[f]}function Qd(A,t){return Math.log(A/t)/Math.LN2}class Sl extends dh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Qd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qd(this._distance,f),pinchAround:s}}}function ad(A,t){return 180*A.angleWith(t)/Math.PI}class fh extends dh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,f){const x=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ad(this._vector,x),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,f=ad(t,this._startVector);return Math.abs(f)<s}}function Cl(A){return Math.abs(A.y)>Math.abs(A.x)}class Yl extends dh{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,f){super.touchstart(t,s,f),this._currentTouchCount=f.length}_start(t){this._lastPoints=t,Cl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const x=t[0].sub(this._lastPoints[0]),S=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,S,f.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,f){if(this._valid!==void 0)return this._valid;const x=t.mag()>=2,S=s.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const k=t.y>0==s.y>0;return Cl(t)&&Cl(s)&&k}}const ko={panStep:100,bearingStep:15,pitchStep:10};class Ir{constructor(t){this._tr=new Wo(t);const s=ko;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,f=0,x=0,S=0,k=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),S=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),S=1);break;case 38:t.shiftKey?x=1:(t.preventDefault(),k=-1);break;case 40:t.shiftKey?x=-1:(t.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(f=0,x=0),{cameraAnimation:z=>{const j=this._tr;z.easeTo({duration:300,easeId:"keyboardHandler",easing:Kd,zoom:s?Math.round(j.zoom)+s*(t.shiftKey?2:1):j.zoom,bearing:j.bearing+f*this._bearingStep,pitch:j.pitch+x*this._pitchStep,offset:[-S*this._panStep,-k*this._panStep],center:j.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Kd(A){return A*(2-A)}const $l=4.000244140625,Ac=1/450;class ph{constructor(t,s){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=t,this._tr=new Wo(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ac}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const f=me(),x=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,s!==0&&s%$l==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(x*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=he.mousePos(this._map.getCanvas(),t),f=this._tr;this._aroundPoint=this._aroundCenter?f.transform.locationToScreenPoint(h.V.convert(f.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const z=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=z),typeof this._targetZoom=="number"&&(this._targetZoom+=z)}if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>$l?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&j!==0&&(j=1/j);const Z=typeof this._targetZoom!="number"?t.scale:h.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),h.at(Z*j)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,f=this._startZoom,x=this._easing;let S,k=!1;if(this._type==="wheel"&&f&&x){const z=me()-this._lastWheelEventTime,j=Math.min((z+5)/200,1),Z=x(j);S=h.G.number(f,s,Z),j<1?this._frameId||(this._frameId=!0):k=!0}else S=s,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!k,zoomDelta:S-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=h.cy;if(this._prevEase){const f=this._prevEase,x=(me()-f.start)/f.duration,S=f.easing(x+.01)-f.easing(x),k=.27/Math.sqrt(S*S+1e-4)*.01,z=Math.sqrt(.0729-k*k);s=h.cw(k,z,.25,1)}return this._prevEase={start:me(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class od{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Xc{constructor(t){this._tr=new Wo(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gh{constructor(){this._tap=new uh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,f){if(!this._swipePoint)if(this._tapTime){const x=s[0],S=t.timeStamp-this._tapTime<500,k=this._tapPoint.dist(x)<30;S&&k?f.length>0&&(this._swipePoint=x,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(t,s,f)}touchmove(t,s,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const x=s[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,t.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(t,s,f)}touchend(t,s,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const x=this._tap.touchend(t,s,f);x&&(this._tapTime=t.timeStamp,this._tapPoint=x)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jd{constructor(t,s,f){this._el=t,this._mousePan=s,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class po{constructor(t,s,f,x){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=s,this._mousePitch=f,this._mouseRoll=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Wc{constructor(t,s,f,x){this._el=t,this._touchZoom=s,this._touchRotate=f,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Bn{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=he.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),x=document.createElement("div");x.className="maplibregl-desktop-message",x.textContent=s,this._container.appendChild(x);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=f,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(he.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,s){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:t,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ri=A=>A.zoom||A.drag||A.roll||A.pitch||A.rotate;class No extends h.l{}function Iu(A){return A.panDelta&&A.panDelta.mag()||A.zoomDelta||A.bearingDelta||A.pitchDelta||A.rollDelta}class mh{constructor(t,s){this.handleWindowEvent=x=>{this.handleEvent(x,`${x.type}Window`)},this.handleEvent=(x,S)=>{if(x.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const k=x.type==="renderFrame"?void 0:x,z={needsRenderFrame:!1},j={},Z={};for(const{handlerName:J,handler:se,allowed:fe}of this._handlers){if(!se.isEnabled())continue;let Ce;if(this._blockedByActive(Z,fe,J))se.reset();else if(se[S||x.type]){if(h.cz(x,S||x.type)){const Me=he.mousePos(this._map.getCanvas(),x);Ce=se[S||x.type](x,Me)}else if(h.cA(x,S||x.type)){const Me=this._getMapTouches(x.touches),Ie=he.touchPos(this._map.getCanvas(),Me);Ce=se[S||x.type](x,Ie,Me)}else h.cB(S||x.type)||(Ce=se[S||x.type](x));this.mergeHandlerResult(z,j,Ce,J,k),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()}(Ce||se.isActive())&&(Z[J]=se)}const W={};for(const J in this._previousActiveHandlers)Z[J]||(W[J]=k);this._previousActiveHandlers=Z,(Object.keys(W).length||Iu(z))&&(this._changes.push([z,j,W]),this._triggerRenderFrame()),(Object.keys(Z).length||Iu(z))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=z;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new E0(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,S,k]of this._listeners)he.addEventListener(x,S,x===document?this.handleWindowEvent:this.handleEvent,k)}destroy(){for(const[t,s,f]of this._listeners)he.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(t){const s=this._map,f=s.getCanvasContainer();this._add("mapEvent",new nd(s,t));const x=s.boxZoom=new wc(s,t);this._add("boxZoom",x),t.interactive&&t.boxZoom&&x.enable();const S=s.cooperativeGestures=new Bn(s,t.cooperativeGestures);this._add("cooperativeGestures",S),t.cooperativeGestures&&S.enable();const k=new id(s),z=new Xc(s);s.doubleClickZoom=new od(z,k),this._add("tapZoom",k),this._add("clickZoom",z),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const j=new gh;this._add("tapDragZoom",j);const Z=s.touchPitch=new Yl(s);this._add("touchPitch",Z),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const W=()=>s.project(s.getCenter()),ee=(function({enable:Le,clickTolerance:$e,aroundCenter:st=!0,minPixelCenterThreshold:Ve=100,rotateDegreesPerPixelMoved:dt=.8},Lt){const Mt=new wl({checkCorrectEvent:Pt=>he.mouseButton(Pt)===0&&Pt.ctrlKey||he.mouseButton(Pt)===2&&!Pt.ctrlKey});return new Mo({clickTolerance:$e,move:(Pt,Ot)=>{const bn=Lt();if(st&&Math.abs(bn.y-Pt.y)>Ve)return{bearingDelta:h.cx(new h.P(Pt.x,Ot.y),Ot,bn)};let vn=(Ot.x-Pt.x)*dt;return st&&Ot.y<bn.y&&(vn=-vn),{bearingDelta:vn}},moveStateManager:Mt,enable:Le,assignEvents:Al})})(t,W),J=(function({enable:Le,clickTolerance:$e,pitchDegreesPerPixelMoved:st=-.5}){const Ve=new wl({checkCorrectEvent:dt=>he.mouseButton(dt)===0&&dt.ctrlKey||he.mouseButton(dt)===2});return new Mo({clickTolerance:$e,move:(dt,Lt)=>({pitchDelta:(Lt.y-dt.y)*st}),moveStateManager:Ve,enable:Le,assignEvents:Al})})(t),se=(function({enable:Le,clickTolerance:$e,rollDegreesPerPixelMoved:st=.3},Ve){const dt=new wl({checkCorrectEvent:Lt=>he.mouseButton(Lt)===2&&Lt.ctrlKey});return new Mo({clickTolerance:$e,move:(Lt,Mt)=>{const Pt=Ve();let Ot=(Mt.x-Lt.x)*st;return Mt.y<Pt.y&&(Ot=-Ot),{rollDelta:Ot}},moveStateManager:dt,enable:Le,assignEvents:Al})})(t,W);s.dragRotate=new po(t,ee,J,se),this._add("mouseRotate",ee,["mousePitch"]),this._add("mousePitch",J,["mouseRotate","mouseRoll"]),this._add("mouseRoll",se,["mousePitch"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const fe=(function({enable:Le,clickTolerance:$e}){const st=new wl({checkCorrectEvent:Ve=>he.mouseButton(Ve)===0&&!Ve.ctrlKey});return new Mo({clickTolerance:$e,move:(Ve,dt)=>({around:dt,panDelta:dt.sub(Ve)}),activateOnStart:!0,moveStateManager:st,enable:Le,assignEvents:Al})})(t),Ce=new sd(t,s);s.dragPan=new Jd(f,fe,Ce),this._add("mousePan",fe),this._add("touchPan",Ce,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const Me=new fh,Ie=new Sl;s.touchZoomRotate=new Wc(f,Ie,Me,j),this._add("touchRotate",Me,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new up(s));const Be=s.scrollZoom=new ph(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Be,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const Qe=s.keyboard=new Ir(s);this._add("keyboard",Qe),t.interactive&&t.keyboard&&s.keyboard.enable()}_add(t,s,f){this._handlers.push({handlerName:t,handler:s,allowed:f}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ri(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,f){for(const x in t)if(x!==f&&(!s||s.indexOf(x)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const f of t)this._el.contains(f.target)&&s.push(f);return s}mergeHandlerResult(t,s,f,x,S){if(!f)return;h.e(t,f);const k={handlerName:x,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(s.zoom=k),f.panDelta!==void 0&&(s.drag=k),f.rollDelta!==void 0&&(s.roll=k),f.pitchDelta!==void 0&&(s.pitch=k),f.bearingDelta!==void 0&&(s.rotate=k)}_applyChanges(){const t={},s={},f={};for(const[x,S,k]of this._changes)x.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(x.panDelta)),x.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+x.pitchDelta),x.rollDelta&&(t.rollDelta=(t.rollDelta||0)+x.rollDelta),x.around!==void 0&&(t.around=x.around),x.pinchAround!==void 0&&(t.pinchAround=x.pinchAround),x.noInertia&&(t.noInertia=x.noInertia),h.e(s,S),h.e(f,k);this._updateMapTransform(t,s,f),this._changes=[]}_updateMapTransform(t,s,f){const x=this._map,S=x._getTransformForUpdate(),k=x.terrain;if(!(Iu(t)||k&&this._terrainMovement))return this._fireEvents(s,f,!0);x._stop(!0);let{panDelta:z,zoomDelta:j,bearingDelta:Z,pitchDelta:W,rollDelta:ee,around:J,pinchAround:se}=t;se!==void 0&&(J=se),J=J||x.transform.centerPoint,k&&!S.isPointOnMapSurface(J)&&(J=S.centerPoint);const fe={panDelta:z,zoomDelta:j,rollDelta:ee,pitchDelta:W,bearingDelta:Z,around:J};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(J)&&(J=S.centerPoint);const Ce=J.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(z?J.sub(z):J);this._handleMapControls({terrain:k,tr:S,deltasForHelper:fe,preZoomAroundLoc:Ce,combinedEventsInProgress:s,panDelta:z}),x._applyUpdatedTransform(S),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,f,!0)}_handleMapControls({terrain:t,tr:s,deltasForHelper:f,preZoomAroundLoc:x,combinedEventsInProgress:S,panDelta:k}){const z=this._map.cameraHelper;if(z.handleMapControlsRollPitchBearingZoom(f,s),t)return z.useGlobeControls?(this._terrainMovement||!S.drag&&!S.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void z.handleMapControlsPan(f,s,x)):this._terrainMovement||!S.drag&&!S.zoom?void(S.drag&&this._terrainMovement&&k?s.setCenter(s.screenPointToLocation(s.centerPoint.sub(k))):z.handleMapControlsPan(f,s,x)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void z.handleMapControlsPan(f,s,x));z.handleMapControlsPan(f,s,x)}_fireEvents(t,s,f){const x=ri(this._eventsInProgress),S=ri(t),k={};for(const ee in t){const{originalEvent:J}=t[ee];this._eventsInProgress[ee]||(k[`${ee}start`]=J),this._eventsInProgress[ee]=t[ee]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const ee in k)this._fireEvent(ee,k[ee]);S&&this._fireEvent("move",S.originalEvent);for(const ee in t){const{originalEvent:J}=t[ee];this._fireEvent(ee,J)}const z={};let j;for(const ee in this._eventsInProgress){const{handlerName:J,originalEvent:se}=this._eventsInProgress[ee];this._handlersById[J].isActive()||(delete this._eventsInProgress[ee],j=s[J]||se,z[`${ee}end`]=j)}for(const ee in z)this._fireEvent(ee,z[ee]);const Z=ri(this._eventsInProgress),W=(x||S)&&!Z;if(W&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const ee=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&ee.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(ee)}if(f&&W){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),J=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;!ee||!ee.essential&&we.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:j})),J(this._map.getBearing())&&this._map.resetNorth()):(J(ee.bearing||this._map.getBearing())&&(ee.bearing=0),ee.freezeElevation=!0,this._map.easeTo(ee,{originalEvent:j})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new h.l(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new No("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Is extends h.E{constructor(t,s,f){super(),this._renderFrameCallback=()=>{const x=Math.min((me()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(x)),x<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=f.bearingSnap,this.cameraHelper=s,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,s){t.apply(this.transform),this.transform=t,this.cameraHelper=s}getCenter(){return new h.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,s){return this.jumpTo({elevation:t},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,s,f){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},s),f)}panTo(t,s,f){return this.easeTo(h.e({center:t},s),f)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,f){return this.easeTo(h.e({zoom:t},s),f)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,s){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new h.l("movestart",s)).fire(new h.l("move",s)).fire(new h.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,f){return this.easeTo(h.e({bearing:t},s),f)}resetNorth(t,s){return this.rotateTo(0,h.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}getRoll(){return this.transform.roll}setRoll(t,s){return this.jumpTo({roll:t},s),this}cameraForBounds(t,s){t=qn.convert(t).adjustAntiMeridian();const f=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),f,s)}_cameraForBoxAndBearing(t,s,f,x){const S={top:0,bottom:0,right:0,left:0};if(typeof(x=h.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding=="number"){const Z=x.padding;x.padding={top:Z,bottom:Z,right:Z,left:Z}}const k=h.e(S,x.padding);x.padding=k;const z=this.transform,j=new qn(t,s);return this.cameraHelper.cameraForBoxAndBearing(x,k,j,f,z)}fitBounds(t,s,f){return this._fitInternal(this.cameraForBounds(t,s),s,f)}fitScreenCoordinates(t,s,f,x,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(t)),this.transform.screenPointToLocation(h.P.convert(s)),f,x),x,S)}_fitInternal(t,s,f){return t?(delete(s=h.e(t,s)).padding,s.linear?this.easeTo(s,f):this.flyTo(s,f)):this}jumpTo(t,s){this.stop();const f=this._getTransformForUpdate();let x=!1,S=!1,k=!1;const z=f.zoom;this.cameraHelper.handleJumpToCenterZoom(f,t);const j=f.zoom!==z;return"elevation"in t&&f.elevation!==+t.elevation&&f.setElevation(+t.elevation),"bearing"in t&&f.bearing!==+t.bearing&&(x=!0,f.setBearing(+t.bearing)),"pitch"in t&&f.pitch!==+t.pitch&&(S=!0,f.setPitch(+t.pitch)),"roll"in t&&f.roll!==+t.roll&&(k=!0,f.setRoll(+t.roll)),t.padding==null||f.isPaddingEqual(t.padding)||f.setPadding(t.padding),this._applyUpdatedTransform(f),this.fire(new h.l("movestart",s)).fire(new h.l("move",s)),j&&this.fire(new h.l("zoomstart",s)).fire(new h.l("zoom",s)).fire(new h.l("zoomend",s)),x&&this.fire(new h.l("rotatestart",s)).fire(new h.l("rotate",s)).fire(new h.l("rotateend",s)),S&&this.fire(new h.l("pitchstart",s)).fire(new h.l("pitch",s)).fire(new h.l("pitchend",s)),k&&this.fire(new h.l("rollstart",s)).fire(new h.l("roll",s)).fire(new h.l("rollend",s)),this.fire(new h.l("moveend",s))}calculateCameraOptionsFromTo(t,s,f,x=0){const S=h.a9.fromLngLat(t,s),k=h.a9.fromLngLat(f,x),z=k.x-S.x,j=k.y-S.y,Z=k.z-S.z,W=Math.hypot(z,j,Z);if(W===0)throw new Error("Can't calculate camera options with same From and To");const ee=Math.hypot(z,j),J=h.at(this.transform.cameraToCenterDistance/W/this.transform.tileSize),se=180*Math.atan2(z,-j)/Math.PI;let fe=180*Math.acos(ee/W)/Math.PI;return fe=Z<0?90-fe:90+fe,{center:k.toLngLat(),elevation:x,zoom:J,pitch:fe,bearing:se}}calculateCameraOptionsFromCameraLngLatAltRotation(t,s,f,x,S){const k=this.transform.calculateCenterFromCameraLngLatAlt(t,s,f,x);return{center:k.center,elevation:k.elevation,zoom:k.zoom,bearing:f,pitch:x,roll:S}}easeTo(t,s){this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.cy},t)).animate===!1||!t.essential&&we.prefersReducedMotion)&&(t.duration=0);const f=this._getTransformForUpdate(),x=this.getBearing(),S=f.pitch,k=f.roll,z="bearing"in t?this._normalizeBearing(t.bearing,x):x,j="pitch"in t?+t.pitch:S,Z="roll"in t?this._normalizeBearing(t.roll,k):k,W="padding"in t?t.padding:f.padding,ee=h.P.convert(t.offset);let J,se;t.around&&(J=h.V.convert(t.around),se=f.locationToScreenPoint(J));const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Ce=this.cameraHelper.handleEaseTo(f,{bearing:z,pitch:j,roll:Z,padding:W,around:J,aroundPoint:se,offsetAsPoint:ee,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||x!==z,this._pitching=this._pitching||j!==S,this._rolling=this._rolling||Z!==k,this._padding=!f.isPaddingEqual(W),this._zooming=this._zooming||Ce.isZooming,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,fe),this.terrain&&this._prepareElevation(Ce.elevationCenter),this._ease((Me=>{Ce.easeFunc(Me),this.terrain&&!t.freezeElevation&&this._updateElevation(Me),this._applyUpdatedTransform(f),this._fireMoveEvents(s)}),(Me=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Me)}),t),this}_prepareEase(t,s,f={}){this._moving=!0,s||f.moving||this.fire(new h.l("movestart",t)),this._zooming&&!f.zooming&&this.fire(new h.l("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new h.l("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new h.l("pitchstart",t)),this._rolling&&!f.rolling&&this.fire(new h.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(f-(s-(f*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.setElevation(h.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const s=t.getCameraLngLat(),f=t.getCameraAltitude(),x=this.terrain?this.terrain.getElevationForLngLatZoom(s,t.zoom):0;if(f<x){const S=this.calculateCameraOptionsFromTo(s,x,t.center,t.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(t){const s=[];if(s.push((x=>this._elevateCameraIfInsideTerrain(x))),this.transformCameraUpdate&&s.push((x=>this.transformCameraUpdate(x))),!s.length)return;const f=t.clone();for(const x of s){const S=f.clone(),{center:k,zoom:z,roll:j,pitch:Z,bearing:W,elevation:ee}=x(S);k&&S.setCenter(k),ee!==void 0&&S.setElevation(ee),z!==void 0&&S.setZoom(z),j!==void 0&&S.setRoll(j),Z!==void 0&&S.setPitch(Z),W!==void 0&&S.setBearing(W),f.apply(S)}this.transform.apply(f)}_fireMoveEvents(t){this.fire(new h.l("move",t)),this._zooming&&this.fire(new h.l("zoom",t)),this._rotating&&this.fire(new h.l("rotate",t)),this._pitching&&this.fire(new h.l("pitch",t)),this._rolling&&this.fire(new h.l("roll",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const f=this._zooming,x=this._rotating,S=this._pitching,k=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,f&&this.fire(new h.l("zoomend",t)),x&&this.fire(new h.l("rotateend",t)),S&&this.fire(new h.l("pitchend",t)),k&&this.fire(new h.l("rollend",t)),this.fire(new h.l("moveend",t))}flyTo(t,s){if(!t.essential&&we.prefersReducedMotion){const Ot=h.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ot,s)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.cy},t);const f=this._getTransformForUpdate(),x=f.bearing,S=f.pitch,k=f.roll,z=f.padding,j="bearing"in t?this._normalizeBearing(t.bearing,x):x,Z="pitch"in t?+t.pitch:S,W="roll"in t?this._normalizeBearing(t.roll,k):k,ee="padding"in t?t.padding:f.padding,J=h.P.convert(t.offset);let se=f.centerPoint.add(J);const fe=f.screenPointToLocation(se),Ce=this.cameraHelper.handleFlyTo(f,{bearing:j,pitch:Z,roll:W,padding:ee,locationAtOffset:fe,offsetAsPoint:J,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Me=t.curve;const Ie=Math.max(f.width,f.height),Be=Ie/Ce.scaleOfZoom,Qe=Ce.pixelPathLength;typeof Ce.scaleOfMinZoom=="number"&&(Me=Math.sqrt(Ie/Ce.scaleOfMinZoom/Qe*2));const Le=Me*Me;function $e(Ot){const bn=(Be*Be-Ie*Ie+(Ot?-1:1)*Le*Le*Qe*Qe)/(2*(Ot?Be:Ie)*Le*Qe);return Math.log(Math.sqrt(bn*bn+1)-bn)}function st(Ot){return(Math.exp(Ot)-Math.exp(-Ot))/2}function Ve(Ot){return(Math.exp(Ot)+Math.exp(-Ot))/2}const dt=$e(!1);let Lt=function(Ot){return Ve(dt)/Ve(dt+Me*Ot)},Mt=function(Ot){return Ie*((Ve(dt)*(st(bn=dt+Me*Ot)/Ve(bn))-st(dt))/Le)/Qe;var bn},Pt=($e(!0)-dt)/Me;if(Math.abs(Qe)<2e-6||!isFinite(Pt)){if(Math.abs(Ie-Be)<1e-6)return this.easeTo(t,s);const Ot=Be<Ie?-1:1;Pt=Math.abs(Math.log(Be/Ie))/Me,Mt=()=>0,Lt=bn=>Math.exp(Ot*Me*bn)}return t.duration="duration"in t?+t.duration:1e3*Pt/("screenSpeed"in t?+t.screenSpeed/Me:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=x!==j,this._pitching=Z!==S,this._rolling=W!==k,this._padding=!f.isPaddingEqual(ee),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(Ce.targetCenter),this._ease((Ot=>{const bn=Ot*Pt,vn=1/Lt(bn),on=Mt(bn);this._rotating&&f.setBearing(h.G.number(x,j,Ot)),this._pitching&&f.setPitch(h.G.number(S,Z,Ot)),this._rolling&&f.setRoll(h.G.number(k,W,Ot)),this._padding&&(f.interpolatePadding(z,ee,Ot),se=f.centerPoint.add(J)),Ce.easeFunc(Ot,vn,on,se),this.terrain&&!t.freezeElevation&&this._updateElevation(Ot),this._applyUpdatedTransform(f),this._fireMoveEvents(s)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,s)}return t||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(t,s,f){f.animate===!1||f.duration===0?(t(1),s()):(this._easeStart=me(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=h.W(t,-180,180);const f=Math.abs(t-s);return Math.abs(t-360-s)<f&&(t-=360),Math.abs(t+360-s)<f&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(h.V.convert(t),this.transform):null}}const ps={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xs{constructor(t=ps){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=he.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=he.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const f=this._map._getUIString(`AttributionControl.${s}`);t.title=f,t.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((x=>typeof x!="string"?"":x))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const s=this._map.style.tileManagers;for(const x in s){const S=s[x];if(S.used||S.usedForTerrain){const k=S.getSource();k.attribution&&t.indexOf(k.attribution)<0&&t.push(k.attribution)}}t=t.filter((x=>String(x).trim())),t.sort(((x,S)=>x.length-S.length)),t=t.filter(((x,S)=>{for(let k=S+1;k<t.length;k++)if(t[k].indexOf(x)>=0)return!1;return!0}));const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=he.sanitize(f),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yh{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const f=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=he.create("div","maplibregl-ctrl");const s=he.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){he.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ql{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,f=s?this._queue.concat(s):this._queue;for(const x of f)if(x.id===t)return void(x.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const f of s)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Gi=h.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Er extends h.E{constructor(t){super(),this._lastTilesetChange=me(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,s){this.tileManager.update(t,s),this._renderableTilesKeys=[];const f={};for(const x of ni(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.tileManager._source.calculateTileZoom}))f[x.key]=!0,this._renderableTilesKeys.push(x.key),this._tiles[x.key]||(x.terrainRttPosMatrix32f=new Float64Array(16),h.c7(x.terrainRttPosMatrix32f,0,h.a5,h.a5,0,0,1),this._tiles[x.key]=new yt(x,this.tileSize),this._lastTilesetChange=me());for(const x in this._tiles)f[x]||delete this._tiles[x]}freeRtt(t){for(const s in this._tiles){const f=this._tiles[s];(!t||f.tileID.equals(t)||f.tileID.isChildOf(t)||t.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,s){return s?this._getTerrainCoordsForTileRanges(t,s):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const s={};for(const f of this._renderableTilesKeys){const x=this._tiles[f].tileID,S=t.clone(),k=h.bk();if(x.canonical.equals(t.canonical))h.c7(k,0,h.a5,h.a5,0,0,1);else if(x.canonical.isChildOf(t.canonical)){const z=x.canonical.z-t.canonical.z,j=x.canonical.x-(x.canonical.x>>z<<z),Z=x.canonical.y-(x.canonical.y>>z<<z),W=h.a5>>z;h.c7(k,0,W,W,0,0,1),h.O(k,k,[-j*W,-Z*W,0])}else{if(!t.canonical.isChildOf(x.canonical))continue;{const z=t.canonical.z-x.canonical.z,j=t.canonical.x-(t.canonical.x>>z<<z),Z=t.canonical.y-(t.canonical.y>>z<<z),W=h.a5>>z;h.c7(k,0,h.a5,h.a5,0,0,1),h.O(k,k,[j*W,Z*W,0]),h.Q(k,k,[1/2**z,1/2**z,0])}}S.terrainRttPosMatrix32f=new Float32Array(k),s[f]=S}return s}_getTerrainCoordsForTileRanges(t,s){const f={};for(const x of this._renderableTilesKeys){const S=this._tiles[x].tileID;if(!this._isWithinTileRanges(S,s))continue;const k=t.clone(),z=h.bk();if(S.canonical.z===t.canonical.z){const j=t.canonical.x-S.canonical.x,Z=t.canonical.y-S.canonical.y;h.c7(z,0,h.a5,h.a5,0,0,1),h.O(z,z,[j*h.a5,Z*h.a5,0])}else if(S.canonical.z>t.canonical.z){const j=S.canonical.z-t.canonical.z,Z=S.canonical.x-(S.canonical.x>>j<<j),W=S.canonical.y-(S.canonical.y>>j<<j),ee=t.canonical.x-(S.canonical.x>>j),J=t.canonical.y-(S.canonical.y>>j),se=h.a5>>j;h.c7(z,0,se,se,0,0,1),h.O(z,z,[-Z*se+ee*h.a5,-W*se+J*h.a5,0])}else{const j=t.canonical.z-S.canonical.z,Z=t.canonical.x-(t.canonical.x>>j<<j),W=t.canonical.y-(t.canonical.y>>j<<j),ee=(t.canonical.x>>j)-S.canonical.x,J=(t.canonical.y>>j)-S.canonical.y,se=h.a5<<j;h.c7(z,0,se,se,0,0,1),h.O(z,z,[Z*h.a5+ee*se,W*h.a5+J*se,0])}k.terrainRttPosMatrix32f=new Float32Array(z),f[x]=k}return f}getSourceTile(t,s){const f=this.tileManager._source;let x=t.overscaledZ-this.deltaZoom;if(x>f.maxzoom&&(x=f.maxzoom),x<f.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(x).key);let S=this.findTileInCaches(this._sourceTileCache[t.key]);if(!S?.dem&&s)for(;x>=f.minzoom&&!S?.dem;)S=this.findTileInCaches(t.scaledTo(x--).key);return S}findTileInCaches(t){let s=this.tileManager.getTileByID(t);return s||(s=this.tileManager._outOfViewCache.getByKey(t),s)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,s){return s[t.canonical.z]&&t.canonical.x>=s[t.canonical.z].minTileX&&t.canonical.x<=s[t.canonical.z].maxTileX&&t.canonical.y>=s[t.canonical.z].minTileY&&t.canonical.y<=s[t.canonical.z].maxTileY}}class Vi{constructor(t,s,f){this._meshCache={},this.painter=t,this.tileManager=new Er(s),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,f,x=h.a5){var S;if(!(s>=0&&s<x&&f>=0&&f<x))return 0;const k=this.getTerrainData(t),z=(S=k.tile)===null||S===void 0?void 0:S.dem;if(!z)return 0;const j=h.cC([],[s/x*h.a5,f/x*h.a5],k.u_terrain_matrix),Z=[j[0]*z.dim,j[1]*z.dim],W=Math.floor(Z[0]),ee=Math.floor(Z[1]),J=Z[0]-W,se=Z[1]-ee;return z.get(W,ee)*(1-J)*(1-se)+z.get(W+1,ee)*J*(1-se)+z.get(W,ee+1)*(1-J)*se+z.get(W+1,ee+1)*J*se}getElevationForLngLatZoom(t,s){if(!h.cD(s,t.wrap()))return 0;const{tileID:f,mercatorX:x,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(f,x%h.a5,S%h.a5,h.a5)}getElevationForLngLat(t,s){const f=ni(s,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let x=0;for(const S of f)S.canonical.z>x&&(x=Math.min(S.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,x)}getElevation(t,s,f,x=h.a5){return this.getDEMElevation(t,s,f,x)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const x=this.painter.context,S=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new h.T(x,S,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new h.T(x,new h.R({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ar([])}const s=this.tileManager.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const x=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new h.T(x,s.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),s.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const f=s&&s.toString()+s.tileID.key+t.key;if(f&&!this._demMatrixCache[f]){const x=this.tileManager.getSource().maxzoom;let S=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=x?S=t.canonical.z-x:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const k=t.canonical.x-(t.canonical.x>>S<<S),z=t.canonical.y-(t.canonical.y>>S<<S),j=h.cE(new Float64Array(16),[1/(h.a5<<S),1/(h.a5<<S),0]);h.O(j,j,[k*h.a5,z*h.a5,0]),this._demMatrixCache[t.key]={matrix:j,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,f=s.width/devicePixelRatio,x=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new h.T(s.context,{width:f,height:x,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new h.T(s.context,{width:f,height:x,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(f,x,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,f,x))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,k=0;S<this._coordsTextureSize;S++)for(let z=0;z<this._coordsTextureSize;z++,k+=4)s[k+0]=255&z,s[k+1]=255&S,s[k+2]=z>>8<<4|S>>8,s[k+3]=0;const f=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),x=new h.T(t,f,t.gl.RGBA,{premultiply:!1});return x.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),f=this.painter.context,x=f.gl,S=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),k=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),z=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(S,z-k-1,1,1,x.RGBA,x.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null);const j=s[0]+(s[2]>>4<<8),Z=s[1]+((15&s[2])<<8),W=this.coordsIndex[255-s[3]],ee=W&&this.tileManager.getTileByID(W);if(!ee)return null;const J=this._coordsTextureSize,se=(1<<ee.tileID.canonical.z)*J;return new h.a9((ee.tileID.canonical.x*J+j)/se+ee.tileID.wrap,(ee.tileID.canonical.y*J+Z)/se,this.getElevation(ee.tileID,j,Z,J))}depthAtPoint(t){const s=new Uint8Array(4),f=this.painter.context,x=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),x.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(t){var s;const f=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,x=f&&t.canonical.y===0,S=f&&t.canonical.y===(1<<t.canonical.z)-1,k=`m_${x?"n":""}_${S?"s":""}`;if(this._meshCache[k])return this._meshCache[k];const z=this.painter.context,j=new h.cF,Z=new h.aY,W=this.meshSize,ee=h.a5/W,J=W*W;for(let Ve=0;Ve<=W;Ve++)for(let dt=0;dt<=W;dt++)j.emplaceBack(dt*ee,Ve*ee,0);for(let Ve=0;Ve<J;Ve+=W+1)for(let dt=0;dt<W;dt++)Z.emplaceBack(dt+Ve,W+dt+Ve+1,W+dt+Ve+2),Z.emplaceBack(dt+Ve,W+dt+Ve+2,dt+Ve+1);const se=j.length,fe=se+(W+1),Ce=(W+1)*W,Me=x?h.br:0,Ie=x?0:1,Be=S?h.bs:h.a5,Qe=S?0:1;for(let Ve=0;Ve<=W;Ve++)j.emplaceBack(Ve*ee,Me,Ie);for(let Ve=0;Ve<=W;Ve++)j.emplaceBack(Ve*ee,Be,Qe);for(let Ve=0;Ve<W;Ve++)Z.emplaceBack(Ce+Ve,fe+Ve,fe+Ve+1),Z.emplaceBack(Ce+Ve,fe+Ve+1,Ce+Ve+1),Z.emplaceBack(0+Ve,se+Ve+1,se+Ve),Z.emplaceBack(0+Ve,0+Ve+1,se+Ve+1);const Le=j.length,$e=Le+2*(W+1);for(const Ve of[0,1])for(let dt=0;dt<=W;dt++)for(const Lt of[0,1])j.emplaceBack(Ve*h.a5,dt*ee,Lt);for(let Ve=0;Ve<2*W;Ve+=2)Z.emplaceBack(Le+Ve,Le+Ve+1,Le+Ve+3),Z.emplaceBack(Le+Ve,Le+Ve+3,Le+Ve+2),Z.emplaceBack($e+Ve,$e+Ve+3,$e+Ve+1),Z.emplaceBack($e+Ve,$e+Ve+2,$e+Ve+3);const st=new _r(z.createVertexBuffer(j,Gi.members),z.createIndexBuffer(Z),h.aX.simpleSegment(0,0,j.length,Z.length));return this._meshCache[k]=st,st}getMeshFrameDelta(t){return 2*Math.PI*h.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,s){var f;if(!h.cD(s,t.wrap()))return 0;const{tileID:x}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(f=this.getMinMaxElevation(x).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,f={minElevation:null,maxElevation:null};return s&&s.dem&&(f.minElevation=s.dem.min*this.exaggeration,f.maxElevation=s.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(t,s){const f=h.a9.fromLngLat(t.wrap()),x=(1<<s)*h.a5,S=f.x*x,k=f.y*x,z=Math.floor(S/h.a5),j=Math.floor(k/h.a5);return{tileID:new h.a2(s,0,s,z,j),mercatorX:S,mercatorY:k}}}class as{constructor(t,s,f){this._context=t,this._size=s,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new h.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(f.texture),{id:t,fbo:s,texture:f,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>t.id!==s)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Do={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class $o{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new as(t.context,30,s.tileManager.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((f=>!t._layers[f].isHidden(s))),this._coordsAscending={};for(const f in t.tileManagers){this._coordsAscending[f]={};const x=t.tileManagers[f].getVisibleCoordinates(),S=t.tileManagers[f].getSource(),k=S instanceof xr?S.terrainTileRanges:null;for(const z of x){const j=this.terrain.tileManager.getTerrainCoords(z,k);for(const Z in j)this._coordsAscending[f][Z]||(this._coordsAscending[f][Z]=[]),this._coordsAscending[f][Z].push(j[Z])}}this._coordsAscendingStr={};for(const f of t._order){const x=t._layers[f],S=x.source;if(Do[x.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(const k in this._coordsAscending[S])this._coordsAscendingStr[S][k]=this._coordsAscending[S][k].map((z=>z.key)).sort().join()}}for(const f of this._renderableTiles)for(const x in this._coordsAscendingStr){const S=this._coordsAscendingStr[x][f.tileID.key];S&&S!==f.rttCoords[x]&&(f.rtt=[])}}renderLayer(t,s){if(t.isHidden(this.painter.transform.zoom))return!1;const f=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),x=t.type,S=this.painter,k=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Do[x]&&(this._prevType&&Do[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(t.id),!k))return!0;if(Do[this._prevType]||Do[x]&&k){this._prevType=x;const z=this._stacks.length-1,j=this._stacks[z]||[];for(const Z of this._renderableTiles){if(this.pool.isFull()&&(ed(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Z),Z.rtt[z]){const ee=this.pool.getObjectForId(Z.rtt[z].id);if(ee.stamp===Z.rtt[z].stamp){this.pool.useObject(ee);continue}}const W=this.pool.getOrCreateFreeObject();this.pool.useObject(W),this.pool.stampObject(W),Z.rtt[z]={id:W.id,stamp:W.stamp},S.context.bindFramebuffer.set(W.fbo.framebuffer),S.context.clear({color:h.bp.transparent,stencil:0}),S.currentStencilSource=void 0;for(let ee=0;ee<j.length;ee++){const J=S.style._layers[j[ee]],se=J.source?this._coordsAscending[J.source][Z.tileID.key]:[Z.tileID];S.context.viewport.set([0,0,W.fbo.width,W.fbo.height]),S._renderTileClippingMasks(J,se,!0),S.renderLayer(S,S.style.tileManagers[J.source],J,se,f),J.source&&(Z.rttCoords[J.source]=this._coordsAscendingStr[J.source][Z.tileID.key])}}return ed(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects(),Do[x]}return!1}}const Yc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},$c=U,Kl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ps,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},ef={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Jr{constructor(t,s,f=!1){this.mousedown=S=>{this.startMove(S,he.mousePos(this.element,S)),he.addEventListener(window,"mousemove",this.mousemove),he.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,he.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHandler.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=he.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),he.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=he.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const x=new hh;this._rotatePitchHandler=new Mo({clickTolerance:3,move:(S,k)=>{const z=s.getBoundingClientRect(),j=new h.P((z.bottom-z.top)/2,(z.right-z.left)/2);return{bearingDelta:h.cx(new h.P(S.x,k.y),k,j),pitchDelta:f?-.5*(k.y-S.y):void 0}},moveStateManager:x,enable:!0,assignEvents:()=>{}}),this.map=t,he.addEventListener(s,"mousedown",this.mousedown),he.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),he.addEventListener(s,"touchcancel",this.reset)}startMove(t,s){this._rotatePitchHandler.dragStart(t,s),he.disableDrag()}move(t,s){const f=this.map,{bearingDelta:x,pitchDelta:S}=this._rotatePitchHandler.dragMove(t,s)||{};x&&f.setBearing(f.getBearing()+x),S&&f.setPitch(f.getPitch()+S)}off(){const t=this.element;he.removeEventListener(t,"mousedown",this.mousedown),he.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend),he.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){he.enableDrag(),he.removeEventListener(window,"mousemove",this.mousemove),he.removeEventListener(window,"mouseup",this.mouseup),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend)}}let Qo;function Mu(A,t,s,f=!1){if(f||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return A?.wrap();const x=new h.V(A.lng,A.lat);if(A=new h.V(A.lng,A.lat),t){const S=new h.V(A.lng-360,A.lat),k=new h.V(A.lng+360,A.lat),z=s.locationToScreenPoint(A).distSqr(t);s.locationToScreenPoint(S).distSqr(t)<z?A=S:s.locationToScreenPoint(k).distSqr(t)<z&&(A=k)}for(;Math.abs(A.lng-s.center.lng)>180;){const S=s.locationToScreenPoint(A);if(S.x>=0&&S.y>=0&&S.x<=s.width&&S.y<=s.height)break;A.lng>s.center.lng?A.lng-=360:A.lng+=360}return A.lng!==x.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(A))?A:x}const ku={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xh(A,t,s){const f=A.classList;for(const x in ku)f.remove(`maplibregl-${s}-anchor-${x}`);f.add(`maplibregl-${s}-anchor-${t}`)}class _h extends h.E{constructor(t){if(super(),this._onKeyPress=s=>{const f=s.code,x=s.charCode||s.keyCode;f!=="Space"&&f!=="Enter"&&x!==32&&x!==13||this.togglePopup()},this._onMapClick=s=>{const f=s.originalEvent.target,x=this._element;this._popup&&(f===x||x.contains(f))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=Mu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),he.setTransform(this._element,`${ku[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${x}`),we.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=he.create("div");const s=he.createNS("http://www.w3.org/2000/svg","svg"),f=41,x=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${f}px`),s.setAttributeNS(null,"width",`${x}px`),s.setAttributeNS(null,"viewBox",`0 0 ${x} ${f}`);const S=he.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const k=he.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill-rule","nonzero");const z=he.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ie of j){const Be=he.createNS("http://www.w3.org/2000/svg","ellipse");Be.setAttributeNS(null,"opacity","0.04"),Be.setAttributeNS(null,"cx","10.5"),Be.setAttributeNS(null,"cy","5.80029008"),Be.setAttributeNS(null,"rx",Ie.rx),Be.setAttributeNS(null,"ry",Ie.ry),z.appendChild(Be)}const Z=he.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const W=he.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(W);const ee=he.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"fill","#000000");const J=he.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ee.appendChild(J);const se=he.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),se.setAttributeNS(null,"fill","#FFFFFF");const fe=he.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ce=he.createNS("http://www.w3.org/2000/svg","circle");Ce.setAttributeNS(null,"fill","#000000"),Ce.setAttributeNS(null,"opacity","0.25"),Ce.setAttributeNS(null,"cx","5.5"),Ce.setAttributeNS(null,"cy","5.5"),Ce.setAttributeNS(null,"r","5.4999962");const Me=he.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#FFFFFF"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962"),fe.appendChild(Ce),fe.appendChild(Me),k.appendChild(z),k.appendChild(Z),k.appendChild(ee),k.appendChild(se),k.appendChild(fe),s.appendChild(k),s.setAttributeNS(null,"height",f*this._scale+"px"),s.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),xh(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),he.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const x=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,f;const x=(s=this._map)===null||s===void 0?void 0:s.terrain,S=this._map.transform.isLocationOccluded(this._lngLat);if(!x||S){const se=S?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==se&&(this._element.style.opacity=se))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const k=this._map,z=k.terrain.depthAtPoint(this._pos),j=k.terrain.getElevationForLngLat(this._lngLat,k.transform);if(k.transform.lngLatToCameraDepth(this._lngLat,j)-z<.006)return void(this._element.style.opacity=this._opacity);const Z=-this._offset.y/k.transform.pixelsPerMeter,W=Math.sin(k.getPitch()*Math.PI/180)*Z,ee=k.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),J=k.transform.lngLatToCameraDepth(this._lngLat,j+W)-ee>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&J&&this._popup.remove(),this._element.style.opacity=J?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return(this._opacity===void 0||t===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const bh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ec=0,Jl=!1;const _a={maxWidth:100,unit:"metric"};function os(A,t,s){const f=s&&s.maxWidth||100,x=A._container.clientHeight/2,S=A._container.clientWidth/2,k=A.unproject([S-f/2,x]),z=A.unproject([S+f/2,x]),j=Math.round(A.project(z).x-A.project(k).x),Z=Math.min(f,j,A._container.clientWidth),W=k.distanceTo(z);if(s&&s.unit==="imperial"){const ee=3.2808*W;ee>5280?Tl(t,Z,ee/5280,A._getUIString("ScaleControl.Miles")):Tl(t,Z,ee,A._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Tl(t,Z,W/1852,A._getUIString("ScaleControl.NauticalMiles")):W>=1e3?Tl(t,Z,W/1e3,A._getUIString("ScaleControl.Kilometers")):Tl(t,Z,W,A._getUIString("ScaleControl.Meters"))}function Tl(A,t,s,f){const x=(function(S){const k=Math.pow(10,`${Math.floor(S)}`.length-1);let z=S/k;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:(function(j){const Z=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*Z)/Z})(z),k*z})(s);A.style.width=t*(x/s)+"px",A.innerHTML=`${x}&nbsp;${f}`}const Qc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Kc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(A){if(A){if(typeof A=="number"){const t=Math.round(Math.abs(A)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,A),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-A),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(A,0),right:new h.P(-A,0)}}if(A instanceof h.P||Array.isArray(A)){const t=h.P.convert(A);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(A.center||[0,0]),top:h.P.convert(A.top||[0,0]),"top-left":h.P.convert(A["top-left"]||[0,0]),"top-right":h.P.convert(A["top-right"]||[0,0]),bottom:h.P.convert(A.bottom||[0,0]),"bottom-left":h.P.convert(A["bottom-left"]||[0,0]),"bottom-right":h.P.convert(A["bottom-right"]||[0,0]),left:h.P.convert(A.left||[0,0]),right:h.P.convert(A.right||[0,0])}}return Nu(new h.P(0,0))}const Ko=U;N.AJAXError=h.cI,N.Event=h.l,N.Evented=h.E,N.LngLat=h.V,N.MercatorCoordinate=h.a9,N.Point=h.P,N.addProtocol=h.cJ,N.config=h.c,N.removeProtocol=h.cK,N.AttributionControl=xs,N.BoxZoomHandler=wc,N.CanvasSource=oe,N.CooperativeGesturesHandler=Bn,N.DoubleClickZoomHandler=od,N.DragPanHandler=Jd,N.DragRotateHandler=po,N.EdgeInsets=Ys,N.FullscreenControl=class extends h.E{constructor(A={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,A&&A.container&&(A.container instanceof HTMLElement?this._container=A.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(A){return this._map=A,this._container||(this._container=this._map.getContainer()),this._controlContainer=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){he.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const A=this._fullscreenButton=he.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);he.create("span","maplibregl-ctrl-icon",A).setAttribute("aria-hidden","true"),A.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const A=this._getTitle();this._fullscreenButton.setAttribute("aria-label",A),this._fullscreenButton.title=A}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},N.GeoJSONSource=Pi,N.GeolocateControl=class extends h.E{constructor(A){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new h.V(t.coords.longitude,t.coords.latitude),f=t.coords.accuracy,x=this._map.getBearing(),S=h.e({bearing:x},this.options.fitBoundsOptions),k=qn.fromLngLat(s,f);this._map.fitBounds(k,S,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new h.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Jl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=he.create("button","maplibregl-ctrl-geolocate",this._container),he.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new _h({element:this._dotElement}),this._circleElement=he.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _h({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{const f=s?.[0]instanceof ResizeObserverEntry;s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))}))}},this.options=h.e({},bh,A)}onAdd(A){return this._map=A,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(t=!1){if(Qo!==void 0&&!t)return Qo;if(window.navigator.permissions===void 0)return Qo=!!window.navigator.geolocation,Qo;try{Qo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Qo=!!window.navigator.geolocation}return Qo}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),he.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ec=0,Jl=!1}_isOutOfMapMaxBounds(A){const t=this._map.getMaxBounds(),s=A.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const A=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&A))return;const t=this._map.project(A),s=this._map.unproject([t.x+100,t.y]),f=A.distanceTo(s)/100,x=2*this._accuracy/f;this._circleElement.style.width=`${x.toFixed(2)}px`,this._circleElement.style.height=`${x.toFixed(2)}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ec--,Jl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let A;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ec++,Ec>1?(A={maximumAge:6e5,timeout:0},Jl=!0):(A=this.options.positionOptions,Jl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,A)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},N.GlobeControl=class{constructor(){this._toggleProjection=()=>{var A;const t=(A=this._map.getProjection())===null||A===void 0?void 0:A.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var A;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((A=this._map.getProjection())===null||A===void 0?void 0:A.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(A){return this._map=A,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=he.create("button","maplibregl-ctrl-globe",this._container),he.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},N.Hash=Ts,N.ImageSource=xr,N.KeyboardHandler=Ir,N.LngLatBounds=qn,N.LogoControl=yh,N.Map=class extends Is{constructor(A){var t,s;h.cG.mark(h.cH.create);const f=Object.assign(Object.assign(Object.assign({},Kl),A),{canvasContextAttributes:Object.assign(Object.assign({},Kl.canvasContextAttributes),A.canvasContextAttributes)});if(f.minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const x=new Dr,S=new So;if(f.minZoom!==void 0&&x.setMinZoom(f.minZoom),f.maxZoom!==void 0&&x.setMaxZoom(f.maxZoom),f.minPitch!==void 0&&x.setMinPitch(f.minPitch),f.maxPitch!==void 0&&x.setMaxPitch(f.maxPitch),f.renderWorldCopies!==void 0&&x.setRenderWorldCopies(f.renderWorldCopies),f.transformConstrain!==null&&x.setConstrainOverride(f.transformConstrain),super(x,S,{bearingSnap:f.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ql,this._controls=[],this._mapId=h.af(),this._lostContextStyle={style:null,images:null},this._contextLost=z=>{z.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const j of Object.values(this.style._layers))if(j.type==="custom"&&console.warn(`Custom layer with id '${j.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),j._listeners)for(const[Z]of Object.entries(j._listeners))console.warn(`Custom layer with id '${j.id}' had event listeners for event '${Z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new h.l("webglcontextlost",{originalEvent:z}))},this._contextRestored=z=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new h.l("webglcontextrestored",{originalEvent:z}))},this._onMapScroll=z=>{if(z.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},f.canvasContextAttributes),this._trackResize=f.trackResize===!0,this._bearingSnap=f.bearingSnap,this._centerClampedToGround=f.centerClampedToGround,this._refreshExpiredTiles=f.refreshExpiredTiles===!0,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions===!0,this._collectResourceTiming=f.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Yc),f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this._zoomLevelsToOverscale=f.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=f.transformCameraUpdate,this.transformConstrain=f.transformConstrain,this.cancelPendingTileRequestsWhileZooming=f.cancelPendingTileRequestsWhileZooming===!0,f.reduceMotion!==void 0&&(we.prefersReducedMotion=f.reduceMotion),this._imageQueueHandle=it.addThrottleControl((()=>this.isMoving())),this._requestManager=new at(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let z=!1;const j=$d((Z=>{this._trackResize&&!this._removed&&(this.resize(Z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((Z=>{z?j(Z):z=!0})),this._resizeObserver.observe(this._container)}this.handlers=new mh(this,f),this._hash=f.hash&&new Ts(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,roll:f.roll}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,h.e({},f.fitBoundsOptions,{duration:0}))));const k=typeof f.style=="string"||((s=(t=f.style)===null||t===void 0?void 0:t.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,k),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new xs(typeof f.attributionControl=="boolean"?void 0:f.attributionControl)),f.maplibreLogo&&this.addControl(new yh,f.logoPosition),this.on("style.load",(()=>{if(k||this._resizeTransform(),this.transform.unmodified){const z=h.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(z)}})),this.on("data",(z=>{this._update(z.dataType==="style"),this.fire(new h.l(`${z.dataType}data`,z))})),this.on("dataloading",(z=>{this.fire(new h.l(`${z.dataType}dataloading`,z))})),this.on("dataabort",(z=>{this.fire(new h.l("sourcedataabort",z))}))}_getMapId(){return this._mapId}setGlobalStateProperty(A,t){return this.style.setGlobalStateProperty(A,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(A,t){if(t===void 0&&(t=A.getDefaultPosition?A.getDefaultPosition():"top-right"),!A||!A.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=A.onAdd(this);this._controls.push(A);const f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(s,f.firstChild):f.appendChild(s),this}removeControl(A){if(!A||!A.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(A);return t>-1&&this._controls.splice(t,1),A.onRemove(this),this}hasControl(A){return this._controls.indexOf(A)>-1}coveringTiles(A){return ni(this.transform,A)}calculateCameraOptionsFromTo(A,t,s,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLat(s,this.transform)),super.calculateCameraOptionsFromTo(A,t,s,f)}resize(A,t=!0){const[s,f]=this._containerDimensions(),x=this._getClampedPixelRatio(s,f);if(this._resizeCanvas(s,f,x),this.painter.resize(s,f,x),this.painter.overLimit()){const k=this.painter.context.gl;this._maxCanvasSize=[k.drawingBufferWidth,k.drawingBufferHeight];const z=this._getClampedPixelRatio(s,f);this._resizeCanvas(s,f,z),this.painter.resize(s,f,z)}this._resizeTransform(t);const S=!this._moving;return S&&(this.stop(),this.fire(new h.l("movestart",A)).fire(new h.l("move",A))),this.fire(new h.l("resize",A)),S&&this.fire(new h.l("moveend",A)),this}_resizeTransform(A=!0){var t;const[s,f]=this._containerDimensions();this.transform.resize(s,f,A),(t=this._requestedCameraState)===null||t===void 0||t.resize(s,f,A)}_getClampedPixelRatio(A,t){const{0:s,1:f}=this._maxCanvasSize,x=this.getPixelRatio(),S=A*x,k=t*x;return Math.min(S>s?s/S:1,k>f?f/k:1)*x}getPixelRatio(){var A;return(A=this._overridePixelRatio)!==null&&A!==void 0?A:devicePixelRatio}setPixelRatio(A){this._overridePixelRatio=A,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(A){return this.transform.setMaxBounds(qn.convert(A)),this._update()}setMinZoom(A){if((A=A??-2)>=-2&&A<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(A),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(A){if((A=A??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(A),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(A){if((A=A??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(A>=0&&A<=this.transform.maxPitch)return this.transform.setMinPitch(A),this._update(),this.getPitch()<A&&this.setPitch(A),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(A){if((A=A??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(A>=this.transform.minPitch)return this.transform.setMaxPitch(A),this._update(),this.getPitch()>A&&this.setPitch(A),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(A){return this.transform.setRenderWorldCopies(A),this._update()}setTransformConstrain(A){return this.transform.setConstrainOverride(A),this._update()}project(A){return this.transform.locationToScreenPoint(h.V.convert(A),this.style&&this.terrain)}unproject(A){return this.transform.screenPointToLocation(h.P.convert(A),this.terrain)}isMoving(){var A;return this._moving||((A=this.handlers)===null||A===void 0?void 0:A.isMoving())}isZooming(){var A;return this._zooming||((A=this.handlers)===null||A===void 0?void 0:A.isZooming())}isRotating(){var A;return this._rotating||((A=this.handlers)===null||A===void 0?void 0:A.isRotating())}_createDelegatedListener(A,t,s){if(A==="mouseenter"||A==="mouseover"){let f=!1;return{layers:t,listener:s,delegates:{mousemove:S=>{const k=t.filter((j=>this.getLayer(j))),z=k.length!==0?this.queryRenderedFeatures(S.point,{layers:k}):[];z.length?f||(f=!0,s.call(this,new Js(A,this,S.originalEvent,{features:z}))):f=!1},mouseout:()=>{f=!1}}}}if(A==="mouseleave"||A==="mouseout"){let f=!1;return{layers:t,listener:s,delegates:{mousemove:k=>{const z=t.filter((j=>this.getLayer(j)));(z.length!==0?this.queryRenderedFeatures(k.point,{layers:z}):[]).length?f=!0:f&&(f=!1,s.call(this,new Js(A,this,k.originalEvent)))},mouseout:k=>{f&&(f=!1,s.call(this,new Js(A,this,k.originalEvent)))}}}}{const f=x=>{const S=t.filter((z=>this.getLayer(z))),k=S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[];k.length&&(x.features=k,s.call(this,x),delete x.features)};return{layers:t,listener:s,delegates:{[A]:f}}}}_saveDelegatedListener(A,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[A]=this._delegatedListeners[A]||[],this._delegatedListeners[A].push(t)}_removeDelegatedListener(A,t,s){if(!this._delegatedListeners||!this._delegatedListeners[A])return;const f=this._delegatedListeners[A];for(let x=0;x<f.length;x++){const S=f[x];if(S.listener===s&&S.layers.length===t.length&&S.layers.every((k=>t.includes(k)))){for(const k in S.delegates)this.off(k,S.delegates[k]);return void f.splice(x,1)}}}on(A,t,s){if(s===void 0)return super.on(A,t);const f=typeof t=="string"?[t]:t,x=this._createDelegatedListener(A,f,s);this._saveDelegatedListener(A,x);for(const S in x.delegates)this.on(S,x.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(A,f,s)}}}once(A,t,s){if(s===void 0)return super.once(A,t);const f=typeof t=="string"?[t]:t,x=this._createDelegatedListener(A,f,s);for(const S in x.delegates){const k=x.delegates[S];x.delegates[S]=(...z)=>{this._removeDelegatedListener(A,f,s),k(...z)}}this._saveDelegatedListener(A,x);for(const S in x.delegates)this.once(S,x.delegates[S]);return this}off(A,t,s){return s===void 0?super.off(A,t):(this._removeDelegatedListener(A,typeof t=="string"?[t]:t,s),this)}queryRenderedFeatures(A,t){if(!this.style)return[];let s;const f=A instanceof h.P||Array.isArray(A),x=f?A:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(f?{}:A)||{},x instanceof h.P||typeof x[0]=="number")s=[h.P.convert(x)];else{const S=h.P.convert(x[0]),k=h.P.convert(x[1]);s=[S,new h.P(k.x,S.y),k,new h.P(S.x,k.y),S]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(A,t){return this.style.querySourceFeatures(A,t)}setStyle(A,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&A?(this._diffStyle(A,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(A,t))}setTransformRequest(A){return this._requestManager.setTransformRequest(A),this}_getUIString(A){const t=this._locale[A];if(t==null)throw new Error(`Missing UI string '${A}'`);return t}_updateStyle(A,t){var s,f;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(A,t)));const x=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!A)),A?(this.style=new Oa(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof A=="string"?this.style.loadURL(A,t,x):this.style.loadJSON(A,t,x),this):((f=(s=this.style)===null||s===void 0?void 0:s.projection)===null||f===void 0||f.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Oa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(A,t){if(typeof A=="string"){const s=this._requestManager.transformRequest(A,"Style");h.j(s,new AbortController).then((f=>{this._updateDiff(f.data,t)})).catch((f=>{f&&this.fire(new h.k(f))}))}else typeof A=="object"&&this._updateDiff(A,t)}_updateDiff(A,t){try{this.style.setState(A,t)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(A,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(A,t){return this._lazyInitEmptyStyle(),this.style.addSource(A,t),this._update(!0)}isSourceLoaded(A){const t=this.style&&this.style.tileManagers[A];if(t!==void 0)return t.loaded();this.fire(new h.k(new Error(`There is no tile manager with ID '${A}'`)))}setTerrain(A){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),A){const t=this.style.tileManagers[A.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${A.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const f=this.style._layers[s];f.type==="hillshade"&&f.source===A.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),f.type==="color-relief"&&f.source===A.source&&h.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Vi(this.painter,t,A),this.painter.renderToTexture=new $o(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var f;s.dataType==="style"?this.terrain.tileManager.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==A.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((f=s.source)===null||f===void 0?void 0:f.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:A})),this}getTerrain(){var A,t;return(t=(A=this.terrain)===null||A===void 0?void 0:A.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const A=this.style&&this.style.tileManagers;for(const t of Object.values(A))if(!t.areTilesLoaded())return!1;return!0}removeSource(A){return this.style.removeSource(A),this._update(!0)}getSource(A){return this.style.getSource(A)}setSourceTileLodParams(A,t,s){if(s){const f=this.getSource(s);if(!f)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);f.calculateTileZoom=Jn(Math.max(1,A),Math.max(1,t))}else for(const f in this.style.tileManagers)this.style.tileManagers[f].getSource().calculateTileZoom=Jn(Math.max(1,A),Math.max(1,t));return this._update(!0),this}refreshTiles(A,t){const s=this.style.tileManagers[A];if(!s)throw new Error(`There is no tile manager with ID "${A}", cannot refresh tile`);t===void 0?s.reload(!0):s.refreshTiles(t.map((f=>new h.ac(f.z,f.x,f.y))))}addImage(A,t,s={}){const{pixelRatio:f=1,sdf:x=!1,stretchX:S,stretchY:k,content:z,textFitWidth:j,textFitHeight:Z}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:W,height:ee,data:J}=t,se=t;return this.style.addImage(A,{data:new h.R({width:W,height:ee},new Uint8Array(J)),pixelRatio:f,stretchX:S,stretchY:k,content:z,textFitWidth:j,textFitHeight:Z,sdf:x,version:0,userImage:se}),se.onAdd&&se.onAdd(this,A),this}}{const{width:W,height:ee,data:J}=we.getImageData(t);this.style.addImage(A,{data:new h.R({width:W,height:ee},J),pixelRatio:f,stretchX:S,stretchY:k,content:z,textFitWidth:j,textFitHeight:Z,sdf:x,version:0})}}updateImage(A,t){const s=this.style.getImage(A);if(!s)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||h.b(t)?we.getImageData(t):t,{width:x,height:S,data:k}=f;if(x===void 0||S===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==s.data.width||S!==s.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const z=!(t instanceof HTMLImageElement||h.b(t));return s.data.replace(k,z),this.style.updateImage(A,s),this}getImage(A){return this.style.getImage(A)}hasImage(A){return A?!!this.style.getImage(A):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(A){this.style.removeImage(A)}loadImage(A){return it.getImage(this._requestManager.transformRequest(A,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(A,t){return this._lazyInitEmptyStyle(),this.style.addLayer(A,t),this._update(!0)}moveLayer(A,t){return this.style.moveLayer(A,t),this._update(!0)}removeLayer(A){return this.style.removeLayer(A),this._update(!0)}getLayer(A){return this.style.getLayer(A)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(A,t,s){return this.style.setLayerZoomRange(A,t,s),this._update(!0)}setFilter(A,t,s={}){return this.style.setFilter(A,t,s),this._update(!0)}getFilter(A){return this.style.getFilter(A)}setPaintProperty(A,t,s,f={}){return this.style.setPaintProperty(A,t,s,f),this._update(!0)}getPaintProperty(A,t){return this.style.getPaintProperty(A,t)}setLayoutProperty(A,t,s,f={}){return this.style.setLayoutProperty(A,t,s,f),this._update(!0)}getLayoutProperty(A,t){return this.style.getLayoutProperty(A,t)}setGlyphs(A,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(A,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(A,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(A,t,s,(f=>{f||this._update(!0)})),this}removeSprite(A){return this._lazyInitEmptyStyle(),this.style.removeSprite(A),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(A,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(A,t,(s=>{s||this._update(!0)})),this}setLight(A,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(A,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(A,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(A,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(A,t){return this.style.setFeatureState(A,t),this._update()}removeFeatureState(A,t){return this.style.removeFeatureState(A,t),this._update()}getFeatureState(A){return this.style.getFeatureState(A)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let A=0,t=0;return this._container&&(A=this._container.clientWidth||400,t=this._container.clientHeight||300),[A,t]}_setupContainer(){const A=this._container;A.classList.add("maplibregl-map");const t=this._canvasContainer=he.create("div","maplibregl-canvas-container",A);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=he.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),f=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],f);const x=this._controlContainer=he.create("div","maplibregl-control-container",A),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((k=>{S[k]=he.create("div",`maplibregl-ctrl-${k} `,x)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(A,t,s){this._canvas.width=Math.floor(s*A),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${A}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const A=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(f=>{t={requestedAttributes:A},f&&(t.statusMessage=f.statusMessage,t.type=f.type)}),{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,A):this._canvas.getContext("webgl2",A)||this._canvas.getContext("webgl",A),!s){const f="Failed to initialize WebGL";throw t?(t.message=f,new Error(JSON.stringify(t))):new Error(f)}this.painter=new cp(s,this.transform),Re.testSupport(s)}migrateProjection(A,t){super.migrateProjection(A,t),this.painter.transform=A,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(A){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||A,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(A){return this._update(),this._renderTaskQueue.add(A)}_cancelRenderFrame(A){this._renderTaskQueue.remove(A)}_render(A){var t,s,f,x,S;const k=this._idleTriggered?this._fadeDuration:0,z=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(A),this._removed)return;let j=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const ee=this.transform.zoom,J=me();this.style.zoomHistory.update(ee,J);const se=new h.H(ee,{now:J,fadeDuration:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),fe=se.crossFadingFactor();fe===1&&fe===this._crossFadingFactor||(j=!0,this._crossFadingFactor=fe),this.style.update(se)}const Z=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==z;(f=this.style.projection)===null||f===void 0||f.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((x=this.style.projection)===null||x===void 0?void 0:x.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||Z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,k,this._crossSourceCollisions,Z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:k,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cG.mark(h.cH.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||j)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const W=this._sourcesDirty||this._styleDirty||this._placementDirty;return W||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||W||(this._fullyLoaded=!0,h.cG.mark(h.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var A;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),it.removeThrottleControl(this._imageQueueHandle),(A=this._resizeObserver)===null||A===void 0||A.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),he.remove(this._canvasContainer),he.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cG.clearMetrics(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,we.frame(this._frameRequest,(A=>{h.cG.frame(A),this._frameRequest=null;try{this._render(A)}catch(t){if(!h.Z(t)&&!(function(s){return s.message===bc})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(A){this._showTileBoundaries!==A&&(this._showTileBoundaries=A,this._update())}get showPadding(){return!!this._showPadding}set showPadding(A){this._showPadding!==A&&(this._showPadding=A,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(A){this._showCollisionBoxes!==A&&(this._showCollisionBoxes=A,A?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(A){this._showOverdrawInspector!==A&&(this._showOverdrawInspector=A,this._update())}get repaint(){return!!this._repaint}set repaint(A){this._repaint!==A&&(this._repaint=A,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(A){this._vertices=A,this._update()}get version(){return $c}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(A){return this._lazyInitEmptyStyle(),this.style.setProjection(A),this._update(!0)}},N.MapMouseEvent=Js,N.MapTouchEvent=Xo,N.MapWheelEvent=td,N.Marker=_h,N.NavigationControl=class{constructor(A){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),f=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,s)=>{const f=this._map._getUIString(`NavigationControl.${s}`);t.title=f,t.setAttribute("aria-label",f)},this.options=h.e({},ef,A),this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),he.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),he.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=he.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(A){return this._map=A,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Jr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){he.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(A,t){const s=he.create("button",A,this._container);return s.type="button",s.addEventListener("click",t),s}},N.Popup=class extends h.E{constructor(A){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&he.remove(this._content),this._container&&(he.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=he.create("div","maplibregl-popup",this._map.getContainer()),this._tip=he.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const k of this.options.className.split(" "))this._container.classList.add(k);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Mu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const s=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let f=this.options.anchor;const x=Nu(this.options.offset);if(!f){const k=this._container.offsetWidth,z=this._container.offsetHeight;let j;j=s.y+x.bottom.y<z?["top"]:s.y>this._map.transform.height-z?["bottom"]:[],s.x<k/2?j.push("left"):s.x>this._map.transform.width-k/2&&j.push("right"),f=j.length===0?"bottom":j.join("-")}let S=s.add(x[f]);this.options.subpixelPositioning||(S=S.round()),he.setTransform(this._container,`${ku[f]} translate(${S.x}px,${S.y}px)`),xh(this._container,f,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Qc),A)}addTo(A){return this._map&&this.remove(),this._map=A,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=h.V.convert(A),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(A){return this.setDOMContent(document.createTextNode(A))}setHTML(A){const t=document.createDocumentFragment(),s=document.createElement("body");let f;for(s.innerHTML=A;f=s.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){var A;return(A=this._container)===null||A===void 0?void 0:A.style.maxWidth}setMaxWidth(A){return this.options.maxWidth=A,this._update(),this}setDOMContent(A){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=he.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(A),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(A){return this._container&&this._container.classList.add(A),this}removeClassName(A){return this._container&&this._container.classList.remove(A),this}setOffset(A){return this.options.offset=A,this._update(),this}toggleClassName(A){if(this._container)return this._container.classList.toggle(A)}setSubpixelPositioning(A){this.options.subpixelPositioning=A}_createCloseButton(){this.options.closeButton&&(this._closeButton=he.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const A=this._container.querySelector(Kc);A&&A.focus()}},N.RasterDEMTileSource=nn,N.RasterTileSource=vi,N.ScaleControl=class{constructor(A){this._onMove=()=>{os(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,os(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},_a),A)}getDefaultPosition(){return"bottom-left"}onAdd(A){return this._map=A,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-scale",A.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){he.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},N.ScrollZoomHandler=ph,N.Style=Oa,N.TerrainControl=class{constructor(A){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=A}onAdd(A){return this._map=A,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=he.create("button","maplibregl-ctrl-terrain",this._container),he.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){he.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},N.TwoFingersTouchPitchHandler=Yl,N.TwoFingersTouchRotateHandler=fh,N.TwoFingersTouchZoomHandler=Sl,N.TwoFingersTouchZoomRotateHandler=Wc,N.VectorTileSource=In,N.VideoSource=gt,N.addSourceType=(A,t)=>h._(void 0,void 0,void 0,(function*(){if(pe(A))throw new Error(`A source type called "${A}" already exists.`);((s,f)=>{ce[s]=f})(A,t)})),N.clearPrewarmedResources=function(){const A=Kt;A&&(A.isPreloaded()&&A.numActive()===1?(A.release(_t),Kt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},N.createTileMesh=hi,N.getMaxParallelImageRequests=function(){return h.c.MAX_PARALLEL_IMAGE_REQUESTS},N.getRTLTextPluginStatus=function(){return rt().getRTLTextPluginStatus()},N.getVersion=function(){return Ko},N.getWorkerCount=function(){return tn.workerCount},N.getWorkerUrl=function(){return h.c.WORKER_URL},N.importScriptInWorkers=function(A){return Dn().broadcast("IS",A)},N.isTimeFrozen=function(){return ve.isFrozen()},N.now=me,N.prewarm=function(){sn().acquire(_t)},N.restoreNow=function(){ve.restoreNow()},N.setMaxParallelImageRequests=function(A){h.c.MAX_PARALLEL_IMAGE_REQUESTS=A},N.setNow=function(A){ve.setNow(A)},N.setRTLTextPlugin=function(A,t){return rt().setRTLTextPlugin(A,t)},N.setWorkerCount=function(A){tn.workerCount=A},N.setWorkerUrl=function(A){h.c.WORKER_URL=A}}));var P=y;return P}))})(Km)),Km.exports}var h2=t4();const d2=ap(h2),n4=db({__proto__:null,default:d2},[h2]);var my={},F_;function i4(){if(F_)return my;F_=1;var c=function(){},d="+",y=8,C="0",D="23456789CFGHJMPQRVWX",P=D.length,N=90,h=180,U=10,H=[20,1,.05,.0025,125e-6],Y=4,Q=5,_e=125e-6,we=6;c.prototype.isValid=function(at){if(!at||at.indexOf(d)==-1||at.indexOf(d)!=at.lastIndexOf(d)||at.length==1||at.indexOf(d)>y||at.indexOf(d)%2==1)return!1;if(at.indexOf(C)>-1){if(at.indexOf(C)==0)return!1;var He=at.match(new RegExp("("+C+"+)","g"));if(He.length>1||He[0].length%2==1||He[0].length>y-2||at.charAt(at.length-1)!=d)return!1}if(at.length-at.indexOf(d)-1==1)return!1;at=at.replace(new RegExp("\\"+d+"+"),"").replace(new RegExp(C+"+"),"");for(var xt=0,Pe=at.length;xt<Pe;xt++){var ct=at.charAt(xt).toUpperCase();if(ct!=d&&D.indexOf(ct)==-1)return!1}return!0},c.prototype.isShort=function(at){return this.isValid(at)?at.indexOf(d)>=0&&at.indexOf(d)<y:!1},c.prototype.isFull=function(at){if(!this.isValid(at)||this.isShort(at))return!1;var He=D.indexOf(at.charAt(0).toUpperCase())*P;if(He>=N*2)return!1;if(at.length>1){var xt=D.indexOf(at.charAt(1).toUpperCase())*P;if(xt>=h*2)return!1}return!0},c.prototype.encode=function(at,He,xt){if(typeof xt>"u"&&(xt=U),xt<2||xt<y&&xt%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";at=ve(at),He=he(He),at==90&&(at=at-me(xt));var Pe=Re(at,He,Math.min(xt,U));return xt>U&&(Pe+=tt(at,He,xt-U)),Pe},c.prototype.decode=function(at){if(!this.isFull(at))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+at;at=at.replace(d,""),at=at.replace(new RegExp(C+"+"),""),at=at.toUpperCase();var He=Ye(at.substring(0,U));if(at.length<=U)return He;var xt=Wt(at.substring(U));return Et(He.latitudeLo+xt.latitudeLo,He.longitudeLo+xt.longitudeLo,He.latitudeLo+xt.latitudeHi,He.longitudeLo+xt.longitudeHi,He.codeLength+xt.codeLength)},c.prototype.recoverNearest=function(at,He,xt){if(!this.isShort(at)){if(this.isFull(at))return at;throw"ValueError: Passed short code is not valid: "+at}He=ve(He),xt=he(xt),at=at.toUpperCase();var Pe=y-at.indexOf(d),ct=Math.pow(20,2-Pe/2),vt=ct/2,Zt=Math.floor(He/ct)*ct,Ne=Math.floor(xt/ct)*ct,Te=this.decode(this.encode(Zt,Ne).substr(0,Pe)+at),We=Te.latitudeCenter-He;return We>vt?Te.latitudeCenter-=ct:We<-vt&&(Te.latitudeCenter+=ct),We=Te.longitudeCenter-xt,We>vt?Te.longitudeCenter-=ct:We<-vt&&(Te.longitudeCenter+=ct),this.encode(Te.latitudeCenter,Te.longitudeCenter,Te.codeLength)},c.prototype.shorten=function(Pe,He,xt){if(!this.isFull(Pe))throw"ValueError: Passed code is not valid and full: "+Pe;if(Pe.indexOf(C)!=-1)throw"ValueError: Cannot shorten padded codes: "+Pe;var Pe=Pe.toUpperCase(),ct=this.decode(Pe);if(ct.codeLength<we)throw"ValueError: Code length must be at least "+we;He=ve(He),xt=he(xt);for(var vt=Math.max(Math.abs(ct.latitudeCenter-He),Math.abs(ct.longitudeCenter-xt)),Zt=H.length-2;Zt>=1;Zt--)if(vt<H[Zt]*.3)return Pe.substring((Zt+1)*2);return Pe};var ve=function(at){return Math.min(90,Math.max(-90,at))},me=function(at){return at<=10?Math.pow(20,Math.floor(at/-2+2)):Math.pow(20,-3)/Math.pow(Q,at-10)},he=function(at){for(;at<-180;)at=at+360;for(;at>=180;)at=at-360;return at},Re=function(at,He,xt){for(var Pe="",ct=at+N,vt=He+h,Zt=0;Zt<xt;){var Ne=H[Math.floor(Zt/2)],Te=Math.floor(ct/Ne);ct-=Te*Ne,Pe+=D.charAt(Te),Zt+=1,Te=Math.floor(vt/Ne),vt-=Te*Ne,Pe+=D.charAt(Te),Zt+=1,Zt==y&&Zt<xt&&(Pe+=d)}return Pe.length<y&&(Pe=Pe+Array(y-Pe.length+1).join(C)),Pe.length==y&&(Pe=Pe+d),Pe},tt=function(at,He,xt){for(var Pe="",ct=_e,vt=_e,Zt=(at+N)%ct,Ne=(He+h)%vt,Te=0;Te<xt;Te++){var We=Math.floor(Zt/(ct/Q)),wt=Math.floor(Ne/(vt/Y));ct/=Q,vt/=Y,Zt-=We*ct,Ne-=wt*vt,Pe+=D.charAt(We*Y+wt)}return Pe},Ye=function(at){var He=pt(at,0),xt=pt(at,1);return new Et(He[0]-N,xt[0]-h,He[1]-N,xt[1]-h,at.length)},pt=function(at,He){for(var xt=0,Pe=0;xt*2+He<at.length;)Pe+=D.indexOf(at.charAt(xt*2+He))*H[xt],xt+=1;return[Pe,Pe+H[xt-1]]},Wt=function(at){for(var He=0,xt=0,Pe=_e,ct=_e,vt=0;vt<at.length;){var Zt=D.indexOf(at.charAt(vt)),Ne=Math.floor(Zt/Y),Te=Zt%Y;Pe/=Q,ct/=Y,He+=Ne*Pe,xt+=Te*ct,vt+=1}return Et(He,xt,He+Pe,xt+ct,at.length)},Et=c.prototype.CodeArea=function(at,He,xt,Pe,ct){return new it.init(at,He,xt,Pe,ct)},it={init:function(at,He,xt,Pe,ct){this.latitudeLo=at,this.longitudeLo=He,this.latitudeHi=xt,this.longitudeHi=Pe,this.codeLength=ct,this.latitudeCenter=Math.min(at+(xt-at)/2,N),this.longitudeCenter=Math.min(He+(Pe-He)/2,h)}};return my.OpenLocationCode=c,my}var r4=i4();const s4=ap(r4);function Ol(c,d,y=10){const C=[16,8,4,2,1],D="0123456789bcdefghjkmnpqrstuvwxyz";let P=!0,N=-90,h=90,U=-180,H=180,Y="",Q=0,_e=0;for(;Y.length<y;){if(P){const we=(U+H)/2;d>we?(_e|=C[Q],U=we):H=we}else{const we=(N+h)/2;c>we?(_e|=C[Q],N=we):h=we}P=!P,Q<4?Q++:(Y+=D[_e],Q=0,_e=0)}return Y}function a4(c,d){return`${c.toFixed(6)}, ${d.toFixed(6)}`}function o4(c,d,y=5){const C=Ol(c,d,y),D=y===5?.02:y===6?.005:.001,P=y===5?.04:y===6?.01:.002,N=new Set;N.add(C);const h=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[U,H]of h){const Y=c+U*D,Q=d+H*P;N.add(Ol(Y,Q,y))}return Array.from(N)}const yy=s4,l4=yy.OpenLocationCode||yy.default?.OpenLocationCode||yy,ol=new l4;function Rl(c){const d=c.trim();if(d.replace(//g,"").replace(/,/g," ").split(/\s+/).filter(D=>D.length>0).length>=2){let D=null,P=null;const N=d.match(/^(-?\d+(\.\d+)?)[,\s]+(-?\d+(\.\d+)?)$/);if(N)D=parseFloat(N[1]),P=parseFloat(N[3]);else{const h=d.matchAll(/([0-9.-]+)\s*?\s*([NSEWnsew])?/g),U=Array.from(h);if(U.length===2){const H=parseFloat(U[0][1]),Y=U[0][2]?.toUpperCase(),Q=parseFloat(U[1][1]),_e=U[1][2]?.toUpperCase(),we=(he,Re)=>{let tt=he;return(Re==="S"||Re==="W")&&(tt=-he),Re==="N"||Re==="S"?{type:"lat",val:tt}:Re==="E"||Re==="W"?{type:"lon",val:tt}:{type:"unknown",val:tt}},ve=we(H,Y),me=we(Q,_e);ve.type==="lat"&&me.type==="lon"?(D=ve.val,P=me.val):ve.type==="lon"&&me.type==="lat"?(P=ve.val,D=me.val):ve.type==="unknown"&&me.type==="unknown"&&(D=ve.val,P=me.val)}}if(D!==null&&P!==null&&!isNaN(D)&&!isNaN(P)&&D>=-90&&D<=90&&P>=-180&&P<=180)return{lat:D,lon:P,type:"coordinate"}}try{const P=d.split(/[\s,]+/)[0];if(ol&&ol.isValid&&ol.isValid(d)&&ol.isFull(d)){const N=ol.decode(d);return{lat:N.latitudeCenter,lon:N.longitudeCenter,type:"plus_code"}}if(P.length>=6&&P.includes("+")&&ol&&ol.isValid&&ol.isValid(P)&&ol.isFull(P)){const N=ol.decode(P);return{lat:N.latitudeCenter,lon:N.longitudeCenter,type:"plus_code"}}if(!d.includes("+")){const N=d.toUpperCase().replace(/\s+/g,"+");if(ol&&ol.isValid&&ol.isValid(N)&&ol.isFull(N)){const h=ol.decode(N);return{lat:h.latitudeCenter,lon:h.longitudeCenter,type:"plus_code"}}}}catch{}return null}function j_(c,d,y,C){const P=(y-c)*Math.PI/180,N=(C-d)*Math.PI/180,h=Math.sin(P/2)*Math.sin(P/2)+Math.cos(c*Math.PI/180)*Math.cos(y*Math.PI/180)*Math.sin(N/2)*Math.sin(N/2);return 6371*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}async function Rg(c,d,y,C=5){if(!c||c.length<3)return[];try{let D=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(c)}&format=json&limit=${C}&addressdetails=1`;if(d&&(D+=`&countrycodes=${d}`),y){const U=y[1]-1,H=y[1]+1,Y=y[0]+1,Q=y[0]-1;D+=`&viewbox=${U},${Y},${H},${Q}`}const N=await(await fetch(D)).json();return Array.isArray(N)?N:[]}catch(D){return console.error("[Parlens] Suggestion fetch error:",D),[]}}async function Bg(c,d,y){const C=JSON.stringify(c);if(y){const D=Lg.getConversationKey(y,d);return Lg.encrypt(C,D)}else if(window.nostr?.nip44?.encrypt)return await window.nostr.nip44.encrypt(d,C);throw new Error("No encryption method available")}async function Tx(c,d,y){let C;if(y){const D=Lg.getConversationKey(y,d);C=Lg.decrypt(c,D)}else if(window.nostr?.nip44?.decrypt)C=await window.nostr.nip44.decrypt(d,c);else throw new Error("No decryption method available");return JSON.parse(C)}const c1={IN:"INR",US:"USD",GB:"GBP",DE:"EUR",FR:"EUR",ES:"EUR",IT:"EUR",NL:"EUR",BE:"EUR",AT:"EUR",PT:"EUR",IE:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CN:"CNY",AE:"AED",SG:"SGD",HK:"HKD",CH:"CHF",SE:"SEK",NO:"NOK",DK:"DKK",NZ:"NZD",MX:"MXN",BR:"BRL",ZA:"ZAR",KR:"KRW",TH:"THB",MY:"MYR",PH:"PHP",ID:"IDR",VN:"VND",RU:"RUB",PL:"PLN",TR:"TRY",SA:"SAR",EG:"EGP"};async function f2(c,d){try{const y=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${c}&lon=${d}&zoom=3`,{headers:{"User-Agent":"Parlens-PWA/1.0"}});if(!y.ok)throw new Error("Geocoding failed");const D=(await y.json()).address?.country_code?.toUpperCase();return D&&c1[D]?c1[D]:"USD"}catch(y){return console.warn("Currency detection failed, using locale fallback:",y),p2()}}function p2(){try{const d=window.navigator.language.split("-")[1]?.toUpperCase();return d&&c1[d]?c1[d]:"USD"}catch{return"USD"}}function tp(c){try{return 0 .toLocaleString(window.navigator.language,{style:"currency",currency:c,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}catch{return{INR:"",USD:"$",GBP:"",EUR:"",JPY:"",CAD:"C$",AUD:"A$",CNY:"",AED:".",SGD:"S$"}[c]||"$"}}const c4={INR:"IN",USD:"US",GBP:"GB",EUR:"EU",JPY:"JP",CAD:"CA",AUD:"AU",CNY:"CN",AED:"AE",SGD:"SG",HKD:"HK",CHF:"CH",SEK:"SE",NOK:"NO",DKK:"DK",NZD:"NZ",MXN:"MX",BRL:"BR",ZAR:"ZA",KRW:"KR",THB:"TH",MYR:"MY",PHP:"PH",IDR:"ID",VND:"VN",RUB:"RU",PLN:"PL",TRY:"TR",SAR:"SA",EGP:"EG"};function u4(c){return(c4[c]||"US").toUpperCase().replace(/./g,y=>String.fromCodePoint(y.charCodeAt(0)+127397))}var Yf=Symbol("verified"),h4=c=>c instanceof Object;function g2(c){if(!h4(c)||typeof c.kind!="number"||typeof c.content!="string"||typeof c.created_at!="number"||typeof c.pubkey!="string"||!c.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(c.tags))return!1;for(let d=0;d<c.tags.length;d++){let y=c.tags[d];if(!Array.isArray(y))return!1;for(let C=0;C<y.length;C++)if(typeof y[C]!="string")return!1}return!0}new TextDecoder("utf-8");var d4=new TextEncoder,f4=class{generateSecretKey(){return Qu.utils.randomPrivateKey()}getPublicKey(c){return Es(Qu.getPublicKey(c))}finalizeEvent(c,d){const y=c;return y.pubkey=Es(Qu.getPublicKey(d)),y.id=Jm(y),y.sig=Es(Qu.sign(Jm(y),d)),y[Yf]=!0,y}verifyEvent(c){if(typeof c[Yf]=="boolean")return c[Yf];const d=Jm(c);if(d!==c.id)return c[Yf]=!1,!1;try{const y=Qu.verify(c.sig,d,c.pubkey);return c[Yf]=y,y}catch{return c[Yf]=!1,!1}}};function m2(c){if(!g2(c))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content])}function Jm(c){let d=Gd(d4.encode(m2(c)));return Es(d)}var k1=new f4,y2=k1.generateSecretKey,p4=k1.getPublicKey,x2=k1.finalizeEvent;k1.verifyEvent;const zy=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent:x2,generateSecretKey:y2,getEventHash:Jm,getPublicKey:p4,serializeEvent:m2,validateEvent:g2,verifiedSymbol:Yf},Symbol.toStringTag,{value:"Module"})),g4=ta.memo(({status:c,setStatus:d,searchLocation:y,userLocation:C,vehicleType:D,setOpenSpots:P,parkLocation:N,setParkLocation:h,sessionStart:U,setSessionStart:H,listedParkingSession:Y,onQRScan:Q,onSpotStatusUpdate:_e})=>{const{pubkey:we,pool:ve,signEvent:me}=nh(),[he,Re]=ge.useState(!1),[tt,Ye]=ge.useState("0"),[pt,Wt]=ge.useState(""),[Et,it]=ge.useState("USD"),[at,He]=ge.useState("$"),[xt,Pe]=ge.useState("00:00:00"),[ct,vt]=ge.useState(new Set),[Zt,Ne]=ge.useState(new Set),Te=ge.useRef(new Map),We=ge.useRef(null),wt=ge.useRef(new Set);ge.useEffect(()=>{try{const nt=localStorage.getItem("parlens-hidden-items");if(nt){const Nt=JSON.parse(nt);vt(new Set(Nt.map(_t=>_t.id)))}}catch(nt){console.error("Error loading hidden items:",nt)}},[]),ge.useEffect(()=>{if(c==="parked"&&U){const nt=()=>{const tn=Math.floor(Date.now()/1e3)-U,Bt=Math.floor(tn/3600),Kt=Math.floor(tn%3600/60),an=tn%60;Pe(`${Bt.toString().padStart(2,"0")}:${Kt.toString().padStart(2,"0")}:${an.toString().padStart(2,"0")}`)},Nt=setInterval(nt,1e3);return nt(),()=>clearInterval(Nt)}},[c,U]),ge.useEffect(()=>{if(c==="search"&&y){const nt=Ol(y[0],y[1],5);if(nt===We.current)return;We.current=nt;const Nt=o4(y[0],y[1],5);Ne(_t=>{const tn=new Set(_t);return Nt.forEach(Bt=>tn.add(Bt)),tn.size!==_t.size?tn:_t})}else c==="idle"&&(Ne(new Set),Te.current.clear(),P([]),We.current=null)},[c,y,P]),ge.useEffect(()=>{if(ve&&c==="search"&&Zt.size>0){let nt=function(){const Kt=Array.from(Te.current.values()),an=new Map;Kt.forEach(sn=>{if(sn.listing_a_tag)if(an.has(sn.listing_a_tag)){const Nn=an.get(sn.listing_a_tag);Nn.count+=1,sn.created_at>Nn.created_at&&(Nn.created_at=sn.created_at)}else an.set(sn.listing_a_tag,{...sn,count:1,id:sn.listing_a_tag});else an.set(sn.id,sn)}),P(Array.from(an.values()))};console.log("[Parlens] Subscribing to spots in geohashes:",Array.from(Zt));const Nt=Math.floor(Date.now()/1e3),_t=(Kt,an=!1)=>{try{const sn=Math.floor(Date.now()/1e3);if(Kt.kind===Ln.PARKING_AREA_INDICATOR){const In=Kt.tags.find(vi=>vi[0]==="expiration");if(In&&parseInt(In[1])<sn)return}if(ct.has(Kt.pubkey))return;let Nn,Dn,si,kn="car",ui=0,_i="USD";const Di=Kt.tags.find(In=>In[0]==="location");let qn=0,Gn=0;if(Di)[qn,Gn]=Di[1].split(",").map(Number);else return;if(Kt.kind===Ln.LISTED_SPOT_LOG){const In=Kt.tags.find(pe=>pe[0]==="a"&&pe[3]==="root")?.[1]?.trim();if(In){const pe=In.split(":");if(pe.length===3){Nn=pe[2],Dn=In;const je=pe[1];if(ct.has(je)||Nn&&ct.has(Nn))return}}const vi=Kt.tags.find(pe=>pe[0]==="status");let nn=Kt.id;const Li=Kt.tags.find(pe=>pe[0]==="a")?.[1]?.trim();if(Li&&(nn=Li),_e&&Y&&Y.spotATag===nn&&_e(nn,vi?.[1]||"unknown",Kt),vi?.[1]!=="open"){Te.current.has(nn)&&(Te.current.delete(nn),an&&nt());return}const Ki=Kt.tags.find(pe=>pe[0]==="type"),Pi=Kt.tags.find(pe=>pe[0]==="hourly_rate"),xr=Kt.tags.find(pe=>pe[0]==="currency"),gt=Kt.tags.find(pe=>pe[0]==="listing_name");kn=Ki?.[1]||"car",ui=Pi&&Number(Pi[1])||0,_i=xr?.[1]||"USD",si=gt?.[1];const oe=Te.current.get(nn);if(oe&&oe.created_at>Kt.created_at)return;const ce={id:Kt.id,lat:qn,lon:Gn,price:ui,currency:_i,type:kn,count:1,kind:Kt.kind,created_at:Kt.created_at,listing_name:si,listing_id:Nn,listing_a_tag:Dn,tags:Kt.tags};Te.current.set(nn,ce)}else if(Kt.kind===Ln.PARKING_AREA_INDICATOR){const In=Kt.tags.find(Ki=>Ki[0]==="hourly_rate"),vi=Kt.tags.find(Ki=>Ki[0]==="currency"),nn=Kt.tags.find(Ki=>Ki[0]==="type");ui=In&&Number(In[1])||0,_i=vi?vi[1]:"USD",kn=nn?nn[1]:"car";const Li={id:Kt.id,lat:qn,lon:Gn,price:ui,currency:_i,type:kn,count:1,kind:Kt.kind,created_at:Kt.created_at,tags:Kt.tags};Te.current.set(Kt.id,Li)}an&&nt()}catch(sn){console.warn("[Parlens] Error parsing spot event:",sn)}};(async()=>{const Kt=Array.from(Zt);if(Kt.length!==0){try{const an=localStorage.getItem("parlens_parking_area_filter")||"all";let sn=Nt-604800;an==="today"?sn=Nt-86400:an==="month"?sn=Nt-2592e3:an==="year"?sn=Nt-31536e3:an==="all"&&(sn=0);const Nn=Date.now(),Dn=await ve.querySync(ei,{kinds:[Ln.PARKING_AREA_INDICATOR],"#g":Kt,since:sn}),si=Date.now()-Nn;ei.forEach(kn=>vo.recordSuccess(kn,si));for(const kn of Dn)_t(kn);Te.current.size>0&&P(Array.from(Te.current.values())),console.log("[Parlens] Batch 1 (Kind 31714) loaded:",Dn.length,"events in",si,"ms")}catch(an){ei.forEach(sn=>vo.recordFailure(sn)),console.error("[Parlens] Batch 1 (Kind 31714) failed:",an)}try{const an=await ve.querySync(ei,{kinds:[Ln.LABEL],"#g":Kt,"#L":["parlens"],"#l":["no-parking"]});for(const sn of an){const Nn=sn.tags.find(kn=>kn[0]==="g")?.[1],Dn=sn.tags.find(kn=>kn[0]==="location")?.[1];if(!Nn)continue;const si={id:sn.id,kind:Ln.LABEL,tags:sn.tags,lat:Dn?parseFloat(Dn.split(",")[0]):0,lon:Dn?parseFloat(Dn.split(",")[1]):0,price:0,currency:"INR",created_at:sn.created_at,pubkey:sn.pubkey};Te.current.set(sn.id,si)}an.length>0&&(P(Array.from(Te.current.values())),console.log("[Parlens] Batch 1.5 (Kind 1985 no-parking) loaded:",an.length,"labels"))}catch(an){console.error("[Parlens] Batch 1.5 (Kind 1985 no-parking) failed:",an)}try{const an=Date.now(),sn=await ve.querySync(ei,{kinds:[Ln.LISTED_SPOT_LOG],"#g":Kt}),Nn=Date.now()-an;ei.forEach(kn=>vo.recordSuccess(kn,Nn)),console.log("[Parlens] Batch 2 (Kind 1714) loaded:",sn.length,"events in",Nn,"ms");const Dn=new Map,si=new Set;for(const kn of sn){const ui=kn.tags.find(qn=>qn[0]==="a")?.[1]?.trim();if(!ui)continue;const _i=kn.tags.find(qn=>qn[0]==="a"&&qn[3]==="root")?.[1]?.trim();_i&&_i.split(":").length===3&&si.add(_i);const Di=Dn.get(ui);(!Di||Di.created_at<kn.created_at)&&Dn.set(ui,kn)}if(si.size>0){const kn=Array.from(si),ui=new Set,_i=new Set;kn.forEach(Gn=>{const In=Gn.split(":");In.length===3&&In[1]&&In[1]!=="undefined"&&In[2]&&In[2]!=="undefined"&&(_i.add(In[1]),ui.add(In[2]))}),console.log("[Parlens] DEBUG: dTags=",Array.from(ui)),console.log("[Parlens] DEBUG: authors=",Array.from(_i));const Di=await ve.querySync(ei,{kinds:[Ln.LISTED_PARKING_METADATA],"#d":Array.from(ui),authors:Array.from(_i)}),qn=new Set;Di.forEach(Gn=>{const In=Gn.tags.find(vi=>vi[0]==="d")?.[1]?.trim();In&&qn.add(`${Ln.LISTED_PARKING_METADATA}:${Gn.pubkey}:${In}`)});try{const Gn=await ve.querySync(ei,{kinds:[Ln.LABEL],authors:[jh],"#l":["approved"]});wt.current=new Set;for(const In of Gn){const vi=In.tags.find(nn=>nn[0]==="a")?.[1]?.trim();vi&&wt.current.add(vi)}console.log("[Parlens] Found",wt.current.size,"approved listings from approver"),console.log("[Parlens] DEBUG: parentListingAddresses.size=",si.size),console.log("[Parlens] DEBUG: validAddresses.size=",qn.size),console.log("[Parlens] DEBUG: latestBySpot.size=",Dn.size),console.log("[Parlens] DEBUG: Sample validAddresses:",Array.from(qn).slice(0,3)),console.log("[Parlens] DEBUG: Sample parentListingAddresses:",Array.from(si).slice(0,3))}catch(Gn){console.error("[Parlens] Failed to fetch approval labels:",Gn)}for(const Gn of Dn.values()){const In=Gn.tags.find(vi=>vi[0]==="a"&&vi[3]==="root")?.[1]?.trim();if(In&&qn.has(In)){const vi=In.split(":")[1],nn=vi===jh,Li=wt.current.has(In);console.log("[Parlens] Approval Check:",{rootATag:In,listingPubkey:vi,APPROVER_PUBKEY:jh,isAutoApproved:nn,hasApprovalLabel:Li}),(nn||Li)&&_t(Gn)}}}Te.current.size>0?nt():P([]),console.log("[Parlens] Batch 2 (Kind 1714 + orphan validation) completed")}catch(an){ei.forEach(sn=>vo.recordFailure(sn)),console.error("[Parlens] Batch 2 (Kind 1714 + orphan validation) failed:",an)}}})();const Bt=ve.subscribeMany(ei,[{kinds:[Ln.PARKING_AREA_INDICATOR,Ln.LISTED_SPOT_LOG],"#g":Array.from(Zt),since:Nt}],{onevent(Kt){_t(Kt,!0)},oneose(){}});return()=>{console.log("[Parlens] Unsubscribing from spots"),Bt.close()}}},[c,Zt,ve,P]);const zt=ge.useRef(!1);ge.useEffect(()=>{(async()=>{if(zt.current)return;const Nt=p2();if(it(Nt),He(tp(Nt)),y){zt.current=!0;try{const _t=await f2(y[0],y[1]);it(_t),He(tp(_t))}catch{console.warn("GPS currency detection failed")}}})()},[y]);const Gt=async()=>{c==="idle"?d("search"):c==="search"?(H(Math.floor(Date.now()/1e3)),h(C?[C[0],C[1]]:null),d("parked")):c==="parked"&&(Y?Q?.():(Ye("0"),Re(!0)))},ke=async()=>{d("idle"),Re(!1);const nt=N?N[0]:y?y[0]:0,Nt=N?N[1]:y?y[1]:0,_t=Ol(nt,Nt,5),tn=Math.floor(Date.now()/1e3),Bt=U||tn;try{const Kt={status:"vacated",lat:nt,lon:Nt,geohash:_t,fee:tt,currency:Et,type:D,note:pt||void 0,started_at:Bt,finished_at:tn},an=localStorage.getItem("parlens_privkey"),sn=an?new Uint8Array(an.match(/.{1,2}/g).map(qn=>parseInt(qn,16))):void 0,Nn=await Bg(Kt,we,sn),Dn={kind:Ln.PARKING_LOG,content:Nn,tags:[["d",`session_${Bt}`],["client","parlens"]],created_at:tn,pubkey:we},si=await me(Dn);console.log("Publishing log:",si.id,"to",ei);const kn=await Promise.allSettled(ve.publish(ei,si)),ui=kn.filter(qn=>qn.status==="fulfilled").length,_i=kn.filter(qn=>qn.status==="rejected").length;if(console.log(`[Parlens] Publish results: ${ui}/${kn.length} succeeded, ${_i} failed`),kn.forEach((qn,Gn)=>{qn.status==="rejected"&&console.warn(`[Parlens] Relay ${ei[Gn]} failed:`,qn.reason)}),ui===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),console.log("Log published"),await new Promise(qn=>setTimeout(qn,300)),window.dispatchEvent(new Event("parking-log-updated")),localStorage.getItem("parlens_share_parking_areas")==="true"){const qn=y2(),Gn=tn-Bt,In=Math.max(Math.ceil(Gn/3600),1),vi=String(Math.round(parseFloat(tt)/In)),nn={kind:Ln.PARKING_AREA_INDICATOR,content:"",tags:[["d",`spot_${_t}_${tn}`],["g",_t],...Array.from({length:Math.min(_t.length,10)},(Ki,Pi)=>["g",_t.substring(0,Pi+1)]).filter(Ki=>Ki[1].length<_t.length),["location",`${nt},${Nt}`],["hourly_rate",vi],["currency",Et],["type",D],["session_start",String(Bt)],["session_end",String(tn)],["client","parlens"]],created_at:tn},Li=x2(nn,qn);console.log("[Parlens] *** BROADCASTING OPEN SPOT (User opted in) ***"),console.log("[Parlens] Geohash:",_t),console.log("[Parlens] Location:",`${nt},${Nt}`),console.log("[Parlens] Event ID:",Li.id),console.log("[Parlens] Pubkey:",Li.pubkey.substring(0,20)+"..."),ve.publish(ei,Li)}else console.log("[Parlens] Parking area reporting is disabled. Skipping Kind 31714 broadcast.");H(null),h(null),Wt("")}catch(Kt){console.error("Persistence error:",Kt),alert("Could not save to Nostr. Check relay connections.")}};return M.jsxs("div",{className:"relative flex flex-col items-end gap-4 pointer-events-none",children:[M.jsxs("div",{className:"flex items-center gap-4",children:[c==="search"&&M.jsx("button",{onClick:()=>d("idle"),className:"h-14 px-8 rounded-full bg-red-500/90 text-white font-bold text-xs tracking-widest shadow-2xl backdrop-blur-md animate-in slide-in-from-left-8 pointer-events-auto",children:"CANCEL"}),c==="parked"&&M.jsx("div",{className:"h-14 px-6 rounded-full bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-2xl flex items-center justify-center animate-in slide-in-from-left-8 pointer-events-none",children:M.jsx("span",{className:"font-mono text-xl font-bold tabular-nums text-zinc-900 dark:text-white",children:xt})}),M.jsxs("button",{onClick:Gt,className:`h-20 w-20 flex items-center justify-center rounded-[2.5rem] shadow-2xl transition-all active:scale-90 pointer-events-auto ${c==="idle"?"bg-[#007AFF] text-white shadow-blue-500/20":c==="search"?"bg-[#FF9500] text-white shadow-orange-500/20":"bg-[#34C759] text-white shadow-green-500/20"}`,children:[c==="idle"&&M.jsx(a2,{size:32,strokeWidth:2.5}),c==="search"&&M.jsx(to,{size:32,strokeWidth:2.5,className:"animate-pulse"}),c==="parked"&&(D==="bicycle"?M.jsx("span",{className:"text-3xl",children:""}):D==="motorcycle"?M.jsx("span",{className:"text-3xl",children:""}):M.jsx("span",{className:"text-3xl",children:""}))]})]}),he&&M.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4 pointer-events-auto",children:M.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[M.jsxs("div",{className:"text-center space-y-1",children:[M.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),M.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee, 0 if free parking"})]}),M.jsxs("div",{className:"flex items-center gap-4",children:[M.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[M.jsx("span",{className:"text-2xl font-bold text-blue-500",children:at}),M.jsx("input",{type:"number",value:tt,onChange:nt=>Ye(nt.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),M.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:Et})]}),M.jsxs("div",{className:"flex flex-col gap-1.5",children:[M.jsx("button",{onClick:()=>Ye(String(Math.max(0,parseFloat(tt||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:M.jsx(M1,{size:22,className:"text-zinc-600 dark:text-white/70"})}),M.jsx("button",{onClick:()=>Ye(String(Math.max(0,parseFloat(tt||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:M.jsx(Fd,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),M.jsx("input",{type:"text",value:pt,onChange:nt=>Wt(nt.target.value),placeholder:"Add a note (optional)",className:"w-full bg-zinc-100 dark:bg-white/5 px-4 py-3 rounded-xl border border-black/5 dark:border-white/5 text-sm text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-[#007AFF]/50"}),M.jsxs("div",{className:"w-full space-y-3",children:[M.jsxs("button",{onClick:ke,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",M.jsx(t2,{size:20})]}),M.jsx("button",{onClick:()=>Re(!1),className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})});function m4(){const{pool:c,pubkey:d}=nh(),[y,C]=ge.useState([]),[D,P]=ge.useState(!0),N=ge.useRef(new Set),h=ge.useCallback(async()=>{if(!(!d||!c)){P(!0),console.log("[useParkingLogs] Fetching logs for",d);try{const H=await c.querySync(ei,{kinds:[Ln.PARKING_LOG,5],authors:[d],limit:100});console.log("[useParkingLogs] Fetched",H.length,"events");const Y=new Set,Q=H.filter(me=>me.kind===5);for(const me of Q)for(const he of me.tags)he[0]==="a"&&Y.add(he[1]);const we=H.filter(me=>me.kind===Ln.PARKING_LOG).filter(me=>{const he=me.tags?.find(tt=>tt[0]==="d")?.[1];if(!he)return!0;if(N.current.has(he))return!1;const Re=`${me.kind}:${me.pubkey}:${he}`;return!Y.has(Re)});console.log("[useParkingLogs] Valid logs after filtering:",we.length);const ve=we.sort((me,he)=>he.created_at-me.created_at);C(ve)}catch(H){console.error("[useParkingLogs] Fetch error:",H)}finally{P(!1)}}},[c,d]),U=ge.useCallback(H=>{console.log("[useParkingLogs] Marking deleted:",H),N.current.add(H)},[]);return ge.useEffect(()=>{d&&h()},[d,h]),ge.useEffect(()=>{const H=()=>{console.log("[useParkingLogs] Received update event, refetching..."),h()};return window.addEventListener("parking-log-updated",H),window.addEventListener("visibility-refresh",H),()=>{window.removeEventListener("parking-log-updated",H),window.removeEventListener("visibility-refresh",H)}},[h]),{logs:y,loading:D,refetch:h,markDeleted:U}}var y4=Object.defineProperty,u1=Object.getOwnPropertySymbols,_2=Object.prototype.hasOwnProperty,b2=Object.prototype.propertyIsEnumerable,U_=(c,d,y)=>d in c?y4(c,d,{enumerable:!0,configurable:!0,writable:!0,value:y}):c[d]=y,Ly=(c,d)=>{for(var y in d||(d={}))_2.call(d,y)&&U_(c,y,d[y]);if(u1)for(var y of u1(d))b2.call(d,y)&&U_(c,y,d[y]);return c},By=(c,d)=>{var y={};for(var C in c)_2.call(c,C)&&d.indexOf(C)<0&&(y[C]=c[C]);if(c!=null&&u1)for(var C of u1(c))d.indexOf(C)<0&&b2.call(c,C)&&(y[C]=c[C]);return y};var sp;(c=>{const d=class vr{constructor(U,H,Y,Q){if(this.version=U,this.errorCorrectionLevel=H,this.modules=[],this.isFunction=[],U<vr.MIN_VERSION||U>vr.MAX_VERSION)throw new RangeError("Version value out of range");if(Q<-1||Q>7)throw new RangeError("Mask value out of range");this.size=U*4+17;let _e=[];for(let ve=0;ve<this.size;ve++)_e.push(!1);for(let ve=0;ve<this.size;ve++)this.modules.push(_e.slice()),this.isFunction.push(_e.slice());this.drawFunctionPatterns();const we=this.addEccAndInterleave(Y);if(this.drawCodewords(we),Q==-1){let ve=1e9;for(let me=0;me<8;me++){this.applyMask(me),this.drawFormatBits(me);const he=this.getPenaltyScore();he<ve&&(Q=me,ve=he),this.applyMask(me)}}D(0<=Q&&Q<=7),this.mask=Q,this.applyMask(Q),this.drawFormatBits(Q),this.isFunction=[]}static encodeText(U,H){const Y=c.QrSegment.makeSegments(U);return vr.encodeSegments(Y,H)}static encodeBinary(U,H){const Y=c.QrSegment.makeBytes(U);return vr.encodeSegments([Y],H)}static encodeSegments(U,H,Y=1,Q=40,_e=-1,we=!0){if(!(vr.MIN_VERSION<=Y&&Y<=Q&&Q<=vr.MAX_VERSION)||_e<-1||_e>7)throw new RangeError("Invalid value");let ve,me;for(ve=Y;;ve++){const Ye=vr.getNumDataCodewords(ve,H)*8,pt=N.getTotalBits(U,ve);if(pt<=Ye){me=pt;break}if(ve>=Q)throw new RangeError("Data too long")}for(const Ye of[vr.Ecc.MEDIUM,vr.Ecc.QUARTILE,vr.Ecc.HIGH])we&&me<=vr.getNumDataCodewords(ve,Ye)*8&&(H=Ye);let he=[];for(const Ye of U){y(Ye.mode.modeBits,4,he),y(Ye.numChars,Ye.mode.numCharCountBits(ve),he);for(const pt of Ye.getData())he.push(pt)}D(he.length==me);const Re=vr.getNumDataCodewords(ve,H)*8;D(he.length<=Re),y(0,Math.min(4,Re-he.length),he),y(0,(8-he.length%8)%8,he),D(he.length%8==0);for(let Ye=236;he.length<Re;Ye^=253)y(Ye,8,he);let tt=[];for(;tt.length*8<he.length;)tt.push(0);return he.forEach((Ye,pt)=>tt[pt>>>3]|=Ye<<7-(pt&7)),new vr(ve,H,tt,_e)}getModule(U,H){return 0<=U&&U<this.size&&0<=H&&H<this.size&&this.modules[H][U]}getModules(){return this.modules}drawFunctionPatterns(){for(let Y=0;Y<this.size;Y++)this.setFunctionModule(6,Y,Y%2==0),this.setFunctionModule(Y,6,Y%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const U=this.getAlignmentPatternPositions(),H=U.length;for(let Y=0;Y<H;Y++)for(let Q=0;Q<H;Q++)Y==0&&Q==0||Y==0&&Q==H-1||Y==H-1&&Q==0||this.drawAlignmentPattern(U[Y],U[Q]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(U){const H=this.errorCorrectionLevel.formatBits<<3|U;let Y=H;for(let _e=0;_e<10;_e++)Y=Y<<1^(Y>>>9)*1335;const Q=(H<<10|Y)^21522;D(Q>>>15==0);for(let _e=0;_e<=5;_e++)this.setFunctionModule(8,_e,C(Q,_e));this.setFunctionModule(8,7,C(Q,6)),this.setFunctionModule(8,8,C(Q,7)),this.setFunctionModule(7,8,C(Q,8));for(let _e=9;_e<15;_e++)this.setFunctionModule(14-_e,8,C(Q,_e));for(let _e=0;_e<8;_e++)this.setFunctionModule(this.size-1-_e,8,C(Q,_e));for(let _e=8;_e<15;_e++)this.setFunctionModule(8,this.size-15+_e,C(Q,_e));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let U=this.version;for(let Y=0;Y<12;Y++)U=U<<1^(U>>>11)*7973;const H=this.version<<12|U;D(H>>>18==0);for(let Y=0;Y<18;Y++){const Q=C(H,Y),_e=this.size-11+Y%3,we=Math.floor(Y/3);this.setFunctionModule(_e,we,Q),this.setFunctionModule(we,_e,Q)}}drawFinderPattern(U,H){for(let Y=-4;Y<=4;Y++)for(let Q=-4;Q<=4;Q++){const _e=Math.max(Math.abs(Q),Math.abs(Y)),we=U+Q,ve=H+Y;0<=we&&we<this.size&&0<=ve&&ve<this.size&&this.setFunctionModule(we,ve,_e!=2&&_e!=4)}}drawAlignmentPattern(U,H){for(let Y=-2;Y<=2;Y++)for(let Q=-2;Q<=2;Q++)this.setFunctionModule(U+Q,H+Y,Math.max(Math.abs(Q),Math.abs(Y))!=1)}setFunctionModule(U,H,Y){this.modules[H][U]=Y,this.isFunction[H][U]=!0}addEccAndInterleave(U){const H=this.version,Y=this.errorCorrectionLevel;if(U.length!=vr.getNumDataCodewords(H,Y))throw new RangeError("Invalid argument");const Q=vr.NUM_ERROR_CORRECTION_BLOCKS[Y.ordinal][H],_e=vr.ECC_CODEWORDS_PER_BLOCK[Y.ordinal][H],we=Math.floor(vr.getNumRawDataModules(H)/8),ve=Q-we%Q,me=Math.floor(we/Q);let he=[];const Re=vr.reedSolomonComputeDivisor(_e);for(let Ye=0,pt=0;Ye<Q;Ye++){let Wt=U.slice(pt,pt+me-_e+(Ye<ve?0:1));pt+=Wt.length;const Et=vr.reedSolomonComputeRemainder(Wt,Re);Ye<ve&&Wt.push(0),he.push(Wt.concat(Et))}let tt=[];for(let Ye=0;Ye<he[0].length;Ye++)he.forEach((pt,Wt)=>{(Ye!=me-_e||Wt>=ve)&&tt.push(pt[Ye])});return D(tt.length==we),tt}drawCodewords(U){if(U.length!=Math.floor(vr.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let H=0;for(let Y=this.size-1;Y>=1;Y-=2){Y==6&&(Y=5);for(let Q=0;Q<this.size;Q++)for(let _e=0;_e<2;_e++){const we=Y-_e,me=(Y+1&2)==0?this.size-1-Q:Q;!this.isFunction[me][we]&&H<U.length*8&&(this.modules[me][we]=C(U[H>>>3],7-(H&7)),H++)}}D(H==U.length*8)}applyMask(U){if(U<0||U>7)throw new RangeError("Mask value out of range");for(let H=0;H<this.size;H++)for(let Y=0;Y<this.size;Y++){let Q;switch(U){case 0:Q=(Y+H)%2==0;break;case 1:Q=H%2==0;break;case 2:Q=Y%3==0;break;case 3:Q=(Y+H)%3==0;break;case 4:Q=(Math.floor(Y/3)+Math.floor(H/2))%2==0;break;case 5:Q=Y*H%2+Y*H%3==0;break;case 6:Q=(Y*H%2+Y*H%3)%2==0;break;case 7:Q=((Y+H)%2+Y*H%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[H][Y]&&Q&&(this.modules[H][Y]=!this.modules[H][Y])}}getPenaltyScore(){let U=0;for(let _e=0;_e<this.size;_e++){let we=!1,ve=0,me=[0,0,0,0,0,0,0];for(let he=0;he<this.size;he++)this.modules[_e][he]==we?(ve++,ve==5?U+=vr.PENALTY_N1:ve>5&&U++):(this.finderPenaltyAddHistory(ve,me),we||(U+=this.finderPenaltyCountPatterns(me)*vr.PENALTY_N3),we=this.modules[_e][he],ve=1);U+=this.finderPenaltyTerminateAndCount(we,ve,me)*vr.PENALTY_N3}for(let _e=0;_e<this.size;_e++){let we=!1,ve=0,me=[0,0,0,0,0,0,0];for(let he=0;he<this.size;he++)this.modules[he][_e]==we?(ve++,ve==5?U+=vr.PENALTY_N1:ve>5&&U++):(this.finderPenaltyAddHistory(ve,me),we||(U+=this.finderPenaltyCountPatterns(me)*vr.PENALTY_N3),we=this.modules[he][_e],ve=1);U+=this.finderPenaltyTerminateAndCount(we,ve,me)*vr.PENALTY_N3}for(let _e=0;_e<this.size-1;_e++)for(let we=0;we<this.size-1;we++){const ve=this.modules[_e][we];ve==this.modules[_e][we+1]&&ve==this.modules[_e+1][we]&&ve==this.modules[_e+1][we+1]&&(U+=vr.PENALTY_N2)}let H=0;for(const _e of this.modules)H=_e.reduce((we,ve)=>we+(ve?1:0),H);const Y=this.size*this.size,Q=Math.ceil(Math.abs(H*20-Y*10)/Y)-1;return D(0<=Q&&Q<=9),U+=Q*vr.PENALTY_N4,D(0<=U&&U<=2568888),U}getAlignmentPatternPositions(){if(this.version==1)return[];{const U=Math.floor(this.version/7)+2,H=this.version==32?26:Math.ceil((this.version*4+4)/(U*2-2))*2;let Y=[6];for(let Q=this.size-7;Y.length<U;Q-=H)Y.splice(1,0,Q);return Y}}static getNumRawDataModules(U){if(U<vr.MIN_VERSION||U>vr.MAX_VERSION)throw new RangeError("Version number out of range");let H=(16*U+128)*U+64;if(U>=2){const Y=Math.floor(U/7)+2;H-=(25*Y-10)*Y-55,U>=7&&(H-=36)}return D(208<=H&&H<=29648),H}static getNumDataCodewords(U,H){return Math.floor(vr.getNumRawDataModules(U)/8)-vr.ECC_CODEWORDS_PER_BLOCK[H.ordinal][U]*vr.NUM_ERROR_CORRECTION_BLOCKS[H.ordinal][U]}static reedSolomonComputeDivisor(U){if(U<1||U>255)throw new RangeError("Degree out of range");let H=[];for(let Q=0;Q<U-1;Q++)H.push(0);H.push(1);let Y=1;for(let Q=0;Q<U;Q++){for(let _e=0;_e<H.length;_e++)H[_e]=vr.reedSolomonMultiply(H[_e],Y),_e+1<H.length&&(H[_e]^=H[_e+1]);Y=vr.reedSolomonMultiply(Y,2)}return H}static reedSolomonComputeRemainder(U,H){let Y=H.map(Q=>0);for(const Q of U){const _e=Q^Y.shift();Y.push(0),H.forEach((we,ve)=>Y[ve]^=vr.reedSolomonMultiply(we,_e))}return Y}static reedSolomonMultiply(U,H){if(U>>>8||H>>>8)throw new RangeError("Byte out of range");let Y=0;for(let Q=7;Q>=0;Q--)Y=Y<<1^(Y>>>7)*285,Y^=(H>>>Q&1)*U;return D(Y>>>8==0),Y}finderPenaltyCountPatterns(U){const H=U[1];D(H<=this.size*3);const Y=H>0&&U[2]==H&&U[3]==H*3&&U[4]==H&&U[5]==H;return(Y&&U[0]>=H*4&&U[6]>=H?1:0)+(Y&&U[6]>=H*4&&U[0]>=H?1:0)}finderPenaltyTerminateAndCount(U,H,Y){return U&&(this.finderPenaltyAddHistory(H,Y),H=0),H+=this.size,this.finderPenaltyAddHistory(H,Y),this.finderPenaltyCountPatterns(Y)}finderPenaltyAddHistory(U,H){H[0]==0&&(U+=this.size),H.pop(),H.unshift(U)}};d.MIN_VERSION=1,d.MAX_VERSION=40,d.PENALTY_N1=3,d.PENALTY_N2=3,d.PENALTY_N3=40,d.PENALTY_N4=10,d.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],d.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],c.QrCode=d;function y(h,U,H){if(U<0||U>31||h>>>U)throw new RangeError("Value out of range");for(let Y=U-1;Y>=0;Y--)H.push(h>>>Y&1)}function C(h,U){return(h>>>U&1)!=0}function D(h){if(!h)throw new Error("Assertion error")}const P=class pa{constructor(U,H,Y){if(this.mode=U,this.numChars=H,this.bitData=Y,H<0)throw new RangeError("Invalid argument");this.bitData=Y.slice()}static makeBytes(U){let H=[];for(const Y of U)y(Y,8,H);return new pa(pa.Mode.BYTE,U.length,H)}static makeNumeric(U){if(!pa.isNumeric(U))throw new RangeError("String contains non-numeric characters");let H=[];for(let Y=0;Y<U.length;){const Q=Math.min(U.length-Y,3);y(parseInt(U.substring(Y,Y+Q),10),Q*3+1,H),Y+=Q}return new pa(pa.Mode.NUMERIC,U.length,H)}static makeAlphanumeric(U){if(!pa.isAlphanumeric(U))throw new RangeError("String contains unencodable characters in alphanumeric mode");let H=[],Y;for(Y=0;Y+2<=U.length;Y+=2){let Q=pa.ALPHANUMERIC_CHARSET.indexOf(U.charAt(Y))*45;Q+=pa.ALPHANUMERIC_CHARSET.indexOf(U.charAt(Y+1)),y(Q,11,H)}return Y<U.length&&y(pa.ALPHANUMERIC_CHARSET.indexOf(U.charAt(Y)),6,H),new pa(pa.Mode.ALPHANUMERIC,U.length,H)}static makeSegments(U){return U==""?[]:pa.isNumeric(U)?[pa.makeNumeric(U)]:pa.isAlphanumeric(U)?[pa.makeAlphanumeric(U)]:[pa.makeBytes(pa.toUtf8ByteArray(U))]}static makeEci(U){let H=[];if(U<0)throw new RangeError("ECI assignment value out of range");if(U<128)y(U,8,H);else if(U<16384)y(2,2,H),y(U,14,H);else if(U<1e6)y(6,3,H),y(U,21,H);else throw new RangeError("ECI assignment value out of range");return new pa(pa.Mode.ECI,0,H)}static isNumeric(U){return pa.NUMERIC_REGEX.test(U)}static isAlphanumeric(U){return pa.ALPHANUMERIC_REGEX.test(U)}getData(){return this.bitData.slice()}static getTotalBits(U,H){let Y=0;for(const Q of U){const _e=Q.mode.numCharCountBits(H);if(Q.numChars>=1<<_e)return 1/0;Y+=4+_e+Q.bitData.length}return Y}static toUtf8ByteArray(U){U=encodeURI(U);let H=[];for(let Y=0;Y<U.length;Y++)U.charAt(Y)!="%"?H.push(U.charCodeAt(Y)):(H.push(parseInt(U.substring(Y+1,Y+3),16)),Y+=2);return H}};P.NUMERIC_REGEX=/^[0-9]*$/,P.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,P.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let N=P;c.QrSegment=P})(sp||(sp={}));(c=>{(d=>{const y=class{constructor(D,P){this.ordinal=D,this.formatBits=P}};y.LOW=new y(0,1),y.MEDIUM=new y(1,0),y.QUARTILE=new y(2,3),y.HIGH=new y(3,2),d.Ecc=y})(c.QrCode||(c.QrCode={}))})(sp||(sp={}));(c=>{(d=>{const y=class{constructor(D,P){this.modeBits=D,this.numBitsCharCount=P}numCharCountBits(D){return this.numBitsCharCount[Math.floor((D+7)/17)]}};y.NUMERIC=new y(1,[10,12,14]),y.ALPHANUMERIC=new y(2,[9,11,13]),y.BYTE=new y(4,[8,16,16]),y.KANJI=new y(8,[8,10,12]),y.ECI=new y(7,[0,0,0]),d.Mode=y})(c.QrSegment||(c.QrSegment={}))})(sp||(sp={}));var g0=sp;var x4={L:g0.QrCode.Ecc.LOW,M:g0.QrCode.Ecc.MEDIUM,Q:g0.QrCode.Ecc.QUARTILE,H:g0.QrCode.Ecc.HIGH},v2=128,w2="L",A2="#FFFFFF",E2="#000000",S2=!1,C2=1,_4=4,b4=0,v4=.1;function T2(c,d=0){const y=[];return c.forEach(function(C,D){let P=null;C.forEach(function(N,h){if(!N&&P!==null){y.push(`M${P+d} ${D+d}h${h-P}v1H${P+d}z`),P=null;return}if(h===C.length-1){if(!N)return;P===null?y.push(`M${h+d},${D+d} h1v1H${h+d}z`):y.push(`M${P+d},${D+d} h${h+1-P}v1H${P+d}z`);return}N&&P===null&&(P=h)})}),y.join("")}function I2(c,d){return c.slice().map((y,C)=>C<d.y||C>=d.y+d.h?y:y.map((D,P)=>P<d.x||P>=d.x+d.w?D:!1))}function w4(c,d,y,C){if(C==null)return null;const D=c.length+y*2,P=Math.floor(d*v4),N=D/d,h=(C.width||P)*N,U=(C.height||P)*N,H=C.x==null?c.length/2-h/2:C.x*N,Y=C.y==null?c.length/2-U/2:C.y*N,Q=C.opacity==null?1:C.opacity;let _e=null;if(C.excavate){let ve=Math.floor(H),me=Math.floor(Y),he=Math.ceil(h+H-ve),Re=Math.ceil(U+Y-me);_e={x:ve,y:me,w:he,h:Re}}const we=C.crossOrigin;return{x:H,y:Y,h:U,w:h,excavation:_e,opacity:Q,crossOrigin:we}}function A4(c,d){return d!=null?Math.max(Math.floor(d),0):c?_4:b4}function M2({value:c,level:d,minVersion:y,includeMargin:C,marginSize:D,imageSettings:P,size:N,boostLevel:h}){let U=ta.useMemo(()=>{const ve=(Array.isArray(c)?c:[c]).reduce((me,he)=>(me.push(...g0.QrSegment.makeSegments(he)),me),[]);return g0.QrCode.encodeSegments(ve,x4[d],y,void 0,void 0,h)},[c,d,y,h]);const{cells:H,margin:Y,numCells:Q,calculatedImageSettings:_e}=ta.useMemo(()=>{let we=U.getModules();const ve=A4(C,D),me=we.length+ve*2,he=w4(we,N,ve,P);return{cells:we,margin:ve,numCells:me,calculatedImageSettings:he}},[U,N,P,C,D]);return{qrcode:U,margin:Y,cells:H,numCells:Q,calculatedImageSettings:_e}}var E4=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),S4=ta.forwardRef(function(d,y){const C=d,{value:D,size:P=v2,level:N=w2,bgColor:h=A2,fgColor:U=E2,includeMargin:H=S2,minVersion:Y=C2,boostLevel:Q,marginSize:_e,imageSettings:we}=C,me=By(C,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:he}=me,Re=By(me,["style"]),tt=we?.src,Ye=ta.useRef(null),pt=ta.useRef(null),Wt=ta.useCallback(Zt=>{Ye.current=Zt,typeof y=="function"?y(Zt):y&&(y.current=Zt)},[y]),[Et,it]=ta.useState(!1),{margin:at,cells:He,numCells:xt,calculatedImageSettings:Pe}=M2({value:D,level:N,minVersion:Y,boostLevel:Q,includeMargin:H,marginSize:_e,imageSettings:we,size:P});ta.useEffect(()=>{if(Ye.current!=null){const Zt=Ye.current,Ne=Zt.getContext("2d");if(!Ne)return;let Te=He;const We=pt.current,wt=Pe!=null&&We!==null&&We.complete&&We.naturalHeight!==0&&We.naturalWidth!==0;wt&&Pe.excavation!=null&&(Te=I2(He,Pe.excavation));const zt=window.devicePixelRatio||1;Zt.height=Zt.width=P*zt;const Gt=P/xt*zt;Ne.scale(Gt,Gt),Ne.fillStyle=h,Ne.fillRect(0,0,xt,xt),Ne.fillStyle=U,E4?Ne.fill(new Path2D(T2(Te,at))):He.forEach(function(ke,nt){ke.forEach(function(Nt,_t){Nt&&Ne.fillRect(_t+at,nt+at,1,1)})}),Pe&&(Ne.globalAlpha=Pe.opacity),wt&&Ne.drawImage(We,Pe.x+at,Pe.y+at,Pe.w,Pe.h)}}),ta.useEffect(()=>{it(!1)},[tt]);const ct=Ly({height:P,width:P},he);let vt=null;return tt!=null&&(vt=ta.createElement("img",{src:tt,key:tt,style:{display:"none"},onLoad:()=>{it(!0)},ref:pt,crossOrigin:Pe?.crossOrigin})),ta.createElement(ta.Fragment,null,ta.createElement("canvas",Ly({style:ct,height:P,width:P,ref:Wt,role:"img"},Re)),vt)});S4.displayName="QRCodeCanvas";var N1=ta.forwardRef(function(d,y){const C=d,{value:D,size:P=v2,level:N=w2,bgColor:h=A2,fgColor:U=E2,includeMargin:H=S2,minVersion:Y=C2,boostLevel:Q,title:_e,marginSize:we,imageSettings:ve}=C,me=By(C,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:he,cells:Re,numCells:tt,calculatedImageSettings:Ye}=M2({value:D,level:N,minVersion:Y,boostLevel:Q,includeMargin:H,marginSize:we,imageSettings:ve,size:P});let pt=Re,Wt=null;ve!=null&&Ye!=null&&(Ye.excavation!=null&&(pt=I2(Re,Ye.excavation)),Wt=ta.createElement("image",{href:ve.src,height:Ye.h,width:Ye.w,x:Ye.x+he,y:Ye.y+he,preserveAspectRatio:"none",opacity:Ye.opacity,crossOrigin:Ye.crossOrigin}));const Et=T2(pt,he);return ta.createElement("svg",Ly({height:P,width:P,viewBox:`0 0 ${tt} ${tt}`,ref:y,role:"img"},me),!!_e&&ta.createElement("title",null,_e),ta.createElement("path",{fill:h,d:`M0,0 h${tt}v${tt}H0z`,shapeRendering:"crispEdges"}),ta.createElement("path",{fill:U,d:Et,shapeRendering:"crispEdges"}),Wt)});N1.displayName="QRCodeSVG";const C4=({setHistorySpots:c,onOpenChange:d,onHelpClick:y})=>{const{pubkey:C,logout:D,deleteAccount:P,pool:N,signEvent:h,refreshConnections:U}=nh(),{logs:H,markDeleted:Y}=m4(),[Q,_e]=ge.useState(!1),[we,ve]=ge.useState(!1),[me,he]=ge.useState(!1),[Re,tt]=ge.useState(!1),[Ye,pt]=ge.useState(!1),[Wt,Et]=ge.useState(""),[it,at]=ge.useState([...ei]),[He,xt]=ge.useState(!1),[Pe,ct]=ge.useState(!1),[vt,Zt]=ge.useState(""),[Ne,Te]=ge.useState(!1),[We,wt]=ge.useState(null),[zt,Gt]=ge.useState(new Map);ge.useEffect(()=>vo.subscribe(de=>{Gt(new Map(de))}),[]);const[ke,nt]=ge.useState([]),[Nt,_t]=ge.useState(!1);ge.useEffect(()=>{if(Q)try{const de=localStorage.getItem("parlens-hidden-items");de&&nt(JSON.parse(de))}catch{}},[Q]);const tn=de=>{const Ze=ke.filter(yt=>yt.id!==de);nt(Ze),localStorage.setItem("parlens-hidden-items",JSON.stringify(Ze))};ge.useEffect(()=>{d?.(Q)},[Q,d]);const[Bt,Kt]=ge.useState(null),[an,sn]=ge.useState([]),[Nn,Dn]=ge.useState(!1),[si,kn]=ge.useState(()=>{const de=localStorage.getItem("parlens_show_parking_areas");return de?JSON.parse(de):!0}),[ui,_i]=ge.useState(()=>localStorage.getItem("parlens_parking_area_filter")||"all"),[Di,qn]=ge.useState(()=>{const de=localStorage.getItem("parlens_share_parking_areas");return de?JSON.parse(de):!1}),[Gn,In]=ge.useState("all"),[vi,nn]=ge.useState(null),[Li,Ki]=ge.useState(""),[Pi,xr]=ge.useState(!1),gt=async de=>{if(!(!C||!confirm("Are you sure you want to delete this parking entry? This action cannot be undone."))){ve(!0);try{const Ze=de.tags?.find(At=>At[0]==="d")?.[1];if(!Ze)throw new Error("Missing d tag on event");const yt={kind:5,content:"Deleted by user",tags:[["a",`${Ln.PARKING_LOG}:${C}:${Ze}`],["k",String(Ln.PARKING_LOG)]],created_at:Math.floor(Date.now()/1e3),pubkey:C},Oe=await h(yt);await Promise.allSettled(N.publish(ei,Oe)),Y(Ze),sn(At=>At.filter(jt=>jt.id!==de.id))}catch(Ze){console.error("Failed to delete parking log:",Ze),alert("Failed to delete. Please try again.")}finally{ve(!1)}}};ge.useEffect(()=>{C&&(async()=>{const Ze=await N.get(ei,{kinds:[0],authors:[C]});if(Ze)try{const yt=JSON.parse(Ze.content);Kt({name:yt.name||yt.display_name||"Nostr User",npub:Jf.npubEncode(C),picture:yt.picture})}catch(yt){console.error("Error parsing profile:",yt)}else Bt||Kt({name:"Nostr User",npub:Jf.npubEncode(C),picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${C}`})})()},[C,N]),ge.useEffect(()=>{(async()=>{if(!C||!H.length)return;const Ze=localStorage.getItem("parlens_privkey"),yt=Ze?new Uint8Array(Ze.match(/.{1,2}/g).map(At=>parseInt(At,16))):void 0,Oe=await Promise.all(H.map(async At=>{try{const jt=await Tx(At.content,C,yt);return{...At,decryptedContent:jt}}catch{return{...At,decryptedContent:null}}}));sn(Oe.filter(At=>At.decryptedContent))})()},[H,C]),ge.useEffect(()=>{c&&c(Nn?an:[])},[Nn,an,c]);const oe=()=>{const de=localStorage.getItem("parlens_privkey");if(de){const Ze=Jf.nsecEncode(new Uint8Array(de.match(/.{1,2}/g).map(yt=>parseInt(yt,16))));navigator.clipboard.writeText(Ze),alert("Copied to clipboard")}},ce=(de,Ze)=>{if(!de)return"Unknown";const yt=Ze.getTime()-de.getTime(),Oe=Math.floor(yt/1e3),At=Math.floor(Oe/3600),jt=Math.floor(Oe%3600/60),_n=Oe%60;return At>0?`${At}h ${jt}m ${_n}s`:jt>0?`${jt}m ${_n}s`:`${_n}s`},pe=async(de,Ze)=>{if(!(!C||!h)){xr(!0);try{const yt=de.tags?.find(ut=>ut[0]==="d")?.[1];if(!yt)throw new Error("Missing d tag");const Oe=localStorage.getItem("parlens_privkey"),At=Oe?new Uint8Array(Oe.match(/.{1,2}/g).map(ut=>parseInt(ut,16))):void 0,jt={...de.decryptedContent,note:Ze},_n=await Bg(jt,C,At),mn={kind:Ln.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",yt],["client","parlens"]],content:_n},ti=await h(mn);await Promise.allSettled(N.publish(ei,ti)),sn(ut=>ut.map(ai=>ai.id===de.id?{...ai,decryptedContent:jt}:ai)),nn(null),Ki("")}catch(yt){console.error("Failed to update note:",yt),alert("Failed to save note")}finally{xr(!1)}}},je=ge.useMemo(()=>an.filter(de=>{const yt=de.decryptedContent.type||"car";return!(Gn!=="all"&&yt!==Gn)}),[an,Gn]),Je=async de=>{if(!N||!C||!h)return;const Ze={kind:Ln.RELAY_LIST,created_at:Math.floor(Date.now()/1e3),tags:de.map(Oe=>["r",Oe]),content:""},yt=await h(Ze);await Promise.allSettled(N.publish(ei,yt)),at(de)},St=async()=>{const de=vt.trim();if(wt(null),!de.startsWith("wss://")){wt("Relay URL must start with wss://");return}if(it.includes(de)){wt("This relay is already in your list");return}Te(!0);try{await Je([...it,de]),Zt(""),ct(!1)}catch(Ze){console.error("Error adding relay:",Ze),wt("Failed to add relay")}finally{Te(!1)}},rt=async de=>{if(confirm(`Are you sure you want to remove this relay?

${de}

This action cannot be undone.`)){Te(!0);try{await Je(it.filter(Ze=>Ze!==de))}catch(Ze){console.error("Error removing relay:",Ze),alert("Failed to remove relay")}finally{Te(!1)}}};return M.jsxs(M.Fragment,{children:[M.jsx("button",{onClick:()=>{_e(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Activity Log",children:M.jsx(ET,{size:20})}),Q&&M.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[M.jsx("button",{onClick:()=>_e(!1),className:"absolute inset-0 z-0 cursor-default"}),we&&M.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:M.jsxs("div",{className:"flex flex-col items-center gap-3",children:[M.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),M.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),me&&M.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm animate-in fade-in",onClick:()=>he(!1),children:M.jsxs("div",{className:"w-[90%] max-w-sm bg-white dark:bg-[#1c1c1e] rounded-2xl p-6 space-y-4 border border-black/5 dark:border-white/10 shadow-2xl animate-in zoom-in-95",onClick:de=>de.stopPropagation(),children:[M.jsxs("div",{className:"flex items-center gap-3 text-red-500",children:[M.jsx(bT,{size:24}),M.jsx("h3",{className:"text-lg font-bold",children:"Delete Account?"})]}),M.jsx("p",{className:"text-zinc-600 dark:text-white/70 text-sm leading-relaxed",children:"This action is permanent and cannot be undone."}),M.jsxs("div",{className:"flex gap-3 pt-2",children:[M.jsx("button",{onClick:()=>he(!1),className:"flex-1 py-3 rounded-xl bg-zinc-100 dark:bg-white/10 text-zinc-900 dark:text-white font-bold",children:"Cancel"}),M.jsx("button",{onClick:async()=>{he(!1),ve(!0),await P(),ve(!1),_e(!1)},className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-bold shadow-lg shadow-red-500/20",children:"Delete"})]})]})}),M.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[M.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent truncate max-w-[180px]",children:Bt?.name||"Nostr User"}),M.jsx("button",{onClick:()=>tt(!Re),className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform shrink-0",title:Re?"Back to profile":"Show npub QR Code",children:Re?M.jsx(Ex,{size:20}):M.jsx(r2,{size:20})})]}),M.jsxs("div",{className:"flex gap-4 items-center",children:[M.jsx("button",{onClick:()=>y?.(),className:"w-10 h-10 flex items-center justify-center rounded-full bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 active:scale-95 transition-all",children:M.jsx("span",{className:"text-xl font-bold",children:"?"})}),M.jsx("button",{onClick:()=>_e(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform",children:M.jsx(no,{size:20})})]})]}),Ye&&M.jsx("div",{className:"fixed inset-0 z-[2100] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in",children:M.jsxs("div",{className:"w-[90%] max-w-xs bg-white dark:bg-zinc-800 rounded-2xl p-5 shadow-xl border border-black/10 dark:border-white/10 space-y-4",children:[M.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white text-center",children:"Edit Username"}),M.jsx("input",{type:"text",value:Wt,onChange:de=>Et(de.target.value),className:"w-full px-4 py-3 rounded-xl bg-zinc-100 dark:bg-white/10 text-zinc-900 dark:text-white text-center font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onFocus:de=>de.target.select(),placeholder:"Enter username"}),M.jsxs("div",{className:"flex gap-3",children:[M.jsx("button",{onClick:()=>pt(!1),className:"flex-1 py-2.5 rounded-xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-medium active:scale-95 transition-transform",children:"Cancel"}),M.jsx("button",{onClick:async()=>{if(!(!N||!h||!C))try{const de={kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:Wt.trim()||"Nostr User"})},Ze=await h(de);await Promise.allSettled(N.publish(ei,Ze)),pt(!1)}catch(de){console.error("Failed to update username:",de),alert("Failed to update username")}},className:"flex-1 py-2.5 rounded-xl bg-[#007AFF] text-white font-medium active:scale-95 transition-transform",children:"Confirm"})]})]})}),Re?M.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-4",children:[M.jsx(N1,{value:Bt?.npub||"",size:200,level:"M",bgColor:"transparent",fgColor:"currentColor",className:"text-zinc-900 dark:text-white"}),M.jsx("button",{onClick:()=>{navigator.clipboard.writeText(Bt?.npub||""),alert("npub copied to clipboard")},className:"text-xs text-zinc-500 dark:text-zinc-400 font-mono break-all text-center px-4 active:text-zinc-900 dark:active:text-white transition-colors",children:Bt?.npub}),M.jsxs("button",{onClick:()=>{Et(Bt?.name||""),pt(!0)},className:"flex items-center gap-2 px-4 py-2 rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform text-sm font-medium",children:[M.jsx(Vd,{size:14}),"Edit Username"]})]}):M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"space-y-4",children:[M.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"My Keys"}),M.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[M.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer",onClick:()=>{navigator.clipboard.writeText(Bt?.npub),alert("Copied to clipboard")},children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400",children:M.jsx(Oy,{size:20})}),M.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),M.jsx(ip,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),localStorage.getItem("parlens_privkey")&&M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),M.jsxs("div",{onClick:oe,className:"flex items-center justify-between p-4 cursor-pointer transition-colors active:bg-black/10 dark:active:bg-white/10",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-500",children:M.jsx(o2,{size:20})}),M.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),M.jsx(ip,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]})]}),M.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:"Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost. Use these keys to login to any Nostr client."})]}),M.jsxs("div",{className:"space-y-4",children:[M.jsxs("div",{className:"flex items-center justify-between ml-2 pr-2",children:[M.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:"Preferred Relays"}),M.jsx("button",{onClick:async de=>{de.stopPropagation(),Te(!0);try{await U()}catch(Ze){console.error("Refresh failed:",Ze)}finally{Te(!1)}},disabled:Ne,className:`p-1.5 rounded-full bg-zinc-100 dark:bg-white/5 text-zinc-400 dark:text-white/30 active:scale-95 transition-all flex items-center justify-center ${Ne?"text-zinc-500 dark:text-white/50 cursor-not-allowed":""}`,title:"Refresh Connections",children:M.jsx(sT,{size:14,className:`origin-center ${Ne?"animate-spin":""}`})})]}),M.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[M.jsxs("button",{onClick:()=>xt(!He),className:"w-full p-5 flex items-center justify-between transition-colors",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"p-2.5 rounded-xl bg-green-500/10 dark:bg-green-500/20 text-green-500 dark:text-green-400",children:M.jsx(E_,{size:20})}),M.jsxs("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:["Manage Relays (",it.length,")"]})]}),M.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:He?"Hide":"Show"})]}),He&&M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),M.jsx("div",{className:"p-4 space-y-2",children:Ne&&it.length===0?M.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):M.jsxs(M.Fragment,{children:[it.map(de=>M.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10",children:[M.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[M.jsx(E_,{size:16,className:`shrink-0 ${zt.get(de)?.connected?"text-green-500":"text-zinc-400"}`}),M.jsx("span",{className:"text-sm text-zinc-700 dark:text-white truncate",children:de.replace("wss://","")})]}),M.jsx("button",{onClick:()=>rt(de),disabled:it.length<=1,className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform disabled:opacity-30 disabled:cursor-not-allowed",title:it.length<=1?"At least one relay is required":"Remove relay",children:M.jsx(rp,{size:16})})]},de)),M.jsxs("button",{onClick:()=>{ct(!0),wt(null),Zt("")},className:"w-full p-3 flex items-center justify-center gap-2 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors active:scale-[0.98]",children:[M.jsx(o1,{size:16,className:"text-blue-500"}),M.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Relay"})]})]})})]})]}),M.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:"Relay address(es) listed in this section tell Parlens where to look for and store data. Parlens requires a connection to at least one relay to work."}),Pe&&M.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",onClick:()=>ct(!1),children:M.jsxs("div",{className:"w-[90%] max-w-sm bg-white dark:bg-[#2c2c2e] rounded-2xl p-5 space-y-4 animate-in zoom-in-95 duration-200",onClick:de=>de.stopPropagation(),children:[M.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"Add Relay"}),M.jsxs("div",{className:"space-y-2",children:[M.jsx("input",{type:"text",value:vt,onChange:de=>{Zt(de.target.value),wt(null)},placeholder:"wss://relay.example.com",className:"w-full h-12 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onKeyDown:de=>{de.key==="Enter"&&St(),de.key==="Escape"&&ct(!1)}}),We&&M.jsx("p",{className:"text-xs text-red-500 ml-1",children:We})]}),M.jsxs("div",{className:"flex gap-3",children:[M.jsx("button",{onClick:()=>ct(!1),className:"flex-1 h-11 rounded-xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-medium transition-all active:scale-95",children:"Cancel"}),M.jsx("button",{onClick:St,disabled:Ne||!vt.trim(),className:"flex-1 h-11 rounded-xl bg-[#007AFF] text-white font-medium disabled:opacity-50 transition-all active:scale-95",children:Ne?"...":"Add"})]})]})}),M.jsxs("div",{className:"space-y-4",children:[M.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Hide List"}),M.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[M.jsxs("button",{onClick:()=>_t(!Nt),className:"w-full p-5 flex items-center justify-between transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"p-2.5 rounded-xl bg-amber-500/10 dark:bg-amber-500/20 text-amber-500",children:M.jsx(Cx,{size:20})}),M.jsxs("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:["Manage List (",ke.length,")"]})]}),M.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:Nt?"Hide":"Show"})]}),Nt&&M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),M.jsx("div",{className:"p-4 space-y-2",children:ke.length===0?M.jsx("p",{className:"text-sm text-zinc-400 dark:text-white/40 text-center py-2",children:"No hidden items"}):ke.map(de=>M.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10",children:[M.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[M.jsx("span",{className:"shrink-0",children:de.type==="listing"?"":""}),M.jsx("span",{className:"text-sm text-zinc-600 dark:text-white/70 truncate",children:de.name}),M.jsx("span",{className:"shrink-0 text-[10px] uppercase px-1.5 py-0.5 rounded-full bg-zinc-100 dark:bg-white/10 text-zinc-400",children:de.type})]}),M.jsx("button",{onClick:()=>tn(de.id),className:"p-2 text-zinc-400 hover:text-green-500 transition-colors shrink-0",style:{WebkitTapHighlightColor:"transparent"},children:M.jsx(ep,{size:16})})]},de.id))})]})]}),M.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 text-left ml-2",children:"Items you hide in the listed parking page can be managed here."})]}),M.jsxs("div",{className:"space-y-4",children:[M.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking Areas"}),M.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-xl bg-zinc-500/10 dark:bg-zinc-500/20 text-zinc-500 dark:text-zinc-400",children:M.jsx("span",{className:"text-base font-bold",children:"P"})}),M.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show parking areas on map"})]}),M.jsx("button",{onClick:()=>{const de=!si;kn(de),localStorage.setItem("parlens_show_parking_areas",JSON.stringify(de))},className:`w-12 h-7 rounded-full transition-colors relative ${si?"bg-[#007AFF]":"bg-zinc-200 dark:bg-white/20"}`,children:M.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${si?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),si&&M.jsxs("div",{className:"flex items-center justify-between ml-2",children:[M.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/30",children:"See areas reported since:"}),M.jsxs("select",{value:ui,onChange:de=>{const Ze=de.target.value;_i(Ze),localStorage.setItem("parlens_parking_area_filter",Ze)},className:"px-2 py-1.5 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6",children:[M.jsx("option",{value:"today",children:"Today"}),M.jsx("option",{value:"week",children:"This Week"}),M.jsx("option",{value:"month",children:"This Month"}),M.jsx("option",{value:"year",children:"This Year"}),M.jsx("option",{value:"all",children:"All Time"})]})]}),M.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-xl bg-green-500/10 dark:bg-green-500/20 text-green-500 dark:text-green-400",children:M.jsx(pT,{size:20})}),M.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Share parking area reports"})]}),M.jsx("button",{onClick:()=>{const de=!Di;qn(de),localStorage.setItem("parlens_share_parking_areas",JSON.stringify(de))},className:`w-12 h-7 rounded-full transition-colors relative ${Di?"bg-[#007AFF]":"bg-zinc-200 dark:bg-white/20"}`,children:M.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${Di?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),M.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 text-left ml-2 leading-relaxed",children:"Parking areas are reported anonymously shortly after you complete a session. Sharing reports will help other users know where to find parking when visiting the area."})]}),M.jsxs("div",{className:"space-y-4",children:[M.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking History"}),c&&M.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-xl bg-purple-500/10 dark:bg-purple-500/20 text-purple-500 dark:text-purple-400",children:M.jsx(to,{size:20})}),M.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show logs on map"})]}),M.jsx("button",{onClick:()=>Dn(!Nn),className:`w-12 h-7 rounded-full transition-colors relative ${Nn?"bg-[#007AFF]":"bg-zinc-200 dark:bg-white/20"}`,children:M.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${Nn?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),M.jsx("div",{className:"space-y-3",children:M.jsx("div",{className:"flex justify-between items-center gap-2 p-1 bg-zinc-100 dark:bg-white/5 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:["all","bicycle","motorcycle","car"].map(de=>M.jsx("button",{onClick:()=>In(de),className:`flex-1 flex items-center justify-center py-2.5 rounded-[1.2rem] text-sm transition-all active:scale-95 ${Gn===de?"bg-white dark:bg-white/10 text-zinc-900 dark:text-white font-bold shadow-sm":"text-zinc-400 dark:text-white/40 hover:text-zinc-600 dark:hover:text-white/60"}`,children:de==="all"?"All":M.jsx("span",{className:"text-xl",children:de==="bicycle"?"":de==="motorcycle"?"":""})},de))})}),je.length>0?je.map(de=>{const Ze=de.decryptedContent,yt=tp(Ze.currency||"USD"),Oe=Ze.started_at?new Date(Ze.started_at*1e3):null,At=Ze.finished_at?new Date(Ze.finished_at*1e3):new Date(de.created_at*1e3),jt=Ze.lat&&Ze.lon?`${Ze.lat.toFixed(5)}, ${Ze.lon.toFixed(5)}`:null,_n=ce(Oe,At),mn=Oe?Oe.toLocaleDateString(void 0,{month:"short",day:"numeric"}):At.toLocaleDateString(void 0,{month:"short",day:"numeric"}),ti=Oe?Oe.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"}):"",ut=ti?`${mn}, ${ti}`:mn,ai=Ze.type||"car",Qn=ai==="bicycle"?"":ai==="motorcycle"?"":"",Kn=vi===de.id;return M.jsxs("div",{className:"p-5 rounded-[2rem] bg-zinc-50 dark:bg-white/[0.03] space-y-3 border border-black/5 dark:border-white/5 text-zinc-900 dark:text-white",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("span",{className:"text-2xl",children:Qn}),M.jsx("p",{className:"font-bold text-xl",children:`${yt}${Ze.fee||"0"}`})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx("span",{className:"text-2xl",children:u4(Ze.currency||"USD")}),M.jsx("button",{onClick:()=>gt(de),className:"p-1.5 text-zinc-400 dark:text-white/30 transition-colors",title:"Delete entry",children:M.jsx(rp,{size:16})})]})]}),M.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[M.jsxs("div",{className:"flex items-center gap-2 text-zinc-500 dark:text-white/50",children:[M.jsx(n2,{size:12,className:"text-green-500 dark:text-green-400"}),M.jsx("span",{className:"font-semibold",children:_n})]}),M.jsx("span",{className:"text-zinc-400 dark:text-white/30",children:ut})]}),jt&&M.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[M.jsx(to,{size:12,className:"text-[#007AFF]"}),M.jsx("span",{className:"font-mono",children:jt})]}),M.jsx("div",{className:"flex items-center gap-2 text-xs text-zinc-500 dark:text-white/50 bg-zinc-100 dark:bg-white/5 rounded-lg px-3 py-2",children:Kn?M.jsxs(M.Fragment,{children:[M.jsx("input",{type:"text",value:Li,onChange:Jn=>Ki(Jn.target.value),placeholder:"Add note",className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-[#007AFF]",autoFocus:!0,onFocus:Jn=>Jn.currentTarget.select(),onKeyDown:Jn=>{Jn.key==="Enter"&&pe(de,Li),Jn.key==="Escape"&&nn(null)}}),M.jsx("button",{onClick:()=>pe(de,Li),disabled:Pi,className:"p-2 rounded-xl text-green-500 bg-green-500/10 transition-colors disabled:opacity-50",children:M.jsx(ep,{size:16})}),M.jsx("button",{onClick:()=>nn(null),className:"p-2 rounded-xl text-zinc-400 bg-zinc-500/10 transition-colors",children:M.jsx(no,{size:16})})]}):M.jsxs(M.Fragment,{children:[M.jsx("span",{className:`flex-1 text-left cursor-pointer ${Ze.note?"":"text-zinc-400 dark:text-white/30"}`,onClick:()=>{nn(de.id),Ki(Ze.note||"")},children:Ze.note||"Add note"}),M.jsx("button",{onClick:()=>{nn(de.id),Ki(Ze.note||"")},className:"p-1 text-zinc-400 dark:text-white/30 shrink-0",children:M.jsx(Vd,{size:12})})]})})]},de.id)}):M.jsx("div",{className:"p-10 rounded-[2.5rem] border-2 border-dashed border-black/5 dark:border-white/5 text-center",children:M.jsx("p",{className:"text-sm font-medium text-zinc-400 dark:text-white/10",children:an.length>0?"No entries match filters":"No recent activity"})})]})]}),M.jsx("button",{onClick:()=>{confirm("Are you sure you want to logout?")&&(D(),_e(!1))},className:"w-full py-4 rounded-[1.5rem] bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 font-bold tracking-wide border border-black/5 dark:border-white/5 transition-all active:scale-95 text-center mt-4",children:"Logout"}),M.jsx("button",{onClick:()=>he(!0),className:"w-full py-4 rounded-[1.5rem] text-red-500 font-bold tracking-wide transition-all active:scale-95 text-center active:bg-red-500/5",children:"Delete Account"})]})]})]})]})},T4=({vehicleType:c,onRouteChange:d,currentLocation:y,onDropPinModeChange:C,pendingWaypoints:D,onDropPinConsumed:P,onOpenChange:N,onWaypointsChange:h,onRequestOrientationPermission:U,isOpen:H,onClose:Y,hideTrigger:Q,onRouteCreated:_e})=>{const{pool:we,pubkey:ve,signEvent:me}=nh(),[he,Re]=ge.useState(!1),tt=H!==void 0?H:he,Ye=Oe=>{Re(Oe),!Oe&&Y&&Y()};ge.useEffect(()=>{N?.(tt)},[tt,N]);const[pt,Wt]=ge.useState([]);ge.useEffect(()=>{h?.(pt)},[pt,h]);const[Et,it]=ge.useState(""),[at,He]=ge.useState(!1),[xt,Pe]=ge.useState(null),[ct,vt]=ge.useState(null),[Zt,Ne]=ge.useState(!1),Te=ge.useRef(null),We=ge.useRef(!1),[wt,zt]=ge.useState([]),[Gt,ke]=ge.useState(""),[nt,Nt]=ge.useState(!1),[_t,tn]=ge.useState(!1),[Bt,Kt]=ge.useState(!1),[an,sn]=ge.useState(!1),[Nn,Dn]=ge.useState(null),[si,kn]=ge.useState(""),[ui,_i]=ge.useState(!1),[Di,qn]=ge.useState(null),[Gn,In]=ge.useState({}),[vi,nn]=ge.useState([]);ge.useEffect(()=>{if(!Et||Et.length<3){nn([]);return}if(Rl(Et))return;const Oe=setTimeout(()=>{Rg(Et,Di,y,1).then(nn).catch(console.error)},500);return()=>clearTimeout(Oe)},[Et,Di,y]);const Li=ge.useRef(new Set);ge.useEffect(()=>{(async()=>{if(!(!y||Di))try{const jt=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${y[0]}&lon=${y[1]}&format=json`)).json();jt&&jt.address&&jt.address.country_code&&(console.log("[Parlens] Detected Country:",jt.address.country_code),qn(jt.address.country_code))}catch(At){console.error("[Parlens] Failed to detect country:",At)}})()},[y,Di]);const Ki=ta.useMemo(()=>{if(!Et||Et.length<2)return[];const Oe=Et.toLowerCase(),At=[];for(const jt of wt)for(const _n of jt.decryptedContent.waypoints)_n.name.toLowerCase().includes(Oe)&&(At.find(mn=>mn.name.toLowerCase()===_n.name.toLowerCase())||At.push({name:_n.name,lat:_n.lat,lon:_n.lon}));return At.slice(0,5)},[Et,wt]),Pi=Oe=>{const At=pt.filter(jt=>jt.id!==Oe);Wt(At),Pe(null),vt(null),He(!1),d(null,null,At,!1)},xr=()=>{Wt([]),Pe(null),vt(null),He(!1),d(null,null,[],!1)},gt=(Oe,At)=>{if(Oe+At<0||Oe+At>=pt.length)return;const jt=[...pt];[jt[Oe],jt[Oe+At]]=[jt[Oe+At],jt[Oe]],Wt(jt),Pe(null),vt(null),He(!1),d(null,null,jt,!1)},oe=()=>{const Oe=[...pt].reverse();Wt(Oe),Pe(null),vt(null),He(!1),d(null,null,Oe,!1)},ce=async()=>{if(pt.length<2){alert("Add at least 2 waypoints to create a route");return}Ne(!0);try{const At={bicycle:"bike",motorcycle:"driving",car:"driving"}[c],jt=[],_n=[],mn={};for(let Qn=0;Qn<pt.length-1;Qn++){const Kn=pt[Qn],Jn=pt[Qn+1],lr=`${Kn.lon},${Kn.lat};${Jn.lon},${Jn.lat}`;console.log(`[Parlens] Fetching segment ${Qn+1}: ${Kn.name}  ${Jn.name}`);const Mi=await fetch(`https://router.project-osrm.org/route/v1/${At}/${lr}?overview=full&geometries=geojson&alternatives=true`);if(!Mi.ok)throw new Error(`OSRM error: ${Mi.status}`);const ni=await Mi.json();if(ni.code==="Ok"&&ni.routes&&ni.routes[0]){if(ni.waypoints&&ni.waypoints.length>=2){const Ei=ni.waypoints[0].location,Bi=ni.waypoints[1].location;mn[Qn]||(mn[Qn]={lat:Ei[1],lon:Ei[0]}),mn[Qn+1]={lat:Bi[1],lon:Bi[0]}}const zi=ni.routes[0].geometry.coordinates.map(Ei=>[Ei[1],Ei[0]]);if(jt.push(zi),ni.routes.length>1){const Ei=ni.routes[1].geometry.coordinates.map(Bi=>[Bi[1],Bi[0]]);_n.push(Ei),console.log(`[Parlens] Segment ${Qn+1} has alternate route`)}else _n.push(zi),console.log(`[Parlens] Segment ${Qn+1} has no alternate, using primary`)}else throw new Error(`No route found for segment ${Qn+1}`)}const ti=[],ut=[];for(let Qn=0;Qn<jt.length;Qn++){const Kn=Qn===0?0:1;ti.push(...jt[Qn].slice(Kn)),ut.push(..._n[Qn].slice(Kn))}console.log("[Parlens] Combined primary route:",ti.length,"points"),console.log("[Parlens] Combined alternate route:",ut.length,"points"),Pe(ti),vt(ut),In(mn),He(!0);const ai=Object.keys(mn).length===pt.length?pt.map((Qn,Kn)=>({...Qn,...mn[Kn]})):pt;d(ti,ut,ai.map(Qn=>({lat:Qn.lat,lon:Qn.lon})),!0),U&&U(),Ye(!1),_e?.()}catch(Oe){console.error("Route creation error:",Oe);const At=pt.map(jt=>[jt.lat,jt.lon]);Pe(At),vt(null),In({}),He(!0),d(At,null,pt.map(jt=>({lat:jt.lat,lon:jt.lon})),!0),Ye(!1),_e?.()}finally{Ne(!1)}},pe=()=>{const Oe=!at;He(Oe);const At=Object.keys(Gn).length===pt.length?pt.map((jt,_n)=>({...jt,...Gn[_n]})):pt;d(xt,ct,At.map(jt=>({lat:jt.lat,lon:jt.lon})),Oe)},je=ge.useCallback(async()=>{if(!(!we||!ve)){tn(!0);try{const Oe=await we.querySync(ei,{kinds:[Ln.ROUTE_LOG],authors:[ve]});console.log("[Parlens] Fetched route events:",Oe.length);const At=localStorage.getItem("parlens_privkey"),jt=At?new Uint8Array(At.match(/.{1,2}/g).map(mn=>parseInt(mn,16))):void 0,_n=[];for(const mn of Oe){if(mn.tags.find(ut=>ut[0]==="deleted"))continue;const ti=mn.tags.find(ut=>ut[0]==="d")?.[1]||"";if(!(ti&&Li.current.has(ti))&&mn.content)try{const ut=await Tx(mn.content,ve,jt);if(ut){const ai=mn.tags.find(Qn=>Qn[0]==="d")?.[1]||"";_n.push({id:mn.id,dTag:ai,decryptedContent:ut,created_at:mn.created_at})}}catch(ut){console.warn("[Parlens] Failed to decrypt route:",ut)}}zt(mn=>{const ti=new Map;mn.forEach(ai=>ti.set(ai.id,ai)),_n.forEach(ai=>ti.set(ai.id,ai));const ut=Array.from(ti.values()).sort((ai,Qn)=>Qn.created_at-ai.created_at);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(ut))}catch(ai){console.warn("[Parlens] Failed to cache routes:",ai)}return ut})}catch(Oe){console.error("Error fetching saved routes:",Oe)}finally{tn(!1)}}},[we,ve]);ge.useEffect(()=>{if(tt&&ve){try{const Oe=localStorage.getItem("parlens_route_cache_v1");if(Oe){const At=JSON.parse(Oe);zt(At)}}catch(Oe){console.warn("[Parlens] Failed to load cached routes:",Oe)}je()}},[tt,ve,je]);const Je=()=>{const Oe=!an;sn(Oe),C?.(Oe),Oe&&(Ye(!1),h?.(pt))};ge.useEffect(()=>{if(D){if(D.length>0){const Oe=D.some(mn=>mn.name==="Current Location"),At=D.map((mn,ti)=>({id:crypto.randomUUID(),name:mn.name||`Pin ${(Oe?0:pt.length)+ti+1}`,lat:mn.lat,lon:mn.lon})),jt=Oe?At:[...pt,...At],_n=jt.length;Wt(jt),Pe(null),vt(null),He(!1),d(null,null,jt,!1),In({}),Oe&&_n>=2&&(We.current=!0)}P?.(),We.current||Ye(!0),C?.(!1)}},[D,P,C,d]),ge.useEffect(()=>{We.current&&pt.length>=2&&(We.current=!1,ce())},[pt]);const St=async()=>{if(!we||!ve||!me||!xt||pt.length<2){alert("Please create a route first");return}const Oe=Gt.trim()||`Route ${new Date().toLocaleDateString()}`;Nt(!0);try{const At=Object.keys(Gn).length===pt.length?pt.map((ni,zi)=>({name:ni.name,lat:Gn[zi].lat,lon:Gn[zi].lon})):pt.map(ni=>({name:ni.name,lat:ni.lat,lon:ni.lon})),jt={name:Oe,waypoints:At,routeCoords:xt,alternateRouteCoords:ct||void 0,vehicleType:c,created_at:Math.floor(Date.now()/1e3)},_n=localStorage.getItem("parlens_privkey"),mn=_n?new Uint8Array(_n.match(/.{1,2}/g).map(ni=>parseInt(ni,16))):void 0,ti=await Bg(jt,ve,mn),ut=`route_${Date.now()}`,ai=new Set;At.forEach(ni=>{const zi=Ol(ni.lat,ni.lon,10);for(let Ei=1;Ei<=10;Ei++)ai.add(zi.substring(0,Ei))});const Qn={kind:Ln.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",ut],["client","parlens"],...Array.from(ai).map(ni=>["g",ni])],content:ti},Kn=await me(Qn);console.log("[Parlens] Signed route event:",Kn);const Jn=await Promise.allSettled(we.publish(ei,Kn)),lr=Jn.filter(ni=>ni.status==="fulfilled").length;console.log("[Parlens] Route published:",lr,"of",Jn.length,"relays"),lr===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)");const Mi={id:Kn.id,dTag:ut,decryptedContent:jt,created_at:Kn.created_at};zt(ni=>{const zi=[Mi,...ni];try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(zi))}catch(Ei){console.warn("Cache update failed",Ei)}return zi}),ke("")}catch(At){console.error("[Parlens] Error saving route:",At),alert("Failed to save route, try again later")}finally{Nt(!1)}},rt=(Oe,At)=>{Wt(jt=>jt.map(_n=>_n.id===Oe?{..._n,name:At}:_n)),Dn(null),kn("")},de=Oe=>{Dn(Oe.id),kn(Oe.name)},Ze=async Oe=>{const At=Oe.decryptedContent;if(!At.routeCoords||At.routeCoords.length===0){alert("Failed to load route. Route data is missing or corrupted. Please try creating the route again.");return}const jt=At.waypoints.map(_n=>({id:crypto.randomUUID(),name:_n.name,lat:_n.lat,lon:_n.lon}));Wt(jt),Pe(At.routeCoords),vt(At.alternateRouteCoords||null),In({}),He(!0),Kt(!1),d(At.routeCoords,At.alternateRouteCoords||null,At.waypoints.map(_n=>({lat:_n.lat,lon:_n.lon})),!0),Ye(!1)},yt=async Oe=>{if(!(!we||!ve||!me)&&confirm("Are you sure you want to delete this route? This action cannot be undone.")){_i(!0);try{const At={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Oe.id],["a",`${Ln.ROUTE_LOG}:${ve}:${Oe.dTag}`]],content:"Deleted by user"},jt=await me(At);await Promise.allSettled(we.publish(ei,jt));const _n={kind:Ln.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Oe.dTag],["deleted","true"]],content:""},mn=await me(_n);await Promise.allSettled(we.publish(ei,mn)),Li.current.add(Oe.dTag),zt(ti=>{const ut=ti.filter(ai=>ai.id!==Oe.id);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(ut))}catch(ai){console.warn("Cache update failed",ai)}return ut})}catch(At){console.error("Error deleting route:",At),alert("Failed to delete route")}finally{_i(!1)}}};return M.jsxs(M.Fragment,{children:[!Q&&M.jsx("button",{onClick:()=>Ye(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:M.jsx(s2,{size:20})}),tt&&M.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[M.jsx("button",{onClick:()=>Ye(!1),className:"absolute inset-0 z-0 cursor-default"}),ui&&M.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:M.jsxs("div",{className:"flex flex-col items-center gap-3",children:[M.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),M.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),nt&&M.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:M.jsxs("div",{className:"flex flex-col items-center gap-3",children:[M.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),M.jsx("p",{className:"text-sm font-medium text-white",children:"Saving..."})]})}),M.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent",children:"Create Route"}),M.jsx("button",{onClick:()=>Ye(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:M.jsx(no,{size:20,className:"text-black/60 dark:text-white/60"})})]}),M.jsxs("div",{className:"space-y-2",children:[M.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Add Waypoint"}),M.jsxs("div",{className:"relative z-[2000]",children:[M.jsx("input",{ref:Te,type:"text",placeholder:"Search waypoint",value:Et,onChange:Oe=>it(Oe.target.value),className:`w-full h-14 bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 pr-12 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500 ${Ki.length>0||vi.length>0||Rl(Et)?"rounded-t-xl rounded-b-none":"rounded-xl"}`}),Et&&M.jsx("button",{onClick:()=>it(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 text-zinc-400 dark:text-white/40 active:opacity-50 transition-opacity",children:M.jsx(no,{size:16})}),(Ki.length>0||vi.length>0||Rl(Et))&&M.jsx("div",{className:"absolute top-full left-0 right-0 bg-white dark:bg-zinc-900 rounded-b-xl shadow-xl border-x border-b border-black/5 dark:border-white/5 overflow-hidden z-[3000]",children:M.jsxs("div",{className:"max-h-[50vh] overflow-y-auto",children:[M.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-white/5 border-t border-black/5 dark:border-white/5 flex items-center gap-2 overflow-x-auto",children:[Rl(Et)&&M.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-blue-500/10 to-cyan-500/10 dark:from-blue-500/20 dark:to-cyan-500/20 text-[10px] font-bold text-blue-600 dark:text-blue-300 uppercase tracking-wider border border-blue-200 dark:border-blue-500/20",children:Rl(Et)?.type==="plus_code"?"Plus Code":"Coordinate"}),Ki.length>0&&M.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-emerald-500/10 to-teal-500/10 dark:from-emerald-500/20 dark:to-teal-500/20 text-[10px] font-bold text-emerald-600 dark:text-emerald-300 uppercase tracking-wider border border-emerald-200 dark:border-emerald-500/20",children:"Saved Places"}),vi.length>0&&M.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-violet-500/10 to-fuchsia-500/10 dark:from-violet-500/20 dark:to-fuchsia-500/20 text-[10px] font-bold text-violet-600 dark:text-violet-300 uppercase tracking-wider border border-violet-200 dark:border-violet-500/20",children:"OSM Search"})]}),(()=>{const Oe=Rl(Et);return Oe?M.jsxs("button",{onClick:()=>{const At={id:crypto.randomUUID(),name:Oe.type==="plus_code"?`Plus Code: ${Et}`:`Loc: ${a4(Oe.lat,Oe.lon)}`,lat:Oe.lat,lon:Oe.lon};Wt(jt=>[...jt,At]),it(""),Pe(null),vt(null),He(!1),d(null,null,null,!1),In({})},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-blue-50 dark:bg-blue-500/10 text-blue-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 shrink-0 transition-colors",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:"Add Location"}),M.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:[Oe.lat.toFixed(6),", ",Oe.lon.toFixed(6)]})]})]}):null})(),Ki.map((Oe,At)=>M.jsxs("button",{onClick:()=>{const jt={id:crypto.randomUUID(),name:Oe.name,lat:Oe.lat,lon:Oe.lon};Wt(_n=>[..._n,jt]),it(""),Pe(null),vt(null),He(!1),d(null,null,null,!1),In({})},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 shrink-0 transition-colors",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Oe.name}),M.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:"Saved from your routes"})]})]},`saved-${At}`)),vi.map(Oe=>M.jsxs("button",{onClick:()=>{const At={id:crypto.randomUUID(),name:Oe.display_name.split(",")[0],lat:parseFloat(Oe.lat),lon:parseFloat(Oe.lon)};Wt(jt=>[...jt,At]),it(""),Pe(null),vt(null),He(!1),d(null,null,null,!1),In({})},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-violet-50 dark:bg-violet-500/10 text-violet-500 group-hover:text-violet-600 dark:group-hover:text-violet-400 shrink-0 transition-colors",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Oe.display_name.split(",")[0]}),M.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:Oe.display_name.split(",").slice(1).join(",")})]})]},Oe.place_id))]})})]}),y&&M.jsxs("button",{onClick:()=>{const Oe={id:crypto.randomUUID(),name:"Current Location",lat:y[0],lon:y[1]};Wt(At=>[...At,Oe]),Pe(null),vt(null),He(!1),d(null,null,null,!1),In({})},className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors",children:[M.jsx(J3,{size:16,className:"text-blue-500"}),M.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Current Location"})]}),M.jsxs("button",{onClick:Je,className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-orange-500/10 dark:bg-orange-500/20 border border-orange-500/20 transition-colors",children:[M.jsx(Q3,{size:16,className:"text-orange-500"}),M.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Drop Pin on Map"})]})]}),M.jsxs("div",{className:"space-y-2 flex-1",children:[M.jsxs("div",{className:"flex items-center justify-between ml-2 mr-2",children:[M.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:["Waypoints (",pt.length,")"]}),pt.length>1&&M.jsx("button",{onClick:oe,className:"p-1 rounded-md transition-colors",title:"Reverse Order",children:M.jsx(C3,{size:14,className:"text-zinc-400 dark:text-white/30"})})]}),pt.length===0?M.jsx("div",{className:"p-8 text-center text-zinc-400 dark:text-white/30 text-sm",children:"No waypoints added yet."}):M.jsx("div",{className:"space-y-2",children:pt.map((Oe,At)=>M.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[M.jsxs("div",{className:"flex flex-col gap-0.5 -ml-1 mr-1",children:[M.jsx("button",{onClick:()=>gt(At,-1),disabled:At===0,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:M.jsx(M1,{size:12})}),M.jsx("button",{onClick:()=>gt(At,1),disabled:At===pt.length-1,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:M.jsx(Fd,{size:12})})]}),M.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] text-white text-xs font-bold flex items-center justify-center shrink-0",children:At+1}),Nn===Oe.id?M.jsxs(M.Fragment,{children:[M.jsx("input",{type:"text",value:si,onChange:jt=>kn(jt.target.value),className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-blue-500",autoFocus:!0,onFocus:jt=>jt.currentTarget.select(),onKeyDown:jt=>{jt.key==="Enter"&&rt(Oe.id,si),jt.key==="Escape"&&Dn(null)}}),M.jsx("button",{onClick:()=>rt(Oe.id,si),className:"p-2 rounded-xl text-green-500 bg-green-500/10 transition-colors",children:M.jsx(ep,{size:16})}),M.jsx("button",{onClick:()=>Dn(null),className:"p-2 rounded-xl text-zinc-400 bg-zinc-500/10 transition-colors",children:M.jsx(no,{size:16})})]}):M.jsxs(M.Fragment,{children:[M.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white font-medium truncate",children:Oe.name}),M.jsx("button",{onClick:()=>de(Oe),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:M.jsx(Vd,{size:14})}),M.jsx("button",{onClick:()=>Pi(Oe.id),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:M.jsx(rp,{size:16})})]})]},Oe.id))})]}),xt&&M.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[at?M.jsx(j3,{size:20,className:"text-blue-500"}):M.jsx(Cx,{size:20,className:"text-zinc-400"}),M.jsx("span",{className:"font-medium text-zinc-700 dark:text-white",children:"Show on Map"})]}),M.jsx("button",{onClick:pe,className:`w-14 h-8 rounded-full transition-colors ${at?"bg-[#007AFF]":"bg-zinc-300 dark:bg-white/20"}`,children:M.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${at?"translate-x-7":"translate-x-1"}`})})]}),xt&&ve&&M.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-green-500/5 dark:bg-green-500/10 border border-green-500/20",children:[M.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2",children:[M.jsx(cT,{size:14}),"Save Route"]}),M.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[M.jsx("input",{type:"text",value:Gt,onChange:Oe=>ke(Oe.target.value),placeholder:"Route name (optional)",className:"w-full sm:flex-1 p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10 text-zinc-700 dark:text-white placeholder-zinc-400 dark:placeholder-white/40 text-sm"}),M.jsx("button",{onClick:St,disabled:nt,className:"w-full sm:w-auto px-6 rounded-xl bg-green-500 text-white font-bold disabled:opacity-50 transition-all active:scale-95 py-3 sm:py-0",children:nt?"...":"Save"})]})]}),M.jsxs("div",{className:"flex gap-3",children:[M.jsx("button",{onClick:xr,disabled:pt.length===0,className:"flex-1 h-14 rounded-2xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:"Clear Route"}),M.jsx("button",{onClick:ce,disabled:pt.length<2||Zt,className:"flex-1 h-14 rounded-2xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:Zt?"Creating...":"Create Route"})]}),!xt&&pt.length>=2&&ve&&M.jsx("p",{className:"text-xs text-center text-zinc-400 dark:text-white/40",children:" Save option will appear after you create the route"}),ve&&M.jsxs("div",{className:"space-y-3 border-t border-black/5 dark:border-white/10 pt-4",children:[M.jsxs("button",{onClick:()=>Kt(!Bt),className:"w-full flex items-center justify-between",children:[M.jsxs("div",{className:"flex items-center gap-2",children:[M.jsx(V3,{size:18,className:"text-zinc-500 dark:text-white/50"}),M.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:["Saved Routes (",wt.length,")"]})]}),M.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:Bt?"Hide":"Show"})]}),Bt&&M.jsx("div",{className:"space-y-2",children:_t?M.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):wt.length===0?M.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"No saved routes yet"}):wt.map(Oe=>M.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[M.jsxs("button",{onClick:()=>Ze(Oe),className:"flex-1 text-left",children:[M.jsx("div",{className:"font-medium text-sm text-zinc-700 dark:text-white truncate",children:Oe.decryptedContent.name}),M.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[M.jsxs("span",{children:[Oe.decryptedContent.waypoints.length," stops"]}),M.jsx("span",{children:""}),M.jsx(n2,{size:12}),M.jsx("span",{children:new Date(Oe.created_at*1e3).toLocaleDateString()})]})]}),M.jsx("button",{onClick:()=>yt(Oe),className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:M.jsx(rp,{size:16})})]},Oe.id))})]}),M.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20",children:M.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[M.jsx("strong",{children:"Tip:"})," If place name does not return results, use coordinate or Google Maps plus code in waypoint search. Edit waypoint names to label locations. When you save routes, waypoint names become searchable."]})})]})]})]})};function I4(c){return c>=10?7:c>=7?6:c>=4?5:4}function Zm(c,d,y=!0,C=8){if((!y||c.length<2)&&!c.some(H=>(H.count||1)>1)&&c.length<2)return c;const D=I4(d),P=Math.min(D,C),N=new Map;for(const U of c){const Q=`${d>=15&&P>=8?`${U.lat.toFixed(4)},${U.lon.toFixed(4)}`:Ol(U.lat,U.lon,P)}:${U.currency}`,_e=U.count||1;if(N.has(Q)){const we=N.get(Q);we.spots.push(U),we.count+=_e,we.minPrice=Math.min(we.minPrice,U.price),we.maxPrice=Math.max(we.maxPrice,U.price);const ve=we.spots.length;we.lat=we.spots.reduce((me,he)=>me+Number(he.lat),0)/ve,we.lon=we.spots.reduce((me,he)=>me+Number(he.lon),0)/ve}else N.set(Q,{id:`cluster-${Q}`,lat:U.lat,lon:U.lon,spots:[U],minPrice:U.price,maxPrice:U.price,currency:U.currency,count:_e})}const h=[];for(const U of N.values())U.spots.length===1?h.push(U.spots[0]):h.push(U);return h}function kg(c){return"spots"in c&&Array.isArray(c.spots)&&c.spots.length>1}var xy,V_;function M4(){if(V_)return xy;V_=1;for(var c="0123456789bcdefghjkmnpqrstuvwxyz",d={},y=0;y<c.length;y++)d[c.charAt(y)]=y;var C="auto",D=-90,P=90,N=-180,h=180,U=[0,5,7,8,11,12,13,15,16,17,18],H=function(He,xt,Pe){if(Pe===C){if(typeof He=="number"||typeof xt=="number")throw new Error("string notation required for auto precision.");var ct=He.split(".")[1].length,vt=xt.split(".")[1].length,Zt=Math.max(ct,vt);Pe=U[Zt]}else Pe===void 0&&(Pe=9);for(var Ne=[],Te=0,We=0,wt=0,zt=P,Gt=D,ke=h,nt=N,Nt;Ne.length<Pe;)if(We%2===0?(Nt=(ke+nt)/2,xt>Nt?(wt=(wt<<1)+1,nt=Nt):(wt=(wt<<1)+0,ke=Nt)):(Nt=(zt+Gt)/2,He>Nt?(wt=(wt<<1)+1,Gt=Nt):(wt=(wt<<1)+0,zt=Nt)),Te++,We++,Te===5){var _t=c[wt];Ne.push(_t),Te=0,wt=0}return Ne.join("")},Y=function(He,xt,Pe){Pe=Pe||52;for(var ct=0,vt=P,Zt=D,Ne=h,Te=N,We,wt=0;ct<Pe;)wt*=2,ct%2===0?(We=(Ne+Te)/2,xt>We?(wt+=1,Te=We):Ne=We):(We=(vt+Zt)/2,He>We?(wt+=1,Zt=We):vt=We),ct++;return wt},Q=function(He){for(var xt=!0,Pe=P,ct=D,vt=h,Zt=N,Ne,Te=0,We=0,wt=He.length;We<wt;We++){var zt=He[We].toLowerCase();Te=d[zt];for(var Gt=4;Gt>=0;Gt--){var ke=Te>>Gt&1;xt?(Ne=(vt+Zt)/2,ke===1?Zt=Ne:vt=Ne):(Ne=(Pe+ct)/2,ke===1?ct=Ne:Pe=Ne),xt=!xt}}return[ct,Zt,Pe,vt]},_e=function(He,xt){xt=xt||52;for(var Pe=P,ct=D,vt=h,Zt=N,Ne=0,Te=0,We=xt/2,wt=0;wt<We;wt++)Te=we(He,(We-wt)*2-1),Ne=we(He,(We-wt)*2-2),Ne===0?Pe=(Pe+ct)/2:ct=(Pe+ct)/2,Te===0?vt=(vt+Zt)/2:Zt=(vt+Zt)/2;return[ct,Zt,Pe,vt]};function we(He,xt){return He/Math.pow(2,xt)&1}var ve=function(He){var xt=Q(He),Pe=(xt[0]+xt[2])/2,ct=(xt[1]+xt[3])/2,vt=xt[2]-Pe,Zt=xt[3]-ct;return{latitude:Pe,longitude:ct,error:{latitude:vt,longitude:Zt}}},me=function(He,xt){var Pe=_e(He,xt),ct=(Pe[0]+Pe[2])/2,vt=(Pe[1]+Pe[3])/2,Zt=Pe[2]-ct,Ne=Pe[3]-vt;return{latitude:ct,longitude:vt,error:{latitude:Zt,longitude:Ne}}},he=function(He,xt){var Pe=ve(He),ct=Pe.latitude+xt[0]*Pe.error.latitude*2,vt=Pe.longitude+xt[1]*Pe.error.longitude*2;return vt=Et(vt),ct=it(ct),H(ct,vt,He.length)},Re=function(He,xt,Pe){Pe=Pe||52;var ct=me(He,Pe),vt=ct.latitude+xt[0]*ct.error.latitude*2,Zt=ct.longitude+xt[1]*ct.error.longitude*2;return Zt=Et(Zt),vt=it(vt),Y(vt,Zt,Pe)},tt=function(He){var xt=He.length,Pe=ve(He),ct=Pe.latitude,vt=Pe.longitude,Zt=Pe.error.latitude*2,Ne=Pe.error.longitude*2,Te,We,wt=[zt(1,0),zt(1,1),zt(0,1),zt(-1,1),zt(-1,0),zt(-1,-1),zt(0,-1),zt(1,-1)];function zt(Gt,ke){return Te=ct+Gt*Zt,We=vt+ke*Ne,We=Et(We),Te=it(Te),H(Te,We,xt)}return wt},Ye=function(He,xt){xt=xt||52;var Pe=me(He,xt),ct=Pe.latitude,vt=Pe.longitude,Zt=Pe.error.latitude*2,Ne=Pe.error.longitude*2,Te,We,wt=[zt(1,0),zt(1,1),zt(0,1),zt(-1,1),zt(-1,0),zt(-1,-1),zt(0,-1),zt(1,-1)];function zt(Gt,ke){return Te=ct+Gt*Zt,We=vt+ke*Ne,We=Et(We),Te=it(Te),Y(Te,We,xt)}return wt},pt=function(He,xt,Pe,ct,vt){vt=vt||9;for(var Zt=H(He,xt,vt),Ne=H(Pe,ct,vt),Te=ve(Zt),We=Te.error.latitude*2,wt=Te.error.longitude*2,zt=Q(Zt),Gt=Q(Ne),ke=Math.round((Gt[0]-zt[0])/We),nt=Math.round((Gt[1]-zt[1])/wt),Nt=[],_t=0;_t<=ke;_t++)for(var tn=0;tn<=nt;tn++)Nt.push(he(Zt,[_t,tn]));return Nt},Wt=function(He,xt,Pe,ct,vt){vt=vt||52;for(var Zt=Y(He,xt,vt),Ne=Y(Pe,ct,vt),Te=me(Zt,vt),We=Te.error.latitude*2,wt=Te.error.longitude*2,zt=_e(Zt,vt),Gt=_e(Ne,vt),ke=Math.round((Gt[0]-zt[0])/We),nt=Math.round((Gt[1]-zt[1])/wt),Nt=[],_t=0;_t<=ke;_t++)for(var tn=0;tn<=nt;tn++)Nt.push(Re(Zt,[_t,tn],vt));return Nt};function Et(He){return He>h?N+He%h:He<N?h+He%h:He}function it(He){return He>P?P:He<D?D:He}var at={ENCODE_AUTO:C,encode:H,encode_uint64:Y,encode_int:Y,decode:ve,decode_int:me,decode_uint64:me,decode_bbox:Q,decode_bbox_uint64:_e,decode_bbox_int:_e,neighbor:he,neighbor_int:Re,neighbors:tt,neighbors_int:Ye,bboxes:pt,bboxes_int:Wt};return xy=at,xy}var k4=M4();const Zf=ap(k4);class _y{q;r;x;p;k;initialized=!1;constructor(d=1e-5,y=.001){this.q=d,this.r=y,this.x=0,this.p=1,this.k=0}filter(d){return this.initialized?(this.p=this.p+this.q,this.k=this.p/(this.p+this.r),this.x=this.x+this.k*(d-this.x),this.p=(1-this.k)*this.p,this.x):(this.x=d,this.initialized=!0,d)}reset(){this.initialized=!1,this.x=0,this.p=1}}class N4{latFilter;lonFilter;bearingFilter;hasLastBearing=!1;constructor(){this.latFilter=new _y(1e-5,.002),this.lonFilter=new _y(1e-5,.002),this.bearingFilter=new _y(.005,.8)}cumulativeBearing=0;lastInputBearing=0;smoothLocation(d,y){return[this.latFilter.filter(d),this.lonFilter.filter(y)]}smoothBearing(d,y,C=!1){if(!C&&y<2)return null;const D=(d%360+360)%360;if(!this.hasLastBearing)return this.lastInputBearing=D,this.cumulativeBearing=D,this.hasLastBearing=!0,this.bearingFilter.reset(),this.bearingFilter.filter(D),D;let P=D-this.lastInputBearing;return P>180?P-=360:P<-180&&(P+=360),this.cumulativeBearing+=P,this.lastInputBearing=D,(this.bearingFilter.filter(this.cumulativeBearing)%360+360)%360}reset(){this.latFilter.reset(),this.lonFilter.reset(),this.bearingFilter.reset(),this.cumulativeBearing=0,this.lastInputBearing=0,this.hasLastBearing=!1}}class D4{currentRotation=0;lastRawBearing=0;initialized=!1;setBearing(d){const y=(d%360+360)%360;if(!this.initialized)return this.currentRotation=y,this.lastRawBearing=y,this.initialized=!0,this.currentRotation;let C=y-this.lastRawBearing;return C>180?C-=360:C<-180&&(C+=360),this.currentRotation+=C,this.lastRawBearing=y,this.currentRotation}getCurrentRotation(){return this.currentRotation}reset(d=0){this.currentRotation=d,this.lastRawBearing=(d%360+360)%360,this.initialized=!0}}class R4{startLat=0;startLon=0;targetLat=0;targetLon=0;currentLat=0;currentLon=0;startTime=0;duration=300;animationId=null;onUpdate=null;setUpdateCallback(d){this.onUpdate=d}animateTo(d,y,C=300){if(this.animationId!==null&&cancelAnimationFrame(this.animationId),this.targetLat===0&&this.targetLon===0){this.targetLat=d,this.targetLon=y,this.currentLat=d,this.currentLon=y,this.onUpdate&&this.onUpdate(d,y);return}this.startLat=this.currentLat||this.targetLat,this.startLon=this.currentLon||this.targetLon,this.targetLat=d,this.targetLon=y,this.startTime=performance.now(),this.duration=C,this.animate()}animate=()=>{const y=performance.now()-this.startTime,C=Math.min(y/this.duration,1),D=1-Math.pow(1-C,3),P=this.startLat+(this.targetLat-this.startLat)*D,N=this.startLon+(this.targetLon-this.startLon)*D;this.currentLat=P,this.currentLon=N,this.onUpdate&&this.onUpdate(P,N),C<1?this.animationId=requestAnimationFrame(this.animate):this.animationId=null};stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class P4{anchorLat=0;anchorLon=0;displayLat=0;displayLon=0;lastRawLat=0;lastRawLon=0;lastUpdateTime=0;speedHistory=[];currentSpeedClass="stationary";predictedBearing=0;directionChangeBuffer=[];initialized=!1;bufferZones={stationary:15,walking:8,vehicle:5,fast_vehicle:3};pollIntervals={stationary:15e3,walking:5e3,vehicle:2e3,fast_vehicle:1e3};animationDurations={stationary:1200,walking:800,vehicle:400,fast_vehicle:200};haversineDistance(d,y,C,D){const N=(C-d)*Math.PI/180,h=(D-y)*Math.PI/180,U=Math.sin(N/2)*Math.sin(N/2)+Math.cos(d*Math.PI/180)*Math.cos(C*Math.PI/180)*Math.sin(h/2)*Math.sin(h/2);return 6371e3*(2*Math.atan2(Math.sqrt(U),Math.sqrt(1-U)))}calculateBearing(d,y,C,D){const P=(D-y)*Math.PI/180,N=Math.sin(P)*Math.cos(C*Math.PI/180),h=Math.cos(d*Math.PI/180)*Math.sin(C*Math.PI/180)-Math.sin(d*Math.PI/180)*Math.cos(C*Math.PI/180)*Math.cos(P);return(Math.atan2(N,h)*180/Math.PI+360)%360}updateLocation(d,y){const C=Date.now();if(!this.initialized)return this.anchorLat=d,this.anchorLon=y,this.displayLat=d,this.displayLon=y,this.lastRawLat=d,this.lastRawLon=y,this.lastUpdateTime=C,this.initialized=!0,{displayLat:d,displayLon:y,speed:0,speedClass:"stationary",shouldUpdate:!0,animationDuration:0,bearing:null};const D=this.haversineDistance(this.anchorLat,this.anchorLon,d,y),P=(C-this.lastUpdateTime)/1e3,N=this.haversineDistance(this.lastRawLat,this.lastRawLon,d,y),h=P>0?N/P:0;this.speedHistory.push(h),this.speedHistory.length>5&&this.speedHistory.shift();const U=this.speedHistory.reduce((ve,me)=>ve+me,0)/this.speedHistory.length;let H;U<.5?H="stationary":U<2?H="walking":U<10?H="vehicle":H="fast_vehicle",this.currentSpeedClass=H;const Y=this.bufferZones[H];if(N>1){const ve=this.calculateBearing(this.lastRawLat,this.lastRawLon,d,y);this.directionChangeBuffer.push(ve),this.directionChangeBuffer.length>3&&this.directionChangeBuffer.shift(),this.predictedBearing=this.directionChangeBuffer.reduce((me,he)=>me+he,0)/this.directionChangeBuffer.length}this.lastRawLat=d,this.lastRawLon=y,this.lastUpdateTime=C;let Q=!1,_e=this.displayLat,we=this.displayLon;return D>Y?(this.anchorLat=d,this.anchorLon=y,_e=d,we=y,Q=!0):(_e=this.anchorLat,we=this.anchorLon,Q=!1),Q&&(this.displayLat=_e,this.displayLon=we),{displayLat:this.displayLat,displayLon:this.displayLon,speed:U,speedClass:H,shouldUpdate:Q,animationDuration:this.animationDurations[H],bearing:this.predictedBearing}}getPollingInterval(){return this.pollIntervals[this.currentSpeedClass]}getSpeedClass(){return this.currentSpeedClass}getPredictedBearing(){return this.predictedBearing}lastAccuracy=10;updateLocationWithAccuracy(d,y,C){this.lastAccuracy=C;const D=this.updateLocation(d,y);if(D.speedClass==="stationary"){const P=Math.max(this.bufferZones.stationary,C*1.5);if(this.haversineDistance(this.anchorLat,this.anchorLon,d,y)<=P)return{...D,displayLat:this.displayLat,displayLon:this.displayLon,shouldUpdate:!1,accuracy:C}}return{...D,accuracy:C}}getLastAccuracy(){return this.lastAccuracy}getSpeedHistoryAverage(){return this.speedHistory.length===0?0:this.speedHistory.reduce((d,y)=>d+y,0)/this.speedHistory.length}reset(){this.initialized=!1,this.anchorLat=0,this.anchorLon=0,this.displayLat=0,this.displayLon=0,this.speedHistory=[],this.currentSpeedClass="stationary",this.directionChangeBuffer=[]}}var by,G_;function O4(){return G_||(G_=1,by={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"}),by}var vy,H_;function z4(){if(H_)return vy;H_=1;const{webm:c,mp4:d}=O4(),y=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,C=()=>"wakeLock"in navigator;class D{constructor(){if(this.enabled=!1,C()){this._wakeLock=null;const N=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",N),document.addEventListener("fullscreenchange",N)}else y()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",c),this._addSourceToVideo(this.noSleepVideo,"mp4",d),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(N,h,U){var H=document.createElement("source");H.src=U,H.type=`video/${h}`,N.appendChild(H)}get isEnabled(){return this.enabled}enable(){return C()?navigator.wakeLock.request("screen").then(N=>{this._wakeLock=N,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(N=>{throw this.enabled=!1,console.error(`${N.name}, ${N.message}`),N}):y()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(h=>(this.enabled=!0,h)).catch(h=>{throw this.enabled=!1,h})}disable(){C()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):y()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}return vy=D,vy}var L4=z4();const B4=ap(L4),F4=()=>{const c=ge.useRef(null),d=ge.useRef(!1),[y,C]=ge.useState(!1);ge.useEffect(()=>(c.current=new B4,()=>{c.current&&c.current.disable()}),[]);const D=ge.useCallback(async()=>{if(d.current=!0,c.current)try{y||(await c.current.enable(),C(!0),console.log("[Parlens] NoSleep Wake Lock acquired (cross-browser)"))}catch(N){console.warn("[Parlens] Failed to acquire NoSleep Wake Lock:",N),C(!1)}},[]),P=ge.useCallback(async()=>{if(d.current=!1,c.current)try{c.current.disable(),C(!1),console.log("[Parlens] NoSleep Wake Lock released")}catch(N){console.warn("[Parlens] Failed to release NoSleep Wake Lock:",N)}},[]);return ge.useEffect(()=>{const N=async()=>{document.visibilityState==="visible"&&d.current&&await D()};return document.addEventListener("visibilitychange",N),()=>{document.removeEventListener("visibilitychange",N)}},[D]),{requestLock:D,releaseLock:P,isLocked:y}};var Xm=new TextDecoder("utf-8");new TextEncoder;var k2=5e3;function j4(c){let{prefix:d,words:y}=th.decode(c,k2),C=new Uint8Array(th.fromWords(y));switch(d){case"nprofile":{let D=wy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(D[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Es(D[0][0]),relays:D[1]?D[1].map(P=>Xm.decode(P)):[]}}}case"nevent":{let D=wy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for nevent");if(D[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(D[2]&&D[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(D[3]&&D[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Es(D[0][0]),relays:D[1]?D[1].map(P=>Xm.decode(P)):[],author:D[2]?.[0]?Es(D[2][0]):void 0,kind:D[3]?.[0]?parseInt(Es(D[3][0]),16):void 0}}}case"naddr":{let D=wy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!D[2]?.[0])throw new Error("missing TLV 2 for naddr");if(D[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!D[3]?.[0])throw new Error("missing TLV 3 for naddr");if(D[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Xm.decode(D[0][0]),pubkey:Es(D[2][0]),kind:parseInt(Es(D[3][0]),16),relays:D[1]?D[1].map(P=>Xm.decode(P)):[]}}}case"nsec":return{type:d,data:C};case"npub":case"note":return{type:d,data:Es(C)};default:throw new Error(`unknown prefix ${d}`)}}function wy(c){let d={},y=c;for(;y.length>0;){let C=y[0],D=y[1],P=y.slice(2,2+D);if(y=y.slice(2+D),P.length<D)throw new Error(`not enough data to read on TLV ${C}`);d[C]=d[C]||[],d[C].push(P)}return d}function q_(c){return V4("npub",Ud(c))}function U4(c,d){let y=th.toWords(d);return th.encode(c,y,k2)}function V4(c,d){return U4(c,d)}const Xf=({text:c,title:d})=>{const[y,C]=ge.useState(!1),D=P=>{P.preventDefault(),P.stopPropagation(),C(!1)};return M.jsxs("span",{className:"inline-flex items-center ml-1",style:{verticalAlign:"middle"},children:[M.jsx("button",{type:"button",onClick:P=>{P.preventDefault(),P.stopPropagation(),C(!0)},className:"appearance-none border-0 bg-transparent p-0 m-0 cursor-pointer inline-flex items-center",style:{lineHeight:0},children:M.jsx(H3,{size:11,className:"text-zinc-400"})}),y&&M.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/60 flex items-center justify-center p-4",onClick:D,children:M.jsxs("div",{className:"relative max-w-xs w-full p-5 bg-zinc-800 rounded-2xl shadow-2xl",onClick:P=>P.stopPropagation(),children:[d&&M.jsx("h3",{className:"text-xs font-bold uppercase text-zinc-400 mb-2 pr-6",children:d}),M.jsx("p",{className:"text-white text-sm font-normal normal-case leading-relaxed m-0 pr-4",children:c}),M.jsx("button",{type:"button",className:"absolute top-3 right-3 w-7 h-7 bg-zinc-700 rounded-full flex items-center justify-center",onClick:D,children:M.jsx(no,{size:18,className:"text-white"})})]})})]})},G4=({onClose:c,currentLocation:d,countryCode:y,onPickLocation:C,pickedLocation:D})=>{const{pubkey:P,pool:N,signEvent:h}=nh(),[U,H]=ge.useState("public"),[Y,Q]=ge.useState(null),[_e,we]=ge.useState(!1),[ve,me]=ge.useState(()=>{if(!d)return!0;const Ue=Ol(d[0],d[1],5);return sessionStorage.getItem("parlens_last_fetch_hash")!==Ue}),[he,Re]=ge.useState(()=>{if(!d)return!0;const Ue=Ol(d[0],d[1],5);return sessionStorage.getItem("parlens_last_fetch_hash")!==Ue}),[tt,Ye]=ge.useState([]),[pt,Wt]=ge.useState([]),[Et,it]=ge.useState(new Map),[at,He]=ge.useState(new Map),[xt,Pe]=ge.useState(null),[ct,vt]=ge.useState(null),[Zt,Ne]=ge.useState(!1),[Te,We]=ge.useState("all"),[wt,zt]=ge.useState(""),[Gt,ke]=ge.useState(""),[nt,Nt]=ge.useState(new Map),[_t,tn]=ge.useState(null),[Bt,Kt]=ge.useState("all"),[an,sn]=ge.useState("all"),[Nn,Dn]=ge.useState(!1),[si,kn]=ge.useState(10),[ui,_i]=ge.useState(null),[Di,qn]=ge.useState(()=>{try{const Ue=localStorage.getItem("parlens-saved-listings");return Ue?new Set(JSON.parse(Ue)):new Set}catch{return new Set}}),[Gn,In]=ge.useState(!1),vi=P===jh,[nn,Li]=ge.useState(()=>new Map),[Ki,Pi]=ge.useState("all"),[xr,gt]=ge.useState(!1),[oe,ce]=ge.useState("all"),pe=ge.useRef(null),je=ge.useRef(!1),Je=Ue=>{qn(mt=>{const $t=new Set(mt);return $t.has(Ue)?$t.delete(Ue):$t.add(Ue),localStorage.setItem("parlens-saved-listings",JSON.stringify(Array.from($t))),$t})},St=ge.useCallback(async Ue=>{if(!N||!h||!vi)return;const mt=`${Ln.LISTED_PARKING_METADATA}:${Ue.pubkey}:${Ue.d}`,$t=nn.has(mt);gt(!0);try{if($t){const gn=nn.get(mt);if(gn){const un={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",gn]],content:"Revoking listing approval"},fn=await h(un);await Promise.allSettled(N.publish(ei,fn)),Li(Rn=>{const Hn=new Map(Rn);return Hn.delete(mt),Hn}),console.log("[Parlens] Approval revoked for:",Ue.listing_name)}}else{const gn={kind:Ln.LABEL,created_at:Math.floor(Date.now()/1e3),tags:[["l","approved","parlens"],["a",mt],["p",Ue.pubkey||""]],content:"Approved public listing"},un=await h(gn);await Promise.allSettled(N.publish(ei,un)),Li(fn=>{const Rn=new Map(fn);return Rn.set(mt,un.id),Rn}),console.log("[Parlens] Approved listing:",Ue.listing_name)}}catch(gn){console.error("[Parlens] Failed to toggle approval:",gn),alert("Failed to update approval. Please try again.")}finally{gt(!1)}},[N,h,vi,nn]),[rt,de]=ge.useState([]),[Ze,yt]=ge.useState(null),[Oe,At]=ge.useState([]),[jt,_n]=ge.useState(!1),mn=ge.useRef(null);ge.useEffect(()=>{d&&!Ze&&(yt(d),At([]))},[d]),ge.useEffect(()=>{const Ue=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=Ue}},[]),ge.useEffect(()=>{if(!N)return;(async()=>{try{const mt=await N.querySync(ei,{kinds:[Ln.LABEL],authors:[jh],"#l":["approved"]}),$t=new Map;for(const gn of mt){const un=gn.tags.find(fn=>fn[0]==="a")?.[1];un&&($t.get(un)||$t.set(un,gn.id))}Li($t),console.log("[Parlens] Loaded",$t.size,"approval labels from approver")}catch(mt){console.error("[Parlens] Failed to fetch approval labels:",mt)}})()},[N]);const[ti,ut]=ge.useState([]);ge.useEffect(()=>{(async()=>{try{const mt=localStorage.getItem("parlens-saved-routes");if(mt){const $t=JSON.parse(mt),gn=await Promise.all($t.map(async un=>{try{if(!P)return null;const fn=await Tx(un.content,P);return{id:un.id,dTag:un.dTag,decryptedContent:fn,created_at:un.created_at}}catch{return null}}));ut(gn.filter(Boolean))}}catch(mt){console.error("Error loading saved routes:",mt)}})()},[P]);const ai=ge.useMemo(()=>{if(!wt||wt.length<2)return[];const Ue=wt.toLowerCase(),mt=[];for(const $t of ti)for(const gn of $t.decryptedContent.waypoints)gn.name.toLowerCase().includes(Ue)&&(mt.find(un=>un.name.toLowerCase()===gn.name.toLowerCase())||mt.push({name:gn.name,lat:gn.lat,lon:gn.lon}));return mt.slice(0,3)},[wt,ti]),Qn=ge.useMemo(()=>{if(!wt||wt.length<2)return[];const Ue=wt.toLowerCase(),mt=[],$t=new Set;for(const gn of tt){const un=gn.local_area||gn.city;if(!un)continue;if(un.toLowerCase().includes(Ue)&&!$t.has(un.toLowerCase())){const[Rn,Hn]=(gn.location||"").split(",").map(Number);!isNaN(Rn)&&!isNaN(Hn)&&($t.add(un.toLowerCase()),mt.push({name:un,lat:Rn,lon:Hn}))}}return mt.slice(0,3)},[wt,tt]),Kn=Ue=>{const mt=Ue.target.value;if(zt(mt),mn.current&&clearTimeout(mn.current),mt.length<3){At([]);return}mn.current=setTimeout(async()=>{_n(!0);const $t=await Rg(mt,y,d,1);At($t),_n(!1)},500)},Jn=Ue=>{const mt=parseFloat(Ue.lat),$t=parseFloat(Ue.lon);console.log("[Parlens] Selected suggestion:",Ue.display_name),!isNaN(mt)&&!isNaN($t)&&(yt([mt,$t]),pe.current=[mt,$t],ke(""),zt(Ue.display_name.split(",")[0]),At([]),Ei())},lr=async()=>{if(mn.current&&clearTimeout(mn.current),Oe.length>0){Jn(Oe[0]);return}if(!wt){ke(""),d&&(yt(d),pe.current=d),At([]),Ei();return}_n(!0);try{const Ue=await Rg(wt,y,d,1);if(Ue&&Ue.length>0){console.log("[Parlens] Search result:",Ue[0].display_name);const mt=parseFloat(Ue[0].lat),$t=parseFloat(Ue[0].lon);if(!isNaN(mt)&&!isNaN($t)){yt([mt,$t]),pe.current=[mt,$t],ke(""),At([]),me(!1),Ei();return}}if(console.log("[Parlens] Location not found, falling back to text filter"),wt.length>2){const mt=await Rg(wt,y,d,1);if(mt.length>0){Jn(mt[0]),me(!1);return}}ke(wt),d&&yt(d),At([])}catch(Ue){console.error("Search failed:",Ue),ke(wt)}finally{_n(!1),me(!1)}};ge.useEffect(()=>{try{const Ue=localStorage.getItem("parlens-hidden-items");if(Ue)de(JSON.parse(Ue));else{const mt=JSON.parse(localStorage.getItem("parlens-hidden-listings")||"[]"),$t=JSON.parse(localStorage.getItem("parlens-blocked-pubkeys")||"[]"),gn=[...mt.map(un=>({id:un,name:"Unknown Listing",type:"listing"})),...$t.map(un=>({id:un,name:un.slice(0,12)+"...",type:"owner"}))];gn.length>0&&(de(gn),localStorage.setItem("parlens-hidden-items",JSON.stringify(gn)),localStorage.removeItem("parlens-hidden-listings"),localStorage.removeItem("parlens-blocked-pubkeys"))}}catch{}},[]);const Mi=(Ue,mt)=>{if(rt.some(gn=>gn.id===Ue))return;const $t=[...rt,{id:Ue,name:mt,type:"listing"}];de($t),localStorage.setItem("parlens-hidden-items",JSON.stringify($t)),_i(null)};ge.useEffect(()=>{if(!ui)return;const Ue=()=>_i(null);return window.addEventListener("click",Ue),()=>window.removeEventListener("click",Ue)},[ui]);const ni=(Ue,mt)=>{if(rt.some(gn=>gn.id===Ue))return;const $t=[...rt,{id:Ue,name:mt,type:"owner"}];de($t),localStorage.setItem("parlens-hidden-items",JSON.stringify($t)),_i(null)},zi=(Ue,mt)=>rt.some($t=>$t.id===Ue||mt&&$t.id===mt),Ei=ge.useCallback(async Ue=>{if(!N)return;typeof Ue=="boolean"&&Ue||(me(!0),Re(!0));try{let $t=[];if(P){const Ct=Date.now(),Zn=N.querySync(ei,{kinds:[Ln.LISTED_PARKING_METADATA],authors:[P]}),En=N.querySync(ei,{kinds:[Ln.LISTED_PARKING_METADATA],"#p":[P]}),[Ri,ii]=await Promise.all([Zn,En]),$n=Date.now()-Ct;ei.forEach(li=>vo.recordSuccess(li,$n));const jn=new Map;[...Ri,...ii].forEach(li=>jn.set(li.id,li)),$t=Array.from(jn.values()),console.log("[Parlens] Phase A: Fetched",$t.length,"user/managed/member listings in",$n,"ms")}try{const Ct=JSON.parse(localStorage.getItem("parlens-saved-refs")||"[]");if(Ct.length>0){console.log("[Parlens] Phase B: Fetching",Ct.length,"saved listing refs");const Zn=Date.now(),En=await N.querySync(ei,{kinds:[Ln.LISTED_PARKING_METADATA],"#a":Ct}),Ri=Date.now()-Zn;ei.forEach($n=>vo.recordSuccess($n,Ri));const ii=new Set($t.map($n=>$n.id));En.forEach($n=>{ii.has($n.id)||($t.push($n),ii.add($n.id))}),console.log("[Parlens] Phase B: Merged",En.length,"saved listings in",Ri,"ms. Total:",$t.length)}}catch(Ct){ei.forEach(Zn=>vo.recordFailure(Zn)),console.warn("[Parlens] Phase B: Failed to fetch saved refs:",Ct)}let gn=pe.current;Ze&&(gn=Ze);let un=[];if(gn){const[Ct,Zn]=gn,En=Ol(Ct,Zn,10),Ri=[];for(let jn=1;jn<=10;jn++)Ri.push(En.substring(0,jn));console.log("[Parlens] Phase C: Using hierarchical geohash prefixes:",Ri);const ii=Date.now();un=await N.querySync(ei,{kinds:[Ln.LISTED_PARKING_METADATA],"#g":Ri,limit:100});const $n=Date.now()-ii;ei.forEach(jn=>vo.recordSuccess(jn,$n)),console.log("[Parlens] Phase C: Hierarchical query returned",un.length,"events in",$n,"ms"),un.length===0&&(console.log("[Parlens] Phase B: No hierarchical hits, falling back to global query"),un=await N.querySync(ei,{kinds:[Ln.LISTED_PARKING_METADATA],limit:100}))}else console.log("[Parlens] Phase B: No location context, using global query"),un=await N.querySync(ei,{kinds:[Ln.LISTED_PARKING_METADATA],limit:100});let fn=[];if(vi){console.log("[Parlens] Phase D: Fetching global public listings for Approver");try{const Ct=Date.now();fn=await N.querySync(ei,{kinds:[Ln.LISTED_PARKING_METADATA],limit:100});const Zn=Date.now()-Ct;console.log("[Parlens] Phase D: Found",fn.length,"global listings for approver in",Zn,"ms")}catch(Ct){console.warn("[Parlens] Phase D failed:",Ct)}}const Rn=[...$t,...un,...fn],Hn=new Map;Rn.forEach(Ct=>{Hn.has(Ct.id)||Hn.set(Ct.id,Ct)});const Fn=new Map;Array.from(Hn.values()).forEach(Ct=>{const Zn=Ct.tags.find(Ri=>Ri[0]==="d")?.[1];if(!Zn||Ct.content==="Deleted")return;const En=`${Ct.pubkey}:${Zn}`;(!Fn.has(En)||Fn.get(En).created_at<Ct.created_at)&&Fn.set(En,Ct)});const ki=Array.from(Fn.values()).map(Ct=>{const Zn=ci=>Ct.tags.find(Un=>Un[0]===ci)?.[1]||"",En=ci=>Ct.tags.filter(Un=>Un[0]===ci).map(Un=>Un[1]),Ri=Ct.tags.filter(ci=>ci[0]==="p"&&ci[2]==="admin").map(ci=>ci[1]),ii=Ct.tags.filter(ci=>ci[0]==="p"&&ci[2]==="write").map(ci=>ci[1]),$n=Ct.tags.filter(ci=>ci[0]==="p"&&ci[2]==="read").map(ci=>ci[1]),jn=En("relay"),li=Zn("floor_plan"),us=li?JSON.parse(li):void 0;let Xr;try{const ci=Zn("rates");ci&&(Xr=JSON.parse(ci))}catch{}return{id:Ct.id,pubkey:Ct.pubkey,d:Zn("d"),listing_name:Zn("listing_name")||"Unnamed",location:Zn("location"),g:Zn("g"),floors:Zn("floors"),floor_plan:us,total_spots:parseInt(Zn("total_spots")||"0"),rates:Xr,listing_type:Zn("listing_type")||"public",qr_type:Zn("qr_type")||"static",status:Zn("status")||"open",owners:Ri,managers:ii,members:$n,relays:jn,local_area:Zn("local_area"),city:Zn("city"),zipcode:Zn("zipcode"),created_at:Ct.created_at,originalEvent:Ct}}).filter(Ct=>Ct.listing_name!=="Unnamed"&&Ct.listing_name.trim()!=="");let xi=ki;const bi=pe.current;if(bi){const Ct=Ol(bi[0],bi[1],5);xi=ki.sort((Zn,En)=>{const Ri=Zn.g||"",ii=En.g||"",$n=Ri.startsWith(Ct),jn=ii.startsWith(Ct);return $n&&!jn?-1:!$n&&jn?1:(En.created_at||0)-(Zn.created_at||0)})}else xi=ki.sort((Ct,Zn)=>(Zn.created_at||0)-(Ct.created_at||0));Ye(xi),me(!1);try{for(let Zn=0;Zn<xi.length;Zn+=10){const En=xi.slice(Zn,Zn+10),Ri=En.map(ci=>`${Ln.LISTED_PARKING_METADATA}:${ci.pubkey}:${ci.d}`);if(Ri.length===0)continue;const ii=Date.now(),$n=await N.querySync(ei,{kinds:[Ln.LISTED_SPOT_LOG],"#a":Ri}),jn=Date.now()-ii;ei.forEach(ci=>vo.recordSuccess(ci,jn));const li=new Map;$n.forEach(ci=>{const Un=ci.tags.find(Tr=>Tr[0]==="a"&&Tr[1]?.startsWith(`${Ln.PARKING_SPOT_LISTING}:`))?.[1];Un&&(!li.has(Un)||li.get(Un).created_at<ci.created_at)&&li.set(Un,ci)});const us=new Map;En.forEach(ci=>{us.set(ci.d,{car:{open:0,occupied:0,closed:0,total:0,rate:ci.rates?.car?.hourly||0},motorcycle:{open:0,occupied:0,closed:0,total:0,rate:ci.rates?.motorcycle?.hourly||0},bicycle:{open:0,occupied:0,closed:0,total:0,rate:ci.rates?.bicycle?.hourly||0}})}),li.forEach(ci=>{const Un=ci.tags.find(hs=>hs[0]==="a"&&hs[3]==="root")?.[1];if(!Un)return;const Tr=Un.split(":")[2],Ss=us.get(Tr);if(!Ss)return;const Ji=ci.tags.find(hs=>hs[0]==="status")?.[1]||"open",Lr=ci.tags.find(hs=>hs[0]==="type")?.[1]||"car";Ss[Lr]&&(Ss[Lr].total++,Ji==="occupied"?Ss[Lr].occupied++:Ji==="closed"?Ss[Lr].closed++:Ss[Lr].open++)});const Xr=new Map;li.forEach((ci,Un)=>{const Tr=Un.split(":")[2],Ss=ci.tags.find(hs=>hs[0]==="a"&&hs[3]==="root")?.[1];if(!Ss)return;const Ji=Ss.split(":")[2],Lr=ci.tags.find(hs=>hs[0]==="type")?.[1]||"car";Xr.set(Tr,{listingId:Ji,type:Lr})}),Nt(ci=>{const Un=new Map(ci);return us.forEach((Tr,Ss)=>{Un.set(Ss,Tr)}),Un}),He(ci=>{const Un=new Map(ci);return Xr.forEach((Tr,Ss)=>{Un.set(Ss,Tr)}),Un})}}catch(Ct){console.error("[Parlens] Status batch fetching failed (listings still displayed):",Ct)}}catch($t){console.error("Error fetching listings:",$t)}finally{me(!1),Re(!1)}},[N,Ze]),Bi=ge.useCallback(async Ue=>{if(N){Wt([]),Re(!0);try{const mt=`${Ln.LISTED_PARKING_METADATA}:${Ue.pubkey}:${Ue.d}`,$t=Date.now(),gn=await N.querySync(ei,{kinds:[Ln.PARKING_SPOT_LISTING],"#a":[mt]}),un=Date.now()-$t;ei.forEach(Rn=>vo.recordSuccess(Rn,un)),console.log("[Parlens] Kind 37141 a-tag query:",gn.length,"spots in",un,"ms");const fn=Cr(gn,Ue);Wt(fn),fn.length>0&&await Jt(fn),console.log(`[Parlens] Spots loaded for ${Ue.listing_name}:`,fn.length)}catch(mt){ei.forEach($t=>vo.recordFailure($t)),console.error("Error fetching spots:",mt)}finally{Re(!1)}}},[N]),Cr=(Ue,mt)=>Ue.map($t=>{const gn=un=>$t.tags.find(fn=>fn[0]===un)?.[1]||"";return{id:$t.id,pubkey:$t.pubkey,d:gn("d"),a:gn("a"),spot_number:gn("spot_number"),floor:gn("floor"),short_name:gn("short_name"),type:gn("type")||"car",location:gn("location"),g:gn("g"),content:$t.content,rates:mt.rates?.[gn("type")||"car"]}}),Jt=async Ue=>{if(!N||Ue.length===0)return;const mt=Ue.flatMap(Hn=>{const Fn=`${Ln.PARKING_SPOT_LISTING}:${Hn.pubkey}:${Hn.d}`;return[Fn,Fn+""]}),$t=Date.now(),gn=await N.querySync(ei,{kinds:[Ln.LISTED_SPOT_LOG],"#a":mt}),un=Date.now()-$t;ei.forEach(Hn=>vo.recordSuccess(Hn,un));const fn=new Map;gn.forEach(Hn=>{const Fn=Hn.tags.find(ki=>ki[0]==="a")?.[1];(!fn.has(Fn)||fn.get(Fn).created_at<Hn.created_at)&&fn.set(Fn,Hn)});const Rn=new Map;fn.forEach((Hn,Fn)=>{const ki=Ue.find(xi=>`${Ln.PARKING_SPOT_LISTING}:${xi.pubkey}:${xi.d}`===Fn);if(ki){const xi=bi=>Hn.tags.find(Ct=>Ct[0]===bi)?.[1]||"";Rn.set(ki.d,{id:Hn.id,pubkey:Hn.pubkey,a:xi("a"),status:xi("status")||"open",updated_by:xi("updated_by"),authorizer:xi("authorizer"),created_at:Hn.created_at})}}),it(Hn=>{const Fn=new Map(Hn);return Rn.forEach((ki,xi)=>{const bi=Fn.get(xi);(!bi||bi.created_at<ki.created_at)&&Fn.set(xi,ki)}),Fn})};ge.useEffect(()=>{d&&!pe.current&&(pe.current=d),!je.current&&pe.current&&(je.current=!0,Ei())},[Ei,d]),ge.useEffect(()=>{if(!N)return;console.log("[Parlens] Setting up real-time listing subscription");const Ue=N.subscribeMany(ei,[{kinds:[Ln.LISTED_PARKING_METADATA],since:Math.floor(Date.now()/1e3)}],{onevent(mt){const $t=mt.tags.find(gn=>gn[0]==="d")?.[1];!$t||mt.content==="Deleted"||mt.content==="Parlens Relay Check"||$t.startsWith("test-relay-check-")||(console.log("[Parlens] New listing event received:",$t),Ye(gn=>{const un=`${mt.pubkey}:${$t}`,fn=gn.findIndex(ii=>`${ii.pubkey}:${ii.d}`===un),Rn=ii=>mt.tags.find($n=>$n[0]===ii)?.[1]||"",Hn=ii=>mt.tags.filter($n=>$n[0]===ii).map($n=>$n[1]),Fn=mt.tags.filter(ii=>ii[0]==="p"&&ii[2]==="admin").map(ii=>ii[1]),ki=mt.tags.filter(ii=>ii[0]==="p"&&ii[2]==="write").map(ii=>ii[1]),xi=mt.tags.filter(ii=>ii[0]==="p"&&ii[2]==="read").map(ii=>ii[1]),bi=Hn("relay"),Ct=Rn("floor_plan"),Zn=Ct?JSON.parse(Ct):void 0;let En;try{const ii=Rn("rates");ii&&(En=JSON.parse(ii))}catch{}const Ri={id:mt.id,pubkey:mt.pubkey,d:Rn("d"),listing_name:Rn("listing_name")||"Unnamed",location:Rn("location"),g:Rn("g"),floors:Rn("floors"),floor_plan:Zn,rates:En,listing_type:Rn("listing_type")||"public",qr_type:Rn("qr_type")||"static",status:Rn("status")||"open",owners:Fn,managers:ki,members:xi,relays:bi,local_area:Rn("local_area"),city:Rn("city"),zipcode:Rn("zipcode"),created_at:mt.created_at,originalEvent:mt};if(fn>=0&&gn[fn]){if((gn[fn]?.created_at??0)<mt.created_at){const $n=[...gn];return $n[fn]=Ri,$n}return gn}else return[Ri,...gn]}))},oneose(){console.log("[Parlens] Listing subscription active")}});return()=>{console.log("[Parlens] Closing listing subscription"),Ue.close()}},[N]),ge.useEffect(()=>{if(!N)return;let Ue=[];if(pt.length>0)Ue=pt.map(un=>`${Ln.PARKING_SPOT_LISTING}:${un.pubkey}:${un.d}`);else return;if(Ue.length===0)return;console.log("[Parlens] Subscribing to status updates for",Ue.length,"spots");const mt=new Map,$t=N.subscribeMany(ei,[{kinds:[Ln.LISTED_SPOT_LOG],"#a":Ue}],{onevent(un){const fn=un.tags.find(Fn=>Fn[0]==="a")?.[1],Rn=un.tags.find(Fn=>Fn[0]==="status")?.[1];if(!fn||!Rn)return;const Hn=mt.get(fn);Hn&&Hn.created_at>=un.created_at||(mt.set(fn,{status:Rn,created_at:un.created_at}),it(Fn=>{const ki=fn.split(":").pop();if(!ki)return Fn;const xi=new Map(Fn),bi=xi.get(ki);if((!bi||bi.created_at<un.created_at)&&(xi.set(ki,{id:un.id,pubkey:un.pubkey,a:fn,status:Rn,updated_by:un.tags.find(Ct=>Ct[0]==="updated_by")?.[1]||"",authorizer:un.tags.find(Ct=>Ct[0]==="authorizer")?.[1]||"",created_at:un.created_at}),ki)){const Ct=at.get(ki);Ct&&Nt(Zn=>{const En=Zn.get(Ct.listingId);if(!En)return Zn;const Ri=new Map(Zn),ii={...En[Ct.type]},$n=bi?.status||"open",jn=Rn;return $n==="occupied"?ii.occupied=Math.max(0,ii.occupied-1):$n==="closed"?ii.closed=Math.max(0,ii.closed-1):ii.open=Math.max(0,ii.open-1),jn==="occupied"?ii.occupied++:jn==="closed"?ii.closed++:ii.open++,Ri.set(Ct.listingId,{...En,[Ct.type]:ii}),Ri})}return xi}))},oneose(){console.log("[Parlens] Real-time subscription active, status data received"),Re(!1)}}),gn=setTimeout(()=>{Re(!1)},3e3);return()=>{console.log("[Parlens] Closing real-time status subscription"),clearTimeout(gn),$t.close()}},[N,pt,at]),ge.useEffect(()=>{Y&&Bi(Y)},[Y,Bi]),ge.useEffect(()=>{if(!Y||pt.length===0)return;const Ue={car:{open:0,occupied:0,closed:0,total:0,rate:Y.rates?.car?.hourly||0},motorcycle:{open:0,occupied:0,closed:0,total:0,rate:Y.rates?.motorcycle?.hourly||0},bicycle:{open:0,occupied:0,closed:0,total:0,rate:Y.rates?.bicycle?.hourly||0}};for(const mt of pt){const $t=mt.type||"car",gn=Et.get(mt.d)?.status||"open";Ue[$t]&&(Ue[$t].total++,gn==="occupied"?Ue[$t].occupied++:gn==="closed"?Ue[$t].closed++:Ue[$t].open++)}Nt(mt=>{const $t=new Map(mt);return $t.set(Y.d,Ue),$t})},[Et,Y,pt]);const gi=async Ue=>{if(!(!N||!P||!h)&&confirm(`Delete "${Ue.listing_name}" ? This will delete all spots.`)){Ne(!0);try{const mt=`${Ln.LISTED_PARKING_METADATA}:${Ue.pubkey}:${Ue.d}`,$t=Date.now(),gn=await N.querySync(ei,{kinds:[Ln.PARKING_SPOT_LISTING],"#a":[mt]}),un=Date.now()-$t;ei.forEach(Rn=>vo.recordSuccess(Rn,un)),console.log("[Parlens] Kind 37141 delete query:",gn.length,"spots in",un,"ms");for(const Rn of gn){const Hn=Rn.tags.find(Fn=>Fn[0]==="d")?.[1];if(Hn){const Fn={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Rn.id],["a",`${Ln.PARKING_SPOT_LISTING}:${P}:${Hn}`]],content:"Deleted"};await Promise.allSettled(N.publish(ei,await h(Fn)))}}const fn={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Ue.id],["a",`${Ln.LISTED_PARKING_METADATA}:${P}:${Ue.d}`]],content:"Deleted"};await Promise.allSettled(N.publish(ei,await h(fn))),Ye(Rn=>Rn.filter(Hn=>Hn.id!==Ue.id)),Q(null)}catch(mt){console.error(mt)}finally{Ne(!1)}}},An=ge.useMemo(()=>{let Ue=tt.filter(mt=>{if(Gn&&!Di.has(mt.id))return!1;let $t=!1;if(U==="public"){const gn=mt.pubkey===jh,un=`${Ln.LISTED_PARKING_METADATA}:${mt.pubkey}:${mt.d}`,fn=nn.has(un);$t=mt.listing_type==="public"&&(gn||fn)}else if(U==="private")$t=mt.listing_type==="private"&&(mt.members.includes(P)||mt.owners.includes(P)||mt.managers.includes(P));else if(U==="my"){const gn=mt.owners.includes(P)||mt.managers.includes(P),un=`${Ln.LISTED_PARKING_METADATA}:${mt.pubkey}:${mt.d}`,fn=mt.pubkey===jh,Rn=nn.has(un),Hn=mt.listing_type==="public"&&!fn&&!Rn,Fn=mt.listing_type==="public"&&(fn||Rn);if(vi)switch(Ki){case"my":$t=gn;break;case"approved":$t=!gn&&Fn;break;case"pending":$t=Hn;break;default:$t=gn||mt.listing_type==="public";break}else if($t=gn,$t&&U==="my")switch(oe){case"approved":$t=fn||Rn;break;case"pending":$t=!fn&&!Rn;break}}if(!$t||U!=="my"&&zi(mt.id,mt.pubkey))return!1;if(Gt){const gn=Gt.toLowerCase();if(!(mt.listing_name.toLowerCase().includes(gn)||mt.local_area?.toLowerCase().includes(gn)||mt.city?.toLowerCase().includes(gn)||mt.zipcode?.toLowerCase().includes(gn)))return!1}return!0});return Ue.sort((mt,$t)=>{if(Gt){const ki=Gt.toLowerCase(),xi=mt.listing_name.toLowerCase()===ki,bi=$t.listing_name.toLowerCase()===ki;if(xi&&!bi)return-1;if(!xi&&bi)return 1}const gn=Ze||d;if(gn&&mt.location&&$t.location){const[ki,xi]=mt.location.split(",").map(Zn=>parseFloat(Zn.trim())),[bi,Ct]=$t.location.split(",").map(Zn=>parseFloat(Zn.trim()));if(!isNaN(ki)&&!isNaN(xi)&&!isNaN(bi)&&!isNaN(Ct)){const Zn=j_(gn[0],gn[1],ki,xi),En=j_(gn[0],gn[1],bi,Ct);if(Math.abs(Zn-En)>.1)return Zn-En}}const un=nt.get(mt.d),fn=nt.get($t.d),Rn=ki=>ki?Te==="all"?ki.car.open+ki.motorcycle.open+ki.bicycle.open:ki[Te]?.open||0:0,Hn=Rn(un),Fn=Rn(fn);return Hn!==Fn?Fn-Hn:mt.listing_name.localeCompare($t.listing_name)}),Ue},[tt,U,P,wt,nt,Te,d,Di,Gn,Gt,Ze,Ki,vi,nn]),ar=ge.useMemo(()=>An.slice(0,si),[An,si]),Zi=ge.useMemo(()=>{const Ue=new Set;return pt.forEach(mt=>{mt.floor&&Ue.add(mt.floor)}),Array.from(Ue).sort()},[pt]),ln=ge.useMemo(()=>{const Ue=Y&&P&&(Y.owners.includes(P)||Y.managers.includes(P));return pt.filter(mt=>{if(Te!=="all"&&mt.type!==Te||Bt!=="all"&&mt.floor!==Bt)return!1;const gn=Et.get(mt.d)?.status||"open";return!(!Ue&&gn!=="open"||an!=="all"&&gn!==an)}).sort((mt,$t)=>parseInt(mt.spot_number||"0")-parseInt($t.spot_number||"0"))},[pt,Te,Bt,an,Et,Y,P]);return M.jsxs("div",{className:"fixed inset-0 z-[3000] bg-zinc-50 dark:bg-black flex flex-col transition-colors",children:[Nn&&M.jsxs("div",{className:"fixed inset-0 z-[6000] flex items-center justify-center bg-black/60 backdrop-blur-sm flex-col animate-in fade-in duration-200",children:[M.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-white/20 border-t-white rounded-full"}),M.jsx("div",{className:"text-white font-bold mt-4 animate-pulse",children:"Updating Status..."})]}),Zt&&M.jsxs("div",{className:"fixed inset-0 z-[3100] flex items-center justify-center bg-black/50 backdrop-blur-sm flex-col",children:[M.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-white/20 border-t-white rounded-full"}),M.jsx("div",{className:"text-white font-bold mt-4",children:"Deleting..."})]}),M.jsx("div",{className:"bg-white dark:bg-[#1c1c1e] border-b border-black/5 dark:border-white/10",children:M.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("button",{onClick:Y?()=>Q(null):c,className:"p-2 rounded-full bg-black/5 dark:bg-white/10 active:scale-95 transition-transform",style:{WebkitTapHighlightColor:"transparent"},children:M.jsx(ip,{size:20,className:"text-black/60 dark:text-white/60 rotate-180"})}),M.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 bg-clip-text text-transparent",children:Y?Y.listing_name:"Listed Parking"})]}),M.jsxs("div",{className:"flex items-center gap-2",children:[!Y&&M.jsx("button",{onClick:()=>we(!0),className:"p-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full shadow-lg shadow-blue-500/20 active:scale-95 transition-transform",style:{WebkitTapHighlightColor:"transparent"},children:M.jsx(o1,{size:20})}),M.jsx("button",{onClick:async()=>{he||(console.log("[Parlens] Refreshing data and connections..."),Re(!0),setTimeout(async()=>{d&&(pe.current=d);const Ue=[Ei(!0)];Y&&Ue.push(Bi(Y)),await Promise.all(Ue)},50))},className:`p-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full shadow-lg shadow-blue-500/20 active:scale-95 transition-transform ${he?"opacity-70 cursor-not-allowed":""}`,style:{WebkitTapHighlightColor:"transparent"},title:"Refresh",children:M.jsx(S_,{size:20,className:he?"animate-spin":""})})]})]})}),M.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:Y?M.jsxs("div",{className:"flex-1 flex flex-col p-4 bg-zinc-50 dark:bg-black/50 min-h-0",children:[M.jsxs("div",{className:"flex gap-2 mb-4 shrink-0",children:[M.jsxs("select",{value:Te,onChange:Ue=>We(Ue.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[M.jsx("option",{value:"all",children:"All Types"}),M.jsx("option",{value:"car",children:" Car"}),M.jsx("option",{value:"motorcycle",children:" Motorcycle"}),M.jsx("option",{value:"bicycle",children:" Bicycle"})]}),M.jsxs("select",{value:Bt,onChange:Ue=>Kt(Ue.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[M.jsx("option",{value:"all",children:"All Floors"}),Zi.map(Ue=>M.jsx("option",{value:Ue,children:Ue},Ue))]}),M.jsxs("select",{value:an,onChange:Ue=>sn(Ue.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[M.jsx("option",{value:"all",children:"All Status"}),M.jsx("option",{value:"open",children:" Open"}),M.jsx("option",{value:"occupied",children:" Occupied"}),M.jsx("option",{value:"closed",children:" Closed"})]})]}),M.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:M.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:[ln.map(Ue=>{const mt=Et.get(Ue.d),$t=mt?.status==="occupied"?"bg-red-500/10 border-red-500/20 text-red-600 dark:text-red-400":mt?.status==="closed"?"bg-zinc-500/10 border-zinc-500/20 text-zinc-600 dark:text-zinc-400":"bg-green-500/10 border-green-500/20 text-green-600 dark:text-green-400";return M.jsxs("button",{onClick:()=>Pe(Ue),className:`p-3 rounded-2xl border ${$t} text-center active:scale-[0.98] transition-transform relative`,children:[M.jsx("div",{className:"text-3xl mb-1",children:Ue.type==="car"?"":Ue.type==="motorcycle"?"":""}),M.jsx("p",{className:"font-bold text-sm text-zinc-900 dark:text-white",children:Ue.short_name||`#${Ue.spot_number}`}),Ue.floor&&M.jsx("p",{className:"text-xs opacity-60",children:Ue.floor}),M.jsx("p",{className:"mt-1 text-[10px] font-bold uppercase tracking-wider opacity-80",children:mt?.status||"Open"})]},Ue.id)}),he&&M.jsx("div",{className:"flex items-center justify-center p-6 bg-zinc-50 dark:bg-white/5 rounded-2xl border-2 border-dashed border-zinc-200 dark:border-white/10 min-h-[100px]",children:M.jsx("div",{className:"animate-spin w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500"})})]})})]}):M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"px-4 py-2 bg-white dark:bg-[#1c1c1e] border-t border-black/5 dark:border-white/10",children:M.jsx("div",{className:"flex justify-between items-center gap-2",children:["public","private","my"].map(Ue=>M.jsx("button",{onClick:()=>H(Ue),className:`flex-1 flex items-center justify-center py-2 text-sm transition-all active:scale-95 ${U===Ue?"text-zinc-900 dark:text-white font-bold border-b-2 border-blue-500":"text-zinc-400 dark:text-white/40"}`,children:Ue==="public"?"Public":Ue==="private"?"Private":"My Listings"},Ue))})}),M.jsx("div",{className:"relative px-4 py-3 bg-white dark:bg-[#1c1c1e] border-b border-black/5 dark:border-white/10 z-[3001]",children:M.jsxs("div",{className:"relative z-[4000]",children:[M.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 z-10",children:jt?M.jsx(S_,{size:18,className:"animate-spin"}):M.jsx(a2,{size:18})}),M.jsx("input",{value:wt,onChange:Kn,onKeyDown:Ue=>{Ue.key==="Enter"&&lr()},placeholder:"Search for listings near...",className:`w-full pl-10 pr-10 py-3 bg-zinc-100 dark:bg-zinc-800 text-sm font-medium text-zinc-900 dark:text-white border-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder:text-zinc-400 dark:placeholder:text-zinc-500 ${Oe.length>0||ai.length>0||Qn.length>0?"rounded-t-xl rounded-b-none":"rounded-xl"}`}),wt&&M.jsx("button",{onClick:()=>{zt(""),At([]),ke(""),d&&yt(d)},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full text-zinc-400 active:text-zinc-600 dark:active:text-zinc-200 z-10",children:M.jsx(no,{size:16})}),(Oe.length>0||ai.length>0||Qn.length>0)&&M.jsx("div",{className:"absolute top-full left-0 right-0 bg-white dark:bg-zinc-900 rounded-b-xl shadow-xl border-x border-b border-black/5 dark:border-white/5 overflow-hidden z-[4000] mt-0",children:M.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[M.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-white/5 border-t border-black/5 dark:border-white/5 flex items-center gap-2",children:[Qn.length>0&&M.jsx("span",{className:"inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-blue-500/10 to-cyan-500/10 dark:from-blue-500/20 dark:to-cyan-500/20 text-[10px] font-bold text-blue-600 dark:text-blue-300 uppercase tracking-wider border border-blue-200 dark:border-blue-500/20",children:"Locality"}),Oe.length>0&&M.jsx("span",{className:"inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-violet-500/10 to-fuchsia-500/10 dark:from-violet-500/20 dark:to-fuchsia-500/20 text-[10px] font-bold text-violet-600 dark:text-violet-300 uppercase tracking-wider border border-violet-200 dark:border-violet-500/20",children:"OSM Search"}),ai.length>0&&M.jsx("span",{className:"inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-emerald-500/10 to-teal-500/10 dark:from-emerald-500/20 dark:to-teal-500/20 text-[10px] font-bold text-emerald-600 dark:text-emerald-300 uppercase tracking-wider border border-emerald-200 dark:border-emerald-500/20",children:"Saved Places"})]}),Qn.map((Ue,mt)=>M.jsxs("button",{onClick:()=>{const $t={place_id:parseInt(Ue.lat.toString().replace(".","")),display_name:Ue.name,lat:Ue.lat.toString(),lon:Ue.lon.toString()};Jn($t)},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-blue-50 dark:bg-blue-500/10 text-blue-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 shrink-0 transition-colors",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Ue.name}),M.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:"Parking listings nearby"})]})]},`listing-${mt}`)),ai.map((Ue,mt)=>M.jsxs("button",{onClick:()=>{const $t={place_id:parseInt(Ue.lat.toString().replace(".","")),display_name:Ue.name,lat:Ue.lat.toString(),lon:Ue.lon.toString()};Jn($t)},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 shrink-0 transition-colors",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Ue.name}),M.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:"Saved from your routes"})]})]},`saved-${mt}`)),Oe.map(Ue=>M.jsxs("button",{onClick:()=>Jn(Ue),className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full shrink-0 transition-colors bg-violet-50 dark:bg-violet-500/10 text-violet-500 group-hover:text-violet-600 dark:group-hover:text-violet-400",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Ue.display_name.split(",")[0]}),M.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:Ue.display_name.split(",").slice(1).join(",")})]})]},Ue.place_id))]})})]})}),M.jsxs("div",{className:"flex items-center justify-between text-[10px] font-bold uppercase tracking-wider text-zinc-500 px-4 py-2 overflow-x-auto shrink-0",children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"Open"]}),U==="my"&&M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),"Occupied"]}),M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx("div",{className:"w-2 h-2 rounded-full bg-zinc-400"}),"Closed"]})]})]}),vi&&U==="my"&&M.jsxs("select",{value:Ki,onChange:Ue=>Pi(Ue.target.value),className:"pl-2 pr-6 py-1 rounded-full border border-transparent bg-zinc-100 dark:bg-white/5 text-zinc-500 dark:text-zinc-400 text-[10px] font-bold uppercase tracking-wider appearance-none cursor-pointer transition-colors active:bg-zinc-200 dark:active:bg-white/10 outline-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 6px center",backgroundSize:"12px"},children:[M.jsx("option",{value:"all",children:"All"}),M.jsx("option",{value:"my",children:"Mine"}),M.jsx("option",{value:"approved",children:"Approved"}),M.jsx("option",{value:"pending",children:"Pending"})]}),!vi&&U==="my"&&M.jsxs("select",{value:oe,onChange:Ue=>ce(Ue.target.value),className:"pl-2 pr-6 py-1 rounded-full border border-transparent bg-zinc-100 dark:bg-white/5 text-zinc-500 dark:text-zinc-400 text-[10px] font-bold uppercase tracking-wider appearance-none cursor-pointer transition-colors active:bg-zinc-200 dark:active:bg-white/10 outline-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 6px center",backgroundSize:"12px"},children:[M.jsx("option",{value:"all",children:"All"}),M.jsx("option",{value:"approved",children:"Approved"}),M.jsx("option",{value:"pending",children:"Pending"})]}),U!=="my"&&M.jsxs("button",{onClick:()=>In(!Gn),className:`flex items-center gap-1 px-2 py-1 rounded-full border transition-colors text-[10px] font-bold uppercase tracking-wider ${Gn?"bg-yellow-500/10 border-yellow-500/20 text-yellow-600 dark:text-yellow-400":"bg-zinc-100 dark:bg-white/5 border-transparent text-zinc-500 active:bg-zinc-200 dark:active:bg-white/10"}`,children:[M.jsx(C_,{size:12,className:Gn?"fill-yellow-500 stroke-yellow-500":"fill-transparent stroke-zinc-400"}),Gn?"Saved":"All"]})]}),M.jsx("div",{className:"flex-1 overflow-y-auto pt-2 px-4 pb-4 space-y-3",children:ve?M.jsx("div",{className:"flex justify-center p-8",children:M.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"})}):An.length===0?M.jsx("div",{className:"text-center py-10 text-zinc-400",children:"No listings found"}):M.jsxs(M.Fragment,{children:[ar.map(Ue=>{const mt=nt.get(Ue.d);let $t=Ue.status==="closed";if(mt){const un=(mt.car?.open||0)+(mt.motorcycle?.open||0)+(mt.bicycle?.open||0),fn=(mt.car?.occupied||0)+(mt.motorcycle?.occupied||0)+(mt.bicycle?.occupied||0);(mt.car?.total||0)+(mt.motorcycle?.total||0)+(mt.bicycle?.total||0)>0&&($t=un+fn===0)}const gn=mt;return M.jsxs("div",{className:`group relative bg-white dark:bg-[#1c1c1e] rounded-2xl p-2.5 border border-black/5 dark:border-white/10 shadow-sm transition-all hover:shadow-md active:scale-[0.99] cursor-pointer ${ui===Ue.id?"z-50":""}`,onClick:()=>Q(Ue),children:[M.jsxs("div",{className:"flex flex-col items-start gap-1 mb-2",children:[M.jsxs("div",{className:"flex items-center justify-between w-full gap-1.5",children:[M.jsx("div",{className:"min-w-0 flex items-center h-full",children:M.jsx("h3",{className:"font-bold text-zinc-900 dark:text-white text-base leading-tight truncate",children:Ue.listing_name})}),M.jsxs("div",{className:"flex items-center gap-1 h-full",children:[U!=="my"&&M.jsx("button",{onClick:un=>{un.stopPropagation(),Je(Ue.id)},className:"p-2 rounded-full active:scale-95 transition-transform flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent"},children:M.jsx(C_,{size:16,className:Di.has(Ue.id)?"fill-yellow-500 stroke-yellow-500 text-yellow-500":"text-zinc-400"})}),M.jsx("button",{onClick:un=>{un.stopPropagation(),tn(Ue)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:M.jsx(CT,{size:16})}),U==="my"&&Ue.owners.includes(P)?M.jsxs(M.Fragment,{children:[M.jsx("button",{onClick:un=>{un.stopPropagation(),vt(Ue),we(!0)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:M.jsx(Vd,{size:16})}),M.jsx("button",{onClick:un=>{un.stopPropagation(),gi(Ue)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:M.jsx(rp,{size:16})})]}):U==="my"&&Ue.managers.includes(P)?null:M.jsxs("div",{className:"relative flex items-center",children:[M.jsx("button",{onClick:un=>{un.stopPropagation(),_i(ui===Ue.id?null:Ue.id)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:M.jsx(L3,{size:16})}),ui===Ue.id&&M.jsxs(M.Fragment,{children:[M.jsx("style",{children:`
                                                                            @keyframes menuFadeIn {
                                                                                from { opacity: 0; transform: scale(0.95); }
                                                                                to { opacity: 1; transform: scale(1); }
                                                                            }
                                                                        `}),M.jsxs("div",{className:"absolute right-0 top-8 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl shadow-xl z-50 overflow-hidden min-w-[200px]",style:{animation:"menuFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards",transformOrigin:"top right"},onClick:un=>un.stopPropagation(),children:[M.jsxs("button",{onClick:un=>{un.stopPropagation(),Mi(Ue.id,Ue.listing_name)},className:"w-full px-4 py-3 text-left text-sm text-zinc-700 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2",children:[M.jsx(Cx,{size:16})," Hide this listing"]}),Ue.pubkey&&M.jsxs("button",{onClick:un=>{un.stopPropagation(),ni(Ue.pubkey,Ue.listing_name+" (owner)")},className:"w-full px-4 py-3 text-left text-sm text-zinc-700 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2 border-t border-black/5 dark:border-white/10",children:[M.jsx(Sx,{size:16})," Hide all from owner"]})]})]})]})]})]}),M.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[M.jsx("span",{className:`shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider ${Ue.listing_type==="public"?"bg-green-500/10 text-green-600":"bg-purple-500/10 text-purple-600"}`,children:Ue.listing_type}),$t&&M.jsx("span",{className:"shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider bg-zinc-500/10 text-zinc-500 dark:text-zinc-400",children:"CLOSED"}),(Ue.local_area||Ue.city)&&M.jsx("span",{className:"shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider bg-blue-500/10 text-blue-500",children:Ue.local_area||Ue.city})]})]}),M.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{type:"car",icon:"",data:gn?.car,rate:Ue.rates?.car},{type:"motorcycle",icon:"",data:gn?.motorcycle,rate:Ue.rates?.motorcycle},{type:"bicycle",icon:"",data:gn?.bicycle,rate:Ue.rates?.bicycle}].map(un=>{const fn=(un.data?.total||0)>0,Rn=un.rate||{hourly:0,currency:"INR"},Hn=!!un.rate||fn;return M.jsxs("div",{className:`bg-zinc-50 dark:bg-white/10 rounded-xl p-2 text-center flex flex-col items-center justify-center min-h-[80px] ${$t?"opacity-50":""}`,children:[M.jsx("div",{className:"text-3xl mb-1",children:un.icon}),he?M.jsx("div",{className:"text-xl font-bold text-zinc-300 dark:text-white/20",children:"..."}):fn?M.jsxs("div",{className:"flex flex-col items-center w-full",children:[U==="my"?M.jsxs("div",{className:"font-bold text-sm flex items-center gap-1.5 mb-1.5",children:[M.jsx("span",{className:"text-green-500",children:un.data?.open||0}),M.jsx("span",{className:"text-zinc-300 dark:text-white/20",children:"|"}),M.jsx("span",{className:"text-red-500",children:un.data?.occupied||0}),M.jsx("span",{className:"text-zinc-300 dark:text-white/20",children:"|"}),M.jsx("span",{className:"text-zinc-400",children:un.data?.closed||0})]}):M.jsx("div",{className:"font-bold text-lg text-green-500 mb-1.5",children:un.data?.open||0}),Hn&&M.jsx("div",{className:"w-full bg-black/5 dark:bg-white/5 rounded-lg py-0.5 px-2",children:M.jsxs("div",{className:"text-zinc-900 dark:text-white font-bold text-sm",children:[Rn.currency==="USD"?"$":Rn.currency==="EUR"?"":Rn.currency==="GBP"?"":"",Rn.hourly,M.jsx("span",{className:"text-[10px] font-normal opacity-60",children:"/hr"})]})})]}):M.jsx("div",{className:"text-xs text-zinc-400 dark:text-white/30 font-medium",children:"Not Available"})]},un.type)})}),vi&&Ue.listing_type==="public"&&Ue.pubkey!==jh&&(()=>{const un=`${Ln.LISTED_PARKING_METADATA}:${Ue.pubkey}:${Ue.d}`,fn=nn.has(un);return M.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5 dark:border-white/5 flex items-center justify-between",onClick:Rn=>Rn.stopPropagation(),children:[M.jsx("span",{className:`text-sm font-semibold ${fn?"text-blue-600 dark:text-blue-400":"text-zinc-500 dark:text-white/50"}`,children:fn?"Approved":"Pending Approval"}),M.jsx("button",{onClick:()=>St(Ue),disabled:xr,className:`relative h-7 w-12 rounded-full transition-colors ${fn?"bg-blue-500":"bg-zinc-200 dark:bg-white/10"} ${xr?"opacity-50 cursor-wait":""}`,style:{WebkitTapHighlightColor:"transparent"},children:M.jsx("span",{className:`block h-5 w-5 rounded-full bg-white shadow-sm transition-transform ${fn?"translate-x-[26px]":"translate-x-[4px]"}`})})]})})(),U==="my"&&(Ue.owners.includes(P)||Ue.managers.includes(P))&&M.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5 dark:border-white/5 flex items-center justify-between relative",onClick:un=>un.stopPropagation(),children:[M.jsx("span",{className:`text-sm font-semibold ${$t?"text-zinc-500 dark:text-white/50":"text-green-600 dark:text-green-400"}`,children:$t?"Listing Closed":"Listing Open"}),M.jsx("button",{onClick:async()=>{const un=$t?"open":"closed";if(confirm(un==="closed"?"This will mark ALL spots as CLOSED. Continue?":"This will mark ALL spots as OPEN. Continue?")){Dn(!0);try{const Rn=`${Ln.LISTED_PARKING_METADATA}:${Ue.pubkey}:${Ue.d}`,Hn=Date.now(),Fn=await N.querySync(ei,{kinds:[Ln.PARKING_SPOT_LISTING],"#a":[Rn]}),ki=Date.now()-Hn;ei.forEach(ii=>vo.recordSuccess(ii,ki)),console.log("[Parlens] Kind 37141 toggle query:",Fn.length,"spots in",ki,"ms");const xi={car:{open:0,occupied:0,total:0,closed:0,rate:0},motorcycle:{open:0,occupied:0,total:0,closed:0,rate:0},bicycle:{open:0,occupied:0,total:0,closed:0,rate:0}},bi=nt.get(Ue.d),Ct=Fn.map(async ii=>{const $n=ii.tags.find(Lr=>Lr[0]==="d")?.[1];let jn=ii.tags.find(Lr=>Lr[0]==="type")?.[1]?.toLowerCase()||"car";["car","motorcycle","bicycle"].includes(jn)||(jn="car");const li=`${Ln.PARKING_SPOT_LISTING}:${ii.pubkey}:${$n}`;xi[jn]&&(xi[jn].total++,un==="closed"?xi[jn].closed++:xi[jn].open++,bi&&bi[jn]&&(xi[jn].rate=bi[jn].rate));const us=Ue.rates?.[jn]?.hourly||bi?.[jn]?.rate||0,Xr=Ue.rates?.[jn]?.currency||"USD",[ci,Un]=Ue.location.split(",").map(Lr=>parseFloat(Lr.trim())),Tr=Ol(ci,Un,10),Ss={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["a",li],["a",Rn,"","root"],["status",un],["updated_by",P],...Array.from({length:10},(Lr,hs)=>["g",Tr.substring(0,hs+1)]),["location",Ue.location],["type",jn],["hourly_rate",String(us)],["currency",Xr],["client","parlens"]],content:JSON.stringify({hourly_rate:us,currency:Xr})},Ji=await h(Ss);return N.publish(ei,Ji)});await Promise.allSettled(Ct);const Zn=Ue.originalEvent.tags.filter(ii=>ii[0]!=="status");Zn.push(["status",un]);const En={...Ue.originalEvent,created_at:Math.floor(Date.now()/1e3),tags:Zn},Ri=await h(En);await Promise.allSettled(N.publish(ei,Ri)),await new Promise(ii=>setTimeout(ii,1500)),await Ei(!0)}catch(Rn){console.error("Failed to update status:",Rn),alert("Failed to update status")}finally{Dn(!1)}}},className:`relative h-7 w-12 rounded-full transition-colors ${$t?"bg-zinc-200 dark:bg-white/10":"bg-green-500"}`,children:M.jsx("span",{className:`block h-5 w-5 rounded-full bg-white shadow-sm transition-transform ${$t?"translate-x-[4px]":"translate-x-[26px]"}`})})]})]},Ue.id)}),si<An.length&&M.jsx("button",{onClick:()=>kn(Ue=>Ue+10),className:"flex items-center justify-center gap-1 w-full py-3 rounded-full border transition-colors text-sm font-bold bg-zinc-100 dark:bg-white/5 border-transparent text-zinc-500 active:bg-zinc-200 dark:active:bg-white/10",children:"Load More"})]})})]})}),_e&&M.jsx(H4,{editing:ct,currentLocation:d,countryCode:y,onPickLocation:C,pickedLocation:D,onClose:()=>{we(!1),vt(null)},onCreated:()=>{we(!1),vt(null),Ei()}}),xt&&Y&&M.jsx(q4,{spot:xt,listing:tt.find(Ue=>Ue.d===xt.a.split(":")[2]),status:Et.get(xt.d),isManager:tt.find(Ue=>Ue.d===xt.a.split(":")[2]).owners.includes(P||"")||tt.find(Ue=>Ue.d===xt.a.split(":")[2]).managers.includes(P||""),listingStats:nt,setListingStats:Nt,setSpotStatuses:it,onSpotUpdate:()=>Ei(!0),onClose:()=>Pe(null)}),_t&&M.jsx(Z4,{listing:_t,onClose:()=>tn(null)})]})},H4=({editing:c,onClose:d,onCreated:y,currentLocation:C,countryCode:D,onPickLocation:P,pickedLocation:N})=>{const{pubkey:h,signEvent:U,pool:H}=nh(),[Y,Q]=ge.useState(1),[_e,we]=ge.useState(!1),[ve,me]=ge.useState(!1),he=ge.useMemo(()=>c?.floor_plan?c.floor_plan:[],[c]),[Re,tt]=ge.useState({listing_name:c?.listing_name||"",website:c?.website||"",location:c?.location||"",local_area:c?.local_area||"",city:c?.city||"",zipcode:c?.zipcode||"",country:c?.country||"",listing_type:c?.listing_type||"private",qr_type:c?.qr_type||"static",owners:c?.owners?.join(", ")||"",managers:c?.managers?.join(", ")||"",members:c?.members?.join(", ")||"",relays:c?.relays?.join(", ")||"",currency:"USD"}),[Ye,pt]=ge.useState(he),[Wt,Et]=ge.useState({name:"",counts:{car:0,motorcycle:0,bicycle:0},rates:{car:0,motorcycle:0,bicycle:0}});ge.useEffect(()=>{if(!c&&D){const Pe={US:"USD",GB:"GBP",EU:"EUR",IN:"INR"};tt(ct=>({...ct,currency:Pe[D]||"USD"}))}else c?.rates?.car?.currency&&tt(Pe=>({...Pe,currency:c.rates.car.currency}))},[D,c]),ge.useEffect(()=>{N&&(tt(Pe=>({...Pe,location:`${N.lat.toFixed(6)}, ${N.lon.toFixed(6)} `})),f2(N.lat,N.lon).then(Pe=>{Pe&&Pe!==Re.currency&&tt(ct=>({...ct,currency:Pe}))}))},[N]),ge.useEffect(()=>{const Pe=document.getElementById("create-listing-content");Pe&&Pe.scrollTo({top:0,behavior:"smooth"})},[Y]),ge.useEffect(()=>{const Pe=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=Pe}},[]);const it=Pe=>{if(!Pe)return null;const ct=Pe.split(",").map(vt=>vt.trim()).filter(Boolean);return ct.length===0?null:M.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ct.map((vt,Zt)=>M.jsx("span",{className:"px-2 py-1 bg-zinc-200 dark:bg-white/10 rounded-lg text-[10px] font-mono text-zinc-600 dark:text-zinc-400 flex items-center gap-1 max-w-full",children:M.jsx("span",{className:"truncate max-w-[150px]",children:vt})},Zt))})},at=()=>{Wt.name&&(pt([...Ye,{...Wt,id:crypto.randomUUID()}]),Et(Pe=>({...Pe,name:"",counts:{car:0,motorcycle:0,bicycle:0}})))},He=Pe=>{pt(Ye.filter((ct,vt)=>vt!==Pe))},xt=async()=>{if(!Re.listing_name)return;let Pe=[...Ye];if(Wt.name&&(Wt.counts.car>0||Wt.counts.motorcycle>0||Wt.counts.bicycle>0)&&ve&&(console.log("[Parlens] Auto-adding pending floor from open form:",Wt.name),Pe.push({...Wt,id:crypto.randomUUID()})),Pe.length===0){alert("Please add at least one floor with parking spots.");return}let ct="";if(Re.location){const[Gt,ke]=Re.location.split(",").map(nt=>parseFloat(nt.trim()));!isNaN(Gt)&&!isNaN(ke)&&(ct=Ol(Gt,ke,10))}const vt=(c?.d||crypto.randomUUID()).trim();console.log("[Parlens] Submitting Listing ID:",vt);const Zt=Gt=>Gt.split(",").map(ke=>ke.trim()).filter(Boolean).map(ke=>{if(ke.startsWith("npub"))try{const{data:nt}=j4(ke);return nt}catch{return console.error("Invalid npub:",ke),ke}return ke});let Ne=0;const Te={};Pe.forEach(Gt=>{Ne+=(Gt.counts.car||0)+(Gt.counts.motorcycle||0)+(Gt.counts.bicycle||0),!Te.car&&Gt.rates.car!==void 0&&(Te.car={hourly:Gt.rates.car||0,currency:Re.currency}),!Te.motorcycle&&Gt.rates.motorcycle!==void 0&&(Te.motorcycle={hourly:Gt.rates.motorcycle||0,currency:Re.currency}),!Te.bicycle&&Gt.rates.bicycle!==void 0&&(Te.bicycle={hourly:Gt.rates.bicycle||0,currency:Re.currency})});const We={kind:Ln.LISTED_PARKING_METADATA,created_at:Math.floor(Date.now()/1e3),tags:[["d",vt],["listing_name",Re.listing_name.slice(0,25)],["location",Re.location],["g",ct],...Array.from({length:Math.min(ct.length,10)},(Gt,ke)=>["g",ct.substring(0,ke+1)]).filter(Gt=>Gt[1].length<ct.length),["local_area",Re.local_area||""],["city",Re.city||""],["zipcode",Re.zipcode||""],["country",Re.country||""],["floors",Pe.map(Gt=>Gt.name).join(", ")],["floor_plan",JSON.stringify(Pe)],["total_spots",String(Ne+(c&&!c.floor_plan&&c.total_spots||0))],["rates",JSON.stringify(Te)],["listing_type",Re.listing_type],["qr_type",Re.qr_type],["client","parlens"],...Zt(Re.owners).map(Gt=>["p",Gt,"admin"]),...Zt(Re.managers).map(Gt=>["p",Gt,"write"]),...Zt(Re.members).map(Gt=>["p",Gt,"read"]),...Zt(Re.relays).map(Gt=>["relay",Gt])],content:""},wt=!c,zt=c&&c.owners.includes(h||"");(wt||zt)&&!We.tags.find(Gt=>Gt[0]==="p"&&Gt[1]===h&&Gt[2]==="admin")&&We.tags.push(["p",h,"admin"]),we(!0);try{if(await Promise.allSettled(H.publish(ei,await U(We))),!c){console.log("[Parlens] Creating spots for floors:",Pe.length);let Gt=1;for(const ke of Pe)for(const[nt,Nt]of Object.entries(ke.counts)){console.log(`[Parlens] Floor ${ke.name} Type ${nt} Count ${Nt}`);for(let _t=0;_t<Nt;_t++){const tn=`${vt}-spot-${Gt}`,Bt=`${Ln.LISTED_PARKING_METADATA}:${h}:${vt}`,Kt={kind:Ln.PARKING_SPOT_LISTING,created_at:Math.floor(Date.now()/1e3),tags:[["d",tn],["a",Bt],["spot_number",String(Gt)],["floor",ke.name],["type",nt],["location",Re.location],["g",ct],["client","parlens"]],content:`${Re.listing_name} #${Gt}`};await Promise.allSettled(H.publish(ei,await U(Kt)));try{const an=`${Ln.PARKING_SPOT_LISTING}:${h}:${tn}`,[sn,Nn]=Re.location.split(",").map(_i=>parseFloat(_i.trim())),Dn=Te[nt]?.hourly||0,si=Te[nt]?.currency||Re.currency,kn=Ol(sn,Nn,10),ui={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["a",an],["a",Bt,"","root"],["status","open"],["updated_by",h],...Array.from({length:10},(_i,Di)=>["g",kn.substring(0,Di+1)]),["location",Re.location],["type",nt],["hourly_rate",String(Dn)],["currency",si],["listing_name",Re.listing_name],["client","parlens"]],content:JSON.stringify({hourly_rate:Dn,currency:si})};await Promise.allSettled(H.publish(ei,await U(ui)))}catch(an){console.warn("[Parlens] Failed to publish initial status for spot:",tn,an)}Gt++}}}y()}catch(Gt){console.error("Failed to save listing:",Gt),alert("Failed to save listing. Please try again.")}finally{we(!1)}};return M.jsx("div",{className:"fixed inset-0 z-[4000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:M.jsxs("div",{id:"create-listing-content",className:"w-full max-w-lg bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 shadow-2xl overflow-y-auto max-h-[90vh]",children:[_e&&M.jsxs("div",{className:"absolute inset-0 z-50 bg-white/50 dark:bg-black/50 backdrop-blur-[2px] flex flex-col items-center justify-center rounded-3xl",children:[M.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),M.jsx("div",{className:"text-zinc-900 dark:text-white font-bold animate-pulse",children:"Saving Listing..."})]}),M.jsxs("div",{className:"flex justify-between items-center mb-6",children:[M.jsx("h2",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:c?"Edit Listing":"Create Listing"}),M.jsx("button",{onClick:d,children:M.jsx(no,{className:"text-zinc-500 dark:text-white"})})]}),Y===1?M.jsxs("div",{className:"space-y-4",children:[M.jsxs("div",{className:"space-y-1",children:[M.jsxs("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:["Listing Name",M.jsx(Xf,{title:"Listing Name",text:"Maximum 25 characters"})]}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"560038 Public Parking",value:Re.listing_name,maxLength:25,onChange:Pe=>tt({...Re,listing_name:Pe.target.value})})]}),M.jsxs("div",{className:"space-y-1",children:[M.jsxs("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:["Location",M.jsx(Xf,{title:"Location",text:"If you are listing an individual spot, mark location as the centre of the spot. If you are listing multiple street parking spots, mark mid points between junctions and create multiple listings as required to manage spots. If you are listing a lot, mark the street entrance of the lot."})]}),M.jsxs("div",{className:"flex gap-2",children:[M.jsx("input",{className:"flex-1 min-w-0 p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"lat, lon",value:Re.location,onChange:Pe=>tt({...Re,location:Pe.target.value})}),M.jsx("button",{onClick:C?()=>tt({...Re,location:`${C[0].toFixed(6)}, ${C[1].toFixed(6)}`}):void 0,className:"shrink-0 p-3 bg-blue-500/10 text-blue-500 rounded-xl",children:M.jsx(X3,{size:20})}),P&&M.jsx("button",{onClick:P,className:"shrink-0 p-3 bg-orange-500/10 text-orange-600 dark:text-orange-400 border border-orange-500/20 rounded-xl",children:M.jsx(to,{size:20})})]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[M.jsxs("div",{className:"space-y-1",children:[M.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Local Area"}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Indiranagar",value:Re.local_area,onChange:Pe=>tt({...Re,local_area:Pe.target.value})})]}),M.jsxs("div",{className:"space-y-1",children:[M.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"City"}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Bangalore",value:Re.city,onChange:Pe=>tt({...Re,city:Pe.target.value})})]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[M.jsxs("div",{className:"space-y-1",children:[M.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Zipcode"}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"560038",value:Re.zipcode,onChange:Pe=>tt({...Re,zipcode:Pe.target.value})})]}),M.jsxs("div",{className:"space-y-1",children:[M.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Country"}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"India",value:Re.country,onChange:Pe=>tt({...Re,country:Pe.target.value})})]})]}),M.jsxs("div",{className:"space-y-1",children:[M.jsxs("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:["Access Type",M.jsx(Xf,{title:"Access Type",text:"Public listings require approval before they are visible to users. You must begin using Parlens QR authentication to manage spots in your parking to qualify for approval. Use the drop down filter in the My Listings page to view public listings by approval status."})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[M.jsx("button",{onClick:()=>tt({...Re,listing_type:"private"}),className:`p-3 rounded-xl font-bold transition-colors ${Re.listing_type==="private"?"bg-purple-500 text-white":"bg-zinc-100 text-zinc-600 dark:bg-white/5 dark:text-white"}`,children:"Private"}),M.jsx("button",{onClick:()=>tt({...Re,listing_type:"public"}),className:`p-3 rounded-xl font-bold transition-colors ${Re.listing_type==="public"?"bg-green-500 text-white":"bg-zinc-100 text-zinc-600 dark:bg-white/5 dark:text-white"}`,children:"Public"})]})]}),M.jsxs("div",{className:"space-y-1",children:[M.jsxs("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:["QR Code Type",M.jsx(Xf,{title:"QR Code Type",text:"QR codes enable users to update spot statuses through one time authentication. Static QR codes remain the same after each parking session and are ideal for self-managed lots, like visitor parking in an apartment or an office parking lot, where user trust is high. Dynamic QR codes are updated after each log status update and are ideal for large lots that are open to the public. Dynamic QRs prevent users from taking a photograph of the QR to update spot status at a later time."})]}),M.jsx("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:M.jsxs("div",{className:"flex gap-4",children:[M.jsxs("label",{className:"flex items-center gap-2 text-zinc-900 dark:text-white font-medium text-sm",children:[M.jsx("input",{type:"radio",checked:Re.qr_type==="static",onChange:()=>tt({...Re,qr_type:"static"})})," Static"]}),M.jsxs("label",{className:"flex items-center gap-2 text-zinc-900 dark:text-white font-medium text-sm",children:[M.jsx("input",{type:"radio",checked:Re.qr_type==="dynamic",onChange:()=>tt({...Re,qr_type:"dynamic"})})," Dynamic"]})]})})]}),Re.listing_type==="private"&&M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"space-y-1",children:[M.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Members"}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys (comma separated)",value:Re.members,onChange:Pe=>tt({...Re,members:Pe.target.value})}),it(Re.members)]}),M.jsxs("div",{className:"space-y-1",children:[M.jsxs("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:["Relays",M.jsx(Xf,{title:"Relays",text:"Events related to this listing will only be published in the specified relays, if no relays are specified events are published to users' preferred relays. Please ensure all members, managers and owners are subscribed to the respective relays, if specified."})]}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"URLs (comma separated)",value:Re.relays,onChange:Pe=>tt({...Re,relays:Pe.target.value})})]})]}),M.jsxs("div",{className:"space-y-2",children:[M.jsxs("div",{className:"space-y-1",children:[M.jsxs("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:["Owners",M.jsx(Xf,{title:"Owners",text:"Owners can edit all listing or spot details and manage access."})]}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys (comma separated)",value:Re.owners,onChange:Pe=>tt({...Re,owners:Pe.target.value})}),it(Re.owners)]}),M.jsxs("div",{className:"space-y-1",children:[M.jsxs("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:["Managers",M.jsx(Xf,{title:"Managers",text:"Managers can edit spot status logs."})]}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys (comma separated)",value:Re.managers,onChange:Pe=>tt({...Re,managers:Pe.target.value})}),it(Re.managers)]})]}),M.jsxs("button",{onClick:()=>Q(2),className:"w-full py-3 bg-[#007AFF] text-white rounded-xl font-bold flex items-center justify-center gap-2",children:["Next ",M.jsx(ip,{size:16})]})]}):M.jsxs("div",{className:"space-y-6",children:[M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("h3",{className:"font-bold dark:text-white",children:"Floors & Spots"}),M.jsxs("select",{className:"pl-3 pr-8 py-2 bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 rounded-xl text-zinc-900 dark:text-white text-sm font-medium appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.75rem_center]",value:Re.currency,onChange:Pe=>tt({...Re,currency:Pe.target.value}),children:[M.jsx("option",{value:"USD",children:"USD ($)"}),M.jsx("option",{value:"EUR",children:"EUR ()"}),M.jsx("option",{value:"GBP",children:"GBP ()"}),M.jsx("option",{value:"INR",children:"INR ()"}),M.jsx("option",{value:"JPY",children:"JPY ()"}),M.jsx("option",{value:"CAD",children:"CAD (C$)"}),M.jsx("option",{value:"AUD",children:"AUD (A$)"}),M.jsx("option",{value:"CNY",children:"CNY ()"}),M.jsx("option",{value:"AED",children:"AED (.)"}),M.jsx("option",{value:"SGD",children:"SGD (S$)"}),M.jsx("option",{value:"CHF",children:"CHF (Fr)"}),M.jsx("option",{value:"HKD",children:"HKD (HK$)"}),M.jsx("option",{value:"SEK",children:"SEK (kr)"}),M.jsx("option",{value:"NOK",children:"NOK (kr)"}),M.jsx("option",{value:"DKK",children:"DKK (kr)"}),M.jsx("option",{value:"NZD",children:"NZD (NZ$)"}),M.jsx("option",{value:"MXN",children:"MXN ($)"}),M.jsx("option",{value:"BRL",children:"BRL (R$)"}),M.jsx("option",{value:"ZAR",children:"ZAR (R)"}),M.jsx("option",{value:"KRW",children:"KRW ()"}),M.jsx("option",{value:"THB",children:"THB ()"}),M.jsx("option",{value:"MYR",children:"MYR (RM)"}),M.jsx("option",{value:"PHP",children:"PHP ()"}),M.jsx("option",{value:"IDR",children:"IDR (Rp)"}),M.jsx("option",{value:"VND",children:"VND ()"}),M.jsx("option",{value:"RUB",children:"RUB ()"}),M.jsx("option",{value:"PLN",children:"PLN (z)"}),M.jsx("option",{value:"TRY",children:"TRY ()"}),M.jsx("option",{value:"SAR",children:"SAR ()"}),M.jsx("option",{value:"EGP",children:"EGP (E)"})]})]}),M.jsx("div",{className:"space-y-3",children:Ye.map((Pe,ct)=>M.jsxs("div",{className:"p-3 bg-zinc-50 dark:bg-white/5 rounded-xl flex justify-between items-center group touch-none",children:[M.jsxs("div",{className:"flex-1 min-w-0 mr-2",onClick:()=>{if(ve){alert("Please save or cancel current floor edit first");return}He(ct),Et(Pe),me(!0)},children:[M.jsx("div",{className:"font-bold dark:text-white truncate",children:Pe.name}),M.jsxs("div",{className:"text-xs text-zinc-500 truncate",children:[Pe.counts.car>0&&` ${Pe.counts.car} `,Pe.counts.motorcycle>0&&` ${Pe.counts.motorcycle} `,Pe.counts.bicycle>0&&` ${Pe.counts.bicycle} `]})]}),M.jsxs("div",{className:"flex items-center gap-1",children:[M.jsx("button",{onClick:()=>{if(ve){alert("Finish current floor first");return}He(ct),Et(Pe),me(!0)},className:"p-2 text-zinc-400 hover:text-blue-500 transition-colors",children:M.jsx(Vd,{size:18})}),M.jsx("button",{onClick:()=>He(ct),style:{WebkitTapHighlightColor:"transparent"},className:"p-2 text-zinc-400",children:M.jsx(rp,{size:18})})]})]},ct))}),ve?M.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl space-y-4",children:[M.jsx("h4",{className:"font-bold text-sm dark:text-white",children:"New Floor Details"}),M.jsxs("div",{className:"space-y-1",children:[M.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Floor Name"}),M.jsx("input",{className:"w-full p-2 bg-white dark:bg-white/5 rounded-lg text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"e.g. B1, Ground",value:Wt.name,onChange:Pe=>Et({...Wt,name:Pe.target.value})})]}),["car","motorcycle","bicycle"].map(Pe=>M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("span",{className:"text-2xl w-8",children:Pe==="car"?"":Pe==="motorcycle"?"":""}),M.jsxs("div",{className:"flex-1",children:[M.jsx("label",{className:"text-[10px] font-bold uppercase text-zinc-400",children:"Spots"}),M.jsx("input",{type:"number",className:"w-full p-1 bg-white dark:bg-white/5 rounded text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"0",value:Wt.counts[Pe]||"",onChange:ct=>Et(vt=>({...vt,counts:{...vt.counts,[Pe]:parseInt(ct.target.value)||0}}))})]}),M.jsxs("div",{className:"flex-1",children:[M.jsx("label",{className:"text-[10px] font-bold uppercase text-zinc-400",children:"Hourly Rate"}),M.jsx("input",{type:"number",className:"w-full p-1 bg-white dark:bg-white/5 rounded text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"0",value:Wt.rates[Pe]||"",onChange:ct=>Et(vt=>({...vt,rates:{...vt.rates,[Pe]:parseFloat(ct.target.value)||0}}))})]})]},Pe)),M.jsxs("div",{className:"flex gap-2",children:[M.jsx("button",{onClick:()=>me(!1),className:"flex-1 py-2 bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 rounded-xl font-bold text-sm",children:"Cancel"}),M.jsx("button",{onClick:()=>{at(),me(!1)},className:"flex-1 py-2 bg-blue-500 text-white rounded-xl font-bold text-sm",children:"Save Floor"})]})]}):M.jsx("button",{onClick:()=>me(!0),className:"w-full py-4 border-2 border-dashed border-zinc-200 dark:border-white/10 rounded-2xl text-zinc-400 font-bold hover:bg-zinc-50 dark:hover:bg-white/5 transition-colors",children:"+ Add Floor"}),M.jsxs("div",{className:"flex gap-2 pt-2",children:[M.jsx("button",{onClick:()=>Q(1),className:"flex-1 py-3 bg-zinc-200 dark:bg-white/10 text-zinc-800 dark:text-white rounded-xl font-bold",children:"Back"}),M.jsx("button",{onClick:xt,className:"flex-1 py-3 bg-[#007AFF] text-white rounded-xl font-bold",children:"Save Listing"})]})]})]})})},q4=({spot:c,listing:d,status:y,onClose:C,isManager:D,listingStats:P,setListingStats:N,setSpotStatuses:h,onSpotUpdate:U,...H})=>{const{pubkey:Y,signEvent:Q,pool:_e}=nh(),we=Y===jh,ve=`${Ln.PARKING_SPOT_LISTING}:${c.pubkey}:${c.d}`,me=d.location?d.location.split(",").map(_t=>parseFloat(_t.trim())):void 0,he=`${Ln.LISTED_PARKING_METADATA}:${d.pubkey}:${d.d}`,Re=JSON.stringify({a:ve,listingATag:he,authorizer:d.owners?.[0]||Y,auth:`static - ${c.d}`,listingName:d.listing_name,floor:c.floor||"",spotNumber:c.spot_number,shortName:c.short_name,listingLocation:me,spotType:c.type||"car",hourlyRate:c.rates?.hourly||d.rates?.[c.type]?.hourly||0,currency:c.rates?.currency||d.rates?.[c.type]?.currency||d.rates?.car?.currency||"INR"}),[tt,Ye]=ge.useState(!1),[pt,Wt]=ge.useState(!1),[Et,it]=ge.useState({short_name:c.short_name||"",type:c.type,rate:c.rates?.hourly||0}),[at,He]=ge.useState([]),[xt,Pe]=ge.useState(new Map),[ct,vt]=ge.useState(!0),[Zt,Ne]=ge.useState(""),[Te,We]=ge.useState(!1),[wt,zt]=ge.useState(!1),Gt=ge.useCallback(async()=>{if(_e){vt(!0);try{const _t=await _e.querySync(ei,{kinds:[Ln.LISTED_SPOT_LOG,Ln.PRIVATE_LOG_NOTE],"#a":[ve],limit:50}),tn=_t.filter(an=>an.kind===Ln.LISTED_SPOT_LOG).sort((an,sn)=>sn.created_at-an.created_at),Bt=_t.filter(an=>an.kind===Ln.PRIVATE_LOG_NOTE),Kt=new Map;Bt.forEach(an=>{const sn=an.tags.find(Nn=>Nn[0]==="e")?.[1];if(sn){const Nn=Kt.get(sn)||[];Nn.push(an),Kt.set(sn,Nn)}}),He(tn),Pe(Kt)}catch(_t){console.error("Failed to fetch spot history:",_t)}finally{vt(!1)}}},[_e,ve]);ge.useEffect(()=>{(D||we)&&Gt()},[Gt,D,we]);const ke=async _t=>{zt(!0);try{const tn=JSON.stringify({status:_t,hourly_rate:c.rates?.hourly||0,currency:c.rates?.currency||"USD",type:c.type||"car",updated_at:Math.floor(Date.now()/1e3)}),Bt=`${Ln.LISTED_PARKING_METADATA}:${d.pubkey}:${d.d}`,Kt=[["a",ve],["a",Bt,"","root"],["status",_t],["updated_by",Y],["client","parlens"]];if(d.location){Kt.push(["location",d.location]);const[Nn,Dn]=d.location.split(",").map(Number),si=Ol(Nn,Dn,10);for(let kn=1;kn<=10;kn++)Kt.push(["g",si.substring(0,kn)])}c.type&&Kt.push(["type",c.type]),Kt.push(["hourly_rate",String(c.rates?.hourly||0)]),Kt.push(["currency",c.rates?.currency||"USD"]),ei.forEach(Nn=>Kt.push(["r",Nn]));const an={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:Kt,content:tn},sn=await Q(an);await Promise.allSettled(_e.publish(ei,sn)),await new Promise(Nn=>setTimeout(Nn,1500)),await Gt(),H.onSpotUpdate&&H.onSpotUpdate()}catch(tn){console.error("Failed to update spot:",tn),alert("Failed to update status")}finally{zt(!1)}},nt=async(_t,tn)=>{const Bt=tn||Zt;if(!Bt.trim())return;const Kt=_t||at[0]?.id;if(!Kt){alert("No activity log found to attach note to.");return}const an={kind:Ln.PRIVATE_LOG_NOTE,created_at:Math.floor(Date.now()/1e3),tags:[["e",Kt],["a",ve],["a",he],["p",Y],["client","parlens"]],content:Bt};try{const sn=await Q(an);await Promise.allSettled(_e.publish(ei,sn)),tn||Ne(""),Pe(Nn=>{const Dn=new Map(Nn),si=Dn.get(Kt)||[];return Dn.set(Kt,[...si,sn]),Dn})}catch{alert("Failed to add note")}},Nt=async()=>{const _t=[["d",c.d],["a",c.a],["spot_number",c.spot_number],["floor",c.floor||""],["type",Et.type],["short_name",Et.short_name],["location",c.location],["g",c.g],["client","parlens"]];Et.rate;const tn={kind:Ln.PARKING_SPOT_LISTING,created_at:Math.floor(Date.now()/1e3),tags:_t,content:Et.short_name||`${d.listing_name} #${c.spot_number} `};await Promise.allSettled(_e.publish(ei,await Q(tn))),Wt(!1)};return pt?M.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 flex items-center justify-center p-4 text-center",onClick:C,children:M.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-4 relative",onClick:_t=>_t.stopPropagation(),children:[M.jsx("button",{onClick:()=>Wt(!1),className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:M.jsx(no,{size:20})}),M.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Edit Spot"}),M.jsxs("div",{className:"space-y-2 text-left",children:[M.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400",children:"Name / Short Code"}),M.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl dark:text-white",value:Et.short_name,onChange:_t=>it({...Et,short_name:_t.target.value}),placeholder:`#${c.spot_number} `}),M.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400",children:"Type"}),M.jsxs("select",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl dark:text-white appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_1rem_center]",style:{WebkitTapHighlightColor:"transparent"},value:Et.type,onChange:_t=>it({...Et,type:_t.target.value}),children:[M.jsx("option",{value:"car",children:" Car"}),M.jsx("option",{value:"motorcycle",children:" Motorcycle"}),M.jsx("option",{value:"bicycle",children:" Bicycle"})]})]}),M.jsxs("div",{className:"flex gap-2",children:[M.jsx("button",{onClick:()=>Wt(!1),className:"flex-1 py-3 bg-zinc-200 dark:bg-white/10 text-zinc-800 dark:text-white rounded-xl font-bold",children:"Cancel"}),M.jsx("button",{onClick:Nt,className:"flex-1 py-3 bg-[#007AFF] text-white rounded-xl font-bold",children:"Save"})]})]})}):M.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 flex items-center justify-center p-4 text-center",onClick:C,children:M.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-4 relative max-h-[85vh] overflow-y-auto min-h-[400px]",onClick:_t=>_t.stopPropagation(),children:[wt&&M.jsxs("div",{className:"fixed inset-0 z-[6000] flex items-center justify-center bg-black/60 backdrop-blur-sm flex-col animate-in fade-in duration-200",children:[M.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-white/20 border-t-white rounded-full"}),M.jsx("div",{className:"text-white font-bold mt-4 animate-pulse",children:"Updating Status..."})]}),Te?M.jsxs("div",{className:"flex flex-col h-full space-y-4 animate-in fade-in slide-in-from-right-4",children:[M.jsxs("div",{className:"flex items-center justify-between",children:[M.jsx("button",{onClick:()=>We(!1),className:"p-2 -ml-2 rounded-full text-zinc-600 dark:text-white hover:bg-black/5 dark:hover:bg-white/10",children:M.jsx(Ex,{size:24})}),M.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Status Log"}),M.jsx("div",{className:"w-10"})," "]}),M.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 min-h-[300px]",children:ct?M.jsx("div",{className:"text-center text-zinc-400 py-8",children:"Loading logs..."}):at.length===0?M.jsxs("div",{className:"text-center text-zinc-400 py-8 flex flex-col items-center gap-2",children:[M.jsx("div",{className:"text-4xl opacity-20",children:""}),M.jsx("p",{children:"No activity yet"})]}):at.map((_t,tn)=>{const Bt=_t.tags?.find(Dn=>Dn[0]==="status")?.[1],Kt=_t.tags?.find(Dn=>Dn[0]==="updated_by")?.[1],an=_t.tags?.find(Dn=>Dn[0]==="authorizer")?.[1],sn=new Date(_t.created_at*1e3),Nn=xt.get(_t.id)||[];return M.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl text-left border border-black/5 dark:border-white/5",children:[M.jsxs("div",{className:"flex items-center justify-between mb-2",children:[M.jsxs("div",{className:`font - bold capitalize flex items - center gap - 2 ${Bt==="open"?"text-green-500":Bt==="occupied"?"text-red-500":"text-zinc-500"} `,children:[M.jsx("div",{className:`w - 2 h - 2 rounded - full ${Bt==="open"?"bg-green-500":Bt==="occupied"?"bg-red-500":"bg-zinc-500"} `}),Bt||"unknown"]}),M.jsxs("div",{className:"text-xs text-zinc-400 font-medium tabular-nums",children:[sn.toLocaleDateString(void 0,{month:"short",day:"numeric"}),"  ",sn.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})]})]}),M.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/40 flex flex-col gap-1",children:[M.jsxs("div",{children:["By: ",Kt?Kt===Y?"You":`${Kt.slice(0,8)}...`:"Unknown"]}),an&&M.jsxs("div",{children:["Auth: ",an.slice(0,8),"..."]})]}),D&&M.jsxs(M.Fragment,{children:[M.jsxs("div",{className:"mt-2 flex gap-2",children:[M.jsx("input",{id:`note-input-${_t.id}`,placeholder:"Add a note",className:"flex-1 p-2.5 bg-white dark:bg-white/10 rounded-xl text-sm text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-zinc-400",onKeyDown:Dn=>{Dn.key==="Enter"&&Dn.target.value.trim()&&(nt(_t.id,Dn.target.value),Dn.target.value="")}}),M.jsx("button",{onClick:()=>{const Dn=document.getElementById(`note-input-${_t.id}`);Dn&&Dn.value.trim()&&(nt(_t.id,Dn.value),Dn.value="")},className:"p-2.5 bg-[#007AFF] text-white rounded-xl",children:M.jsx(o1,{size:20})})]}),Nn.length>0&&M.jsx("div",{className:"mt-3 space-y-2 pt-3 border-t border-black/5 dark:border-white/5",children:Nn.map(Dn=>M.jsx("div",{className:"text-xs bg-yellow-50 dark:bg-yellow-900/10 p-2 rounded-lg text-zinc-700 dark:text-yellow-100/80",children:Dn.content},Dn.id))})]})]},_t.id||tn)})})]}):M.jsxs(M.Fragment,{children:[M.jsx("button",{onClick:C,className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:M.jsx(no,{size:20})}),M.jsx("h2",{className:"text-xl font-bold dark:text-white pr-8 text-left",children:c.short_name||c.content}),D&&M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"p-4 rounded-3xl flex justify-center",children:M.jsx(N1,{value:Re,size:180,level:"M",bgColor:"transparent",fgColor:"currentColor",className:"text-black dark:text-white"})}),M.jsxs("div",{onClick:()=>{navigator.clipboard.writeText(Re),Ye(!0),setTimeout(()=>Ye(!1),2e3)},className:"flex justify-center items-center gap-2 text-[#007AFF] font-bold cursor-pointer py-2 hover:opacity-80 transition-opacity",children:[tt?M.jsx(ep,{size:18}):M.jsx(i2,{size:18})," ",tt?"Copied":"Copy Auth Code"]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-3 text-left",children:[M.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:[M.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Rate"}),M.jsxs("div",{className:"text-lg font-bold dark:text-white tabular-nums",children:[tp(c.rates?.currency||d.rates?.car?.currency||"USD"),c.rates?.hourly||d.rates?.[c.type]?.hourly,"/hr"]})]}),M.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:[M.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Status"}),(()=>{const _t=at.length>0?at[0]:null,tn=_t?.tags.find(an=>an[0]==="status")?.[1];let Bt;if(_t&&y?Bt=_t.created_at>=y.created_at?tn:y.status:Bt=tn||y?.status,!Bt&&ct)return M.jsx("div",{className:"text-lg font-bold text-zinc-400 animate-pulse",children:"..."});const Kt=Bt||"open";return M.jsx("div",{className:`text-lg font-bold capitalize ${Kt==="occupied"?"text-red-500":Kt==="closed"?"text-zinc-500":"text-green-500"}`,children:Kt})})()]})]}),D&&M.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl text-left space-y-2",children:[M.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Latest Note"}),(()=>{let _t=null,tn=0;return xt.forEach(Bt=>{Bt.forEach(Kt=>{Kt.created_at>tn&&(_t=Kt,tn=Kt.created_at)})}),_t?M.jsxs("div",{className:"text-sm dark:text-white italic",children:['"',_t.content,'" ',M.jsxs("span",{className:"text-xs text-zinc-400 not-italic",children:["- ",new Date(_t.created_at*1e3).toLocaleDateString()]})]}):M.jsx("div",{className:"text-sm text-zinc-400 italic",children:"No notes added yet"})})(),M.jsxs("div",{className:"flex gap-2 pt-2",children:[M.jsx("input",{value:Zt,onChange:_t=>Ne(_t.target.value),placeholder:"Add a note",className:"flex-1 p-2.5 bg-white dark:bg-white/10 rounded-xl text-sm text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-zinc-400",onKeyDown:_t=>{_t.key==="Enter"&&nt()}}),M.jsx("button",{onClick:()=>nt(),disabled:!Zt.trim(),className:"p-2.5 bg-[#007AFF] text-white rounded-xl disabled:opacity-50",children:M.jsx(o1,{size:20})})]})]}),(D||we)&&M.jsxs("div",{className:"space-y-4 pt-2",children:[D&&M.jsxs("div",{className:"flex gap-2",children:[M.jsx("button",{onClick:()=>ke("open"),className:"flex-1 py-3 bg-green-500/10 border border-green-500/20 text-green-600 dark:text-green-400 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Open"}),M.jsx("button",{onClick:()=>ke("occupied"),className:"flex-1 py-3 bg-red-500/10 border border-red-500/20 text-red-500 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Occupied"}),M.jsx("button",{onClick:()=>ke("closed"),className:"flex-1 py-3 bg-zinc-500/10 border border-zinc-500/20 text-zinc-500 dark:text-zinc-400 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Closed"})]}),M.jsxs("button",{onClick:()=>We(!0),className:"w-full py-4 bg-blue-500/10 border border-blue-500/20 text-[#007AFF] font-bold rounded-2xl flex items-center justify-center gap-2 active:scale-[0.98] transition-transform",children:["View Status Log ",M.jsx(ip,{size:18})]}),D&&M.jsxs("div",{className:"flex gap-3 pt-2 border-t border-black/5 dark:border-white/5",children:[M.jsxs("button",{onClick:()=>Wt(!0),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 py-3 bg-zinc-100 dark:bg-white/10 border border-zinc-200 dark:border-white/10 text-zinc-600 dark:text-zinc-300 font-bold text-sm flex items-center justify-center gap-2 rounded-xl transition-transform active:scale-95",children:[M.jsx(Vd,{size:16})," Edit"]}),M.jsxs("button",{onClick:async()=>{if(confirm("Delete this spot?"))try{const _t={kind:5,pubkey:Y,created_at:Math.floor(Date.now()/1e3),tags:[["e",c.id]],content:"deleted"};await Promise.allSettled(_e.publish(ei,await Q(_t))),C()}catch{alert("Failed to delete")}},style:{WebkitTapHighlightColor:"transparent"},className:"mt-0 p-3 bg-red-500/10 border border-red-500/20 text-red-500 rounded-xl active:scale-95 transition-transform flex items-center justify-center",children:[M.jsx(rp,{size:20})," ",M.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})]})]})]})})},Z4=({listing:c,onClose:d})=>{const y=(C,D)=>!D||D.length===0?null:M.jsxs("div",{className:"space-y-2",children:[M.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 tracking-wider",children:C}),M.jsx("div",{className:"space-y-1",children:D.map(P=>M.jsxs("div",{className:"flex items-center justify-between p-3 bg-zinc-50 dark:bg-white/5 rounded-xl",children:[M.jsx("div",{className:"flex flex-col overflow-hidden",children:P.startsWith("npub")?M.jsx("div",{className:"text-xs font-mono truncate max-w-[200px] text-zinc-600 dark:text-zinc-300",children:P}):M.jsx("div",{className:"text-xs font-mono truncate max-w-[200px] text-zinc-600 dark:text-zinc-300",children:(()=>{try{return q_(P)}catch{return P}})()})}),M.jsx("button",{onClick:()=>{const N=P.startsWith("npub")?P:(()=>{try{return q_(P)}catch{return P}})();navigator.clipboard.writeText(N),alert("Copied")},className:"p-2 text-blue-500 bg-blue-500/10 rounded-full hover:bg-blue-500/20 active:scale-95 transition-all",children:M.jsx(i2,{size:16})})]},P))})]});return M.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",onClick:d,children:M.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-6 relative border border-black/5 dark:border-white/10 shadow-2xl",onClick:C=>C.stopPropagation(),children:[M.jsxs("div",{className:"flex justify-between items-center",children:[M.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Access List"}),M.jsx("button",{onClick:d,children:M.jsx(no,{className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-white"})})]}),M.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:[y("Owners",c.owners),y("Managers",c.managers),y("Members",c.members),y("Relays",c.relays||[]),!c.owners?.length&&!c.managers?.length&&!c.members?.length&&M.jsx("div",{className:"text-center text-zinc-400 py-8",children:"No access details found"})]})]})})},Z_={light:"https://tiles.openfreemap.org/styles/positron",dark:"https://tiles.openfreemap.org/styles/dark"},Ix=ge.memo(({bgClass:c,borderClass:d,stemClass:y,icon:C,iconClass:D="",size:P=32})=>M.jsxs("div",{className:"flex flex-col items-center pointer-events-auto transition-transform active:scale-95 group",children:[M.jsx("div",{className:`flex items-center justify-center rounded-full border-2 shadow-md ${c} ${d}`,style:{width:P,height:P},children:M.jsx("div",{className:D,children:C})}),M.jsx("div",{className:`w-0.5 h-2 ${y}`})]})),Wm=ge.memo(({isHistory:c=!1,variant:d})=>{const y=d||(c?"history":"default"),C=y==="no-parking",D=y==="area",P=y==="history";let N="bg-[#007AFF]",h="border-white",U="bg-white",H="text-white font-bold text-sm",Y=M.jsx("span",{children:"P"});return C?(N="bg-red-500",h="border-white",U="bg-white",H="text-white",Y=M.jsx(Sx,{size:16})):D?(N="bg-white",h="border-red-500",U="bg-red-500",H="text-black font-bold text-sm",Y=M.jsx("span",{children:"P"})):P&&(N="bg-white",h="border-zinc-500",U="bg-zinc-500",H="text-zinc-500 font-bold text-sm",Y=M.jsx("span",{children:"P"})),M.jsx(Ix,{bgClass:N,borderClass:h,stemClass:U,icon:Y,iconClass:H})}),Fy=ge.memo(({bearing:c,mapBearing:d,isNavigationMode:y})=>{const C=c-d,D=ge.useRef(0),P=ge.useRef(0),N=C-P.current;Math.abs(N)>180&&(N>0?D.current-=360:D.current+=360),P.current=C;const h=C+D.current;return M.jsx("div",{style:{transform:`rotate(${h}deg) scale(1)`,transition:"transform 0.2s ease-out",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:M.jsx("div",{style:{width:28,height:28,background:"#007AFF",border:"3px solid white",borderRadius:"50%",boxShadow:`0 0 0 ${y?3:2}px rgba(0,122,255,${y?.5:.4}), 0 4px 12px rgba(0,0,0,0.4)`,display:"flex",alignItems:"center",justifyContent:"center"},children:M.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",style:{transform:"translateY(-1px)"},children:M.jsx("path",{d:"M7 0L14 14L7 12L0 14L7 0Z",fill:"white"})})})})});Fy.displayName="UserLocationMarker";const Ng=ge.memo(({type:c})=>{const d=c==="area",y=c==="history",C=c==="no-parking";let D="bg-[#007AFF]",P="border-white",N="bg-white",h="text-white font-bold text-sm",U=M.jsx("span",{children:"P"});return C?(D="bg-red-500",P="border-white",N="bg-white",h="text-white",U=M.jsx(Sx,{size:16})):d?(D="bg-white",P="border-red-500",N="bg-red-500",h="text-black font-bold text-sm",U=M.jsx("span",{children:"P"})):y&&(D="bg-white",P="border-zinc-500",N="bg-zinc-500",h="text-zinc-500 font-bold text-sm",U=M.jsx("span",{children:"P"})),M.jsx(Ix,{bgClass:D,borderClass:P,stemClass:N,icon:U,iconClass:h})});Ng.displayName="ClusterMarkerContent";const N2=ge.memo(({type:c,items:d,onClose:y,isPinned:C,onTogglePin:D,onCreateRoute:P,onFlagNoParking:N,isFlaggedByUser:h,noParkingFlagCount:U,isFlagging:H})=>{const Y="bg-white dark:bg-zinc-800 rounded-xl shadow-xl border border-black/10 dark:border-white/10 p-3 w-[240px] animate-in zoom-in-95 fade-in duration-150 pointer-events-auto relative",Q=()=>M.jsx("button",{onClick:y,className:"absolute top-2 right-2 p-1 text-zinc-400 active:text-zinc-600 dark:active:text-zinc-300 z-10 bg-white/50 dark:bg-black/20 rounded-full",children:M.jsx(no,{size:14})});if(c==="history"){const _e=d.reduce((we,ve)=>we+(ve.timesParked||1),0);return M.jsxs("div",{className:Y,onClick:we=>we.stopPropagation(),children:[M.jsx(Q,{}),M.jsx("div",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-2",children:"Parking History"}),M.jsxs("div",{className:"space-y-1.5 text-xs",children:[M.jsxs("div",{className:"flex justify-between gap-4",children:[M.jsx("span",{className:"text-zinc-500",children:"Times Parked:"}),M.jsx("span",{className:"font-semibold text-zinc-900 dark:text-white",children:_e})]}),(()=>{const we=d.map(Ye=>{const pt=Number(Ye.hourly_rate??Ye.price??Ye.properties?.hourly_rate??NaN);return isNaN(pt)?void 0:pt}).filter(Ye=>Ye!==void 0);if(we.length===0)return null;const ve=Math.min(...we),me=Math.max(...we),he=d[0]?.currency||d[0]?.properties?.currency||"USD",Re=tp(he),tt=ve===me?`${Re}${ve}`:`${Re}${ve}-${me}`;return M.jsxs("div",{className:"flex justify-between gap-4",children:[M.jsx("span",{className:"text-zinc-500",children:"Fees Reported:"}),M.jsxs("span",{className:"font-semibold text-zinc-900 dark:text-white",children:[tt,"/hr"]})]})})()]}),P&&M.jsx("button",{onClick:P,className:"mt-3 w-full py-1.5 rounded-lg text-xs font-medium bg-blue-500/10 text-blue-600 active:bg-blue-500/20 transition-colors",children:"Create Route"})]})}if(c==="area"){const _e=d.length,we=d.map(tt=>tt.original?.created_at||tt.created_at).filter(Boolean),ve=we.length>0?Math.min(...we):null,me=d.map(tt=>{const Ye=Number(tt.hourly_rate??tt.price??tt.properties?.hourly_rate??NaN);return isNaN(Ye)?void 0:Ye}).filter(tt=>tt!==void 0);let he=null;if(me.length>0){const tt=Math.min(...me),Ye=Math.max(...me),pt=d[0]?.currency||d[0]?.properties?.currency||"USD",Wt=tp(pt);he=tt===Ye?`${Wt}${tt}`:`${Wt}${tt}-${Ye}`}const Re=()=>{if(!ve)return null;const tt=Math.floor(Date.now()/1e3),Ye=Math.floor((tt-ve)/86400);return Ye===0?"1 day":`${Ye+1} days`};return M.jsxs("div",{className:Y,onClick:tt=>tt.stopPropagation(),children:[M.jsx(Q,{}),M.jsx("div",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-2",children:"Parking Area"}),M.jsxs("div",{className:"space-y-1.5 text-xs",children:[M.jsxs("div",{className:"flex justify-between gap-4",children:[M.jsx("span",{className:"text-zinc-500",children:"Reports:"}),M.jsx("span",{className:"font-semibold text-zinc-900 dark:text-white",children:_e})]}),he&&M.jsxs("div",{className:"flex justify-between gap-4",children:[M.jsx("span",{className:"text-zinc-500",children:"Fees Reported:"}),M.jsxs("span",{className:"font-semibold text-zinc-900 dark:text-white",children:[he,"/hr"]})]}),Re()&&M.jsxs("div",{className:"flex justify-between gap-4",children:[M.jsx("span",{className:"text-zinc-500",children:"Reported over:"}),M.jsx("span",{className:"font-semibold text-zinc-900 dark:text-white",children:Re()})]}),U!==void 0&&M.jsxs("div",{className:"flex justify-between gap-4",children:[M.jsx("span",{className:"text-zinc-500",children:"Flagged No Parking:"}),M.jsx("span",{className:`font-semibold ${U>0?"text-red-600":"text-zinc-400"}`,children:U})]})]}),N&&M.jsxs("button",{onClick:N,disabled:H,className:`mt-3 w-full py-1.5 rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-2 ${h?"bg-zinc-500/10 text-zinc-600 active:bg-zinc-500/20 dark:text-zinc-400":"bg-red-500/10 text-red-600 active:bg-red-500/20"} ${H?"opacity-50 cursor-not-allowed":""}`,style:{touchAction:"manipulation"},children:[H&&M.jsxs("svg",{className:"animate-spin h-3 w-3",viewBox:"0 0 24 24",children:[M.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),M.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),H?"Updating...":h?"Remove No Parking Flag":"Flag No Parking"]}),D&&M.jsx("button",{onClick:D,className:`mt-2 w-full py-1.5 rounded-lg text-xs font-medium transition-colors ${C?"bg-zinc-500/10 text-zinc-600 active:bg-zinc-500/20 dark:text-zinc-400":"bg-amber-500/10 text-amber-600 active:bg-amber-500/20"}`,style:{touchAction:"manipulation"},children:C?"Remove from Map":"Keep on Map"}),P&&M.jsx("button",{onClick:P,className:"mt-2 w-full py-1.5 rounded-lg text-xs font-medium bg-blue-500/10 text-blue-600 active:bg-blue-500/20 transition-colors",style:{touchAction:"manipulation"},children:"Create Route"})]})}return M.jsxs("div",{className:Y,onClick:_e=>_e.stopPropagation(),children:[M.jsx(Q,{}),M.jsx("div",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-2",children:"Listed Parking"}),M.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:d.map((_e,we)=>M.jsxs("div",{className:`flex items-center justify-between gap-2 ${we>0?"pt-2 border-t border-black/5 dark:border-white/10":""}`,children:[M.jsx("div",{className:"font-semibold text-xs text-zinc-900 dark:text-white truncate flex-1",children:_e.listing_name||_e.original?.listing_name||"Parking Spot"}),M.jsxs("div",{className:"text-xs text-zinc-500 whitespace-nowrap",children:[tp(_e.currency),Math.round(_e.price),"/hr"]}),M.jsxs("div",{className:"text-xs text-green-600 font-medium whitespace-nowrap",children:[_e.openSpots||_e.original?.openSpots||_e.count||1," open"]})]},we))}),D&&M.jsx("button",{onClick:D,className:`mt-3 w-full py-1.5 rounded-lg text-xs font-medium transition-colors ${C?"bg-zinc-500/10 text-zinc-600 active:bg-zinc-500/20 dark:text-zinc-400":"bg-amber-500/10 text-amber-600 active:bg-amber-500/20"}`,children:C?"Remove from Map":"Keep on Map"}),P&&M.jsx("button",{onClick:P,className:"mt-2 w-full py-1.5 rounded-lg text-xs font-medium bg-blue-500/10 text-blue-600 active:bg-blue-500/20 transition-colors",children:"Create Route"})]})});N2.displayName="MarkerPopup";const D2=ge.memo(({})=>M.jsx(Ix,{bgClass:"bg-[#34C759]",borderClass:"border-white",stemClass:"bg-white",icon:M.jsx("span",{children:"P"}),iconClass:"text-white font-bold text-sm"}));D2.displayName="ActiveSessionMarkerContent";const R2=ge.memo(({vehicleType:c,onVehicleChange:d,disabled:y})=>{const[C,D]=ge.useState(!1),P=["bicycle","motorcycle","car"],N={bicycle:"",motorcycle:"",car:""};return M.jsx("div",{className:"flex flex-col rounded-[2rem] bg-white/80 dark:bg-white/10 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg overflow-hidden transition-all duration-300 pointer-events-auto",children:C?M.jsxs("div",{className:"flex flex-col gap-1 p-1",children:[P.map(h=>M.jsx("button",{onClick:()=>{y?y&&alert("Please end your current session before changing vehicle type."):(d(h),D(!1))},className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${c===h?"bg-blue-500/20 shadow-inner":"transition-colors"}`,children:M.jsx("span",{className:`text-lg ${c===h?"":"opacity-50"}`,children:N[h]})},h)),M.jsx("button",{onClick:()=>D(!1),className:"w-10 h-6 flex items-center justify-center text-zinc-400 dark:text-white/40 transition-colors",children:M.jsx(M1,{size:16})})]}):M.jsxs("button",{onClick:()=>D(!0),className:"flex flex-col items-center p-1 transition-all",children:[M.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-500/20",children:M.jsx("span",{className:"text-lg",children:N[c]})}),M.jsx(Fd,{size:14,className:"text-zinc-400 dark:text-white/40 mt-0.5"})]})})});R2.displayName="VehicleToggle";const X4=({onRequestScan:c,initialScannedCode:d,onScannedCodeConsumed:y})=>{const{pubkey:C,signEvent:D,pool:P}=nh(),N=ge.useRef(null),[h,U]=ge.useState(()=>{const Ee=localStorage.getItem("parlens_last_location");return Ee?JSON.parse(Ee):null}),H=ge.useRef(new N4),Y=ge.useRef(new D4),Q=ge.useRef(new R4),[_e,we]=ge.useState(null),[ve,me]=ge.useState(()=>{if(localStorage.getItem("parlens_listed_parking_session"))return"parked";const Ee=localStorage.getItem("parlens_session");if(Ee)try{const qe=JSON.parse(Ee);if(qe.status==="parked"||qe.status==="search")return qe.status}catch{}return"idle"}),[he,Re]=ge.useState("fixed"),[tt,Ye]=ge.useState(!1),[pt,Wt]=ge.useState(!1),[Et,it]=ge.useState(!1),[at,He]=ge.useState(!1),[xt,Pe]=ge.useState(()=>{const Ee=localStorage.getItem("parlens_vehicle_type");return Ee==="bicycle"||Ee==="motorcycle"||Ee==="car"?Ee:"car"}),[ct,vt]=ge.useState([]),[Zt,Ne]=ge.useState([]),[Te,We]=ge.useState(new Set),wt=ge.useMemo(()=>{const qe=[...ct.filter(Xe=>!Te.has(Xe.id))];return Zt.forEach(Xe=>{qe.find(et=>et.id===Xe.id)||qe.push(Xe)}),qe},[ct,Zt,Te]),[zt,Gt]=ge.useState([]),[ke,nt]=ge.useState(()=>{const Ee=localStorage.getItem("parlens_listed_parking_session");if(Ee)try{const Xe=JSON.parse(Ee);if(Xe.listingLocation)return Xe.listingLocation}catch{}const qe=localStorage.getItem("parlens_session");if(qe)try{const Xe=JSON.parse(qe);if(Xe.parkLocation)return Xe.parkLocation}catch{}return null}),[Nt,_t]=ge.useState(()=>{const Ee=localStorage.getItem("parlens_listed_parking_session");return Ee?JSON.parse(Ee):null}),[tn,Bt]=ge.useState(null),[Kt,an]=ge.useState(!1),[sn,Nn]=ge.useState(null),[Dn,si]=ge.useState(()=>new Map),[kn,ui]=ge.useState(()=>new Map),[_i,Di]=ge.useState(!1);ge.useEffect(()=>{if(!P||!C)return;(async()=>{try{const qe=await P.querySync(ei,{kinds:[Ln.LABEL],authors:[C],"#L":["parlens"]}),Xe=new Map;for(const et of qe){if(!et.tags.some(Xn=>Xn[0]==="l"&&Xn[1]==="no-parking"&&Xn[2]==="parlens"))continue;const Mn=et.tags.find(Xn=>Xn[0]==="g")?.[1];if(Mn){const Xn=Xe.get(Mn),Ui=qe.find(It=>It.id===Xn);(!Xn||et.created_at>(Ui?.created_at||0))&&Xe.set(Mn,et.id)}}Xe.size>0&&(si(Xe),console.log("[Parlens] Loaded",Xe.size,"user no-parking flags from relays"))}catch(qe){console.error("[Parlens] Failed to fetch user no-parking flags:",qe)}})()},[P,C]),ge.useEffect(()=>{if(ct.length===0&&kn.size===0)return;const Ee=new Map;let qe=!1;ct.forEach(Xe=>{if(Xe.kind===Ln.LABEL&&Xe.tags?.some(bt=>bt[0]==="l"&&bt[1]==="no-parking"&&bt[2]==="parlens")){const bt=Xe.tags.find(Mn=>Mn[0]==="g")?.[1];bt&&(Ee.set(bt,(Ee.get(bt)||0)+1),qe=!0)}if(Xe.kind===Ln.PARKING_AREA_INDICATOR&&Xe.tags?.some(bt=>bt[0]==="no-parking-flag"&&bt[1]==="true")){const bt=Xe.tags.find(Mn=>Mn[0]==="g")?.[1];bt&&(Ee.set(bt,(Ee.get(bt)||0)+1),qe=!0)}}),(qe||kn.size>0)&&(ui(Ee),qe&&console.log("[Parlens] Aggregated no-parking flags from",Ee.size,"areas (source: relay)"))},[ct]),ge.useEffect(()=>{d&&(console.log("[LandingPage] Processing scanned code from QRScanPage:",d),Ze(d),y?.())},[d,y]);const[qn,Gn]=ge.useState(!1),[In,vi]=ge.useState(!1),[nn,Li]=ge.useState(""),[Ki,Pi]=ge.useState([]),[xr,gt]=ge.useState(!1),[oe,ce]=ge.useState(null),[pe,je]=ge.useState(!1);ge.useEffect(()=>{oe&&je(!0)},[oe]),ge.useEffect(()=>{(ve==="idle"||ve==="parked")&&(ce(null),je(!1))},[ve]);const[Je]=ge.useState(()=>{try{const Ee=localStorage.getItem("parlens_route_cache_v1");return Ee?JSON.parse(Ee):[]}catch{return[]}}),St=ge.useMemo(()=>{if(!nn||nn.length<2)return[];const Ee=nn.toLowerCase(),qe=[];for(const Xe of Je){const et=Xe.decryptedContent?.waypoints||[];for(const bt of et)bt.name&&bt.name.toLowerCase().includes(Ee)&&(qe.find(Mn=>Mn.name.toLowerCase()===bt.name.toLowerCase())||qe.push({name:bt.name,lat:bt.lat,lon:bt.lon}))}return qe.slice(0,3)},[nn,Je]),[rt,de]=ge.useState(()=>{try{const Ee=localStorage.getItem("parlens_pinned_markers");return Ee?JSON.parse(Ee):[]}catch{return[]}}),Ze=ge.useCallback(async Ee=>{He(!0),console.log("[Parlens] Processing scanned code:",Ee);try{const{generateSecretKey:qe,finalizeEvent:Xe,getPublicKey:et}=await e1(async()=>{const{generateSecretKey:is,finalizeEvent:Co,getPublicKey:Zo}=await Promise.resolve().then(()=>zy);return{generateSecretKey:is,finalizeEvent:Co,getPublicKey:Zo}},void 0);let bt;try{bt=JSON.parse(Ee)}catch{bt={a:Ee,authorizer:"",auth:""}}if(!bt.a){alert("Invalid QR code format");return}if(C&&bt.authorizer&&bt.authorizer===C){alert("Owners and managers cannot use QR authentication to park at their own listing. Please use the spot card to update status directly.");return}const Mn="parlens_listed_parking_session",Xn=localStorage.getItem(Mn);let Ui=!1;Xn&&JSON.parse(Xn).spotATag===bt.a&&(Ui=!0);const It=qe(),hi=et(It);if(Ui){const is=JSON.parse(Xn);li({authData:bt,session:is,tempPrivkey:It,tempPubkey:hi}),Zn(!0);return}const Hi="occupied",ya=bt.a.split(":"),qo=(ya[2]||"").replace(/-spot-\d+$/,""),Rs=`${Ln.LISTED_PARKING_METADATA}:${ya[1]}:${qo}`,Cs=[["a",bt.a],["a",Rs,"","root"],["status",Hi],["updated_by",hi],["authorizer",bt.authorizer||C||""],...bt.auth?[["auth",bt.auth]]:[],["client","parlens"]],rr=bt.listingLocation||null;if(rr){Cs.push(["location",`${rr[0]},${rr[1]}`]);try{const is=Zf.encode(rr[0],rr[1],5);Cs.push(["g",is])}catch{}}bt.spotType&&Cs.push(["type",bt.spotType]),bt.hourlyRate!==void 0&&(Cs.push(["hourly_rate",String(bt.hourlyRate)]),Cs.push(["currency",bt.currency||"USD"]));const wr={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:Cs,content:JSON.stringify({hourly_rate:bt.hourlyRate||0,currency:bt.currency||"USD",type:bt.spotType||"car"})},Ra=Xe(wr,It);await Promise.allSettled(P.publish(ei,Ra)),console.log("[Parlens] Status update published:",Ra.id);const pr=Math.floor(Date.now()/1e3),br=`session_${Date.now()}`,Pa=bt.listingLocation||h,Wi={spotATag:bt.a,listingATag:bt.listingATag||"",location:bt.listingName||"",statusLogEventId:Ra.id,listingName:bt.listingName||"",floor:bt.floor||"",spotNumber:bt.spotNumber||"",shortName:bt.shortName||"",tempPubkey:hi,started_at:pr,type:bt.spotType||"car"},wi=localStorage.getItem("parlens_privkey"),ih=wi?new Uint8Array(wi.match(/.{1,2}/g).map(is=>parseInt(is,16))):void 0,gr=await Bg(Wi,C,ih),Ua={kind:Ln.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",br],["status","parked"],["client","parlens"]],content:gr},Sa=await D(Ua);await Promise.allSettled(P.publish(ei,Sa));const dc={spotATag:bt.a,dTag:br,startTime:pr,listingATag:bt.listingATag||"",authorizer:bt.authorizer,tempPubkey:hi,listingName:bt.listingName||"",floor:bt.floor||"",spotNumber:bt.spotNumber||"",shortName:bt.shortName||"",listingLocation:Pa||void 0,spotType:bt.spotType||"car",hourlyRate:bt.hourlyRate||0,currency:bt.currency||"USD"};localStorage.setItem(Mn,JSON.stringify(dc)),_t(dc),Hr(),me("parked"),nt(Pa||null),ni(pr),console.log("[Parlens] Listed parking started:",Sa.id)}catch(qe){console.error("Failed to process QR code:",qe),alert("Failed to process parking. Please try again.")}finally{He(!1)}},[C,D,P,h,me]),yt=async()=>{if(!jn)return;const{authData:Ee,session:qe,tempPrivkey:Xe,tempPubkey:et}=jn;try{const{finalizeEvent:bt}=await e1(async()=>{const{finalizeEvent:Wi}=await Promise.resolve().then(()=>zy);return{finalizeEvent:Wi}},void 0),Mn=Ee.a.split(":"),Ui=(Mn[2]||"").replace(/-spot-\d+$/,""),It=`${Ln.LISTED_PARKING_METADATA}:${Mn[1]}:${Ui}`,hi=[["a",Ee.a],["a",It,"","root"],["status","open"],["updated_by",et],["authorizer",Ee.authorizer||C||""],...Ee.auth?[["auth",Ee.auth]]:[],["client","parlens"]],Hi=Ee.listingLocation||qe.listingLocation;if(Hi){hi.push(["location",`${Hi[0]},${Hi[1]}`]);try{const Wi=Zf.encode(Hi[0],Hi[1],5);hi.push(["g",Wi])}catch{}}const ya=Ee.spotType||qe.spotType||"car",hc=Ee.hourlyRate??qe.hourlyRate??0,qo=Ee.currency||qe.currency||"USD";hi.push(["type",ya]),hi.push(["hourly_rate",String(hc)]),hi.push(["currency",qo]);const Rs={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:hi,content:JSON.stringify({hourly_rate:hc,currency:qo,type:ya})},Cs=bt(Rs,Xe);await Promise.allSettled(P.publish(ei,Cs));const rr={spotATag:Ee.a,listingATag:qe.listingATag||"",location:qe.listingName||"",statusLogEventId:Cs.id,listingName:qe.listingName||"",floor:qe.floor||"",spotNumber:qe.spotNumber||"",shortName:qe.shortName||"",started_at:qe.startTime||Math.floor(Date.now()/1e3),finished_at:Math.floor(Date.now()/1e3),fee:En,note:ii,currency:qo,type:qe.spotType||"car"},wr=localStorage.getItem("parlens_privkey"),Ra=wr?new Uint8Array(wr.match(/.{1,2}/g).map(Wi=>parseInt(Wi,16))):void 0,pr=await Bg(rr,C,Ra),br={kind:Ln.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",qe.dTag||`session_${Date.now()}`],["status","idle"],["client","parlens"]],content:pr},Pa=await D(br);await Promise.allSettled(P.publish(ei,Pa)),window.dispatchEvent(new Event("parking-log-updated")),localStorage.removeItem("parlens_listed_parking_session"),_t(null),me("idle"),nt(null),ni(null),Zn(!1),li(null),Ri("0"),console.log("[Parlens] Listed parking ended")}catch(bt){console.error("Failed to end listed session:",bt),alert("Failed to end session. Please try again.")}},[Oe,At]=ge.useState(!1),[jt,_n]=ge.useState(17),[mn,ti]=ge.useState(null),[ut,ai]=ge.useState(null),[Qn,Kn]=ge.useState(null),[Jn,lr]=ge.useState(!1),[Mi,ni]=ge.useState(()=>{const Ee=localStorage.getItem("parlens_listed_parking_session");if(Ee)try{const Xe=JSON.parse(Ee);if(Xe.startTime)return Xe.startTime}catch{}const qe=localStorage.getItem("parlens_session");if(qe)try{const Xe=JSON.parse(qe);if(Xe.sessionStart)return Xe.sessionStart}catch{}return null}),[zi,Ei]=ge.useState(!1),[Bi,Cr]=ge.useState(()=>h?{longitude:h[1],latitude:h[0],zoom:17,bearing:0,pitch:0}:{longitude:77.5946,latitude:12.9716,zoom:17,bearing:0,pitch:0}),Jt=ge.useRef(!1),gi=ge.useRef(!1),An=window.matchMedia("(prefers-color-scheme: dark)").matches,[ar,Zi]=ge.useState(!1),[ln,Ue]=ge.useState([]),[mt,$t]=ge.useState(null),[gn,un]=ge.useState(null),[fn,Rn]=ge.useState(null),[Hn,Fn]=ge.useState(""),[,ki]=ge.useState(!1),[xi,bi]=ge.useState([]),[Ct,Zn]=ge.useState(!1),[En,Ri]=ge.useState("0"),[ii,$n]=ge.useState(""),[jn,li]=ge.useState(null),[us,Xr]=ge.useState(!1),[ci,Un]=ge.useState(null),[Tr,Ss]=ge.useState(null);ge.useEffect(()=>{const qe=setTimeout(async()=>{if(!(!h||Tr))try{const et=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${h[0]}&lon=${h[1]}&format=json`)).json();et&&et.address&&et.address.country_code&&(console.log("[Parlens] Detected Country:",et.address.country_code),Ss(et.address.country_code.toUpperCase()))}catch(Xe){console.error("[Parlens] Failed to detect country:",Xe)}},2e3);return()=>clearTimeout(qe)},[h,Tr]);const Ji=ge.useCallback((Ee,qe,Xe)=>{(qe==="open"||qe==="closed")&&(console.log("[Parlens] Remote cancellation detected:",qe),alert("The listing owner has updated the spot status. Your session continues as a regular parking session."),Mi&&ke&&localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:Mi,parkLocation:ke})),localStorage.removeItem("parlens_listed_parking_session"),_t(null),me("parked"),Zn(!1),li(null))},[me,Mi,ke]),Lr=ge.useCallback(()=>{const Ee=Bi;if(xr){const et=Ee.latitude,bt=Ee.longitude;ce({lat:et,lon:bt,name:`${et.toFixed(4)}, ${bt.toFixed(4)}`}),N.current&&(gi.current=!0,N.current.flyTo({center:[bt,et],zoom:16,duration:1200,essential:!0}),setTimeout(()=>{gi.current=!1,me("search")},1300)),gt(!1),Zi(!1);return}const qe=xi.length+ln.length+1,Xe={id:crypto.randomUUID(),lat:Ee.latitude,lon:Ee.longitude,name:`Waypoint ${qe}`};Ue(et=>[...et,Xe])},[Bi,xi.length,ln.length,xr]),hs=(Ee,qe)=>{Ue(Xe=>Xe.map(et=>et.id===Ee?{...et,name:qe}:et))},Ho=Ee=>{Ue(qe=>qe.filter(et=>et.id!==Ee).map((et,bt)=>et.name.startsWith("Waypoint ")?{...et,name:`Waypoint ${bt+1}`}:et)),gn===Ee&&un(null)},Fi=ge.useCallback(Ee=>{Li(Ee)},[]);ge.useEffect(()=>{if(!nn||nn.length<2){Pi([]);return}const Ee=setTimeout(async()=>{try{const qe=await Rg(nn,Tr,h,1);Pi(qe)}catch(qe){console.error("[Parlens] Parking search error:",qe),Pi([])}},300);return()=>clearTimeout(Ee)},[nn,Tr,h]);const $r=ge.useCallback(Ee=>{vi(!1),Li(""),Pi([]);const qe=parseFloat(Ee.lat),Xe=parseFloat(Ee.lon),et=Ee.display_name||`${qe.toFixed(4)}, ${Xe.toFixed(4)}`;N.current&&!isNaN(qe)&&!isNaN(Xe)&&(ce({lat:qe,lon:Xe,name:et}),gi.current=!0,N.current.flyTo({center:[Xe,qe],zoom:16,duration:1200,essential:!0}),setTimeout(()=>{gi.current=!1,Hr(),me("search")},1300))},[]),Rt=ge.useCallback(()=>{if(xr){Zi(!1),gt(!1),vi(!0);return}const Ee=ln.map(qe=>({lat:qe.lat,lon:qe.lon,name:qe.name}));$t(Ee),Ue([]),Zi(!1),Gn(!0)},[ln,xr]),[De,oi]=ge.useState(!1),[ds,Ns]=ge.useState(0),[Da,uc]=ge.useState(0),{requestLock:Hr,releaseLock:mi}=F4(),fr=ge.useRef(new P4),[Ao,cl]=ge.useState(0),Si=ge.useRef(!1),Xs=ge.useRef(0),Ll=ge.useRef(0);ge.useEffect(()=>{if(ve==="parked"){Re("fixed");const Ee=N.current?.getBearing()||0,qe=Math.round(Ee/360)*360;N.current?.rotateTo(qe,{duration:800})}},[ve]),ge.useEffect(()=>(Hr(),()=>{mi()}),[Hr,mi]),ge.useEffect(()=>{if(!navigator.geolocation){we("Geolocation is not supported by your browser");return}navigator.geolocation.getCurrentPosition(qe=>{const{latitude:Xe,longitude:et}=qe.coords;Si.current||(fr.current.updateLocationWithAccuracy(Xe,et,qe.coords.accuracy),U([Xe,et]),Cr(bt=>({...bt,latitude:Xe,longitude:et})),Si.current=!0)},qe=>console.warn("[Parlens] Initial location check failed:",qe),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0});const Ee=navigator.geolocation.watchPosition(qe=>{const{latitude:Xe,longitude:et,accuracy:bt}=qe.coords,Mn=fr.current.updateLocationWithAccuracy(Xe,et,bt);cl(Mn.speed),Xs.current=Mn.speed,localStorage.setItem("parlens_last_location",JSON.stringify([Xe,et])),Mn.speedClass==="stationary"?Mn.shouldUpdate&&Q.current.animateTo(Mn.displayLat,Mn.displayLon,Mn.animationDuration):Q.current.animateTo(Xe,et,300),Si.current||(Si.current=!0,U([Mn.displayLat,Mn.displayLon]),Cr(Xn=>({...Xn,latitude:Mn.displayLat,longitude:Mn.displayLon})))},qe=>{let Xe="Unable to get your location";qe.code===1?Xe="Location access denied. Please enable location services.":qe.code===2?Xe="Location unavailable. Check your GPS settings.":qe.code===3&&(Xe="Location request timed out."),we(Xe)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return Q.current.setUpdateCallback((qe,Xe)=>{U([qe,Xe]),Re(et=>{if((et==="auto"||et==="recentre")&&!Jt.current){if(Xs.current<.3&&et!=="recentre")return et;Cr(bt=>{const Mn=N.current?.getZoom()??bt.zoom,Xn=.1,Ui=bt.latitude+(qe-bt.latitude)*Xn,It=bt.longitude+(Xe-bt.longitude)*Xn;return{...bt,latitude:Ui,longitude:It,zoom:Mn}})}return et})}),()=>{navigator.geolocation.clearWatch(Ee),Q.current.stop()}},[]),ge.useEffect(()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&oi(!0);const Ee=qe=>{if(Jt.current)return;let Xe=null;if(qe.webkitCompassHeading?Xe=qe.webkitCompassHeading:qe.alpha!==null&&(Xe=360-qe.alpha),Xe!==null){const et=window.screen.orientation?.angle??window.orientation??0;Xe=(Xe+et)%360}if(Xe!==null){Ll.current=Xe,uc(bt=>{let Xn=Xe-bt;return Xn>180&&(Xn-=360),Xn<-180&&(Xn+=360),Math.abs(Xn)<2?bt:bt+Xn*.1});const et=H.current.smoothBearing(Xe,0,!0);if(et!==null){const bt=Y.current.setBearing(et);Ns(bt)}}};return window.addEventListener("deviceorientation",Ee,!0),()=>{window.removeEventListener("deviceorientation",Ee,!0)}},[]);const ul=async()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&await DeviceOrientationEvent.requestPermission()==="granted"&&oi(!1)};ge.useEffect(()=>{!Jt.current&&!gi.current&&h&&(he==="auto"||he==="recentre")&&Cr(Ee=>{const qe=N.current?.getZoom()??Ee.zoom,Xe={...Ee,longitude:h[1],latitude:h[0],zoom:qe,pitch:0};if(ar)return Ee;if(he==="auto"){Xe.bearing=ds;const et=qe>=17?300:qe>=15?200:150;Xe.transitionDuration=et}else if(he==="recentre"){const et=qe>=17?400:qe>=15?300:200;Xe.transitionDuration=et}return Xe})},[h,ds,he,Jn,ar]),ge.useEffect(()=>(Hr(),()=>{mi()}),[Hr,mi]),ge.useEffect(()=>{const Ee=localStorage.getItem("parlens_listed_parking_session");if(Ee)try{const Xe=JSON.parse(Ee);if(console.log("[Parlens] Restoring listed session:",Xe),Xe.startTime){ni(Xe.startTime),Xe.listingLocation&&nt(Xe.listingLocation),me("parked");return}}catch(Xe){console.warn("[Parlens] Failed to restore listed session:",Xe)}const qe=localStorage.getItem("parlens_session");if(qe)try{const Xe=JSON.parse(qe);Xe.status==="parked"&&Xe.parkLocation&&Xe.sessionStart?(console.log("[Parlens] Restoring parked session:",Xe),ni(Xe.sessionStart),nt(Xe.parkLocation),Hr(),me("parked")):Xe.status==="search"&&(console.log("[Parlens] Restoring search session"),me("search"))}catch(Xe){console.warn("[Parlens] Failed to restore session:",Xe),localStorage.removeItem("parlens_session")}},[]),ge.useEffect(()=>{ve==="parked"&&Mi&&ke?localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:Mi,parkLocation:ke})):ve==="search"?localStorage.setItem("parlens_session",JSON.stringify({status:"search"})):ve==="idle"&&(localStorage.removeItem("parlens_session"),ni(null))},[ve,Mi,ke]),ge.useEffect(()=>{Bt(ve==="search"?[Bi.latitude,Bi.longitude]:null)},[ve]),ge.useEffect(()=>{if(!h){At(!1);return}const[Ee,qe]=h,Xe=Math.sqrt(Math.pow(Bi.latitude-Ee,2)+Math.pow(Bi.longitude-qe,2));At(Xe>5e-4)},[h,Bi.latitude,Bi.longitude]);const Xi=ge.useCallback(Ee=>{Cr(Ee.viewState);let qe=!1;if(N.current&&(yn.current&&(qe=!0),N.current.isZooming()&&(qe=!0),Ee&&Ee.originalEvent&&Ee.originalEvent.touches&&Ee.originalEvent.touches.length>1&&(qe=!0)),Jt.current&&(he==="auto"||he==="recentre")&&!qe){let Xe=1;h&&(Xe=Math.sqrt(Math.pow(Ee.viewState.longitude-h[1],2)+Math.pow(Ee.viewState.latitude-h[0],2))),Xe>1e-4&&Re("fixed")}},[h,he,Oe]),Br=ge.useCallback(Ee=>{Ee.originalEvent&&(Jt.current=!0,Q.current.stop(),gi.current&&(N.current?.stop(),gi.current=!1))},[]),er=ge.useCallback(()=>{setTimeout(()=>{Jt.current=!1},1e3),_n(Bi.zoom),ve==="search"&&Bt([Bi.latitude,Bi.longitude])},[Bi.zoom,Bi.latitude,Bi.longitude,ve]),yn=ge.useRef(!1),_r=ge.useCallback(()=>{yn.current=!0,Jt.current=!0,Q.current.stop(),gi.current&&(N.current?.stop(),gi.current=!1)},[]),Ci=ge.useCallback(()=>{yn.current=!1,setTimeout(()=>{yn.current||(Jt.current=!1)},1e3)},[]),ji=Ee=>{if(ve!=="idle"){alert("Please end your current session before changing vehicle type.");return}Pe(Ee),localStorage.setItem("parlens_vehicle_type",Ee)},Ws=ge.useCallback(async(Ee,qe)=>{if(!P||!D||!C){alert("Please sign in to flag parking areas.");return}const Xe=Ee[0];if(!Xe)return;const et=Xe.lat,bt=Xe.lon,Mn=Zf.encode(et,bt,7);Di(!0);try{if(qe){const Xn=Dn.get(Mn);if(Xn){const Ui={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Xn]],content:""},It=await D(Ui);P.publish(ei,It),si(hi=>{const Hi=new Map(hi);return Hi.delete(Mn),Hi}),We(hi=>{const Hi=new Set(hi);return Hi.add(Xn),Hi}),console.log("[Parlens] Unflagged no-parking for geohash:",Mn)}}else{const Xn=Mn.substring(0,5),Ui={kind:Ln.LABEL,created_at:Math.floor(Date.now()/1e3),tags:[["L","parlens"],["l","no-parking","parlens"],["g",Mn],["g",Xn],["location",`${et},${bt}`],["client","parlens"]],content:""},It=await D(Ui);P.publish(ei,It),si(Hi=>{const ya=new Map(Hi);return ya.set(Mn,It.id),ya});const hi={id:It.id,kind:Ln.LABEL,tags:It.tags,lat:et,lon:bt,price:0,currency:"INR",created_at:It.created_at,pubkey:It.pubkey};Ne(Hi=>[...Hi,hi]),console.log("[Parlens] Flagged no-parking for geohash:",Mn)}}catch(Xn){console.error("[Parlens] Failed to toggle no-parking flag:",Xn),alert("Failed to update no-parking flag. Please try again.")}finally{Di(!1)}},[P,D,C,Dn]),Qr=ge.useCallback((Ee,qe,Xe,et)=>{if(ti(Ee),ai(qe),Kn(Xe),lr(et),Ee&&Ee.length>1&&N.current&&et){const bt=[...Ee];qe&&qe.length>0&&bt.push(...qe);const Mn=bt.map(It=>It[1]),Xn=bt.map(It=>It[0]),Ui=new d2.LngLatBounds([Math.min(...Mn),Math.min(...Xn)],[Math.max(...Mn),Math.max(...Xn)]);gi.current=!0,N.current.fitBounds(Ui,{padding:50,duration:1e3}),Re("fixed"),setTimeout(()=>{gi.current=!1,typeof DeviceOrientationEvent.requestPermission=="function"&&oi(!0)},1200)}},[]),Ys=ge.useMemo(()=>{const Ee=zt.filter(Xe=>(Xe.decryptedContent?.type||"car")===xt),qe=new Map;for(const Xe of Ee){const et=Xe.decryptedContent;if(!et||!et.lat||!et.lon)continue;const bt=parseFloat(et.lat.toFixed(6)),Mn=parseFloat(et.lon.toFixed(6)),Xn=`${bt},${Mn}`;if(qe.has(Xn)){const Ui=qe.get(Xn);Ui.timesParked+=1,Ui.logs.push(Xe),Xe.created_at>Ui.created_at&&(Ui.created_at=Xe.created_at)}else qe.set(Xn,{id:Xe.id,lat:bt,lon:Mn,price:parseFloat(et.fee)||0,currency:et.currency||"USD",original:Xe,timesParked:1,logs:[Xe],created_at:Xe.created_at})}return Array.from(qe.values())},[zt,xt]),Us=ge.useMemo(()=>Zm(Ys,jt,!0,7),[Ys,jt]),Nr=ge.useMemo(()=>{const Ee=rt.filter(et=>et.markerType==="listed").map(et=>{const Mn=wt.find(Xn=>Xn.id===et.id)||et;return{id:et.id||`pinned-${et.lat}-${et.lon}`,lat:et.lat,lon:et.lon,price:Mn.price??0,currency:Mn.currency||"INR",count:Mn.count,kind:Ln.LISTED_SPOT_LOG,listing_name:Mn.listing_name||et.listing_name,listing_id:Mn.listing_id||et.listing_id,listing_a_tag:Mn.listing_a_tag||et.listing_a_tag,openSpots:Mn.openSpots||Mn.count||et.openSpots||1,original:Mn,isPinned:!0}});if(ve!=="search")return Ee;const qe=wt.filter(et=>et.kind===Ln.LISTED_SPOT_LOG&&(et.type||"car")===xt).map(et=>({id:et.id,lat:et.lat,lon:et.lon,price:et.price??0,currency:et.currency||"INR",count:et.count,kind:et.kind,listing_name:et.listing_name,listing_id:et.listing_id,listing_a_tag:et.listing_a_tag,openSpots:et.count||1,original:et})),Xe=new Map;return Ee.forEach(et=>Xe.set(et.id,et)),qe.forEach(et=>Xe.set(et.id,et)),Array.from(Xe.values())},[wt,xt,ve,rt]),ma=ge.useMemo(()=>{const Ee=rt.filter(et=>et.markerType==="area").map(et=>{const Mn=wt.find(Xn=>Xn.id===et.id)||et;return{id:et.id||`pinned-area-${et.lat}-${et.lon}`,lat:et.lat,lon:et.lon,price:Mn.price||0,currency:Mn.currency||"INR",count:Mn.count||1,kind:Ln.PARKING_AREA_INDICATOR,created_at:Mn.created_at||et.created_at,original:Mn,isPinned:!0}});if(ve!=="search")return Ee;try{if(!JSON.parse(localStorage.getItem("parlens_show_parking_areas")||"true"))return Ee}catch{}const qe=wt.filter(et=>et.kind===Ln.PARKING_AREA_INDICATOR&&(et.type||"car")===xt).map(et=>({id:et.id,lat:et.lat,lon:et.lon,price:et.price,currency:et.currency,count:et.count,kind:et.kind,created_at:et.created_at,original:et})),Xe=new Map;return Ee.forEach(et=>Xe.set(et.id,et)),qe.forEach(et=>Xe.set(et.id,et)),Array.from(Xe.values())},[wt,xt,ve,rt]),ys=ge.useMemo(()=>Zm(Nr,jt,!0,7),[Nr,jt]),{regularAreaSpots:Ea,noParkingSpots:Ds}=ge.useMemo(()=>{const Ee=[],qe=[];for(const Xe of ma){const et=Zf.encode(Xe.lat,Xe.lon,7);Dn.has(et)?qe.push(Xe):Ee.push(Xe)}return{regularAreaSpots:Ee,noParkingSpots:qe}},[ma,Dn]),Dr=ge.useMemo(()=>Zm(Ea,jt,!0,7),[Ea,jt]),ns=ge.useMemo(()=>Zm(Ds,jt,!0,7),[Ds,jt]),ir=ge.useMemo(()=>{if(!sn)return[];const Ee=sn.type==="listed"?ys:[...Dr,...ns],qe=sn.items[0]?.id;if(!qe)return sn.items;for(const Xe of Ee){const et=kg(Xe)?Xe.spots:[Xe];if(et.some(bt=>bt.id===qe))return et}return sn.items},[sn,ys,Dr,ns]);ge.useEffect(()=>{ve!=="search"&&Nn(null)},[ve]);const Eo=An?Z_.dark:Z_.light,So={id:"route",type:"line",paint:{"line-color":"#007AFF","line-width":5,"line-opacity":.9}},cr={id:"alternate-route",type:"line",paint:{"line-color":"#007AFF","line-width":3,"line-opacity":.4,"line-dasharray":[2,2]}};return M.jsxs("div",{className:"fixed inset-0 overflow-hidden bg-gray-50 dark:bg-black transition-colors duration-300",children:[(!h&&!_e||!zi)&&M.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:M.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:_e?M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center",children:M.jsx("span",{className:"text-2xl",children:""})}),M.jsx("p",{className:"text-sm font-medium text-red-500 dark:text-red-400",children:_e}),M.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-6 py-2 rounded-full bg-[#007AFF] text-white text-sm font-medium active:scale-95 transition-transform",children:"Try Again"})]}):M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"}),M.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Locating..."})]})})}),at&&M.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:M.jsxs("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:[M.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-green-500/20 border-t-green-500 animate-spin"}),M.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Verifying..."})]})}),he==="auto"&&h&&M.jsx("div",{className:"absolute top-1/2 left-1/2 z-[900] pointer-events-none flex items-center justify-center",style:{transform:"translate(-50%, -50%)",width:"40px",height:"40px"},children:M.jsx(Fy,{bearing:Da,mapBearing:Bi.bearing,isNavigationMode:!0})}),M.jsxs("div",{className:"absolute inset-0",onPointerDownCapture:()=>{Jt.current=!0,Q.current.stop(),gi.current&&(N.current?.stop(),gi.current=!1)},onTouchStartCapture:()=>{Jt.current=!0,Q.current.stop(),gi.current&&(N.current?.stop(),gi.current=!1)},onWheelCapture:()=>{Jt.current=!0,gi.current&&(N.current?.stop(),gi.current=!1),window.wheelDebounce&&clearTimeout(window.wheelDebounce),window.wheelDebounce=setTimeout(()=>{Jt.current=!1},1e3)},style:{touchAction:"none"},children:[M.jsxs(FT,{ref:N,...Bi,maxPitch:0,pitchWithRotate:!1,onStyleData:Ee=>{const qe=Ee.target;qe&&(qe.getStyle().layers?.forEach(bt=>{(bt.id.includes("oneway")||bt.id.includes("arrow")||bt.id.includes("direction"))&&qe.getLayoutProperty(bt.id,"visibility")!=="none"&&qe.setLayoutProperty(bt.id,"visibility","none")}),Object.entries({"icon-bus":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M4 6C4 4.89543 4.89543 4 6 4H18C19.1046 4 20 4.89543 20 6V17C20 18.1046 19.1046 19 18 19H16.5L17.5 21H15.5L14.5 19H9.5L8.5 21H6.5L7.5 19H6C4.89543 19 4 18.1046 4 17V6ZM6 6V10H18V6H6ZM6 12V16H18V12H6ZM8 14C8.55228 14 9 13.5523 9 13C9 12.4477 8.55228 12 8 12C7.44772 12 7 12.4477 7 13C7 13.5523 7.44772 14 8 14ZM16 14C16.5523 14 17 13.5523 17 13C17 12.4477 16.5523 12 16 12C15.4477 12 15 12.4477 15 13C15 13.5523 15.4477 14 16 14Z"/></svg>',"icon-train":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8 2 4 2.5 4 6V15.5C4 17.433 5.567 19 7.5 19L6 20.5V21H18V20.5L16.5 19C18.433 19 20 17.433 20 15.5V6C20 2.5 16 2 12 2ZM12 4C14.5 4 18 4.5 18 6V10H6V6C6 4.5 9.5 4 12 4ZM12 17C10.8954 17 10 16.1046 10 15C10 13.8954 10.8954 13 12 13C13.1046 13 14 13.8954 14 15C14 16.1046 13.1046 17 12 17ZM7.5 17C6.67157 17 6 16.3284 6 15.5V12H9.05C9.02 12.3 9 12.64 9 13C9 14.6569 10.3431 16 12 16C13.6569 16 15 14.6569 15 13C15 12.64 14.98 12.3 14.95 12H18V15.5C18 16.3284 17.3284 17 16.5 17H7.5Z"/></svg>',"icon-subway":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M17.8 2.8C16 2.09 13.86 2 12 2C10.14 2 8 2.09 6.2 2.8C4.30002 3.55 3.00002 4.97 3.00002 6.5V15.5C3.00002 17.4 4.40002 19.34 6.6 19.89L5.00002 21.5V22H19V21.5L17.4 19.89C19.6 19.34 21 17.4 21 15.5V6.5C21 4.97 19.7 3.55 17.8 2.8ZM16.5 16C15.12 16 14 14.88 14 13.5C14 12.12 15.12 11 16.5 11C17.88 11 19 12.12 19 13.5C19 14.88 17.88 16 16.5 16ZM12 9C7.58 9 6 6.5 6 6.5C6 6.5 8 5.5 12 5.5C16 5.5 18 6.5 18 6.5C18 6.5 16.42 9 12 9ZM7.5 16C6.12 16 5.00002 14.88 5.00002 13.5C5.00002 12.12 6.12 11 7.5 11C8.88 11 10 12.12 10 13.5C10 14.88 8.88 16 7.5 16Z"/></svg>',"icon-tram":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M13 5.5V2H11V5.5L7 8H17L13 5.5ZM5 9V17.5C5 18.7 5.7 19.7 6.8 20.2L6 21H8L9 20H15L16 21H18L17.2 20.2C18.3 19.7 19 18.7 19 17.5V9H5ZM16 16.5C16 17.05 15.55 17.5 15 17.5H9C8.45 17.5 8 17.05 8 16.5V14H16V16.5ZM16 12.5H8V10.5H16V12.5Z"/></svg>',"icon-stop":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="6" stroke="white" stroke-width="2"/><circle cx="12" cy="12" r="3" fill="white"/></svg>'}).forEach(([bt,Mn])=>{if(!qe.hasImage(bt)){const Xn=new Image(24,24);Xn.onload=()=>qe.addImage(bt,Xn,{sdf:!0}),Xn.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(Mn)}}),qe.getLayer("transit-stops")||qe.addLayer({id:"transit-stops",type:"symbol",source:"openmaptiles","source-layer":"poi",minzoom:12,filter:["match",["get","class"],["bus_station","railway","bus_stop","tram_stop","subway","rail","train_station"],!0,!1],layout:{"icon-image":["match",["get","class"],"bus_station","icon-bus","bus_stop","icon-stop","railway","icon-train","rail","icon-train","train_station","icon-train","tram_stop","icon-tram","subway","icon-subway","icon-stop"],"icon-size":["interpolate",["linear"],["zoom"],12,.5,14,.6,18,1],"icon-allow-overlap":!1,"icon-padding":2,"text-field":["upcase",["coalesce",["get","name_en"],["get","name"]]],"text-size":11,"text-offset":[0,1.2],"text-anchor":"top","text-font":["Noto Sans Regular"],"text-optional":!0},paint:{"icon-color":An?"#999999":"#555555","icon-halo-color":An?"rgba(0,0,0,0.5)":"#ffffff","icon-halo-width":1,"text-color":An?"#aaaaaa":"#666666","text-halo-color":An?"rgba(0,0,0,0.8)":"#ffffff","text-halo-width":1,"text-opacity":["interpolate",["linear"],["zoom"],13.5,0,14,1]}}))},onLoad:Ee=>{Ei(!0);const qe=Ee.target;qe&&qe.getStyle().layers?.forEach(et=>{(et.id.includes("oneway")||et.id.includes("arrow")||et.id.includes("direction"))&&qe.setLayoutProperty(et.id,"visibility","none"),(et.id.includes("admin")||et.id.includes("boundary"))&&qe.setLayoutProperty(et.id,"visibility","none"),(et.id.includes("housenum")||et.id.includes("road_label"))&&et.id.includes("housenum")&&qe.setLayoutProperty(et.id,"visibility","none");const bt=qe.getLayoutProperty(et.id,"text-font");if(bt&&Array.isArray(bt)){const Mn=bt.map(Xn=>Xn.replace("Italic","Regular"));Mn.join(",")!==bt.join(",")&&qe.setLayoutProperty(et.id,"text-font",Mn)}})},onMove:Xi,onMoveStart:Br,onMoveEnd:er,onZoomStart:_r,onZoomEnd:Ci,onRotateStart:()=>{Jt.current=!0,Q.current.stop()},onRotateEnd:er,onPitchStart:()=>{Jt.current=!0,Q.current.stop()},onPitchEnd:er,style:{width:"100%",height:"100%"},mapStyle:Eo,attributionControl:!1,dragPan:!gi.current,minZoom:3,maxZoom:20,renderWorldCopies:!0,maxTileCacheSize:1e3,children:[Jn&&ut&&ut.length>1&&M.jsx(z_,{id:"alternate-route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:ut.map(Ee=>[Ee[1],Ee[0]])}},children:M.jsx(L_,{...cr})}),Jn&&mn&&mn.length>1&&M.jsx(z_,{id:"route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:mn.map(Ee=>[Ee[1],Ee[0]])}},children:M.jsx(L_,{...So})}),ys.map(Ee=>{const qe=kg(Ee);return M.jsx(Oc,{longitude:Ee.lon,latitude:Ee.lat,anchor:"bottom",style:{willChange:"transform",zIndex:N.current?.project([Ee.lon,Ee.lat]).y?Math.floor(N.current.project([Ee.lon,Ee.lat]).y):void 0},onClick:Xe=>{Xe.originalEvent.stopPropagation(),je(!1),Nn(qe?{type:"listed",lat:Ee.lat,lon:Ee.lon,items:Ee.spots||[Ee]}:{type:"listed",lat:Ee.lat,lon:Ee.lon,items:[Ee]})},children:qe?M.jsx(Ng,{minPrice:Ee.minPrice,maxPrice:Ee.maxPrice,currency:Ee.currency,type:"open"}):M.jsx(Wm,{price:Ee.price,currency:Ee.currency,variant:"default"})},`listed-${Ee.id}`)}),Dr.map(Ee=>{const qe=kg(Ee);return M.jsx(Oc,{longitude:Ee.lon,latitude:Ee.lat,anchor:"bottom",style:{willChange:"transform",zIndex:N.current?.project([Ee.lon,Ee.lat]).y?Math.floor(N.current.project([Ee.lon,Ee.lat]).y):void 0},onClick:Xe=>{Xe.originalEvent.stopPropagation(),je(!1),Nn(qe?{type:"area",lat:Ee.lat,lon:Ee.lon,items:Ee.spots||[Ee]}:{type:"area",lat:Ee.lat,lon:Ee.lon,items:[Ee]})},children:qe?M.jsx(Ng,{minPrice:Ee.minPrice,maxPrice:Ee.maxPrice,currency:Ee.currency,type:"area"}):M.jsx(Wm,{price:Ee.price,currency:Ee.currency,variant:"area"})},`area-${Ee.id}`)}),ns.map(Ee=>{const qe=kg(Ee);return M.jsx(Oc,{longitude:Ee.lon,latitude:Ee.lat,anchor:"bottom",style:{willChange:"transform",zIndex:N.current?.project([Ee.lon,Ee.lat]).y?Math.floor(N.current.project([Ee.lon,Ee.lat]).y):void 0},onClick:Xe=>{Xe.originalEvent.stopPropagation(),je(!1),Nn(qe?{type:"area",lat:Ee.lat,lon:Ee.lon,items:Ee.spots||[Ee]}:{type:"area",lat:Ee.lat,lon:Ee.lon,items:[Ee]})},children:qe?M.jsx(Ng,{minPrice:Ee.minPrice,maxPrice:Ee.maxPrice,currency:Ee.currency,type:"no-parking"}):M.jsx(Wm,{price:Ee.price,currency:Ee.currency,variant:"no-parking"})},`noparking-${Ee.id}`)}),(Jn||ar)&&(Qn||xi.length>0)&&M.jsx(M.Fragment,{children:(ar?xi.length>0?xi:Qn||[]:Qn||[]).map((Ee,qe)=>M.jsx(Oc,{longitude:Ee.lon,latitude:Ee.lat,anchor:"center",onClick:Xe=>{Xe.originalEvent?.preventDefault(),Xe.originalEvent?.stopPropagation();const et=Ee.id;un(gn===et?null:et),Fn(Ee.name||`Stop ${qe+1}`)},className:"cursor-pointer",style:{zIndex:gn===Ee.id?200:100},children:M.jsxs("div",{className:"relative flex flex-col items-center",children:[ar&&M.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[200]",onClick:Xe=>Xe.stopPropagation(),children:fn===Ee.id?M.jsxs(M.Fragment,{children:[M.jsx("input",{type:"text",value:Hn,onChange:Xe=>Fn(Xe.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:Xe=>Xe.currentTarget.select(),onKeyDown:Xe=>{if(Xe.key==="Enter"){const et=Ee.id;et&&bi(bt=>bt.map(Mn=>Mn.id===et?{...Mn,name:Hn}:Mn)),Rn(null)}}}),M.jsx("button",{onClick:()=>{const Xe=Ee.id;Xe&&bi(et=>et.map(bt=>bt.id===Xe?{...bt,name:Hn}:bt)),Rn(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:M.jsx(ep,{size:12,strokeWidth:3})}),M.jsx("button",{onClick:()=>Rn(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:M.jsx(no,{size:12})})]}):M.jsxs(M.Fragment,{children:[M.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:Ee.name||`Stop ${qe+1}`}),M.jsx("button",{onClick:()=>{Fn(Ee.name||`Stop ${qe+1}`),Rn(Ee.id)},className:"p-1 rounded-lg transition-colors",children:M.jsx(Vd,{size:12})}),M.jsx("button",{onClick:()=>{const Xe=Ee.id;Xe&&bi(et=>et.filter(bt=>bt.id!==Xe))},className:"p-1 rounded-lg transition-colors",children:M.jsx(T_,{size:12})})]})}),M.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",style:{zIndex:10},children:qe+1})]})},`wp-${Ee.id||qe}`))}),ar&&ln.map((Ee,qe)=>{const Xe=xi.length+qe+1;return M.jsx(Oc,{longitude:Ee.lon,latitude:Ee.lat,anchor:"center",onClick:et=>{et.originalEvent?.preventDefault(),et.originalEvent?.stopPropagation(),un(gn===Ee.id?null:Ee.id),Fn(Ee.name)},className:"cursor-pointer",style:{zIndex:gn===Ee.id?2e3:1e3},children:M.jsxs("div",{className:"relative flex flex-col items-center",children:[M.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[2000]",onClick:et=>et.stopPropagation(),children:fn===Ee.id?M.jsxs(M.Fragment,{children:[M.jsx("input",{type:"text",value:Hn,onChange:et=>Fn(et.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:et=>et.currentTarget.select(),onKeyDown:et=>{et.key==="Enter"&&(hs(Ee.id,Hn),Rn(null))}}),M.jsx("button",{onClick:()=>{hs(Ee.id,Hn),Rn(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:M.jsx(ep,{size:12,strokeWidth:3})}),M.jsx("button",{onClick:()=>Rn(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:M.jsx(no,{size:12})})]}):M.jsxs(M.Fragment,{children:[M.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:Ee.name}),M.jsx("button",{onClick:()=>{Fn(Ee.name),Rn(Ee.id)},className:"p-1 rounded-lg transition-colors",children:M.jsx(Vd,{size:12})}),M.jsx("button",{onClick:()=>Ho(Ee.id),className:"p-1 rounded-lg transition-colors",children:M.jsx(T_,{size:12})})]})}),M.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",children:Xe})]})},Ee.id)}),"     ",Us.map(Ee=>{const qe=kg(Ee);return M.jsx(Oc,{longitude:Ee.lon,latitude:Ee.lat,anchor:"bottom",style:{willChange:"transform"},onClick:Xe=>{Xe.originalEvent.stopPropagation(),je(!1),Nn(qe?{lat:Ee.lat,lon:Ee.lon,type:"history",id:Ee.id,items:Ee.spots||[Ee]}:{lat:Ee.lat,lon:Ee.lon,type:"history",id:Ee.id,items:[Ee]})},children:qe?M.jsx(Ng,{minPrice:Ee.minPrice,maxPrice:Ee.maxPrice,currency:Ee.currency,type:"history"}):M.jsx(Wm,{price:Ee.price,currency:Ee.currency,isHistory:!0})},`history-${Ee.id}`)}),ve==="parked"&&ke&&!Nt&&M.jsx(Oc,{longitude:ke[1],latitude:ke[0],anchor:"bottom",children:M.jsx(D2,{vehicleType:xt})}),Nt&&(Nt.listingLocation||ke)&&M.jsx(Oc,{longitude:(Nt.listingLocation||ke)[1],latitude:(Nt.listingLocation||ke)[0],anchor:"bottom",onClick:Ee=>{Ee.originalEvent.stopPropagation(),je(!1),an(!0)},style:{zIndex:20},children:M.jsxs("div",{className:"flex flex-col items-center",children:[M.jsx("div",{className:"bg-[#34C759] p-2 rounded-full shadow-xl border-2 border-white cursor-pointer hover:scale-110 transition-transform",children:M.jsx(r2,{size:16,className:"text-white"})}),M.jsx("div",{className:"w-0.5 h-3 bg-white"})]})}),rt.filter(Ee=>Ee.markerType==="location_pin").map((Ee,qe)=>M.jsx(Oc,{longitude:Ee.lon,latitude:Ee.lat,anchor:"bottom",style:{zIndex:90},onClick:Xe=>{Xe.originalEvent.stopPropagation(),ce({lat:Ee.lat,lon:Ee.lon,name:Ee.name}),Nn(null)},children:M.jsxs("div",{className:"flex flex-col items-center pointer-events-auto transition-transform",children:[M.jsx("div",{className:"p-2 rounded-full bg-white dark:bg-zinc-800 border-2 border-orange-500",children:M.jsx(to,{size:16,className:"text-orange-500"})}),M.jsx("div",{className:"w-0.5 h-2 bg-orange-500/50"})]})},Ee.id||`pin-${qe}`)),oe&&M.jsx(Oc,{longitude:oe.lon,latitude:oe.lat,anchor:"bottom",style:{zIndex:1e3},children:M.jsxs("div",{className:"flex flex-col items-center pointer-events-auto animate-in zoom-in-75 fade-in duration-200",onClick:Ee=>{Ee.stopPropagation(),je(!0),Nn(null)},children:[pe&&M.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-xl border border-black/10 dark:border-white/10 p-3 w-[240px] mb-2 relative cursor-default",onClick:Ee=>Ee.stopPropagation(),children:[M.jsx("button",{onClick:()=>je(!1),className:"absolute top-2 right-2 p-1 text-zinc-400 active:text-zinc-600 dark:active:text-zinc-300 z-10 bg-white/50 dark:bg-black/20 rounded-full",children:M.jsx(no,{size:14})}),M.jsx("div",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-2",children:"Location Pin"}),M.jsx("div",{className:"font-semibold text-xs text-zinc-900 dark:text-white truncate",children:(/[a-zA-Z]/.test(oe.name)?oe.name.split(",")[0]:oe.name)||`${oe.lat.toFixed(5)}, ${oe.lon.toFixed(5)}`}),M.jsxs("div",{className:"mt-2",children:[(()=>{const Ee=rt.some(qe=>qe.lat===oe.lat&&qe.lon===oe.lon);return M.jsx("button",{onClick:()=>{if(Ee){const qe=rt.filter(Xe=>!(Xe.lat===oe.lat&&Xe.lon===oe.lon));de(qe),localStorage.setItem("parlens_pinned_markers",JSON.stringify(qe)),ce(null),je(!1)}else{const qe={id:`location-pin-${Date.now()}`,lat:oe.lat,lon:oe.lon,name:(/[a-zA-Z]/.test(oe.name)?oe.name.split(",")[0]:oe.name)||`Pin ${oe.lat.toFixed(4)},${oe.lon.toFixed(4)}`,markerType:"location_pin"};de(Xe=>[...Xe,qe]),localStorage.setItem("parlens_pinned_markers",JSON.stringify([...rt,qe]))}},className:`mt-3 w-full py-1.5 rounded-lg text-xs font-medium transition-colors ${Ee?"bg-zinc-500/10 text-zinc-600 active:bg-zinc-500/20 dark:text-zinc-400":"bg-amber-500/10 text-amber-600 active:bg-amber-500/20"}`,children:Ee?"Remove from Map":"Keep on Map"})})(),M.jsx("button",{onClick:()=>{const{lat:Ee,lon:qe,name:Xe}=oe,et=(/[a-zA-Z]/.test(Xe)?Xe.split(",")[0]:Xe)||`Pin ${Ee.toFixed(4)},${qe.toFixed(4)}`;if(!rt.some(Mn=>Mn.lat===Ee&&Mn.lon===qe)){const Mn={id:`location-pin-${Date.now()}`,lat:Ee,lon:qe,name:et,markerType:"location_pin"};de(Xn=>[...Xn,Mn]),localStorage.setItem("parlens_pinned_markers",JSON.stringify([...rt,Mn]))}ce(null),$t([{lat:h?.[0]||Ee,lon:h?.[1]||qe,name:"Current Location"},{lat:Ee,lon:qe,name:et}])},className:"mt-2 w-full py-1.5 rounded-lg text-xs font-medium bg-blue-500/10 text-blue-600 active:bg-blue-500/20 transition-colors",children:"Create Route"})]})]}),M.jsx("div",{className:"p-2 rounded-full bg-white dark:bg-zinc-800 border-2 border-orange-500",children:M.jsx(to,{size:16,className:"text-orange-500"})}),M.jsx("div",{className:"w-0.5 h-2 bg-orange-500/50"})]})}),sn&&M.jsx(Oc,{longitude:sn.lon,latitude:sn.lat,anchor:"bottom",offset:[0,-48],style:{zIndex:1e3},children:M.jsx("div",{className:"relative",children:M.jsx(N2,{type:sn.type,items:ir,onClose:()=>Nn(null),isPinned:ir.length>0&&ir.every(Ee=>rt.some(qe=>qe.id===Ee.id)),onTogglePin:()=>{const Ee=ir.length>0&&ir.every(Xe=>rt.some(et=>et.id===Xe.id));let qe;if(Ee){const Xe=new Set(ir.map(et=>et.id));qe=rt.filter(et=>!Xe.has(et.id))}else{const Xe=new Set(rt.map(bt=>bt.id)),et=ir.filter(bt=>!Xe.has(bt.id)).map(bt=>({...bt,lat:bt.lat,lon:bt.lon,markerType:sn.type}));qe=[...rt,...et]}if(de(qe),localStorage.setItem("parlens_pinned_markers",JSON.stringify(qe)),sn.type==="listed"&&!Ee)try{const Xe=new Set(JSON.parse(localStorage.getItem("parlens-saved-listings")||"[]")),et=new Set(JSON.parse(localStorage.getItem("parlens-saved-refs")||"[]"));ir.forEach(bt=>{bt.listing_id&&Xe.add(bt.listing_id),bt.listing_a_tag&&et.add(bt.listing_a_tag)}),localStorage.setItem("parlens-saved-listings",JSON.stringify(Array.from(Xe))),localStorage.setItem("parlens-saved-refs",JSON.stringify(Array.from(et))),console.log("[Parlens] Synced pinned markers to saved listings and refs")}catch(Xe){console.error("[Parlens] Failed to sync saved listings:",Xe)}Nn(null)},onCreateRoute:()=>{if(!(ir.length>0&&ir.every(bt=>rt.some(Mn=>Mn.id===bt.id)))&&ir.length>0){const bt=new Set(rt.map(Ui=>Ui.id)),Mn=ir.filter(Ui=>!bt.has(Ui.id)).map(Ui=>({...Ui,lat:Ui.lat,lon:Ui.lon,markerType:sn.type})),Xn=[...rt,...Mn];if(de(Xn),localStorage.setItem("parlens_pinned_markers",JSON.stringify(Xn)),console.log("[Parlens] Auto-pinned marker for route creation"),sn.type==="listed")try{const Ui=new Set(JSON.parse(localStorage.getItem("parlens-saved-listings")||"[]")),It=new Set(JSON.parse(localStorage.getItem("parlens-saved-refs")||"[]"));Mn.forEach(hi=>{hi.listing_id&&Ui.add(hi.listing_id),hi.listing_a_tag&&It.add(hi.listing_a_tag)}),localStorage.setItem("parlens-saved-listings",JSON.stringify(Array.from(Ui))),localStorage.setItem("parlens-saved-refs",JSON.stringify(Array.from(It))),console.log("[Parlens] Synced auto-pinned marker to saved listings and refs")}catch(Ui){console.error("[Parlens] Failed to sync saved listings:",Ui)}}const qe=sn.lat,Xe=sn.lon,et=[];h&&et.push({lat:h[0],lon:h[1],name:"Current Location"}),et.push({lat:qe,lon:Xe,name:"Destination"}),Qr(null,null,[],!1),$t(et),Nn(null)},onFlagNoParking:sn.type==="area"?()=>{const Ee=ir[0];if(Ee){const qe=Zf.encode(Ee.lat,Ee.lon,7),Xe=Dn.has(qe);Ws(ir,Xe)}}:void 0,isFlaggedByUser:sn.type==="area"?(()=>{const Ee=ir[0];if(Ee){const qe=Zf.encode(Ee.lat,Ee.lon,7);return Dn.has(qe)}return!1})():void 0,noParkingFlagCount:sn.type==="area"?(()=>{const Ee=ir[0];if(Ee){const qe=Zf.encode(Ee.lat,Ee.lon,7);return kn.get(qe)||0}return 0})():void 0,isFlagging:_i})})}),Kt&&Nt&&M.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in",onClick:()=>an(!1),children:M.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] w-full max-w-sm rounded-[2rem] shadow-2xl p-6 space-y-6 relative border border-black/5 dark:border-white/10",onClick:Ee=>Ee.stopPropagation(),children:[M.jsx("button",{onClick:()=>an(!1),className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:M.jsx(no,{size:24})}),M.jsxs("div",{className:"text-center space-y-1",children:[M.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 tracking-wider",children:"Active Session"}),M.jsx("h2",{className:"text-2xl font-bold dark:text-white leading-tight",children:Nt.listingName||"Parking Spot"}),M.jsx("div",{className:"text-lg text-blue-500 font-bold",children:Nt.shortName||`#${Nt.spotNumber}`}),Nt.floor&&M.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:Nt.floor})]}),M.jsx("div",{className:"space-y-4",children:M.jsx("div",{className:"p-6 bg-zinc-50 dark:bg-white/5 rounded-3xl flex justify-center border border-black/5 dark:border-white/5",children:M.jsx(N1,{value:JSON.stringify({a:Nt.spotATag,authorizer:Nt.authorizer}),size:180,level:"M",bgColor:"transparent",fgColor:"currentColor",className:"text-black dark:text-white"})})}),M.jsx("button",{onClick:()=>an(!1),className:"w-full py-4 bg-zinc-100 dark:bg-white/10 text-zinc-900 dark:text-white font-bold rounded-2xl",children:"Close"})]})}),h&&he!=="auto"&&M.jsx(Oc,{longitude:h[1],latitude:h[0],anchor:"center",style:{zIndex:1e3},children:M.jsx(Fy,{bearing:Da,mapBearing:Bi.bearing,isNavigationMode:!1})})]}),M.jsxs("div",{className:`absolute top-4 left-1/2 -translate-x-1/2 z-[1000] flex items-center gap-2 transition-all duration-300 pointer-events-none ${ve!=="idle"?"opacity-100":""}`,children:[ve==="search"&&M.jsxs("div",{className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto",children:[M.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-500/30 border-t-blue-500 rounded-full"}),M.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white whitespace-nowrap",children:"Searching for spots..."})]}),ve==="parked"&&M.jsxs("button",{onClick:()=>{ke&&N.current&&(gi.current=!0,N.current.flyTo({center:[ke[1],ke[0]],zoom:17,duration:1e3,essential:!0}),N.current.once("moveend",()=>{gi.current=!1,Re("fixed")}))},className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto active:scale-95 transition-transform",children:[M.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 shadow-md"}),M.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white",children:"Session Active"})]}),ve==="idle"&&!ar&&!us&&M.jsx("div",{className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto",children:M.jsxs("button",{onClick:()=>vi(!0),className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[M.jsx("div",{className:"w-4 h-4 rounded-full bg-[#007AFF] shadow-sm"}),M.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white whitespace-nowrap",children:"Search for Parking"})]})})]}),ar&&M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1600]",children:M.jsxs("div",{className:"relative flex items-center justify-center",children:[M.jsx("div",{className:"absolute w-8 h-8 rounded-full bg-orange-500/10 dark:bg-orange-400/10 animate-pulse"}),M.jsx("div",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full shadow-sm z-10"}),M.jsx("div",{className:"absolute w-6 h-[1.5px] bg-orange-500/60 rounded-full"}),M.jsx("div",{className:"absolute h-6 w-[1.5px] bg-orange-500/60 rounded-full"})]})}),M.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 translate-y-12 z-[1500]",children:M.jsxs("button",{onClick:Lr,className:"bg-white dark:bg-zinc-800 text-orange-500 px-6 py-2.5 rounded-full font-bold text-sm shadow-xl backdrop-blur-md active:scale-95 transition-all flex items-center gap-2 border border-black/5 dark:border-white/10",children:[M.jsx(to,{size:16,className:"fill-current"}),"Drop Pin Here"]})}),M.jsx("div",{className:"absolute top-4 right-4 z-[2000] animate-in slide-in-from-top-4 fade-in",children:M.jsxs("button",{onClick:Rt,className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white px-6 py-2.5 rounded-full font-bold shadow-lg shadow-amber-500/30 flex items-center gap-2 transition-transform active:scale-95",children:[M.jsx(ep,{size:18,strokeWidth:3}),"Done"]})})]})]}),M.jsxs("div",{className:`absolute z-[1000] flex flex-col items-start gap-3 animate-in slide-in-from-left-6 transition-opacity duration-300 pointer-events-none ${ar||us?"opacity-0":"opacity-100"}`,style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",left:"max(1rem, env(safe-area-inset-left))"},children:[M.jsx(R2,{vehicleType:xt,onVehicleChange:ji,disabled:ve!=="idle"}),M.jsx("button",{onClick:()=>c?.(),onContextMenu:Ee=>{Ee.preventDefault();const qe=prompt("Enter Parking Code manually:");qe&&Ze(qe)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95 pointer-events-auto",title:"Scan QR Code (Long press for manual)",children:M.jsx("div",{className:"relative",children:M.jsx(hT,{size:20})})}),M.jsx("button",{onClick:()=>{if(ve==="search"){alert("Please cancel the active search to view Listed Parking.");return}it(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95 pointer-events-auto",title:"Listed Parking",children:M.jsx("span",{className:"text-3xl font-light leading-none pb-1",children:""})})]}),M.jsxs("div",{className:`absolute z-[1000] flex flex-col items-end gap-3 animate-in slide-in-from-right-6 transition-opacity duration-300 pointer-events-none ${us?"opacity-0":"opacity-100"}`,style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",right:"max(1rem, env(safe-area-inset-right))"},children:[Math.abs(Bi.bearing)>5&&he!=="auto"&&M.jsx("button",{onClick:()=>{const Ee=N.current?.getBearing()||0,qe=Math.round(Ee/360)*360;N.current?.rotateTo(qe,{duration:400}),Cr(Xe=>({...Xe,pitch:0}))},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 pointer-events-auto",title:"Reset to true north",children:M.jsxs("div",{className:"flex flex-col items-center justify-center",style:{transform:`rotate(${-Bi.bearing}deg)`},children:[M.jsx("div",{style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"10px solid rgb(239 68 68)"}}),M.jsx("span",{className:"text-sm font-bold text-zinc-600 dark:text-white/70",style:{marginTop:"-2px"},children:"N"})]})}),M.jsx("button",{onClick:async()=>{if(De){await ul();return}if(Li(""),Pi([]),ar){h&&N.current?.flyTo({center:[h[1],h[0]],zoom:17,duration:800,essential:!0});return}N.current?.stop(),gi.current=!1;const Ee=Bi.zoom,qe=17;if(Oe){if(h){const Xe=Ee<qe?qe:Ee;gi.current=!0,N.current?.flyTo({center:[h[1],h[0]],zoom:Xe,duration:800,essential:!0}),N.current?.once("moveend",()=>{gi.current=!1})}Re("recentre"),At(!1);return}if((he==="fixed"||he==="recentre")&&h&&(gi.current=!0,N.current?.flyTo({center:[h[1],h[0]],zoom:Ee<qe?qe:Ee,bearing:Math.round((N.current?.getBearing()||0)/360)*360,duration:800,essential:!0}),N.current?.once("moveend",()=>{gi.current=!1,he==="fixed"&&Re("recentre")})),he==="recentre"){if(ve==="parked"){gi.current=!0,N.current?.flyTo({bearing:Math.round((N.current?.getBearing()||0)/360)*360,pitch:0,zoom:16.5,duration:800,essential:!0}),N.current?.once("moveend",()=>{gi.current=!1}),Re("fixed");return}const Xe=Da||0;gi.current=!0,Ye(!0),N.current?.rotateTo(Xe,{duration:800}),N.current?.once("moveend",()=>{gi.current=!1,Ye(!1),Y.current.reset(Xe),Re("auto")});return}Re(Xe=>{if(Xe==="auto"){const et=N.current?.getBearing()||0,bt=Math.round(et/360)*360;return gi.current=!0,N.current?.flyTo({bearing:bt,pitch:0,zoom:16.5,duration:800,essential:!0}),N.current?.once("moveend",()=>{gi.current=!1}),Ye(!1),"fixed"}return"recentre"})},className:`h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg pointer-events-auto ${De?"bg-orange-500/20 border-orange-500/50 text-orange-500 animate-pulse":"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70"}`,children:De?M.jsx(qm,{size:20,className:"text-orange-500 animate-pulse"}):ar?M.jsx(qm,{size:20,className:"text-zinc-600 dark:text-white/70"}):he==="auto"||tt?M.jsx(I3,{size:20,className:"text-blue-500"}):he==="recentre"?M.jsx(qm,{size:20,fill:"currentColor",className:"text-green-500"}):M.jsx(qm,{size:20,className:`text-zinc-600 dark:text-white/70 ${Oe?"opacity-50":""}`})}),!ar&&M.jsx("button",{onClick:()=>Gn(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10 pointer-events-auto",title:"Create Route",children:M.jsx(s2,{size:20})}),M.jsx("div",{className:`relative z-[1010] pointer-events-auto ${ar?"hidden":"block"}`,children:M.jsx(C4,{setHistorySpots:Gt,onHelpClick:()=>Wt(!0)})}),M.jsx("div",{className:ar?"hidden":"block",children:M.jsx(g4,{status:ve,setStatus:me,searchLocation:oe?[oe.lat,oe.lon]:ve==="search"?tn||[Bi.latitude,Bi.longitude]:h,userLocation:h,vehicleType:xt,setOpenSpots:vt,parkLocation:ke,setParkLocation:nt,sessionStart:Mi,setSessionStart:ni,listedParkingSession:Nt,onQRScan:c,onSpotStatusUpdate:Ji})})]}),M.jsx("div",{className:ar?"hidden":"block",children:M.jsx(T4,{vehicleType:xt,onRouteChange:Qr,currentLocation:h,onDropPinModeChange:Zi,pendingWaypoints:mt,onDropPinConsumed:()=>$t(null),onOpenChange:ki,onWaypointsChange:bi,onRequestOrientationPermission:ul,isOpen:qn,onClose:()=>Gn(!1),hideTrigger:!0,onRouteCreated:()=>{ve==="search"&&(me("idle"),vt([]))}})}),pt&&M.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl pt-2 px-4 pb-4 animate-in fade-in",children:[M.jsx("button",{onClick:()=>Wt(!1),className:"absolute inset-0 z-0 cursor-default"}),M.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] border border-black/5 dark:border-white/5 shadow-2xl p-6 space-y-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar transition-colors",style:{overscrollBehaviorY:"contain"},children:[M.jsx("button",{onClick:()=>Wt(!1),className:"absolute top-6 right-6 p-2 rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform",children:M.jsx(Ex,{size:20})}),M.jsxs("div",{className:"text-center space-y-2 pt-4",children:[M.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4",children:M.jsx("span",{className:"text-3xl font-bold",children:"?"})}),M.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"How to use Parlens"}),M.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Decentralised Parking Management"})]}),M.jsxs("div",{className:"space-y-3",children:[M.jsx("h3",{className:"text-center font-bold text-zinc-600 dark:text-white/90",children:"Add to your homescreen"}),M.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[M.jsxs("button",{onClick:()=>{document.getElementById("android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[M.jsx("span",{children:"Using Browser Menu (Android)"}),M.jsx(Fd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),M.jsxs("div",{id:"android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:[M.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white",children:"Chrome & Brave:"}),M.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[M.jsx("li",{children:"Tap menu button (three dots)"}),M.jsxs("li",{children:["Tap ",M.jsx("strong",{children:"Add to Home screen"})]}),M.jsxs("li",{children:["Tap ",M.jsx("strong",{children:"Add"})," to confirm"]})]}),M.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white mt-3",children:"Firefox:"}),M.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[M.jsx("li",{children:"Tap menu button (three dots)"}),M.jsxs("li",{children:["Tap ",M.jsx("strong",{children:"Install"})]})]})]})]}),M.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[M.jsxs("button",{onClick:()=>{document.getElementById("ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[M.jsx("span",{children:"Using Share Button (iOS)"}),M.jsx(Fd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),M.jsx("div",{id:"ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:M.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[M.jsxs("li",{children:["Tap the ",M.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),M.jsxs("li",{children:["Scroll down and tap ",M.jsx("strong",{children:"Add to Home Screen"}),"."]}),M.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),M.jsxs("div",{className:"space-y-4 text-sm text-zinc-600 dark:text-white/80 leading-relaxed pt-4 border-t border-black/5 dark:border-white/10",children:[M.jsxs("div",{children:[M.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-4",children:"Parking Seekers"}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select Vehicle Type"}),"Use the vertical toggle to switch between Bicycle , Motorcycle , or Car . Your vehicle type determines what parking spots you see on the map."]}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Find Parking"}),"Click the blue search button to find parking around you or plan ahead by searching for parking near your destination. Click the search for parking bubble at the top of your screen to find parking near your destination and click the blue search button when you are nearby to refresh parking results in real-time."]}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Mark Your Spot"}),"Once you find a spot, click the amber parking location button to mark your parked location and start your session. Click the session active bubble to centre the map on your parking marker at any time during the session."]}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Log Your Session"}),"When youre ready to leave, click the green vehicle button to remove the marker, report the fees and log the session in your parking history."]}),M.jsxs("p",{children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Share Parking Reports (Optional)"}),"Anonymously report parking details to help other users know where to find parking. The opt-in switch for this feature is available in the parking areas section on the profile page. Once opted-in, you may opt-out at any time."]})]}),M.jsxs("div",{className:"mt-8 pt-4",children:[M.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-4",children:"Parking Service Providers"}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Listed Parking"}),"Users who oversee one or more parking spots can create a listing to simplify spot discovery and management. Click the parking services button () and select listed parking.",M.jsx("br",{}),M.jsx("br",{}),"Click the + button to create a listing and provide the details as requested in the form to create one or more online spots to match your real world location."]}),M.jsxs("p",{children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Valet Parking"}),"Users who park for others can enable valet mode to manage multiple parking sessions at the same time. Click the parking services button () and select valet parking to get started.",M.jsx("br",{}),M.jsx("br",{}),"Click the + button to create a new valet session. Ask your clients to scan the QR code using the Parlens app to see the parking location and let you know when theyre ready to leave."]})]}),M.jsxs("div",{className:"mt-6 pt-4 space-y-6",children:[M.jsxs("div",{children:[M.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-2",children:"User Privacy"}),M.jsx("p",{className:"mb-4",children:"Parlens does not collect or share any personal data. Parking history and saved routes are encrypted by your keys and only accessible by you. If you ever feel like your privacy is compromised, delete your account, abandon your keys and create a new account."})]}),M.jsxs("div",{children:[M.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-2",children:"License"}),M.jsx("p",{children:"This project is licensed under the GNU General Public License v3.0."})]})]})]})]})]}),In&&M.jsx("div",{className:"fixed top-0 left-0 right-0 z-[1800] flex flex-col items-center px-4 pt-16 pointer-events-none animate-in fade-in",children:M.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl border border-black/10 dark:border-white/10 overflow-hidden pointer-events-auto",children:[M.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-zinc-200 dark:border-white/10",children:[M.jsxs("div",{className:"flex-1 flex items-center h-12 bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 rounded-xl overflow-hidden focus-within:ring-2 focus-within:ring-blue-500",children:[M.jsx("input",{type:"text",value:nn,onChange:Ee=>Fi(Ee.target.value),placeholder:"Search for parking near...",className:"flex-1 h-full bg-transparent px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/40 text-base focus:outline-none",autoFocus:!0}),M.jsx("button",{onClick:()=>{vi(!1),Li(""),Pi([]),gt(!0),Zi(!0)},className:"px-3 h-full flex items-center text-orange-500 hover:bg-orange-500/10 transition-colors",title:"Drop Pin",children:M.jsx(to,{size:18})})]}),M.jsx("button",{onClick:()=>{vi(!1),Li(""),Pi([])},className:"p-2 text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/80",children:M.jsx(no,{size:20})})]}),(Rl(nn)||St.length>0||Ki.length>0)&&M.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[M.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-white/5 border-b border-black/5 dark:border-white/5 flex items-center gap-2 overflow-x-auto",children:[Rl(nn)&&M.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-blue-500/10 to-cyan-500/10 dark:from-blue-500/20 dark:to-cyan-500/20 text-[10px] font-bold text-blue-600 dark:text-blue-300 uppercase tracking-wider border border-blue-200 dark:border-blue-500/20",children:Rl(nn)?.type==="plus_code"?"Plus Code":"Coordinate"}),St.length>0&&M.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-emerald-500/10 to-teal-500/10 dark:from-emerald-500/20 dark:to-teal-500/20 text-[10px] font-bold text-emerald-600 dark:text-emerald-300 uppercase tracking-wider border border-emerald-200 dark:border-emerald-500/20",children:"Saved Places"}),Ki.length>0&&M.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-violet-500/10 to-fuchsia-500/10 dark:from-violet-500/20 dark:to-fuchsia-500/20 text-[10px] font-bold text-violet-600 dark:text-violet-300 uppercase tracking-wider border border-violet-200 dark:border-violet-500/20",children:"OSM Search"})]}),Rl(nn)&&M.jsxs("button",{onClick:()=>{const Ee=Rl(nn);Ee&&$r({lat:String(Ee.lat),lon:String(Ee.lon),display_name:`${Ee.lat.toFixed(6)}, ${Ee.lon.toFixed(6)}`})},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-blue-50 dark:bg-blue-500/10 text-blue-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 shrink-0 transition-colors",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsxs("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:[Rl(nn)?.lat.toFixed(6),", ",Rl(nn)?.lon.toFixed(6)]}),M.jsx("div",{className:"text-[10px] text-zinc-400 dark:text-white/40 mt-0.5 uppercase tracking-wider",children:Rl(nn)?.type==="plus_code"?"Plus Code":"Coordinate"})]})]}),St.map((Ee,qe)=>M.jsxs("button",{onClick:()=>$r({lat:String(Ee.lat),lon:String(Ee.lon),display_name:Ee.name}),className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 shrink-0 transition-colors",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Ee.name}),M.jsx("div",{className:"text-[10px] text-zinc-400 dark:text-white/40 mt-0.5 uppercase tracking-wider",children:"Saved Waypoint"})]})]},`saved-${qe}`)),Ki.map((Ee,qe)=>M.jsxs("button",{onClick:()=>$r(Ee),className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[M.jsx("div",{className:"mt-0.5 p-2 rounded-full shrink-0 transition-colors bg-violet-50 dark:bg-violet-500/10 text-violet-500 group-hover:text-violet-600 dark:group-hover:text-violet-400",children:M.jsx(to,{size:16})}),M.jsxs("div",{className:"flex-1 min-w-0",children:[M.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Ee.display_name?.split(",")[0]}),M.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:Ee.display_name?.split(",").slice(1).join(",")})]})]},`osm-${qe}`))]})]})}),M.jsx("div",{style:{display:Et&&!us?"block":"none"},children:Et&&M.jsx(G4,{onClose:()=>it(!1),currentLocation:h,countryCode:Tr,onPickLocation:()=>Xr(!0),pickedLocation:ci,routeWaypoints:Qn||void 0})}),us&&M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1500]",children:M.jsxs("div",{className:"relative",children:[M.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-4 bg-black/50"}),M.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-1 bg-black/50"}),M.jsx("div",{className:"w-8 h-8 border-2 border-amber-500 rounded-full flex items-center justify-center bg-white/20 backdrop-blur-sm shadow-xl animate-in zoom-in spin-in-180 duration-500",children:M.jsx(to,{size:16,className:"text-amber-600 fill-current"})})]})}),M.jsxs("div",{className:"absolute bottom-10 left-0 right-0 z-[2000] flex justify-center gap-4 px-4 pb-safe animate-in slide-in-from-bottom",children:[M.jsx("button",{onClick:()=>Xr(!1),className:"px-6 py-3 rounded-full bg-white text-zinc-900 font-bold shadow-lg",children:"Cancel"}),M.jsx("button",{onClick:()=>{Un({lat:Bi.latitude,lon:Bi.longitude}),Xr(!1)},className:"px-6 py-3 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold shadow-lg shadow-amber-500/30",children:"Confirm Location"})]})]}),Ct&&M.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:M.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[M.jsxs("div",{className:"text-center space-y-1",children:[M.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),M.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee"})]}),M.jsxs("div",{className:"flex items-center gap-4",children:[M.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[M.jsx("span",{className:"text-2xl font-bold text-blue-500",children:(jn?.session?.currency||Nt?.currency)==="INR"?"":(jn?.session?.currency||Nt?.currency)==="EUR"?"":(jn?.session?.currency||Nt?.currency)==="GBP"?"":"$"}),M.jsx("input",{type:"number",value:En,onChange:Ee=>Ri(Ee.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),M.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:jn?.session?.currency||Nt?.currency||"USD"})]}),M.jsxs("div",{className:"flex flex-col gap-1.5",children:[M.jsx("button",{onClick:()=>Ri(String(Math.max(0,parseFloat(En||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:M.jsx(M1,{size:22,className:"text-zinc-600 dark:text-white/70"})}),M.jsx("button",{onClick:()=>Ri(String(Math.max(0,parseFloat(En||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:M.jsx(Fd,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),M.jsxs("div",{className:"w-full space-y-3",children:[M.jsx("input",{type:"text",value:ii,onChange:Ee=>$n(Ee.target.value),placeholder:"Add a note (optional)",className:"w-full px-4 py-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"}),M.jsxs("button",{onClick:yt,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",M.jsx(t2,{size:20})]}),M.jsx("button",{onClick:()=>{Zn(!1),li(null),Ri("0"),$n("")},className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})};var yi;(function(c){c[c.QR_CODE=0]="QR_CODE",c[c.AZTEC=1]="AZTEC",c[c.CODABAR=2]="CODABAR",c[c.CODE_39=3]="CODE_39",c[c.CODE_93=4]="CODE_93",c[c.CODE_128=5]="CODE_128",c[c.DATA_MATRIX=6]="DATA_MATRIX",c[c.MAXICODE=7]="MAXICODE",c[c.ITF=8]="ITF",c[c.EAN_13=9]="EAN_13",c[c.EAN_8=10]="EAN_8",c[c.PDF_417=11]="PDF_417",c[c.RSS_14=12]="RSS_14",c[c.RSS_EXPANDED=13]="RSS_EXPANDED",c[c.UPC_A=14]="UPC_A",c[c.UPC_E=15]="UPC_E",c[c.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(yi||(yi={}));var X_=new Map([[yi.QR_CODE,"QR_CODE"],[yi.AZTEC,"AZTEC"],[yi.CODABAR,"CODABAR"],[yi.CODE_39,"CODE_39"],[yi.CODE_93,"CODE_93"],[yi.CODE_128,"CODE_128"],[yi.DATA_MATRIX,"DATA_MATRIX"],[yi.MAXICODE,"MAXICODE"],[yi.ITF,"ITF"],[yi.EAN_13,"EAN_13"],[yi.EAN_8,"EAN_8"],[yi.PDF_417,"PDF_417"],[yi.RSS_14,"RSS_14"],[yi.RSS_EXPANDED,"RSS_EXPANDED"],[yi.UPC_A,"UPC_A"],[yi.UPC_E,"UPC_E"],[yi.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),W_;(function(c){c[c.UNKNOWN=0]="UNKNOWN",c[c.URL=1]="URL"})(W_||(W_={}));function W4(c){return Object.values(yi).includes(c)}var h1;(function(c){c[c.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",c[c.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(h1||(h1={}));var Y4=(function(){function c(){}return c.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",c.SCAN_DEFAULT_FPS=2,c.DEFAULT_DISABLE_FLIP=!1,c.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,c.DEFAULT_SUPPORTED_SCAN_TYPE=[h1.SCAN_TYPE_CAMERA,h1.SCAN_TYPE_FILE],c})(),P2=(function(){function c(d,y){this.format=d,this.formatName=y}return c.prototype.toString=function(){return this.formatName},c.create=function(d){if(!X_.has(d))throw"".concat(d," not in html5QrcodeSupportedFormatsTextMap");return new c(d,X_.get(d))},c})(),Y_=(function(){function c(){}return c.createFromText=function(d){var y={text:d};return{decodedText:d,result:y}},c.createFromQrcodeResult=function(d){return{decodedText:d.text,result:d}},c})(),jy;(function(c){c[c.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",c[c.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",c[c.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(jy||(jy={}));var $4=(function(){function c(){}return c.createFrom=function(d){return{errorMessage:d,type:jy.UNKWOWN_ERROR}},c})(),Q4=(function(){function c(d){this.verbose=d}return c.prototype.log=function(d){this.verbose&&console.log(d)},c.prototype.warn=function(d){this.verbose&&console.warn(d)},c.prototype.logError=function(d,y){(this.verbose||y===!0)&&console.error(d)},c.prototype.logErrors=function(d){if(d.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(d)},c})();function Lh(c){return typeof c>"u"||c===null}var m0=(function(){function c(){}return c.codeParseError=function(d){return"QR code parse error, error = ".concat(d)},c.errorGettingUserMedia=function(d){return"Error getting userMedia, error = ".concat(d)},c.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},c.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},c.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},c.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},c.scannerPaused=function(){return"Scanner paused"},c})(),O2=(function(){function c(){}return c.isMediaStreamConstraintsValid=function(d,y){if(typeof d!="object"){var C=typeof d;return y.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(C,"."),!0),!1}for(var D=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],P=new Set(D),N=Object.keys(d),h=0,U=N;h<U.length;h++){var H=U[h];if(P.has(H))return y.logError("".concat(H," is not supported videoConstaints."),!0),!1}return!0},c})(),Dg={exports:{}},K4=Dg.exports,$_;function J4(){return $_||($_=1,(function(c,d){(function(y,C){C(d)})(K4,(function(y){function C(le){return le==null}var D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(le,a){le.__proto__=a}||function(le,a){for(var u in a)a.hasOwnProperty(u)&&(le[u]=a[u])};function P(le,a){D(le,a);function u(){this.constructor=le}le.prototype=a===null?Object.create(a):(u.prototype=a.prototype,new u)}function N(le,a){var u=Object.setPrototypeOf;u?u(le,a):le.__proto__=a}function h(le,a){a===void 0&&(a=le.constructor);var u=Error.captureStackTrace;u&&u(le,a)}var U=(function(le){P(a,le);function a(u){var g=this.constructor,v=le.call(this,u)||this;return Object.defineProperty(v,"name",{value:g.name,enumerable:!1}),N(v,g.prototype),h(v),v}return a})(Error);class H extends U{constructor(a=void 0){super(a),this.message=a}getKind(){return this.constructor.kind}}H.kind="Exception";class Y extends H{}Y.kind="ArgumentException";class Q extends H{}Q.kind="IllegalArgumentException";class _e{constructor(a){if(this.binarizer=a,a===null)throw new Q("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(a,u){return this.binarizer.getBlackRow(a,u)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(a,u,g,v){const w=this.binarizer.getLuminanceSource().crop(a,u,g,v);return new _e(this.binarizer.createBinarizer(w))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const a=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new _e(this.binarizer.createBinarizer(a))}rotateCounterClockwise45(){const a=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new _e(this.binarizer.createBinarizer(a))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class we extends H{static getChecksumInstance(){return new we}}we.kind="ChecksumException";class ve{constructor(a){this.source=a}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class me{static arraycopy(a,u,g,v,w){for(;w--;)g[v++]=a[u++]}static currentTimeMillis(){return Date.now()}}class he extends H{}he.kind="IndexOutOfBoundsException";class Re extends he{constructor(a=void 0,u=void 0){super(u),this.index=a,this.message=u}}Re.kind="ArrayIndexOutOfBoundsException";class tt{static fill(a,u){for(let g=0,v=a.length;g<v;g++)a[g]=u}static fillWithin(a,u,g,v){tt.rangeCheck(a.length,u,g);for(let w=u;w<g;w++)a[w]=v}static rangeCheck(a,u,g){if(u>g)throw new Q("fromIndex("+u+") > toIndex("+g+")");if(u<0)throw new Re(u);if(g>a)throw new Re(g)}static asList(...a){return a}static create(a,u,g){return Array.from({length:a}).map(w=>Array.from({length:u}).fill(g))}static createInt32Array(a,u,g){return Array.from({length:a}).map(w=>Int32Array.from({length:u}).fill(g))}static equals(a,u){if(!a||!u||!a.length||!u.length||a.length!==u.length)return!1;for(let g=0,v=a.length;g<v;g++)if(a[g]!==u[g])return!1;return!0}static hashCode(a){if(a===null)return 0;let u=1;for(const g of a)u=31*u+g;return u}static fillUint8Array(a,u){for(let g=0;g!==a.length;g++)a[g]=u}static copyOf(a,u){return a.slice(0,u)}static copyOfUint8Array(a,u){if(a.length<=u){const g=new Uint8Array(u);return g.set(a),g}return a.slice(0,u)}static copyOfRange(a,u,g){const v=g-u,w=new Int32Array(v);return me.arraycopy(a,u,w,0,v),w}static binarySearch(a,u,g){g===void 0&&(g=tt.numberComparator);let v=0,w=a.length-1;for(;v<=w;){const I=w+v>>1,O=g(u,a[I]);if(O>0)v=I+1;else if(O<0)w=I-1;else return I}return-v-1}static numberComparator(a,u){return a-u}}class Ye{static numberOfTrailingZeros(a){let u;if(a===0)return 32;let g=31;return u=a<<16,u!==0&&(g-=16,a=u),u=a<<8,u!==0&&(g-=8,a=u),u=a<<4,u!==0&&(g-=4,a=u),u=a<<2,u!==0&&(g-=2,a=u),g-(a<<1>>>31)}static numberOfLeadingZeros(a){if(a===0)return 32;let u=1;return a>>>16||(u+=16,a<<=16),a>>>24||(u+=8,a<<=8),a>>>28||(u+=4,a<<=4),a>>>30||(u+=2,a<<=2),u-=a>>>31,u}static toHexString(a){return a.toString(16)}static toBinaryString(a){return String(parseInt(String(a),2))}static bitCount(a){return a=a-(a>>>1&1431655765),a=(a&858993459)+(a>>>2&858993459),a=a+(a>>>4)&252645135,a=a+(a>>>8),a=a+(a>>>16),a&63}static truncDivision(a,u){return Math.trunc(a/u)}static parseInt(a,u=void 0){return parseInt(a,u)}}Ye.MIN_VALUE_32_BITS=-2147483648,Ye.MAX_VALUE=Number.MAX_SAFE_INTEGER;class pt{constructor(a,u){a===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=a,u==null?this.bits=pt.makeArray(a):this.bits=u)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(a){if(a>this.bits.length*32){const u=pt.makeArray(a);me.arraycopy(this.bits,0,u,0,this.bits.length),this.bits=u}}get(a){return(this.bits[Math.floor(a/32)]&1<<(a&31))!==0}set(a){this.bits[Math.floor(a/32)]|=1<<(a&31)}flip(a){this.bits[Math.floor(a/32)]^=1<<(a&31)}getNextSet(a){const u=this.size;if(a>=u)return u;const g=this.bits;let v=Math.floor(a/32),w=g[v];w&=~((1<<(a&31))-1);const I=g.length;for(;w===0;){if(++v===I)return u;w=g[v]}const O=v*32+Ye.numberOfTrailingZeros(w);return O>u?u:O}getNextUnset(a){const u=this.size;if(a>=u)return u;const g=this.bits;let v=Math.floor(a/32),w=~g[v];w&=~((1<<(a&31))-1);const I=g.length;for(;w===0;){if(++v===I)return u;w=~g[v]}const O=v*32+Ye.numberOfTrailingZeros(w);return O>u?u:O}setBulk(a,u){this.bits[Math.floor(a/32)]=u}setRange(a,u){if(u<a||a<0||u>this.size)throw new Q;if(u===a)return;u--;const g=Math.floor(a/32),v=Math.floor(u/32),w=this.bits;for(let I=g;I<=v;I++){const O=I>g?0:a&31,q=(2<<(I<v?31:u&31))-(1<<O);w[I]|=q}}clear(){const a=this.bits.length,u=this.bits;for(let g=0;g<a;g++)u[g]=0}isRange(a,u,g){if(u<a||a<0||u>this.size)throw new Q;if(u===a)return!0;u--;const v=Math.floor(a/32),w=Math.floor(u/32),I=this.bits;for(let O=v;O<=w;O++){const F=O>v?0:a&31,te=(2<<(O<w?31:u&31))-(1<<F)&4294967295;if((I[O]&te)!==(g?te:0))return!1}return!0}appendBit(a){this.ensureCapacity(this.size+1),a&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(a,u){if(u<0||u>32)throw new Q("Num bits must be between 0 and 32");this.ensureCapacity(this.size+u);for(let g=u;g>0;g--)this.appendBit((a>>g-1&1)===1)}appendBitArray(a){const u=a.size;this.ensureCapacity(this.size+u);for(let g=0;g<u;g++)this.appendBit(a.get(g))}xor(a){if(this.size!==a.size)throw new Q("Sizes don't match");const u=this.bits;for(let g=0,v=u.length;g<v;g++)u[g]^=a.bits[g]}toBytes(a,u,g,v){for(let w=0;w<v;w++){let I=0;for(let O=0;O<8;O++)this.get(a)&&(I|=1<<7-O),a++;u[g+w]=I}}getBitArray(){return this.bits}reverse(){const a=new Int32Array(this.bits.length),u=Math.floor((this.size-1)/32),g=u+1,v=this.bits;for(let w=0;w<g;w++){let I=v[w];I=I>>1&1431655765|(I&1431655765)<<1,I=I>>2&858993459|(I&858993459)<<2,I=I>>4&252645135|(I&252645135)<<4,I=I>>8&16711935|(I&16711935)<<8,I=I>>16&65535|(I&65535)<<16,a[u-w]=I}if(this.size!==g*32){const w=g*32-this.size;let I=a[0]>>>w;for(let O=1;O<g;O++){const F=a[O];I|=F<<32-w,a[O-1]=I,I=F>>>w}a[g-1]=I}this.bits=a}static makeArray(a){return new Int32Array(Math.floor((a+31)/32))}equals(a){if(!(a instanceof pt))return!1;const u=a;return this.size===u.size&&tt.equals(this.bits,u.bits)}hashCode(){return 31*this.size+tt.hashCode(this.bits)}toString(){let a="";for(let u=0,g=this.size;u<g;u++)(u&7)===0&&(a+=" "),a+=this.get(u)?"X":".";return a}clone(){return new pt(this.size,this.bits.slice())}}var Wt;(function(le){le[le.OTHER=0]="OTHER",le[le.PURE_BARCODE=1]="PURE_BARCODE",le[le.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",le[le.TRY_HARDER=3]="TRY_HARDER",le[le.CHARACTER_SET=4]="CHARACTER_SET",le[le.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",le[le.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",le[le.ASSUME_GS1=7]="ASSUME_GS1",le[le.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",le[le.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",le[le.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(Wt||(Wt={}));var Et=Wt;class it extends H{static getFormatInstance(){return new it}}it.kind="FormatException";var at;(function(le){le[le.Cp437=0]="Cp437",le[le.ISO8859_1=1]="ISO8859_1",le[le.ISO8859_2=2]="ISO8859_2",le[le.ISO8859_3=3]="ISO8859_3",le[le.ISO8859_4=4]="ISO8859_4",le[le.ISO8859_5=5]="ISO8859_5",le[le.ISO8859_6=6]="ISO8859_6",le[le.ISO8859_7=7]="ISO8859_7",le[le.ISO8859_8=8]="ISO8859_8",le[le.ISO8859_9=9]="ISO8859_9",le[le.ISO8859_10=10]="ISO8859_10",le[le.ISO8859_11=11]="ISO8859_11",le[le.ISO8859_13=12]="ISO8859_13",le[le.ISO8859_14=13]="ISO8859_14",le[le.ISO8859_15=14]="ISO8859_15",le[le.ISO8859_16=15]="ISO8859_16",le[le.SJIS=16]="SJIS",le[le.Cp1250=17]="Cp1250",le[le.Cp1251=18]="Cp1251",le[le.Cp1252=19]="Cp1252",le[le.Cp1256=20]="Cp1256",le[le.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",le[le.UTF8=22]="UTF8",le[le.ASCII=23]="ASCII",le[le.Big5=24]="Big5",le[le.GB18030=25]="GB18030",le[le.EUC_KR=26]="EUC_KR"})(at||(at={}));class He{constructor(a,u,g,...v){this.valueIdentifier=a,this.name=g,typeof u=="number"?this.values=Int32Array.from([u]):this.values=u,this.otherEncodingNames=v,He.VALUE_IDENTIFIER_TO_ECI.set(a,this),He.NAME_TO_ECI.set(g,this);const w=this.values;for(let I=0,O=w.length;I!==O;I++){const F=w[I];He.VALUES_TO_ECI.set(F,this)}for(const I of v)He.NAME_TO_ECI.set(I,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(a){if(a<0||a>=900)throw new it("incorect value");const u=He.VALUES_TO_ECI.get(a);if(u===void 0)throw new it("incorect value");return u}static getCharacterSetECIByName(a){const u=He.NAME_TO_ECI.get(a);if(u===void 0)throw new it("incorect value");return u}equals(a){if(!(a instanceof He))return!1;const u=a;return this.getName()===u.getName()}}He.VALUE_IDENTIFIER_TO_ECI=new Map,He.VALUES_TO_ECI=new Map,He.NAME_TO_ECI=new Map,He.Cp437=new He(at.Cp437,Int32Array.from([0,2]),"Cp437"),He.ISO8859_1=new He(at.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),He.ISO8859_2=new He(at.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),He.ISO8859_3=new He(at.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),He.ISO8859_4=new He(at.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),He.ISO8859_5=new He(at.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),He.ISO8859_6=new He(at.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),He.ISO8859_7=new He(at.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),He.ISO8859_8=new He(at.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),He.ISO8859_9=new He(at.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),He.ISO8859_10=new He(at.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),He.ISO8859_11=new He(at.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),He.ISO8859_13=new He(at.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),He.ISO8859_14=new He(at.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),He.ISO8859_15=new He(at.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),He.ISO8859_16=new He(at.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),He.SJIS=new He(at.SJIS,20,"SJIS","Shift_JIS"),He.Cp1250=new He(at.Cp1250,21,"Cp1250","windows-1250"),He.Cp1251=new He(at.Cp1251,22,"Cp1251","windows-1251"),He.Cp1252=new He(at.Cp1252,23,"Cp1252","windows-1252"),He.Cp1256=new He(at.Cp1256,24,"Cp1256","windows-1256"),He.UnicodeBigUnmarked=new He(at.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),He.UTF8=new He(at.UTF8,26,"UTF8","UTF-8"),He.ASCII=new He(at.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),He.Big5=new He(at.Big5,28,"Big5"),He.GB18030=new He(at.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),He.EUC_KR=new He(at.EUC_KR,30,"EUC_KR","EUC-KR");class xt extends H{}xt.kind="UnsupportedOperationException";class Pe{static decode(a,u){const g=this.encodingName(u);return this.customDecoder?this.customDecoder(a,g):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(g)?this.decodeFallback(a,g):new TextDecoder(g).decode(a)}static shouldDecodeOnFallback(a){return!Pe.isBrowser()&&a==="ISO-8859-1"}static encode(a,u){const g=this.encodingName(u);return this.customEncoder?this.customEncoder(a,g):typeof TextEncoder>"u"?this.encodeFallback(a):new TextEncoder().encode(a)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(a){return typeof a=="string"?a:a.getName()}static encodingCharacterSet(a){return a instanceof He?a:He.getCharacterSetECIByName(a)}static decodeFallback(a,u){const g=this.encodingCharacterSet(u);if(Pe.isDecodeFallbackSupported(g)){let v="";for(let w=0,I=a.length;w<I;w++){let O=a[w].toString(16);O.length<2&&(O="0"+O),v+="%"+O}return decodeURIComponent(v)}if(g.equals(He.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(a.buffer));throw new xt(`Encoding ${this.encodingName(u)} not supported by fallback.`)}static isDecodeFallbackSupported(a){return a.equals(He.UTF8)||a.equals(He.ISO8859_1)||a.equals(He.ASCII)}static encodeFallback(a){const g=btoa(unescape(encodeURIComponent(a))).split(""),v=[];for(let w=0;w<g.length;w++)v.push(g[w].charCodeAt(0));return new Uint8Array(v)}}class ct{static castAsNonUtf8Char(a,u=null){const g=u?u.getName():this.ISO88591;return Pe.decode(new Uint8Array([a]),g)}static guessEncoding(a,u){if(u!=null&&u.get(Et.CHARACTER_SET)!==void 0)return u.get(Et.CHARACTER_SET).toString();const g=a.length;let v=!0,w=!0,I=!0,O=0,F=0,q=0,te=0,ue=0,xe=0,ze=0,ot=0,ht=0,Dt=0,qt=0;const Sn=a.length>3&&a[0]===239&&a[1]===187&&a[2]===191;for(let wn=0;wn<g&&(v||w||I);wn++){const xn=a[wn]&255;I&&(O>0?(xn&128)===0?I=!1:O--:(xn&128)!==0&&((xn&64)===0?I=!1:(O++,(xn&32)===0?F++:(O++,(xn&16)===0?q++:(O++,(xn&8)===0?te++:I=!1))))),v&&(xn>127&&xn<160?v=!1:xn>159&&(xn<192||xn===215||xn===247)&&qt++),w&&(ue>0?xn<64||xn===127||xn>252?w=!1:ue--:xn===128||xn===160||xn>239?w=!1:xn>160&&xn<224?(xe++,ot=0,ze++,ze>ht&&(ht=ze)):xn>127?(ue++,ze=0,ot++,ot>Dt&&(Dt=ot)):(ze=0,ot=0))}return I&&O>0&&(I=!1),w&&ue>0&&(w=!1),I&&(Sn||F+q+te>0)?ct.UTF8:w&&(ct.ASSUME_SHIFT_JIS||ht>=3||Dt>=3)?ct.SHIFT_JIS:v&&w?ht===2&&xe===2||qt*10>=g?ct.SHIFT_JIS:ct.ISO88591:v?ct.ISO88591:w?ct.SHIFT_JIS:I?ct.UTF8:ct.PLATFORM_DEFAULT_ENCODING}static format(a,...u){let g=-1;function v(I,O,F,q,te,ue){if(I==="%%")return"%";if(u[++g]===void 0)return;I=q?parseInt(q.substr(1)):void 0;let xe=te?parseInt(te.substr(1)):void 0,ze;switch(ue){case"s":ze=u[g];break;case"c":ze=u[g][0];break;case"f":ze=parseFloat(u[g]).toFixed(I);break;case"p":ze=parseFloat(u[g]).toPrecision(I);break;case"e":ze=parseFloat(u[g]).toExponential(I);break;case"x":ze=parseInt(u[g]).toString(xe||16);break;case"d":ze=parseFloat(parseInt(u[g],xe||10).toPrecision(I)).toFixed(0);break}ze=typeof ze=="object"?JSON.stringify(ze):(+ze).toString(xe);let ot=parseInt(F),ht=F&&F[0]+""=="0"?"0":" ";for(;ze.length<ot;)ze=O!==void 0?ze+ht:ht+ze;return ze}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return a.replace(w,v)}static getBytes(a,u){return Pe.encode(a,u)}static getCharCode(a,u=0){return a.charCodeAt(u)}static getCharAt(a){return String.fromCharCode(a)}}ct.SHIFT_JIS=He.SJIS.getName(),ct.GB2312="GB2312",ct.ISO88591=He.ISO8859_1.getName(),ct.EUC_JP="EUC_JP",ct.UTF8=He.UTF8.getName(),ct.PLATFORM_DEFAULT_ENCODING=ct.UTF8,ct.ASSUME_SHIFT_JIS=!1;class vt{constructor(a=""){this.value=a}enableDecoding(a){return this.encoding=a,this}append(a){return typeof a=="string"?this.value+=a.toString():this.encoding?this.value+=ct.castAsNonUtf8Char(a,this.encoding):this.value+=String.fromCharCode(a),this}appendChars(a,u,g){for(let v=u;u<u+g;v++)this.append(a[v]);return this}length(){return this.value.length}charAt(a){return this.value.charAt(a)}deleteCharAt(a){this.value=this.value.substr(0,a)+this.value.substring(a+1)}setCharAt(a,u){this.value=this.value.substr(0,a)+u+this.value.substr(a+1)}substring(a,u){return this.value.substring(a,u)}setLengthToZero(){this.value=""}toString(){return this.value}insert(a,u){this.value=this.value.substr(0,a)+u+this.value.substr(a+u.length)}}class Zt{constructor(a,u,g,v){if(this.width=a,this.height=u,this.rowSize=g,this.bits=v,u==null&&(u=a),this.height=u,a<1||u<1)throw new Q("Both dimensions must be greater than 0");g==null&&(g=Math.floor((a+31)/32)),this.rowSize=g,v==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(a){const u=a.length,g=a[0].length,v=new Zt(g,u);for(let w=0;w<u;w++){const I=a[w];for(let O=0;O<g;O++)I[O]&&v.set(O,w)}return v}static parseFromString(a,u,g){if(a===null)throw new Q("stringRepresentation cannot be null");const v=new Array(a.length);let w=0,I=0,O=-1,F=0,q=0;for(;q<a.length;)if(a.charAt(q)===`
`||a.charAt(q)==="\r"){if(w>I){if(O===-1)O=w-I;else if(w-I!==O)throw new Q("row lengths do not match");I=w,F++}q++}else if(a.substring(q,q+u.length)===u)q+=u.length,v[w]=!0,w++;else if(a.substring(q,q+g.length)===g)q+=g.length,v[w]=!1,w++;else throw new Q("illegal character encountered: "+a.substring(q));if(w>I){if(O===-1)O=w-I;else if(w-I!==O)throw new Q("row lengths do not match");F++}const te=new Zt(O,F);for(let ue=0;ue<w;ue++)v[ue]&&te.set(Math.floor(ue%O),Math.floor(ue/O));return te}get(a,u){const g=u*this.rowSize+Math.floor(a/32);return(this.bits[g]>>>(a&31)&1)!==0}set(a,u){const g=u*this.rowSize+Math.floor(a/32);this.bits[g]|=1<<(a&31)&4294967295}unset(a,u){const g=u*this.rowSize+Math.floor(a/32);this.bits[g]&=~(1<<(a&31)&4294967295)}flip(a,u){const g=u*this.rowSize+Math.floor(a/32);this.bits[g]^=1<<(a&31)&4294967295}xor(a){if(this.width!==a.getWidth()||this.height!==a.getHeight()||this.rowSize!==a.getRowSize())throw new Q("input matrix dimensions do not match");const u=new pt(Math.floor(this.width/32)+1),g=this.rowSize,v=this.bits;for(let w=0,I=this.height;w<I;w++){const O=w*g,F=a.getRow(w,u).getBitArray();for(let q=0;q<g;q++)v[O+q]^=F[q]}}clear(){const a=this.bits,u=a.length;for(let g=0;g<u;g++)a[g]=0}setRegion(a,u,g,v){if(u<0||a<0)throw new Q("Left and top must be nonnegative");if(v<1||g<1)throw new Q("Height and width must be at least 1");const w=a+g,I=u+v;if(I>this.height||w>this.width)throw new Q("The region must fit inside the matrix");const O=this.rowSize,F=this.bits;for(let q=u;q<I;q++){const te=q*O;for(let ue=a;ue<w;ue++)F[te+Math.floor(ue/32)]|=1<<(ue&31)&4294967295}}getRow(a,u){u==null||u.getSize()<this.width?u=new pt(this.width):u.clear();const g=this.rowSize,v=this.bits,w=a*g;for(let I=0;I<g;I++)u.setBulk(I*32,v[w+I]);return u}setRow(a,u){me.arraycopy(u.getBitArray(),0,this.bits,a*this.rowSize,this.rowSize)}rotate180(){const a=this.getWidth(),u=this.getHeight();let g=new pt(a),v=new pt(a);for(let w=0,I=Math.floor((u+1)/2);w<I;w++)g=this.getRow(w,g),v=this.getRow(u-1-w,v),g.reverse(),v.reverse(),this.setRow(w,v),this.setRow(u-1-w,g)}getEnclosingRectangle(){const a=this.width,u=this.height,g=this.rowSize,v=this.bits;let w=a,I=u,O=-1,F=-1;for(let q=0;q<u;q++)for(let te=0;te<g;te++){const ue=v[q*g+te];if(ue!==0){if(q<I&&(I=q),q>F&&(F=q),te*32<w){let xe=0;for(;(ue<<31-xe&4294967295)===0;)xe++;te*32+xe<w&&(w=te*32+xe)}if(te*32+31>O){let xe=31;for(;!(ue>>>xe);)xe--;te*32+xe>O&&(O=te*32+xe)}}}return O<w||F<I?null:Int32Array.from([w,I,O-w+1,F-I+1])}getTopLeftOnBit(){const a=this.rowSize,u=this.bits;let g=0;for(;g<u.length&&u[g]===0;)g++;if(g===u.length)return null;const v=g/a;let w=g%a*32;const I=u[g];let O=0;for(;(I<<31-O&4294967295)===0;)O++;return w+=O,Int32Array.from([w,v])}getBottomRightOnBit(){const a=this.rowSize,u=this.bits;let g=u.length-1;for(;g>=0&&u[g]===0;)g--;if(g<0)return null;const v=Math.floor(g/a);let w=Math.floor(g%a)*32;const I=u[g];let O=31;for(;!(I>>>O);)O--;return w+=O,Int32Array.from([w,v])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(a){if(!(a instanceof Zt))return!1;const u=a;return this.width===u.width&&this.height===u.height&&this.rowSize===u.rowSize&&tt.equals(this.bits,u.bits)}hashCode(){let a=this.width;return a=31*a+this.width,a=31*a+this.height,a=31*a+this.rowSize,a=31*a+tt.hashCode(this.bits),a}toString(a="X ",u="  ",g=`
`){return this.buildToString(a,u,g)}buildToString(a,u,g){let v=new vt;for(let w=0,I=this.height;w<I;w++){for(let O=0,F=this.width;O<F;O++)v.append(this.get(O,w)?a:u);v.append(g)}return v.toString()}clone(){return new Zt(this.width,this.height,this.rowSize,this.bits.slice())}}class Ne extends H{static getNotFoundInstance(){return new Ne}}Ne.kind="NotFoundException";class Te extends ve{constructor(a){super(a),this.luminances=Te.EMPTY,this.buckets=new Int32Array(Te.LUMINANCE_BUCKETS)}getBlackRow(a,u){const g=this.getLuminanceSource(),v=g.getWidth();u==null||u.getSize()<v?u=new pt(v):u.clear(),this.initArrays(v);const w=g.getRow(a,this.luminances),I=this.buckets;for(let F=0;F<v;F++)I[(w[F]&255)>>Te.LUMINANCE_SHIFT]++;const O=Te.estimateBlackPoint(I);if(v<3)for(let F=0;F<v;F++)(w[F]&255)<O&&u.set(F);else{let F=w[0]&255,q=w[1]&255;for(let te=1;te<v-1;te++){const ue=w[te+1]&255;(q*4-F-ue)/2<O&&u.set(te),F=q,q=ue}}return u}getBlackMatrix(){const a=this.getLuminanceSource(),u=a.getWidth(),g=a.getHeight(),v=new Zt(u,g);this.initArrays(u);const w=this.buckets;for(let F=1;F<5;F++){const q=Math.floor(g*F/5),te=a.getRow(q,this.luminances),ue=Math.floor(u*4/5);for(let xe=Math.floor(u/5);xe<ue;xe++){const ze=te[xe]&255;w[ze>>Te.LUMINANCE_SHIFT]++}}const I=Te.estimateBlackPoint(w),O=a.getMatrix();for(let F=0;F<g;F++){const q=F*u;for(let te=0;te<u;te++)(O[q+te]&255)<I&&v.set(te,F)}return v}createBinarizer(a){return new Te(a)}initArrays(a){this.luminances.length<a&&(this.luminances=new Uint8ClampedArray(a));const u=this.buckets;for(let g=0;g<Te.LUMINANCE_BUCKETS;g++)u[g]=0}static estimateBlackPoint(a){const u=a.length;let g=0,v=0,w=0;for(let te=0;te<u;te++)a[te]>w&&(v=te,w=a[te]),a[te]>g&&(g=a[te]);let I=0,O=0;for(let te=0;te<u;te++){const ue=te-v,xe=a[te]*ue*ue;xe>O&&(I=te,O=xe)}if(v>I){const te=v;v=I,I=te}if(I-v<=u/16)throw new Ne;let F=I-1,q=-1;for(let te=I-1;te>v;te--){const ue=te-v,xe=ue*ue*(I-te)*(g-a[te]);xe>q&&(F=te,q=xe)}return F<<Te.LUMINANCE_SHIFT}}Te.LUMINANCE_BITS=5,Te.LUMINANCE_SHIFT=8-Te.LUMINANCE_BITS,Te.LUMINANCE_BUCKETS=1<<Te.LUMINANCE_BITS,Te.EMPTY=Uint8ClampedArray.from([0]);class We extends Te{constructor(a){super(a),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const a=this.getLuminanceSource(),u=a.getWidth(),g=a.getHeight();if(u>=We.MINIMUM_DIMENSION&&g>=We.MINIMUM_DIMENSION){const v=a.getMatrix();let w=u>>We.BLOCK_SIZE_POWER;(u&We.BLOCK_SIZE_MASK)!==0&&w++;let I=g>>We.BLOCK_SIZE_POWER;(g&We.BLOCK_SIZE_MASK)!==0&&I++;const O=We.calculateBlackPoints(v,w,I,u,g),F=new Zt(u,g);We.calculateThresholdForBlock(v,w,I,u,g,O,F),this.matrix=F}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(a){return new We(a)}static calculateThresholdForBlock(a,u,g,v,w,I,O){const F=w-We.BLOCK_SIZE,q=v-We.BLOCK_SIZE;for(let te=0;te<g;te++){let ue=te<<We.BLOCK_SIZE_POWER;ue>F&&(ue=F);const xe=We.cap(te,2,g-3);for(let ze=0;ze<u;ze++){let ot=ze<<We.BLOCK_SIZE_POWER;ot>q&&(ot=q);const ht=We.cap(ze,2,u-3);let Dt=0;for(let Sn=-2;Sn<=2;Sn++){const wn=I[xe+Sn];Dt+=wn[ht-2]+wn[ht-1]+wn[ht]+wn[ht+1]+wn[ht+2]}const qt=Dt/25;We.thresholdBlock(a,ot,ue,qt,v,O)}}}static cap(a,u,g){return a<u?u:a>g?g:a}static thresholdBlock(a,u,g,v,w,I){for(let O=0,F=g*w+u;O<We.BLOCK_SIZE;O++,F+=w)for(let q=0;q<We.BLOCK_SIZE;q++)(a[F+q]&255)<=v&&I.set(u+q,g+O)}static calculateBlackPoints(a,u,g,v,w){const I=w-We.BLOCK_SIZE,O=v-We.BLOCK_SIZE,F=new Array(g);for(let q=0;q<g;q++){F[q]=new Int32Array(u);let te=q<<We.BLOCK_SIZE_POWER;te>I&&(te=I);for(let ue=0;ue<u;ue++){let xe=ue<<We.BLOCK_SIZE_POWER;xe>O&&(xe=O);let ze=0,ot=255,ht=0;for(let qt=0,Sn=te*v+xe;qt<We.BLOCK_SIZE;qt++,Sn+=v){for(let wn=0;wn<We.BLOCK_SIZE;wn++){const xn=a[Sn+wn]&255;ze+=xn,xn<ot&&(ot=xn),xn>ht&&(ht=xn)}if(ht-ot>We.MIN_DYNAMIC_RANGE)for(qt++,Sn+=v;qt<We.BLOCK_SIZE;qt++,Sn+=v)for(let wn=0;wn<We.BLOCK_SIZE;wn++)ze+=a[Sn+wn]&255}let Dt=ze>>We.BLOCK_SIZE_POWER*2;if(ht-ot<=We.MIN_DYNAMIC_RANGE&&(Dt=ot/2,q>0&&ue>0)){const qt=(F[q-1][ue]+2*F[q][ue-1]+F[q-1][ue-1])/4;ot<qt&&(Dt=qt)}F[q][ue]=Dt}}return F}}We.BLOCK_SIZE_POWER=3,We.BLOCK_SIZE=1<<We.BLOCK_SIZE_POWER,We.BLOCK_SIZE_MASK=We.BLOCK_SIZE-1,We.MINIMUM_DIMENSION=We.BLOCK_SIZE*5,We.MIN_DYNAMIC_RANGE=24;class wt{constructor(a,u){this.width=a,this.height=u}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(a,u,g,v){throw new xt("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new xt("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new xt("This luminance source does not support rotation by 45 degrees.")}toString(){const a=new Uint8ClampedArray(this.width);let u=new vt;for(let g=0;g<this.height;g++){const v=this.getRow(g,a);for(let w=0;w<this.width;w++){const I=v[w]&255;let O;I<64?O="#":I<128?O="+":I<192?O=".":O=" ",u.append(O)}u.append(`
`)}return u.toString()}}class zt extends wt{constructor(a){super(a.getWidth(),a.getHeight()),this.delegate=a}getRow(a,u){const g=this.delegate.getRow(a,u),v=this.getWidth();for(let w=0;w<v;w++)g[w]=255-(g[w]&255);return g}getMatrix(){const a=this.delegate.getMatrix(),u=this.getWidth()*this.getHeight(),g=new Uint8ClampedArray(u);for(let v=0;v<u;v++)g[v]=255-(a[v]&255);return g}isCropSupported(){return this.delegate.isCropSupported()}crop(a,u,g,v){return new zt(this.delegate.crop(a,u,g,v))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new zt(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new zt(this.delegate.rotateCounterClockwise45())}}class Gt extends wt{constructor(a){super(a.width,a.height),this.canvas=a,this.tempCanvasElement=null,this.buffer=Gt.makeBufferFromCanvasImageData(a)}static makeBufferFromCanvasImageData(a){const u=a.getContext("2d").getImageData(0,0,a.width,a.height);return Gt.toGrayscaleBuffer(u.data,a.width,a.height)}static toGrayscaleBuffer(a,u,g){const v=new Uint8ClampedArray(u*g);for(let w=0,I=0,O=a.length;w<O;w+=4,I++){let F;if(a[w+3]===0)F=255;else{const te=a[w],ue=a[w+1],xe=a[w+2];F=306*te+601*ue+117*xe+512>>10}v[I]=F}return v}getRow(a,u){if(a<0||a>=this.getHeight())throw new Q("Requested row is outside the image: "+a);const g=this.getWidth(),v=a*g;return u===null?u=this.buffer.slice(v,v+g):(u.length<g&&(u=new Uint8ClampedArray(g)),u.set(this.buffer.slice(v,v+g))),u}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(a,u,g,v){return super.crop(a,u,g,v),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const a=this.canvas.ownerDocument.createElement("canvas");a.width=this.canvas.width,a.height=this.canvas.height,this.tempCanvasElement=a}return this.tempCanvasElement}rotate(a){const u=this.getTempCanvasElement(),g=u.getContext("2d"),v=a*Gt.DEGREE_TO_RADIANS,w=this.canvas.width,I=this.canvas.height,O=Math.ceil(Math.abs(Math.cos(v))*w+Math.abs(Math.sin(v))*I),F=Math.ceil(Math.abs(Math.sin(v))*w+Math.abs(Math.cos(v))*I);return u.width=O,u.height=F,g.translate(O/2,F/2),g.rotate(v),g.drawImage(this.canvas,w/-2,I/-2),this.buffer=Gt.makeBufferFromCanvasImageData(u),this}invert(){return new zt(this)}}Gt.DEGREE_TO_RADIANS=Math.PI/180;class ke{constructor(a,u,g){this.deviceId=a,this.label=u,this.kind="videoinput",this.groupId=g||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var nt=(globalThis||Vm||self||window||void 0)&&(globalThis||Vm||self||window||void 0).__awaiter||function(le,a,u,g){function v(w){return w instanceof u?w:new u(function(I){I(w)})}return new(u||(u=Promise))(function(w,I){function O(te){try{q(g.next(te))}catch(ue){I(ue)}}function F(te){try{q(g.throw(te))}catch(ue){I(ue)}}function q(te){te.done?w(te.value):v(te.value).then(O,F)}q((g=g.apply(le,a||[])).next())})};class Nt{constructor(a,u=500,g){this.reader=a,this.timeBetweenScansMillis=u,this._hints=g,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(a){this._timeBetweenDecodingAttempts=a<0?0:a}set hints(a){this._hints=a||null}get hints(){return this._hints}listVideoInputDevices(){return nt(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const a=yield navigator.mediaDevices.enumerateDevices(),u=[];for(const g of a){const v=g.kind==="video"?"videoinput":g.kind;if(v!=="videoinput")continue;const w=g.deviceId||g.id,I=g.label||`Video device ${u.length+1}`,O=g.groupId,F={deviceId:w,label:I,kind:v,groupId:O};u.push(F)}return u})}getVideoInputDevices(){return nt(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(u=>new ke(u.deviceId,u.label))})}findDeviceById(a){return nt(this,void 0,void 0,function*(){const u=yield this.listVideoInputDevices();return u?u.find(g=>g.deviceId===a):null})}decodeFromInputVideoDevice(a,u){return nt(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(a,u)})}decodeOnceFromVideoDevice(a,u){return nt(this,void 0,void 0,function*(){this.reset();let g;a?g={deviceId:{exact:a}}:g={facingMode:"environment"};const v={video:g};return yield this.decodeOnceFromConstraints(v,u)})}decodeOnceFromConstraints(a,u){return nt(this,void 0,void 0,function*(){const g=yield navigator.mediaDevices.getUserMedia(a);return yield this.decodeOnceFromStream(g,u)})}decodeOnceFromStream(a,u){return nt(this,void 0,void 0,function*(){this.reset();const g=yield this.attachStreamToVideo(a,u);return yield this.decodeOnce(g)})}decodeFromInputVideoDeviceContinuously(a,u,g){return nt(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(a,u,g)})}decodeFromVideoDevice(a,u,g){return nt(this,void 0,void 0,function*(){let v;a?v={deviceId:{exact:a}}:v={facingMode:"environment"};const w={video:v};return yield this.decodeFromConstraints(w,u,g)})}decodeFromConstraints(a,u,g){return nt(this,void 0,void 0,function*(){const v=yield navigator.mediaDevices.getUserMedia(a);return yield this.decodeFromStream(v,u,g)})}decodeFromStream(a,u,g){return nt(this,void 0,void 0,function*(){this.reset();const v=yield this.attachStreamToVideo(a,u);return yield this.decodeContinuously(v,g)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(a,u){return nt(this,void 0,void 0,function*(){const g=this.prepareVideoElement(u);return this.addVideoSource(g,a),this.videoElement=g,this.stream=a,yield this.playVideoOnLoadAsync(g),g})}playVideoOnLoadAsync(a){return new Promise((u,g)=>this.playVideoOnLoad(a,()=>u()))}playVideoOnLoad(a,u){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(a),a.addEventListener("ended",this.videoEndedListener),a.addEventListener("canplay",this.videoCanPlayListener),a.addEventListener("playing",u),this.tryPlayVideo(a)}isVideoPlaying(a){return a.currentTime>0&&!a.paused&&!a.ended&&a.readyState>2}tryPlayVideo(a){return nt(this,void 0,void 0,function*(){if(this.isVideoPlaying(a)){console.warn("Trying to play video that is already playing.");return}try{yield a.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(a,u){const g=document.getElementById(a);if(!g)throw new Y(`element with id '${a}' not found`);if(g.nodeName.toLowerCase()!==u.toLowerCase())throw new Y(`element with id '${a}' must be an ${u} element`);return g}decodeFromImage(a,u){if(!a&&!u)throw new Y("either imageElement with a src set or an url must be provided");return u&&!a?this.decodeFromImageUrl(u):this.decodeFromImageElement(a)}decodeFromVideo(a,u){if(!a&&!u)throw new Y("Either an element with a src set or an URL must be provided");return u&&!a?this.decodeFromVideoUrl(u):this.decodeFromVideoElement(a)}decodeFromVideoContinuously(a,u,g){if(a===void 0&&u===void 0)throw new Y("Either an element with a src set or an URL must be provided");return u&&!a?this.decodeFromVideoUrlContinuously(u,g):this.decodeFromVideoElementContinuously(a,g)}decodeFromImageElement(a){if(!a)throw new Y("An image element must be provided.");this.reset();const u=this.prepareImageElement(a);this.imageElement=u;let g;return this.isImageLoaded(u)?g=this.decodeOnce(u,!1,!0):g=this._decodeOnLoadImage(u),g}decodeFromVideoElement(a){const u=this._decodeFromVideoElementSetup(a);return this._decodeOnLoadVideo(u)}decodeFromVideoElementContinuously(a,u){const g=this._decodeFromVideoElementSetup(a);return this._decodeOnLoadVideoContinuously(g,u)}_decodeFromVideoElementSetup(a){if(!a)throw new Y("A video element must be provided.");this.reset();const u=this.prepareVideoElement(a);return this.videoElement=u,u}decodeFromImageUrl(a){if(!a)throw new Y("An URL must be provided.");this.reset();const u=this.prepareImageElement();this.imageElement=u;const g=this._decodeOnLoadImage(u);return u.src=a,g}decodeFromVideoUrl(a){if(!a)throw new Y("An URL must be provided.");this.reset();const u=this.prepareVideoElement(),g=this.decodeFromVideoElement(u);return u.src=a,g}decodeFromVideoUrlContinuously(a,u){if(!a)throw new Y("An URL must be provided.");this.reset();const g=this.prepareVideoElement(),v=this.decodeFromVideoElementContinuously(g,u);return g.src=a,v}_decodeOnLoadImage(a){return new Promise((u,g)=>{this.imageLoadedListener=()=>this.decodeOnce(a,!1,!0).then(u,g),a.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(a){return nt(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(a),yield this.decodeOnce(a)})}_decodeOnLoadVideoContinuously(a,u){return nt(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(a),this.decodeContinuously(a,u)})}isImageLoaded(a){return!(!a.complete||a.naturalWidth===0)}prepareImageElement(a){let u;return typeof a>"u"&&(u=document.createElement("img"),u.width=200,u.height=200),typeof a=="string"&&(u=this.getMediaElement(a,"img")),a instanceof HTMLImageElement&&(u=a),u}prepareVideoElement(a){let u;return!a&&typeof document<"u"&&(u=document.createElement("video"),u.width=200,u.height=200),typeof a=="string"&&(u=this.getMediaElement(a,"video")),a instanceof HTMLVideoElement&&(u=a),u.setAttribute("autoplay","true"),u.setAttribute("muted","true"),u.setAttribute("playsinline","true"),u}decodeOnce(a,u=!0,g=!0){this._stopAsyncDecode=!1;const v=(w,I)=>{if(this._stopAsyncDecode){I(new Ne("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const O=this.decode(a);w(O)}catch(O){const F=u&&O instanceof Ne,te=(O instanceof we||O instanceof it)&&g;if(F||te)return setTimeout(v,this._timeBetweenDecodingAttempts,w,I);I(O)}};return new Promise((w,I)=>v(w,I))}decodeContinuously(a,u){this._stopContinuousDecode=!1;const g=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const v=this.decode(a);u(v,null),setTimeout(g,this.timeBetweenScansMillis)}catch(v){u(null,v);const w=v instanceof we||v instanceof it,I=v instanceof Ne;(w||I)&&setTimeout(g,this._timeBetweenDecodingAttempts)}};g()}decode(a){const u=this.createBinaryBitmap(a);return this.decodeBitmap(u)}_isHTMLVideoElement(a){return a.videoWidth!==0}drawFrameOnCanvas(a,u,g){u||(u={sx:0,sy:0,sWidth:a.videoWidth,sHeight:a.videoHeight,dx:0,dy:0,dWidth:a.videoWidth,dHeight:a.videoHeight}),g||(g=this.captureCanvasContext),g.drawImage(a,u.sx,u.sy,u.sWidth,u.sHeight,u.dx,u.dy,u.dWidth,u.dHeight)}drawImageOnCanvas(a,u,g=this.captureCanvasContext){u||(u={sx:0,sy:0,sWidth:a.naturalWidth,sHeight:a.naturalHeight,dx:0,dy:0,dWidth:a.naturalWidth,dHeight:a.naturalHeight}),g||(g=this.captureCanvasContext),g.drawImage(a,u.sx,u.sy,u.sWidth,u.sHeight,u.dx,u.dy,u.dWidth,u.dHeight)}createBinaryBitmap(a){this.getCaptureCanvasContext(a),this._isHTMLVideoElement(a)?this.drawFrameOnCanvas(a):this.drawImageOnCanvas(a);const u=this.getCaptureCanvas(a),g=new Gt(u),v=new We(g);return new _e(v)}getCaptureCanvasContext(a){if(!this.captureCanvasContext){const g=this.getCaptureCanvas(a).getContext("2d");this.captureCanvasContext=g}return this.captureCanvasContext}getCaptureCanvas(a){if(!this.captureCanvas){const u=this.createCaptureCanvas(a);this.captureCanvas=u}return this.captureCanvas}decodeBitmap(a){return this.reader.decode(a,this._hints)}createCaptureCanvas(a){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const u=document.createElement("canvas");let g,v;return typeof a<"u"&&(a instanceof HTMLVideoElement?(g=a.videoWidth,v=a.videoHeight):a instanceof HTMLImageElement&&(g=a.naturalWidth||a.width,v=a.naturalHeight||a.height)),u.style.width=g+"px",u.style.height=v+"px",u.width=g,u.height=v,u}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(a=>a.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(a,u){try{a.srcObject=u}catch{a.src=URL.createObjectURL(u)}}cleanVideoSource(a){try{a.srcObject=null}catch{a.src=""}this.videoElement.removeAttribute("src")}}class _t{constructor(a,u,g=u==null?0:8*u.length,v,w,I=me.currentTimeMillis()){this.text=a,this.rawBytes=u,this.numBits=g,this.resultPoints=v,this.format=w,this.timestamp=I,this.text=a,this.rawBytes=u,g==null?this.numBits=u==null?0:8*u.length:this.numBits=g,this.resultPoints=v,this.format=w,this.resultMetadata=null,I==null?this.timestamp=me.currentTimeMillis():this.timestamp=I}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(a,u){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(a,u)}putAllMetadata(a){a!==null&&(this.resultMetadata===null?this.resultMetadata=a:this.resultMetadata=new Map(a))}addResultPoints(a){const u=this.resultPoints;if(u===null)this.resultPoints=a;else if(a!==null&&a.length>0){const g=new Array(u.length+a.length);me.arraycopy(u,0,g,0,u.length),me.arraycopy(a,0,g,u.length,a.length),this.resultPoints=g}}getTimestamp(){return this.timestamp}toString(){return this.text}}var tn;(function(le){le[le.AZTEC=0]="AZTEC",le[le.CODABAR=1]="CODABAR",le[le.CODE_39=2]="CODE_39",le[le.CODE_93=3]="CODE_93",le[le.CODE_128=4]="CODE_128",le[le.DATA_MATRIX=5]="DATA_MATRIX",le[le.EAN_8=6]="EAN_8",le[le.EAN_13=7]="EAN_13",le[le.ITF=8]="ITF",le[le.MAXICODE=9]="MAXICODE",le[le.PDF_417=10]="PDF_417",le[le.QR_CODE=11]="QR_CODE",le[le.RSS_14=12]="RSS_14",le[le.RSS_EXPANDED=13]="RSS_EXPANDED",le[le.UPC_A=14]="UPC_A",le[le.UPC_E=15]="UPC_E",le[le.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(tn||(tn={}));var Bt=tn,Kt;(function(le){le[le.OTHER=0]="OTHER",le[le.ORIENTATION=1]="ORIENTATION",le[le.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",le[le.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",le[le.ISSUE_NUMBER=4]="ISSUE_NUMBER",le[le.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",le[le.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",le[le.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",le[le.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",le[le.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",le[le.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Kt||(Kt={}));var an=Kt;class sn{constructor(a,u,g,v,w=-1,I=-1){this.rawBytes=a,this.text=u,this.byteSegments=g,this.ecLevel=v,this.structuredAppendSequenceNumber=w,this.structuredAppendParity=I,this.numBits=a==null?0:8*a.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(a){this.numBits=a}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(a){this.errorsCorrected=a}getErasures(){return this.erasures}setErasures(a){this.erasures=a}getOther(){return this.other}setOther(a){this.other=a}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Nn{exp(a){return this.expTable[a]}log(a){if(a===0)throw new Q;return this.logTable[a]}static addOrSubtract(a,u){return a^u}}class Dn{constructor(a,u){if(u.length===0)throw new Q;this.field=a;const g=u.length;if(g>1&&u[0]===0){let v=1;for(;v<g&&u[v]===0;)v++;v===g?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(g-v),me.arraycopy(u,v,this.coefficients,0,this.coefficients.length))}else this.coefficients=u}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(a){return this.coefficients[this.coefficients.length-1-a]}evaluateAt(a){if(a===0)return this.getCoefficient(0);const u=this.coefficients;let g;if(a===1){g=0;for(let I=0,O=u.length;I!==O;I++){const F=u[I];g=Nn.addOrSubtract(g,F)}return g}g=u[0];const v=u.length,w=this.field;for(let I=1;I<v;I++)g=Nn.addOrSubtract(w.multiply(a,g),u[I]);return g}addOrSubtract(a){if(!this.field.equals(a.field))throw new Q("GenericGFPolys do not have same GenericGF field");if(this.isZero())return a;if(a.isZero())return this;let u=this.coefficients,g=a.coefficients;if(u.length>g.length){const I=u;u=g,g=I}let v=new Int32Array(g.length);const w=g.length-u.length;me.arraycopy(g,0,v,0,w);for(let I=w;I<g.length;I++)v[I]=Nn.addOrSubtract(u[I-w],g[I]);return new Dn(this.field,v)}multiply(a){if(!this.field.equals(a.field))throw new Q("GenericGFPolys do not have same GenericGF field");if(this.isZero()||a.isZero())return this.field.getZero();const u=this.coefficients,g=u.length,v=a.coefficients,w=v.length,I=new Int32Array(g+w-1),O=this.field;for(let F=0;F<g;F++){const q=u[F];for(let te=0;te<w;te++)I[F+te]=Nn.addOrSubtract(I[F+te],O.multiply(q,v[te]))}return new Dn(O,I)}multiplyScalar(a){if(a===0)return this.field.getZero();if(a===1)return this;const u=this.coefficients.length,g=this.field,v=new Int32Array(u),w=this.coefficients;for(let I=0;I<u;I++)v[I]=g.multiply(w[I],a);return new Dn(g,v)}multiplyByMonomial(a,u){if(a<0)throw new Q;if(u===0)return this.field.getZero();const g=this.coefficients,v=g.length,w=new Int32Array(v+a),I=this.field;for(let O=0;O<v;O++)w[O]=I.multiply(g[O],u);return new Dn(I,w)}divide(a){if(!this.field.equals(a.field))throw new Q("GenericGFPolys do not have same GenericGF field");if(a.isZero())throw new Q("Divide by 0");const u=this.field;let g=u.getZero(),v=this;const w=a.getCoefficient(a.getDegree()),I=u.inverse(w);for(;v.getDegree()>=a.getDegree()&&!v.isZero();){const O=v.getDegree()-a.getDegree(),F=u.multiply(v.getCoefficient(v.getDegree()),I),q=a.multiplyByMonomial(O,F),te=u.buildMonomial(O,F);g=g.addOrSubtract(te),v=v.addOrSubtract(q)}return[g,v]}toString(){let a="";for(let u=this.getDegree();u>=0;u--){let g=this.getCoefficient(u);if(g!==0){if(g<0?(a+=" - ",g=-g):a.length>0&&(a+=" + "),u===0||g!==1){const v=this.field.log(g);v===0?a+="1":v===1?a+="a":(a+="a^",a+=v)}u!==0&&(u===1?a+="x":(a+="x^",a+=u))}}return a}}class si extends H{}si.kind="ArithmeticException";class kn extends Nn{constructor(a,u,g){super(),this.primitive=a,this.size=u,this.generatorBase=g;const v=new Int32Array(u);let w=1;for(let O=0;O<u;O++)v[O]=w,w*=2,w>=u&&(w^=a,w&=u-1);this.expTable=v;const I=new Int32Array(u);for(let O=0;O<u-1;O++)I[v[O]]=O;this.logTable=I,this.zero=new Dn(this,Int32Array.from([0])),this.one=new Dn(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(a,u){if(a<0)throw new Q;if(u===0)return this.zero;const g=new Int32Array(a+1);return g[0]=u,new Dn(this,g)}inverse(a){if(a===0)throw new si;return this.expTable[this.size-this.logTable[a]-1]}multiply(a,u){return a===0||u===0?0:this.expTable[(this.logTable[a]+this.logTable[u])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+Ye.toHexString(this.primitive)+","+this.size+")"}equals(a){return a===this}}kn.AZTEC_DATA_12=new kn(4201,4096,1),kn.AZTEC_DATA_10=new kn(1033,1024,1),kn.AZTEC_DATA_6=new kn(67,64,1),kn.AZTEC_PARAM=new kn(19,16,1),kn.QR_CODE_FIELD_256=new kn(285,256,0),kn.DATA_MATRIX_FIELD_256=new kn(301,256,1),kn.AZTEC_DATA_8=kn.DATA_MATRIX_FIELD_256,kn.MAXICODE_FIELD_64=kn.AZTEC_DATA_6;class ui extends H{}ui.kind="ReedSolomonException";class _i extends H{}_i.kind="IllegalStateException";class Di{constructor(a){this.field=a}decode(a,u){const g=this.field,v=new Dn(g,a),w=new Int32Array(u);let I=!0;for(let ze=0;ze<u;ze++){const ot=v.evaluateAt(g.exp(ze+g.getGeneratorBase()));w[w.length-1-ze]=ot,ot!==0&&(I=!1)}if(I)return;const O=new Dn(g,w),F=this.runEuclideanAlgorithm(g.buildMonomial(u,1),O,u),q=F[0],te=F[1],ue=this.findErrorLocations(q),xe=this.findErrorMagnitudes(te,ue);for(let ze=0;ze<ue.length;ze++){const ot=a.length-1-g.log(ue[ze]);if(ot<0)throw new ui("Bad error location");a[ot]=kn.addOrSubtract(a[ot],xe[ze])}}runEuclideanAlgorithm(a,u,g){if(a.getDegree()<u.getDegree()){const ze=a;a=u,u=ze}const v=this.field;let w=a,I=u,O=v.getZero(),F=v.getOne();for(;I.getDegree()>=(g/2|0);){let ze=w,ot=O;if(w=I,O=F,w.isZero())throw new ui("r_{i-1} was zero");I=ze;let ht=v.getZero();const Dt=w.getCoefficient(w.getDegree()),qt=v.inverse(Dt);for(;I.getDegree()>=w.getDegree()&&!I.isZero();){const Sn=I.getDegree()-w.getDegree(),wn=v.multiply(I.getCoefficient(I.getDegree()),qt);ht=ht.addOrSubtract(v.buildMonomial(Sn,wn)),I=I.addOrSubtract(w.multiplyByMonomial(Sn,wn))}if(F=ht.multiply(O).addOrSubtract(ot),I.getDegree()>=w.getDegree())throw new _i("Division algorithm failed to reduce polynomial?")}const q=F.getCoefficient(0);if(q===0)throw new ui("sigmaTilde(0) was zero");const te=v.inverse(q),ue=F.multiplyScalar(te),xe=I.multiplyScalar(te);return[ue,xe]}findErrorLocations(a){const u=a.getDegree();if(u===1)return Int32Array.from([a.getCoefficient(1)]);const g=new Int32Array(u);let v=0;const w=this.field;for(let I=1;I<w.getSize()&&v<u;I++)a.evaluateAt(I)===0&&(g[v]=w.inverse(I),v++);if(v!==u)throw new ui("Error locator degree does not match number of roots");return g}findErrorMagnitudes(a,u){const g=u.length,v=new Int32Array(g),w=this.field;for(let I=0;I<g;I++){const O=w.inverse(u[I]);let F=1;for(let q=0;q<g;q++)if(I!==q){const te=w.multiply(u[q],O),ue=(te&1)===0?te|1:te&-2;F=w.multiply(F,ue)}v[I]=w.multiply(a.evaluateAt(O),w.inverse(F)),w.getGeneratorBase()!==0&&(v[I]=w.multiply(v[I],O))}return v}}var qn;(function(le){le[le.UPPER=0]="UPPER",le[le.LOWER=1]="LOWER",le[le.MIXED=2]="MIXED",le[le.DIGIT=3]="DIGIT",le[le.PUNCT=4]="PUNCT",le[le.BINARY=5]="BINARY"})(qn||(qn={}));class Gn{decode(a){this.ddata=a;let u=a.getBits(),g=this.extractBits(u),v=this.correctBits(g),w=Gn.convertBoolArrayToByteArray(v),I=Gn.getEncodedData(v),O=new sn(w,I,null,null);return O.setNumBits(v.length),O}static highLevelDecode(a){return this.getEncodedData(a)}static getEncodedData(a){let u=a.length,g=qn.UPPER,v=qn.UPPER,w="",I=0;for(;I<u;)if(v===qn.BINARY){if(u-I<5)break;let O=Gn.readCode(a,I,5);if(I+=5,O===0){if(u-I<11)break;O=Gn.readCode(a,I,11)+31,I+=11}for(let F=0;F<O;F++){if(u-I<8){I=u;break}const q=Gn.readCode(a,I,8);w+=ct.castAsNonUtf8Char(q),I+=8}v=g}else{let O=v===qn.DIGIT?4:5;if(u-I<O)break;let F=Gn.readCode(a,I,O);I+=O;let q=Gn.getCharacter(v,F);q.startsWith("CTRL_")?(g=v,v=Gn.getTable(q.charAt(5)),q.charAt(6)==="L"&&(g=v)):(w+=q,v=g)}return w}static getTable(a){switch(a){case"L":return qn.LOWER;case"P":return qn.PUNCT;case"M":return qn.MIXED;case"D":return qn.DIGIT;case"B":return qn.BINARY;default:return qn.UPPER}}static getCharacter(a,u){switch(a){case qn.UPPER:return Gn.UPPER_TABLE[u];case qn.LOWER:return Gn.LOWER_TABLE[u];case qn.MIXED:return Gn.MIXED_TABLE[u];case qn.PUNCT:return Gn.PUNCT_TABLE[u];case qn.DIGIT:return Gn.DIGIT_TABLE[u];default:throw new _i("Bad table")}}correctBits(a){let u,g;this.ddata.getNbLayers()<=2?(g=6,u=kn.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(g=8,u=kn.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(g=10,u=kn.AZTEC_DATA_10):(g=12,u=kn.AZTEC_DATA_12);let v=this.ddata.getNbDatablocks(),w=a.length/g;if(w<v)throw new it;let I=a.length%g,O=new Int32Array(w);for(let xe=0;xe<w;xe++,I+=g)O[xe]=Gn.readCode(a,I,g);try{new Di(u).decode(O,w-v)}catch(xe){throw new it(xe)}let F=(1<<g)-1,q=0;for(let xe=0;xe<v;xe++){let ze=O[xe];if(ze===0||ze===F)throw new it;(ze===1||ze===F-1)&&q++}let te=new Array(v*g-q),ue=0;for(let xe=0;xe<v;xe++){let ze=O[xe];if(ze===1||ze===F-1)te.fill(ze>1,ue,ue+g-1),ue+=g-1;else for(let ot=g-1;ot>=0;--ot)te[ue++]=(ze&1<<ot)!==0}return te}extractBits(a){let u=this.ddata.isCompact(),g=this.ddata.getNbLayers(),v=(u?11:14)+g*4,w=new Int32Array(v),I=new Array(this.totalBitsInLayer(g,u));if(u)for(let O=0;O<w.length;O++)w[O]=O;else{let O=v+1+2*Ye.truncDivision(Ye.truncDivision(v,2)-1,15),F=v/2,q=Ye.truncDivision(O,2);for(let te=0;te<F;te++){let ue=te+Ye.truncDivision(te,15);w[F-te-1]=q-ue-1,w[F+te]=q+ue+1}}for(let O=0,F=0;O<g;O++){let q=(g-O)*4+(u?9:12),te=O*2,ue=v-1-te;for(let xe=0;xe<q;xe++){let ze=xe*2;for(let ot=0;ot<2;ot++)I[F+ze+ot]=a.get(w[te+ot],w[te+xe]),I[F+2*q+ze+ot]=a.get(w[te+xe],w[ue-ot]),I[F+4*q+ze+ot]=a.get(w[ue-ot],w[ue-xe]),I[F+6*q+ze+ot]=a.get(w[ue-xe],w[te+ot])}F+=q*8}return I}static readCode(a,u,g){let v=0;for(let w=u;w<u+g;w++)v<<=1,a[w]&&(v|=1);return v}static readByte(a,u){let g=a.length-u;return g>=8?Gn.readCode(a,u,8):Gn.readCode(a,u,g)<<8-g}static convertBoolArrayToByteArray(a){let u=new Uint8Array((a.length+7)/8);for(let g=0;g<u.length;g++)u[g]=Gn.readByte(a,8*g);return u}totalBitsInLayer(a,u){return((u?88:112)+16*a)*a}}Gn.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Gn.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Gn.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Gn.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Gn.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class In{constructor(){}static round(a){return a===NaN?0:a<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:a>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:a+(a<0?-.5:.5)|0}static distance(a,u,g,v){const w=a-g,I=u-v;return Math.sqrt(w*w+I*I)}static sum(a){let u=0;for(let g=0,v=a.length;g!==v;g++){const w=a[g];u+=w}return u}}class vi{static floatToIntBits(a){return a}}vi.MAX_VALUE=Number.MAX_SAFE_INTEGER;class nn{constructor(a,u){this.x=a,this.y=u}getX(){return this.x}getY(){return this.y}equals(a){if(a instanceof nn){const u=a;return this.x===u.x&&this.y===u.y}return!1}hashCode(){return 31*vi.floatToIntBits(this.x)+vi.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(a){const u=this.distance(a[0],a[1]),g=this.distance(a[1],a[2]),v=this.distance(a[0],a[2]);let w,I,O;if(g>=u&&g>=v?(I=a[0],w=a[1],O=a[2]):v>=g&&v>=u?(I=a[1],w=a[0],O=a[2]):(I=a[2],w=a[0],O=a[1]),this.crossProductZ(w,I,O)<0){const F=w;w=O,O=F}a[0]=w,a[1]=I,a[2]=O}static distance(a,u){return In.distance(a.x,a.y,u.x,u.y)}static crossProductZ(a,u,g){const v=u.x,w=u.y;return(g.x-v)*(a.y-w)-(g.y-w)*(a.x-v)}}class Li{constructor(a,u){this.bits=a,this.points=u}getBits(){return this.bits}getPoints(){return this.points}}class Ki extends Li{constructor(a,u,g,v,w){super(a,u),this.compact=g,this.nbDatablocks=v,this.nbLayers=w}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class Pi{constructor(a,u,g,v){this.image=a,this.height=a.getHeight(),this.width=a.getWidth(),u==null&&(u=Pi.INIT_SIZE),g==null&&(g=a.getWidth()/2|0),v==null&&(v=a.getHeight()/2|0);const w=u/2|0;if(this.leftInit=g-w,this.rightInit=g+w,this.upInit=v-w,this.downInit=v+w,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Ne}detect(){let a=this.leftInit,u=this.rightInit,g=this.upInit,v=this.downInit,w=!1,I=!0,O=!1,F=!1,q=!1,te=!1,ue=!1;const xe=this.width,ze=this.height;for(;I;){I=!1;let ot=!0;for(;(ot||!F)&&u<xe;)ot=this.containsBlackPoint(g,v,u,!1),ot?(u++,I=!0,F=!0):F||u++;if(u>=xe){w=!0;break}let ht=!0;for(;(ht||!q)&&v<ze;)ht=this.containsBlackPoint(a,u,v,!0),ht?(v++,I=!0,q=!0):q||v++;if(v>=ze){w=!0;break}let Dt=!0;for(;(Dt||!te)&&a>=0;)Dt=this.containsBlackPoint(g,v,a,!1),Dt?(a--,I=!0,te=!0):te||a--;if(a<0){w=!0;break}let qt=!0;for(;(qt||!ue)&&g>=0;)qt=this.containsBlackPoint(a,u,g,!0),qt?(g--,I=!0,ue=!0):ue||g--;if(g<0){w=!0;break}I&&(O=!0)}if(!w&&O){const ot=u-a;let ht=null;for(let wn=1;ht===null&&wn<ot;wn++)ht=this.getBlackPointOnSegment(a,v-wn,a+wn,v);if(ht==null)throw new Ne;let Dt=null;for(let wn=1;Dt===null&&wn<ot;wn++)Dt=this.getBlackPointOnSegment(a,g+wn,a+wn,g);if(Dt==null)throw new Ne;let qt=null;for(let wn=1;qt===null&&wn<ot;wn++)qt=this.getBlackPointOnSegment(u,g+wn,u-wn,g);if(qt==null)throw new Ne;let Sn=null;for(let wn=1;Sn===null&&wn<ot;wn++)Sn=this.getBlackPointOnSegment(u,v-wn,u-wn,v);if(Sn==null)throw new Ne;return this.centerEdges(Sn,ht,qt,Dt)}else throw new Ne}getBlackPointOnSegment(a,u,g,v){const w=In.round(In.distance(a,u,g,v)),I=(g-a)/w,O=(v-u)/w,F=this.image;for(let q=0;q<w;q++){const te=In.round(a+q*I),ue=In.round(u+q*O);if(F.get(te,ue))return new nn(te,ue)}return null}centerEdges(a,u,g,v){const w=a.getX(),I=a.getY(),O=u.getX(),F=u.getY(),q=g.getX(),te=g.getY(),ue=v.getX(),xe=v.getY(),ze=Pi.CORR;return w<this.width/2?[new nn(ue-ze,xe+ze),new nn(O+ze,F+ze),new nn(q-ze,te-ze),new nn(w+ze,I-ze)]:[new nn(ue+ze,xe+ze),new nn(O+ze,F-ze),new nn(q-ze,te+ze),new nn(w-ze,I-ze)]}containsBlackPoint(a,u,g,v){const w=this.image;if(v){for(let I=a;I<=u;I++)if(w.get(I,g))return!0}else for(let I=a;I<=u;I++)if(w.get(g,I))return!0;return!1}}Pi.INIT_SIZE=10,Pi.CORR=1;class xr{static checkAndNudgePoints(a,u){const g=a.getWidth(),v=a.getHeight();let w=!0;for(let I=0;I<u.length&&w;I+=2){const O=Math.floor(u[I]),F=Math.floor(u[I+1]);if(O<-1||O>g||F<-1||F>v)throw new Ne;w=!1,O===-1?(u[I]=0,w=!0):O===g&&(u[I]=g-1,w=!0),F===-1?(u[I+1]=0,w=!0):F===v&&(u[I+1]=v-1,w=!0)}w=!0;for(let I=u.length-2;I>=0&&w;I-=2){const O=Math.floor(u[I]),F=Math.floor(u[I+1]);if(O<-1||O>g||F<-1||F>v)throw new Ne;w=!1,O===-1?(u[I]=0,w=!0):O===g&&(u[I]=g-1,w=!0),F===-1?(u[I+1]=0,w=!0):F===v&&(u[I+1]=v-1,w=!0)}}}class gt{constructor(a,u,g,v,w,I,O,F,q){this.a11=a,this.a21=u,this.a31=g,this.a12=v,this.a22=w,this.a32=I,this.a13=O,this.a23=F,this.a33=q}static quadrilateralToQuadrilateral(a,u,g,v,w,I,O,F,q,te,ue,xe,ze,ot,ht,Dt){const qt=gt.quadrilateralToSquare(a,u,g,v,w,I,O,F);return gt.squareToQuadrilateral(q,te,ue,xe,ze,ot,ht,Dt).times(qt)}transformPoints(a){const u=a.length,g=this.a11,v=this.a12,w=this.a13,I=this.a21,O=this.a22,F=this.a23,q=this.a31,te=this.a32,ue=this.a33;for(let xe=0;xe<u;xe+=2){const ze=a[xe],ot=a[xe+1],ht=w*ze+F*ot+ue;a[xe]=(g*ze+I*ot+q)/ht,a[xe+1]=(v*ze+O*ot+te)/ht}}transformPointsWithValues(a,u){const g=this.a11,v=this.a12,w=this.a13,I=this.a21,O=this.a22,F=this.a23,q=this.a31,te=this.a32,ue=this.a33,xe=a.length;for(let ze=0;ze<xe;ze++){const ot=a[ze],ht=u[ze],Dt=w*ot+F*ht+ue;a[ze]=(g*ot+I*ht+q)/Dt,u[ze]=(v*ot+O*ht+te)/Dt}}static squareToQuadrilateral(a,u,g,v,w,I,O,F){const q=a-g+w-O,te=u-v+I-F;if(q===0&&te===0)return new gt(g-a,w-g,a,v-u,I-v,u,0,0,1);{const ue=g-w,xe=O-w,ze=v-I,ot=F-I,ht=ue*ot-xe*ze,Dt=(q*ot-xe*te)/ht,qt=(ue*te-q*ze)/ht;return new gt(g-a+Dt*g,O-a+qt*O,a,v-u+Dt*v,F-u+qt*F,u,Dt,qt,1)}}static quadrilateralToSquare(a,u,g,v,w,I,O,F){return gt.squareToQuadrilateral(a,u,g,v,w,I,O,F).buildAdjoint()}buildAdjoint(){return new gt(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(a){return new gt(this.a11*a.a11+this.a21*a.a12+this.a31*a.a13,this.a11*a.a21+this.a21*a.a22+this.a31*a.a23,this.a11*a.a31+this.a21*a.a32+this.a31*a.a33,this.a12*a.a11+this.a22*a.a12+this.a32*a.a13,this.a12*a.a21+this.a22*a.a22+this.a32*a.a23,this.a12*a.a31+this.a22*a.a32+this.a32*a.a33,this.a13*a.a11+this.a23*a.a12+this.a33*a.a13,this.a13*a.a21+this.a23*a.a22+this.a33*a.a23,this.a13*a.a31+this.a23*a.a32+this.a33*a.a33)}}class oe extends xr{sampleGrid(a,u,g,v,w,I,O,F,q,te,ue,xe,ze,ot,ht,Dt,qt,Sn,wn){const xn=gt.quadrilateralToQuadrilateral(v,w,I,O,F,q,te,ue,xe,ze,ot,ht,Dt,qt,Sn,wn);return this.sampleGridWithTransform(a,u,g,xn)}sampleGridWithTransform(a,u,g,v){if(u<=0||g<=0)throw new Ne;const w=new Zt(u,g),I=new Float32Array(2*u);for(let O=0;O<g;O++){const F=I.length,q=O+.5;for(let te=0;te<F;te+=2)I[te]=te/2+.5,I[te+1]=q;v.transformPoints(I),xr.checkAndNudgePoints(a,I);try{for(let te=0;te<F;te+=2)a.get(Math.floor(I[te]),Math.floor(I[te+1]))&&w.set(te/2,O)}catch{throw new Ne}}return w}}class ce{static setGridSampler(a){ce.gridSampler=a}static getInstance(){return ce.gridSampler}}ce.gridSampler=new oe;class pe{constructor(a,u){this.x=a,this.y=u}toResultPoint(){return new nn(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class je{constructor(a){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=a}detect(){return this.detectMirror(!1)}detectMirror(a){let u=this.getMatrixCenter(),g=this.getBullsEyeCorners(u);if(a){let I=g[0];g[0]=g[2],g[2]=I}this.extractParameters(g);let v=this.sampleGrid(this.image,g[this.shift%4],g[(this.shift+1)%4],g[(this.shift+2)%4],g[(this.shift+3)%4]),w=this.getMatrixCornerPoints(g);return new Ki(v,w,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(a){if(!this.isValidPoint(a[0])||!this.isValidPoint(a[1])||!this.isValidPoint(a[2])||!this.isValidPoint(a[3]))throw new Ne;let u=2*this.nbCenterLayers,g=new Int32Array([this.sampleLine(a[0],a[1],u),this.sampleLine(a[1],a[2],u),this.sampleLine(a[2],a[3],u),this.sampleLine(a[3],a[0],u)]);this.shift=this.getRotation(g,u);let v=0;for(let I=0;I<4;I++){let O=g[(this.shift+I)%4];this.compact?(v<<=7,v+=O>>1&127):(v<<=10,v+=(O>>2&992)+(O>>1&31))}let w=this.getCorrectedParameterData(v,this.compact);this.compact?(this.nbLayers=(w>>6)+1,this.nbDataBlocks=(w&63)+1):(this.nbLayers=(w>>11)+1,this.nbDataBlocks=(w&2047)+1)}getRotation(a,u){let g=0;a.forEach((v,w,I)=>{let O=(v>>u-2<<1)+(v&1);g=(g<<3)+O}),g=((g&1)<<11)+(g>>1);for(let v=0;v<4;v++)if(Ye.bitCount(g^this.EXPECTED_CORNER_BITS[v])<=2)return v;throw new Ne}getCorrectedParameterData(a,u){let g,v;u?(g=7,v=2):(g=10,v=4);let w=g-v,I=new Int32Array(g);for(let F=g-1;F>=0;--F)I[F]=a&15,a>>=4;try{new Di(kn.AZTEC_PARAM).decode(I,w)}catch{throw new Ne}let O=0;for(let F=0;F<v;F++)O=(O<<4)+I[F];return O}getBullsEyeCorners(a){let u=a,g=a,v=a,w=a,I=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let ue=this.getFirstDifferent(u,I,1,-1),xe=this.getFirstDifferent(g,I,1,1),ze=this.getFirstDifferent(v,I,-1,1),ot=this.getFirstDifferent(w,I,-1,-1);if(this.nbCenterLayers>2){let ht=this.distancePoint(ot,ue)*this.nbCenterLayers/(this.distancePoint(w,u)*(this.nbCenterLayers+2));if(ht<.75||ht>1.25||!this.isWhiteOrBlackRectangle(ue,xe,ze,ot))break}u=ue,g=xe,v=ze,w=ot,I=!I}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new Ne;this.compact=this.nbCenterLayers===5;let O=new nn(u.getX()+.5,u.getY()-.5),F=new nn(g.getX()+.5,g.getY()+.5),q=new nn(v.getX()-.5,v.getY()+.5),te=new nn(w.getX()-.5,w.getY()-.5);return this.expandSquare([O,F,q,te],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let a,u,g,v;try{let O=new Pi(this.image).detect();a=O[0],u=O[1],g=O[2],v=O[3]}catch{let F=this.image.getWidth()/2,q=this.image.getHeight()/2;a=this.getFirstDifferent(new pe(F+7,q-7),!1,1,-1).toResultPoint(),u=this.getFirstDifferent(new pe(F+7,q+7),!1,1,1).toResultPoint(),g=this.getFirstDifferent(new pe(F-7,q+7),!1,-1,1).toResultPoint(),v=this.getFirstDifferent(new pe(F-7,q-7),!1,-1,-1).toResultPoint()}let w=In.round((a.getX()+v.getX()+u.getX()+g.getX())/4),I=In.round((a.getY()+v.getY()+u.getY()+g.getY())/4);try{let O=new Pi(this.image,15,w,I).detect();a=O[0],u=O[1],g=O[2],v=O[3]}catch{a=this.getFirstDifferent(new pe(w+7,I-7),!1,1,-1).toResultPoint(),u=this.getFirstDifferent(new pe(w+7,I+7),!1,1,1).toResultPoint(),g=this.getFirstDifferent(new pe(w-7,I+7),!1,-1,1).toResultPoint(),v=this.getFirstDifferent(new pe(w-7,I-7),!1,-1,-1).toResultPoint()}return w=In.round((a.getX()+v.getX()+u.getX()+g.getX())/4),I=In.round((a.getY()+v.getY()+u.getY()+g.getY())/4),new pe(w,I)}getMatrixCornerPoints(a){return this.expandSquare(a,2*this.nbCenterLayers,this.getDimension())}sampleGrid(a,u,g,v,w){let I=ce.getInstance(),O=this.getDimension(),F=O/2-this.nbCenterLayers,q=O/2+this.nbCenterLayers;return I.sampleGrid(a,O,O,F,F,q,F,q,q,F,q,u.getX(),u.getY(),g.getX(),g.getY(),v.getX(),v.getY(),w.getX(),w.getY())}sampleLine(a,u,g){let v=0,w=this.distanceResultPoint(a,u),I=w/g,O=a.getX(),F=a.getY(),q=I*(u.getX()-a.getX())/w,te=I*(u.getY()-a.getY())/w;for(let ue=0;ue<g;ue++)this.image.get(In.round(O+ue*q),In.round(F+ue*te))&&(v|=1<<g-ue-1);return v}isWhiteOrBlackRectangle(a,u,g,v){let w=3;a=new pe(a.getX()-w,a.getY()+w),u=new pe(u.getX()-w,u.getY()-w),g=new pe(g.getX()+w,g.getY()-w),v=new pe(v.getX()+w,v.getY()+w);let I=this.getColor(v,a);if(I===0)return!1;let O=this.getColor(a,u);return O!==I||(O=this.getColor(u,g),O!==I)?!1:(O=this.getColor(g,v),O===I)}getColor(a,u){let g=this.distancePoint(a,u),v=(u.getX()-a.getX())/g,w=(u.getY()-a.getY())/g,I=0,O=a.getX(),F=a.getY(),q=this.image.get(a.getX(),a.getY()),te=Math.ceil(g);for(let xe=0;xe<te;xe++)O+=v,F+=w,this.image.get(In.round(O),In.round(F))!==q&&I++;let ue=I/g;return ue>.1&&ue<.9?0:ue<=.1===q?1:-1}getFirstDifferent(a,u,g,v){let w=a.getX()+g,I=a.getY()+v;for(;this.isValid(w,I)&&this.image.get(w,I)===u;)w+=g,I+=v;for(w-=g,I-=v;this.isValid(w,I)&&this.image.get(w,I)===u;)w+=g;for(w-=g;this.isValid(w,I)&&this.image.get(w,I)===u;)I+=v;return I-=v,new pe(w,I)}expandSquare(a,u,g){let v=g/(2*u),w=a[0].getX()-a[2].getX(),I=a[0].getY()-a[2].getY(),O=(a[0].getX()+a[2].getX())/2,F=(a[0].getY()+a[2].getY())/2,q=new nn(O+v*w,F+v*I),te=new nn(O-v*w,F-v*I);w=a[1].getX()-a[3].getX(),I=a[1].getY()-a[3].getY(),O=(a[1].getX()+a[3].getX())/2,F=(a[1].getY()+a[3].getY())/2;let ue=new nn(O+v*w,F+v*I),xe=new nn(O-v*w,F-v*I);return[q,ue,te,xe]}isValid(a,u){return a>=0&&a<this.image.getWidth()&&u>0&&u<this.image.getHeight()}isValidPoint(a){let u=In.round(a.getX()),g=In.round(a.getY());return this.isValid(u,g)}distancePoint(a,u){return In.distance(a.getX(),a.getY(),u.getX(),u.getY())}distanceResultPoint(a,u){return In.distance(a.getX(),a.getY(),u.getX(),u.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(Ye.truncDivision(this.nbLayers-4,8)+1)+15}}class Je{decode(a,u=null){let g=null,v=new je(a.getBlackMatrix()),w=null,I=null;try{let te=v.detectMirror(!1);w=te.getPoints(),this.reportFoundResultPoints(u,w),I=new Gn().decode(te)}catch(te){g=te}if(I==null)try{let te=v.detectMirror(!0);w=te.getPoints(),this.reportFoundResultPoints(u,w),I=new Gn().decode(te)}catch(te){throw g??te}let O=new _t(I.getText(),I.getRawBytes(),I.getNumBits(),w,Bt.AZTEC,me.currentTimeMillis()),F=I.getByteSegments();F!=null&&O.putMetadata(an.BYTE_SEGMENTS,F);let q=I.getECLevel();return q!=null&&O.putMetadata(an.ERROR_CORRECTION_LEVEL,q),O}reportFoundResultPoints(a,u){if(a!=null){let g=a.get(Et.NEED_RESULT_POINT_CALLBACK);g!=null&&u.forEach((v,w,I)=>{g.foundPossibleResultPoint(v)})}}reset(){}}class St extends Nt{constructor(a=500){super(new Je,a)}}class rt{decode(a,u){try{return this.doDecode(a,u)}catch{if(u&&u.get(Et.TRY_HARDER)===!0&&a.isRotateSupported()){const w=a.rotateCounterClockwise(),I=this.doDecode(w,u),O=I.getResultMetadata();let F=270;O!==null&&O.get(an.ORIENTATION)===!0&&(F=F+O.get(an.ORIENTATION)%360),I.putMetadata(an.ORIENTATION,F);const q=I.getResultPoints();if(q!==null){const te=w.getHeight();for(let ue=0;ue<q.length;ue++)q[ue]=new nn(te-q[ue].getY()-1,q[ue].getX())}return I}else throw new Ne}}reset(){}doDecode(a,u){const g=a.getWidth(),v=a.getHeight();let w=new pt(g);const I=u&&u.get(Et.TRY_HARDER)===!0,O=Math.max(1,v>>(I?8:5));let F;I?F=v:F=15;const q=Math.trunc(v/2);for(let te=0;te<F;te++){const ue=Math.trunc((te+1)/2),xe=(te&1)===0,ze=q+O*(xe?ue:-ue);if(ze<0||ze>=v)break;try{w=a.getBlackRow(ze,w)}catch{continue}for(let ot=0;ot<2;ot++){if(ot===1&&(w.reverse(),u&&u.get(Et.NEED_RESULT_POINT_CALLBACK)===!0)){const ht=new Map;u.forEach((Dt,qt)=>ht.set(qt,Dt)),ht.delete(Et.NEED_RESULT_POINT_CALLBACK),u=ht}try{const ht=this.decodeRow(ze,w,u);if(ot===1){ht.putMetadata(an.ORIENTATION,180);const Dt=ht.getResultPoints();Dt!==null&&(Dt[0]=new nn(g-Dt[0].getX()-1,Dt[0].getY()),Dt[1]=new nn(g-Dt[1].getX()-1,Dt[1].getY()))}return ht}catch{}}}throw new Ne}static recordPattern(a,u,g){const v=g.length;for(let q=0;q<v;q++)g[q]=0;const w=a.getSize();if(u>=w)throw new Ne;let I=!a.get(u),O=0,F=u;for(;F<w;){if(a.get(F)!==I)g[O]++;else{if(++O===v)break;g[O]=1,I=!I}F++}if(!(O===v||O===v-1&&F===w))throw new Ne}static recordPatternInReverse(a,u,g){let v=g.length,w=a.get(u);for(;u>0&&v>=0;)a.get(--u)!==w&&(v--,w=!w);if(v>=0)throw new Ne;rt.recordPattern(a,u+1,g)}static patternMatchVariance(a,u,g){const v=a.length;let w=0,I=0;for(let q=0;q<v;q++)w+=a[q],I+=u[q];if(w<I)return Number.POSITIVE_INFINITY;const O=w/I;g*=O;let F=0;for(let q=0;q<v;q++){const te=a[q],ue=u[q]*O,xe=te>ue?te-ue:ue-te;if(xe>g)return Number.POSITIVE_INFINITY;F+=xe}return F/w}}class de extends rt{static findStartPattern(a){const u=a.getSize(),g=a.getNextSet(0);let v=0,w=Int32Array.from([0,0,0,0,0,0]),I=g,O=!1;const F=6;for(let q=g;q<u;q++)if(a.get(q)!==O)w[v]++;else{if(v===F-1){let te=de.MAX_AVG_VARIANCE,ue=-1;for(let xe=de.CODE_START_A;xe<=de.CODE_START_C;xe++){const ze=rt.patternMatchVariance(w,de.CODE_PATTERNS[xe],de.MAX_INDIVIDUAL_VARIANCE);ze<te&&(te=ze,ue=xe)}if(ue>=0&&a.isRange(Math.max(0,I-(q-I)/2),I,!1))return Int32Array.from([I,q,ue]);I+=w[0]+w[1],w=w.slice(2,w.length-1),w[v-1]=0,w[v]=0,v--}else v++;w[v]=1,O=!O}throw new Ne}static decodeCode(a,u,g){rt.recordPattern(a,g,u);let v=de.MAX_AVG_VARIANCE,w=-1;for(let I=0;I<de.CODE_PATTERNS.length;I++){const O=de.CODE_PATTERNS[I],F=this.patternMatchVariance(u,O,de.MAX_INDIVIDUAL_VARIANCE);F<v&&(v=F,w=I)}if(w>=0)return w;throw new Ne}decodeRow(a,u,g){const v=g&&g.get(Et.ASSUME_GS1)===!0,w=de.findStartPattern(u),I=w[2];let O=0;const F=new Uint8Array(20);F[O++]=I;let q;switch(I){case de.CODE_START_A:q=de.CODE_CODE_A;break;case de.CODE_START_B:q=de.CODE_CODE_B;break;case de.CODE_START_C:q=de.CODE_CODE_C;break;default:throw new it}let te=!1,ue=!1,xe="",ze=w[0],ot=w[1];const ht=Int32Array.from([0,0,0,0,0,0]);let Dt=0,qt=0,Sn=I,wn=0,xn=!0,Yi=!1,Wn=!1;for(;!te;){const Gs=ue;switch(ue=!1,Dt=qt,qt=de.decodeCode(u,ht,ot),F[O++]=qt,qt!==de.CODE_STOP&&(xn=!0),qt!==de.CODE_STOP&&(wn++,Sn+=wn*qt),ze=ot,ot+=ht.reduce((sh,bu)=>sh+bu,0),qt){case de.CODE_START_A:case de.CODE_START_B:case de.CODE_START_C:throw new it}switch(q){case de.CODE_CODE_A:if(qt<64)Wn===Yi?xe+=String.fromCharCode(32+qt):xe+=String.fromCharCode(32+qt+128),Wn=!1;else if(qt<96)Wn===Yi?xe+=String.fromCharCode(qt-64):xe+=String.fromCharCode(qt+64),Wn=!1;else switch(qt!==de.CODE_STOP&&(xn=!1),qt){case de.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case de.CODE_FNC_2:case de.CODE_FNC_3:break;case de.CODE_FNC_4_A:!Yi&&Wn?(Yi=!0,Wn=!1):Yi&&Wn?(Yi=!1,Wn=!1):Wn=!0;break;case de.CODE_SHIFT:ue=!0,q=de.CODE_CODE_B;break;case de.CODE_CODE_B:q=de.CODE_CODE_B;break;case de.CODE_CODE_C:q=de.CODE_CODE_C;break;case de.CODE_STOP:te=!0;break}break;case de.CODE_CODE_B:if(qt<96)Wn===Yi?xe+=String.fromCharCode(32+qt):xe+=String.fromCharCode(32+qt+128),Wn=!1;else switch(qt!==de.CODE_STOP&&(xn=!1),qt){case de.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case de.CODE_FNC_2:case de.CODE_FNC_3:break;case de.CODE_FNC_4_B:!Yi&&Wn?(Yi=!0,Wn=!1):Yi&&Wn?(Yi=!1,Wn=!1):Wn=!0;break;case de.CODE_SHIFT:ue=!0,q=de.CODE_CODE_A;break;case de.CODE_CODE_A:q=de.CODE_CODE_A;break;case de.CODE_CODE_C:q=de.CODE_CODE_C;break;case de.CODE_STOP:te=!0;break}break;case de.CODE_CODE_C:if(qt<100)qt<10&&(xe+="0"),xe+=qt;else switch(qt!==de.CODE_STOP&&(xn=!1),qt){case de.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case de.CODE_CODE_A:q=de.CODE_CODE_A;break;case de.CODE_CODE_B:q=de.CODE_CODE_B;break;case de.CODE_STOP:te=!0;break}break}Gs&&(q=q===de.CODE_CODE_A?de.CODE_CODE_B:de.CODE_CODE_A)}const rs=ot-ze;if(ot=u.getNextUnset(ot),!u.isRange(ot,Math.min(u.getSize(),ot+(ot-ze)/2),!1))throw new Ne;if(Sn-=wn*Dt,Sn%103!==Dt)throw new we;const xa=xe.length;if(xa===0)throw new Ne;xa>0&&xn&&(q===de.CODE_CODE_C?xe=xe.substring(0,xa-2):xe=xe.substring(0,xa-1));const Vs=(w[1]+w[0])/2,Ar=ze+rs/2,ss=F.length,Qs=new Uint8Array(ss);for(let Gs=0;Gs<ss;Gs++)Qs[Gs]=F[Gs];const ao=[new nn(Vs,a),new nn(Ar,a)];return new _t(xe,Qs,0,ao,Bt.CODE_128,new Date().getTime())}}de.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],de.MAX_AVG_VARIANCE=.25,de.MAX_INDIVIDUAL_VARIANCE=.7,de.CODE_SHIFT=98,de.CODE_CODE_C=99,de.CODE_CODE_B=100,de.CODE_CODE_A=101,de.CODE_FNC_1=102,de.CODE_FNC_2=97,de.CODE_FNC_3=96,de.CODE_FNC_4_A=101,de.CODE_FNC_4_B=100,de.CODE_START_A=103,de.CODE_START_B=104,de.CODE_START_C=105,de.CODE_STOP=106;class Ze extends rt{constructor(a=!1,u=!1){super(),this.usingCheckDigit=a,this.extendedMode=u,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(a,u,g){let v=this.counters;v.fill(0),this.decodeRowResult="";let w=Ze.findAsteriskPattern(u,v),I=u.getNextSet(w[1]),O=u.getSize(),F,q;do{Ze.recordPattern(u,I,v);let ht=Ze.toNarrowWidePattern(v);if(ht<0)throw new Ne;F=Ze.patternToChar(ht),this.decodeRowResult+=F,q=I;for(let Dt of v)I+=Dt;I=u.getNextSet(I)}while(F!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let te=0;for(let ht of v)te+=ht;let ue=I-q-te;if(I!==O&&ue*2<te)throw new Ne;if(this.usingCheckDigit){let ht=this.decodeRowResult.length-1,Dt=0;for(let qt=0;qt<ht;qt++)Dt+=Ze.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(qt));if(this.decodeRowResult.charAt(ht)!==Ze.ALPHABET_STRING.charAt(Dt%43))throw new we;this.decodeRowResult=this.decodeRowResult.substring(0,ht)}if(this.decodeRowResult.length===0)throw new Ne;let xe;this.extendedMode?xe=Ze.decodeExtended(this.decodeRowResult):xe=this.decodeRowResult;let ze=(w[1]+w[0])/2,ot=q+te/2;return new _t(xe,null,0,[new nn(ze,a),new nn(ot,a)],Bt.CODE_39,new Date().getTime())}static findAsteriskPattern(a,u){let g=a.getSize(),v=a.getNextSet(0),w=0,I=v,O=!1,F=u.length;for(let q=v;q<g;q++)if(a.get(q)!==O)u[w]++;else{if(w===F-1){if(this.toNarrowWidePattern(u)===Ze.ASTERISK_ENCODING&&a.isRange(Math.max(0,I-Math.floor((q-I)/2)),I,!1))return[I,q];I+=u[0]+u[1],u.copyWithin(0,2,2+w-1),u[w-1]=0,u[w]=0,w--}else w++;u[w]=1,O=!O}throw new Ne}static toNarrowWidePattern(a){let u=a.length,g=0,v;do{let w=2147483647;for(let F of a)F<w&&F>g&&(w=F);g=w,v=0;let I=0,O=0;for(let F=0;F<u;F++){let q=a[F];q>g&&(O|=1<<u-1-F,v++,I+=q)}if(v===3){for(let F=0;F<u&&v>0;F++){let q=a[F];if(q>g&&(v--,q*2>=I))return-1}return O}}while(v>3);return-1}static patternToChar(a){for(let u=0;u<Ze.CHARACTER_ENCODINGS.length;u++)if(Ze.CHARACTER_ENCODINGS[u]===a)return Ze.ALPHABET_STRING.charAt(u);if(a===Ze.ASTERISK_ENCODING)return"*";throw new Ne}static decodeExtended(a){let u=a.length,g="";for(let v=0;v<u;v++){let w=a.charAt(v);if(w==="+"||w==="$"||w==="%"||w==="/"){let I=a.charAt(v+1),O="\0";switch(w){case"+":if(I>="A"&&I<="Z")O=String.fromCharCode(I.charCodeAt(0)+32);else throw new it;break;case"$":if(I>="A"&&I<="Z")O=String.fromCharCode(I.charCodeAt(0)-64);else throw new it;break;case"%":if(I>="A"&&I<="E")O=String.fromCharCode(I.charCodeAt(0)-38);else if(I>="F"&&I<="J")O=String.fromCharCode(I.charCodeAt(0)-11);else if(I>="K"&&I<="O")O=String.fromCharCode(I.charCodeAt(0)+16);else if(I>="P"&&I<="T")O=String.fromCharCode(I.charCodeAt(0)+43);else if(I==="U")O="\0";else if(I==="V")O="@";else if(I==="W")O="`";else if(I==="X"||I==="Y"||I==="Z")O="";else throw new it;break;case"/":if(I>="A"&&I<="O")O=String.fromCharCode(I.charCodeAt(0)-32);else if(I==="Z")O=":";else throw new it;break}g+=O,v++}else g+=w}return g}}Ze.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Ze.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Ze.ASTERISK_ENCODING=148;class yt extends rt{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(a,u,g){let v=this.decodeStart(u),w=this.decodeEnd(u),I=new vt;yt.decodeMiddle(u,v[1],w[0],I);let O=I.toString(),F=null;g!=null&&(F=g.get(Et.ALLOWED_LENGTHS)),F==null&&(F=yt.DEFAULT_ALLOWED_LENGTHS);let q=O.length,te=!1,ue=0;for(let ot of F){if(q===ot){te=!0;break}ot>ue&&(ue=ot)}if(!te&&q>ue&&(te=!0),!te)throw new it;const xe=[new nn(v[1],a),new nn(w[0],a)];return new _t(O,null,0,xe,Bt.ITF,new Date().getTime())}static decodeMiddle(a,u,g,v){let w=new Int32Array(10),I=new Int32Array(5),O=new Int32Array(5);for(w.fill(0),I.fill(0),O.fill(0);u<g;){rt.recordPattern(a,u,w);for(let q=0;q<5;q++){let te=2*q;I[q]=w[te],O[q]=w[te+1]}let F=yt.decodeDigit(I);v.append(F.toString()),F=this.decodeDigit(O),v.append(F.toString()),w.forEach(function(q){u+=q})}}decodeStart(a){let u=yt.skipWhiteSpace(a),g=yt.findGuardPattern(a,u,yt.START_PATTERN);return this.narrowLineWidth=(g[1]-g[0])/4,this.validateQuietZone(a,g[0]),g}validateQuietZone(a,u){let g=this.narrowLineWidth*10;g=g<u?g:u;for(let v=u-1;g>0&&v>=0&&!a.get(v);v--)g--;if(g!==0)throw new Ne}static skipWhiteSpace(a){const u=a.getSize(),g=a.getNextSet(0);if(g===u)throw new Ne;return g}decodeEnd(a){a.reverse();try{let u=yt.skipWhiteSpace(a),g;try{g=yt.findGuardPattern(a,u,yt.END_PATTERN_REVERSED[0])}catch(w){w instanceof Ne&&(g=yt.findGuardPattern(a,u,yt.END_PATTERN_REVERSED[1]))}this.validateQuietZone(a,g[0]);let v=g[0];return g[0]=a.getSize()-g[1],g[1]=a.getSize()-v,g}finally{a.reverse()}}static findGuardPattern(a,u,g){let v=g.length,w=new Int32Array(v),I=a.getSize(),O=!1,F=0,q=u;w.fill(0);for(let te=u;te<I;te++)if(a.get(te)!==O)w[F]++;else{if(F===v-1){if(rt.patternMatchVariance(w,g,yt.MAX_INDIVIDUAL_VARIANCE)<yt.MAX_AVG_VARIANCE)return[q,te];q+=w[0]+w[1],me.arraycopy(w,2,w,0,F-1),w[F-1]=0,w[F]=0,F--}else F++;w[F]=1,O=!O}throw new Ne}static decodeDigit(a){let u=yt.MAX_AVG_VARIANCE,g=-1,v=yt.PATTERNS.length;for(let w=0;w<v;w++){let I=yt.PATTERNS[w],O=rt.patternMatchVariance(a,I,yt.MAX_INDIVIDUAL_VARIANCE);O<u?(u=O,g=w):O===u&&(g=-1)}if(g>=0)return g%10;throw new Ne}}yt.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],yt.MAX_AVG_VARIANCE=.38,yt.MAX_INDIVIDUAL_VARIANCE=.5,yt.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],yt.START_PATTERN=Int32Array.from([1,1,1,1]),yt.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Oe extends rt{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(a){let u=!1,g,v=0,w=Int32Array.from([0,0,0]);for(;!u;){w=Int32Array.from([0,0,0]),g=Oe.findGuardPattern(a,v,!1,this.START_END_PATTERN,w);let I=g[0];v=g[1];let O=I-(v-I);O>=0&&(u=a.isRange(O,I,!1))}return g}static checkChecksum(a){return Oe.checkStandardUPCEANChecksum(a)}static checkStandardUPCEANChecksum(a){let u=a.length;if(u===0)return!1;let g=parseInt(a.charAt(u-1),10);return Oe.getStandardUPCEANChecksum(a.substring(0,u-1))===g}static getStandardUPCEANChecksum(a){let u=a.length,g=0;for(let v=u-1;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new it;g+=w}g*=3;for(let v=u-2;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new it;g+=w}return(1e3-g)%10}static decodeEnd(a,u){return Oe.findGuardPattern(a,u,!1,Oe.START_END_PATTERN,new Int32Array(Oe.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(a,u,g,v){return this.findGuardPattern(a,u,g,v,new Int32Array(v.length))}static findGuardPattern(a,u,g,v,w){let I=a.getSize();u=g?a.getNextUnset(u):a.getNextSet(u);let O=0,F=u,q=v.length,te=g;for(let ue=u;ue<I;ue++)if(a.get(ue)!==te)w[O]++;else{if(O===q-1){if(rt.patternMatchVariance(w,v,Oe.MAX_INDIVIDUAL_VARIANCE)<Oe.MAX_AVG_VARIANCE)return Int32Array.from([F,ue]);F+=w[0]+w[1];let xe=w.slice(2,w.length-1);for(let ze=0;ze<O-1;ze++)w[ze]=xe[ze];w[O-1]=0,w[O]=0,O--}else O++;w[O]=1,te=!te}throw new Ne}static decodeDigit(a,u,g,v){this.recordPattern(a,g,u);let w=this.MAX_AVG_VARIANCE,I=-1,O=v.length;for(let F=0;F<O;F++){let q=v[F],te=rt.patternMatchVariance(u,q,Oe.MAX_INDIVIDUAL_VARIANCE);te<w&&(w=te,I=F)}if(I>=0)return I;throw new Ne}}Oe.MAX_AVG_VARIANCE=.48,Oe.MAX_INDIVIDUAL_VARIANCE=.7,Oe.START_END_PATTERN=Int32Array.from([1,1,1]),Oe.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Oe.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Oe.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class At{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(a,u,g){let v=this.decodeRowStringBuffer,w=this.decodeMiddle(u,g,v),I=v.toString(),O=At.parseExtensionString(I),F=[new nn((g[0]+g[1])/2,a),new nn(w,a)],q=new _t(I,null,0,F,Bt.UPC_EAN_EXTENSION,new Date().getTime());return O!=null&&q.putAllMetadata(O),q}decodeMiddle(a,u,g){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],O=0;for(let q=0;q<5&&I<w;q++){let te=Oe.decodeDigit(a,v,I,Oe.L_AND_G_PATTERNS);g+=String.fromCharCode(48+te%10);for(let ue of v)I+=ue;te>=10&&(O|=1<<4-q),q!==4&&(I=a.getNextSet(I),I=a.getNextUnset(I))}if(g.length!==5)throw new Ne;let F=this.determineCheckDigit(O);if(At.extensionChecksum(g.toString())!==F)throw new Ne;return I}static extensionChecksum(a){let u=a.length,g=0;for(let v=u-2;v>=0;v-=2)g+=a.charAt(v).charCodeAt(0)-48;g*=3;for(let v=u-1;v>=0;v-=2)g+=a.charAt(v).charCodeAt(0)-48;return g*=3,g%10}determineCheckDigit(a){for(let u=0;u<10;u++)if(a===this.CHECK_DIGIT_ENCODINGS[u])return u;throw new Ne}static parseExtensionString(a){if(a.length!==5)return null;let u=At.parseExtension5String(a);return u==null?null:new Map([[an.SUGGESTED_PRICE,u]])}static parseExtension5String(a){let u;switch(a.charAt(0)){case"0":u="";break;case"5":u="$";break;case"9":switch(a){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}u="";break;default:u="";break}let g=parseInt(a.substring(1)),v=(g/100).toString(),w=g%100,I=w<10?"0"+w:w.toString();return u+v+"."+I}}class jt{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(a,u,g){let v=this.decodeRowStringBuffer,w=this.decodeMiddle(u,g,v),I=v.toString(),O=jt.parseExtensionString(I),F=[new nn((g[0]+g[1])/2,a),new nn(w,a)],q=new _t(I,null,0,F,Bt.UPC_EAN_EXTENSION,new Date().getTime());return O!=null&&q.putAllMetadata(O),q}decodeMiddle(a,u,g){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],O=0;for(let F=0;F<2&&I<w;F++){let q=Oe.decodeDigit(a,v,I,Oe.L_AND_G_PATTERNS);g+=String.fromCharCode(48+q%10);for(let te of v)I+=te;q>=10&&(O|=1<<1-F),F!==1&&(I=a.getNextSet(I),I=a.getNextUnset(I))}if(g.length!==2)throw new Ne;if(parseInt(g.toString())%4!==O)throw new Ne;return I}static parseExtensionString(a){return a.length!==2?null:new Map([[an.ISSUE_NUMBER,parseInt(a)]])}}class _n{static decodeRow(a,u,g){let v=Oe.findGuardPattern(u,g,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new At().decodeRow(a,u,v)}catch{return new jt().decodeRow(a,u,v)}}}_n.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class mn extends Oe{constructor(){super(),this.decodeRowStringBuffer="",mn.L_AND_G_PATTERNS=mn.L_PATTERNS.map(a=>Int32Array.from(a));for(let a=10;a<20;a++){let u=mn.L_PATTERNS[a-10],g=new Int32Array(u.length);for(let v=0;v<u.length;v++)g[v]=u[u.length-v-1];mn.L_AND_G_PATTERNS[a]=g}}decodeRow(a,u,g){let v=mn.findStartGuardPattern(u),w=g==null?null:g.get(Et.NEED_RESULT_POINT_CALLBACK);if(w!=null){const xn=new nn((v[0]+v[1])/2,a);w.foundPossibleResultPoint(xn)}let I=this.decodeMiddle(u,v,this.decodeRowStringBuffer),O=I.rowOffset,F=I.resultString;if(w!=null){const xn=new nn(O,a);w.foundPossibleResultPoint(xn)}let q=this.decodeEnd(u,O);if(w!=null){const xn=new nn((q[0]+q[1])/2,a);w.foundPossibleResultPoint(xn)}let te=q[1],ue=te+(te-q[0]);if(ue>=u.getSize()||!u.isRange(te,ue,!1))throw new Ne;let xe=F.toString();if(xe.length<8)throw new it;if(!mn.checkChecksum(xe))throw new we;let ze=(v[1]+v[0])/2,ot=(q[1]+q[0])/2,ht=this.getBarcodeFormat(),Dt=[new nn(ze,a),new nn(ot,a)],qt=new _t(xe,null,0,Dt,ht,new Date().getTime()),Sn=0;try{let xn=_n.decodeRow(a,u,q[1]);qt.putMetadata(an.UPC_EAN_EXTENSION,xn.getText()),qt.putAllMetadata(xn.getResultMetadata()),qt.addResultPoints(xn.getResultPoints()),Sn=xn.getText().length}catch{}let wn=g==null?null:g.get(Et.ALLOWED_EAN_EXTENSIONS);if(wn!=null){let xn=!1;for(let Yi in wn)if(Sn.toString()===Yi){xn=!0;break}if(!xn)throw new Ne}return qt}decodeEnd(a,u){return mn.findGuardPattern(a,u,!1,mn.START_END_PATTERN,new Int32Array(mn.START_END_PATTERN.length).fill(0))}static checkChecksum(a){return mn.checkStandardUPCEANChecksum(a)}static checkStandardUPCEANChecksum(a){let u=a.length;if(u===0)return!1;let g=parseInt(a.charAt(u-1),10);return mn.getStandardUPCEANChecksum(a.substring(0,u-1))===g}static getStandardUPCEANChecksum(a){let u=a.length,g=0;for(let v=u-1;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new it;g+=w}g*=3;for(let v=u-2;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new it;g+=w}return(1e3-g)%10}}class ti extends mn{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(a,u,g){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],O=0;for(let q=0;q<6&&I<w;q++){let te=mn.decodeDigit(a,v,I,mn.L_AND_G_PATTERNS);g+=String.fromCharCode(48+te%10);for(let ue of v)I+=ue;te>=10&&(O|=1<<5-q)}g=ti.determineFirstDigit(g,O),I=mn.findGuardPattern(a,I,!0,mn.MIDDLE_PATTERN,new Int32Array(mn.MIDDLE_PATTERN.length).fill(0))[1];for(let q=0;q<6&&I<w;q++){let te=mn.decodeDigit(a,v,I,mn.L_PATTERNS);g+=String.fromCharCode(48+te);for(let ue of v)I+=ue}return{rowOffset:I,resultString:g}}getBarcodeFormat(){return Bt.EAN_13}static determineFirstDigit(a,u){for(let g=0;g<10;g++)if(u===this.FIRST_DIGIT_ENCODINGS[g])return a=String.fromCharCode(48+g)+a,a;throw new Ne}}ti.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class ut extends mn{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(a,u,g){const v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1];for(let F=0;F<4&&I<w;F++){let q=mn.decodeDigit(a,v,I,mn.L_PATTERNS);g+=String.fromCharCode(48+q);for(let te of v)I+=te}I=mn.findGuardPattern(a,I,!0,mn.MIDDLE_PATTERN,new Int32Array(mn.MIDDLE_PATTERN.length).fill(0))[1];for(let F=0;F<4&&I<w;F++){let q=mn.decodeDigit(a,v,I,mn.L_PATTERNS);g+=String.fromCharCode(48+q);for(let te of v)I+=te}return{rowOffset:I,resultString:g}}getBarcodeFormat(){return Bt.EAN_8}}class ai extends mn{constructor(){super(...arguments),this.ean13Reader=new ti}getBarcodeFormat(){return Bt.UPC_A}decode(a,u){return this.maybeReturnResult(this.ean13Reader.decode(a))}decodeRow(a,u,g){return this.maybeReturnResult(this.ean13Reader.decodeRow(a,u,g))}decodeMiddle(a,u,g){return this.ean13Reader.decodeMiddle(a,u,g)}maybeReturnResult(a){let u=a.getText();if(u.charAt(0)==="0"){let g=new _t(u.substring(1),null,null,a.getResultPoints(),Bt.UPC_A);return a.getResultMetadata()!=null&&g.putAllMetadata(a.getResultMetadata()),g}else throw new Ne}reset(){this.ean13Reader.reset()}}class Qn extends mn{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(a,u,g){const v=this.decodeMiddleCounters.map(q=>q);v[0]=0,v[1]=0,v[2]=0,v[3]=0;const w=a.getSize();let I=u[1],O=0;for(let q=0;q<6&&I<w;q++){const te=Qn.decodeDigit(a,v,I,Qn.L_AND_G_PATTERNS);g+=String.fromCharCode(48+te%10);for(let ue of v)I+=ue;te>=10&&(O|=1<<5-q)}let F=Qn.determineNumSysAndCheckDigit(g,O);return{rowOffset:I,resultString:F}}decodeEnd(a,u){return Qn.findGuardPatternWithoutCounters(a,u,!0,Qn.MIDDLE_END_PATTERN)}checkChecksum(a){return mn.checkChecksum(Qn.convertUPCEtoUPCA(a))}static determineNumSysAndCheckDigit(a,u){for(let g=0;g<=1;g++)for(let v=0;v<10;v++)if(u===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[g][v]){let w=String.fromCharCode(48+g),I=String.fromCharCode(48+v);return w+a+I}throw Ne.getNotFoundInstance()}getBarcodeFormat(){return Bt.UPC_E}static convertUPCEtoUPCA(a){const u=a.slice(1,7).split("").map(w=>w.charCodeAt(0)),g=new vt;g.append(a.charAt(0));let v=u[5];switch(v){case 0:case 1:case 2:g.appendChars(u,0,2),g.append(v),g.append("0000"),g.appendChars(u,2,3);break;case 3:g.appendChars(u,0,3),g.append("00000"),g.appendChars(u,3,2);break;case 4:g.appendChars(u,0,4),g.append("00000"),g.append(u[4]);break;default:g.appendChars(u,0,5),g.append("0000"),g.append(v);break}return a.length>=8&&g.append(a.charAt(7)),g.toString()}}Qn.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Qn.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Kn extends rt{constructor(a){super();let u=a==null?null:a.get(Et.POSSIBLE_FORMATS),g=[];C(u)?(g.push(new ti),g.push(new ai),g.push(new ut),g.push(new Qn)):(u.indexOf(Bt.EAN_13)>-1&&g.push(new ti),u.indexOf(Bt.UPC_A)>-1&&g.push(new ai),u.indexOf(Bt.EAN_8)>-1&&g.push(new ut),u.indexOf(Bt.UPC_E)>-1&&g.push(new Qn)),this.readers=g}decodeRow(a,u,g){for(let v of this.readers)try{const w=v.decodeRow(a,u,g),I=w.getBarcodeFormat()===Bt.EAN_13&&w.getText().charAt(0)==="0",O=g==null?null:g.get(Et.POSSIBLE_FORMATS),F=O==null||O.includes(Bt.UPC_A);if(I&&F){const q=w.getRawBytes(),te=new _t(w.getText().substring(1),q,q?q.length:null,w.getResultPoints(),Bt.UPC_A);return te.putAllMetadata(w.getResultMetadata()),te}return w}catch{}throw new Ne}reset(){for(let a of this.readers)a.reset()}}class Jn extends rt{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(a,u){for(let g=0;g<u.length;g++)if(rt.patternMatchVariance(a,u[g],Jn.MAX_INDIVIDUAL_VARIANCE)<Jn.MAX_AVG_VARIANCE)return g;throw new Ne}static count(a){return In.sum(new Int32Array(a))}static increment(a,u){let g=0,v=u[0];for(let w=1;w<a.length;w++)u[w]>v&&(v=u[w],g=w);a[g]++}static decrement(a,u){let g=0,v=u[0];for(let w=1;w<a.length;w++)u[w]<v&&(v=u[w],g=w);a[g]--}static isFinderPattern(a){let u=a[0]+a[1],g=u+a[2]+a[3],v=u/g;if(v>=Jn.MIN_FINDER_PATTERN_RATIO&&v<=Jn.MAX_FINDER_PATTERN_RATIO){let w=Number.MAX_SAFE_INTEGER,I=Number.MIN_SAFE_INTEGER;for(let O of a)O>I&&(I=O),O<w&&(w=O);return I<10*w}return!1}}Jn.MAX_AVG_VARIANCE=.2,Jn.MAX_INDIVIDUAL_VARIANCE=.45,Jn.MIN_FINDER_PATTERN_RATIO=9.5/12,Jn.MAX_FINDER_PATTERN_RATIO=12.5/14;class lr{constructor(a,u){this.value=a,this.checksumPortion=u}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(a){if(!(a instanceof lr))return!1;const u=a;return this.value===u.value&&this.checksumPortion===u.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Mi{constructor(a,u,g,v,w){this.value=a,this.startEnd=u,this.value=a,this.startEnd=u,this.resultPoints=new Array,this.resultPoints.push(new nn(g,w)),this.resultPoints.push(new nn(v,w))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(a){if(!(a instanceof Mi))return!1;const u=a;return this.value===u.value}hashCode(){return this.value}}class ni{constructor(){}static getRSSvalue(a,u,g){let v=0;for(let F of a)v+=F;let w=0,I=0,O=a.length;for(let F=0;F<O-1;F++){let q;for(q=1,I|=1<<F;q<a[F];q++,I&=~(1<<F)){let te=ni.combins(v-q-1,O-F-2);if(g&&I===0&&v-q-(O-F-1)>=O-F-1&&(te-=ni.combins(v-q-(O-F),O-F-2)),O-F-1>1){let ue=0;for(let xe=v-q-(O-F-2);xe>u;xe--)ue+=ni.combins(v-q-xe-1,O-F-3);te-=ue*(O-1-F)}else v-q>u&&te--;w+=te}v-=q}return w}static combins(a,u){let g,v;a-u>u?(v=u,g=a-u):(v=a-u,g=u);let w=1,I=1;for(let O=a;O>g;O--)w*=O,I<=v&&(w/=I,I++);for(;I<=v;)w/=I,I++;return w}}class zi{static buildBitArray(a){let u=a.length*2-1;a[a.length-1].getRightChar()==null&&(u-=1);let g=12*u,v=new pt(g),w=0,O=a[0].getRightChar().getValue();for(let F=11;F>=0;--F)(O&1<<F)!=0&&v.set(w),w++;for(let F=1;F<a.length;++F){let q=a[F],te=q.getLeftChar().getValue();for(let ue=11;ue>=0;--ue)(te&1<<ue)!=0&&v.set(w),w++;if(q.getRightChar()!=null){let ue=q.getRightChar().getValue();for(let xe=11;xe>=0;--xe)(ue&1<<xe)!=0&&v.set(w),w++}}return v}}class Ei{constructor(a,u){u?this.decodedInformation=null:(this.finished=a,this.decodedInformation=u)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Bi{constructor(a){this.newPosition=a}getNewPosition(){return this.newPosition}}class Cr extends Bi{constructor(a,u){super(a),this.value=u}getValue(){return this.value}isFNC1(){return this.value===Cr.FNC1}}Cr.FNC1="$";class Jt extends Bi{constructor(a,u,g){super(a),g?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=u}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class gi extends Bi{constructor(a,u,g){if(super(a),u<0||u>10||g<0||g>10)throw new it;this.firstDigit=u,this.secondDigit=g}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===gi.FNC1}isSecondDigitFNC1(){return this.secondDigit===gi.FNC1}isAnyFNC1(){return this.firstDigit===gi.FNC1||this.secondDigit===gi.FNC1}}gi.FNC1=10;class An{constructor(){}static parseFieldsInGeneralPurpose(a){if(!a)return null;if(a.length<2)throw new Ne;let u=a.substring(0,2);for(let w of An.TWO_DIGIT_DATA_LENGTH)if(w[0]===u)return w[1]===An.VARIABLE_LENGTH?An.processVariableAI(2,w[2],a):An.processFixedAI(2,w[1],a);if(a.length<3)throw new Ne;let g=a.substring(0,3);for(let w of An.THREE_DIGIT_DATA_LENGTH)if(w[0]===g)return w[1]===An.VARIABLE_LENGTH?An.processVariableAI(3,w[2],a):An.processFixedAI(3,w[1],a);for(let w of An.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(w[0]===g)return w[1]===An.VARIABLE_LENGTH?An.processVariableAI(4,w[2],a):An.processFixedAI(4,w[1],a);if(a.length<4)throw new Ne;let v=a.substring(0,4);for(let w of An.FOUR_DIGIT_DATA_LENGTH)if(w[0]===v)return w[1]===An.VARIABLE_LENGTH?An.processVariableAI(4,w[2],a):An.processFixedAI(4,w[1],a);throw new Ne}static processFixedAI(a,u,g){if(g.length<a)throw new Ne;let v=g.substring(0,a);if(g.length<a+u)throw new Ne;let w=g.substring(a,a+u),I=g.substring(a+u),O="("+v+")"+w,F=An.parseFieldsInGeneralPurpose(I);return F==null?O:O+F}static processVariableAI(a,u,g){let v=g.substring(0,a),w;g.length<a+u?w=g.length:w=a+u;let I=g.substring(a,w),O=g.substring(w),F="("+v+")"+I,q=An.parseFieldsInGeneralPurpose(O);return q==null?F:F+q}}An.VARIABLE_LENGTH=[],An.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",An.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",An.VARIABLE_LENGTH,20],["22",An.VARIABLE_LENGTH,29],["30",An.VARIABLE_LENGTH,8],["37",An.VARIABLE_LENGTH,8],["90",An.VARIABLE_LENGTH,30],["91",An.VARIABLE_LENGTH,30],["92",An.VARIABLE_LENGTH,30],["93",An.VARIABLE_LENGTH,30],["94",An.VARIABLE_LENGTH,30],["95",An.VARIABLE_LENGTH,30],["96",An.VARIABLE_LENGTH,30],["97",An.VARIABLE_LENGTH,3],["98",An.VARIABLE_LENGTH,30],["99",An.VARIABLE_LENGTH,30]],An.THREE_DIGIT_DATA_LENGTH=[["240",An.VARIABLE_LENGTH,30],["241",An.VARIABLE_LENGTH,30],["242",An.VARIABLE_LENGTH,6],["250",An.VARIABLE_LENGTH,30],["251",An.VARIABLE_LENGTH,30],["253",An.VARIABLE_LENGTH,17],["254",An.VARIABLE_LENGTH,20],["400",An.VARIABLE_LENGTH,30],["401",An.VARIABLE_LENGTH,30],["402",17],["403",An.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",An.VARIABLE_LENGTH,20],["421",An.VARIABLE_LENGTH,15],["422",3],["423",An.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],An.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",An.VARIABLE_LENGTH,15],["391",An.VARIABLE_LENGTH,18],["392",An.VARIABLE_LENGTH,15],["393",An.VARIABLE_LENGTH,18],["703",An.VARIABLE_LENGTH,30]],An.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",An.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",An.VARIABLE_LENGTH,20],["8003",An.VARIABLE_LENGTH,30],["8004",An.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",An.VARIABLE_LENGTH,30],["8008",An.VARIABLE_LENGTH,12],["8018",18],["8020",An.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",An.VARIABLE_LENGTH,70],["8200",An.VARIABLE_LENGTH,70]];class ar{constructor(a){this.buffer=new vt,this.information=a}decodeAllCodes(a,u){let g=u,v=null;do{let w=this.decodeGeneralPurposeField(g,v),I=An.parseFieldsInGeneralPurpose(w.getNewString());if(I!=null&&a.append(I),w.isRemaining()?v=""+w.getRemainingValue():v=null,g===w.getNewPosition())break;g=w.getNewPosition()}while(!0);return a.toString()}isStillNumeric(a){if(a+7>this.information.getSize())return a+4<=this.information.getSize();for(let u=a;u<a+3;++u)if(this.information.get(u))return!0;return this.information.get(a+3)}decodeNumeric(a){if(a+7>this.information.getSize()){let w=this.extractNumericValueFromBitArray(a,4);return w===0?new gi(this.information.getSize(),gi.FNC1,gi.FNC1):new gi(this.information.getSize(),w-1,gi.FNC1)}let u=this.extractNumericValueFromBitArray(a,7),g=(u-8)/11,v=(u-8)%11;return new gi(a+7,g,v)}extractNumericValueFromBitArray(a,u){return ar.extractNumericValueFromBitArray(this.information,a,u)}static extractNumericValueFromBitArray(a,u,g){let v=0;for(let w=0;w<g;++w)a.get(u+w)&&(v|=1<<g-w-1);return v}decodeGeneralPurposeField(a,u){this.buffer.setLengthToZero(),u!=null&&this.buffer.append(u),this.current.setPosition(a);let g=this.parseBlocks();return g!=null&&g.isRemaining()?new Jt(this.current.getPosition(),this.buffer.toString(),g.getRemainingValue()):new Jt(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let a,u;do{let g=this.current.getPosition();if(this.current.isAlpha()?(u=this.parseAlphaBlock(),a=u.isFinished()):this.current.isIsoIec646()?(u=this.parseIsoIec646Block(),a=u.isFinished()):(u=this.parseNumericBlock(),a=u.isFinished()),!(g!==this.current.getPosition())&&!a)break}while(!a);return u.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let a=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFirstDigitFNC1()){let u;return a.isSecondDigitFNC1()?u=new Jt(this.current.getPosition(),this.buffer.toString()):u=new Jt(this.current.getPosition(),this.buffer.toString(),a.getSecondDigit()),new Ei(!0,u)}if(this.buffer.append(a.getFirstDigit()),a.isSecondDigitFNC1()){let u=new Jt(this.current.getPosition(),this.buffer.toString());return new Ei(!0,u)}this.buffer.append(a.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Ei(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let a=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFNC1()){let u=new Jt(this.current.getPosition(),this.buffer.toString());return new Ei(!0,u)}this.buffer.append(a.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Ei(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let a=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFNC1()){let u=new Jt(this.current.getPosition(),this.buffer.toString());return new Ei(!0,u)}this.buffer.append(a.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Ei(!1)}isStillIsoIec646(a){if(a+5>this.information.getSize())return!1;let u=this.extractNumericValueFromBitArray(a,5);if(u>=5&&u<16)return!0;if(a+7>this.information.getSize())return!1;let g=this.extractNumericValueFromBitArray(a,7);if(g>=64&&g<116)return!0;if(a+8>this.information.getSize())return!1;let v=this.extractNumericValueFromBitArray(a,8);return v>=232&&v<253}decodeIsoIec646(a){let u=this.extractNumericValueFromBitArray(a,5);if(u===15)return new Cr(a+5,Cr.FNC1);if(u>=5&&u<15)return new Cr(a+5,"0"+(u-5));let g=this.extractNumericValueFromBitArray(a,7);if(g>=64&&g<90)return new Cr(a+7,""+(g+1));if(g>=90&&g<116)return new Cr(a+7,""+(g+7));let v=this.extractNumericValueFromBitArray(a,8),w;switch(v){case 232:w="!";break;case 233:w='"';break;case 234:w="%";break;case 235:w="&";break;case 236:w="'";break;case 237:w="(";break;case 238:w=")";break;case 239:w="*";break;case 240:w="+";break;case 241:w=",";break;case 242:w="-";break;case 243:w=".";break;case 244:w="/";break;case 245:w=":";break;case 246:w=";";break;case 247:w="<";break;case 248:w="=";break;case 249:w=">";break;case 250:w="?";break;case 251:w="_";break;case 252:w=" ";break;default:throw new it}return new Cr(a+8,w)}isStillAlpha(a){if(a+5>this.information.getSize())return!1;let u=this.extractNumericValueFromBitArray(a,5);if(u>=5&&u<16)return!0;if(a+6>this.information.getSize())return!1;let g=this.extractNumericValueFromBitArray(a,6);return g>=16&&g<63}decodeAlphanumeric(a){let u=this.extractNumericValueFromBitArray(a,5);if(u===15)return new Cr(a+5,Cr.FNC1);if(u>=5&&u<15)return new Cr(a+5,"0"+(u-5));let g=this.extractNumericValueFromBitArray(a,6);if(g>=32&&g<58)return new Cr(a+6,""+(g+33));let v;switch(g){case 58:v="*";break;case 59:v=",";break;case 60:v="-";break;case 61:v=".";break;case 62:v="/";break;default:throw new _i("Decoding invalid alphanumeric value: "+g)}return new Cr(a+6,v)}isAlphaTo646ToAlphaLatch(a){if(a+1>this.information.getSize())return!1;for(let u=0;u<5&&u+a<this.information.getSize();++u)if(u===2){if(!this.information.get(a+2))return!1}else if(this.information.get(a+u))return!1;return!0}isAlphaOr646ToNumericLatch(a){if(a+3>this.information.getSize())return!1;for(let u=a;u<a+3;++u)if(this.information.get(u))return!1;return!0}isNumericToAlphaNumericLatch(a){if(a+1>this.information.getSize())return!1;for(let u=0;u<4&&u+a<this.information.getSize();++u)if(this.information.get(a+u))return!1;return!0}}class Zi{constructor(a){this.information=a,this.generalDecoder=new ar(a)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class ln extends Zi{constructor(a){super(a)}encodeCompressedGtin(a,u){a.append("(01)");let g=a.length();a.append("9"),this.encodeCompressedGtinWithoutAI(a,u,g)}encodeCompressedGtinWithoutAI(a,u,g){for(let v=0;v<4;++v){let w=this.getGeneralDecoder().extractNumericValueFromBitArray(u+10*v,10);w/100===0&&a.append("0"),w/10===0&&a.append("0"),a.append(w)}ln.appendCheckDigit(a,g)}static appendCheckDigit(a,u){let g=0;for(let v=0;v<13;v++){let w=a.charAt(v+u).charCodeAt(0)-48;g+=(v&1)===0?3*w:w}g=10-g%10,g===10&&(g=0),a.append(g)}}ln.GTIN_SIZE=40;class Ue extends ln{constructor(a){super(a)}parseInformation(){let a=new vt;a.append("(01)");let u=a.length(),g=this.getGeneralDecoder().extractNumericValueFromBitArray(Ue.HEADER_SIZE,4);return a.append(g),this.encodeCompressedGtinWithoutAI(a,Ue.HEADER_SIZE+4,u),this.getGeneralDecoder().decodeAllCodes(a,Ue.HEADER_SIZE+44)}}Ue.HEADER_SIZE=4;class mt extends Zi{constructor(a){super(a)}parseInformation(){let a=new vt;return this.getGeneralDecoder().decodeAllCodes(a,mt.HEADER_SIZE)}}mt.HEADER_SIZE=5;class $t extends ln{constructor(a){super(a)}encodeCompressedWeight(a,u,g){let v=this.getGeneralDecoder().extractNumericValueFromBitArray(u,g);this.addWeightCode(a,v);let w=this.checkWeight(v),I=1e5;for(let O=0;O<5;++O)w/I===0&&a.append("0"),I/=10;a.append(w)}}class gn extends $t{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()!=gn.HEADER_SIZE+$t.GTIN_SIZE+gn.WEIGHT_SIZE)throw new Ne;let a=new vt;return this.encodeCompressedGtin(a,gn.HEADER_SIZE),this.encodeCompressedWeight(a,gn.HEADER_SIZE+$t.GTIN_SIZE,gn.WEIGHT_SIZE),a.toString()}}gn.HEADER_SIZE=5,gn.WEIGHT_SIZE=15;class un extends gn{constructor(a){super(a)}addWeightCode(a,u){a.append("(3103)")}checkWeight(a){return a}}class fn extends gn{constructor(a){super(a)}addWeightCode(a,u){u<1e4?a.append("(3202)"):a.append("(3203)")}checkWeight(a){return a<1e4?a:a-1e4}}class Rn extends ln{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()<Rn.HEADER_SIZE+ln.GTIN_SIZE)throw new Ne;let a=new vt;this.encodeCompressedGtin(a,Rn.HEADER_SIZE);let u=this.getGeneralDecoder().extractNumericValueFromBitArray(Rn.HEADER_SIZE+ln.GTIN_SIZE,Rn.LAST_DIGIT_SIZE);a.append("(392"),a.append(u),a.append(")");let g=this.getGeneralDecoder().decodeGeneralPurposeField(Rn.HEADER_SIZE+ln.GTIN_SIZE+Rn.LAST_DIGIT_SIZE,null);return a.append(g.getNewString()),a.toString()}}Rn.HEADER_SIZE=8,Rn.LAST_DIGIT_SIZE=2;class Hn extends ln{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()<Hn.HEADER_SIZE+ln.GTIN_SIZE)throw new Ne;let a=new vt;this.encodeCompressedGtin(a,Hn.HEADER_SIZE);let u=this.getGeneralDecoder().extractNumericValueFromBitArray(Hn.HEADER_SIZE+ln.GTIN_SIZE,Hn.LAST_DIGIT_SIZE);a.append("(393"),a.append(u),a.append(")");let g=this.getGeneralDecoder().extractNumericValueFromBitArray(Hn.HEADER_SIZE+ln.GTIN_SIZE+Hn.LAST_DIGIT_SIZE,Hn.FIRST_THREE_DIGITS_SIZE);g/100==0&&a.append("0"),g/10==0&&a.append("0"),a.append(g);let v=this.getGeneralDecoder().decodeGeneralPurposeField(Hn.HEADER_SIZE+ln.GTIN_SIZE+Hn.LAST_DIGIT_SIZE+Hn.FIRST_THREE_DIGITS_SIZE,null);return a.append(v.getNewString()),a.toString()}}Hn.HEADER_SIZE=8,Hn.LAST_DIGIT_SIZE=2,Hn.FIRST_THREE_DIGITS_SIZE=10;class Fn extends $t{constructor(a,u,g){super(a),this.dateCode=g,this.firstAIdigits=u}parseInformation(){if(this.getInformation().getSize()!=Fn.HEADER_SIZE+Fn.GTIN_SIZE+Fn.WEIGHT_SIZE+Fn.DATE_SIZE)throw new Ne;let a=new vt;return this.encodeCompressedGtin(a,Fn.HEADER_SIZE),this.encodeCompressedWeight(a,Fn.HEADER_SIZE+Fn.GTIN_SIZE,Fn.WEIGHT_SIZE),this.encodeCompressedDate(a,Fn.HEADER_SIZE+Fn.GTIN_SIZE+Fn.WEIGHT_SIZE),a.toString()}encodeCompressedDate(a,u){let g=this.getGeneralDecoder().extractNumericValueFromBitArray(u,Fn.DATE_SIZE);if(g==38400)return;a.append("("),a.append(this.dateCode),a.append(")");let v=g%32;g/=32;let w=g%12+1;g/=12;let I=g;I/10==0&&a.append("0"),a.append(I),w/10==0&&a.append("0"),a.append(w),v/10==0&&a.append("0"),a.append(v)}addWeightCode(a,u){a.append("("),a.append(this.firstAIdigits),a.append(u/1e5),a.append(")")}checkWeight(a){return a%1e5}}Fn.HEADER_SIZE=8,Fn.WEIGHT_SIZE=20,Fn.DATE_SIZE=16;function ki(le){try{if(le.get(1))return new Ue(le);if(!le.get(2))return new mt(le);switch(ar.extractNumericValueFromBitArray(le,1,4)){case 4:return new un(le);case 5:return new fn(le)}switch(ar.extractNumericValueFromBitArray(le,1,5)){case 12:return new Rn(le);case 13:return new Hn(le)}switch(ar.extractNumericValueFromBitArray(le,1,7)){case 56:return new Fn(le,"310","11");case 57:return new Fn(le,"320","11");case 58:return new Fn(le,"310","13");case 59:return new Fn(le,"320","13");case 60:return new Fn(le,"310","15");case 61:return new Fn(le,"320","15");case 62:return new Fn(le,"310","17");case 63:return new Fn(le,"320","17")}}catch(a){throw console.log(a),new _i("unknown decoder: "+le)}}class xi{constructor(a,u,g,v){this.leftchar=a,this.rightchar=u,this.finderpattern=g,this.maybeLast=v}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(a,u){return a instanceof xi?xi.equalsOrNull(a.leftchar,u.leftchar)&&xi.equalsOrNull(a.rightchar,u.rightchar)&&xi.equalsOrNull(a.finderpattern,u.finderpattern):!1}static equalsOrNull(a,u){return a===null?u===null:xi.equals(a,u)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class bi{constructor(a,u,g){this.pairs=a,this.rowNumber=u,this.wasReversed=g}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(a){return this.checkEqualitity(this,a)}toString(){return"{ "+this.pairs+" }"}equals(a,u){return a instanceof bi?this.checkEqualitity(a,u)&&a.wasReversed===u.wasReversed:!1}checkEqualitity(a,u){if(!a||!u)return;let g;return a.forEach((v,w)=>{u.forEach(I=>{v.getLeftChar().getValue()===I.getLeftChar().getValue()&&v.getRightChar().getValue()===I.getRightChar().getValue()&&v.getFinderPatter().getValue()===I.getFinderPatter().getValue()&&(g=!0)})}),g}}class Ct extends Jn{constructor(a){super(...arguments),this.pairs=new Array(Ct.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=a===!0}decodeRow(a,u,g){this.pairs.length=0,this.startFromEven=!1;try{return Ct.constructResult(this.decodeRow2pairs(a,u))}catch(v){this.verbose&&console.log(v)}return this.pairs.length=0,this.startFromEven=!0,Ct.constructResult(this.decodeRow2pairs(a,u))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(a,u){let g=!1;for(;!g;)try{this.pairs.push(this.retrieveNextPair(u,this.pairs,a))}catch(w){if(w instanceof Ne){if(!this.pairs.length)throw new Ne;g=!0}}if(this.checkChecksum())return this.pairs;let v;if(this.rows.length?v=!0:v=!1,this.storeRow(a,!1),v){let w=this.checkRowsBoolean(!1);if(w!=null||(w=this.checkRowsBoolean(!0),w!=null))return w}throw new Ne}checkRowsBoolean(a){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,a&&(this.rows=this.rows.reverse());let u=null;try{u=this.checkRows(new Array,0)}catch(g){this.verbose&&console.log(g)}return a&&(this.rows=this.rows.reverse()),u}checkRows(a,u){for(let g=u;g<this.rows.length;g++){let v=this.rows[g];this.pairs.length=0;for(let I of a)this.pairs.push(I.getPairs());if(this.pairs.push(v.getPairs()),!Ct.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let w=new Array(a);w.push(v);try{return this.checkRows(w,g+1)}catch(I){this.verbose&&console.log(I)}}throw new Ne}static isValidSequence(a){for(let u of Ct.FINDER_PATTERN_SEQUENCES){if(a.length>u.length)continue;let g=!0;for(let v=0;v<a.length;v++)if(a[v].getFinderPattern().getValue()!=u[v]){g=!1;break}if(g)return!0}return!1}storeRow(a,u){let g=0,v=!1,w=!1;for(;g<this.rows.length;){let I=this.rows[g];if(I.getRowNumber()>a){w=I.isEquivalent(this.pairs);break}v=I.isEquivalent(this.pairs),g++}w||v||Ct.isPartialRow(this.pairs,this.rows)||(this.rows.push(g,new bi(this.pairs,a,u)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(a,u){for(let g of u)if(g.getPairs().length!==a.length){for(let v of g.getPairs())for(let w of a)if(xi.equals(v,w))break}}static isPartialRow(a,u){for(let g of u){let v=!0;for(let w of a){let I=!1;for(let O of g.getPairs())if(w.equals(O)){I=!0;break}if(!I){v=!1;break}}if(v)return!0}return!1}getRows(){return this.rows}static constructResult(a){let u=zi.buildBitArray(a),v=ki(u).parseInformation(),w=a[0].getFinderPattern().getResultPoints(),I=a[a.length-1].getFinderPattern().getResultPoints(),O=[w[0],w[1],I[0],I[1]];return new _t(v,null,null,O,Bt.RSS_EXPANDED,null)}checkChecksum(){let a=this.pairs.get(0),u=a.getLeftChar(),g=a.getRightChar();if(g==null)return!1;let v=g.getChecksumPortion(),w=2;for(let O=1;O<this.pairs.size();++O){let F=this.pairs.get(O);v+=F.getLeftChar().getChecksumPortion(),w++;let q=F.getRightChar();q!=null&&(v+=q.getChecksumPortion(),w++)}return v%=211,211*(w-4)+v==u.getValue()}static getNextSecondBar(a,u){let g;return a.get(u)?(g=a.getNextUnset(u),g=a.getNextSet(g)):(g=a.getNextSet(u),g=a.getNextUnset(g)),g}retrieveNextPair(a,u,g){let v=u.length%2==0;this.startFromEven&&(v=!v);let w,I=!0,O=-1;do this.findNextPair(a,u,O),w=this.parseFoundFinderPattern(a,g,v),w==null?O=Ct.getNextSecondBar(a,this.startEnd[0]):I=!1;while(I);let F=this.decodeDataCharacter(a,w,v,!0);if(!this.isEmptyPair(u)&&u[u.length-1].mustBeLast())throw new Ne;let q;try{q=this.decodeDataCharacter(a,w,v,!1)}catch(te){q=null,this.verbose&&console.log(te)}return new xi(F,q,w,!0)}isEmptyPair(a){return a.length===0}findNextPair(a,u,g){let v=this.getDecodeFinderCounters();v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I;g>=0?I=g:this.isEmptyPair(u)?I=0:I=u[u.length-1].getFinderPattern().getStartEnd()[1];let O=u.length%2!=0;this.startFromEven&&(O=!O);let F=!1;for(;I<w&&(F=!a.get(I),!!F);)I++;let q=0,te=I;for(let ue=I;ue<w;ue++)if(a.get(ue)!=F)v[q]++;else{if(q==3){if(O&&Ct.reverseCounters(v),Ct.isFinderPattern(v)){this.startEnd[0]=te,this.startEnd[1]=ue;return}O&&Ct.reverseCounters(v),te+=v[0]+v[1],v[0]=v[2],v[1]=v[3],v[2]=0,v[3]=0,q--}else q++;v[q]=1,F=!F}throw new Ne}static reverseCounters(a){let u=a.length;for(let g=0;g<u/2;++g){let v=a[g];a[g]=a[u-g-1],a[u-g-1]=v}}parseFoundFinderPattern(a,u,g){let v,w,I;if(g){let q=this.startEnd[0]-1;for(;q>=0&&!a.get(q);)q--;q++,v=this.startEnd[0]-q,w=q,I=this.startEnd[1]}else w=this.startEnd[0],I=a.getNextUnset(this.startEnd[1]+1),v=I-this.startEnd[1];let O=this.getDecodeFinderCounters();me.arraycopy(O,0,O,1,O.length-1),O[0]=v;let F;try{F=this.parseFinderValue(O,Ct.FINDER_PATTERNS)}catch{return null}return new Mi(F,[w,I],w,I,u)}decodeDataCharacter(a,u,g,v){let w=this.getDataCharacterCounters();for(let Ar=0;Ar<w.length;Ar++)w[Ar]=0;if(v)Ct.recordPatternInReverse(a,u.getStartEnd()[0],w);else{Ct.recordPattern(a,u.getStartEnd()[1],w);for(let Ar=0,ss=w.length-1;Ar<ss;Ar++,ss--){let Qs=w[Ar];w[Ar]=w[ss],w[ss]=Qs}}let I=17,O=In.sum(new Int32Array(w))/I,F=(u.getStartEnd()[1]-u.getStartEnd()[0])/15;if(Math.abs(O-F)/F>.3)throw new Ne;let q=this.getOddCounts(),te=this.getEvenCounts(),ue=this.getOddRoundingErrors(),xe=this.getEvenRoundingErrors();for(let Ar=0;Ar<w.length;Ar++){let ss=1*w[Ar]/O,Qs=ss+.5;if(Qs<1){if(ss<.3)throw new Ne;Qs=1}else if(Qs>8){if(ss>8.7)throw new Ne;Qs=8}let ao=Ar/2;(Ar&1)==0?(q[ao]=Qs,ue[ao]=ss-Qs):(te[ao]=Qs,xe[ao]=ss-Qs)}this.adjustOddEvenCounts(I);let ze=4*u.getValue()+(g?0:2)+(v?0:1)-1,ot=0,ht=0;for(let Ar=q.length-1;Ar>=0;Ar--){if(Ct.isNotA1left(u,g,v)){let ss=Ct.WEIGHTS[ze][2*Ar];ht+=q[Ar]*ss}ot+=q[Ar]}let Dt=0;for(let Ar=te.length-1;Ar>=0;Ar--)if(Ct.isNotA1left(u,g,v)){let ss=Ct.WEIGHTS[ze][2*Ar+1];Dt+=te[Ar]*ss}let qt=ht+Dt;if((ot&1)!=0||ot>13||ot<4)throw new Ne;let Sn=(13-ot)/2,wn=Ct.SYMBOL_WIDEST[Sn],xn=9-wn,Yi=ni.getRSSvalue(q,wn,!0),Wn=ni.getRSSvalue(te,xn,!1),rs=Ct.EVEN_TOTAL_SUBSET[Sn],xa=Ct.GSUM[Sn],Vs=Yi*rs+Wn+xa;return new lr(Vs,qt)}static isNotA1left(a,u,g){return!(a.getValue()==0&&u&&g)}adjustOddEvenCounts(a){let u=In.sum(new Int32Array(this.getOddCounts())),g=In.sum(new Int32Array(this.getEvenCounts())),v=!1,w=!1;u>13?w=!0:u<4&&(v=!0);let I=!1,O=!1;g>13?O=!0:g<4&&(I=!0);let F=u+g-a,q=(u&1)==1,te=(g&1)==0;if(F==1)if(q){if(te)throw new Ne;w=!0}else{if(!te)throw new Ne;O=!0}else if(F==-1)if(q){if(te)throw new Ne;v=!0}else{if(!te)throw new Ne;I=!0}else if(F==0){if(q){if(!te)throw new Ne;u<g?(v=!0,O=!0):(w=!0,I=!0)}else if(te)throw new Ne}else throw new Ne;if(v){if(w)throw new Ne;Ct.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(w&&Ct.decrement(this.getOddCounts(),this.getOddRoundingErrors()),I){if(O)throw new Ne;Ct.increment(this.getEvenCounts(),this.getOddRoundingErrors())}O&&Ct.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Ct.SYMBOL_WIDEST=[7,5,4,3,1],Ct.EVEN_TOTAL_SUBSET=[4,20,52,104,204],Ct.GSUM=[0,348,1388,2948,3988],Ct.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],Ct.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],Ct.FINDER_PAT_A=0,Ct.FINDER_PAT_B=1,Ct.FINDER_PAT_C=2,Ct.FINDER_PAT_D=3,Ct.FINDER_PAT_E=4,Ct.FINDER_PAT_F=5,Ct.FINDER_PATTERN_SEQUENCES=[[Ct.FINDER_PAT_A,Ct.FINDER_PAT_A],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_B,Ct.FINDER_PAT_B],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_C,Ct.FINDER_PAT_B,Ct.FINDER_PAT_D],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_E,Ct.FINDER_PAT_B,Ct.FINDER_PAT_D,Ct.FINDER_PAT_C],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_E,Ct.FINDER_PAT_B,Ct.FINDER_PAT_D,Ct.FINDER_PAT_D,Ct.FINDER_PAT_F],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_E,Ct.FINDER_PAT_B,Ct.FINDER_PAT_D,Ct.FINDER_PAT_E,Ct.FINDER_PAT_F,Ct.FINDER_PAT_F],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_A,Ct.FINDER_PAT_B,Ct.FINDER_PAT_B,Ct.FINDER_PAT_C,Ct.FINDER_PAT_C,Ct.FINDER_PAT_D,Ct.FINDER_PAT_D],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_A,Ct.FINDER_PAT_B,Ct.FINDER_PAT_B,Ct.FINDER_PAT_C,Ct.FINDER_PAT_C,Ct.FINDER_PAT_D,Ct.FINDER_PAT_E,Ct.FINDER_PAT_E],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_A,Ct.FINDER_PAT_B,Ct.FINDER_PAT_B,Ct.FINDER_PAT_C,Ct.FINDER_PAT_C,Ct.FINDER_PAT_D,Ct.FINDER_PAT_E,Ct.FINDER_PAT_F,Ct.FINDER_PAT_F],[Ct.FINDER_PAT_A,Ct.FINDER_PAT_A,Ct.FINDER_PAT_B,Ct.FINDER_PAT_B,Ct.FINDER_PAT_C,Ct.FINDER_PAT_D,Ct.FINDER_PAT_D,Ct.FINDER_PAT_E,Ct.FINDER_PAT_E,Ct.FINDER_PAT_F,Ct.FINDER_PAT_F]],Ct.MAX_PAIRS=11;class Zn extends lr{constructor(a,u,g){super(a,u),this.count=0,this.finderPattern=g}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class En extends Jn{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(a,u,g){const v=this.decodePair(u,!1,a,g);En.addOrTally(this.possibleLeftPairs,v),u.reverse();let w=this.decodePair(u,!0,a,g);En.addOrTally(this.possibleRightPairs,w),u.reverse();for(let I of this.possibleLeftPairs)if(I.getCount()>1){for(let O of this.possibleRightPairs)if(O.getCount()>1&&En.checkChecksum(I,O))return En.constructResult(I,O)}throw new Ne}static addOrTally(a,u){if(u==null)return;let g=!1;for(let v of a)if(v.getValue()===u.getValue()){v.incrementCount(),g=!0;break}g||a.push(u)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(a,u){let g=4537077*a.getValue()+u.getValue(),v=new String(g).toString(),w=new vt;for(let q=13-v.length;q>0;q--)w.append("0");w.append(v);let I=0;for(let q=0;q<13;q++){let te=w.charAt(q).charCodeAt(0)-48;I+=(q&1)===0?3*te:te}I=10-I%10,I===10&&(I=0),w.append(I.toString());let O=a.getFinderPattern().getResultPoints(),F=u.getFinderPattern().getResultPoints();return new _t(w.toString(),null,0,[O[0],O[1],F[0],F[1]],Bt.RSS_14,new Date().getTime())}static checkChecksum(a,u){let g=(a.getChecksumPortion()+16*u.getChecksumPortion())%79,v=9*a.getFinderPattern().getValue()+u.getFinderPattern().getValue();return v>72&&v--,v>8&&v--,g===v}decodePair(a,u,g,v){try{let w=this.findFinderPattern(a,u),I=this.parseFoundFinderPattern(a,g,u,w),O=v==null?null:v.get(Et.NEED_RESULT_POINT_CALLBACK);if(O!=null){let te=(w[0]+w[1])/2;u&&(te=a.getSize()-1-te),O.foundPossibleResultPoint(new nn(te,g))}let F=this.decodeDataCharacter(a,I,!0),q=this.decodeDataCharacter(a,I,!1);return new Zn(1597*F.getValue()+q.getValue(),F.getChecksumPortion()+4*q.getChecksumPortion(),I)}catch{return null}}decodeDataCharacter(a,u,g){let v=this.getDataCharacterCounters();for(let Dt=0;Dt<v.length;Dt++)v[Dt]=0;if(g)rt.recordPatternInReverse(a,u.getStartEnd()[0],v);else{rt.recordPattern(a,u.getStartEnd()[1]+1,v);for(let Dt=0,qt=v.length-1;Dt<qt;Dt++,qt--){let Sn=v[Dt];v[Dt]=v[qt],v[qt]=Sn}}let w=g?16:15,I=In.sum(new Int32Array(v))/w,O=this.getOddCounts(),F=this.getEvenCounts(),q=this.getOddRoundingErrors(),te=this.getEvenRoundingErrors();for(let Dt=0;Dt<v.length;Dt++){let qt=v[Dt]/I,Sn=Math.floor(qt+.5);Sn<1?Sn=1:Sn>8&&(Sn=8);let wn=Math.floor(Dt/2);(Dt&1)===0?(O[wn]=Sn,q[wn]=qt-Sn):(F[wn]=Sn,te[wn]=qt-Sn)}this.adjustOddEvenCounts(g,w);let ue=0,xe=0;for(let Dt=O.length-1;Dt>=0;Dt--)xe*=9,xe+=O[Dt],ue+=O[Dt];let ze=0,ot=0;for(let Dt=F.length-1;Dt>=0;Dt--)ze*=9,ze+=F[Dt],ot+=F[Dt];let ht=xe+3*ze;if(g){if((ue&1)!==0||ue>12||ue<4)throw new Ne;let Dt=(12-ue)/2,qt=En.OUTSIDE_ODD_WIDEST[Dt],Sn=9-qt,wn=ni.getRSSvalue(O,qt,!1),xn=ni.getRSSvalue(F,Sn,!0),Yi=En.OUTSIDE_EVEN_TOTAL_SUBSET[Dt],Wn=En.OUTSIDE_GSUM[Dt];return new lr(wn*Yi+xn+Wn,ht)}else{if((ot&1)!==0||ot>10||ot<4)throw new Ne;let Dt=(10-ot)/2,qt=En.INSIDE_ODD_WIDEST[Dt],Sn=9-qt,wn=ni.getRSSvalue(O,qt,!0),xn=ni.getRSSvalue(F,Sn,!1),Yi=En.INSIDE_ODD_TOTAL_SUBSET[Dt],Wn=En.INSIDE_GSUM[Dt];return new lr(xn*Yi+wn+Wn,ht)}}findFinderPattern(a,u){let g=this.getDecodeFinderCounters();g[0]=0,g[1]=0,g[2]=0,g[3]=0;let v=a.getSize(),w=!1,I=0;for(;I<v&&(w=!a.get(I),u!==w);)I++;let O=0,F=I;for(let q=I;q<v;q++)if(a.get(q)!==w)g[O]++;else{if(O===3){if(Jn.isFinderPattern(g))return[F,q];F+=g[0]+g[1],g[0]=g[2],g[1]=g[3],g[2]=0,g[3]=0,O--}else O++;g[O]=1,w=!w}throw new Ne}parseFoundFinderPattern(a,u,g,v){let w=a.get(v[0]),I=v[0]-1;for(;I>=0&&w!==a.get(I);)I--;I++;const O=v[0]-I,F=this.getDecodeFinderCounters(),q=new Int32Array(F.length);me.arraycopy(F,0,q,1,F.length-1),q[0]=O;const te=this.parseFinderValue(q,En.FINDER_PATTERNS);let ue=I,xe=v[1];return g&&(ue=a.getSize()-1-ue,xe=a.getSize()-1-xe),new Mi(te,[I,v[1]],ue,xe,u)}adjustOddEvenCounts(a,u){let g=In.sum(new Int32Array(this.getOddCounts())),v=In.sum(new Int32Array(this.getEvenCounts())),w=!1,I=!1,O=!1,F=!1;a?(g>12?I=!0:g<4&&(w=!0),v>12?F=!0:v<4&&(O=!0)):(g>11?I=!0:g<5&&(w=!0),v>10?F=!0:v<4&&(O=!0));let q=g+v-u,te=(g&1)===(a?1:0),ue=(v&1)===1;if(q===1)if(te){if(ue)throw new Ne;I=!0}else{if(!ue)throw new Ne;F=!0}else if(q===-1)if(te){if(ue)throw new Ne;w=!0}else{if(!ue)throw new Ne;O=!0}else if(q===0){if(te){if(!ue)throw new Ne;g<v?(w=!0,F=!0):(I=!0,O=!0)}else if(ue)throw new Ne}else throw new Ne;if(w){if(I)throw new Ne;Jn.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(I&&Jn.decrement(this.getOddCounts(),this.getOddRoundingErrors()),O){if(F)throw new Ne;Jn.increment(this.getEvenCounts(),this.getOddRoundingErrors())}F&&Jn.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}En.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],En.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],En.OUTSIDE_GSUM=[0,161,961,2015,2715],En.INSIDE_GSUM=[0,336,1036,1516],En.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],En.INSIDE_ODD_WIDEST=[2,4,6,8],En.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class Ri extends rt{constructor(a,u){super(),this.readers=[],this.verbose=u===!0;const g=a?a.get(Et.POSSIBLE_FORMATS):null,v=a&&a.get(Et.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;g?((g.includes(Bt.EAN_13)||g.includes(Bt.UPC_A)||g.includes(Bt.EAN_8)||g.includes(Bt.UPC_E))&&this.readers.push(new Kn(a)),g.includes(Bt.CODE_39)&&this.readers.push(new Ze(v)),g.includes(Bt.CODE_128)&&this.readers.push(new de),g.includes(Bt.ITF)&&this.readers.push(new yt),g.includes(Bt.RSS_14)&&this.readers.push(new En),g.includes(Bt.RSS_EXPANDED)&&this.readers.push(new Ct(this.verbose))):(this.readers.push(new Kn(a)),this.readers.push(new Ze),this.readers.push(new Kn(a)),this.readers.push(new de),this.readers.push(new yt),this.readers.push(new En),this.readers.push(new Ct(this.verbose)))}decodeRow(a,u,g){for(let v=0;v<this.readers.length;v++)try{return this.readers[v].decodeRow(a,u,g)}catch{}throw new Ne}reset(){this.readers.forEach(a=>a.reset())}}class ii extends Nt{constructor(a=500,u){super(new Ri(u),a,u)}}class $n{constructor(a,u,g){this.ecCodewords=a,this.ecBlocks=[u],g&&this.ecBlocks.push(g)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class jn{constructor(a,u){this.count=a,this.dataCodewords=u}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class li{constructor(a,u,g,v,w,I){this.versionNumber=a,this.symbolSizeRows=u,this.symbolSizeColumns=g,this.dataRegionSizeRows=v,this.dataRegionSizeColumns=w,this.ecBlocks=I;let O=0;const F=I.getECCodewords(),q=I.getECBlocks();for(let te of q)O+=te.getCount()*(te.getDataCodewords()+F);this.totalCodewords=O}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(a,u){if((a&1)!==0||(u&1)!==0)throw new it;for(let g of li.VERSIONS)if(g.symbolSizeRows===a&&g.symbolSizeColumns===u)return g;throw new it}toString(){return""+this.versionNumber}static buildVersions(){return[new li(1,10,10,8,8,new $n(5,new jn(1,3))),new li(2,12,12,10,10,new $n(7,new jn(1,5))),new li(3,14,14,12,12,new $n(10,new jn(1,8))),new li(4,16,16,14,14,new $n(12,new jn(1,12))),new li(5,18,18,16,16,new $n(14,new jn(1,18))),new li(6,20,20,18,18,new $n(18,new jn(1,22))),new li(7,22,22,20,20,new $n(20,new jn(1,30))),new li(8,24,24,22,22,new $n(24,new jn(1,36))),new li(9,26,26,24,24,new $n(28,new jn(1,44))),new li(10,32,32,14,14,new $n(36,new jn(1,62))),new li(11,36,36,16,16,new $n(42,new jn(1,86))),new li(12,40,40,18,18,new $n(48,new jn(1,114))),new li(13,44,44,20,20,new $n(56,new jn(1,144))),new li(14,48,48,22,22,new $n(68,new jn(1,174))),new li(15,52,52,24,24,new $n(42,new jn(2,102))),new li(16,64,64,14,14,new $n(56,new jn(2,140))),new li(17,72,72,16,16,new $n(36,new jn(4,92))),new li(18,80,80,18,18,new $n(48,new jn(4,114))),new li(19,88,88,20,20,new $n(56,new jn(4,144))),new li(20,96,96,22,22,new $n(68,new jn(4,174))),new li(21,104,104,24,24,new $n(56,new jn(6,136))),new li(22,120,120,18,18,new $n(68,new jn(6,175))),new li(23,132,132,20,20,new $n(62,new jn(8,163))),new li(24,144,144,22,22,new $n(62,new jn(8,156),new jn(2,155))),new li(25,8,18,6,16,new $n(7,new jn(1,5))),new li(26,8,32,6,14,new $n(11,new jn(1,10))),new li(27,12,26,10,24,new $n(14,new jn(1,16))),new li(28,12,36,10,16,new $n(18,new jn(1,22))),new li(29,16,36,14,16,new $n(24,new jn(1,32))),new li(30,16,48,14,22,new $n(28,new jn(1,49)))]}}li.VERSIONS=li.buildVersions();class us{constructor(a){const u=a.getHeight();if(u<8||u>144||(u&1)!==0)throw new it;this.version=us.readVersion(a),this.mappingBitMatrix=this.extractDataRegion(a),this.readMappingMatrix=new Zt(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(a){const u=a.getHeight(),g=a.getWidth();return li.getVersionForDimensions(u,g)}readCodewords(){const a=new Int8Array(this.version.getTotalCodewords());let u=0,g=4,v=0;const w=this.mappingBitMatrix.getHeight(),I=this.mappingBitMatrix.getWidth();let O=!1,F=!1,q=!1,te=!1;do if(g===w&&v===0&&!O)a[u++]=this.readCorner1(w,I)&255,g-=2,v+=2,O=!0;else if(g===w-2&&v===0&&(I&3)!==0&&!F)a[u++]=this.readCorner2(w,I)&255,g-=2,v+=2,F=!0;else if(g===w+4&&v===2&&(I&7)===0&&!q)a[u++]=this.readCorner3(w,I)&255,g-=2,v+=2,q=!0;else if(g===w-2&&v===0&&(I&7)===4&&!te)a[u++]=this.readCorner4(w,I)&255,g-=2,v+=2,te=!0;else{do g<w&&v>=0&&!this.readMappingMatrix.get(v,g)&&(a[u++]=this.readUtah(g,v,w,I)&255),g-=2,v+=2;while(g>=0&&v<I);g+=1,v+=3;do g>=0&&v<I&&!this.readMappingMatrix.get(v,g)&&(a[u++]=this.readUtah(g,v,w,I)&255),g+=2,v-=2;while(g<w&&v>=0);g+=3,v+=1}while(g<w||v<I);if(u!==this.version.getTotalCodewords())throw new it;return a}readModule(a,u,g,v){return a<0&&(a+=g,u+=4-(g+4&7)),u<0&&(u+=v,a+=4-(v+4&7)),this.readMappingMatrix.set(u,a),this.mappingBitMatrix.get(u,a)}readUtah(a,u,g,v){let w=0;return this.readModule(a-2,u-2,g,v)&&(w|=1),w<<=1,this.readModule(a-2,u-1,g,v)&&(w|=1),w<<=1,this.readModule(a-1,u-2,g,v)&&(w|=1),w<<=1,this.readModule(a-1,u-1,g,v)&&(w|=1),w<<=1,this.readModule(a-1,u,g,v)&&(w|=1),w<<=1,this.readModule(a,u-2,g,v)&&(w|=1),w<<=1,this.readModule(a,u-1,g,v)&&(w|=1),w<<=1,this.readModule(a,u,g,v)&&(w|=1),w}readCorner1(a,u){let g=0;return this.readModule(a-1,0,a,u)&&(g|=1),g<<=1,this.readModule(a-1,1,a,u)&&(g|=1),g<<=1,this.readModule(a-1,2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-1,a,u)&&(g|=1),g<<=1,this.readModule(1,u-1,a,u)&&(g|=1),g<<=1,this.readModule(2,u-1,a,u)&&(g|=1),g<<=1,this.readModule(3,u-1,a,u)&&(g|=1),g}readCorner2(a,u){let g=0;return this.readModule(a-3,0,a,u)&&(g|=1),g<<=1,this.readModule(a-2,0,a,u)&&(g|=1),g<<=1,this.readModule(a-1,0,a,u)&&(g|=1),g<<=1,this.readModule(0,u-4,a,u)&&(g|=1),g<<=1,this.readModule(0,u-3,a,u)&&(g|=1),g<<=1,this.readModule(0,u-2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-1,a,u)&&(g|=1),g<<=1,this.readModule(1,u-1,a,u)&&(g|=1),g}readCorner3(a,u){let g=0;return this.readModule(a-1,0,a,u)&&(g|=1),g<<=1,this.readModule(a-1,u-1,a,u)&&(g|=1),g<<=1,this.readModule(0,u-3,a,u)&&(g|=1),g<<=1,this.readModule(0,u-2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-1,a,u)&&(g|=1),g<<=1,this.readModule(1,u-3,a,u)&&(g|=1),g<<=1,this.readModule(1,u-2,a,u)&&(g|=1),g<<=1,this.readModule(1,u-1,a,u)&&(g|=1),g}readCorner4(a,u){let g=0;return this.readModule(a-3,0,a,u)&&(g|=1),g<<=1,this.readModule(a-2,0,a,u)&&(g|=1),g<<=1,this.readModule(a-1,0,a,u)&&(g|=1),g<<=1,this.readModule(0,u-2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-1,a,u)&&(g|=1),g<<=1,this.readModule(1,u-1,a,u)&&(g|=1),g<<=1,this.readModule(2,u-1,a,u)&&(g|=1),g<<=1,this.readModule(3,u-1,a,u)&&(g|=1),g}extractDataRegion(a){const u=this.version.getSymbolSizeRows(),g=this.version.getSymbolSizeColumns();if(a.getHeight()!==u)throw new Q("Dimension of bitMatrix must match the version size");const v=this.version.getDataRegionSizeRows(),w=this.version.getDataRegionSizeColumns(),I=u/v|0,O=g/w|0,F=I*v,q=O*w,te=new Zt(q,F);for(let ue=0;ue<I;++ue){const xe=ue*v;for(let ze=0;ze<O;++ze){const ot=ze*w;for(let ht=0;ht<v;++ht){const Dt=ue*(v+2)+1+ht,qt=xe+ht;for(let Sn=0;Sn<w;++Sn){const wn=ze*(w+2)+1+Sn;if(a.get(wn,Dt)){const xn=ot+Sn;te.set(xn,qt)}}}}}return te}}class Xr{constructor(a,u){this.numDataCodewords=a,this.codewords=u}static getDataBlocks(a,u){const g=u.getECBlocks();let v=0;const w=g.getECBlocks();for(let ht of w)v+=ht.getCount();const I=new Array(v);let O=0;for(let ht of w)for(let Dt=0;Dt<ht.getCount();Dt++){const qt=ht.getDataCodewords(),Sn=g.getECCodewords()+qt;I[O++]=new Xr(qt,new Uint8Array(Sn))}const q=I[0].codewords.length-g.getECCodewords(),te=q-1;let ue=0;for(let ht=0;ht<te;ht++)for(let Dt=0;Dt<O;Dt++)I[Dt].codewords[ht]=a[ue++];const xe=u.getVersionNumber()===24,ze=xe?8:O;for(let ht=0;ht<ze;ht++)I[ht].codewords[q-1]=a[ue++];const ot=I[0].codewords.length;for(let ht=q;ht<ot;ht++)for(let Dt=0;Dt<O;Dt++){const qt=xe?(Dt+8)%O:Dt,Sn=xe&&qt>7?ht-1:ht;I[qt].codewords[Sn]=a[ue++]}if(ue!==a.length)throw new Q;return I}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class ci{constructor(a){this.bytes=a,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(a){if(a<1||a>32||a>this.available())throw new Q(""+a);let u=0,g=this.bitOffset,v=this.byteOffset;const w=this.bytes;if(g>0){const I=8-g,O=a<I?a:I,F=I-O,q=255>>8-O<<F;u=(w[v]&q)>>F,a-=O,g+=O,g===8&&(g=0,v++)}if(a>0){for(;a>=8;)u=u<<8|w[v]&255,v++,a-=8;if(a>0){const I=8-a,O=255>>I<<I;u=u<<a|(w[v]&O)>>I,g+=a}}return this.bitOffset=g,this.byteOffset=v,u}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Un;(function(le){le[le.PAD_ENCODE=0]="PAD_ENCODE",le[le.ASCII_ENCODE=1]="ASCII_ENCODE",le[le.C40_ENCODE=2]="C40_ENCODE",le[le.TEXT_ENCODE=3]="TEXT_ENCODE",le[le.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",le[le.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",le[le.BASE256_ENCODE=6]="BASE256_ENCODE"})(Un||(Un={}));class Tr{static decode(a){const u=new ci(a),g=new vt,v=new vt,w=new Array;let I=Un.ASCII_ENCODE;do if(I===Un.ASCII_ENCODE)I=this.decodeAsciiSegment(u,g,v);else{switch(I){case Un.C40_ENCODE:this.decodeC40Segment(u,g);break;case Un.TEXT_ENCODE:this.decodeTextSegment(u,g);break;case Un.ANSIX12_ENCODE:this.decodeAnsiX12Segment(u,g);break;case Un.EDIFACT_ENCODE:this.decodeEdifactSegment(u,g);break;case Un.BASE256_ENCODE:this.decodeBase256Segment(u,g,w);break;default:throw new it}I=Un.ASCII_ENCODE}while(I!==Un.PAD_ENCODE&&u.available()>0);return v.length()>0&&g.append(v.toString()),new sn(a,g.toString(),w.length===0?null:w,null)}static decodeAsciiSegment(a,u,g){let v=!1;do{let w=a.readBits(8);if(w===0)throw new it;if(w<=128)return v&&(w+=128),u.append(String.fromCharCode(w-1)),Un.ASCII_ENCODE;if(w===129)return Un.PAD_ENCODE;if(w<=229){const I=w-130;I<10&&u.append("0"),u.append(""+I)}else switch(w){case 230:return Un.C40_ENCODE;case 231:return Un.BASE256_ENCODE;case 232:u.append("");break;case 233:case 234:break;case 235:v=!0;break;case 236:u.append("[)>05"),g.insert(0,"");break;case 237:u.append("[)>06"),g.insert(0,"");break;case 238:return Un.ANSIX12_ENCODE;case 239:return Un.TEXT_ENCODE;case 240:return Un.EDIFACT_ENCODE;case 241:break;default:if(w!==254||a.available()!==0)throw new it;break}}while(a.available()>0);return Un.ASCII_ENCODE}static decodeC40Segment(a,u){let g=!1;const v=[];let w=0;do{if(a.available()===8)return;const I=a.readBits(8);if(I===254)return;this.parseTwoBytes(I,a.readBits(8),v);for(let O=0;O<3;O++){const F=v[O];switch(w){case 0:if(F<3)w=F+1;else if(F<this.C40_BASIC_SET_CHARS.length){const q=this.C40_BASIC_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q)}else throw new it;break;case 1:g?(u.append(String.fromCharCode(F+128)),g=!1):u.append(String.fromCharCode(F)),w=0;break;case 2:if(F<this.C40_SHIFT2_SET_CHARS.length){const q=this.C40_SHIFT2_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q)}else switch(F){case 27:u.append("");break;case 30:g=!0;break;default:throw new it}w=0;break;case 3:g?(u.append(String.fromCharCode(F+224)),g=!1):u.append(String.fromCharCode(F+96)),w=0;break;default:throw new it}}}while(a.available()>0)}static decodeTextSegment(a,u){let g=!1,v=[],w=0;do{if(a.available()===8)return;const I=a.readBits(8);if(I===254)return;this.parseTwoBytes(I,a.readBits(8),v);for(let O=0;O<3;O++){const F=v[O];switch(w){case 0:if(F<3)w=F+1;else if(F<this.TEXT_BASIC_SET_CHARS.length){const q=this.TEXT_BASIC_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q)}else throw new it;break;case 1:g?(u.append(String.fromCharCode(F+128)),g=!1):u.append(String.fromCharCode(F)),w=0;break;case 2:if(F<this.TEXT_SHIFT2_SET_CHARS.length){const q=this.TEXT_SHIFT2_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q)}else switch(F){case 27:u.append("");break;case 30:g=!0;break;default:throw new it}w=0;break;case 3:if(F<this.TEXT_SHIFT3_SET_CHARS.length){const q=this.TEXT_SHIFT3_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q),w=0}else throw new it;break;default:throw new it}}}while(a.available()>0)}static decodeAnsiX12Segment(a,u){const g=[];do{if(a.available()===8)return;const v=a.readBits(8);if(v===254)return;this.parseTwoBytes(v,a.readBits(8),g);for(let w=0;w<3;w++){const I=g[w];switch(I){case 0:u.append("\r");break;case 1:u.append("*");break;case 2:u.append(">");break;case 3:u.append(" ");break;default:if(I<14)u.append(String.fromCharCode(I+44));else if(I<40)u.append(String.fromCharCode(I+51));else throw new it;break}}}while(a.available()>0)}static parseTwoBytes(a,u,g){let v=(a<<8)+u-1,w=Math.floor(v/1600);g[0]=w,v-=w*1600,w=Math.floor(v/40),g[1]=w,g[2]=v-w*40}static decodeEdifactSegment(a,u){do{if(a.available()<=16)return;for(let g=0;g<4;g++){let v=a.readBits(6);if(v===31){const w=8-a.getBitOffset();w!==8&&a.readBits(w);return}(v&32)===0&&(v|=64),u.append(String.fromCharCode(v))}}while(a.available()>0)}static decodeBase256Segment(a,u,g){let v=1+a.getByteOffset();const w=this.unrandomize255State(a.readBits(8),v++);let I;if(w===0?I=a.available()/8|0:w<250?I=w:I=250*(w-249)+this.unrandomize255State(a.readBits(8),v++),I<0)throw new it;const O=new Uint8Array(I);for(let F=0;F<I;F++){if(a.available()<8)throw new it;O[F]=this.unrandomize255State(a.readBits(8),v++)}g.push(O);try{u.append(Pe.decode(O,ct.ISO88591))}catch(F){throw new _i("Platform does not support required encoding: "+F.message)}}static unrandomize255State(a,u){const g=149*u%255+1,v=a-g;return v>=0?v:v+256}}Tr.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Tr.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Tr.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Tr.TEXT_SHIFT2_SET_CHARS=Tr.C40_SHIFT2_SET_CHARS,Tr.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class Ss{constructor(){this.rsDecoder=new Di(kn.DATA_MATRIX_FIELD_256)}decode(a){const u=new us(a),g=u.getVersion(),v=u.readCodewords(),w=Xr.getDataBlocks(v,g);let I=0;for(let q of w)I+=q.getNumDataCodewords();const O=new Uint8Array(I),F=w.length;for(let q=0;q<F;q++){const te=w[q],ue=te.getCodewords(),xe=te.getNumDataCodewords();this.correctErrors(ue,xe);for(let ze=0;ze<xe;ze++)O[ze*F+q]=ue[ze]}return Tr.decode(O)}correctErrors(a,u){const g=new Int32Array(a);try{this.rsDecoder.decode(g,a.length-u)}catch{throw new we}for(let v=0;v<u;v++)a[v]=g[v]}}class Ji{constructor(a){this.image=a,this.rectangleDetector=new Pi(this.image)}detect(){const a=this.rectangleDetector.detect();let u=this.detectSolid1(a);if(u=this.detectSolid2(u),u[3]=this.correctTopRight(u),!u[3])throw new Ne;u=this.shiftToModuleCenter(u);const g=u[0],v=u[1],w=u[2],I=u[3];let O=this.transitionsBetween(g,I)+1,F=this.transitionsBetween(w,I)+1;(O&1)===1&&(O+=1),(F&1)===1&&(F+=1),4*O<7*F&&4*F<7*O&&(O=F=Math.max(O,F));let q=Ji.sampleGrid(this.image,g,v,w,I,O,F);return new Li(q,[g,v,w,I])}static shiftPoint(a,u,g){let v=(u.getX()-a.getX())/(g+1),w=(u.getY()-a.getY())/(g+1);return new nn(a.getX()+v,a.getY()+w)}static moveAway(a,u,g){let v=a.getX(),w=a.getY();return v<u?v-=1:v+=1,w<g?w-=1:w+=1,new nn(v,w)}detectSolid1(a){let u=a[0],g=a[1],v=a[3],w=a[2],I=this.transitionsBetween(u,g),O=this.transitionsBetween(g,v),F=this.transitionsBetween(v,w),q=this.transitionsBetween(w,u),te=I,ue=[w,u,g,v];return te>O&&(te=O,ue[0]=u,ue[1]=g,ue[2]=v,ue[3]=w),te>F&&(te=F,ue[0]=g,ue[1]=v,ue[2]=w,ue[3]=u),te>q&&(ue[0]=v,ue[1]=w,ue[2]=u,ue[3]=g),ue}detectSolid2(a){let u=a[0],g=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w),O=Ji.shiftPoint(g,v,(I+1)*4),F=Ji.shiftPoint(v,g,(I+1)*4),q=this.transitionsBetween(O,u),te=this.transitionsBetween(F,w);return q<te?(a[0]=u,a[1]=g,a[2]=v,a[3]=w):(a[0]=g,a[1]=v,a[2]=w,a[3]=u),a}correctTopRight(a){let u=a[0],g=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w),O=this.transitionsBetween(g,w),F=Ji.shiftPoint(u,g,(O+1)*4),q=Ji.shiftPoint(v,g,(I+1)*4);I=this.transitionsBetween(F,w),O=this.transitionsBetween(q,w);let te=new nn(w.getX()+(v.getX()-g.getX())/(I+1),w.getY()+(v.getY()-g.getY())/(I+1)),ue=new nn(w.getX()+(u.getX()-g.getX())/(O+1),w.getY()+(u.getY()-g.getY())/(O+1));if(!this.isValid(te))return this.isValid(ue)?ue:null;if(!this.isValid(ue))return te;let xe=this.transitionsBetween(F,te)+this.transitionsBetween(q,te),ze=this.transitionsBetween(F,ue)+this.transitionsBetween(q,ue);return xe>ze?te:ue}shiftToModuleCenter(a){let u=a[0],g=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w)+1,O=this.transitionsBetween(v,w)+1,F=Ji.shiftPoint(u,g,O*4),q=Ji.shiftPoint(v,g,I*4);I=this.transitionsBetween(F,w)+1,O=this.transitionsBetween(q,w)+1,(I&1)===1&&(I+=1),(O&1)===1&&(O+=1);let te=(u.getX()+g.getX()+v.getX()+w.getX())/4,ue=(u.getY()+g.getY()+v.getY()+w.getY())/4;u=Ji.moveAway(u,te,ue),g=Ji.moveAway(g,te,ue),v=Ji.moveAway(v,te,ue),w=Ji.moveAway(w,te,ue);let xe,ze;return F=Ji.shiftPoint(u,g,O*4),F=Ji.shiftPoint(F,w,I*4),xe=Ji.shiftPoint(g,u,O*4),xe=Ji.shiftPoint(xe,v,I*4),q=Ji.shiftPoint(v,w,O*4),q=Ji.shiftPoint(q,g,I*4),ze=Ji.shiftPoint(w,v,O*4),ze=Ji.shiftPoint(ze,u,I*4),[F,xe,q,ze]}isValid(a){return a.getX()>=0&&a.getX()<this.image.getWidth()&&a.getY()>0&&a.getY()<this.image.getHeight()}static sampleGrid(a,u,g,v,w,I,O){return ce.getInstance().sampleGrid(a,I,O,.5,.5,I-.5,.5,I-.5,O-.5,.5,O-.5,u.getX(),u.getY(),w.getX(),w.getY(),v.getX(),v.getY(),g.getX(),g.getY())}transitionsBetween(a,u){let g=Math.trunc(a.getX()),v=Math.trunc(a.getY()),w=Math.trunc(u.getX()),I=Math.trunc(u.getY()),O=Math.abs(I-v)>Math.abs(w-g);if(O){let ht=g;g=v,v=ht,ht=w,w=I,I=ht}let F=Math.abs(w-g),q=Math.abs(I-v),te=-F/2,ue=v<I?1:-1,xe=g<w?1:-1,ze=0,ot=this.image.get(O?v:g,O?g:v);for(let ht=g,Dt=v;ht!==w;ht+=xe){let qt=this.image.get(O?Dt:ht,O?ht:Dt);if(qt!==ot&&(ze++,ot=qt),te+=q,te>0){if(Dt===I)break;Dt+=ue,te-=F}}return ze}}class Lr{constructor(){this.decoder=new Ss}decode(a,u=null){let g,v;if(u!=null&&u.has(Et.PURE_BARCODE)){const q=Lr.extractPureBits(a.getBlackMatrix());g=this.decoder.decode(q),v=Lr.NO_POINTS}else{const q=new Ji(a.getBlackMatrix()).detect();g=this.decoder.decode(q.getBits()),v=q.getPoints()}const w=g.getRawBytes(),I=new _t(g.getText(),w,8*w.length,v,Bt.DATA_MATRIX,me.currentTimeMillis()),O=g.getByteSegments();O!=null&&I.putMetadata(an.BYTE_SEGMENTS,O);const F=g.getECLevel();return F!=null&&I.putMetadata(an.ERROR_CORRECTION_LEVEL,F),I}reset(){}static extractPureBits(a){const u=a.getTopLeftOnBit(),g=a.getBottomRightOnBit();if(u==null||g==null)throw new Ne;const v=this.moduleSize(u,a);let w=u[1];const I=g[1];let O=u[0];const q=(g[0]-O+1)/v,te=(I-w+1)/v;if(q<=0||te<=0)throw new Ne;const ue=v/2;w+=ue,O+=ue;const xe=new Zt(q,te);for(let ze=0;ze<te;ze++){const ot=w+ze*v;for(let ht=0;ht<q;ht++)a.get(O+ht*v,ot)&&xe.set(ht,ze)}return xe}static moduleSize(a,u){const g=u.getWidth();let v=a[0];const w=a[1];for(;v<g&&u.get(v,w);)v++;if(v===g)throw new Ne;const I=v-a[0];if(I===0)throw new Ne;return I}}Lr.NO_POINTS=[];class hs extends Nt{constructor(a=500){super(new Lr,a)}}var Ho;(function(le){le[le.L=0]="L",le[le.M=1]="M",le[le.Q=2]="Q",le[le.H=3]="H"})(Ho||(Ho={}));class Fi{constructor(a,u,g){this.value=a,this.stringValue=u,this.bits=g,Fi.FOR_BITS.set(g,this),Fi.FOR_VALUE.set(a,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(a){switch(a){case"L":return Fi.L;case"M":return Fi.M;case"Q":return Fi.Q;case"H":return Fi.H;default:throw new Y(a+"not available")}}toString(){return this.stringValue}equals(a){if(!(a instanceof Fi))return!1;const u=a;return this.value===u.value}static forBits(a){if(a<0||a>=Fi.FOR_BITS.size)throw new Q;return Fi.FOR_BITS.get(a)}}Fi.FOR_BITS=new Map,Fi.FOR_VALUE=new Map,Fi.L=new Fi(Ho.L,"L",1),Fi.M=new Fi(Ho.M,"M",0),Fi.Q=new Fi(Ho.Q,"Q",3),Fi.H=new Fi(Ho.H,"H",2);class $r{constructor(a){this.errorCorrectionLevel=Fi.forBits(a>>3&3),this.dataMask=a&7}static numBitsDiffering(a,u){return Ye.bitCount(a^u)}static decodeFormatInformation(a,u){const g=$r.doDecodeFormatInformation(a,u);return g!==null?g:$r.doDecodeFormatInformation(a^$r.FORMAT_INFO_MASK_QR,u^$r.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(a,u){let g=Number.MAX_SAFE_INTEGER,v=0;for(const w of $r.FORMAT_INFO_DECODE_LOOKUP){const I=w[0];if(I===a||I===u)return new $r(w[1]);let O=$r.numBitsDiffering(a,I);O<g&&(v=w[1],g=O),a!==u&&(O=$r.numBitsDiffering(u,I),O<g&&(v=w[1],g=O))}return g<=3?new $r(v):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(a){if(!(a instanceof $r))return!1;const u=a;return this.errorCorrectionLevel===u.errorCorrectionLevel&&this.dataMask===u.dataMask}}$r.FORMAT_INFO_MASK_QR=21522,$r.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Rt{constructor(a,...u){this.ecCodewordsPerBlock=a,this.ecBlocks=u}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let a=0;const u=this.ecBlocks;for(const g of u)a+=g.getCount();return a}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class De{constructor(a,u){this.count=a,this.dataCodewords=u}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class oi{constructor(a,u,...g){this.versionNumber=a,this.alignmentPatternCenters=u,this.ecBlocks=g;let v=0;const w=g[0].getECCodewordsPerBlock(),I=g[0].getECBlocks();for(const O of I)v+=O.getCount()*(O.getDataCodewords()+w);this.totalCodewords=v}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(a){return this.ecBlocks[a.getValue()]}static getProvisionalVersionForDimension(a){if(a%4!==1)throw new it;try{return this.getVersionForNumber((a-17)/4)}catch{throw new it}}static getVersionForNumber(a){if(a<1||a>40)throw new Q;return oi.VERSIONS[a-1]}static decodeVersionInformation(a){let u=Number.MAX_SAFE_INTEGER,g=0;for(let v=0;v<oi.VERSION_DECODE_INFO.length;v++){const w=oi.VERSION_DECODE_INFO[v];if(w===a)return oi.getVersionForNumber(v+7);const I=$r.numBitsDiffering(a,w);I<u&&(g=v+7,u=I)}return u<=3?oi.getVersionForNumber(g):null}buildFunctionPattern(){const a=this.getDimensionForVersion(),u=new Zt(a);u.setRegion(0,0,9,9),u.setRegion(a-8,0,8,9),u.setRegion(0,a-8,9,8);const g=this.alignmentPatternCenters.length;for(let v=0;v<g;v++){const w=this.alignmentPatternCenters[v]-2;for(let I=0;I<g;I++)v===0&&(I===0||I===g-1)||v===g-1&&I===0||u.setRegion(this.alignmentPatternCenters[I]-2,w,5,5)}return u.setRegion(6,9,1,a-17),u.setRegion(9,6,a-17,1),this.versionNumber>6&&(u.setRegion(a-11,0,3,6),u.setRegion(0,a-11,6,3)),u}toString(){return""+this.versionNumber}}oi.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),oi.VERSIONS=[new oi(1,new Int32Array(0),new Rt(7,new De(1,19)),new Rt(10,new De(1,16)),new Rt(13,new De(1,13)),new Rt(17,new De(1,9))),new oi(2,Int32Array.from([6,18]),new Rt(10,new De(1,34)),new Rt(16,new De(1,28)),new Rt(22,new De(1,22)),new Rt(28,new De(1,16))),new oi(3,Int32Array.from([6,22]),new Rt(15,new De(1,55)),new Rt(26,new De(1,44)),new Rt(18,new De(2,17)),new Rt(22,new De(2,13))),new oi(4,Int32Array.from([6,26]),new Rt(20,new De(1,80)),new Rt(18,new De(2,32)),new Rt(26,new De(2,24)),new Rt(16,new De(4,9))),new oi(5,Int32Array.from([6,30]),new Rt(26,new De(1,108)),new Rt(24,new De(2,43)),new Rt(18,new De(2,15),new De(2,16)),new Rt(22,new De(2,11),new De(2,12))),new oi(6,Int32Array.from([6,34]),new Rt(18,new De(2,68)),new Rt(16,new De(4,27)),new Rt(24,new De(4,19)),new Rt(28,new De(4,15))),new oi(7,Int32Array.from([6,22,38]),new Rt(20,new De(2,78)),new Rt(18,new De(4,31)),new Rt(18,new De(2,14),new De(4,15)),new Rt(26,new De(4,13),new De(1,14))),new oi(8,Int32Array.from([6,24,42]),new Rt(24,new De(2,97)),new Rt(22,new De(2,38),new De(2,39)),new Rt(22,new De(4,18),new De(2,19)),new Rt(26,new De(4,14),new De(2,15))),new oi(9,Int32Array.from([6,26,46]),new Rt(30,new De(2,116)),new Rt(22,new De(3,36),new De(2,37)),new Rt(20,new De(4,16),new De(4,17)),new Rt(24,new De(4,12),new De(4,13))),new oi(10,Int32Array.from([6,28,50]),new Rt(18,new De(2,68),new De(2,69)),new Rt(26,new De(4,43),new De(1,44)),new Rt(24,new De(6,19),new De(2,20)),new Rt(28,new De(6,15),new De(2,16))),new oi(11,Int32Array.from([6,30,54]),new Rt(20,new De(4,81)),new Rt(30,new De(1,50),new De(4,51)),new Rt(28,new De(4,22),new De(4,23)),new Rt(24,new De(3,12),new De(8,13))),new oi(12,Int32Array.from([6,32,58]),new Rt(24,new De(2,92),new De(2,93)),new Rt(22,new De(6,36),new De(2,37)),new Rt(26,new De(4,20),new De(6,21)),new Rt(28,new De(7,14),new De(4,15))),new oi(13,Int32Array.from([6,34,62]),new Rt(26,new De(4,107)),new Rt(22,new De(8,37),new De(1,38)),new Rt(24,new De(8,20),new De(4,21)),new Rt(22,new De(12,11),new De(4,12))),new oi(14,Int32Array.from([6,26,46,66]),new Rt(30,new De(3,115),new De(1,116)),new Rt(24,new De(4,40),new De(5,41)),new Rt(20,new De(11,16),new De(5,17)),new Rt(24,new De(11,12),new De(5,13))),new oi(15,Int32Array.from([6,26,48,70]),new Rt(22,new De(5,87),new De(1,88)),new Rt(24,new De(5,41),new De(5,42)),new Rt(30,new De(5,24),new De(7,25)),new Rt(24,new De(11,12),new De(7,13))),new oi(16,Int32Array.from([6,26,50,74]),new Rt(24,new De(5,98),new De(1,99)),new Rt(28,new De(7,45),new De(3,46)),new Rt(24,new De(15,19),new De(2,20)),new Rt(30,new De(3,15),new De(13,16))),new oi(17,Int32Array.from([6,30,54,78]),new Rt(28,new De(1,107),new De(5,108)),new Rt(28,new De(10,46),new De(1,47)),new Rt(28,new De(1,22),new De(15,23)),new Rt(28,new De(2,14),new De(17,15))),new oi(18,Int32Array.from([6,30,56,82]),new Rt(30,new De(5,120),new De(1,121)),new Rt(26,new De(9,43),new De(4,44)),new Rt(28,new De(17,22),new De(1,23)),new Rt(28,new De(2,14),new De(19,15))),new oi(19,Int32Array.from([6,30,58,86]),new Rt(28,new De(3,113),new De(4,114)),new Rt(26,new De(3,44),new De(11,45)),new Rt(26,new De(17,21),new De(4,22)),new Rt(26,new De(9,13),new De(16,14))),new oi(20,Int32Array.from([6,34,62,90]),new Rt(28,new De(3,107),new De(5,108)),new Rt(26,new De(3,41),new De(13,42)),new Rt(30,new De(15,24),new De(5,25)),new Rt(28,new De(15,15),new De(10,16))),new oi(21,Int32Array.from([6,28,50,72,94]),new Rt(28,new De(4,116),new De(4,117)),new Rt(26,new De(17,42)),new Rt(28,new De(17,22),new De(6,23)),new Rt(30,new De(19,16),new De(6,17))),new oi(22,Int32Array.from([6,26,50,74,98]),new Rt(28,new De(2,111),new De(7,112)),new Rt(28,new De(17,46)),new Rt(30,new De(7,24),new De(16,25)),new Rt(24,new De(34,13))),new oi(23,Int32Array.from([6,30,54,78,102]),new Rt(30,new De(4,121),new De(5,122)),new Rt(28,new De(4,47),new De(14,48)),new Rt(30,new De(11,24),new De(14,25)),new Rt(30,new De(16,15),new De(14,16))),new oi(24,Int32Array.from([6,28,54,80,106]),new Rt(30,new De(6,117),new De(4,118)),new Rt(28,new De(6,45),new De(14,46)),new Rt(30,new De(11,24),new De(16,25)),new Rt(30,new De(30,16),new De(2,17))),new oi(25,Int32Array.from([6,32,58,84,110]),new Rt(26,new De(8,106),new De(4,107)),new Rt(28,new De(8,47),new De(13,48)),new Rt(30,new De(7,24),new De(22,25)),new Rt(30,new De(22,15),new De(13,16))),new oi(26,Int32Array.from([6,30,58,86,114]),new Rt(28,new De(10,114),new De(2,115)),new Rt(28,new De(19,46),new De(4,47)),new Rt(28,new De(28,22),new De(6,23)),new Rt(30,new De(33,16),new De(4,17))),new oi(27,Int32Array.from([6,34,62,90,118]),new Rt(30,new De(8,122),new De(4,123)),new Rt(28,new De(22,45),new De(3,46)),new Rt(30,new De(8,23),new De(26,24)),new Rt(30,new De(12,15),new De(28,16))),new oi(28,Int32Array.from([6,26,50,74,98,122]),new Rt(30,new De(3,117),new De(10,118)),new Rt(28,new De(3,45),new De(23,46)),new Rt(30,new De(4,24),new De(31,25)),new Rt(30,new De(11,15),new De(31,16))),new oi(29,Int32Array.from([6,30,54,78,102,126]),new Rt(30,new De(7,116),new De(7,117)),new Rt(28,new De(21,45),new De(7,46)),new Rt(30,new De(1,23),new De(37,24)),new Rt(30,new De(19,15),new De(26,16))),new oi(30,Int32Array.from([6,26,52,78,104,130]),new Rt(30,new De(5,115),new De(10,116)),new Rt(28,new De(19,47),new De(10,48)),new Rt(30,new De(15,24),new De(25,25)),new Rt(30,new De(23,15),new De(25,16))),new oi(31,Int32Array.from([6,30,56,82,108,134]),new Rt(30,new De(13,115),new De(3,116)),new Rt(28,new De(2,46),new De(29,47)),new Rt(30,new De(42,24),new De(1,25)),new Rt(30,new De(23,15),new De(28,16))),new oi(32,Int32Array.from([6,34,60,86,112,138]),new Rt(30,new De(17,115)),new Rt(28,new De(10,46),new De(23,47)),new Rt(30,new De(10,24),new De(35,25)),new Rt(30,new De(19,15),new De(35,16))),new oi(33,Int32Array.from([6,30,58,86,114,142]),new Rt(30,new De(17,115),new De(1,116)),new Rt(28,new De(14,46),new De(21,47)),new Rt(30,new De(29,24),new De(19,25)),new Rt(30,new De(11,15),new De(46,16))),new oi(34,Int32Array.from([6,34,62,90,118,146]),new Rt(30,new De(13,115),new De(6,116)),new Rt(28,new De(14,46),new De(23,47)),new Rt(30,new De(44,24),new De(7,25)),new Rt(30,new De(59,16),new De(1,17))),new oi(35,Int32Array.from([6,30,54,78,102,126,150]),new Rt(30,new De(12,121),new De(7,122)),new Rt(28,new De(12,47),new De(26,48)),new Rt(30,new De(39,24),new De(14,25)),new Rt(30,new De(22,15),new De(41,16))),new oi(36,Int32Array.from([6,24,50,76,102,128,154]),new Rt(30,new De(6,121),new De(14,122)),new Rt(28,new De(6,47),new De(34,48)),new Rt(30,new De(46,24),new De(10,25)),new Rt(30,new De(2,15),new De(64,16))),new oi(37,Int32Array.from([6,28,54,80,106,132,158]),new Rt(30,new De(17,122),new De(4,123)),new Rt(28,new De(29,46),new De(14,47)),new Rt(30,new De(49,24),new De(10,25)),new Rt(30,new De(24,15),new De(46,16))),new oi(38,Int32Array.from([6,32,58,84,110,136,162]),new Rt(30,new De(4,122),new De(18,123)),new Rt(28,new De(13,46),new De(32,47)),new Rt(30,new De(48,24),new De(14,25)),new Rt(30,new De(42,15),new De(32,16))),new oi(39,Int32Array.from([6,26,54,82,110,138,166]),new Rt(30,new De(20,117),new De(4,118)),new Rt(28,new De(40,47),new De(7,48)),new Rt(30,new De(43,24),new De(22,25)),new Rt(30,new De(10,15),new De(67,16))),new oi(40,Int32Array.from([6,30,58,86,114,142,170]),new Rt(30,new De(19,118),new De(6,119)),new Rt(28,new De(18,47),new De(31,48)),new Rt(30,new De(34,24),new De(34,25)),new Rt(30,new De(20,15),new De(61,16)))];var ds;(function(le){le[le.DATA_MASK_000=0]="DATA_MASK_000",le[le.DATA_MASK_001=1]="DATA_MASK_001",le[le.DATA_MASK_010=2]="DATA_MASK_010",le[le.DATA_MASK_011=3]="DATA_MASK_011",le[le.DATA_MASK_100=4]="DATA_MASK_100",le[le.DATA_MASK_101=5]="DATA_MASK_101",le[le.DATA_MASK_110=6]="DATA_MASK_110",le[le.DATA_MASK_111=7]="DATA_MASK_111"})(ds||(ds={}));class Ns{constructor(a,u){this.value=a,this.isMasked=u}unmaskBitMatrix(a,u){for(let g=0;g<u;g++)for(let v=0;v<u;v++)this.isMasked(g,v)&&a.flip(v,g)}}Ns.values=new Map([[ds.DATA_MASK_000,new Ns(ds.DATA_MASK_000,(le,a)=>(le+a&1)===0)],[ds.DATA_MASK_001,new Ns(ds.DATA_MASK_001,(le,a)=>(le&1)===0)],[ds.DATA_MASK_010,new Ns(ds.DATA_MASK_010,(le,a)=>a%3===0)],[ds.DATA_MASK_011,new Ns(ds.DATA_MASK_011,(le,a)=>(le+a)%3===0)],[ds.DATA_MASK_100,new Ns(ds.DATA_MASK_100,(le,a)=>(Math.floor(le/2)+Math.floor(a/3)&1)===0)],[ds.DATA_MASK_101,new Ns(ds.DATA_MASK_101,(le,a)=>le*a%6===0)],[ds.DATA_MASK_110,new Ns(ds.DATA_MASK_110,(le,a)=>le*a%6<3)],[ds.DATA_MASK_111,new Ns(ds.DATA_MASK_111,(le,a)=>(le+a+le*a%3&1)===0)]]);class Da{constructor(a){const u=a.getHeight();if(u<21||(u&3)!==1)throw new it;this.bitMatrix=a}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let a=0;for(let w=0;w<6;w++)a=this.copyBit(w,8,a);a=this.copyBit(7,8,a),a=this.copyBit(8,8,a),a=this.copyBit(8,7,a);for(let w=5;w>=0;w--)a=this.copyBit(8,w,a);const u=this.bitMatrix.getHeight();let g=0;const v=u-7;for(let w=u-1;w>=v;w--)g=this.copyBit(8,w,g);for(let w=u-8;w<u;w++)g=this.copyBit(w,8,g);if(this.parsedFormatInfo=$r.decodeFormatInformation(a,g),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new it}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const a=this.bitMatrix.getHeight(),u=Math.floor((a-17)/4);if(u<=6)return oi.getVersionForNumber(u);let g=0;const v=a-11;for(let I=5;I>=0;I--)for(let O=a-9;O>=v;O--)g=this.copyBit(O,I,g);let w=oi.decodeVersionInformation(g);if(w!==null&&w.getDimensionForVersion()===a)return this.parsedVersion=w,w;g=0;for(let I=5;I>=0;I--)for(let O=a-9;O>=v;O--)g=this.copyBit(I,O,g);if(w=oi.decodeVersionInformation(g),w!==null&&w.getDimensionForVersion()===a)return this.parsedVersion=w,w;throw new it}copyBit(a,u,g){return(this.isMirror?this.bitMatrix.get(u,a):this.bitMatrix.get(a,u))?g<<1|1:g<<1}readCodewords(){const a=this.readFormatInformation(),u=this.readVersion(),g=Ns.values.get(a.getDataMask()),v=this.bitMatrix.getHeight();g.unmaskBitMatrix(this.bitMatrix,v);const w=u.buildFunctionPattern();let I=!0;const O=new Uint8Array(u.getTotalCodewords());let F=0,q=0,te=0;for(let ue=v-1;ue>0;ue-=2){ue===6&&ue--;for(let xe=0;xe<v;xe++){const ze=I?v-1-xe:xe;for(let ot=0;ot<2;ot++)w.get(ue-ot,ze)||(te++,q<<=1,this.bitMatrix.get(ue-ot,ze)&&(q|=1),te===8&&(O[F++]=q,te=0,q=0))}I=!I}if(F!==u.getTotalCodewords())throw new it;return O}remask(){if(this.parsedFormatInfo===null)return;const a=Ns.values[this.parsedFormatInfo.getDataMask()],u=this.bitMatrix.getHeight();a.unmaskBitMatrix(this.bitMatrix,u)}setMirror(a){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=a}mirror(){const a=this.bitMatrix;for(let u=0,g=a.getWidth();u<g;u++)for(let v=u+1,w=a.getHeight();v<w;v++)a.get(u,v)!==a.get(v,u)&&(a.flip(v,u),a.flip(u,v))}}class uc{constructor(a,u){this.numDataCodewords=a,this.codewords=u}static getDataBlocks(a,u,g){if(a.length!==u.getTotalCodewords())throw new Q;const v=u.getECBlocksForLevel(g);let w=0;const I=v.getECBlocks();for(const ot of I)w+=ot.getCount();const O=new Array(w);let F=0;for(const ot of I)for(let ht=0;ht<ot.getCount();ht++){const Dt=ot.getDataCodewords(),qt=v.getECCodewordsPerBlock()+Dt;O[F++]=new uc(Dt,new Uint8Array(qt))}const q=O[0].codewords.length;let te=O.length-1;for(;te>=0&&O[te].codewords.length!==q;)te--;te++;const ue=q-v.getECCodewordsPerBlock();let xe=0;for(let ot=0;ot<ue;ot++)for(let ht=0;ht<F;ht++)O[ht].codewords[ot]=a[xe++];for(let ot=te;ot<F;ot++)O[ot].codewords[ue]=a[xe++];const ze=O[0].codewords.length;for(let ot=ue;ot<ze;ot++)for(let ht=0;ht<F;ht++){const Dt=ht<te?ot:ot+1;O[ht].codewords[Dt]=a[xe++]}return O}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Hr;(function(le){le[le.TERMINATOR=0]="TERMINATOR",le[le.NUMERIC=1]="NUMERIC",le[le.ALPHANUMERIC=2]="ALPHANUMERIC",le[le.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",le[le.BYTE=4]="BYTE",le[le.ECI=5]="ECI",le[le.KANJI=6]="KANJI",le[le.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",le[le.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",le[le.HANZI=9]="HANZI"})(Hr||(Hr={}));class mi{constructor(a,u,g,v){this.value=a,this.stringValue=u,this.characterCountBitsForVersions=g,this.bits=v,mi.FOR_BITS.set(v,this),mi.FOR_VALUE.set(a,this)}static forBits(a){const u=mi.FOR_BITS.get(a);if(u===void 0)throw new Q;return u}getCharacterCountBits(a){const u=a.getVersionNumber();let g;return u<=9?g=0:u<=26?g=1:g=2,this.characterCountBitsForVersions[g]}getValue(){return this.value}getBits(){return this.bits}equals(a){if(!(a instanceof mi))return!1;const u=a;return this.value===u.value}toString(){return this.stringValue}}mi.FOR_BITS=new Map,mi.FOR_VALUE=new Map,mi.TERMINATOR=new mi(Hr.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),mi.NUMERIC=new mi(Hr.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),mi.ALPHANUMERIC=new mi(Hr.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),mi.STRUCTURED_APPEND=new mi(Hr.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),mi.BYTE=new mi(Hr.BYTE,"BYTE",Int32Array.from([8,16,16]),4),mi.ECI=new mi(Hr.ECI,"ECI",Int32Array.from([0,0,0]),7),mi.KANJI=new mi(Hr.KANJI,"KANJI",Int32Array.from([8,10,12]),8),mi.FNC1_FIRST_POSITION=new mi(Hr.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),mi.FNC1_SECOND_POSITION=new mi(Hr.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),mi.HANZI=new mi(Hr.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class fr{static decode(a,u,g,v){const w=new ci(a);let I=new vt;const O=new Array;let F=-1,q=-1;try{let te=null,ue=!1,xe;do{if(w.available()<4)xe=mi.TERMINATOR;else{const ze=w.readBits(4);xe=mi.forBits(ze)}switch(xe){case mi.TERMINATOR:break;case mi.FNC1_FIRST_POSITION:case mi.FNC1_SECOND_POSITION:ue=!0;break;case mi.STRUCTURED_APPEND:if(w.available()<16)throw new it;F=w.readBits(8),q=w.readBits(8);break;case mi.ECI:const ze=fr.parseECIValue(w);if(te=He.getCharacterSetECIByValue(ze),te===null)throw new it;break;case mi.HANZI:const ot=w.readBits(4),ht=w.readBits(xe.getCharacterCountBits(u));ot===fr.GB2312_SUBSET&&fr.decodeHanziSegment(w,I,ht);break;default:const Dt=w.readBits(xe.getCharacterCountBits(u));switch(xe){case mi.NUMERIC:fr.decodeNumericSegment(w,I,Dt);break;case mi.ALPHANUMERIC:fr.decodeAlphanumericSegment(w,I,Dt,ue);break;case mi.BYTE:fr.decodeByteSegment(w,I,Dt,te,O,v);break;case mi.KANJI:fr.decodeKanjiSegment(w,I,Dt);break;default:throw new it}break}}while(xe!==mi.TERMINATOR)}catch{throw new it}return new sn(a,I.toString(),O.length===0?null:O,g===null?null:g.toString(),F,q)}static decodeHanziSegment(a,u,g){if(g*13>a.available())throw new it;const v=new Uint8Array(2*g);let w=0;for(;g>0;){const I=a.readBits(13);let O=I/96<<8&4294967295|I%96;O<959?O+=41377:O+=42657,v[w]=O>>8&255,v[w+1]=O&255,w+=2,g--}try{u.append(Pe.decode(v,ct.GB2312))}catch(I){throw new it(I)}}static decodeKanjiSegment(a,u,g){if(g*13>a.available())throw new it;const v=new Uint8Array(2*g);let w=0;for(;g>0;){const I=a.readBits(13);let O=I/192<<8&4294967295|I%192;O<7936?O+=33088:O+=49472,v[w]=O>>8,v[w+1]=O,w+=2,g--}try{u.append(Pe.decode(v,ct.SHIFT_JIS))}catch(I){throw new it(I)}}static decodeByteSegment(a,u,g,v,w,I){if(8*g>a.available())throw new it;const O=new Uint8Array(g);for(let q=0;q<g;q++)O[q]=a.readBits(8);let F;v===null?F=ct.guessEncoding(O,I):F=v.getName();try{u.append(Pe.decode(O,F))}catch(q){throw new it(q)}w.push(O)}static toAlphaNumericChar(a){if(a>=fr.ALPHANUMERIC_CHARS.length)throw new it;return fr.ALPHANUMERIC_CHARS[a]}static decodeAlphanumericSegment(a,u,g,v){const w=u.length();for(;g>1;){if(a.available()<11)throw new it;const I=a.readBits(11);u.append(fr.toAlphaNumericChar(Math.floor(I/45))),u.append(fr.toAlphaNumericChar(I%45)),g-=2}if(g===1){if(a.available()<6)throw new it;u.append(fr.toAlphaNumericChar(a.readBits(6)))}if(v)for(let I=w;I<u.length();I++)u.charAt(I)==="%"&&(I<u.length()-1&&u.charAt(I+1)==="%"?u.deleteCharAt(I+1):u.setCharAt(I,""))}static decodeNumericSegment(a,u,g){for(;g>=3;){if(a.available()<10)throw new it;const v=a.readBits(10);if(v>=1e3)throw new it;u.append(fr.toAlphaNumericChar(Math.floor(v/100))),u.append(fr.toAlphaNumericChar(Math.floor(v/10)%10)),u.append(fr.toAlphaNumericChar(v%10)),g-=3}if(g===2){if(a.available()<7)throw new it;const v=a.readBits(7);if(v>=100)throw new it;u.append(fr.toAlphaNumericChar(Math.floor(v/10))),u.append(fr.toAlphaNumericChar(v%10))}else if(g===1){if(a.available()<4)throw new it;const v=a.readBits(4);if(v>=10)throw new it;u.append(fr.toAlphaNumericChar(v))}}static parseECIValue(a){const u=a.readBits(8);if((u&128)===0)return u&127;if((u&192)===128){const g=a.readBits(8);return(u&63)<<8&4294967295|g}if((u&224)===192){const g=a.readBits(16);return(u&31)<<16&4294967295|g}throw new it}}fr.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",fr.GB2312_SUBSET=1;class Ao{constructor(a){this.mirrored=a}isMirrored(){return this.mirrored}applyMirroredCorrection(a){if(!this.mirrored||a===null||a.length<3)return;const u=a[0];a[0]=a[2],a[2]=u}}class cl{constructor(){this.rsDecoder=new Di(kn.QR_CODE_FIELD_256)}decodeBooleanArray(a,u){return this.decodeBitMatrix(Zt.parseFromBooleanArray(a),u)}decodeBitMatrix(a,u){const g=new Da(a);let v=null;try{return this.decodeBitMatrixParser(g,u)}catch(w){v=w}try{g.remask(),g.setMirror(!0),g.readVersion(),g.readFormatInformation(),g.mirror();const w=this.decodeBitMatrixParser(g,u);return w.setOther(new Ao(!0)),w}catch(w){throw v!==null?v:w}}decodeBitMatrixParser(a,u){const g=a.readVersion(),v=a.readFormatInformation().getErrorCorrectionLevel(),w=a.readCodewords(),I=uc.getDataBlocks(w,g,v);let O=0;for(const te of I)O+=te.getNumDataCodewords();const F=new Uint8Array(O);let q=0;for(const te of I){const ue=te.getCodewords(),xe=te.getNumDataCodewords();this.correctErrors(ue,xe);for(let ze=0;ze<xe;ze++)F[q++]=ue[ze]}return fr.decode(F,g,v,u)}correctErrors(a,u){const g=new Int32Array(a);try{this.rsDecoder.decode(g,a.length-u)}catch{throw new we}for(let v=0;v<u;v++)a[v]=g[v]}}class Si extends nn{constructor(a,u,g){super(a,u),this.estimatedModuleSize=g}aboutEquals(a,u,g){if(Math.abs(u-this.getY())<=a&&Math.abs(g-this.getX())<=a){const v=Math.abs(a-this.estimatedModuleSize);return v<=1||v<=this.estimatedModuleSize}return!1}combineEstimate(a,u,g){const v=(this.getX()+u)/2,w=(this.getY()+a)/2,I=(this.estimatedModuleSize+g)/2;return new Si(v,w,I)}}class Xs{constructor(a,u,g,v,w,I,O){this.image=a,this.startX=u,this.startY=g,this.width=v,this.height=w,this.moduleSize=I,this.resultPointCallback=O,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const a=this.startX,u=this.height,g=this.width,v=a+g,w=this.startY+u/2,I=new Int32Array(3),O=this.image;for(let F=0;F<u;F++){const q=w+((F&1)===0?Math.floor((F+1)/2):-Math.floor((F+1)/2));I[0]=0,I[1]=0,I[2]=0;let te=a;for(;te<v&&!O.get(te,q);)te++;let ue=0;for(;te<v;){if(O.get(te,q))if(ue===1)I[1]++;else if(ue===2){if(this.foundPatternCross(I)){const xe=this.handlePossibleCenter(I,q,te);if(xe!==null)return xe}I[0]=I[2],I[1]=1,I[2]=0,ue=1}else I[++ue]++;else ue===1&&ue++,I[ue]++;te++}if(this.foundPatternCross(I)){const xe=this.handlePossibleCenter(I,q,v);if(xe!==null)return xe}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new Ne}static centerFromEnd(a,u){return u-a[2]-a[1]/2}foundPatternCross(a){const u=this.moduleSize,g=u/2;for(let v=0;v<3;v++)if(Math.abs(u-a[v])>=g)return!1;return!0}crossCheckVertical(a,u,g,v){const w=this.image,I=w.getHeight(),O=this.crossCheckStateCount;O[0]=0,O[1]=0,O[2]=0;let F=a;for(;F>=0&&w.get(u,F)&&O[1]<=g;)O[1]++,F--;if(F<0||O[1]>g)return NaN;for(;F>=0&&!w.get(u,F)&&O[0]<=g;)O[0]++,F--;if(O[0]>g)return NaN;for(F=a+1;F<I&&w.get(u,F)&&O[1]<=g;)O[1]++,F++;if(F===I||O[1]>g)return NaN;for(;F<I&&!w.get(u,F)&&O[2]<=g;)O[2]++,F++;if(O[2]>g)return NaN;const q=O[0]+O[1]+O[2];return 5*Math.abs(q-v)>=2*v?NaN:this.foundPatternCross(O)?Xs.centerFromEnd(O,F):NaN}handlePossibleCenter(a,u,g){const v=a[0]+a[1]+a[2],w=Xs.centerFromEnd(a,g),I=this.crossCheckVertical(u,w,2*a[1],v);if(!isNaN(I)){const O=(a[0]+a[1]+a[2])/3;for(const q of this.possibleCenters)if(q.aboutEquals(O,I,w))return q.combineEstimate(I,w,O);const F=new Si(w,I,O);this.possibleCenters.push(F),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(F)}return null}}class Ll extends nn{constructor(a,u,g,v){super(a,u),this.estimatedModuleSize=g,this.count=v,v===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(a,u,g){if(Math.abs(u-this.getY())<=a&&Math.abs(g-this.getX())<=a){const v=Math.abs(a-this.estimatedModuleSize);return v<=1||v<=this.estimatedModuleSize}return!1}combineEstimate(a,u,g){const v=this.count+1,w=(this.count*this.getX()+u)/v,I=(this.count*this.getY()+a)/v,O=(this.count*this.estimatedModuleSize+g)/v;return new Ll(w,I,O,v)}}class ul{constructor(a){this.bottomLeft=a[0],this.topLeft=a[1],this.topRight=a[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Xi{constructor(a,u){this.image=a,this.resultPointCallback=u,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=u}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(a){const u=a!=null&&a.get(Et.TRY_HARDER)!==void 0,g=a!=null&&a.get(Et.PURE_BARCODE)!==void 0,v=this.image,w=v.getHeight(),I=v.getWidth();let O=Math.floor(3*w/(4*Xi.MAX_MODULES));(O<Xi.MIN_SKIP||u)&&(O=Xi.MIN_SKIP);let F=!1;const q=new Int32Array(5);for(let ue=O-1;ue<w&&!F;ue+=O){q[0]=0,q[1]=0,q[2]=0,q[3]=0,q[4]=0;let xe=0;for(let ze=0;ze<I;ze++)if(v.get(ze,ue))(xe&1)===1&&xe++,q[xe]++;else if((xe&1)===0)if(xe===4)if(Xi.foundPatternCross(q)){if(this.handlePossibleCenter(q,ue,ze,g)===!0)if(O=2,this.hasSkipped===!0)F=this.haveMultiplyConfirmedCenters();else{const ht=this.findRowSkip();ht>q[2]&&(ue+=ht-q[2]-O,ze=I-1)}else{q[0]=q[2],q[1]=q[3],q[2]=q[4],q[3]=1,q[4]=0,xe=3;continue}xe=0,q[0]=0,q[1]=0,q[2]=0,q[3]=0,q[4]=0}else q[0]=q[2],q[1]=q[3],q[2]=q[4],q[3]=1,q[4]=0,xe=3;else q[++xe]++;else q[xe]++;Xi.foundPatternCross(q)&&this.handlePossibleCenter(q,ue,I,g)===!0&&(O=q[0],this.hasSkipped&&(F=this.haveMultiplyConfirmedCenters()))}const te=this.selectBestPatterns();return nn.orderBestPatterns(te),new ul(te)}static centerFromEnd(a,u){return u-a[4]-a[3]-a[2]/2}static foundPatternCross(a){let u=0;for(let w=0;w<5;w++){const I=a[w];if(I===0)return!1;u+=I}if(u<7)return!1;const g=u/7,v=g/2;return Math.abs(g-a[0])<v&&Math.abs(g-a[1])<v&&Math.abs(3*g-a[2])<3*v&&Math.abs(g-a[3])<v&&Math.abs(g-a[4])<v}getCrossCheckStateCount(){const a=this.crossCheckStateCount;return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a}crossCheckDiagonal(a,u,g,v){const w=this.getCrossCheckStateCount();let I=0;const O=this.image;for(;a>=I&&u>=I&&O.get(u-I,a-I);)w[2]++,I++;if(a<I||u<I)return!1;for(;a>=I&&u>=I&&!O.get(u-I,a-I)&&w[1]<=g;)w[1]++,I++;if(a<I||u<I||w[1]>g)return!1;for(;a>=I&&u>=I&&O.get(u-I,a-I)&&w[0]<=g;)w[0]++,I++;if(w[0]>g)return!1;const F=O.getHeight(),q=O.getWidth();for(I=1;a+I<F&&u+I<q&&O.get(u+I,a+I);)w[2]++,I++;if(a+I>=F||u+I>=q)return!1;for(;a+I<F&&u+I<q&&!O.get(u+I,a+I)&&w[3]<g;)w[3]++,I++;if(a+I>=F||u+I>=q||w[3]>=g)return!1;for(;a+I<F&&u+I<q&&O.get(u+I,a+I)&&w[4]<g;)w[4]++,I++;if(w[4]>=g)return!1;const te=w[0]+w[1]+w[2]+w[3]+w[4];return Math.abs(te-v)<2*v&&Xi.foundPatternCross(w)}crossCheckVertical(a,u,g,v){const w=this.image,I=w.getHeight(),O=this.getCrossCheckStateCount();let F=a;for(;F>=0&&w.get(u,F);)O[2]++,F--;if(F<0)return NaN;for(;F>=0&&!w.get(u,F)&&O[1]<=g;)O[1]++,F--;if(F<0||O[1]>g)return NaN;for(;F>=0&&w.get(u,F)&&O[0]<=g;)O[0]++,F--;if(O[0]>g)return NaN;for(F=a+1;F<I&&w.get(u,F);)O[2]++,F++;if(F===I)return NaN;for(;F<I&&!w.get(u,F)&&O[3]<g;)O[3]++,F++;if(F===I||O[3]>=g)return NaN;for(;F<I&&w.get(u,F)&&O[4]<g;)O[4]++,F++;if(O[4]>=g)return NaN;const q=O[0]+O[1]+O[2]+O[3]+O[4];return 5*Math.abs(q-v)>=2*v?NaN:Xi.foundPatternCross(O)?Xi.centerFromEnd(O,F):NaN}crossCheckHorizontal(a,u,g,v){const w=this.image,I=w.getWidth(),O=this.getCrossCheckStateCount();let F=a;for(;F>=0&&w.get(F,u);)O[2]++,F--;if(F<0)return NaN;for(;F>=0&&!w.get(F,u)&&O[1]<=g;)O[1]++,F--;if(F<0||O[1]>g)return NaN;for(;F>=0&&w.get(F,u)&&O[0]<=g;)O[0]++,F--;if(O[0]>g)return NaN;for(F=a+1;F<I&&w.get(F,u);)O[2]++,F++;if(F===I)return NaN;for(;F<I&&!w.get(F,u)&&O[3]<g;)O[3]++,F++;if(F===I||O[3]>=g)return NaN;for(;F<I&&w.get(F,u)&&O[4]<g;)O[4]++,F++;if(O[4]>=g)return NaN;const q=O[0]+O[1]+O[2]+O[3]+O[4];return 5*Math.abs(q-v)>=v?NaN:Xi.foundPatternCross(O)?Xi.centerFromEnd(O,F):NaN}handlePossibleCenter(a,u,g,v){const w=a[0]+a[1]+a[2]+a[3]+a[4];let I=Xi.centerFromEnd(a,g),O=this.crossCheckVertical(u,Math.floor(I),a[2],w);if(!isNaN(O)&&(I=this.crossCheckHorizontal(Math.floor(I),Math.floor(O),a[2],w),!isNaN(I)&&(!v||this.crossCheckDiagonal(Math.floor(O),Math.floor(I),a[2],w)))){const F=w/7;let q=!1;const te=this.possibleCenters;for(let ue=0,xe=te.length;ue<xe;ue++){const ze=te[ue];if(ze.aboutEquals(F,O,I)){te[ue]=ze.combineEstimate(O,I,F),q=!0;break}}if(!q){const ue=new Ll(I,O,F);te.push(ue),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(ue)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let u=null;for(const g of this.possibleCenters)if(g.getCount()>=Xi.CENTER_QUORUM)if(u==null)u=g;else return this.hasSkipped=!0,Math.floor((Math.abs(u.getX()-g.getX())-Math.abs(u.getY()-g.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let a=0,u=0;const g=this.possibleCenters.length;for(const I of this.possibleCenters)I.getCount()>=Xi.CENTER_QUORUM&&(a++,u+=I.getEstimatedModuleSize());if(a<3)return!1;const v=u/g;let w=0;for(const I of this.possibleCenters)w+=Math.abs(I.getEstimatedModuleSize()-v);return w<=.05*u}selectBestPatterns(){const a=this.possibleCenters.length;if(a<3)throw new Ne;const u=this.possibleCenters;let g;if(a>3){let v=0,w=0;for(const F of this.possibleCenters){const q=F.getEstimatedModuleSize();v+=q,w+=q*q}g=v/a;let I=Math.sqrt(w/a-g*g);u.sort((F,q)=>{const te=Math.abs(q.getEstimatedModuleSize()-g),ue=Math.abs(F.getEstimatedModuleSize()-g);return te<ue?-1:te>ue?1:0});const O=Math.max(.2*g,I);for(let F=0;F<u.length&&u.length>3;F++){const q=u[F];Math.abs(q.getEstimatedModuleSize()-g)>O&&(u.splice(F,1),F--)}}if(u.length>3){let v=0;for(const w of u)v+=w.getEstimatedModuleSize();g=v/u.length,u.sort((w,I)=>{if(I.getCount()===w.getCount()){const O=Math.abs(I.getEstimatedModuleSize()-g),F=Math.abs(w.getEstimatedModuleSize()-g);return O<F?1:O>F?-1:0}else return I.getCount()-w.getCount()}),u.splice(3)}return[u[0],u[1],u[2]]}}Xi.CENTER_QUORUM=2,Xi.MIN_SKIP=3,Xi.MAX_MODULES=57;class Br{constructor(a){this.image=a}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(a){this.resultPointCallback=a==null?null:a.get(Et.NEED_RESULT_POINT_CALLBACK);const g=new Xi(this.image,this.resultPointCallback).find(a);return this.processFinderPatternInfo(g)}processFinderPatternInfo(a){const u=a.getTopLeft(),g=a.getTopRight(),v=a.getBottomLeft(),w=this.calculateModuleSize(u,g,v);if(w<1)throw new Ne("No pattern found in proccess finder.");const I=Br.computeDimension(u,g,v,w),O=oi.getProvisionalVersionForDimension(I),F=O.getDimensionForVersion()-7;let q=null;if(O.getAlignmentPatternCenters().length>0){const ze=g.getX()-u.getX()+v.getX(),ot=g.getY()-u.getY()+v.getY(),ht=1-3/F,Dt=Math.floor(u.getX()+ht*(ze-u.getX())),qt=Math.floor(u.getY()+ht*(ot-u.getY()));for(let Sn=4;Sn<=16;Sn<<=1)try{q=this.findAlignmentInRegion(w,Dt,qt,Sn);break}catch(wn){if(!(wn instanceof Ne))throw wn}}const te=Br.createTransform(u,g,v,q,I),ue=Br.sampleGrid(this.image,te,I);let xe;return q===null?xe=[v,u,g]:xe=[v,u,g,q],new Li(ue,xe)}static createTransform(a,u,g,v,w){const I=w-3.5;let O,F,q,te;return v!==null?(O=v.getX(),F=v.getY(),q=I-3,te=q):(O=u.getX()-a.getX()+g.getX(),F=u.getY()-a.getY()+g.getY(),q=I,te=I),gt.quadrilateralToQuadrilateral(3.5,3.5,I,3.5,q,te,3.5,I,a.getX(),a.getY(),u.getX(),u.getY(),O,F,g.getX(),g.getY())}static sampleGrid(a,u,g){return ce.getInstance().sampleGridWithTransform(a,g,g,u)}static computeDimension(a,u,g,v){const w=In.round(nn.distance(a,u)/v),I=In.round(nn.distance(a,g)/v);let O=Math.floor((w+I)/2)+7;switch(O&3){case 0:O++;break;case 2:O--;break;case 3:throw new Ne("Dimensions could be not found.")}return O}calculateModuleSize(a,u,g){return(this.calculateModuleSizeOneWay(a,u)+this.calculateModuleSizeOneWay(a,g))/2}calculateModuleSizeOneWay(a,u){const g=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(a.getX()),Math.floor(a.getY()),Math.floor(u.getX()),Math.floor(u.getY())),v=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(u.getX()),Math.floor(u.getY()),Math.floor(a.getX()),Math.floor(a.getY()));return isNaN(g)?v/7:isNaN(v)?g/7:(g+v)/14}sizeOfBlackWhiteBlackRunBothWays(a,u,g,v){let w=this.sizeOfBlackWhiteBlackRun(a,u,g,v),I=1,O=a-(g-a);O<0?(I=a/(a-O),O=0):O>=this.image.getWidth()&&(I=(this.image.getWidth()-1-a)/(O-a),O=this.image.getWidth()-1);let F=Math.floor(u-(v-u)*I);return I=1,F<0?(I=u/(u-F),F=0):F>=this.image.getHeight()&&(I=(this.image.getHeight()-1-u)/(F-u),F=this.image.getHeight()-1),O=Math.floor(a+(O-a)*I),w+=this.sizeOfBlackWhiteBlackRun(a,u,O,F),w-1}sizeOfBlackWhiteBlackRun(a,u,g,v){const w=Math.abs(v-u)>Math.abs(g-a);if(w){let ze=a;a=u,u=ze,ze=g,g=v,v=ze}const I=Math.abs(g-a),O=Math.abs(v-u);let F=-I/2;const q=a<g?1:-1,te=u<v?1:-1;let ue=0;const xe=g+q;for(let ze=a,ot=u;ze!==xe;ze+=q){const ht=w?ot:ze,Dt=w?ze:ot;if(ue===1===this.image.get(ht,Dt)){if(ue===2)return In.distance(ze,ot,a,u);ue++}if(F+=O,F>0){if(ot===v)break;ot+=te,F-=I}}return ue===2?In.distance(g+q,v,a,u):NaN}findAlignmentInRegion(a,u,g,v){const w=Math.floor(v*a),I=Math.max(0,u-w),O=Math.min(this.image.getWidth()-1,u+w);if(O-I<a*3)throw new Ne("Alignment top exceeds estimated module size.");const F=Math.max(0,g-w),q=Math.min(this.image.getHeight()-1,g+w);if(q-F<a*3)throw new Ne("Alignment bottom exceeds estimated module size.");return new Xs(this.image,I,F,O-I,q-F,a,this.resultPointCallback).find()}}class er{constructor(){this.decoder=new cl}getDecoder(){return this.decoder}decode(a,u){let g,v;if(u!=null&&u.get(Et.PURE_BARCODE)!==void 0){const F=er.extractPureBits(a.getBlackMatrix());g=this.decoder.decodeBitMatrix(F,u),v=er.NO_POINTS}else{const F=new Br(a.getBlackMatrix()).detect(u);g=this.decoder.decodeBitMatrix(F.getBits(),u),v=F.getPoints()}g.getOther()instanceof Ao&&g.getOther().applyMirroredCorrection(v);const w=new _t(g.getText(),g.getRawBytes(),void 0,v,Bt.QR_CODE,void 0),I=g.getByteSegments();I!==null&&w.putMetadata(an.BYTE_SEGMENTS,I);const O=g.getECLevel();return O!==null&&w.putMetadata(an.ERROR_CORRECTION_LEVEL,O),g.hasStructuredAppend()&&(w.putMetadata(an.STRUCTURED_APPEND_SEQUENCE,g.getStructuredAppendSequenceNumber()),w.putMetadata(an.STRUCTURED_APPEND_PARITY,g.getStructuredAppendParity())),w}reset(){}static extractPureBits(a){const u=a.getTopLeftOnBit(),g=a.getBottomRightOnBit();if(u===null||g===null)throw new Ne;const v=this.moduleSize(u,a);let w=u[1],I=g[1],O=u[0],F=g[0];if(O>=F||w>=I)throw new Ne;if(I-w!==F-O&&(F=O+(I-w),F>=a.getWidth()))throw new Ne;const q=Math.round((F-O+1)/v),te=Math.round((I-w+1)/v);if(q<=0||te<=0)throw new Ne;if(te!==q)throw new Ne;const ue=Math.floor(v/2);w+=ue,O+=ue;const xe=O+Math.floor((q-1)*v)-F;if(xe>0){if(xe>ue)throw new Ne;O-=xe}const ze=w+Math.floor((te-1)*v)-I;if(ze>0){if(ze>ue)throw new Ne;w-=ze}const ot=new Zt(q,te);for(let ht=0;ht<te;ht++){const Dt=w+Math.floor(ht*v);for(let qt=0;qt<q;qt++)a.get(O+Math.floor(qt*v),Dt)&&ot.set(qt,ht)}return ot}static moduleSize(a,u){const g=u.getHeight(),v=u.getWidth();let w=a[0],I=a[1],O=!0,F=0;for(;w<v&&I<g;){if(O!==u.get(w,I)){if(++F===5)break;O=!O}w++,I++}if(w===v||I===g)throw new Ne;return(w-a[0])/7}}er.NO_POINTS=new Array;class yn{PDF417Common(){}static getBitCountSum(a){return In.sum(a)}static toIntArray(a){if(a==null||!a.length)return yn.EMPTY_INT_ARRAY;const u=new Int32Array(a.length);let g=0;for(const v of a)u[g++]=v;return u}static getCodeword(a){const u=tt.binarySearch(yn.SYMBOL_TABLE,a&262143);return u<0?-1:(yn.CODEWORD_TABLE[u]-1)%yn.NUMBER_OF_CODEWORDS}}yn.NUMBER_OF_CODEWORDS=929,yn.MAX_CODEWORDS_IN_BARCODE=yn.NUMBER_OF_CODEWORDS-1,yn.MIN_ROWS_IN_BARCODE=3,yn.MAX_ROWS_IN_BARCODE=90,yn.MODULES_IN_CODEWORD=17,yn.MODULES_IN_STOP_PATTERN=18,yn.BARS_IN_MODULE=8,yn.EMPTY_INT_ARRAY=new Int32Array([]),yn.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),yn.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class _r{constructor(a,u){this.bits=a,this.points=u}getBits(){return this.bits}getPoints(){return this.points}}class Ci{static detectMultiple(a,u,g){let v=a.getBlackMatrix(),w=Ci.detect(g,v);return w.length||(v=v.clone(),v.rotate180(),w=Ci.detect(g,v)),new _r(v,w)}static detect(a,u){const g=new Array;let v=0,w=0,I=!1;for(;v<u.getHeight();){const O=Ci.findVertices(u,v,w);if(O[0]==null&&O[3]==null){if(!I)break;I=!1,w=0;for(const F of g)F[1]!=null&&(v=Math.trunc(Math.max(v,F[1].getY()))),F[3]!=null&&(v=Math.max(v,Math.trunc(F[3].getY())));v+=Ci.ROW_STEP;continue}if(I=!0,g.push(O),!a)break;O[2]!=null?(w=Math.trunc(O[2].getX()),v=Math.trunc(O[2].getY())):(w=Math.trunc(O[4].getX()),v=Math.trunc(O[4].getY()))}return g}static findVertices(a,u,g){const v=a.getHeight(),w=a.getWidth(),I=new Array(8);return Ci.copyToResult(I,Ci.findRowsWithPattern(a,v,w,u,g,Ci.START_PATTERN),Ci.INDEXES_START_PATTERN),I[4]!=null&&(g=Math.trunc(I[4].getX()),u=Math.trunc(I[4].getY())),Ci.copyToResult(I,Ci.findRowsWithPattern(a,v,w,u,g,Ci.STOP_PATTERN),Ci.INDEXES_STOP_PATTERN),I}static copyToResult(a,u,g){for(let v=0;v<g.length;v++)a[g[v]]=u[v]}static findRowsWithPattern(a,u,g,v,w,I){const O=new Array(4);let F=!1;const q=new Int32Array(I.length);for(;v<u;v+=Ci.ROW_STEP){let ue=Ci.findGuardPattern(a,w,v,g,!1,I,q);if(ue!=null){for(;v>0;){const xe=Ci.findGuardPattern(a,w,--v,g,!1,I,q);if(xe!=null)ue=xe;else{v++;break}}O[0]=new nn(ue[0],v),O[1]=new nn(ue[1],v),F=!0;break}}let te=v+1;if(F){let ue=0,xe=Int32Array.from([Math.trunc(O[0].getX()),Math.trunc(O[1].getX())]);for(;te<u;te++){const ze=Ci.findGuardPattern(a,xe[0],te,g,!1,I,q);if(ze!=null&&Math.abs(xe[0]-ze[0])<Ci.MAX_PATTERN_DRIFT&&Math.abs(xe[1]-ze[1])<Ci.MAX_PATTERN_DRIFT)xe=ze,ue=0;else{if(ue>Ci.SKIPPED_ROW_COUNT_MAX)break;ue++}}te-=ue+1,O[2]=new nn(xe[0],te),O[3]=new nn(xe[1],te)}return te-v<Ci.BARCODE_MIN_HEIGHT&&tt.fill(O,null),O}static findGuardPattern(a,u,g,v,w,I,O){tt.fillWithin(O,0,O.length,0);let F=u,q=0;for(;a.get(F,g)&&F>0&&q++<Ci.MAX_PIXEL_DRIFT;)F--;let te=F,ue=0,xe=I.length;for(let ze=w;te<v;te++)if(a.get(te,g)!==ze)O[ue]++;else{if(ue===xe-1){if(Ci.patternMatchVariance(O,I,Ci.MAX_INDIVIDUAL_VARIANCE)<Ci.MAX_AVG_VARIANCE)return new Int32Array([F,te]);F+=O[0]+O[1],me.arraycopy(O,2,O,0,ue-1),O[ue-1]=0,O[ue]=0,ue--}else ue++;O[ue]=1,ze=!ze}return ue===xe-1&&Ci.patternMatchVariance(O,I,Ci.MAX_INDIVIDUAL_VARIANCE)<Ci.MAX_AVG_VARIANCE?new Int32Array([F,te-1]):null}static patternMatchVariance(a,u,g){let v=a.length,w=0,I=0;for(let q=0;q<v;q++)w+=a[q],I+=u[q];if(w<I)return 1/0;let O=w/I;g*=O;let F=0;for(let q=0;q<v;q++){let te=a[q],ue=u[q]*O,xe=te>ue?te-ue:ue-te;if(xe>g)return 1/0;F+=xe}return F/w}}Ci.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Ci.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Ci.MAX_AVG_VARIANCE=.42,Ci.MAX_INDIVIDUAL_VARIANCE=.8,Ci.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Ci.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Ci.MAX_PIXEL_DRIFT=3,Ci.MAX_PATTERN_DRIFT=5,Ci.SKIPPED_ROW_COUNT_MAX=25,Ci.ROW_STEP=5,Ci.BARCODE_MIN_HEIGHT=10;class ji{constructor(a,u){if(u.length===0)throw new Q;this.field=a;let g=u.length;if(g>1&&u[0]===0){let v=1;for(;v<g&&u[v]===0;)v++;v===g?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(g-v),me.arraycopy(u,v,this.coefficients,0,this.coefficients.length))}else this.coefficients=u}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(a){return this.coefficients[this.coefficients.length-1-a]}evaluateAt(a){if(a===0)return this.getCoefficient(0);if(a===1){let v=0;for(let w of this.coefficients)v=this.field.add(v,w);return v}let u=this.coefficients[0],g=this.coefficients.length;for(let v=1;v<g;v++)u=this.field.add(this.field.multiply(a,u),this.coefficients[v]);return u}add(a){if(!this.field.equals(a.field))throw new Q("ModulusPolys do not have same ModulusGF field");if(this.isZero())return a;if(a.isZero())return this;let u=this.coefficients,g=a.coefficients;if(u.length>g.length){let I=u;u=g,g=I}let v=new Int32Array(g.length),w=g.length-u.length;me.arraycopy(g,0,v,0,w);for(let I=w;I<g.length;I++)v[I]=this.field.add(u[I-w],g[I]);return new ji(this.field,v)}subtract(a){if(!this.field.equals(a.field))throw new Q("ModulusPolys do not have same ModulusGF field");return a.isZero()?this:this.add(a.negative())}multiply(a){return a instanceof ji?this.multiplyOther(a):this.multiplyScalar(a)}multiplyOther(a){if(!this.field.equals(a.field))throw new Q("ModulusPolys do not have same ModulusGF field");if(this.isZero()||a.isZero())return new ji(this.field,new Int32Array([0]));let u=this.coefficients,g=u.length,v=a.coefficients,w=v.length,I=new Int32Array(g+w-1);for(let O=0;O<g;O++){let F=u[O];for(let q=0;q<w;q++)I[O+q]=this.field.add(I[O+q],this.field.multiply(F,v[q]))}return new ji(this.field,I)}negative(){let a=this.coefficients.length,u=new Int32Array(a);for(let g=0;g<a;g++)u[g]=this.field.subtract(0,this.coefficients[g]);return new ji(this.field,u)}multiplyScalar(a){if(a===0)return new ji(this.field,new Int32Array([0]));if(a===1)return this;let u=this.coefficients.length,g=new Int32Array(u);for(let v=0;v<u;v++)g[v]=this.field.multiply(this.coefficients[v],a);return new ji(this.field,g)}multiplyByMonomial(a,u){if(a<0)throw new Q;if(u===0)return new ji(this.field,new Int32Array([0]));let g=this.coefficients.length,v=new Int32Array(g+a);for(let w=0;w<g;w++)v[w]=this.field.multiply(this.coefficients[w],u);return new ji(this.field,v)}toString(){let a=new vt;for(let u=this.getDegree();u>=0;u--){let g=this.getCoefficient(u);g!==0&&(g<0?(a.append(" - "),g=-g):a.length()>0&&a.append(" + "),(u===0||g!==1)&&a.append(g),u!==0&&(u===1?a.append("x"):(a.append("x^"),a.append(u))))}return a.toString()}}class Ws{add(a,u){return(a+u)%this.modulus}subtract(a,u){return(this.modulus+a-u)%this.modulus}exp(a){return this.expTable[a]}log(a){if(a===0)throw new Q;return this.logTable[a]}inverse(a){if(a===0)throw new si;return this.expTable[this.modulus-this.logTable[a]-1]}multiply(a,u){return a===0||u===0?0:this.expTable[(this.logTable[a]+this.logTable[u])%(this.modulus-1)]}getSize(){return this.modulus}equals(a){return a===this}}class Qr extends Ws{constructor(a,u){super(),this.modulus=a,this.expTable=new Int32Array(a),this.logTable=new Int32Array(a);let g=1;for(let v=0;v<a;v++)this.expTable[v]=g,g=g*u%a;for(let v=0;v<a-1;v++)this.logTable[this.expTable[v]]=v;this.zero=new ji(this,new Int32Array([0])),this.one=new ji(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(a,u){if(a<0)throw new Q;if(u===0)return this.zero;let g=new Int32Array(a+1);return g[0]=u,new ji(this,g)}}Qr.PDF417_GF=new Qr(yn.NUMBER_OF_CODEWORDS,3);class Ys{constructor(){this.field=Qr.PDF417_GF}decode(a,u,g){let v=new ji(this.field,a),w=new Int32Array(u),I=!1;for(let ot=u;ot>0;ot--){let ht=v.evaluateAt(this.field.exp(ot));w[u-ot]=ht,ht!==0&&(I=!0)}if(!I)return 0;let O=this.field.getOne();if(g!=null)for(const ot of g){let ht=this.field.exp(a.length-1-ot),Dt=new ji(this.field,new Int32Array([this.field.subtract(0,ht),1]));O=O.multiply(Dt)}let F=new ji(this.field,w),q=this.runEuclideanAlgorithm(this.field.buildMonomial(u,1),F,u),te=q[0],ue=q[1],xe=this.findErrorLocations(te),ze=this.findErrorMagnitudes(ue,te,xe);for(let ot=0;ot<xe.length;ot++){let ht=a.length-1-this.field.log(xe[ot]);if(ht<0)throw we.getChecksumInstance();a[ht]=this.field.subtract(a[ht],ze[ot])}return xe.length}runEuclideanAlgorithm(a,u,g){if(a.getDegree()<u.getDegree()){let xe=a;a=u,u=xe}let v=a,w=u,I=this.field.getZero(),O=this.field.getOne();for(;w.getDegree()>=Math.round(g/2);){let xe=v,ze=I;if(v=w,I=O,v.isZero())throw we.getChecksumInstance();w=xe;let ot=this.field.getZero(),ht=v.getCoefficient(v.getDegree()),Dt=this.field.inverse(ht);for(;w.getDegree()>=v.getDegree()&&!w.isZero();){let qt=w.getDegree()-v.getDegree(),Sn=this.field.multiply(w.getCoefficient(w.getDegree()),Dt);ot=ot.add(this.field.buildMonomial(qt,Sn)),w=w.subtract(v.multiplyByMonomial(qt,Sn))}O=ot.multiply(I).subtract(ze).negative()}let F=O.getCoefficient(0);if(F===0)throw we.getChecksumInstance();let q=this.field.inverse(F),te=O.multiply(q),ue=w.multiply(q);return[te,ue]}findErrorLocations(a){let u=a.getDegree(),g=new Int32Array(u),v=0;for(let w=1;w<this.field.getSize()&&v<u;w++)a.evaluateAt(w)===0&&(g[v]=this.field.inverse(w),v++);if(v!==u)throw we.getChecksumInstance();return g}findErrorMagnitudes(a,u,g){let v=u.getDegree(),w=new Int32Array(v);for(let q=1;q<=v;q++)w[v-q]=this.field.multiply(q,u.getCoefficient(q));let I=new ji(this.field,w),O=g.length,F=new Int32Array(O);for(let q=0;q<O;q++){let te=this.field.inverse(g[q]),ue=this.field.subtract(0,a.evaluateAt(te)),xe=this.field.inverse(I.evaluateAt(te));F[q]=this.field.multiply(ue,xe)}return F}}class Us{constructor(a,u,g,v,w){a instanceof Us?this.constructor_2(a):this.constructor_1(a,u,g,v,w)}constructor_1(a,u,g,v,w){const I=u==null||g==null,O=v==null||w==null;if(I&&O)throw new Ne;I?(u=new nn(0,v.getY()),g=new nn(0,w.getY())):O&&(v=new nn(a.getWidth()-1,u.getY()),w=new nn(a.getWidth()-1,g.getY())),this.image=a,this.topLeft=u,this.bottomLeft=g,this.topRight=v,this.bottomRight=w,this.minX=Math.trunc(Math.min(u.getX(),g.getX())),this.maxX=Math.trunc(Math.max(v.getX(),w.getX())),this.minY=Math.trunc(Math.min(u.getY(),v.getY())),this.maxY=Math.trunc(Math.max(g.getY(),w.getY()))}constructor_2(a){this.image=a.image,this.topLeft=a.getTopLeft(),this.bottomLeft=a.getBottomLeft(),this.topRight=a.getTopRight(),this.bottomRight=a.getBottomRight(),this.minX=a.getMinX(),this.maxX=a.getMaxX(),this.minY=a.getMinY(),this.maxY=a.getMaxY()}static merge(a,u){return a==null?u:u==null?a:new Us(a.image,a.topLeft,a.bottomLeft,u.topRight,u.bottomRight)}addMissingRows(a,u,g){let v=this.topLeft,w=this.bottomLeft,I=this.topRight,O=this.bottomRight;if(a>0){let F=g?this.topLeft:this.topRight,q=Math.trunc(F.getY()-a);q<0&&(q=0);let te=new nn(F.getX(),q);g?v=te:I=te}if(u>0){let F=g?this.bottomLeft:this.bottomRight,q=Math.trunc(F.getY()+u);q>=this.image.getHeight()&&(q=this.image.getHeight()-1);let te=new nn(F.getX(),q);g?w=te:O=te}return new Us(this.image,v,w,I,O)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Nr{constructor(a,u,g,v){this.columnCount=a,this.errorCorrectionLevel=v,this.rowCountUpperPart=u,this.rowCountLowerPart=g,this.rowCount=u+g}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class ma{constructor(){this.buffer=""}static form(a,u){let g=-1;function v(I,O,F,q,te,ue){if(I==="%%")return"%";if(u[++g]===void 0)return;I=q?parseInt(q.substr(1)):void 0;let xe=te?parseInt(te.substr(1)):void 0,ze;switch(ue){case"s":ze=u[g];break;case"c":ze=u[g][0];break;case"f":ze=parseFloat(u[g]).toFixed(I);break;case"p":ze=parseFloat(u[g]).toPrecision(I);break;case"e":ze=parseFloat(u[g]).toExponential(I);break;case"x":ze=parseInt(u[g]).toString(xe||16);break;case"d":ze=parseFloat(parseInt(u[g],xe||10).toPrecision(I)).toFixed(0);break}ze=typeof ze=="object"?JSON.stringify(ze):(+ze).toString(xe);let ot=parseInt(F),ht=F&&F[0]+""=="0"?"0":" ";for(;ze.length<ot;)ze=O!==void 0?ze+ht:ht+ze;return ze}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return a.replace(w,v)}format(a,...u){this.buffer+=ma.form(a,u)}toString(){return this.buffer}}class ys{constructor(a){this.boundingBox=new Us(a),this.codewords=new Array(a.getMaxY()-a.getMinY()+1)}getCodewordNearby(a){let u=this.getCodeword(a);if(u!=null)return u;for(let g=1;g<ys.MAX_NEARBY_DISTANCE;g++){let v=this.imageRowToCodewordIndex(a)-g;if(v>=0&&(u=this.codewords[v],u!=null)||(v=this.imageRowToCodewordIndex(a)+g,v<this.codewords.length&&(u=this.codewords[v],u!=null)))return u}return null}imageRowToCodewordIndex(a){return a-this.boundingBox.getMinY()}setCodeword(a,u){this.codewords[this.imageRowToCodewordIndex(a)]=u}getCodeword(a){return this.codewords[this.imageRowToCodewordIndex(a)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const a=new ma;let u=0;for(const g of this.codewords){if(g==null){a.format("%3d:    |   %n",u++);continue}a.format("%3d: %3d|%3d%n",u++,g.getRowNumber(),g.getValue())}return a.toString()}}ys.MAX_NEARBY_DISTANCE=5;class Ea{constructor(){this.values=new Map}setValue(a){a=Math.trunc(a);let u=this.values.get(a);u==null&&(u=0),u++,this.values.set(a,u)}getValue(){let a=-1,u=new Array;for(const[g,v]of this.values.entries()){const w={getKey:()=>g,getValue:()=>v};w.getValue()>a?(a=w.getValue(),u=[],u.push(w.getKey())):w.getValue()===a&&u.push(w.getKey())}return yn.toIntArray(u)}getConfidence(a){return this.values.get(a)}}class Ds extends ys{constructor(a,u){super(a),this._isLeft=u}setRowNumbers(){for(let a of this.getCodewords())a?.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(a){let u=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(u,a);let g=this.getBoundingBox(),v=this._isLeft?g.getTopLeft():g.getTopRight(),w=this._isLeft?g.getBottomLeft():g.getBottomRight(),I=this.imageRowToCodewordIndex(Math.trunc(v.getY())),O=this.imageRowToCodewordIndex(Math.trunc(w.getY())),F=-1,q=1,te=0;for(let ue=I;ue<O;ue++){if(u[ue]==null)continue;let xe=u[ue],ze=xe.getRowNumber()-F;if(ze===0)te++;else if(ze===1)q=Math.max(q,te),te=1,F=xe.getRowNumber();else if(ze<0||xe.getRowNumber()>=a.getRowCount()||ze>ue)u[ue]=null;else{let ot;q>2?ot=(q-2)*ze:ot=ze;let ht=ot>=ue;for(let Dt=1;Dt<=ot&&!ht;Dt++)ht=u[ue-Dt]!=null;ht?u[ue]=null:(F=xe.getRowNumber(),te=1)}}}getRowHeights(){let a=this.getBarcodeMetadata();if(a==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(a);let u=new Int32Array(a.getRowCount());for(let g of this.getCodewords())if(g!=null){let v=g.getRowNumber();if(v>=u.length)continue;u[v]++}return u}adjustIncompleteIndicatorColumnRowNumbers(a){let u=this.getBoundingBox(),g=this._isLeft?u.getTopLeft():u.getTopRight(),v=this._isLeft?u.getBottomLeft():u.getBottomRight(),w=this.imageRowToCodewordIndex(Math.trunc(g.getY())),I=this.imageRowToCodewordIndex(Math.trunc(v.getY())),O=this.getCodewords(),F=-1;for(let q=w;q<I;q++){if(O[q]==null)continue;let te=O[q];te.setRowNumberAsRowIndicatorColumn();let ue=te.getRowNumber()-F;ue===0||(ue===1?F=te.getRowNumber():te.getRowNumber()>=a.getRowCount()?O[q]=null:F=te.getRowNumber())}}getBarcodeMetadata(){let a=this.getCodewords(),u=new Ea,g=new Ea,v=new Ea,w=new Ea;for(let O of a){if(O==null)continue;O.setRowNumberAsRowIndicatorColumn();let F=O.getValue()%30,q=O.getRowNumber();switch(this._isLeft||(q+=2),q%3){case 0:g.setValue(F*3+1);break;case 1:w.setValue(F/3),v.setValue(F%3);break;case 2:u.setValue(F+1);break}}if(u.getValue().length===0||g.getValue().length===0||v.getValue().length===0||w.getValue().length===0||u.getValue()[0]<1||g.getValue()[0]+v.getValue()[0]<yn.MIN_ROWS_IN_BARCODE||g.getValue()[0]+v.getValue()[0]>yn.MAX_ROWS_IN_BARCODE)return null;let I=new Nr(u.getValue()[0],g.getValue()[0],v.getValue()[0],w.getValue()[0]);return this.removeIncorrectCodewords(a,I),I}removeIncorrectCodewords(a,u){for(let g=0;g<a.length;g++){let v=a[g];if(a[g]==null)continue;let w=v.getValue()%30,I=v.getRowNumber();if(I>u.getRowCount()){a[g]=null;continue}switch(this._isLeft||(I+=2),I%3){case 0:w*3+1!==u.getRowCountUpperPart()&&(a[g]=null);break;case 1:(Math.trunc(w/3)!==u.getErrorCorrectionLevel()||w%3!==u.getRowCountLowerPart())&&(a[g]=null);break;case 2:w+1!==u.getColumnCount()&&(a[g]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Dr{constructor(a,u){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=a,this.barcodeColumnCount=a.getColumnCount(),this.boundingBox=u,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let a=yn.MAX_CODEWORDS_IN_BARCODE,u;do u=a,a=this.adjustRowNumbersAndGetCount();while(a>0&&a<u);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(a){a?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let a=this.adjustRowNumbersByRow();if(a===0)return 0;for(let u=1;u<this.barcodeColumnCount+1;u++){let g=this.detectionResultColumns[u].getCodewords();for(let v=0;v<g.length;v++)g[v]!=null&&(g[v].hasValidRowNumber()||this.adjustRowNumbers(u,v,g))}return a}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let a=this.detectionResultColumns[0].getCodewords(),u=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let g=0;g<a.length;g++)if(a[g]!=null&&u[g]!=null&&a[g].getRowNumber()===u[g].getRowNumber())for(let v=1;v<=this.barcodeColumnCount;v++){let w=this.detectionResultColumns[v].getCodewords()[g];w!=null&&(w.setRowNumber(a[g].getRowNumber()),w.hasValidRowNumber()||(this.detectionResultColumns[v].getCodewords()[g]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let a=0,u=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let g=0;g<u.length;g++){if(u[g]==null)continue;let v=u[g].getRowNumber(),w=0;for(let I=this.barcodeColumnCount+1;I>0&&w<this.ADJUST_ROW_NUMBER_SKIP;I--){let O=this.detectionResultColumns[I].getCodewords()[g];O!=null&&(w=Dr.adjustRowNumberIfValid(v,w,O),O.hasValidRowNumber()||a++)}}return a}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let a=0,u=this.detectionResultColumns[0].getCodewords();for(let g=0;g<u.length;g++){if(u[g]==null)continue;let v=u[g].getRowNumber(),w=0;for(let I=1;I<this.barcodeColumnCount+1&&w<this.ADJUST_ROW_NUMBER_SKIP;I++){let O=this.detectionResultColumns[I].getCodewords()[g];O!=null&&(w=Dr.adjustRowNumberIfValid(v,w,O),O.hasValidRowNumber()||a++)}}return a}static adjustRowNumberIfValid(a,u,g){return g==null||g.hasValidRowNumber()||(g.isValidRowNumber(a)?(g.setRowNumber(a),u=0):++u),u}adjustRowNumbers(a,u,g){if(!this.detectionResultColumns[a-1])return;let v=g[u],w=this.detectionResultColumns[a-1].getCodewords(),I=w;this.detectionResultColumns[a+1]!=null&&(I=this.detectionResultColumns[a+1].getCodewords());let O=new Array(14);O[2]=w[u],O[3]=I[u],u>0&&(O[0]=g[u-1],O[4]=w[u-1],O[5]=I[u-1]),u>1&&(O[8]=g[u-2],O[10]=w[u-2],O[11]=I[u-2]),u<g.length-1&&(O[1]=g[u+1],O[6]=w[u+1],O[7]=I[u+1]),u<g.length-2&&(O[9]=g[u+2],O[12]=w[u+2],O[13]=I[u+2]);for(let F of O)if(Dr.adjustRowNumber(v,F))return}static adjustRowNumber(a,u){return u==null?!1:u.hasValidRowNumber()&&u.getBucket()===a.getBucket()?(a.setRowNumber(u.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(a){this.boundingBox=a}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(a,u){this.detectionResultColumns[a]=u}getDetectionResultColumn(a){return this.detectionResultColumns[a]}toString(){let a=this.detectionResultColumns[0];a==null&&(a=this.detectionResultColumns[this.barcodeColumnCount+1]);let u=new ma;for(let g=0;g<a.getCodewords().length;g++){u.format("CW %3d:",g);for(let v=0;v<this.barcodeColumnCount+2;v++){if(this.detectionResultColumns[v]==null){u.format("    |   ");continue}let w=this.detectionResultColumns[v].getCodewords()[g];if(w==null){u.format("    |   ");continue}u.format(" %3d|%3d",w.getRowNumber(),w.getValue())}u.format("%n")}return u.toString()}}class ns{constructor(a,u,g,v){this.rowNumber=ns.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(a),this.endX=Math.trunc(u),this.bucket=Math.trunc(g),this.value=Math.trunc(v)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(a){return a!==ns.BARCODE_ROW_UNKNOWN&&this.bucket===a%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(a){this.rowNumber=a}toString(){return this.rowNumber+"|"+this.value}}ns.BARCODE_ROW_UNKNOWN=-1;class ir{static initialize(){for(let a=0;a<yn.SYMBOL_TABLE.length;a++){let u=yn.SYMBOL_TABLE[a],g=u&1;for(let v=0;v<yn.BARS_IN_MODULE;v++){let w=0;for(;(u&1)===g;)w+=1,u>>=1;g=u&1,ir.RATIOS_TABLE[a]||(ir.RATIOS_TABLE[a]=new Array(yn.BARS_IN_MODULE)),ir.RATIOS_TABLE[a][yn.BARS_IN_MODULE-v-1]=Math.fround(w/yn.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(a){let u=ir.getDecodedCodewordValue(ir.sampleBitCounts(a));return u!==-1?u:ir.getClosestDecodedValue(a)}static sampleBitCounts(a){let u=In.sum(a),g=new Int32Array(yn.BARS_IN_MODULE),v=0,w=0;for(let I=0;I<yn.MODULES_IN_CODEWORD;I++){let O=u/(2*yn.MODULES_IN_CODEWORD)+I*u/yn.MODULES_IN_CODEWORD;w+a[v]<=O&&(w+=a[v],v++),g[v]++}return g}static getDecodedCodewordValue(a){let u=ir.getBitValue(a);return yn.getCodeword(u)===-1?-1:u}static getBitValue(a){let u=0;for(let g=0;g<a.length;g++)for(let v=0;v<a[g];v++)u=u<<1|(g%2===0?1:0);return Math.trunc(u)}static getClosestDecodedValue(a){let u=In.sum(a),g=new Array(yn.BARS_IN_MODULE);if(u>1)for(let I=0;I<g.length;I++)g[I]=Math.fround(a[I]/u);let v=vi.MAX_VALUE,w=-1;this.bSymbolTableReady||ir.initialize();for(let I=0;I<ir.RATIOS_TABLE.length;I++){let O=0,F=ir.RATIOS_TABLE[I];for(let q=0;q<yn.BARS_IN_MODULE;q++){let te=Math.fround(F[q]-g[q]);if(O+=Math.fround(te*te),O>=v)break}O<v&&(v=O,w=yn.SYMBOL_TABLE[I])}return w}}ir.bSymbolTableReady=!1,ir.RATIOS_TABLE=new Array(yn.SYMBOL_TABLE.length).map(le=>new Array(yn.BARS_IN_MODULE));class Eo{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(a){this.segmentIndex=a}getFileId(){return this.fileId}setFileId(a){this.fileId=a}getOptionalData(){return this.optionalData}setOptionalData(a){this.optionalData=a}isLastSegment(){return this.lastSegment}setLastSegment(a){this.lastSegment=a}getSegmentCount(){return this.segmentCount}setSegmentCount(a){this.segmentCount=a}getSender(){return this.sender||null}setSender(a){this.sender=a}getAddressee(){return this.addressee||null}setAddressee(a){this.addressee=a}getFileName(){return this.fileName}setFileName(a){this.fileName=a}getFileSize(){return this.fileSize}setFileSize(a){this.fileSize=a}getChecksum(){return this.checksum}setChecksum(a){this.checksum=a}getTimestamp(){return this.timestamp}setTimestamp(a){this.timestamp=a}}class So{static parseLong(a,u=void 0){return parseInt(a,u)}}class cr extends H{}cr.kind="NullPointerException";class Ee{writeBytes(a){this.writeBytesOffset(a,0,a.length)}writeBytesOffset(a,u,g){if(a==null)throw new cr;if(u<0||u>a.length||g<0||u+g>a.length||u+g<0)throw new he;if(g===0)return;for(let v=0;v<g;v++)this.write(a[u+v])}flush(){}close(){}}class qe extends H{}class Xe extends Ee{constructor(a=32){if(super(),this.count=0,a<0)throw new Q("Negative initial size: "+a);this.buf=new Uint8Array(a)}ensureCapacity(a){a-this.buf.length>0&&this.grow(a)}grow(a){let g=this.buf.length<<1;if(g-a<0&&(g=a),g<0){if(a<0)throw new qe;g=Ye.MAX_VALUE}this.buf=tt.copyOfUint8Array(this.buf,g)}write(a){this.ensureCapacity(this.count+1),this.buf[this.count]=a,this.count+=1}writeBytesOffset(a,u,g){if(u<0||u>a.length||g<0||u+g-a.length>0)throw new he;this.ensureCapacity(this.count+g),me.arraycopy(a,u,this.buf,this.count,g),this.count+=g}writeTo(a){a.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return tt.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(a){return a?typeof a=="string"?this.toString_string(a):this.toString_number(a):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(a){return new String(this.buf).toString()}toString_number(a){return new String(this.buf).toString()}close(){}}var et;(function(le){le[le.ALPHA=0]="ALPHA",le[le.LOWER=1]="LOWER",le[le.MIXED=2]="MIXED",le[le.PUNCT=3]="PUNCT",le[le.ALPHA_SHIFT=4]="ALPHA_SHIFT",le[le.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(et||(et={}));function bt(){if(typeof window<"u")return window.BigInt||null;if(typeof Vm<"u")return Vm.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Mn;function Xn(le){if(typeof Mn>"u"&&(Mn=bt()),Mn===null)throw new Error("BigInt is not supported!");return Mn(le)}function Ui(){let le=[];le[0]=Xn(1);let a=Xn(900);le[1]=a;for(let u=2;u<16;u++)le[u]=le[u-1]*a;return le}class It{static decode(a,u){let g=new vt(""),v=He.ISO8859_1;g.enableDecoding(v);let w=1,I=a[w++],O=new Eo;for(;w<a[0];){switch(I){case It.TEXT_COMPACTION_MODE_LATCH:w=It.textCompaction(a,w,g);break;case It.BYTE_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:w=It.byteCompaction(I,a,v,w,g);break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(a[w++]);break;case It.NUMERIC_COMPACTION_MODE_LATCH:w=It.numericCompaction(a,w,g);break;case It.ECI_CHARSET:He.getCharacterSetECIByValue(a[w++]);break;case It.ECI_GENERAL_PURPOSE:w+=2;break;case It.ECI_USER_DEFINED:w++;break;case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:w=It.decodeMacroBlock(a,w,O);break;case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:throw new it;default:w--,w=It.textCompaction(a,w,g);break}if(w<a.length)I=a[w++];else throw it.getFormatInstance()}if(g.length()===0)throw it.getFormatInstance();let F=new sn(null,g.toString(),null,u);return F.setOther(O),F}static decodeMacroBlock(a,u,g){if(u+It.NUMBER_OF_SEQUENCE_CODEWORDS>a[0])throw it.getFormatInstance();let v=new Int32Array(It.NUMBER_OF_SEQUENCE_CODEWORDS);for(let O=0;O<It.NUMBER_OF_SEQUENCE_CODEWORDS;O++,u++)v[O]=a[u];g.setSegmentIndex(Ye.parseInt(It.decodeBase900toBase10(v,It.NUMBER_OF_SEQUENCE_CODEWORDS)));let w=new vt;u=It.textCompaction(a,u,w),g.setFileId(w.toString());let I=-1;for(a[u]===It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(I=u+1);u<a[0];)switch(a[u]){case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(u++,a[u]){case It.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let O=new vt;u=It.textCompaction(a,u+1,O),g.setFileName(O.toString());break;case It.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let F=new vt;u=It.textCompaction(a,u+1,F),g.setSender(F.toString());break;case It.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let q=new vt;u=It.textCompaction(a,u+1,q),g.setAddressee(q.toString());break;case It.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let te=new vt;u=It.numericCompaction(a,u+1,te),g.setSegmentCount(Ye.parseInt(te.toString()));break;case It.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let ue=new vt;u=It.numericCompaction(a,u+1,ue),g.setTimestamp(So.parseLong(ue.toString()));break;case It.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let xe=new vt;u=It.numericCompaction(a,u+1,xe),g.setChecksum(Ye.parseInt(xe.toString()));break;case It.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let ze=new vt;u=It.numericCompaction(a,u+1,ze),g.setFileSize(So.parseLong(ze.toString()));break;default:throw it.getFormatInstance()}break;case It.MACRO_PDF417_TERMINATOR:u++,g.setLastSegment(!0);break;default:throw it.getFormatInstance()}if(I!==-1){let O=u-I;g.isLastSegment()&&O--,g.setOptionalData(tt.copyOfRange(a,I,I+O))}return u}static textCompaction(a,u,g){let v=new Int32Array((a[0]-u)*2),w=new Int32Array((a[0]-u)*2),I=0,O=!1;for(;u<a[0]&&!O;){let F=a[u++];if(F<It.TEXT_COMPACTION_MODE_LATCH)v[I]=F/30,v[I+1]=F%30,I+=2;else switch(F){case It.TEXT_COMPACTION_MODE_LATCH:v[I++]=It.TEXT_COMPACTION_MODE_LATCH;break;case It.BYTE_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:case It.NUMERIC_COMPACTION_MODE_LATCH:case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:u--,O=!0;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v[I]=It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,F=a[u++],w[I]=F,I++;break}}return It.decodeTextCompaction(v,w,I,g),u}static decodeTextCompaction(a,u,g,v){let w=et.ALPHA,I=et.ALPHA,O=0;for(;O<g;){let F=a[O],q="";switch(w){case et.ALPHA:if(F<26)q=String.fromCharCode(65+F);else switch(F){case 26:q=" ";break;case It.LL:w=et.LOWER;break;case It.ML:w=et.MIXED;break;case It.PS:I=w,w=et.PUNCT_SHIFT;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=et.ALPHA;break}break;case et.LOWER:if(F<26)q=String.fromCharCode(97+F);else switch(F){case 26:q=" ";break;case It.AS:I=w,w=et.ALPHA_SHIFT;break;case It.ML:w=et.MIXED;break;case It.PS:I=w,w=et.PUNCT_SHIFT;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=et.ALPHA;break}break;case et.MIXED:if(F<It.PL)q=It.MIXED_CHARS[F];else switch(F){case It.PL:w=et.PUNCT;break;case 26:q=" ";break;case It.LL:w=et.LOWER;break;case It.AL:w=et.ALPHA;break;case It.PS:I=w,w=et.PUNCT_SHIFT;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=et.ALPHA;break}break;case et.PUNCT:if(F<It.PAL)q=It.PUNCT_CHARS[F];else switch(F){case It.PAL:w=et.ALPHA;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=et.ALPHA;break}break;case et.ALPHA_SHIFT:if(w=I,F<26)q=String.fromCharCode(65+F);else switch(F){case 26:q=" ";break;case It.TEXT_COMPACTION_MODE_LATCH:w=et.ALPHA;break}break;case et.PUNCT_SHIFT:if(w=I,F<It.PAL)q=It.PUNCT_CHARS[F];else switch(F){case It.PAL:w=et.ALPHA;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=et.ALPHA;break}break}q!==""&&v.append(q),O++}}static byteCompaction(a,u,g,v,w){let I=new Xe,O=0,F=0,q=!1;switch(a){case It.BYTE_COMPACTION_MODE_LATCH:let te=new Int32Array(6),ue=u[v++];for(;v<u[0]&&!q;)switch(te[O++]=ue,F=900*F+ue,ue=u[v++],ue){case It.TEXT_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH:case It.NUMERIC_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:v--,q=!0;break;default:if(O%5===0&&O>0){for(let xe=0;xe<6;++xe)I.write(Number(Xn(F)>>Xn(8*(5-xe))));F=0,O=0}break}v===u[0]&&ue<It.TEXT_COMPACTION_MODE_LATCH&&(te[O++]=ue);for(let xe=0;xe<O;xe++)I.write(te[xe]);break;case It.BYTE_COMPACTION_MODE_LATCH_6:for(;v<u[0]&&!q;){let xe=u[v++];if(xe<It.TEXT_COMPACTION_MODE_LATCH)O++,F=900*F+xe;else switch(xe){case It.TEXT_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH:case It.NUMERIC_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:v--,q=!0;break}if(O%5===0&&O>0){for(let ze=0;ze<6;++ze)I.write(Number(Xn(F)>>Xn(8*(5-ze))));F=0,O=0}}break}return w.append(Pe.decode(I.toByteArray(),g)),v}static numericCompaction(a,u,g){let v=0,w=!1,I=new Int32Array(It.MAX_NUMERIC_CODEWORDS);for(;u<a[0]&&!w;){let O=a[u++];if(u===a[0]&&(w=!0),O<It.TEXT_COMPACTION_MODE_LATCH)I[v]=O,v++;else switch(O){case It.TEXT_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:u--,w=!0;break}(v%It.MAX_NUMERIC_CODEWORDS===0||O===It.NUMERIC_COMPACTION_MODE_LATCH||w)&&v>0&&(g.append(It.decodeBase900toBase10(I,v)),v=0)}return u}static decodeBase900toBase10(a,u){let g=Xn(0);for(let w=0;w<u;w++)g+=It.EXP900[u-w-1]*Xn(a[w]);let v=g.toString();if(v.charAt(0)!=="1")throw new it;return v.substring(1)}}It.TEXT_COMPACTION_MODE_LATCH=900,It.BYTE_COMPACTION_MODE_LATCH=901,It.NUMERIC_COMPACTION_MODE_LATCH=902,It.BYTE_COMPACTION_MODE_LATCH_6=924,It.ECI_USER_DEFINED=925,It.ECI_GENERAL_PURPOSE=926,It.ECI_CHARSET=927,It.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,It.MACRO_PDF417_TERMINATOR=922,It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,It.MAX_NUMERIC_CODEWORDS=15,It.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,It.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,It.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,It.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,It.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,It.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,It.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,It.PL=25,It.LL=27,It.AS=27,It.ML=28,It.AL=28,It.PS=29,It.PAL=29,It.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,It.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",It.EXP900=bt()?Ui():[],It.NUMBER_OF_SEQUENCE_CODEWORDS=2;class hi{constructor(){}static decode(a,u,g,v,w,I,O){let F=new Us(a,u,g,v,w),q=null,te=null,ue;for(let ot=!0;;ot=!1){if(u!=null&&(q=hi.getRowIndicatorColumn(a,F,u,!0,I,O)),v!=null&&(te=hi.getRowIndicatorColumn(a,F,v,!1,I,O)),ue=hi.merge(q,te),ue==null)throw Ne.getNotFoundInstance();let ht=ue.getBoundingBox();if(ot&&ht!=null&&(ht.getMinY()<F.getMinY()||ht.getMaxY()>F.getMaxY()))F=ht;else break}ue.setBoundingBox(F);let xe=ue.getBarcodeColumnCount()+1;ue.setDetectionResultColumn(0,q),ue.setDetectionResultColumn(xe,te);let ze=q!=null;for(let ot=1;ot<=xe;ot++){let ht=ze?ot:xe-ot;if(ue.getDetectionResultColumn(ht)!==void 0)continue;let Dt;ht===0||ht===xe?Dt=new Ds(F,ht===0):Dt=new ys(F),ue.setDetectionResultColumn(ht,Dt);let qt=-1,Sn=qt;for(let wn=F.getMinY();wn<=F.getMaxY();wn++){if(qt=hi.getStartColumn(ue,ht,wn,ze),qt<0||qt>F.getMaxX()){if(Sn===-1)continue;qt=Sn}let xn=hi.detectCodeword(a,F.getMinX(),F.getMaxX(),ze,qt,wn,I,O);xn!=null&&(Dt.setCodeword(wn,xn),Sn=qt,I=Math.min(I,xn.getWidth()),O=Math.max(O,xn.getWidth()))}}return hi.createDecoderResult(ue)}static merge(a,u){if(a==null&&u==null)return null;let g=hi.getBarcodeMetadata(a,u);if(g==null)return null;let v=Us.merge(hi.adjustBoundingBox(a),hi.adjustBoundingBox(u));return new Dr(g,v)}static adjustBoundingBox(a){if(a==null)return null;let u=a.getRowHeights();if(u==null)return null;let g=hi.getMax(u),v=0;for(let O of u)if(v+=g-O,O>0)break;let w=a.getCodewords();for(let O=0;v>0&&w[O]==null;O++)v--;let I=0;for(let O=u.length-1;O>=0&&(I+=g-u[O],!(u[O]>0));O--);for(let O=w.length-1;I>0&&w[O]==null;O--)I--;return a.getBoundingBox().addMissingRows(v,I,a.isLeft())}static getMax(a){let u=-1;for(let g of a)u=Math.max(u,g);return u}static getBarcodeMetadata(a,u){let g;if(a==null||(g=a.getBarcodeMetadata())==null)return u==null?null:u.getBarcodeMetadata();let v;return u==null||(v=u.getBarcodeMetadata())==null?g:g.getColumnCount()!==v.getColumnCount()&&g.getErrorCorrectionLevel()!==v.getErrorCorrectionLevel()&&g.getRowCount()!==v.getRowCount()?null:g}static getRowIndicatorColumn(a,u,g,v,w,I){let O=new Ds(u,v);for(let F=0;F<2;F++){let q=F===0?1:-1,te=Math.trunc(Math.trunc(g.getX()));for(let ue=Math.trunc(Math.trunc(g.getY()));ue<=u.getMaxY()&&ue>=u.getMinY();ue+=q){let xe=hi.detectCodeword(a,0,a.getWidth(),v,te,ue,w,I);xe!=null&&(O.setCodeword(ue,xe),v?te=xe.getStartX():te=xe.getEndX())}}return O}static adjustCodewordCount(a,u){let g=u[0][1],v=g.getValue(),w=a.getBarcodeColumnCount()*a.getBarcodeRowCount()-hi.getNumberOfECCodeWords(a.getBarcodeECLevel());if(v.length===0){if(w<1||w>yn.MAX_CODEWORDS_IN_BARCODE)throw Ne.getNotFoundInstance();g.setValue(w)}else v[0]!==w&&g.setValue(w)}static createDecoderResult(a){let u=hi.createBarcodeMatrix(a);hi.adjustCodewordCount(a,u);let g=new Array,v=new Int32Array(a.getBarcodeRowCount()*a.getBarcodeColumnCount()),w=[],I=new Array;for(let F=0;F<a.getBarcodeRowCount();F++)for(let q=0;q<a.getBarcodeColumnCount();q++){let te=u[F][q+1].getValue(),ue=F*a.getBarcodeColumnCount()+q;te.length===0?g.push(ue):te.length===1?v[ue]=te[0]:(I.push(ue),w.push(te))}let O=new Array(w.length);for(let F=0;F<O.length;F++)O[F]=w[F];return hi.createDecoderResultFromAmbiguousValues(a.getBarcodeECLevel(),v,yn.toIntArray(g),yn.toIntArray(I),O)}static createDecoderResultFromAmbiguousValues(a,u,g,v,w){let I=new Int32Array(v.length),O=100;for(;O-- >0;){for(let F=0;F<I.length;F++)u[v[F]]=w[F][I[F]];try{return hi.decodeCodewords(u,a,g)}catch(F){if(!(F instanceof we))throw F}if(I.length===0)throw we.getChecksumInstance();for(let F=0;F<I.length;F++)if(I[F]<w[F].length-1){I[F]++;break}else if(I[F]=0,F===I.length-1)throw we.getChecksumInstance()}throw we.getChecksumInstance()}static createBarcodeMatrix(a){let u=Array.from({length:a.getBarcodeRowCount()},()=>new Array(a.getBarcodeColumnCount()+2));for(let v=0;v<u.length;v++)for(let w=0;w<u[v].length;w++)u[v][w]=new Ea;let g=0;for(let v of a.getDetectionResultColumns()){if(v!=null){for(let w of v.getCodewords())if(w!=null){let I=w.getRowNumber();if(I>=0){if(I>=u.length)continue;u[I][g].setValue(w.getValue())}}}g++}return u}static isValidBarcodeColumn(a,u){return u>=0&&u<=a.getBarcodeColumnCount()+1}static getStartColumn(a,u,g,v){let w=v?1:-1,I=null;if(hi.isValidBarcodeColumn(a,u-w)&&(I=a.getDetectionResultColumn(u-w).getCodeword(g)),I!=null)return v?I.getEndX():I.getStartX();if(I=a.getDetectionResultColumn(u).getCodewordNearby(g),I!=null)return v?I.getStartX():I.getEndX();if(hi.isValidBarcodeColumn(a,u-w)&&(I=a.getDetectionResultColumn(u-w).getCodewordNearby(g)),I!=null)return v?I.getEndX():I.getStartX();let O=0;for(;hi.isValidBarcodeColumn(a,u-w);){u-=w;for(let F of a.getDetectionResultColumn(u).getCodewords())if(F!=null)return(v?F.getEndX():F.getStartX())+w*O*(F.getEndX()-F.getStartX());O++}return v?a.getBoundingBox().getMinX():a.getBoundingBox().getMaxX()}static detectCodeword(a,u,g,v,w,I,O,F){w=hi.adjustCodewordStartColumn(a,u,g,v,w,I);let q=hi.getModuleBitCount(a,u,g,v,w,I);if(q==null)return null;let te,ue=In.sum(q);if(v)te=w+ue;else{for(let ot=0;ot<q.length/2;ot++){let ht=q[ot];q[ot]=q[q.length-1-ot],q[q.length-1-ot]=ht}te=w,w=te-ue}if(!hi.checkCodewordSkew(ue,O,F))return null;let xe=ir.getDecodedValue(q),ze=yn.getCodeword(xe);return ze===-1?null:new ns(w,te,hi.getCodewordBucketNumber(xe),ze)}static getModuleBitCount(a,u,g,v,w,I){let O=w,F=new Int32Array(8),q=0,te=v?1:-1,ue=v;for(;(v?O<g:O>=u)&&q<F.length;)a.get(O,I)===ue?(F[q]++,O+=te):(q++,ue=!ue);return q===F.length||O===(v?g:u)&&q===F.length-1?F:null}static getNumberOfECCodeWords(a){return 2<<a}static adjustCodewordStartColumn(a,u,g,v,w,I){let O=w,F=v?-1:1;for(let q=0;q<2;q++){for(;(v?O>=u:O<g)&&v===a.get(O,I);){if(Math.abs(w-O)>hi.CODEWORD_SKEW_SIZE)return w;O+=F}F=-F,v=!v}return O}static checkCodewordSkew(a,u,g){return u-hi.CODEWORD_SKEW_SIZE<=a&&a<=g+hi.CODEWORD_SKEW_SIZE}static decodeCodewords(a,u,g){if(a.length===0)throw it.getFormatInstance();let v=1<<u+1,w=hi.correctErrors(a,g,v);hi.verifyCodewordCount(a,v);let I=It.decode(a,""+u);return I.setErrorsCorrected(w),I.setErasures(g.length),I}static correctErrors(a,u,g){if(u!=null&&u.length>g/2+hi.MAX_ERRORS||g<0||g>hi.MAX_EC_CODEWORDS)throw we.getChecksumInstance();return hi.errorCorrection.decode(a,g,u)}static verifyCodewordCount(a,u){if(a.length<4)throw it.getFormatInstance();let g=a[0];if(g>a.length)throw it.getFormatInstance();if(g===0)if(u<a.length)a[0]=a.length-u;else throw it.getFormatInstance()}static getBitCountForCodeword(a){let u=new Int32Array(8),g=0,v=u.length-1;for(;!((a&1)!==g&&(g=a&1,v--,v<0));)u[v]++,a>>=1;return u}static getCodewordBucketNumber(a){return a instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(a):this.getCodewordBucketNumber_number(a)}static getCodewordBucketNumber_number(a){return hi.getCodewordBucketNumber(hi.getBitCountForCodeword(a))}static getCodewordBucketNumber_Int32Array(a){return(a[0]-a[2]+a[4]-a[6]+9)%9}static toString(a){let u=new ma;for(let g=0;g<a.length;g++){u.format("Row %2d: ",g);for(let v=0;v<a[g].length;v++){let w=a[g][v];w.getValue().length===0?u.format("        ",null):u.format("%4d(%2d)",w.getValue()[0],w.getConfidence(w.getValue()[0]))}u.format("%n")}return u.toString()}}hi.CODEWORD_SKEW_SIZE=2,hi.MAX_ERRORS=3,hi.MAX_EC_CODEWORDS=512,hi.errorCorrection=new Ys;class Hi{decode(a,u=null){let g=Hi.decode(a,u,!1);if(g==null||g.length===0||g[0]==null)throw Ne.getNotFoundInstance();return g[0]}decodeMultiple(a,u=null){try{return Hi.decode(a,u,!0)}catch(g){throw g instanceof it||g instanceof we?Ne.getNotFoundInstance():g}}static decode(a,u,g){const v=new Array,w=Ci.detectMultiple(a,u,g);for(const I of w.getPoints()){const O=hi.decode(w.getBits(),I[4],I[5],I[6],I[7],Hi.getMinCodewordWidth(I),Hi.getMaxCodewordWidth(I)),F=new _t(O.getText(),O.getRawBytes(),void 0,I,Bt.PDF_417);F.putMetadata(an.ERROR_CORRECTION_LEVEL,O.getECLevel());const q=O.getOther();q!=null&&F.putMetadata(an.PDF417_EXTRA_METADATA,q),v.push(F)}return v.map(I=>I)}static getMaxWidth(a,u){return a==null||u==null?0:Math.trunc(Math.abs(a.getX()-u.getX()))}static getMinWidth(a,u){return a==null||u==null?Ye.MAX_VALUE:Math.trunc(Math.abs(a.getX()-u.getX()))}static getMaxCodewordWidth(a){return Math.floor(Math.max(Math.max(Hi.getMaxWidth(a[0],a[4]),Hi.getMaxWidth(a[6],a[2])*yn.MODULES_IN_CODEWORD/yn.MODULES_IN_STOP_PATTERN),Math.max(Hi.getMaxWidth(a[1],a[5]),Hi.getMaxWidth(a[7],a[3])*yn.MODULES_IN_CODEWORD/yn.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(a){return Math.floor(Math.min(Math.min(Hi.getMinWidth(a[0],a[4]),Hi.getMinWidth(a[6],a[2])*yn.MODULES_IN_CODEWORD/yn.MODULES_IN_STOP_PATTERN),Math.min(Hi.getMinWidth(a[1],a[5]),Hi.getMinWidth(a[7],a[3])*yn.MODULES_IN_CODEWORD/yn.MODULES_IN_STOP_PATTERN)))}reset(){}}class ya extends H{}ya.kind="ReaderException";class hc{constructor(a,u){this.verbose=a===!0,u&&this.setHints(u)}decode(a,u){return u&&this.setHints(u),this.decodeInternal(a)}decodeWithState(a){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(a)}setHints(a){this.hints=a;const u=!C(a)&&a.get(Et.TRY_HARDER)===!0,g=C(a)?null:a.get(Et.POSSIBLE_FORMATS),v=new Array;if(!C(g)){const w=g.some(I=>I===Bt.UPC_A||I===Bt.UPC_E||I===Bt.EAN_13||I===Bt.EAN_8||I===Bt.CODABAR||I===Bt.CODE_39||I===Bt.CODE_93||I===Bt.CODE_128||I===Bt.ITF||I===Bt.RSS_14||I===Bt.RSS_EXPANDED);w&&!u&&v.push(new Ri(a,this.verbose)),g.includes(Bt.QR_CODE)&&v.push(new er),g.includes(Bt.DATA_MATRIX)&&v.push(new Lr),g.includes(Bt.AZTEC)&&v.push(new Je),g.includes(Bt.PDF_417)&&v.push(new Hi),w&&u&&v.push(new Ri(a,this.verbose))}v.length===0&&(u||v.push(new Ri(a,this.verbose)),v.push(new er),v.push(new Lr),v.push(new Je),v.push(new Hi),u&&v.push(new Ri(a,this.verbose))),this.readers=v}reset(){if(this.readers!==null)for(const a of this.readers)a.reset()}decodeInternal(a){if(this.readers===null)throw new ya("No readers where selected, nothing can be read.");for(const u of this.readers)try{return u.decode(a,this.hints)}catch(g){if(g instanceof ya)continue}throw new Ne("No MultiFormat Readers were able to detect the code.")}}class qo extends Nt{constructor(a=null,u=500){const g=new hc;g.setHints(a),super(g,u)}decodeBitmap(a){return this.reader.decodeWithState(a)}}class Rs extends Nt{constructor(a=500){super(new Hi,a)}}class Cs extends Nt{constructor(a=500){super(new er,a)}}var rr;(function(le){le[le.ERROR_CORRECTION=0]="ERROR_CORRECTION",le[le.CHARACTER_SET=1]="CHARACTER_SET",le[le.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",le[le.MIN_SIZE=3]="MIN_SIZE",le[le.MAX_SIZE=4]="MAX_SIZE",le[le.MARGIN=5]="MARGIN",le[le.PDF417_COMPACT=6]="PDF417_COMPACT",le[le.PDF417_COMPACTION=7]="PDF417_COMPACTION",le[le.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",le[le.AZTEC_LAYERS=9]="AZTEC_LAYERS",le[le.QR_VERSION=10]="QR_VERSION"})(rr||(rr={}));var wr=rr;class Ra{constructor(a){this.field=a,this.cachedGenerators=[],this.cachedGenerators.push(new Dn(a,Int32Array.from([1])))}buildGenerator(a){const u=this.cachedGenerators;if(a>=u.length){let g=u[u.length-1];const v=this.field;for(let w=u.length;w<=a;w++){const I=g.multiply(new Dn(v,Int32Array.from([1,v.exp(w-1+v.getGeneratorBase())])));u.push(I),g=I}}return u[a]}encode(a,u){if(u===0)throw new Q("No error correction bytes");const g=a.length-u;if(g<=0)throw new Q("No data bytes provided");const v=this.buildGenerator(u),w=new Int32Array(g);me.arraycopy(a,0,w,0,g);let I=new Dn(this.field,w);I=I.multiplyByMonomial(u,1);const F=I.divide(v)[1].getCoefficients(),q=u-F.length;for(let te=0;te<q;te++)a[g+te]=0;me.arraycopy(F,0,a,g+q,F.length)}}class pr{constructor(){}static applyMaskPenaltyRule1(a){return pr.applyMaskPenaltyRule1Internal(a,!0)+pr.applyMaskPenaltyRule1Internal(a,!1)}static applyMaskPenaltyRule2(a){let u=0;const g=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let I=0;I<w-1;I++){const O=g[I];for(let F=0;F<v-1;F++){const q=O[F];q===O[F+1]&&q===g[I+1][F]&&q===g[I+1][F+1]&&u++}}return pr.N2*u}static applyMaskPenaltyRule3(a){let u=0;const g=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let I=0;I<w;I++)for(let O=0;O<v;O++){const F=g[I];O+6<v&&F[O]===1&&F[O+1]===0&&F[O+2]===1&&F[O+3]===1&&F[O+4]===1&&F[O+5]===0&&F[O+6]===1&&(pr.isWhiteHorizontal(F,O-4,O)||pr.isWhiteHorizontal(F,O+7,O+11))&&u++,I+6<w&&g[I][O]===1&&g[I+1][O]===0&&g[I+2][O]===1&&g[I+3][O]===1&&g[I+4][O]===1&&g[I+5][O]===0&&g[I+6][O]===1&&(pr.isWhiteVertical(g,O,I-4,I)||pr.isWhiteVertical(g,O,I+7,I+11))&&u++}return u*pr.N3}static isWhiteHorizontal(a,u,g){u=Math.max(u,0),g=Math.min(g,a.length);for(let v=u;v<g;v++)if(a[v]===1)return!1;return!0}static isWhiteVertical(a,u,g,v){g=Math.max(g,0),v=Math.min(v,a.length);for(let w=g;w<v;w++)if(a[w][u]===1)return!1;return!0}static applyMaskPenaltyRule4(a){let u=0;const g=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let F=0;F<w;F++){const q=g[F];for(let te=0;te<v;te++)q[te]===1&&u++}const I=a.getHeight()*a.getWidth();return Math.floor(Math.abs(u*2-I)*10/I)*pr.N4}static getDataMaskBit(a,u,g){let v,w;switch(a){case 0:v=g+u&1;break;case 1:v=g&1;break;case 2:v=u%3;break;case 3:v=(g+u)%3;break;case 4:v=Math.floor(g/2)+Math.floor(u/3)&1;break;case 5:w=g*u,v=(w&1)+w%3;break;case 6:w=g*u,v=(w&1)+w%3&1;break;case 7:w=g*u,v=w%3+(g+u&1)&1;break;default:throw new Q("Invalid mask pattern: "+a)}return v===0}static applyMaskPenaltyRule1Internal(a,u){let g=0;const v=u?a.getHeight():a.getWidth(),w=u?a.getWidth():a.getHeight(),I=a.getArray();for(let O=0;O<v;O++){let F=0,q=-1;for(let te=0;te<w;te++){const ue=u?I[O][te]:I[te][O];ue===q?F++:(F>=5&&(g+=pr.N1+(F-5)),F=1,q=ue)}F>=5&&(g+=pr.N1+(F-5))}return g}}pr.N1=3,pr.N2=3,pr.N3=40,pr.N4=10;class br{constructor(a,u){this.width=a,this.height=u;const g=new Array(u);for(let v=0;v!==u;v++)g[v]=new Uint8Array(a);this.bytes=g}getHeight(){return this.height}getWidth(){return this.width}get(a,u){return this.bytes[u][a]}getArray(){return this.bytes}setNumber(a,u,g){this.bytes[u][a]=g}setBoolean(a,u,g){this.bytes[u][a]=g?1:0}clear(a){for(const u of this.bytes)tt.fill(u,a)}equals(a){if(!(a instanceof br))return!1;const u=a;if(this.width!==u.width||this.height!==u.height)return!1;for(let g=0,v=this.height;g<v;++g){const w=this.bytes[g],I=u.bytes[g];for(let O=0,F=this.width;O<F;++O)if(w[O]!==I[O])return!1}return!0}toString(){const a=new vt;for(let u=0,g=this.height;u<g;++u){const v=this.bytes[u];for(let w=0,I=this.width;w<I;++w)switch(v[w]){case 0:a.append(" 0");break;case 1:a.append(" 1");break;default:a.append("  ");break}a.append(`
`)}return a.toString()}}class Pa{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const a=new vt;return a.append(`<<
`),a.append(" mode: "),a.append(this.mode?this.mode.toString():"null"),a.append(`
 ecLevel: `),a.append(this.ecLevel?this.ecLevel.toString():"null"),a.append(`
 version: `),a.append(this.version?this.version.toString():"null"),a.append(`
 maskPattern: `),a.append(this.maskPattern.toString()),this.matrix?(a.append(`
 matrix:
`),a.append(this.matrix.toString())):a.append(`
 matrix: null
`),a.append(`>>
`),a.toString()}setMode(a){this.mode=a}setECLevel(a){this.ecLevel=a}setVersion(a){this.version=a}setMaskPattern(a){this.maskPattern=a}setMatrix(a){this.matrix=a}static isValidMaskPattern(a){return a>=0&&a<Pa.NUM_MASK_PATTERNS}}Pa.NUM_MASK_PATTERNS=8;class Wi extends H{}Wi.kind="WriterException";class wi{constructor(){}static clearMatrix(a){a.clear(255)}static buildMatrix(a,u,g,v,w){wi.clearMatrix(w),wi.embedBasicPatterns(g,w),wi.embedTypeInfo(u,v,w),wi.maybeEmbedVersionInfo(g,w),wi.embedDataBits(a,v,w)}static embedBasicPatterns(a,u){wi.embedPositionDetectionPatternsAndSeparators(u),wi.embedDarkDotAtLeftBottomCorner(u),wi.maybeEmbedPositionAdjustmentPatterns(a,u),wi.embedTimingPatterns(u)}static embedTypeInfo(a,u,g){const v=new pt;wi.makeTypeInfoBits(a,u,v);for(let w=0,I=v.getSize();w<I;++w){const O=v.get(v.getSize()-1-w),F=wi.TYPE_INFO_COORDINATES[w],q=F[0],te=F[1];if(g.setBoolean(q,te,O),w<8){const ue=g.getWidth()-w-1;g.setBoolean(ue,8,O)}else{const xe=g.getHeight()-7+(w-8);g.setBoolean(8,xe,O)}}}static maybeEmbedVersionInfo(a,u){if(a.getVersionNumber()<7)return;const g=new pt;wi.makeVersionInfoBits(a,g);let v=17;for(let w=0;w<6;++w)for(let I=0;I<3;++I){const O=g.get(v);v--,u.setBoolean(w,u.getHeight()-11+I,O),u.setBoolean(u.getHeight()-11+I,w,O)}}static embedDataBits(a,u,g){let v=0,w=-1,I=g.getWidth()-1,O=g.getHeight()-1;for(;I>0;){for(I===6&&(I-=1);O>=0&&O<g.getHeight();){for(let F=0;F<2;++F){const q=I-F;if(!wi.isEmpty(g.get(q,O)))continue;let te;v<a.getSize()?(te=a.get(v),++v):te=!1,u!==255&&pr.getDataMaskBit(u,q,O)&&(te=!te),g.setBoolean(q,O,te)}O+=w}w=-w,O+=w,I-=2}if(v!==a.getSize())throw new Wi("Not all bits consumed: "+v+"/"+a.getSize())}static findMSBSet(a){return 32-Ye.numberOfLeadingZeros(a)}static calculateBCHCode(a,u){if(u===0)throw new Q("0 polynomial");const g=wi.findMSBSet(u);for(a<<=g-1;wi.findMSBSet(a)>=g;)a^=u<<wi.findMSBSet(a)-g;return a}static makeTypeInfoBits(a,u,g){if(!Pa.isValidMaskPattern(u))throw new Wi("Invalid mask pattern");const v=a.getBits()<<3|u;g.appendBits(v,5);const w=wi.calculateBCHCode(v,wi.TYPE_INFO_POLY);g.appendBits(w,10);const I=new pt;if(I.appendBits(wi.TYPE_INFO_MASK_PATTERN,15),g.xor(I),g.getSize()!==15)throw new Wi("should not happen but we got: "+g.getSize())}static makeVersionInfoBits(a,u){u.appendBits(a.getVersionNumber(),6);const g=wi.calculateBCHCode(a.getVersionNumber(),wi.VERSION_INFO_POLY);if(u.appendBits(g,12),u.getSize()!==18)throw new Wi("should not happen but we got: "+u.getSize())}static isEmpty(a){return a===255}static embedTimingPatterns(a){for(let u=8;u<a.getWidth()-8;++u){const g=(u+1)%2;wi.isEmpty(a.get(u,6))&&a.setNumber(u,6,g),wi.isEmpty(a.get(6,u))&&a.setNumber(6,u,g)}}static embedDarkDotAtLeftBottomCorner(a){if(a.get(8,a.getHeight()-8)===0)throw new Wi;a.setNumber(8,a.getHeight()-8,1)}static embedHorizontalSeparationPattern(a,u,g){for(let v=0;v<8;++v){if(!wi.isEmpty(g.get(a+v,u)))throw new Wi;g.setNumber(a+v,u,0)}}static embedVerticalSeparationPattern(a,u,g){for(let v=0;v<7;++v){if(!wi.isEmpty(g.get(a,u+v)))throw new Wi;g.setNumber(a,u+v,0)}}static embedPositionAdjustmentPattern(a,u,g){for(let v=0;v<5;++v){const w=wi.POSITION_ADJUSTMENT_PATTERN[v];for(let I=0;I<5;++I)g.setNumber(a+I,u+v,w[I])}}static embedPositionDetectionPattern(a,u,g){for(let v=0;v<7;++v){const w=wi.POSITION_DETECTION_PATTERN[v];for(let I=0;I<7;++I)g.setNumber(a+I,u+v,w[I])}}static embedPositionDetectionPatternsAndSeparators(a){const u=wi.POSITION_DETECTION_PATTERN[0].length;wi.embedPositionDetectionPattern(0,0,a),wi.embedPositionDetectionPattern(a.getWidth()-u,0,a),wi.embedPositionDetectionPattern(0,a.getWidth()-u,a);const g=8;wi.embedHorizontalSeparationPattern(0,g-1,a),wi.embedHorizontalSeparationPattern(a.getWidth()-g,g-1,a),wi.embedHorizontalSeparationPattern(0,a.getWidth()-g,a);const v=7;wi.embedVerticalSeparationPattern(v,0,a),wi.embedVerticalSeparationPattern(a.getHeight()-v-1,0,a),wi.embedVerticalSeparationPattern(v,a.getHeight()-v,a)}static maybeEmbedPositionAdjustmentPatterns(a,u){if(a.getVersionNumber()<2)return;const g=a.getVersionNumber()-1,v=wi.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[g];for(let w=0,I=v.length;w!==I;w++){const O=v[w];if(O>=0)for(let F=0;F!==I;F++){const q=v[F];q>=0&&wi.isEmpty(u.get(q,O))&&wi.embedPositionAdjustmentPattern(q-2,O-2,u)}}}}wi.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),wi.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),wi.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),wi.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),wi.VERSION_INFO_POLY=7973,wi.TYPE_INFO_POLY=1335,wi.TYPE_INFO_MASK_PATTERN=21522;class ih{constructor(a,u){this.dataBytes=a,this.errorCorrectionBytes=u}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class gr{constructor(){}static calculateMaskPenalty(a){return pr.applyMaskPenaltyRule1(a)+pr.applyMaskPenaltyRule2(a)+pr.applyMaskPenaltyRule3(a)+pr.applyMaskPenaltyRule4(a)}static encode(a,u,g=null){let v=gr.DEFAULT_BYTE_MODE_ENCODING;const w=g!==null&&g.get(wr.CHARACTER_SET)!==void 0;w&&(v=g.get(wr.CHARACTER_SET).toString());const I=this.chooseMode(a,v),O=new pt;if(I===mi.BYTE&&(w||gr.DEFAULT_BYTE_MODE_ENCODING!==v)){const wn=He.getCharacterSetECIByName(v);wn!==void 0&&this.appendECI(wn,O)}this.appendModeInfo(I,O);const F=new pt;this.appendBytes(a,I,F,v);let q;if(g!==null&&g.get(wr.QR_VERSION)!==void 0){const wn=Number.parseInt(g.get(wr.QR_VERSION).toString(),10);q=oi.getVersionForNumber(wn);const xn=this.calculateBitsNeeded(I,O,F,q);if(!this.willFit(xn,q,u))throw new Wi("Data too big for requested version")}else q=this.recommendVersion(u,I,O,F);const te=new pt;te.appendBitArray(O);const ue=I===mi.BYTE?F.getSizeInBytes():a.length;this.appendLengthInfo(ue,q,I,te),te.appendBitArray(F);const xe=q.getECBlocksForLevel(u),ze=q.getTotalCodewords()-xe.getTotalECCodewords();this.terminateBits(ze,te);const ot=this.interleaveWithECBytes(te,q.getTotalCodewords(),ze,xe.getNumBlocks()),ht=new Pa;ht.setECLevel(u),ht.setMode(I),ht.setVersion(q);const Dt=q.getDimensionForVersion(),qt=new br(Dt,Dt),Sn=this.chooseMaskPattern(ot,u,q,qt);return ht.setMaskPattern(Sn),wi.buildMatrix(ot,u,q,Sn,qt),ht.setMatrix(qt),ht}static recommendVersion(a,u,g,v){const w=this.calculateBitsNeeded(u,g,v,oi.getVersionForNumber(1)),I=this.chooseVersion(w,a),O=this.calculateBitsNeeded(u,g,v,I);return this.chooseVersion(O,a)}static calculateBitsNeeded(a,u,g,v){return u.getSize()+a.getCharacterCountBits(v)+g.getSize()}static getAlphanumericCode(a){return a<gr.ALPHANUMERIC_TABLE.length?gr.ALPHANUMERIC_TABLE[a]:-1}static chooseMode(a,u=null){if(He.SJIS.getName()===u&&this.isOnlyDoubleByteKanji(a))return mi.KANJI;let g=!1,v=!1;for(let w=0,I=a.length;w<I;++w){const O=a.charAt(w);if(gr.isDigit(O))g=!0;else if(this.getAlphanumericCode(O.charCodeAt(0))!==-1)v=!0;else return mi.BYTE}return v?mi.ALPHANUMERIC:g?mi.NUMERIC:mi.BYTE}static isOnlyDoubleByteKanji(a){let u;try{u=Pe.encode(a,He.SJIS)}catch{return!1}const g=u.length;if(g%2!==0)return!1;for(let v=0;v<g;v+=2){const w=u[v]&255;if((w<129||w>159)&&(w<224||w>235))return!1}return!0}static chooseMaskPattern(a,u,g,v){let w=Number.MAX_SAFE_INTEGER,I=-1;for(let O=0;O<Pa.NUM_MASK_PATTERNS;O++){wi.buildMatrix(a,u,g,O,v);let F=this.calculateMaskPenalty(v);F<w&&(w=F,I=O)}return I}static chooseVersion(a,u){for(let g=1;g<=40;g++){const v=oi.getVersionForNumber(g);if(gr.willFit(a,v,u))return v}throw new Wi("Data too big")}static willFit(a,u,g){const v=u.getTotalCodewords(),I=u.getECBlocksForLevel(g).getTotalECCodewords(),O=v-I,F=(a+7)/8;return O>=F}static terminateBits(a,u){const g=a*8;if(u.getSize()>g)throw new Wi("data bits cannot fit in the QR Code"+u.getSize()+" > "+g);for(let I=0;I<4&&u.getSize()<g;++I)u.appendBit(!1);const v=u.getSize()&7;if(v>0)for(let I=v;I<8;I++)u.appendBit(!1);const w=a-u.getSizeInBytes();for(let I=0;I<w;++I)u.appendBits((I&1)===0?236:17,8);if(u.getSize()!==g)throw new Wi("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(a,u,g,v,w,I){if(v>=g)throw new Wi("Block ID too large");const O=a%g,F=g-O,q=Math.floor(a/g),te=q+1,ue=Math.floor(u/g),xe=ue+1,ze=q-ue,ot=te-xe;if(ze!==ot)throw new Wi("EC bytes mismatch");if(g!==F+O)throw new Wi("RS blocks mismatch");if(a!==(ue+ze)*F+(xe+ot)*O)throw new Wi("Total bytes mismatch");v<F?(w[0]=ue,I[0]=ze):(w[0]=xe,I[0]=ot)}static interleaveWithECBytes(a,u,g,v){if(a.getSizeInBytes()!==g)throw new Wi("Number of bits and data bytes does not match");let w=0,I=0,O=0;const F=new Array;for(let te=0;te<v;++te){const ue=new Int32Array(1),xe=new Int32Array(1);gr.getNumDataBytesAndNumECBytesForBlockID(u,g,v,te,ue,xe);const ze=ue[0],ot=new Uint8Array(ze);a.toBytes(8*w,ot,0,ze);const ht=gr.generateECBytes(ot,xe[0]);F.push(new ih(ot,ht)),I=Math.max(I,ze),O=Math.max(O,ht.length),w+=ue[0]}if(g!==w)throw new Wi("Data bytes does not match offset");const q=new pt;for(let te=0;te<I;++te)for(const ue of F){const xe=ue.getDataBytes();te<xe.length&&q.appendBits(xe[te],8)}for(let te=0;te<O;++te)for(const ue of F){const xe=ue.getErrorCorrectionBytes();te<xe.length&&q.appendBits(xe[te],8)}if(u!==q.getSizeInBytes())throw new Wi("Interleaving error: "+u+" and "+q.getSizeInBytes()+" differ.");return q}static generateECBytes(a,u){const g=a.length,v=new Int32Array(g+u);for(let I=0;I<g;I++)v[I]=a[I]&255;new Ra(kn.QR_CODE_FIELD_256).encode(v,u);const w=new Uint8Array(u);for(let I=0;I<u;I++)w[I]=v[g+I];return w}static appendModeInfo(a,u){u.appendBits(a.getBits(),4)}static appendLengthInfo(a,u,g,v){const w=g.getCharacterCountBits(u);if(a>=1<<w)throw new Wi(a+" is bigger than "+((1<<w)-1));v.appendBits(a,w)}static appendBytes(a,u,g,v){switch(u){case mi.NUMERIC:gr.appendNumericBytes(a,g);break;case mi.ALPHANUMERIC:gr.appendAlphanumericBytes(a,g);break;case mi.BYTE:gr.append8BitBytes(a,g,v);break;case mi.KANJI:gr.appendKanjiBytes(a,g);break;default:throw new Wi("Invalid mode: "+u)}}static getDigit(a){return a.charCodeAt(0)-48}static isDigit(a){const u=gr.getDigit(a);return u>=0&&u<=9}static appendNumericBytes(a,u){const g=a.length;let v=0;for(;v<g;){const w=gr.getDigit(a.charAt(v));if(v+2<g){const I=gr.getDigit(a.charAt(v+1)),O=gr.getDigit(a.charAt(v+2));u.appendBits(w*100+I*10+O,10),v+=3}else if(v+1<g){const I=gr.getDigit(a.charAt(v+1));u.appendBits(w*10+I,7),v+=2}else u.appendBits(w,4),v++}}static appendAlphanumericBytes(a,u){const g=a.length;let v=0;for(;v<g;){const w=gr.getAlphanumericCode(a.charCodeAt(v));if(w===-1)throw new Wi;if(v+1<g){const I=gr.getAlphanumericCode(a.charCodeAt(v+1));if(I===-1)throw new Wi;u.appendBits(w*45+I,11),v+=2}else u.appendBits(w,6),v++}}static append8BitBytes(a,u,g){let v;try{v=Pe.encode(a,g)}catch(w){throw new Wi(w)}for(let w=0,I=v.length;w!==I;w++){const O=v[w];u.appendBits(O,8)}}static appendKanjiBytes(a,u){let g;try{g=Pe.encode(a,He.SJIS)}catch(w){throw new Wi(w)}const v=g.length;for(let w=0;w<v;w+=2){const I=g[w]&255,O=g[w+1]&255,F=I<<8&4294967295|O;let q=-1;if(F>=33088&&F<=40956?q=F-33088:F>=57408&&F<=60351&&(q=F-49472),q===-1)throw new Wi("Invalid byte sequence");const te=(q>>8)*192+(q&255);u.appendBits(te,13)}}static appendECI(a,u){u.appendBits(mi.ECI.getBits(),4),u.appendBits(a.getValue(),8)}}gr.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),gr.DEFAULT_BYTE_MODE_ENCODING=He.UTF8.getName();class Ua{write(a,u,g,v=null){if(a.length===0)throw new Q("Found empty contents");if(u<0||g<0)throw new Q("Requested dimensions are too small: "+u+"x"+g);let w=Fi.L,I=Ua.QUIET_ZONE_SIZE;v!==null&&(v.get(wr.ERROR_CORRECTION)!==void 0&&(w=Fi.fromString(v.get(wr.ERROR_CORRECTION).toString())),v.get(wr.MARGIN)!==void 0&&(I=Number.parseInt(v.get(wr.MARGIN).toString(),10)));const O=gr.encode(a,w,v);return this.renderResult(O,u,g,I)}writeToDom(a,u,g,v,w=null){typeof a=="string"&&(a=document.querySelector(a));const I=this.write(u,g,v,w);a&&a.appendChild(I)}renderResult(a,u,g,v){const w=a.getMatrix();if(w===null)throw new _i;const I=w.getWidth(),O=w.getHeight(),F=I+v*2,q=O+v*2,te=Math.max(u,F),ue=Math.max(g,q),xe=Math.min(Math.floor(te/F),Math.floor(ue/q)),ze=Math.floor((te-I*xe)/2),ot=Math.floor((ue-O*xe)/2),ht=this.createSVGElement(te,ue);for(let Dt=0,qt=ot;Dt<O;Dt++,qt+=xe)for(let Sn=0,wn=ze;Sn<I;Sn++,wn+=xe)if(w.get(Sn,Dt)===1){const xn=this.createSvgRectElement(wn,qt,xe,xe);ht.appendChild(xn)}return ht}createSVGElement(a,u){const g=document.createElementNS(Ua.SVG_NS,"svg");return g.setAttributeNS(null,"height",a.toString()),g.setAttributeNS(null,"width",u.toString()),g}createSvgRectElement(a,u,g,v){const w=document.createElementNS(Ua.SVG_NS,"rect");return w.setAttributeNS(null,"x",a.toString()),w.setAttributeNS(null,"y",u.toString()),w.setAttributeNS(null,"height",g.toString()),w.setAttributeNS(null,"width",v.toString()),w.setAttributeNS(null,"fill","#000000"),w}}Ua.QUIET_ZONE_SIZE=4,Ua.SVG_NS="http://www.w3.org/2000/svg";class Sa{encode(a,u,g,v,w){if(a.length===0)throw new Q("Found empty contents");if(u!==Bt.QR_CODE)throw new Q("Can only encode QR_CODE, but got "+u);if(g<0||v<0)throw new Q(`Requested dimensions are too small: ${g}x${v}`);let I=Fi.L,O=Sa.QUIET_ZONE_SIZE;w!==null&&(w.get(wr.ERROR_CORRECTION)!==void 0&&(I=Fi.fromString(w.get(wr.ERROR_CORRECTION).toString())),w.get(wr.MARGIN)!==void 0&&(O=Number.parseInt(w.get(wr.MARGIN).toString(),10)));const F=gr.encode(a,I,w);return Sa.renderResult(F,g,v,O)}static renderResult(a,u,g,v){const w=a.getMatrix();if(w===null)throw new _i;const I=w.getWidth(),O=w.getHeight(),F=I+v*2,q=O+v*2,te=Math.max(u,F),ue=Math.max(g,q),xe=Math.min(Math.floor(te/F),Math.floor(ue/q)),ze=Math.floor((te-I*xe)/2),ot=Math.floor((ue-O*xe)/2),ht=new Zt(te,ue);for(let Dt=0,qt=ot;Dt<O;Dt++,qt+=xe)for(let Sn=0,wn=ze;Sn<I;Sn++,wn+=xe)w.get(Sn,Dt)===1&&ht.setRegion(wn,qt,xe,xe);return ht}}Sa.QUIET_ZONE_SIZE=4;class dc{encode(a,u,g,v,w){let I;if(u===Bt.QR_CODE)I=new Sa;else throw new Q("No encoder available for format "+u);return I.encode(a,u,g,v,w)}}class is extends wt{constructor(a,u,g,v,w,I,O,F){if(super(I,O),this.yuvData=a,this.dataWidth=u,this.dataHeight=g,this.left=v,this.top=w,v+I>u||w+O>g)throw new Q("Crop rectangle does not fit within image data.");F&&this.reverseHorizontal(I,O)}getRow(a,u){if(a<0||a>=this.getHeight())throw new Q("Requested row is outside the image: "+a);const g=this.getWidth();(u==null||u.length<g)&&(u=new Uint8ClampedArray(g));const v=(a+this.top)*this.dataWidth+this.left;return me.arraycopy(this.yuvData,v,u,0,g),u}getMatrix(){const a=this.getWidth(),u=this.getHeight();if(a===this.dataWidth&&u===this.dataHeight)return this.yuvData;const g=a*u,v=new Uint8ClampedArray(g);let w=this.top*this.dataWidth+this.left;if(a===this.dataWidth)return me.arraycopy(this.yuvData,w,v,0,g),v;for(let I=0;I<u;I++){const O=I*a;me.arraycopy(this.yuvData,w,v,O,a),w+=this.dataWidth}return v}isCropSupported(){return!0}crop(a,u,g,v){return new is(this.yuvData,this.dataWidth,this.dataHeight,this.left+a,this.top+u,g,v,!1)}renderThumbnail(){const a=this.getWidth()/is.THUMBNAIL_SCALE_FACTOR,u=this.getHeight()/is.THUMBNAIL_SCALE_FACTOR,g=new Int32Array(a*u),v=this.yuvData;let w=this.top*this.dataWidth+this.left;for(let I=0;I<u;I++){const O=I*a;for(let F=0;F<a;F++){const q=v[w+F*is.THUMBNAIL_SCALE_FACTOR]&255;g[O+F]=4278190080|q*65793}w+=this.dataWidth*is.THUMBNAIL_SCALE_FACTOR}return g}getThumbnailWidth(){return this.getWidth()/is.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/is.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(a,u){const g=this.yuvData;for(let v=0,w=this.top*this.dataWidth+this.left;v<u;v++,w+=this.dataWidth){const I=w+a/2;for(let O=w,F=w+a-1;O<I;O++,F--){const q=g[O];g[O]=g[F],g[F]=q}}}invert(){return new zt(this)}}is.THUMBNAIL_SCALE_FACTOR=2;class Co extends wt{constructor(a,u,g,v,w,I,O){if(super(u,g),this.dataWidth=v,this.dataHeight=w,this.left=I,this.top=O,a.BYTES_PER_ELEMENT===4){const F=u*g,q=new Uint8ClampedArray(F);for(let te=0;te<F;te++){const ue=a[te],xe=ue>>16&255,ze=ue>>7&510,ot=ue&255;q[te]=(xe+ze+ot)/4&255}this.luminances=q}else this.luminances=a;if(v===void 0&&(this.dataWidth=u),w===void 0&&(this.dataHeight=g),I===void 0&&(this.left=0),O===void 0&&(this.top=0),this.left+u>this.dataWidth||this.top+g>this.dataHeight)throw new Q("Crop rectangle does not fit within image data.")}getRow(a,u){if(a<0||a>=this.getHeight())throw new Q("Requested row is outside the image: "+a);const g=this.getWidth();(u==null||u.length<g)&&(u=new Uint8ClampedArray(g));const v=(a+this.top)*this.dataWidth+this.left;return me.arraycopy(this.luminances,v,u,0,g),u}getMatrix(){const a=this.getWidth(),u=this.getHeight();if(a===this.dataWidth&&u===this.dataHeight)return this.luminances;const g=a*u,v=new Uint8ClampedArray(g);let w=this.top*this.dataWidth+this.left;if(a===this.dataWidth)return me.arraycopy(this.luminances,w,v,0,g),v;for(let I=0;I<u;I++){const O=I*a;me.arraycopy(this.luminances,w,v,O,a),w+=this.dataWidth}return v}isCropSupported(){return!0}crop(a,u,g,v){return new Co(this.luminances,g,v,this.dataWidth,this.dataHeight,this.left+a,this.top+u)}invert(){return new zt(this)}}class Zo extends He{static forName(a){return this.getCharacterSetECIByName(a)}}class Kr{}Kr.ISO_8859_1=He.ISO8859_1;class Bl{isCompact(){return this.compact}setCompact(a){this.compact=a}getSize(){return this.size}setSize(a){this.size=a}getLayers(){return this.layers}setLayers(a){this.layers=a}getCodeWords(){return this.codeWords}setCodeWords(a){this.codeWords=a}getMatrix(){return this.matrix}setMatrix(a){this.matrix=a}}class Fl{static singletonList(a){return[a]}static min(a,u){return a.sort(u)[0]}}class fc{constructor(a){this.previous=a}getPrevious(){return this.previous}}class Oa extends fc{constructor(a,u,g){super(a),this.value=u,this.bitCount=g}appendTo(a,u){a.appendBits(this.value,this.bitCount)}add(a,u){return new Oa(this,a,u)}addBinaryShift(a,u){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Oa(this,a,u)}toString(){let a=this.value&(1<<this.bitCount)-1;return a|=1<<this.bitCount,"<"+Ye.toBinaryString(a|1<<this.bitCount).substring(1)+">"}}class _u extends Oa{constructor(a,u,g){super(a,0,0),this.binaryShiftStart=u,this.binaryShiftByteCount=g}appendTo(a,u){for(let g=0;g<this.binaryShiftByteCount;g++)(g===0||g===31&&this.binaryShiftByteCount<=62)&&(a.appendBits(31,5),this.binaryShiftByteCount>62?a.appendBits(this.binaryShiftByteCount-31,16):g===0?a.appendBits(Math.min(this.binaryShiftByteCount,31),5):a.appendBits(this.binaryShiftByteCount-31,5)),a.appendBits(u[this.binaryShiftStart+g],8)}addBinaryShift(a,u){return new _u(this,a,u)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Bc(le,a,u){return new _u(le,a,u)}function pc(le,a,u){return new Oa(le,a,u)}const ro=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],so=0,Fc=1,za=2,jc=3,La=4,jl=new Oa(null,0,0),hl=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function Xh(le){for(let a of le)tt.fill(a,-1);return le[so][La]=0,le[Fc][La]=0,le[Fc][so]=28,le[jc][La]=0,le[za][La]=0,le[za][so]=15,le}const gc=Xh(tt.createInt32Array(6,6));class $s{constructor(a,u,g,v){this.token=a,this.mode=u,this.binaryShiftByteCount=g,this.bitCount=v}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(a,u){let g=this.bitCount,v=this.token;if(a!==this.mode){let I=hl[this.mode][a];v=pc(v,I&65535,I>>16),g+=I>>16}let w=a===za?4:5;return v=pc(v,u,w),new $s(v,a,0,g+w)}shiftAndAppend(a,u){let g=this.token,v=this.mode===za?4:5;return g=pc(g,gc[this.mode][a],v),g=pc(g,u,5),new $s(g,this.mode,0,this.bitCount+v+5)}addBinaryShiftChar(a){let u=this.token,g=this.mode,v=this.bitCount;if(this.mode===La||this.mode===za){let O=hl[g][so];u=pc(u,O&65535,O>>16),v+=O>>16,g=so}let w=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,I=new $s(u,g,this.binaryShiftByteCount+1,v+w);return I.binaryShiftByteCount===2078&&(I=I.endBinaryShift(a+1)),I}endBinaryShift(a){if(this.binaryShiftByteCount===0)return this;let u=this.token;return u=Bc(u,a-this.binaryShiftByteCount,this.binaryShiftByteCount),new $s(u,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(a){let u=this.bitCount+(hl[this.mode][a.mode]>>16);return this.binaryShiftByteCount<a.binaryShiftByteCount?u+=$s.calculateBinaryShiftCost(a)-$s.calculateBinaryShiftCost(this):this.binaryShiftByteCount>a.binaryShiftByteCount&&a.binaryShiftByteCount>0&&(u+=10),u<=a.bitCount}toBitArray(a){let u=[];for(let v=this.endBinaryShift(a.length).token;v!==null;v=v.getPrevious())u.unshift(v);let g=new pt;for(const v of u)v.appendTo(g,a);return g}toString(){return ct.format("%s bits=%d bytes=%d",ro[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(a){return a.binaryShiftByteCount>62?21:a.binaryShiftByteCount>31?20:a.binaryShiftByteCount>0?10:0}}$s.INITIAL_STATE=new $s(jl,so,0,0);function rh(le){const a=ct.getCharCode(" "),u=ct.getCharCode("."),g=ct.getCharCode(",");le[so][a]=1;const v=ct.getCharCode("Z"),w=ct.getCharCode("A");for(let xe=w;xe<=v;xe++)le[so][xe]=xe-w+2;le[Fc][a]=1;const I=ct.getCharCode("z"),O=ct.getCharCode("a");for(let xe=O;xe<=I;xe++)le[Fc][xe]=xe-O+2;le[za][a]=1;const F=ct.getCharCode("9"),q=ct.getCharCode("0");for(let xe=q;xe<=F;xe++)le[za][xe]=xe-q+2;le[za][g]=12,le[za][u]=13;const te=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let xe=0;xe<te.length;xe++)le[jc][ct.getCharCode(te[xe])]=xe;const ue=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let xe=0;xe<ue.length;xe++)ct.getCharCode(ue[xe])>0&&(le[La][ct.getCharCode(ue[xe])]=xe);return le}const Ul=rh(tt.createInt32Array(5,256));class Va{constructor(a){this.text=a}encode(){const a=ct.getCharCode(" "),u=ct.getCharCode(`
`);let g=Fl.singletonList($s.INITIAL_STATE);for(let w=0;w<this.text.length;w++){let I,O=w+1<this.text.length?this.text[w+1]:0;switch(this.text[w]){case ct.getCharCode("\r"):I=O===u?2:0;break;case ct.getCharCode("."):I=O===a?3:0;break;case ct.getCharCode(","):I=O===a?4:0;break;case ct.getCharCode(":"):I=O===a?5:0;break;default:I=0}I>0?(g=Va.updateStateListForPair(g,w,I),w++):g=this.updateStateListForChar(g,w)}return Fl.min(g,(w,I)=>w.getBitCount()-I.getBitCount()).toBitArray(this.text)}updateStateListForChar(a,u){const g=[];for(let v of a)this.updateStateForChar(v,u,g);return Va.simplifyStates(g)}updateStateForChar(a,u,g){let v=this.text[u]&255,w=Ul[a.getMode()][v]>0,I=null;for(let O=0;O<=La;O++){let F=Ul[O][v];if(F>0){if(I==null&&(I=a.endBinaryShift(u)),!w||O===a.getMode()||O===za){const q=I.latchAndAppend(O,F);g.push(q)}if(!w&&gc[a.getMode()][O]>=0){const q=I.shiftAndAppend(O,F);g.push(q)}}}if(a.getBinaryShiftByteCount()>0||Ul[a.getMode()][v]===0){let O=a.addBinaryShiftChar(u);g.push(O)}}static updateStateListForPair(a,u,g){const v=[];for(let w of a)this.updateStateForPair(w,u,g,v);return this.simplifyStates(v)}static updateStateForPair(a,u,g,v){let w=a.endBinaryShift(u);if(v.push(w.latchAndAppend(La,g)),a.getMode()!==La&&v.push(w.shiftAndAppend(La,g)),g===3||g===4){let I=w.latchAndAppend(za,16-g).latchAndAppend(za,1);v.push(I)}if(a.getBinaryShiftByteCount()>0){let I=a.addBinaryShiftChar(u).addBinaryShiftChar(u+1);v.push(I)}}static simplifyStates(a){let u=[];for(const g of a){let v=!0;for(const w of u){if(w.isBetterThanOrEqualTo(g)){v=!1;break}g.isBetterThanOrEqualTo(w)&&(u=u.filter(I=>I!==w))}v&&u.push(g)}return u}}class sr{constructor(){}static encodeBytes(a){return sr.encode(a,sr.DEFAULT_EC_PERCENT,sr.DEFAULT_AZTEC_LAYERS)}static encode(a,u,g){let v=new Va(a).encode(),w=Ye.truncDivision(v.getSize()*u,100)+11,I=v.getSize()+w,O,F,q,te,ue;if(g!==sr.DEFAULT_AZTEC_LAYERS){if(O=g<0,F=Math.abs(g),F>(O?sr.MAX_NB_BITS_COMPACT:sr.MAX_NB_BITS))throw new Q(ct.format("Illegal value %s for layers",g));q=sr.totalBitsInLayer(F,O),te=sr.WORD_SIZE[F];let xn=q-q%te;if(ue=sr.stuffBits(v,te),ue.getSize()+w>xn)throw new Q("Data to large for user specified layer");if(O&&ue.getSize()>te*64)throw new Q("Data to large for user specified layer")}else{te=0,ue=null;for(let xn=0;;xn++){if(xn>sr.MAX_NB_BITS)throw new Q("Data too large for an Aztec code");if(O=xn<=3,F=O?xn+1:xn,q=sr.totalBitsInLayer(F,O),I>q)continue;(ue==null||te!==sr.WORD_SIZE[F])&&(te=sr.WORD_SIZE[F],ue=sr.stuffBits(v,te));let Yi=q-q%te;if(!(O&&ue.getSize()>te*64)&&ue.getSize()+w<=Yi)break}}let xe=sr.generateCheckWords(ue,q,te),ze=ue.getSize()/te,ot=sr.generateModeMessage(O,F,ze),ht=(O?11:14)+F*4,Dt=new Int32Array(ht),qt;if(O){qt=ht;for(let xn=0;xn<Dt.length;xn++)Dt[xn]=xn}else{qt=ht+1+2*Ye.truncDivision(Ye.truncDivision(ht,2)-1,15);let xn=Ye.truncDivision(ht,2),Yi=Ye.truncDivision(qt,2);for(let Wn=0;Wn<xn;Wn++){let rs=Wn+Ye.truncDivision(Wn,15);Dt[xn-Wn-1]=Yi-rs-1,Dt[xn+Wn]=Yi+rs+1}}let Sn=new Zt(qt);for(let xn=0,Yi=0;xn<F;xn++){let Wn=(F-xn)*4+(O?9:12);for(let rs=0;rs<Wn;rs++){let xa=rs*2;for(let Vs=0;Vs<2;Vs++)xe.get(Yi+xa+Vs)&&Sn.set(Dt[xn*2+Vs],Dt[xn*2+rs]),xe.get(Yi+Wn*2+xa+Vs)&&Sn.set(Dt[xn*2+rs],Dt[ht-1-xn*2-Vs]),xe.get(Yi+Wn*4+xa+Vs)&&Sn.set(Dt[ht-1-xn*2-Vs],Dt[ht-1-xn*2-rs]),xe.get(Yi+Wn*6+xa+Vs)&&Sn.set(Dt[ht-1-xn*2-rs],Dt[xn*2+Vs])}Yi+=Wn*8}if(sr.drawModeMessage(Sn,O,qt,ot),O)sr.drawBullsEye(Sn,Ye.truncDivision(qt,2),5);else{sr.drawBullsEye(Sn,Ye.truncDivision(qt,2),7);for(let xn=0,Yi=0;xn<Ye.truncDivision(ht,2)-1;xn+=15,Yi+=16)for(let Wn=Ye.truncDivision(qt,2)&1;Wn<qt;Wn+=2)Sn.set(Ye.truncDivision(qt,2)-Yi,Wn),Sn.set(Ye.truncDivision(qt,2)+Yi,Wn),Sn.set(Wn,Ye.truncDivision(qt,2)-Yi),Sn.set(Wn,Ye.truncDivision(qt,2)+Yi)}let wn=new Bl;return wn.setCompact(O),wn.setSize(qt),wn.setLayers(F),wn.setCodeWords(ze),wn.setMatrix(Sn),wn}static drawBullsEye(a,u,g){for(let v=0;v<g;v+=2)for(let w=u-v;w<=u+v;w++)a.set(w,u-v),a.set(w,u+v),a.set(u-v,w),a.set(u+v,w);a.set(u-g,u-g),a.set(u-g+1,u-g),a.set(u-g,u-g+1),a.set(u+g,u-g),a.set(u+g,u-g+1),a.set(u+g,u+g-1)}static generateModeMessage(a,u,g){let v=new pt;return a?(v.appendBits(u-1,2),v.appendBits(g-1,6),v=sr.generateCheckWords(v,28,4)):(v.appendBits(u-1,5),v.appendBits(g-1,11),v=sr.generateCheckWords(v,40,4)),v}static drawModeMessage(a,u,g,v){let w=Ye.truncDivision(g,2);if(u)for(let I=0;I<7;I++){let O=w-3+I;v.get(I)&&a.set(O,w-5),v.get(I+7)&&a.set(w+5,O),v.get(20-I)&&a.set(O,w+5),v.get(27-I)&&a.set(w-5,O)}else for(let I=0;I<10;I++){let O=w-5+I+Ye.truncDivision(I,5);v.get(I)&&a.set(O,w-7),v.get(I+10)&&a.set(w+7,O),v.get(29-I)&&a.set(O,w+7),v.get(39-I)&&a.set(w-7,O)}}static generateCheckWords(a,u,g){let v=a.getSize()/g,w=new Ra(sr.getGF(g)),I=Ye.truncDivision(u,g),O=sr.bitsToWords(a,g,I);w.encode(O,I-v);let F=u%g,q=new pt;q.appendBits(0,F);for(const te of Array.from(O))q.appendBits(te,g);return q}static bitsToWords(a,u,g){let v=new Int32Array(g),w,I;for(w=0,I=a.getSize()/u;w<I;w++){let O=0;for(let F=0;F<u;F++)O|=a.get(w*u+F)?1<<u-F-1:0;v[w]=O}return v}static getGF(a){switch(a){case 4:return kn.AZTEC_PARAM;case 6:return kn.AZTEC_DATA_6;case 8:return kn.AZTEC_DATA_8;case 10:return kn.AZTEC_DATA_10;case 12:return kn.AZTEC_DATA_12;default:throw new Q("Unsupported word size "+a)}}static stuffBits(a,u){let g=new pt,v=a.getSize(),w=(1<<u)-2;for(let I=0;I<v;I+=u){let O=0;for(let F=0;F<u;F++)(I+F>=v||a.get(I+F))&&(O|=1<<u-1-F);(O&w)===w?(g.appendBits(O&w,u),I--):(O&w)===0?(g.appendBits(O|1,u),I--):g.appendBits(O,u)}return g}static totalBitsInLayer(a,u){return((u?88:112)+16*a)*a}}sr.DEFAULT_EC_PERCENT=33,sr.DEFAULT_AZTEC_LAYERS=0,sr.MAX_NB_BITS=32,sr.MAX_NB_BITS_COMPACT=4,sr.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class dl{encode(a,u,g,v){return this.encodeWithHints(a,u,g,v,null)}encodeWithHints(a,u,g,v,w){let I=Kr.ISO_8859_1,O=sr.DEFAULT_EC_PERCENT,F=sr.DEFAULT_AZTEC_LAYERS;return w!=null&&(w.has(wr.CHARACTER_SET)&&(I=Zo.forName(w.get(wr.CHARACTER_SET).toString())),w.has(wr.ERROR_CORRECTION)&&(O=Ye.parseInt(w.get(wr.ERROR_CORRECTION).toString())),w.has(wr.AZTEC_LAYERS)&&(F=Ye.parseInt(w.get(wr.AZTEC_LAYERS).toString()))),dl.encodeLayers(a,u,g,v,I,O,F)}static encodeLayers(a,u,g,v,w,I,O){if(u!==Bt.AZTEC)throw new Q("Can only encode AZTEC, but got "+u);let F=sr.encode(ct.getBytes(a,w),I,O);return dl.renderResult(F,g,v)}static renderResult(a,u,g){let v=a.getMatrix();if(v==null)throw new _i;let w=v.getWidth(),I=v.getHeight(),O=Math.max(u,w),F=Math.max(g,I),q=Math.min(O/w,F/I),te=(O-w*q)/2,ue=(F-I*q)/2,xe=new Zt(O,F);for(let ze=0,ot=ue;ze<I;ze++,ot+=q)for(let ht=0,Dt=te;ht<w;ht++,Dt+=q)v.get(ht,ze)&&xe.setRegion(Dt,ot,q,q);return xe}}y.AbstractExpandedDecoder=Zi,y.ArgumentException=Y,y.ArithmeticException=si,y.AztecCode=Bl,y.AztecCodeReader=Je,y.AztecCodeWriter=dl,y.AztecDecoder=Gn,y.AztecDetector=je,y.AztecDetectorResult=Ki,y.AztecEncoder=sr,y.AztecHighLevelEncoder=Va,y.AztecPoint=pe,y.BarcodeFormat=Bt,y.Binarizer=ve,y.BinaryBitmap=_e,y.BitArray=pt,y.BitMatrix=Zt,y.BitSource=ci,y.BrowserAztecCodeReader=St,y.BrowserBarcodeReader=ii,y.BrowserCodeReader=Nt,y.BrowserDatamatrixCodeReader=hs,y.BrowserMultiFormatReader=qo,y.BrowserPDF417Reader=Rs,y.BrowserQRCodeReader=Cs,y.BrowserQRCodeSvgWriter=Ua,y.CharacterSetECI=He,y.ChecksumException=we,y.Code128Reader=de,y.Code39Reader=Ze,y.DataMatrixDecodedBitStreamParser=Tr,y.DataMatrixReader=Lr,y.DecodeHintType=Et,y.DecoderResult=sn,y.DefaultGridSampler=oe,y.DetectorResult=Li,y.EAN13Reader=ti,y.EncodeHintType=wr,y.Exception=H,y.FormatException=it,y.GenericGF=kn,y.GenericGFPoly=Dn,y.GlobalHistogramBinarizer=Te,y.GridSampler=xr,y.GridSamplerInstance=ce,y.HTMLCanvasElementLuminanceSource=Gt,y.HybridBinarizer=We,y.ITFReader=yt,y.IllegalArgumentException=Q,y.IllegalStateException=_i,y.InvertedLuminanceSource=zt,y.LuminanceSource=wt,y.MathUtils=In,y.MultiFormatOneDReader=Ri,y.MultiFormatReader=hc,y.MultiFormatWriter=dc,y.NotFoundException=Ne,y.OneDReader=rt,y.PDF417DecodedBitStreamParser=It,y.PDF417DecoderErrorCorrection=Ys,y.PDF417Reader=Hi,y.PDF417ResultMetadata=Eo,y.PerspectiveTransform=gt,y.PlanarYUVLuminanceSource=is,y.QRCodeByteMatrix=br,y.QRCodeDataMask=Ns,y.QRCodeDecodedBitStreamParser=fr,y.QRCodeDecoderErrorCorrectionLevel=Fi,y.QRCodeDecoderFormatInformation=$r,y.QRCodeEncoder=gr,y.QRCodeEncoderQRCode=Pa,y.QRCodeMaskUtil=pr,y.QRCodeMatrixUtil=wi,y.QRCodeMode=mi,y.QRCodeReader=er,y.QRCodeVersion=oi,y.QRCodeWriter=Sa,y.RGBLuminanceSource=Co,y.RSS14Reader=En,y.RSSExpandedReader=Ct,y.ReaderException=ya,y.ReedSolomonDecoder=Di,y.ReedSolomonEncoder=Ra,y.ReedSolomonException=ui,y.Result=_t,y.ResultMetadataType=an,y.ResultPoint=nn,y.StringUtils=ct,y.UnsupportedOperationException=xt,y.VideoInputDevice=ke,y.WhiteRectangleDetector=Pi,y.WriterException=Wi,y.ZXingArrays=tt,y.ZXingCharset=Zo,y.ZXingInteger=Ye,y.ZXingStandardCharsets=Kr,y.ZXingStringBuilder=vt,y.ZXingStringEncoding=Pe,y.ZXingSystem=me,y.createAbstractExpandedDecoder=ki,Object.defineProperty(y,"__esModule",{value:!0})}))})(Dg,Dg.exports)),Dg.exports}var Fs=J4();const eI=ap(Fs),tI=db({__proto__:null,default:eI},[Fs]);var Q_=(function(){function c(d,y,C){if(this.formatMap=new Map([[yi.QR_CODE,Fs.BarcodeFormat.QR_CODE],[yi.AZTEC,Fs.BarcodeFormat.AZTEC],[yi.CODABAR,Fs.BarcodeFormat.CODABAR],[yi.CODE_39,Fs.BarcodeFormat.CODE_39],[yi.CODE_93,Fs.BarcodeFormat.CODE_93],[yi.CODE_128,Fs.BarcodeFormat.CODE_128],[yi.DATA_MATRIX,Fs.BarcodeFormat.DATA_MATRIX],[yi.MAXICODE,Fs.BarcodeFormat.MAXICODE],[yi.ITF,Fs.BarcodeFormat.ITF],[yi.EAN_13,Fs.BarcodeFormat.EAN_13],[yi.EAN_8,Fs.BarcodeFormat.EAN_8],[yi.PDF_417,Fs.BarcodeFormat.PDF_417],[yi.RSS_14,Fs.BarcodeFormat.RSS_14],[yi.RSS_EXPANDED,Fs.BarcodeFormat.RSS_EXPANDED],[yi.UPC_A,Fs.BarcodeFormat.UPC_A],[yi.UPC_E,Fs.BarcodeFormat.UPC_E],[yi.UPC_EAN_EXTENSION,Fs.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!tI)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=y,this.logger=C;var D=this.createZXingFormats(d),P=new Map;P.set(Fs.DecodeHintType.POSSIBLE_FORMATS,D),P.set(Fs.DecodeHintType.TRY_HARDER,!1),this.hints=P}return c.prototype.decodeAsync=function(d){var y=this;return new Promise(function(C,D){try{C(y.decode(d))}catch(P){D(P)}})},c.prototype.decode=function(d){var y=new Fs.MultiFormatReader(this.verbose,this.hints),C=new Fs.HTMLCanvasElementLuminanceSource(d),D=new Fs.BinaryBitmap(new Fs.HybridBinarizer(C)),P=y.decode(D);return{text:P.text,format:P2.create(this.toHtml5QrcodeSupportedFormats(P.format)),debugData:this.createDebugData()}},c.prototype.createReverseFormatMap=function(){var d=new Map;return this.formatMap.forEach(function(y,C,D){d.set(y,C)}),d},c.prototype.toHtml5QrcodeSupportedFormats=function(d){if(!this.reverseFormatMap.has(d))throw"reverseFormatMap doesn't have ".concat(d);return this.reverseFormatMap.get(d)},c.prototype.createZXingFormats=function(d){for(var y=[],C=0,D=d;C<D.length;C++){var P=D[C];this.formatMap.has(P)?y.push(this.formatMap.get(P)):this.logger.logError("".concat(P," is not supported by")+"ZXingHtml5QrcodeShim")}return y},c.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},c})(),nI=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(Q){N(Q)}}function U(Y){try{H(C.throw(Y))}catch(Q){N(Q)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},iI=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},K_=(function(){function c(d,y,C){if(this.formatMap=new Map([[yi.QR_CODE,"qr_code"],[yi.AZTEC,"aztec"],[yi.CODABAR,"codabar"],[yi.CODE_39,"code_39"],[yi.CODE_93,"code_93"],[yi.CODE_128,"code_128"],[yi.DATA_MATRIX,"data_matrix"],[yi.ITF,"itf"],[yi.EAN_13,"ean_13"],[yi.EAN_8,"ean_8"],[yi.PDF_417,"pdf417"],[yi.UPC_A,"upc_a"],[yi.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!c.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=y,this.logger=C;var D=this.createBarcodeDetectorFormats(d);if(this.detector=new BarcodeDetector(D),!this.detector)throw"BarcodeDetector detector not supported"}return c.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var d=new BarcodeDetector({formats:["qr_code"]});return typeof d<"u"},c.prototype.decodeAsync=function(d){return nI(this,void 0,void 0,function(){var y,C;return iI(this,function(D){switch(D.label){case 0:return[4,this.detector.detect(d)];case 1:if(y=D.sent(),!y||y.length===0)throw"No barcode or QR code detected.";return C=this.selectLargestBarcode(y),[2,{text:C.rawValue,format:P2.create(this.toHtml5QrcodeSupportedFormats(C.format)),debugData:this.createDebugData()}]}})})},c.prototype.selectLargestBarcode=function(d){for(var y=null,C=0,D=0,P=d;D<P.length;D++){var N=P[D],h=N.boundingBox.width*N.boundingBox.height;h>C&&(C=h,y=N)}if(!y)throw"No largest barcode found";return y},c.prototype.createBarcodeDetectorFormats=function(d){for(var y=[],C=0,D=d;C<D.length;C++){var P=D[C];this.formatMap.has(P)?y.push(this.formatMap.get(P)):this.logger.warn("".concat(P," is not supported by")+"BarcodeDetectorDelegate")}return{formats:y}},c.prototype.toHtml5QrcodeSupportedFormats=function(d){if(!this.reverseFormatMap.has(d))throw"reverseFormatMap doesn't have ".concat(d);return this.reverseFormatMap.get(d)},c.prototype.createReverseFormatMap=function(){var d=new Map;return this.formatMap.forEach(function(y,C,D){d.set(y,C)}),d},c.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},c})(),J_=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(Q){N(Q)}}function U(Y){try{H(C.throw(Y))}catch(Q){N(Q)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},eb=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},rI=(function(){function c(d,y,C,D){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=C,y&&K_.isSupported()?(this.primaryDecoder=new K_(d,C,D),this.secondaryDecoder=new Q_(d,C,D)):this.primaryDecoder=new Q_(d,C,D)}return c.prototype.decodeAsync=function(d){return J_(this,void 0,void 0,function(){var y;return eb(this,function(C){switch(C.label){case 0:y=performance.now(),C.label=1;case 1:return C.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(d)];case 2:return[2,C.sent()];case 3:return this.possiblyLogPerformance(y),[7];case 4:return[2]}})})},c.prototype.decodeRobustlyAsync=function(d){return J_(this,void 0,void 0,function(){var y,C;return eb(this,function(D){switch(D.label){case 0:y=performance.now(),D.label=1;case 1:return D.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(d)];case 2:return[2,D.sent()];case 3:if(C=D.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(d)];throw C;case 4:return this.possiblyLogPerformance(y),[7];case 5:return[2]}})})},c.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},c.prototype.possiblyLogPerformance=function(d){if(this.verbose){var y=performance.now()-d;this.executionResults.push(y),this.executions++,this.possiblyFlushPerformanceReport()}},c.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var d=0,y=0,C=this.executionResults;y<C.length;y++){var D=C[y];d+=D}var P=d/this.executionResults.length;console.log("".concat(P," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},c})(),Mx=(function(){var c=function(d,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,D){C.__proto__=D}||function(C,D){for(var P in D)Object.prototype.hasOwnProperty.call(D,P)&&(C[P]=D[P])},c(d,y)};return function(d,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(d,y);function C(){this.constructor=d}d.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)}})(),d1=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(Q){N(Q)}}function U(Y){try{H(C.throw(Y))}catch(Q){N(Q)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},f1=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},z2=(function(){function c(d,y){this.name=d,this.track=y}return c.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},c.prototype.apply=function(d){var y={};y[this.name]=d;var C={advanced:[y]};return this.track.applyConstraints(C)},c.prototype.value=function(){var d=this.track.getSettings();if(this.name in d){var y=d[this.name];return y}return null},c})(),sI=(function(c){Mx(d,c);function d(y,C){return c.call(this,y,C)||this}return d.prototype.min=function(){return this.getCapabilities().min},d.prototype.max=function(){return this.getCapabilities().max},d.prototype.step=function(){return this.getCapabilities().step},d.prototype.apply=function(y){var C={};C[this.name]=y;var D={advanced:[C]};return this.track.applyConstraints(D)},d.prototype.getCapabilities=function(){this.failIfNotSupported();var y=this.track.getCapabilities(),C=y[this.name];return{min:C.min,max:C.max,step:C.step}},d.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},d})(z2),aI=(function(c){Mx(d,c);function d(y){return c.call(this,"zoom",y)||this}return d})(sI),oI=(function(c){Mx(d,c);function d(y){return c.call(this,"torch",y)||this}return d})(z2),lI=(function(){function c(d){this.track=d}return c.prototype.zoomFeature=function(){return new aI(this.track)},c.prototype.torchFeature=function(){return new oI(this.track)},c})(),cI=(function(){function c(d,y,C){this.isClosed=!1,this.parentElement=d,this.mediaStream=y,this.callbacks=C,this.surface=this.createVideoElement(this.parentElement.clientWidth),d.append(this.surface)}return c.prototype.createVideoElement=function(d){var y=document.createElement("video");return y.style.width="".concat(d,"px"),y.style.display="block",y.muted=!0,y.setAttribute("muted","true"),y.playsInline=!0,y},c.prototype.setupSurface=function(){var d=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var y=function(){var C=d.surface.clientWidth,D=d.surface.clientHeight;d.callbacks.onRenderSurfaceReady(C,D),d.surface.removeEventListener("playing",y)};this.surface.addEventListener("playing",y),this.surface.srcObject=this.mediaStream,this.surface.play()},c.create=function(d,y,C,D){return d1(this,void 0,void 0,function(){var P,N;return f1(this,function(h){switch(h.label){case 0:return P=new c(d,y,D),C.aspectRatio?(N={aspectRatio:C.aspectRatio},[4,P.getFirstTrackOrFail().applyConstraints(N)]):[3,2];case 1:h.sent(),h.label=2;case 2:return P.setupSurface(),[2,P]}})})},c.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},c.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},c.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},c.prototype.resume=function(d){this.failIfClosed();var y=this,C=function(){setTimeout(d,200),y.surface.removeEventListener("playing",C)};this.surface.addEventListener("playing",C),this.surface.play()},c.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},c.prototype.getSurface=function(){return this.failIfClosed(),this.surface},c.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},c.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},c.prototype.applyVideoConstraints=function(d){return d1(this,void 0,void 0,function(){return f1(this,function(y){if("aspectRatio"in d)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(d)]})})},c.prototype.close=function(){if(this.isClosed)return Promise.resolve();var d=this;return new Promise(function(y,C){var D=d.mediaStream.getVideoTracks(),P=D.length,N=0;d.mediaStream.getVideoTracks().forEach(function(h){d.mediaStream.removeTrack(h),h.stop(),++N,N>=P&&(d.isClosed=!0,d.parentElement.removeChild(d.surface),y())})})},c.prototype.getCapabilities=function(){return new lI(this.getFirstTrackOrFail())},c})(),uI=(function(){function c(d){this.mediaStream=d}return c.prototype.render=function(d,y,C){return d1(this,void 0,void 0,function(){return f1(this,function(D){return[2,cI.create(d,this.mediaStream,y,C)]})})},c.create=function(d){return d1(this,void 0,void 0,function(){var y,C;return f1(this,function(D){switch(D.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return y={audio:!1,video:d},[4,navigator.mediaDevices.getUserMedia(y)];case 1:return C=D.sent(),[2,new c(C)]}})})},c})(),tb=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(Q){N(Q)}}function U(Y){try{H(C.throw(Y))}catch(Q){N(Q)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},nb=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},hI=(function(){function c(){}return c.failIfNotSupported=function(){return tb(this,void 0,void 0,function(){return nb(this,function(d){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new c]})})},c.prototype.create=function(d){return tb(this,void 0,void 0,function(){return nb(this,function(y){return[2,uI.create(d)]})})},c})(),dI=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(Q){N(Q)}}function U(Y){try{H(C.throw(Y))}catch(Q){N(Q)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},fI=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},pI=(function(){function c(){}return c.retrieve=function(){if(navigator.mediaDevices)return c.getCamerasFromMediaDevices();var d=MediaStreamTrack;return MediaStreamTrack&&d.getSources?c.getCamerasFromMediaStreamTrack():c.rejectWithError()},c.rejectWithError=function(){var d=m0.unableToQuerySupportedDevices();return c.isHttpsOrLocalhost()||(d=m0.insecureContextCameraQueryError()),Promise.reject(d)},c.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var d=location.host.split(":")[0];return d==="127.0.0.1"||d==="localhost"},c.getCamerasFromMediaDevices=function(){return dI(this,void 0,void 0,function(){var d,y,C,D,P,N,h;return fI(this,function(U){switch(U.label){case 0:return d=function(H){for(var Y=H.getVideoTracks(),Q=0,_e=Y;Q<_e.length;Q++){var we=_e[Q];we.enabled=!1,we.stop(),H.removeTrack(we)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return y=U.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(C=U.sent(),D=[],P=0,N=C;P<N.length;P++)h=N[P],h.kind==="videoinput"&&D.push({id:h.deviceId,label:h.label});return d(y),[2,D]}})})},c.getCamerasFromMediaStreamTrack=function(){return new Promise(function(d,y){var C=function(P){for(var N=[],h=0,U=P;h<U.length;h++){var H=U[h];H.kind==="video"&&N.push({id:H.id,label:H.label})}d(N)},D=MediaStreamTrack;D.getSources(C)})},c})(),ga;(function(c){c[c.UNKNOWN=0]="UNKNOWN",c[c.NOT_STARTED=1]="NOT_STARTED",c[c.SCANNING=2]="SCANNING",c[c.PAUSED=3]="PAUSED"})(ga||(ga={}));var gI=(function(){function c(){this.state=ga.NOT_STARTED,this.onGoingTransactionNewState=ga.UNKNOWN}return c.prototype.directTransition=function(d){this.failIfTransitionOngoing(),this.validateTransition(d),this.state=d},c.prototype.startTransition=function(d){return this.failIfTransitionOngoing(),this.validateTransition(d),this.onGoingTransactionNewState=d,this},c.prototype.execute=function(){if(this.onGoingTransactionNewState===ga.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var d=this.onGoingTransactionNewState;this.onGoingTransactionNewState=ga.UNKNOWN,this.directTransition(d)},c.prototype.cancel=function(){if(this.onGoingTransactionNewState===ga.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=ga.UNKNOWN},c.prototype.getState=function(){return this.state},c.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==ga.UNKNOWN)throw"Cannot transition to a new state, already under transition"},c.prototype.validateTransition=function(d){switch(this.state){case ga.UNKNOWN:throw"Transition from unknown is not allowed";case ga.NOT_STARTED:this.failIfNewStateIs(d,[ga.PAUSED]);break;case ga.SCANNING:break;case ga.PAUSED:break}},c.prototype.failIfNewStateIs=function(d,y){for(var C=0,D=y;C<D.length;C++){var P=D[C];if(d===P)throw"Cannot transition from ".concat(this.state," to ").concat(d)}},c})(),mI=(function(){function c(d){this.stateManager=d}return c.prototype.startTransition=function(d){return this.stateManager.startTransition(d)},c.prototype.directTransition=function(d){this.stateManager.directTransition(d)},c.prototype.getState=function(){return this.stateManager.getState()},c.prototype.canScanFile=function(){return this.stateManager.getState()===ga.NOT_STARTED},c.prototype.isScanning=function(){return this.stateManager.getState()!==ga.NOT_STARTED},c.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===ga.SCANNING},c.prototype.isPaused=function(){return this.stateManager.getState()===ga.PAUSED},c})(),yI=(function(){function c(){}return c.create=function(){return new mI(new gI)},c})(),xI=(function(){var c=function(d,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,D){C.__proto__=D}||function(C,D){for(var P in D)Object.prototype.hasOwnProperty.call(D,P)&&(C[P]=D[P])},c(d,y)};return function(d,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(d,y);function C(){this.constructor=d}d.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)}})(),cc=(function(c){xI(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d.DEFAULT_WIDTH=300,d.DEFAULT_WIDTH_OFFSET=2,d.FILE_SCAN_MIN_HEIGHT=300,d.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,d.MIN_QR_BOX_SIZE=50,d.SHADED_LEFT=1,d.SHADED_RIGHT=2,d.SHADED_TOP=3,d.SHADED_BOTTOM=4,d.SHADED_REGION_ELEMENT_ID="qr-shaded-region",d.VERBOSE=!1,d.BORDER_SHADER_DEFAULT_COLOR="#ffffff",d.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",d})(Y4),_I=(function(){function c(d,y){this.logger=y,this.fps=cc.SCAN_DEFAULT_FPS,d?(d.fps&&(this.fps=d.fps),this.disableFlip=d.disableFlip===!0,this.qrbox=d.qrbox,this.aspectRatio=d.aspectRatio,this.videoConstraints=d.videoConstraints):this.disableFlip=cc.DEFAULT_DISABLE_FLIP}return c.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?O2.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},c.prototype.isShadedBoxEnabled=function(){return!Lh(this.qrbox)},c.create=function(d,y){return new c(d,y)},c})(),bI=(function(){function c(d,y){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(d))throw"HTML Element with id=".concat(d," not found");this.elementId=d,this.verbose=!1;var C;typeof y=="boolean"?this.verbose=y===!0:y&&(C=y,this.verbose=C.verbose===!0,C.experimentalFeatures),this.logger=new Q4(this.verbose),this.qrcode=new rI(this.getSupportedFormats(y),this.getUseBarCodeDetectorIfSupported(C),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=yI.create()}return c.prototype.start=function(d,y,C,D){var P=this;if(!d)throw"cameraIdOrConfig is required";if(!C||typeof C!="function")throw"qrCodeSuccessCallback is required and should be a function.";var N;D?N=D:N=this.verbose?this.logger.log:function(){};var h=_I.create(y,this.logger);this.clearElement();var U=!1;h.videoConstraints&&(h.isMediaStreamConstraintsValid()?U=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var H=U,Y=document.getElementById(this.elementId);Y.clientWidth?Y.clientWidth:cc.DEFAULT_WIDTH,Y.style.position="relative",this.shouldScan=!0,this.element=Y;var Q=this,_e=this.stateManagerProxy.startTransition(ga.SCANNING);return new Promise(function(we,ve){var me=H?h.videoConstraints:Q.createVideoConstraints(d);if(!me){_e.cancel(),ve("videoConstraints should be defined");return}var he={};(!H||h.aspectRatio)&&(he.aspectRatio=h.aspectRatio);var Re={onRenderSurfaceReady:function(tt,Ye){Q.setupUi(tt,Ye,h),Q.isScanning=!0,Q.foreverScan(h,C,N)}};hI.failIfNotSupported().then(function(tt){tt.create(me).then(function(Ye){return Ye.render(P.element,he,Re).then(function(pt){Q.renderedCamera=pt,_e.execute(),we(null)}).catch(function(pt){_e.cancel(),ve(pt)})}).catch(function(Ye){_e.cancel(),ve(m0.errorGettingUserMedia(Ye))})}).catch(function(tt){_e.cancel(),ve(m0.cameraStreamingNotSupported())})})},c.prototype.pause=function(d){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(ga.PAUSED),this.showPausedState(),(Lh(d)||d!==!0)&&(d=!1),d&&this.renderedCamera&&this.renderedCamera.pause()},c.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var d=this,y=function(){d.stateManagerProxy.directTransition(ga.SCANNING),d.hidePausedState()};if(!this.renderedCamera.isPaused()){y();return}this.renderedCamera.resume(function(){y()})},c.prototype.getState=function(){return this.stateManagerProxy.getState()},c.prototype.stop=function(){var d=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var y=this.stateManagerProxy.startTransition(ga.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var C=function(){if(d.element){var P=document.getElementById(cc.SHADED_REGION_ELEMENT_ID);P&&d.element.removeChild(P)}},D=this;return this.renderedCamera.close().then(function(){return D.renderedCamera=null,D.element&&(D.element.removeChild(D.canvasElement),D.canvasElement=null),C(),D.qrRegion&&(D.qrRegion=null),D.context&&(D.context=null),y.execute(),D.hidePausedState(),D.isScanning=!1,Promise.resolve()})},c.prototype.scanFile=function(d,y){return this.scanFileV2(d,y).then(function(C){return C.decodedText})},c.prototype.scanFileV2=function(d,y){var C=this;if(!d||!(d instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(Lh(y)&&(y=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(D,P){C.possiblyCloseLastScanImageFile(),C.clearElement(),C.lastScanImageFile=URL.createObjectURL(d);var N=new Image;N.onload=function(){var h=N.width,U=N.height,H=document.getElementById(C.elementId),Y=H.clientWidth?H.clientWidth:cc.DEFAULT_WIDTH,Q=Math.max(H.clientHeight?H.clientHeight:U,cc.FILE_SCAN_MIN_HEIGHT),_e=C.computeCanvasDrawConfig(h,U,Y,Q);if(y){var we=C.createCanvasElement(Y,Q,"qr-canvas-visible");we.style.display="inline-block",H.appendChild(we);var ve=we.getContext("2d");if(!ve)throw"Unable to get 2d context from canvas";ve.canvas.width=Y,ve.canvas.height=Q,ve.drawImage(N,0,0,h,U,_e.x,_e.y,_e.width,_e.height)}var me=cc.FILE_SCAN_HIDDEN_CANVAS_PADDING,he=Math.max(N.width,_e.width),Re=Math.max(N.height,_e.height),tt=he+2*me,Ye=Re+2*me,pt=C.createCanvasElement(tt,Ye);H.appendChild(pt);var Wt=pt.getContext("2d");if(!Wt)throw"Unable to get 2d context from canvas";Wt.canvas.width=tt,Wt.canvas.height=Ye,Wt.drawImage(N,0,0,h,U,me,me,he,Re);try{C.qrcode.decodeRobustlyAsync(pt).then(function(Et){D(Y_.createFromQrcodeResult(Et))}).catch(P)}catch(Et){P("QR code parse error, error = ".concat(Et))}},N.onerror=P,N.onabort=P,N.onstalled=P,N.onsuspend=P,N.src=URL.createObjectURL(d)})},c.prototype.clear=function(){this.clearElement()},c.getCameras=function(){return pI.retrieve()},c.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},c.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},c.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},c.prototype.applyVideoConstraints=function(d){if(d){if(!O2.isMediaStreamConstraintsValid(d,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(d)},c.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},c.prototype.getSupportedFormats=function(d){var y=[yi.QR_CODE,yi.AZTEC,yi.CODABAR,yi.CODE_39,yi.CODE_93,yi.CODE_128,yi.DATA_MATRIX,yi.MAXICODE,yi.ITF,yi.EAN_13,yi.EAN_8,yi.PDF_417,yi.RSS_14,yi.RSS_EXPANDED,yi.UPC_A,yi.UPC_E,yi.UPC_EAN_EXTENSION];if(!d||typeof d=="boolean"||!d.formatsToSupport)return y;if(!Array.isArray(d.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(d.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var C=[],D=0,P=d.formatsToSupport;D<P.length;D++){var N=P[D];W4(N)?C.push(N):this.logger.warn("Invalid format: ".concat(N," passed in config, ignoring."))}if(C.length===0)throw"None of formatsToSupport match supported values.";return C},c.prototype.getUseBarCodeDetectorIfSupported=function(d){if(Lh(d))return!0;if(!Lh(d.useBarCodeDetectorIfSupported))return d.useBarCodeDetectorIfSupported!==!1;if(Lh(d.experimentalFeatures))return!0;var y=d.experimentalFeatures;return Lh(y.useBarCodeDetectorIfSupported)?!0:y.useBarCodeDetectorIfSupported!==!1},c.prototype.validateQrboxSize=function(d,y,C){var D=this,P=C.qrbox;this.validateQrboxConfig(P);var N=this.toQrdimensions(d,y,P),h=function(H){if(H<cc.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(cc.MIN_QR_BOX_SIZE,"px.")},U=function(H){return H>d&&(D.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),H=d),H};h(N.width),h(N.height),N.width=U(N.width)},c.prototype.validateQrboxConfig=function(d){if(typeof d!="number"&&typeof d!="function"&&(d.width===void 0||d.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},c.prototype.toQrdimensions=function(d,y,C){if(typeof C=="number")return{width:C,height:C};if(typeof C=="function")try{return C(d,y)}catch(D){throw new Error("qrbox config was passed as a function but it failed with unknown error"+D)}return C},c.prototype.setupUi=function(d,y,C){C.isShadedBoxEnabled()&&this.validateQrboxSize(d,y,C);var D=Lh(C.qrbox)?{width:d,height:y}:C.qrbox;this.validateQrboxConfig(D);var P=this.toQrdimensions(d,y,D);P.height>y&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var N=C.isShadedBoxEnabled()&&P.height<=y,h={x:0,y:0,width:d,height:y},U=N?this.getShadedRegionBounds(d,y,P):h,H=this.createCanvasElement(U.width,U.height),Y={willReadFrequently:!0},Q=H.getContext("2d",Y);Q.canvas.width=U.width,Q.canvas.height=U.height,this.element.append(H),N&&this.possiblyInsertShadingElement(this.element,d,y,P),this.createScannerPausedUiElement(this.element),this.qrRegion=U,this.context=Q,this.canvasElement=H},c.prototype.createScannerPausedUiElement=function(d){var y=document.createElement("div");y.innerText=m0.scannerPaused(),y.style.display="none",y.style.position="absolute",y.style.top="0px",y.style.zIndex="1",y.style.background="rgba(9, 9, 9, 0.46)",y.style.color="#FFECEC",y.style.textAlign="center",y.style.width="100%",d.appendChild(y),this.scannerPausedUiElement=y},c.prototype.scanContext=function(d,y){var C=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(D){return d(D.text,Y_.createFromQrcodeResult(D)),C.possiblyUpdateShaders(!0),!0}).catch(function(D){C.possiblyUpdateShaders(!1);var P=m0.codeParseError(D);return y(P,$4.createFrom(P)),!1})},c.prototype.foreverScan=function(d,y,C){var D=this;if(this.shouldScan&&this.renderedCamera){var P=this.renderedCamera.getSurface(),N=P.videoWidth/P.clientWidth,h=P.videoHeight/P.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var U=this.qrRegion.width*N,H=this.qrRegion.height*h,Y=this.qrRegion.x*N,Q=this.qrRegion.y*h;this.context.drawImage(P,Y,Q,U,H,0,0,this.qrRegion.width,this.qrRegion.height);var _e=function(){D.foreverScanTimeout=setTimeout(function(){D.foreverScan(d,y,C)},D.getTimeoutFps(d.fps))};this.scanContext(y,C).then(function(we){!we&&d.disableFlip!==!0?(D.context.translate(D.context.canvas.width,0),D.context.scale(-1,1),D.scanContext(y,C).finally(function(){_e()})):_e()}).catch(function(we){D.logger.logError("Error happend while scanning context",we),_e()})}},c.prototype.createVideoConstraints=function(d){if(typeof d=="string")return{deviceId:{exact:d}};if(typeof d=="object"){var y="facingMode",C="deviceId",D={user:!0,environment:!0},P="exact",N=function(ve){if(ve in D)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(ve,"'")},h=Object.keys(d);if(h.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(h.length," keys");var U=Object.keys(d)[0];if(U!==y&&U!==C)throw"Only '".concat(y,"' and '").concat(C,"' ")+" are supported for 'cameraIdOrConfig'";if(U===y){var H=d.facingMode;if(typeof H=="string"){if(N(H))return{facingMode:H}}else if(typeof H=="object")if(P in H){if(N(H["".concat(P)]))return{facingMode:{exact:H["".concat(P)]}}}else throw"'facingMode' should be string or object with"+" ".concat(P," as key.");else{var Y=typeof H;throw"Invalid type of 'facingMode' = ".concat(Y)}}else{var Q=d.deviceId;if(typeof Q=="string")return{deviceId:Q};if(typeof Q=="object"){if(P in Q)return{deviceId:{exact:Q["".concat(P)]}};throw"'deviceId' should be string or object with"+" ".concat(P," as key.")}else{var _e=typeof Q;throw"Invalid type of 'deviceId' = ".concat(_e)}}}var we=typeof d;throw"Invalid type of 'cameraIdOrConfig' = ".concat(we)},c.prototype.computeCanvasDrawConfig=function(d,y,C,D){if(d<=C&&y<=D){var P=(C-d)/2,N=(D-y)/2;return{x:P,y:N,width:d,height:y}}else{var h=d,U=y;return d>C&&(y=C/d*y,d=C),y>D&&(d=D/y*d,y=D),this.logger.log("Image downsampled from "+"".concat(h,"X").concat(U)+" to ".concat(d,"X").concat(y,".")),this.computeCanvasDrawConfig(d,y,C,D)}},c.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var d=document.getElementById(this.elementId);d&&(d.innerHTML="")},c.prototype.possiblyUpdateShaders=function(d){this.qrMatch!==d&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(y){y.style.backgroundColor=d?cc.BORDER_SHADER_MATCH_COLOR:cc.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=d)},c.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},c.prototype.createCanvasElement=function(d,y,C){var D=d,P=y,N=document.createElement("canvas");return N.style.width="".concat(D,"px"),N.style.height="".concat(P,"px"),N.style.display="none",N.id=Lh(C)?"qr-canvas":C,N},c.prototype.getShadedRegionBounds=function(d,y,C){if(C.width>d||C.height>y)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(d-C.width)/2,y:(y-C.height)/2,width:C.width,height:C.height}},c.prototype.possiblyInsertShadingElement=function(d,y,C,D){if(!(y-D.width<1||C-D.height<1)){var P=document.createElement("div");P.style.position="absolute";var N=(y-D.width)/2,h=(C-D.height)/2;if(P.style.borderLeft="".concat(N,"px solid rgba(0, 0, 0, 0.48)"),P.style.borderRight="".concat(N,"px solid rgba(0, 0, 0, 0.48)"),P.style.borderTop="".concat(h,"px solid rgba(0, 0, 0, 0.48)"),P.style.borderBottom="".concat(h,"px solid rgba(0, 0, 0, 0.48)"),P.style.boxSizing="border-box",P.style.top="0px",P.style.bottom="0px",P.style.left="0px",P.style.right="0px",P.id="".concat(cc.SHADED_REGION_ELEMENT_ID),y-D.width<11||C-D.height<11)this.hasBorderShaders=!1;else{var U=5,H=40;this.insertShaderBorders(P,H,U,-U,null,0,!0),this.insertShaderBorders(P,H,U,-U,null,0,!1),this.insertShaderBorders(P,H,U,null,-U,0,!0),this.insertShaderBorders(P,H,U,null,-U,0,!1),this.insertShaderBorders(P,U,H+U,-U,null,-U,!0),this.insertShaderBorders(P,U,H+U,null,-U,-U,!0),this.insertShaderBorders(P,U,H+U,-U,null,-U,!1),this.insertShaderBorders(P,U,H+U,null,-U,-U,!1),this.hasBorderShaders=!0}d.append(P)}},c.prototype.insertShaderBorders=function(d,y,C,D,P,N,h){var U=document.createElement("div");U.style.position="absolute",U.style.backgroundColor=cc.BORDER_SHADER_DEFAULT_COLOR,U.style.width="".concat(y,"px"),U.style.height="".concat(C,"px"),D!==null&&(U.style.top="".concat(D,"px")),P!==null&&(U.style.bottom="".concat(P,"px")),h?U.style.left="".concat(N,"px"):U.style.right="".concat(N,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(U),d.appendChild(U)},c.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},c.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},c.prototype.getTimeoutFps=function(d){return 1e3/d},c})(),ib;(function(c){c[c.STATUS_DEFAULT=0]="STATUS_DEFAULT",c[c.STATUS_SUCCESS=1]="STATUS_SUCCESS",c[c.STATUS_WARNING=2]="STATUS_WARNING",c[c.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(ib||(ib={}));const vI=({onCancel:c,onScan:d,isProcessing:y=!1})=>{const C=ge.useRef(null),[D,P]=ge.useState(null),[N,h]=ge.useState(!0),U=ge.useRef(!1);ge.useEffect(()=>{let Y=!0;const _e=setTimeout(async()=>{try{const we=new bI("qr-reader-element",{verbose:!1});C.current=we,await we.start({facingMode:"environment"},{fps:10,qrbox:(ve,me)=>{const he=Math.min(ve,me),Re=Math.floor(he*.75);return{width:Re,height:Re}},aspectRatio:1},ve=>{U.current||(U.current=!0,we.stop().then(()=>{d(ve)}).catch(console.error))},()=>{}),Y&&h(!1)}catch(we){console.error("[QRScanPage] Camera error:",we),Y&&(P(we.message||"Failed to access camera"),h(!1))}},150);return()=>{Y=!1,clearTimeout(_e),C.current&&(C.current.stop().catch(()=>{}),C.current=null)}},[d]);const H=async()=>{if(C.current){try{await C.current.stop()}catch{}C.current=null}c()};return y?null:M.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black flex flex-col",children:[M.jsx("button",{onClick:H,className:"absolute top-6 right-6 p-3 rounded-full bg-white/10 text-white z-20",children:M.jsx(no,{size:24})}),M.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[N&&M.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:M.jsx("div",{className:"text-white/60 text-sm animate-pulse",children:"Starting camera..."})}),D?M.jsxs("div",{className:"p-6 bg-red-500/10 border border-red-500/30 rounded-2xl text-center",children:[M.jsx("div",{className:"text-red-400 font-bold mb-2",children:"Camera Error"}),M.jsx("div",{className:"text-red-300/80 text-sm mb-4",children:D}),M.jsx("button",{onClick:H,className:"px-4 py-2 bg-red-500 text-white rounded-lg font-bold",children:"Go Back"})]}):M.jsxs(M.Fragment,{children:[M.jsx("div",{id:"qr-reader-element",className:"w-full h-full"}),M.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[M.jsx("div",{className:"absolute top-0 left-0 right-0 h-[20%] bg-black/60"}),M.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[20%] bg-black/60"}),M.jsx("div",{className:"absolute top-[20%] left-0 w-[12.5%] h-[60%] bg-black/60"}),M.jsx("div",{className:"absolute top-[20%] right-0 w-[12.5%] h-[60%] bg-black/60"}),M.jsx("div",{className:"absolute top-[20%] left-[12.5%] right-[12.5%] h-[60%] border-2 border-white/50 rounded-2xl"})]})]})]}),M.jsxs("div",{className:"p-6 text-center shrink-0",children:[M.jsx("p",{className:"text-white/60 text-sm",children:"Point camera at a Parlens QR code"}),M.jsx("button",{onClick:async()=>{const Y=prompt("Enter QR code manually:");if(Y){if(U.current)return;if(U.current=!0,C.current){try{await C.current.stop()}catch{}C.current=null}d(Y)}},className:"mt-4 text-blue-400 text-sm font-bold",children:"Enter code manually"})]})]})},wI=()=>{const{login:c}=nh(),[d,y]=ge.useState(""),[C,D]=ge.useState(""),[P,N]=ge.useState(!1),[h,U]=ge.useState("landing"),[H,Y]=ge.useState(""),[Q,_e]=ge.useState(null),we=async Re=>{N(!0),D("");try{await c(Re,Re==="nsec"?d:void 0)}catch(tt){D(tt.message)}finally{N(!1)}},ve=()=>{U("setup")},me=async()=>{if(!H.trim()){D("Please enter a username");return}N(!0);try{const{generateSecretKey:Re,getPublicKey:tt}=await e1(async()=>{const{generateSecretKey:at,getPublicKey:He}=await Promise.resolve().then(()=>zy);return{generateSecretKey:at,getPublicKey:He}},void 0),Ye=at=>Array.from(at).map(He=>He.toString(16).padStart(2,"0")).join(""),pt=Re(),Wt=tt(pt);localStorage.setItem("parlens_privkey",Ye(pt)),localStorage.setItem("parlens_pubkey",Wt),localStorage.setItem("parlens_pending_username",H);const Et=Jf.npubEncode(Wt),it=Jf.nsecEncode(pt);_e({npub:Et,nsec:it}),U("backup")}catch(Re){D(Re.message)}finally{N(!1)}},he=async()=>{N(!0);try{const Re=localStorage.getItem("parlens_pending_username");await c("create",void 0,Re||H),localStorage.removeItem("parlens_pending_username")}catch(Re){D(Re.message)}finally{N(!1)}};return M.jsx("div",{className:"min-h-screen bg-zinc-50 dark:bg-black p-6 text-zinc-900 dark:text-white text-center overflow-y-auto no-scrollbar flex flex-col items-center justify-center transition-colors duration-300",style:{paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:M.jsxs("div",{className:"w-full max-w-sm space-y-12 animate-in fade-in zoom-in-95 duration-700",children:[M.jsxs("div",{className:"space-y-4",children:[M.jsx("img",{src:"/parlens-pwa/pwa-512x512.png",alt:"Parlens",className:"mx-auto h-24 w-24 rounded-[22%] shadow-2xl shadow-[#007AFF]/20"}),M.jsx("h1",{className:"text-5xl font-extrabold tracking-tighter text-zinc-900 dark:text-white",children:"Parlens"}),M.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-white/40 tracking-tight",children:"Decentralised Parking Management"})]}),M.jsxs("div",{className:"space-y-4",children:[h==="landing"?M.jsxs(M.Fragment,{children:[M.jsx("button",{onClick:ve,disabled:P,className:"w-full h-16 rounded-3xl bg-white dark:bg-white text-black font-bold text-lg shadow-xl shadow-black/5 dark:shadow-none active:scale-95 transition-all flex items-center justify-center gap-3 border border-black/5 dark:border-transparent",children:P?"Creating...":M.jsxs(M.Fragment,{children:[M.jsx(wT,{size:20,strokeWidth:3}),"Create a New Account"]})}),M.jsxs("button",{onClick:()=>U("nsec"),disabled:P,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold text-lg shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[M.jsx(Oy,{size:18}),"Login with Nostr Account"]})]}):h==="setup"?M.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-right-4",children:[M.jsxs("div",{className:"text-center pb-2",children:[M.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:"Pick a Username"}),M.jsx("p",{className:"text-zinc-500 dark:text-white/40 text-sm",children:"This will be your identity on Nostr"})]}),M.jsx("input",{type:"text",placeholder:"Username",value:H,onChange:Re=>Y(Re.target.value),className:"w-full h-16 rounded-3xl bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/10 px-6 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-zinc-400 dark:placeholder:text-white/20 shadow-sm dark:shadow-none",autoFocus:!0}),M.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 text-left leading-relaxed mt-2 pl-2",children:"Your username can be any combination of letters, numbers or special characters and doesnt have to be unique."}),M.jsxs("div",{className:"flex gap-3",children:[M.jsx("button",{onClick:()=>U("landing"),className:"h-16 px-6 rounded-3xl bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 font-bold shadow-sm dark:shadow-none",children:"Back"}),M.jsx("button",{onClick:me,disabled:P||!H,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:P?"Creating...":"Continue"})]})]}):h==="backup"?M.jsxs("div",{className:"space-y-6 pt-4 animate-in slide-in-from-right-4 text-left",children:[M.jsxs("div",{className:"text-center pb-2",children:[M.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:" Account Created!"}),M.jsx("p",{className:"text-zinc-500 dark:text-white/40 text-sm mt-1",children:"Backup your keys before continuing"})]}),M.jsxs("div",{className:"space-y-4",children:[M.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-white dark:bg-white/[0.03] border border-black/5 dark:border-white/10 shadow-sm dark:shadow-none",children:[M.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-black/5 dark:active:bg-white/10",onClick:()=>{Q&&(navigator.clipboard.writeText(Q.npub),alert("Copied to clipboard"))},children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400",children:M.jsx(Oy,{size:20})}),M.jsx("span",{className:"font-semibold text-sm text-zinc-900 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),M.jsx(ip,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),M.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),M.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-black/5 dark:active:bg-white/10",onClick:()=>{Q&&(navigator.clipboard.writeText(Q.nsec),alert("Copied to clipboard"))},children:[M.jsxs("div",{className:"flex items-center gap-3",children:[M.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-600 dark:text-red-500",children:M.jsx(o2,{size:20})}),M.jsx("span",{className:"font-semibold text-sm text-zinc-900 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),M.jsx(ip,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]}),M.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed text-left",children:"Your keys manage your identity on Nostr. Npub is your unique public identifier. It is used to link your data to your account. Nsec is the password that proves your ownership of the account. It validates and encrypts your data."})]}),M.jsxs("div",{className:"space-y-6 pt-6 border-t border-black/5 dark:border-white/10",children:[M.jsxs("div",{className:"space-y-2",children:[M.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"Getting Started"}),M.jsx("p",{className:"text-sm text-zinc-500 dark:text-white/60",children:"Follow these steps to get the most out of Parlens."})]}),M.jsxs("div",{className:"space-y-4 text-sm text-zinc-600 dark:text-white/60 leading-relaxed",children:[M.jsxs("div",{children:[M.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-4",children:"Parking Seekers"}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select Vehicle Type"}),"Use the vertical toggle to switch between Bicycle , Motorcycle , or Car . Your vehicle type determines what parking spots you see on the map."]}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Find Parking"}),"Click the blue search button to find parking around you or plan ahead by searching for parking near your destination. Click the search for parking bubble at the top of your screen to find parking near your destination and click the blue search button when you are nearby to refresh parking results in real-time."]}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Mark Your Spot"}),"Once you find a spot, click the amber parking location button to mark your parked location and start your session. Click the session active bubble to centre the map on your parking marker at any time during the session."]}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Log Your Session"}),"When youre ready to leave, click the green vehicle button to remove the marker, report the fees and log the session in your parking history."]}),M.jsxs("p",{children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Share Parking Reports (Optional)"}),"Anonymously report parking details to help other users know where to find parking. The opt-in switch for this feature is available in the parking areas section on the profile page. Once opted-in, you may opt-out at any time."]})]}),M.jsxs("div",{className:"mt-8 pt-4",children:[M.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-4",children:"Parking Service Providers"}),M.jsxs("p",{className:"mb-4",children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Listed Parking"}),"Users who oversee one or more parking spots can create a listing to simplify spot discovery and management. Click the parking services button () and select listed parking.",M.jsx("br",{}),M.jsx("br",{}),"Click the + button to create a listing and provide the details as requested in the form to create one or more online spots to match your real world location."]}),M.jsxs("p",{children:[M.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Valet Parking"}),"Users who park for others can enable valet mode to manage multiple parking sessions at the same time. Click the parking services button () and select valet parking to get started.",M.jsx("br",{}),M.jsx("br",{}),"Click the + button to create a new valet session. Ask your clients to scan the QR code using the Parlens app to see the parking location and let you know when theyre ready to leave."]})]}),M.jsxs("div",{className:"mt-6 pt-4 space-y-6",children:[M.jsxs("div",{children:[M.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-2",children:"User Privacy"}),M.jsx("p",{className:"mb-4",children:"Parlens does not collect or share any personal data. Parking history and saved routes are encrypted by your keys and only accessible by you. If you ever feel like your privacy is compromised, delete your account, abandon your keys and create a new account."})]}),M.jsxs("div",{children:[M.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-2",children:"License"}),M.jsx("p",{children:"This project is licensed under the GNU General Public License v3.0."})]})]})]})]}),M.jsx("button",{onClick:he,disabled:P,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:P?"Starting...":"Start Using Parlens"})]}):M.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-bottom-4",children:[M.jsx("input",{type:"password",placeholder:"Paste your nsec...",value:d,onChange:Re=>y(Re.target.value),className:"w-full h-16 rounded-3xl bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/10 px-6 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-zinc-400 dark:placeholder:text-white/20 shadow-sm dark:shadow-none",autoFocus:!0}),M.jsxs("div",{className:"flex gap-3",children:[M.jsx("button",{onClick:()=>U("landing"),className:"h-16 px-6 rounded-3xl bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 font-bold shadow-sm dark:shadow-none",children:"Back"}),M.jsx("button",{onClick:()=>we("nsec"),disabled:P||!d,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:P?"Decrypting...":"Login with Key"})]})]}),C&&M.jsx("div",{className:"p-4 rounded-3xl bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-2",children:C}),M.jsxs("div",{className:"space-y-3 pt-6 border-t border-black/5 dark:border-white/10",children:[M.jsx("h3",{className:"text-center font-bold text-zinc-500 dark:text-white/70 text-sm",children:"Add to your homescreen for fullscreen experience"}),M.jsxs("div",{className:"rounded-2xl bg-white dark:bg-white/5 overflow-hidden shadow-sm dark:shadow-none border border-black/5 dark:border-transparent",children:[M.jsxs("button",{onClick:()=>{document.getElementById("login-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[M.jsx("span",{children:"Using Browser Menu (Android)"}),M.jsx(Fd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),M.jsxs("div",{id:"login-android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/60 space-y-2 text-left",children:[M.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white/80",children:"Chrome & Brave:"}),M.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[M.jsx("li",{children:"Tap menu button (three dots)"}),M.jsxs("li",{children:["Tap ",M.jsx("strong",{children:"Add to Home screen"})]}),M.jsxs("li",{children:["Tap ",M.jsx("strong",{children:"Add"})," to confirm"]})]}),M.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white/80 mt-3",children:"Firefox:"}),M.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[M.jsx("li",{children:"Tap menu button (three dots)"}),M.jsxs("li",{children:["Tap ",M.jsx("strong",{children:"Install"})]})]})]})]}),M.jsxs("div",{className:"rounded-2xl bg-white dark:bg-white/5 overflow-hidden shadow-sm dark:shadow-none border border-black/5 dark:border-transparent",children:[M.jsxs("button",{onClick:()=>{document.getElementById("login-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[M.jsx("span",{children:"Using Share Button (iOS)"}),M.jsx(Fd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),M.jsx("div",{id:"login-ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/60 space-y-2 text-left",children:M.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[M.jsxs("li",{children:["Tap the ",M.jsx("strong",{className:"text-zinc-900 dark:text-white/80",children:"Share"})," button in Safari menu bar."]}),M.jsxs("li",{children:["Scroll down and tap ",M.jsx("strong",{className:"text-zinc-900 dark:text-white/80",children:"Add to Home Screen"}),"."]}),M.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]})]})]})})},AI=()=>{const{pubkey:c,refreshConnections:d}=nh(),[y,C]=ge.useState("home"),[D,P]=ge.useState(null),[N,h]=ge.useState(!1);return ta.useEffect(()=>{let U=0;const H=()=>{if(document.visibilityState==="hidden")U=Date.now(),console.log("[App] Backgrounded at",new Date().toISOString());else if(document.visibilityState==="visible"&&U>0){const Q=Date.now()-U;console.log("[App] Foregrounded after",Q,"ms"),Q>5e3&&(console.log("[App] Dispatching visibility-refresh event"),window.dispatchEvent(new Event("visibility-refresh")))}},Y=Q=>{Q.persisted&&(console.log("[App] Page restored from bfcache, triggering refresh"),window.dispatchEvent(new Event("visibility-refresh")))};return document.addEventListener("visibilitychange",H),window.addEventListener("pageshow",Y),()=>{document.removeEventListener("visibilitychange",H),window.removeEventListener("pageshow",Y)}},[]),c?N?M.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-colors duration-300 animate-in fade-in",children:M.jsxs("div",{className:"flex flex-col items-center gap-4",children:[M.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-green-500/20 border-t-green-500 animate-spin"}),M.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Verifying..."})]})}):y==="scan"?M.jsx(vI,{onCancel:()=>{d(),C("home")},onScan:async U=>{h(!0);try{await d()}catch(H){console.warn("Connection refresh failed, proceeding anyway:",H)}P(U),C("home"),h(!1)},isProcessing:N}):M.jsx(X4,{onRequestScan:()=>C("scan"),initialScannedCode:D,onScannedCodeConsumed:()=>P(null)}):M.jsx(wI,{})};var D1=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(c){return this.listeners.add(c),this.onSubscribe(),()=>{this.listeners.delete(c),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},EI={setTimeout:(c,d)=>setTimeout(c,d),clearTimeout:c=>clearTimeout(c),setInterval:(c,d)=>setInterval(c,d),clearInterval:c=>clearInterval(c)},SI=class{#e=EI;#t=!1;setTimeoutProvider(c){this.#e=c}setTimeout(c,d){return this.#e.setTimeout(c,d)}clearTimeout(c){this.#e.clearTimeout(c)}setInterval(c,d){return this.#e.setInterval(c,d)}clearInterval(c){this.#e.clearInterval(c)}},Uy=new SI;function CI(c){setTimeout(c,0)}var R1=typeof window>"u"||"Deno"in globalThis;function yu(){}function TI(c,d){return typeof c=="function"?c(d):c}function II(c){return typeof c=="number"&&c>=0&&c!==1/0}function MI(c,d){return Math.max(c+(d||0)-Date.now(),0)}function Vy(c,d){return typeof c=="function"?c(d):c}function kI(c,d){return typeof c=="function"?c(d):c}function rb(c,d){const{type:y="all",exact:C,fetchStatus:D,predicate:P,queryKey:N,stale:h}=c;if(N){if(C){if(d.queryHash!==kx(N,d.options))return!1}else if(!jg(d.queryKey,N))return!1}if(y!=="all"){const U=d.isActive();if(y==="active"&&!U||y==="inactive"&&U)return!1}return!(typeof h=="boolean"&&d.isStale()!==h||D&&D!==d.state.fetchStatus||P&&!P(d))}function sb(c,d){const{exact:y,status:C,predicate:D,mutationKey:P}=c;if(P){if(!d.options.mutationKey)return!1;if(y){if(Fg(d.options.mutationKey)!==Fg(P))return!1}else if(!jg(d.options.mutationKey,P))return!1}return!(C&&d.state.status!==C||D&&!D(d))}function kx(c,d){return(d?.queryKeyHashFn||Fg)(c)}function Fg(c){return JSON.stringify(c,(d,y)=>Gy(y)?Object.keys(y).sort().reduce((C,D)=>(C[D]=y[D],C),{}):y)}function jg(c,d){return c===d?!0:typeof c!=typeof d?!1:c&&d&&typeof c=="object"&&typeof d=="object"?Object.keys(d).every(y=>jg(c[y],d[y])):!1}var NI=Object.prototype.hasOwnProperty;function L2(c,d){if(c===d)return c;const y=ab(c)&&ab(d);if(!y&&!(Gy(c)&&Gy(d)))return d;const D=(y?c:Object.keys(c)).length,P=y?d:Object.keys(d),N=P.length,h=y?new Array(N):{};let U=0;for(let H=0;H<N;H++){const Y=y?H:P[H],Q=c[Y],_e=d[Y];if(Q===_e){h[Y]=Q,(y?H<D:NI.call(c,Y))&&U++;continue}if(Q===null||_e===null||typeof Q!="object"||typeof _e!="object"){h[Y]=_e;continue}const we=L2(Q,_e);h[Y]=we,we===Q&&U++}return D===N&&U===D?c:h}function ab(c){return Array.isArray(c)&&c.length===Object.keys(c).length}function Gy(c){if(!ob(c))return!1;const d=c.constructor;if(d===void 0)return!0;const y=d.prototype;return!(!ob(y)||!y.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(c)!==Object.prototype)}function ob(c){return Object.prototype.toString.call(c)==="[object Object]"}function DI(c){return new Promise(d=>{Uy.setTimeout(d,c)})}function RI(c,d,y){return typeof y.structuralSharing=="function"?y.structuralSharing(c,d):y.structuralSharing!==!1?L2(c,d):d}function PI(c,d,y=0){const C=[...c,d];return y&&C.length>y?C.slice(1):C}function OI(c,d,y=0){const C=[d,...c];return y&&C.length>y?C.slice(0,-1):C}var Nx=Symbol();function B2(c,d){return!c.queryFn&&d?.initialPromise?()=>d.initialPromise:!c.queryFn||c.queryFn===Nx?()=>Promise.reject(new Error(`Missing queryFn: '${c.queryHash}'`)):c.queryFn}var zI=class extends D1{#e;#t;#n;constructor(){super(),this.#n=c=>{if(!R1&&window.addEventListener){const d=()=>c();return window.addEventListener("visibilitychange",d,!1),()=>{window.removeEventListener("visibilitychange",d)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(c){this.#n=c,this.#t?.(),this.#t=c(d=>{typeof d=="boolean"?this.setFocused(d):this.onFocus()})}setFocused(c){this.#e!==c&&(this.#e=c,this.onFocus())}onFocus(){const c=this.isFocused();this.listeners.forEach(d=>{d(c)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},F2=new zI;function LI(){let c,d;const y=new Promise((D,P)=>{c=D,d=P});y.status="pending",y.catch(()=>{});function C(D){Object.assign(y,D),delete y.resolve,delete y.reject}return y.resolve=D=>{C({status:"fulfilled",value:D}),c(D)},y.reject=D=>{C({status:"rejected",reason:D}),d(D)},y}var BI=CI;function FI(){let c=[],d=0,y=h=>{h()},C=h=>{h()},D=BI;const P=h=>{d?c.push(h):D(()=>{y(h)})},N=()=>{const h=c;c=[],h.length&&D(()=>{C(()=>{h.forEach(U=>{y(U)})})})};return{batch:h=>{let U;d++;try{U=h()}finally{d--,d||N()}return U},batchCalls:h=>(...U)=>{P(()=>{h(...U)})},schedule:P,setNotifyFunction:h=>{y=h},setBatchNotifyFunction:h=>{C=h},setScheduler:h=>{D=h}}}var ll=FI(),jI=class extends D1{#e=!0;#t;#n;constructor(){super(),this.#n=c=>{if(!R1&&window.addEventListener){const d=()=>c(!0),y=()=>c(!1);return window.addEventListener("online",d,!1),window.addEventListener("offline",y,!1),()=>{window.removeEventListener("online",d),window.removeEventListener("offline",y)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(c){this.#n=c,this.#t?.(),this.#t=c(this.setOnline.bind(this))}setOnline(c){this.#e!==c&&(this.#e=c,this.listeners.forEach(y=>{y(c)}))}isOnline(){return this.#e}},p1=new jI;function UI(c){return Math.min(1e3*2**c,3e4)}function j2(c){return(c??"online")==="online"?p1.isOnline():!0}var Hy=class extends Error{constructor(c){super("CancelledError"),this.revert=c?.revert,this.silent=c?.silent}};function U2(c){let d=!1,y=0,C;const D=LI(),P=()=>D.status!=="pending",N=me=>{if(!P()){const he=new Hy(me);_e(he),c.onCancel?.(he)}},h=()=>{d=!0},U=()=>{d=!1},H=()=>F2.isFocused()&&(c.networkMode==="always"||p1.isOnline())&&c.canRun(),Y=()=>j2(c.networkMode)&&c.canRun(),Q=me=>{P()||(C?.(),D.resolve(me))},_e=me=>{P()||(C?.(),D.reject(me))},we=()=>new Promise(me=>{C=he=>{(P()||H())&&me(he)},c.onPause?.()}).then(()=>{C=void 0,P()||c.onContinue?.()}),ve=()=>{if(P())return;let me;const he=y===0?c.initialPromise:void 0;try{me=he??c.fn()}catch(Re){me=Promise.reject(Re)}Promise.resolve(me).then(Q).catch(Re=>{if(P())return;const tt=c.retry??(R1?0:3),Ye=c.retryDelay??UI,pt=typeof Ye=="function"?Ye(y,Re):Ye,Wt=tt===!0||typeof tt=="number"&&y<tt||typeof tt=="function"&&tt(y,Re);if(d||!Wt){_e(Re);return}y++,c.onFail?.(y,Re),DI(pt).then(()=>H()?void 0:we()).then(()=>{d?_e(Re):ve()})})};return{promise:D,status:()=>D.status,cancel:N,continue:()=>(C?.(),D),cancelRetry:h,continueRetry:U,canStart:Y,start:()=>(Y()?ve():we().then(ve),D)}}var V2=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),II(this.gcTime)&&(this.#e=Uy.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(c){this.gcTime=Math.max(this.gcTime||0,c??(R1?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Uy.clearTimeout(this.#e),this.#e=void 0)}},VI=class extends V2{#e;#t;#n;#r;#i;#a;#o;constructor(c){super(),this.#o=!1,this.#a=c.defaultOptions,this.setOptions(c.options),this.observers=[],this.#r=c.client,this.#n=this.#r.getQueryCache(),this.queryKey=c.queryKey,this.queryHash=c.queryHash,this.#e=cb(this.options),this.state=c.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(c){if(this.options={...this.#a,...c},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const d=cb(this.options);d.data!==void 0&&(this.setState(lb(d.data,d.dataUpdatedAt)),this.#e=d)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(c,d){const y=RI(this.state.data,c,this.options);return this.#s({data:y,type:"success",dataUpdatedAt:d?.updatedAt,manual:d?.manual}),y}setState(c,d){this.#s({type:"setState",state:c,setStateOptions:d})}cancel(c){const d=this.#i?.promise;return this.#i?.cancel(c),d?d.then(yu).catch(yu):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(c=>kI(c.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Nx||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(c=>Vy(c.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(c=>c.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(c=0){return this.state.data===void 0?!0:c==="static"?!1:this.state.isInvalidated?!0:!MI(this.state.dataUpdatedAt,c)}onFocus(){this.observers.find(d=>d.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(d=>d.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(c){this.observers.includes(c)||(this.observers.push(c),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:c}))}removeObserver(c){this.observers.includes(c)&&(this.observers=this.observers.filter(d=>d!==c),this.observers.length||(this.#i&&(this.#o?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:c}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(c,d){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&d?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(c&&this.setOptions(c),!this.options.queryFn){const h=this.observers.find(U=>U.options.queryFn);h&&this.setOptions(h.options)}const y=new AbortController,C=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,y.signal)})},D=()=>{const h=B2(this.options,d),H=(()=>{const Y={client:this.#r,queryKey:this.queryKey,meta:this.meta};return C(Y),Y})();return this.#o=!1,this.options.persister?this.options.persister(h,H,this):h(H)},N=(()=>{const h={fetchOptions:d,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:D};return C(h),h})();this.options.behavior?.onFetch(N,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==N.fetchOptions?.meta)&&this.#s({type:"fetch",meta:N.fetchOptions?.meta}),this.#i=U2({initialPromise:d?.initialPromise,fn:N.fetchFn,onCancel:h=>{h instanceof Hy&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),y.abort()},onFail:(h,U)=>{this.#s({type:"failed",failureCount:h,error:U})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:N.options.retry,retryDelay:N.options.retryDelay,networkMode:N.options.networkMode,canRun:()=>!0});try{const h=await this.#i.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof Hy){if(h.silent)return this.#i.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#s({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#s(c){const d=y=>{switch(c.type){case"failed":return{...y,fetchFailureCount:c.failureCount,fetchFailureReason:c.error};case"pause":return{...y,fetchStatus:"paused"};case"continue":return{...y,fetchStatus:"fetching"};case"fetch":return{...y,...GI(y.data,this.options),fetchMeta:c.meta??null};case"success":const C={...y,...lb(c.data,c.dataUpdatedAt),dataUpdateCount:y.dataUpdateCount+1,...!c.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=c.manual?C:void 0,C;case"error":const D=c.error;return{...y,error:D,errorUpdateCount:y.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:y.fetchFailureCount+1,fetchFailureReason:D,fetchStatus:"idle",status:"error"};case"invalidate":return{...y,isInvalidated:!0};case"setState":return{...y,...c.state}}};this.state=d(this.state),ll.batch(()=>{this.observers.forEach(y=>{y.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:c})})}};function GI(c,d){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:j2(d.networkMode)?"fetching":"paused",...c===void 0&&{error:null,status:"pending"}}}function lb(c,d){return{data:c,dataUpdatedAt:d??Date.now(),error:null,isInvalidated:!1,status:"success"}}function cb(c){const d=typeof c.initialData=="function"?c.initialData():c.initialData,y=d!==void 0,C=y?typeof c.initialDataUpdatedAt=="function"?c.initialDataUpdatedAt():c.initialDataUpdatedAt:0;return{data:d,dataUpdateCount:0,dataUpdatedAt:y?C??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:y?"success":"pending",fetchStatus:"idle"}}function ub(c){return{onFetch:(d,y)=>{const C=d.options,D=d.fetchOptions?.meta?.fetchMore?.direction,P=d.state.data?.pages||[],N=d.state.data?.pageParams||[];let h={pages:[],pageParams:[]},U=0;const H=async()=>{let Y=!1;const Q=ve=>{Object.defineProperty(ve,"signal",{enumerable:!0,get:()=>(d.signal.aborted?Y=!0:d.signal.addEventListener("abort",()=>{Y=!0}),d.signal)})},_e=B2(d.options,d.fetchOptions),we=async(ve,me,he)=>{if(Y)return Promise.reject();if(me==null&&ve.pages.length)return Promise.resolve(ve);const tt=(()=>{const Et={client:d.client,queryKey:d.queryKey,pageParam:me,direction:he?"backward":"forward",meta:d.options.meta};return Q(Et),Et})(),Ye=await _e(tt),{maxPages:pt}=d.options,Wt=he?OI:PI;return{pages:Wt(ve.pages,Ye,pt),pageParams:Wt(ve.pageParams,me,pt)}};if(D&&P.length){const ve=D==="backward",me=ve?HI:hb,he={pages:P,pageParams:N},Re=me(C,he);h=await we(he,Re,ve)}else{const ve=c??P.length;do{const me=U===0?N[0]??C.initialPageParam:hb(C,h);if(U>0&&me==null)break;h=await we(h,me),U++}while(U<ve)}return h};d.options.persister?d.fetchFn=()=>d.options.persister?.(H,{client:d.client,queryKey:d.queryKey,meta:d.options.meta,signal:d.signal},y):d.fetchFn=H}}}function hb(c,{pages:d,pageParams:y}){const C=d.length-1;return d.length>0?c.getNextPageParam(d[C],d,y[C],y):void 0}function HI(c,{pages:d,pageParams:y}){return d.length>0?c.getPreviousPageParam?.(d[0],d,y[0],y):void 0}var qI=class extends V2{#e;#t;#n;#r;constructor(c){super(),this.#e=c.client,this.mutationId=c.mutationId,this.#n=c.mutationCache,this.#t=[],this.state=c.state||ZI(),this.setOptions(c.options),this.scheduleGc()}setOptions(c){this.options=c,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(c){this.#t.includes(c)||(this.#t.push(c),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:c}))}removeObserver(c){this.#t=this.#t.filter(d=>d!==c),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:c})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(c){const d=()=>{this.#i({type:"continue"})},y={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=U2({fn:()=>this.options.mutationFn?this.options.mutationFn(c,y):Promise.reject(new Error("No mutationFn found")),onFail:(P,N)=>{this.#i({type:"failed",failureCount:P,error:N})},onPause:()=>{this.#i({type:"pause"})},onContinue:d,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const C=this.state.status==="pending",D=!this.#r.canStart();try{if(C)d();else{this.#i({type:"pending",variables:c,isPaused:D}),await this.#n.config.onMutate?.(c,this,y);const N=await this.options.onMutate?.(c,y);N!==this.state.context&&this.#i({type:"pending",context:N,variables:c,isPaused:D})}const P=await this.#r.start();return await this.#n.config.onSuccess?.(P,c,this.state.context,this,y),await this.options.onSuccess?.(P,c,this.state.context,y),await this.#n.config.onSettled?.(P,null,this.state.variables,this.state.context,this,y),await this.options.onSettled?.(P,null,c,this.state.context,y),this.#i({type:"success",data:P}),P}catch(P){try{throw await this.#n.config.onError?.(P,c,this.state.context,this,y),await this.options.onError?.(P,c,this.state.context,y),await this.#n.config.onSettled?.(void 0,P,this.state.variables,this.state.context,this,y),await this.options.onSettled?.(void 0,P,c,this.state.context,y),P}finally{this.#i({type:"error",error:P})}}finally{this.#n.runNext(this)}}#i(c){const d=y=>{switch(c.type){case"failed":return{...y,failureCount:c.failureCount,failureReason:c.error};case"pause":return{...y,isPaused:!0};case"continue":return{...y,isPaused:!1};case"pending":return{...y,context:c.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:c.isPaused,status:"pending",variables:c.variables,submittedAt:Date.now()};case"success":return{...y,data:c.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...y,data:void 0,error:c.error,failureCount:y.failureCount+1,failureReason:c.error,isPaused:!1,status:"error"}}};this.state=d(this.state),ll.batch(()=>{this.#t.forEach(y=>{y.onMutationUpdate(c)}),this.#n.notify({mutation:this,type:"updated",action:c})})}};function ZI(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var XI=class extends D1{constructor(c={}){super(),this.config=c,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(c,d,y){const C=new qI({client:c,mutationCache:this,mutationId:++this.#n,options:c.defaultMutationOptions(d),state:y});return this.add(C),C}add(c){this.#e.add(c);const d=Ym(c);if(typeof d=="string"){const y=this.#t.get(d);y?y.push(c):this.#t.set(d,[c])}this.notify({type:"added",mutation:c})}remove(c){if(this.#e.delete(c)){const d=Ym(c);if(typeof d=="string"){const y=this.#t.get(d);if(y)if(y.length>1){const C=y.indexOf(c);C!==-1&&y.splice(C,1)}else y[0]===c&&this.#t.delete(d)}}this.notify({type:"removed",mutation:c})}canRun(c){const d=Ym(c);if(typeof d=="string"){const C=this.#t.get(d)?.find(D=>D.state.status==="pending");return!C||C===c}else return!0}runNext(c){const d=Ym(c);return typeof d=="string"?this.#t.get(d)?.find(C=>C!==c&&C.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ll.batch(()=>{this.#e.forEach(c=>{this.notify({type:"removed",mutation:c})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(c){const d={exact:!0,...c};return this.getAll().find(y=>sb(d,y))}findAll(c={}){return this.getAll().filter(d=>sb(c,d))}notify(c){ll.batch(()=>{this.listeners.forEach(d=>{d(c)})})}resumePausedMutations(){const c=this.getAll().filter(d=>d.state.isPaused);return ll.batch(()=>Promise.all(c.map(d=>d.continue().catch(yu))))}};function Ym(c){return c.options.scope?.id}var WI=class extends D1{constructor(c={}){super(),this.config=c,this.#e=new Map}#e;build(c,d,y){const C=d.queryKey,D=d.queryHash??kx(C,d);let P=this.get(D);return P||(P=new VI({client:c,queryKey:C,queryHash:D,options:c.defaultQueryOptions(d),state:y,defaultOptions:c.getQueryDefaults(C)}),this.add(P)),P}add(c){this.#e.has(c.queryHash)||(this.#e.set(c.queryHash,c),this.notify({type:"added",query:c}))}remove(c){const d=this.#e.get(c.queryHash);d&&(c.destroy(),d===c&&this.#e.delete(c.queryHash),this.notify({type:"removed",query:c}))}clear(){ll.batch(()=>{this.getAll().forEach(c=>{this.remove(c)})})}get(c){return this.#e.get(c)}getAll(){return[...this.#e.values()]}find(c){const d={exact:!0,...c};return this.getAll().find(y=>rb(d,y))}findAll(c={}){const d=this.getAll();return Object.keys(c).length>0?d.filter(y=>rb(c,y)):d}notify(c){ll.batch(()=>{this.listeners.forEach(d=>{d(c)})})}onFocus(){ll.batch(()=>{this.getAll().forEach(c=>{c.onFocus()})})}onOnline(){ll.batch(()=>{this.getAll().forEach(c=>{c.onOnline()})})}},YI=class{#e;#t;#n;#r;#i;#a;#o;#s;constructor(c={}){this.#e=c.queryCache||new WI,this.#t=c.mutationCache||new XI,this.#n=c.defaultOptions||{},this.#r=new Map,this.#i=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=F2.subscribe(async c=>{c&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=p1.subscribe(async c=>{c&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#s?.(),this.#s=void 0)}isFetching(c){return this.#e.findAll({...c,fetchStatus:"fetching"}).length}isMutating(c){return this.#t.findAll({...c,status:"pending"}).length}getQueryData(c){const d=this.defaultQueryOptions({queryKey:c});return this.#e.get(d.queryHash)?.state.data}ensureQueryData(c){const d=this.defaultQueryOptions(c),y=this.#e.build(this,d),C=y.state.data;return C===void 0?this.fetchQuery(c):(c.revalidateIfStale&&y.isStaleByTime(Vy(d.staleTime,y))&&this.prefetchQuery(d),Promise.resolve(C))}getQueriesData(c){return this.#e.findAll(c).map(({queryKey:d,state:y})=>{const C=y.data;return[d,C]})}setQueryData(c,d,y){const C=this.defaultQueryOptions({queryKey:c}),P=this.#e.get(C.queryHash)?.state.data,N=TI(d,P);if(N!==void 0)return this.#e.build(this,C).setData(N,{...y,manual:!0})}setQueriesData(c,d,y){return ll.batch(()=>this.#e.findAll(c).map(({queryKey:C})=>[C,this.setQueryData(C,d,y)]))}getQueryState(c){const d=this.defaultQueryOptions({queryKey:c});return this.#e.get(d.queryHash)?.state}removeQueries(c){const d=this.#e;ll.batch(()=>{d.findAll(c).forEach(y=>{d.remove(y)})})}resetQueries(c,d){const y=this.#e;return ll.batch(()=>(y.findAll(c).forEach(C=>{C.reset()}),this.refetchQueries({type:"active",...c},d)))}cancelQueries(c,d={}){const y={revert:!0,...d},C=ll.batch(()=>this.#e.findAll(c).map(D=>D.cancel(y)));return Promise.all(C).then(yu).catch(yu)}invalidateQueries(c,d={}){return ll.batch(()=>(this.#e.findAll(c).forEach(y=>{y.invalidate()}),c?.refetchType==="none"?Promise.resolve():this.refetchQueries({...c,type:c?.refetchType??c?.type??"active"},d)))}refetchQueries(c,d={}){const y={...d,cancelRefetch:d.cancelRefetch??!0},C=ll.batch(()=>this.#e.findAll(c).filter(D=>!D.isDisabled()&&!D.isStatic()).map(D=>{let P=D.fetch(void 0,y);return y.throwOnError||(P=P.catch(yu)),D.state.fetchStatus==="paused"?Promise.resolve():P}));return Promise.all(C).then(yu)}fetchQuery(c){const d=this.defaultQueryOptions(c);d.retry===void 0&&(d.retry=!1);const y=this.#e.build(this,d);return y.isStaleByTime(Vy(d.staleTime,y))?y.fetch(d):Promise.resolve(y.state.data)}prefetchQuery(c){return this.fetchQuery(c).then(yu).catch(yu)}fetchInfiniteQuery(c){return c.behavior=ub(c.pages),this.fetchQuery(c)}prefetchInfiniteQuery(c){return this.fetchInfiniteQuery(c).then(yu).catch(yu)}ensureInfiniteQueryData(c){return c.behavior=ub(c.pages),this.ensureQueryData(c)}resumePausedMutations(){return p1.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(c){this.#n=c}setQueryDefaults(c,d){this.#r.set(Fg(c),{queryKey:c,defaultOptions:d})}getQueryDefaults(c){const d=[...this.#r.values()],y={};return d.forEach(C=>{jg(c,C.queryKey)&&Object.assign(y,C.defaultOptions)}),y}setMutationDefaults(c,d){this.#i.set(Fg(c),{mutationKey:c,defaultOptions:d})}getMutationDefaults(c){const d=[...this.#i.values()],y={};return d.forEach(C=>{jg(c,C.mutationKey)&&Object.assign(y,C.defaultOptions)}),y}defaultQueryOptions(c){if(c._defaulted)return c;const d={...this.#n.queries,...this.getQueryDefaults(c.queryKey),...c,_defaulted:!0};return d.queryHash||(d.queryHash=kx(d.queryKey,d)),d.refetchOnReconnect===void 0&&(d.refetchOnReconnect=d.networkMode!=="always"),d.throwOnError===void 0&&(d.throwOnError=!!d.suspense),!d.networkMode&&d.persister&&(d.networkMode="offlineFirst"),d.queryFn===Nx&&(d.enabled=!1),d}defaultMutationOptions(c){return c?._defaulted?c:{...this.#n.mutations,...c?.mutationKey&&this.getMutationDefaults(c.mutationKey),...c,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},$I=ge.createContext(void 0),QI=({client:c,children:d})=>(ge.useEffect(()=>(c.mount(),()=>{c.unmount()}),[c]),M.jsx($I.Provider,{value:c,children:d}));const KI=new YI;dw.createRoot(document.getElementById("root")).render(M.jsx(ta.StrictMode,{children:M.jsx(QI,{client:KI,children:M.jsx(y3,{children:M.jsx(AI,{})})})}));
