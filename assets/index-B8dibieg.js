function A1(h,m){for(var b=0;b<m.length;b++){const S=m[b];if(typeof S!="string"&&!Array.isArray(S)){for(const z in S)if(z!=="default"&&!(z in h)){const k=Object.getOwnPropertyDescriptor(S,z);k&&Object.defineProperty(h,z,k.get?k:{enumerable:!0,get:()=>S[z]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const z of document.querySelectorAll('link[rel="modulepreload"]'))S(z);new MutationObserver(z=>{for(const k of z)if(k.type==="childList")for(const A of k.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&S(A)}).observe(document,{childList:!0,subtree:!0});function b(z){const k={};return z.integrity&&(k.integrity=z.integrity),z.referrerPolicy&&(k.referrerPolicy=z.referrerPolicy),z.crossOrigin==="use-credentials"?k.credentials="include":z.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function S(z){if(z.ep)return;z.ep=!0;const k=b(z);fetch(z.href,k)}})();function Iy(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var f_={exports:{}},ng={};var K0;function C1(){if(K0)return ng;K0=1;var h=Symbol.for("react.transitional.element"),m=Symbol.for("react.fragment");function b(S,z,k){var A=null;if(k!==void 0&&(A=""+k),z.key!==void 0&&(A=""+z.key),"key"in z){k={};for(var l in z)l!=="key"&&(k[l]=z[l])}else k=z;return z=k.ref,{$$typeof:h,type:S,key:A,ref:z!==void 0?z:null,props:k}}return ng.Fragment=m,ng.jsx=b,ng.jsxs=b,ng}var W0;function z1(){return W0||(W0=1,f_.exports=C1()),f_.exports}var Y=z1(),p_={exports:{}},bn={};var Q0;function D1(){if(Q0)return bn;Q0=1;var h=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),A=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),K=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),re=Symbol.for("react.activity"),Ee=Symbol.iterator;function Ae(we){return we===null||typeof we!="object"?null:(we=Ee&&we[Ee]||we["@@iterator"],typeof we=="function"?we:null)}var Pe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pe=Object.assign,ie={};function Re(we,$e,vt){this.props=we,this.context=$e,this.refs=ie,this.updater=vt||Pe}Re.prototype.isReactComponent={},Re.prototype.setState=function(we,$e){if(typeof we!="object"&&typeof we!="function"&&we!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,we,$e,"setState")},Re.prototype.forceUpdate=function(we){this.updater.enqueueForceUpdate(this,we,"forceUpdate")};function We(){}We.prototype=Re.prototype;function it(we,$e,vt){this.props=we,this.context=$e,this.refs=ie,this.updater=vt||Pe}var Dt=it.prototype=new We;Dt.constructor=it,pe(Dt,Re.prototype),Dt.isPureReactComponent=!0;var bt=Array.isArray;function rt(){}var at={H:null,A:null,T:null,S:null},Ie=Object.prototype.hasOwnProperty;function st(we,$e,vt){var Pt=vt.ref;return{$$typeof:h,type:we,key:$e,ref:Pt!==void 0?Pt:null,props:vt}}function tt(we,$e){return st(we.type,$e,we.props)}function ct(we){return typeof we=="object"&&we!==null&&we.$$typeof===h}function Tt(we){var $e={"=":"=0",":":"=2"};return"$"+we.replace(/[=:]/g,function(vt){return $e[vt]})}var jt=/\/+/g;function Gt(we,$e){return typeof we=="object"&&we!==null&&we.key!=null?Tt(""+we.key):$e.toString(36)}function ut(we){switch(we.status){case"fulfilled":return we.value;case"rejected":throw we.reason;default:switch(typeof we.status=="string"?we.then(rt,rt):(we.status="pending",we.then(function($e){we.status==="pending"&&(we.status="fulfilled",we.value=$e)},function($e){we.status==="pending"&&(we.status="rejected",we.reason=$e)})),we.status){case"fulfilled":return we.value;case"rejected":throw we.reason}}throw we}function Te(we,$e,vt,Pt,Vt){var Xt=typeof we;(Xt==="undefined"||Xt==="boolean")&&(we=null);var Qt=!1;if(we===null)Qt=!0;else switch(Xt){case"bigint":case"string":case"number":Qt=!0;break;case"object":switch(we.$$typeof){case h:case m:Qt=!0;break;case ne:return Qt=we._init,Te(Qt(we._payload),$e,vt,Pt,Vt)}}if(Qt)return Vt=Vt(we),Qt=Pt===""?"."+Gt(we,0):Pt,bt(Vt)?(vt="",Qt!=null&&(vt=Qt.replace(jt,"$&/")+"/"),Te(Vt,$e,vt,"",function(on){return on})):Vt!=null&&(ct(Vt)&&(Vt=tt(Vt,vt+(Vt.key==null||we&&we.key===Vt.key?"":(""+Vt.key).replace(jt,"$&/")+"/")+Qt)),$e.push(Vt)),1;Qt=0;var rn=Pt===""?".":Pt+":";if(bt(we))for(var Yt=0;Yt<we.length;Yt++)Pt=we[Yt],Xt=rn+Gt(Pt,Yt),Qt+=Te(Pt,$e,vt,Xt,Vt);else if(Yt=Ae(we),typeof Yt=="function")for(we=Yt.call(we),Yt=0;!(Pt=we.next()).done;)Pt=Pt.value,Xt=rn+Gt(Pt,Yt++),Qt+=Te(Pt,$e,vt,Xt,Vt);else if(Xt==="object"){if(typeof we.then=="function")return Te(ut(we),$e,vt,Pt,Vt);throw $e=String(we),Error("Objects are not valid as a React child (found: "+($e==="[object Object]"?"object with keys {"+Object.keys(we).join(", ")+"}":$e)+"). If you meant to render a collection of children, use an array instead.")}return Qt}function He(we,$e,vt){if(we==null)return we;var Pt=[],Vt=0;return Te(we,Pt,"","",function(Xt){return $e.call(vt,Xt,Vt++)}),Pt}function pt(we){if(we._status===-1){var $e=we._result;$e=$e(),$e.then(function(vt){(we._status===0||we._status===-1)&&(we._status=1,we._result=vt)},function(vt){(we._status===0||we._status===-1)&&(we._status=2,we._result=vt)}),we._status===-1&&(we._status=0,we._result=$e)}if(we._status===1)return we._result.default;throw we._result}var _t=typeof reportError=="function"?reportError:function(we){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof we=="object"&&we!==null&&typeof we.message=="string"?String(we.message):String(we),error:we});if(!window.dispatchEvent($e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",we);return}console.error(we)},Ft={map:He,forEach:function(we,$e,vt){He(we,function(){$e.apply(this,arguments)},vt)},count:function(we){var $e=0;return He(we,function(){$e++}),$e},toArray:function(we){return He(we,function($e){return $e})||[]},only:function(we){if(!ct(we))throw Error("React.Children.only expected to receive a single React element child.");return we}};return bn.Activity=re,bn.Children=Ft,bn.Component=Re,bn.Fragment=b,bn.Profiler=z,bn.PureComponent=it,bn.StrictMode=S,bn.Suspense=N,bn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=at,bn.__COMPILER_RUNTIME={__proto__:null,c:function(we){return at.H.useMemoCache(we)}},bn.cache=function(we){return function(){return we.apply(null,arguments)}},bn.cacheSignal=function(){return null},bn.cloneElement=function(we,$e,vt){if(we==null)throw Error("The argument must be a React element, but you passed "+we+".");var Pt=pe({},we.props),Vt=we.key;if($e!=null)for(Xt in $e.key!==void 0&&(Vt=""+$e.key),$e)!Ie.call($e,Xt)||Xt==="key"||Xt==="__self"||Xt==="__source"||Xt==="ref"&&$e.ref===void 0||(Pt[Xt]=$e[Xt]);var Xt=arguments.length-2;if(Xt===1)Pt.children=vt;else if(1<Xt){for(var Qt=Array(Xt),rn=0;rn<Xt;rn++)Qt[rn]=arguments[rn+2];Pt.children=Qt}return st(we.type,Vt,Pt)},bn.createContext=function(we){return we={$$typeof:A,_currentValue:we,_currentValue2:we,_threadCount:0,Provider:null,Consumer:null},we.Provider=we,we.Consumer={$$typeof:k,_context:we},we},bn.createElement=function(we,$e,vt){var Pt,Vt={},Xt=null;if($e!=null)for(Pt in $e.key!==void 0&&(Xt=""+$e.key),$e)Ie.call($e,Pt)&&Pt!=="key"&&Pt!=="__self"&&Pt!=="__source"&&(Vt[Pt]=$e[Pt]);var Qt=arguments.length-2;if(Qt===1)Vt.children=vt;else if(1<Qt){for(var rn=Array(Qt),Yt=0;Yt<Qt;Yt++)rn[Yt]=arguments[Yt+2];Vt.children=rn}if(we&&we.defaultProps)for(Pt in Qt=we.defaultProps,Qt)Vt[Pt]===void 0&&(Vt[Pt]=Qt[Pt]);return st(we,Xt,Vt)},bn.createRef=function(){return{current:null}},bn.forwardRef=function(we){return{$$typeof:l,render:we}},bn.isValidElement=ct,bn.lazy=function(we){return{$$typeof:ne,_payload:{_status:-1,_result:we},_init:pt}},bn.memo=function(we,$e){return{$$typeof:K,type:we,compare:$e===void 0?null:$e}},bn.startTransition=function(we){var $e=at.T,vt={};at.T=vt;try{var Pt=we(),Vt=at.S;Vt!==null&&Vt(vt,Pt),typeof Pt=="object"&&Pt!==null&&typeof Pt.then=="function"&&Pt.then(rt,_t)}catch(Xt){_t(Xt)}finally{$e!==null&&vt.types!==null&&($e.types=vt.types),at.T=$e}},bn.unstable_useCacheRefresh=function(){return at.H.useCacheRefresh()},bn.use=function(we){return at.H.use(we)},bn.useActionState=function(we,$e,vt){return at.H.useActionState(we,$e,vt)},bn.useCallback=function(we,$e){return at.H.useCallback(we,$e)},bn.useContext=function(we){return at.H.useContext(we)},bn.useDebugValue=function(){},bn.useDeferredValue=function(we,$e){return at.H.useDeferredValue(we,$e)},bn.useEffect=function(we,$e){return at.H.useEffect(we,$e)},bn.useEffectEvent=function(we){return at.H.useEffectEvent(we)},bn.useId=function(){return at.H.useId()},bn.useImperativeHandle=function(we,$e,vt){return at.H.useImperativeHandle(we,$e,vt)},bn.useInsertionEffect=function(we,$e){return at.H.useInsertionEffect(we,$e)},bn.useLayoutEffect=function(we,$e){return at.H.useLayoutEffect(we,$e)},bn.useMemo=function(we,$e){return at.H.useMemo(we,$e)},bn.useOptimistic=function(we,$e){return at.H.useOptimistic(we,$e)},bn.useReducer=function(we,$e,vt){return at.H.useReducer(we,$e,vt)},bn.useRef=function(we){return at.H.useRef(we)},bn.useState=function(we){return at.H.useState(we)},bn.useSyncExternalStore=function(we,$e,vt){return at.H.useSyncExternalStore(we,$e,vt)},bn.useTransition=function(){return at.H.useTransition()},bn.version="19.2.3",bn}var J0;function e0(){return J0||(J0=1,p_.exports=D1()),p_.exports}var De=e0();const t0=Iy(De);var m_={exports:{}},ig={},g_={exports:{}},y_={};var ev;function P1(){return ev||(ev=1,(function(h){function m(Te,He){var pt=Te.length;Te.push(He);e:for(;0<pt;){var _t=pt-1>>>1,Ft=Te[_t];if(0<z(Ft,He))Te[_t]=He,Te[pt]=Ft,pt=_t;else break e}}function b(Te){return Te.length===0?null:Te[0]}function S(Te){if(Te.length===0)return null;var He=Te[0],pt=Te.pop();if(pt!==He){Te[0]=pt;e:for(var _t=0,Ft=Te.length,we=Ft>>>1;_t<we;){var $e=2*(_t+1)-1,vt=Te[$e],Pt=$e+1,Vt=Te[Pt];if(0>z(vt,pt))Pt<Ft&&0>z(Vt,vt)?(Te[_t]=Vt,Te[Pt]=pt,_t=Pt):(Te[_t]=vt,Te[$e]=pt,_t=$e);else if(Pt<Ft&&0>z(Vt,pt))Te[_t]=Vt,Te[Pt]=pt,_t=Pt;else break e}}return He}function z(Te,He){var pt=Te.sortIndex-He.sortIndex;return pt!==0?pt:Te.id-He.id}if(h.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var k=performance;h.unstable_now=function(){return k.now()}}else{var A=Date,l=A.now();h.unstable_now=function(){return A.now()-l}}var N=[],K=[],ne=1,re=null,Ee=3,Ae=!1,Pe=!1,pe=!1,ie=!1,Re=typeof setTimeout=="function"?setTimeout:null,We=typeof clearTimeout=="function"?clearTimeout:null,it=typeof setImmediate<"u"?setImmediate:null;function Dt(Te){for(var He=b(K);He!==null;){if(He.callback===null)S(K);else if(He.startTime<=Te)S(K),He.sortIndex=He.expirationTime,m(N,He);else break;He=b(K)}}function bt(Te){if(pe=!1,Dt(Te),!Pe)if(b(N)!==null)Pe=!0,rt||(rt=!0,Tt());else{var He=b(K);He!==null&&ut(bt,He.startTime-Te)}}var rt=!1,at=-1,Ie=5,st=-1;function tt(){return ie?!0:!(h.unstable_now()-st<Ie)}function ct(){if(ie=!1,rt){var Te=h.unstable_now();st=Te;var He=!0;try{e:{Pe=!1,pe&&(pe=!1,We(at),at=-1),Ae=!0;var pt=Ee;try{t:{for(Dt(Te),re=b(N);re!==null&&!(re.expirationTime>Te&&tt());){var _t=re.callback;if(typeof _t=="function"){re.callback=null,Ee=re.priorityLevel;var Ft=_t(re.expirationTime<=Te);if(Te=h.unstable_now(),typeof Ft=="function"){re.callback=Ft,Dt(Te),He=!0;break t}re===b(N)&&S(N),Dt(Te)}else S(N);re=b(N)}if(re!==null)He=!0;else{var we=b(K);we!==null&&ut(bt,we.startTime-Te),He=!1}}break e}finally{re=null,Ee=pt,Ae=!1}He=void 0}}finally{He?Tt():rt=!1}}}var Tt;if(typeof it=="function")Tt=function(){it(ct)};else if(typeof MessageChannel<"u"){var jt=new MessageChannel,Gt=jt.port2;jt.port1.onmessage=ct,Tt=function(){Gt.postMessage(null)}}else Tt=function(){Re(ct,0)};function ut(Te,He){at=Re(function(){Te(h.unstable_now())},He)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(Te){Te.callback=null},h.unstable_forceFrameRate=function(Te){0>Te||125<Te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ie=0<Te?Math.floor(1e3/Te):5},h.unstable_getCurrentPriorityLevel=function(){return Ee},h.unstable_next=function(Te){switch(Ee){case 1:case 2:case 3:var He=3;break;default:He=Ee}var pt=Ee;Ee=He;try{return Te()}finally{Ee=pt}},h.unstable_requestPaint=function(){ie=!0},h.unstable_runWithPriority=function(Te,He){switch(Te){case 1:case 2:case 3:case 4:case 5:break;default:Te=3}var pt=Ee;Ee=Te;try{return He()}finally{Ee=pt}},h.unstable_scheduleCallback=function(Te,He,pt){var _t=h.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?_t+pt:_t):pt=_t,Te){case 1:var Ft=-1;break;case 2:Ft=250;break;case 5:Ft=1073741823;break;case 4:Ft=1e4;break;default:Ft=5e3}return Ft=pt+Ft,Te={id:ne++,callback:He,priorityLevel:Te,startTime:pt,expirationTime:Ft,sortIndex:-1},pt>_t?(Te.sortIndex=pt,m(K,Te),b(N)===null&&Te===b(K)&&(pe?(We(at),at=-1):pe=!0,ut(bt,pt-_t))):(Te.sortIndex=Ft,m(N,Te),Pe||Ae||(Pe=!0,rt||(rt=!0,Tt()))),Te},h.unstable_shouldYield=tt,h.unstable_wrapCallback=function(Te){var He=Ee;return function(){var pt=Ee;Ee=He;try{return Te.apply(this,arguments)}finally{Ee=pt}}}})(y_)),y_}var tv;function I1(){return tv||(tv=1,g_.exports=P1()),g_.exports}var __={exports:{}},Ua={};var nv;function k1(){if(nv)return Ua;nv=1;var h=e0();function m(N){var K="https://react.dev/errors/"+N;if(1<arguments.length){K+="?args[]="+encodeURIComponent(arguments[1]);for(var ne=2;ne<arguments.length;ne++)K+="&args[]="+encodeURIComponent(arguments[ne])}return"Minified React error #"+N+"; visit "+K+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function b(){}var S={d:{f:b,r:function(){throw Error(m(522))},D:b,C:b,L:b,m:b,X:b,S:b,M:b},p:0,findDOMNode:null},z=Symbol.for("react.portal");function k(N,K,ne){var re=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:z,key:re==null?null:""+re,children:N,containerInfo:K,implementation:ne}}var A=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(N,K){if(N==="font")return"";if(typeof K=="string")return K==="use-credentials"?K:""}return Ua.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,Ua.createPortal=function(N,K){var ne=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!K||K.nodeType!==1&&K.nodeType!==9&&K.nodeType!==11)throw Error(m(299));return k(N,K,null,ne)},Ua.flushSync=function(N){var K=A.T,ne=S.p;try{if(A.T=null,S.p=2,N)return N()}finally{A.T=K,S.p=ne,S.d.f()}},Ua.preconnect=function(N,K){typeof N=="string"&&(K?(K=K.crossOrigin,K=typeof K=="string"?K==="use-credentials"?K:"":void 0):K=null,S.d.C(N,K))},Ua.prefetchDNS=function(N){typeof N=="string"&&S.d.D(N)},Ua.preinit=function(N,K){if(typeof N=="string"&&K&&typeof K.as=="string"){var ne=K.as,re=l(ne,K.crossOrigin),Ee=typeof K.integrity=="string"?K.integrity:void 0,Ae=typeof K.fetchPriority=="string"?K.fetchPriority:void 0;ne==="style"?S.d.S(N,typeof K.precedence=="string"?K.precedence:void 0,{crossOrigin:re,integrity:Ee,fetchPriority:Ae}):ne==="script"&&S.d.X(N,{crossOrigin:re,integrity:Ee,fetchPriority:Ae,nonce:typeof K.nonce=="string"?K.nonce:void 0})}},Ua.preinitModule=function(N,K){if(typeof N=="string")if(typeof K=="object"&&K!==null){if(K.as==null||K.as==="script"){var ne=l(K.as,K.crossOrigin);S.d.M(N,{crossOrigin:ne,integrity:typeof K.integrity=="string"?K.integrity:void 0,nonce:typeof K.nonce=="string"?K.nonce:void 0})}}else K==null&&S.d.M(N)},Ua.preload=function(N,K){if(typeof N=="string"&&typeof K=="object"&&K!==null&&typeof K.as=="string"){var ne=K.as,re=l(ne,K.crossOrigin);S.d.L(N,ne,{crossOrigin:re,integrity:typeof K.integrity=="string"?K.integrity:void 0,nonce:typeof K.nonce=="string"?K.nonce:void 0,type:typeof K.type=="string"?K.type:void 0,fetchPriority:typeof K.fetchPriority=="string"?K.fetchPriority:void 0,referrerPolicy:typeof K.referrerPolicy=="string"?K.referrerPolicy:void 0,imageSrcSet:typeof K.imageSrcSet=="string"?K.imageSrcSet:void 0,imageSizes:typeof K.imageSizes=="string"?K.imageSizes:void 0,media:typeof K.media=="string"?K.media:void 0})}},Ua.preloadModule=function(N,K){if(typeof N=="string")if(K){var ne=l(K.as,K.crossOrigin);S.d.m(N,{as:typeof K.as=="string"&&K.as!=="script"?K.as:void 0,crossOrigin:ne,integrity:typeof K.integrity=="string"?K.integrity:void 0})}else S.d.m(N)},Ua.requestFormReset=function(N){S.d.r(N)},Ua.unstable_batchedUpdates=function(N,K){return N(K)},Ua.useFormState=function(N,K,ne){return A.H.useFormState(N,K,ne)},Ua.useFormStatus=function(){return A.H.useHostTransitionStatus()},Ua.version="19.2.3",Ua}var iv;function nx(){if(iv)return __.exports;iv=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(m){console.error(m)}}return h(),__.exports=k1(),__.exports}var rv;function R1(){if(rv)return ig;rv=1;var h=I1(),m=e0(),b=nx();function S(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function z(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function k(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function A(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function l(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function N(r){if(k(r)!==r)throw Error(S(188))}function K(r){var s=r.alternate;if(!s){if(s=k(r),s===null)throw Error(S(188));return s!==r?null:r}for(var d=r,_=s;;){var M=d.return;if(M===null)break;var P=M.alternate;if(P===null){if(_=M.return,_!==null){d=_;continue}break}if(M.child===P.child){for(P=M.child;P;){if(P===d)return N(M),r;if(P===_)return N(M),s;P=P.sibling}throw Error(S(188))}if(d.return!==_.return)d=M,_=P;else{for(var V=!1,te=M.child;te;){if(te===d){V=!0,d=M,_=P;break}if(te===_){V=!0,_=M,d=P;break}te=te.sibling}if(!V){for(te=P.child;te;){if(te===d){V=!0,d=P,_=M;break}if(te===_){V=!0,_=P,d=M;break}te=te.sibling}if(!V)throw Error(S(189))}}if(d.alternate!==_)throw Error(S(190))}if(d.tag!==3)throw Error(S(188));return d.stateNode.current===d?r:s}function ne(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=ne(r),s!==null)return s;r=r.sibling}return null}var re=Object.assign,Ee=Symbol.for("react.element"),Ae=Symbol.for("react.transitional.element"),Pe=Symbol.for("react.portal"),pe=Symbol.for("react.fragment"),ie=Symbol.for("react.strict_mode"),Re=Symbol.for("react.profiler"),We=Symbol.for("react.consumer"),it=Symbol.for("react.context"),Dt=Symbol.for("react.forward_ref"),bt=Symbol.for("react.suspense"),rt=Symbol.for("react.suspense_list"),at=Symbol.for("react.memo"),Ie=Symbol.for("react.lazy"),st=Symbol.for("react.activity"),tt=Symbol.for("react.memo_cache_sentinel"),ct=Symbol.iterator;function Tt(r){return r===null||typeof r!="object"?null:(r=ct&&r[ct]||r["@@iterator"],typeof r=="function"?r:null)}var jt=Symbol.for("react.client.reference");function Gt(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===jt?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case pe:return"Fragment";case Re:return"Profiler";case ie:return"StrictMode";case bt:return"Suspense";case rt:return"SuspenseList";case st:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Pe:return"Portal";case it:return r.displayName||"Context";case We:return(r._context.displayName||"Context")+".Consumer";case Dt:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case at:return s=r.displayName||null,s!==null?s:Gt(r.type)||"Memo";case Ie:s=r._payload,r=r._init;try{return Gt(r(s))}catch{}}return null}var ut=Array.isArray,Te=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,He=b.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pt={pending:!1,data:null,method:null,action:null},_t=[],Ft=-1;function we(r){return{current:r}}function $e(r){0>Ft||(r.current=_t[Ft],_t[Ft]=null,Ft--)}function vt(r,s){Ft++,_t[Ft]=r.current,r.current=s}var Pt=we(null),Vt=we(null),Xt=we(null),Qt=we(null);function rn(r,s){switch(vt(Xt,s),vt(Vt,r),vt(Pt,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?gc(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=gc(s),r=Im(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}$e(Pt),vt(Pt,r)}function Yt(){$e(Pt),$e(Vt),$e(Xt)}function on(r){r.memoizedState!==null&&vt(Qt,r);var s=Pt.current,d=Im(s,r.type);s!==d&&(vt(Vt,r),vt(Pt,d))}function xn(r){Vt.current===r&&($e(Pt),$e(Vt)),Qt.current===r&&($e(Qt),Oh._currentValue=pt)}var qn,Ki;function zn(r){if(qn===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);qn=s&&s[1]||"",Ki=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qn+r+Ki}var wi=!1;function Wi(r,s){if(!r||wi)return"";wi=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(s){var yt=function(){throw Error()};if(Object.defineProperty(yt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(yt,[])}catch(Je){var Ye=Je}Reflect.construct(r,[],yt)}else{try{yt.call()}catch(Je){Ye=Je}r.call(yt.prototype)}}else{try{throw Error()}catch(Je){Ye=Je}(yt=r())&&typeof yt.catch=="function"&&yt.catch(function(){})}}catch(Je){if(Je&&Ye&&typeof Je.stack=="string")return[Je.stack,Ye.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var M=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");M&&M.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var P=_.DetermineComponentFrameRoot(),V=P[0],te=P[1];if(V&&te){var Me=V.split(`
`),Xe=te.split(`
`);for(M=_=0;_<Me.length&&!Me[_].includes("DetermineComponentFrameRoot");)_++;for(;M<Xe.length&&!Xe[M].includes("DetermineComponentFrameRoot");)M++;if(_===Me.length||M===Xe.length)for(_=Me.length-1,M=Xe.length-1;1<=_&&0<=M&&Me[_]!==Xe[M];)M--;for(;1<=_&&0<=M;_--,M--)if(Me[_]!==Xe[M]){if(_!==1||M!==1)do if(_--,M--,0>M||Me[_]!==Xe[M]){var ht=`
`+Me[_].replace(" at new "," at ");return r.displayName&&ht.includes("<anonymous>")&&(ht=ht.replace("<anonymous>",r.displayName)),ht}while(1<=_&&0<=M);break}}}finally{wi=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?zn(d):""}function Yn(r,s){switch(r.tag){case 26:case 27:case 5:return zn(r.type);case 16:return zn("Lazy");case 13:return r.child!==s&&s!==null?zn("Suspense Fallback"):zn("Suspense");case 19:return zn("SuspenseList");case 0:case 15:return Wi(r.type,!1);case 11:return Wi(r.type.render,!1);case 1:return Wi(r.type,!0);case 31:return zn("Activity");default:return""}}function na(r){try{var s="",d=null;do s+=Yn(r,d),d=r,r=r.return;while(r);return s}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}var Pr=Object.prototype.hasOwnProperty,ia=h.unstable_scheduleCallback,Ur=h.unstable_cancelCallback,Ir=h.unstable_shouldYield,cs=h.unstable_requestPaint,Ti=h.unstable_now,Qi=h.unstable_getCurrentPriorityLevel,fe=h.unstable_ImmediatePriority,H=h.unstable_UserBlockingPriority,$=h.unstable_NormalPriority,Q=h.unstable_LowPriority,de=h.unstable_IdlePriority,ve=h.log,Le=h.unstable_setDisableYieldValue,ke=null,ye=null;function Oe(r){if(typeof ve=="function"&&Le(r),ye&&typeof ye.setStrictMode=="function")try{ye.setStrictMode(ke,r)}catch{}}var Qe=Math.clz32?Math.clz32:It,nt=Math.log,Et=Math.LN2;function It(r){return r>>>=0,r===0?32:31-(nt(r)/Et|0)|0}var Kt=256,gn=262144,pn=4194304;function Ne(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function lt(r,s,d){var _=r.pendingLanes;if(_===0)return 0;var M=0,P=r.suspendedLanes,V=r.pingedLanes;r=r.warmLanes;var te=_&134217727;return te!==0?(_=te&~P,_!==0?M=Ne(_):(V&=te,V!==0?M=Ne(V):d||(d=te&~r,d!==0&&(M=Ne(d))))):(te=_&~P,te!==0?M=Ne(te):V!==0?M=Ne(V):d||(d=_&~r,d!==0&&(M=Ne(d)))),M===0?0:s!==0&&s!==M&&(s&P)===0&&(P=M&-M,d=s&-s,P>=d||P===32&&(d&4194048)!==0)?s:M}function Ot(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function Mt(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tn(){var r=pn;return pn<<=1,(pn&62914560)===0&&(pn=4194304),r}function Tn(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function Sn(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function un(r,s,d,_,M,P){var V=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var te=r.entanglements,Me=r.expirationTimes,Xe=r.hiddenUpdates;for(d=V&~d;0<d;){var ht=31-Qe(d),yt=1<<ht;te[ht]=0,Me[ht]=-1;var Ye=Xe[ht];if(Ye!==null)for(Xe[ht]=null,ht=0;ht<Ye.length;ht++){var Je=Ye[ht];Je!==null&&(Je.lane&=-536870913)}d&=~yt}_!==0&&Dn(r,_,0),P!==0&&M===0&&r.tag!==0&&(r.suspendedLanes|=P&~(V&~s))}function Dn(r,s,d){r.pendingLanes|=s,r.suspendedLanes&=~s;var _=31-Qe(s);r.entangledLanes|=s,r.entanglements[_]=r.entanglements[_]|1073741824|d&261930}function ai(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var _=31-Qe(d),M=1<<_;M&s|r[_]&s&&(r[_]|=s),d&=~M}}function Bl(r,s){var d=s&-s;return d=(d&42)!==0?1:Go(d),(d&(r.suspendedLanes|s))!==0?0:d}function Go(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function xt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function br(){var r=He.p;return r!==0?r:(r=window.event,r===void 0?32:Cu(r.type))}function wr(r,s){var d=He.p;try{return He.p=r,s()}finally{He.p=d}}var Ga=Math.random().toString(36).slice(2),ni="__reactFiber$"+Ga,At="__reactProps$"+Ga,ln="__reactContainer$"+Ga,fn="__reactEvents$"+Ga,ra="__reactListeners$"+Ga,Uu="__reactHandles$"+Ga,us="__reactResources$"+Ga,sn="__reactMarker$"+Ga;function Zo(r){delete r[ni],delete r[At],delete r[fn],delete r[ra],delete r[Uu]}function hs(r){var s=r[ni];if(s)return s;for(var d=r.parentNode;d;){if(s=d[ln]||d[ni]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=Vd(r);r!==null;){if(d=r[ni])return d;r=Vd(r)}return s}r=d,d=r.parentNode}return null}function js(r){if(r=r[ni]||r[ln]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function ds(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(S(33))}function fs(r){var s=r[us];return s||(s=r[us]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Si(r){r[sn]=!0}var Nl=new Set,Tr={};function Mn(r,s){Us(r,s),Us(r+"Capture",s)}function Us(r,s){for(Tr[r]=s,r=0;r<s.length;r++)Nl.add(s[r])}var Fl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jl={},uo={};function Za(r){return Pr.call(uo,r)?!0:Pr.call(jl,r)?!1:Fl.test(r)?uo[r]=!0:(jl[r]=!0,!1)}function kc(r,s,d){if(Za(s))if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var _=s.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+d)}}function ps(r,s,d){if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+d)}}function wa(r,s,d,_){if(_===null)r.removeAttribute(d);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(s,d,""+_)}}function Rn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Kh(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function _f(r,s,d){var _=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var M=_.get,P=_.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return M.call(this)},set:function(V){d=""+V,P.call(this,V)}}),Object.defineProperty(r,s,{enumerable:_.enumerable}),{getValue:function(){return d},setValue:function(V){d=""+V},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function Ho(r){if(!r._valueTracker){var s=Kh(r)?"checked":"value";r._valueTracker=_f(r,s,""+r[s])}}function Wh(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),_="";return r&&(_=Kh(r)?r.checked?"true":"false":r.value),r=_,r!==d?(s.setValue(r),!0):!1}function Rc(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var vf=/[\n"\\]/g;function kr(r){return r.replace(vf,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Lc(r,s,d,_,M,P,V,te){r.name="",V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?r.type=V:r.removeAttribute("type"),s!=null?V==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+Rn(s)):r.value!==""+Rn(s)&&(r.value=""+Rn(s)):V!=="submit"&&V!=="reset"||r.removeAttribute("value"),s!=null?Oc(r,V,Rn(s)):d!=null?Oc(r,V,Rn(d)):_!=null&&r.removeAttribute("value"),M==null&&P!=null&&(r.defaultChecked=!!P),M!=null&&(r.checked=M&&typeof M!="function"&&typeof M!="symbol"),te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"?r.name=""+Rn(te):r.removeAttribute("name")}function Vu(r,s,d,_,M,P,V,te){if(P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(r.type=P),s!=null||d!=null){if(!(P!=="submit"&&P!=="reset"||s!=null)){Ho(r);return}d=d!=null?""+Rn(d):"",s=s!=null?""+Rn(s):d,te||s===r.value||(r.value=s),r.defaultValue=s}_=_??M,_=typeof _!="function"&&typeof _!="symbol"&&!!_,r.checked=te?r.checked:!!_,r.defaultChecked=!!_,V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"&&(r.name=V),Ho(r)}function Oc(r,s,d){s==="number"&&Rc(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function ho(r,s,d,_){if(r=r.options,s){s={};for(var M=0;M<d.length;M++)s["$"+d[M]]=!0;for(d=0;d<r.length;d++)M=s.hasOwnProperty("$"+r[d].value),r[d].selected!==M&&(r[d].selected=M),M&&_&&(r[d].defaultSelected=!0)}else{for(d=""+Rn(d),s=null,M=0;M<r.length;M++){if(r[M].value===d){r[M].selected=!0,_&&(r[M].defaultSelected=!0);return}s!==null||r[M].disabled||(s=r[M])}s!==null&&(s.selected=!0)}}function xf(r,s,d){if(s!=null&&(s=""+Rn(s),s!==r.value&&(r.value=s),d==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=d!=null?""+Rn(d):""}function Ul(r,s,d,_){if(s==null){if(_!=null){if(d!=null)throw Error(S(92));if(ut(_)){if(1<_.length)throw Error(S(93));_=_[0]}d=_}d==null&&(d=""),s=d}d=Rn(s),r.defaultValue=d,_=r.textContent,_===d&&_!==""&&_!==null&&(r.value=_),Ho(r)}function Vs(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var bf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function $o(r,s,d){var _=s.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?_?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":_?r.setProperty(s,d):typeof d!="number"||d===0||bf.has(s)?s==="float"?r.cssFloat=d:r[s]=(""+d).trim():r[s]=d+"px"}function qu(r,s,d){if(s!=null&&typeof s!="object")throw Error(S(62));if(r=r.style,d!=null){for(var _ in d)!d.hasOwnProperty(_)||s!=null&&s.hasOwnProperty(_)||(_.indexOf("--")===0?r.setProperty(_,""):_==="float"?r.cssFloat="":r[_]="");for(var M in s)_=s[M],s.hasOwnProperty(M)&&d[M]!==_&&$o(r,M,_)}else for(var P in s)s.hasOwnProperty(P)&&$o(r,P,s[P])}function Xo(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Vl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function dn(r){return Vl.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Ha(){}var Qh=null;function Bc(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Ji=null,Fi=null;function hi(r){var s=js(r);if(s&&(r=s.stateNode)){var d=r[At]||null;e:switch(r=s.stateNode,s.type){case"input":if(Lc(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+kr(""+s)+'"][type="radio"]'),s=0;s<d.length;s++){var _=d[s];if(_!==r&&_.form===r.form){var M=_[At]||null;if(!M)throw Error(S(90));Lc(_,M.value,M.defaultValue,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name)}}for(s=0;s<d.length;s++)_=d[s],_.form===r.form&&Wh(_)}break e;case"textarea":xf(r,d.value,d.defaultValue);break e;case"select":s=d.value,s!=null&&ho(r,!!d.multiple,s,!1)}}}var Jt=!1;function Kn(r,s,d){if(Jt)return r(s,d);Jt=!0;try{var _=r(s);return _}finally{if(Jt=!1,(Ji!==null||Fi!==null)&&(Rd(),Ji&&(s=Ji,r=Fi,Fi=Ji=null,hi(s),r)))for(s=0;s<r.length;s++)hi(r[s])}}function Ta(r,s){var d=r.stateNode;if(d===null)return null;var _=d[At]||null;if(_===null)return null;d=_[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(r=r.type,_=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!_;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(S(231,s,typeof d));return d}var Ei=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Rr=!1;if(Ei)try{var er={};Object.defineProperty(er,"passive",{get:function(){Rr=!0}}),window.addEventListener("test",er,er),window.removeEventListener("test",er,er)}catch{Rr=!1}var aa=null,ms=null,di=null;function po(){if(di)return di;var r,s=ms,d=s.length,_,M="value"in aa?aa.value:aa.textContent,P=M.length;for(r=0;r<d&&s[r]===M[r];r++);var V=d-r;for(_=1;_<=V&&s[d-_]===M[P-_];_++);return di=M.slice(r,1<_?1-_:void 0)}function sa(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Yo(){return!0}function Lr(){return!1}function Hi(r){function s(d,_,M,P,V){this._reactName=d,this._targetInst=M,this.type=_,this.nativeEvent=P,this.target=V,this.currentTarget=null;for(var te in r)r.hasOwnProperty(te)&&(d=r[te],this[te]=d?d(P):P[te]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?Yo:Lr,this.isPropagationStopped=Lr,this}return re(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Yo)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Yo)},persist:function(){},isPersistent:Yo}),s}var Or={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nc=Hi(Or),Ko=re({},Or,{view:0,detail:0}),Wo=Hi(Ko),Gn,mo,_n,cn=re({},Ko,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Uc,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==_n&&(_n&&r.type==="mousemove"?(Gn=r.screenX-_n.screenX,mo=r.screenY-_n.screenY):mo=Gn=0,_n=r),Gn)},movementY:function(r){return"movementY"in r?r.movementY:mo}}),Qo=Hi(cn),An=re({},cn,{dataTransfer:0}),Fc=Hi(An),Sa=re({},Ko,{relatedTarget:0}),go=Hi(Sa),yo=re({},Or,{animationName:0,elapsedTime:0,pseudoElement:0}),wf=Hi(yo),jc=re({},Or,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Jh=Hi(jc),Kp=re({},Or,{data:0}),ed=Hi(Kp),Br={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jo(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=fi[r])?!!s[r]:!1}function Uc(){return Jo}var Vc=re({},Ko,{key:function(r){if(r.key){var s=Br[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=sa(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?gs[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Uc,charCode:function(r){return r.type==="keypress"?sa(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?sa(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Mi=Hi(Vc),Tf=re({},cn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gu=Hi(Tf),Sf=re({},Ko,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Uc}),Wp=Hi(Sf),ql=re({},Or,{propertyName:0,elapsedTime:0,pseudoElement:0}),Zu=Hi(ql),Gl=re({},cn,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),td=Hi(Gl),qc=re({},Or,{newState:0,oldState:0}),Zl=Hi(qc),Hl=[9,13,27,32],ki=Ei&&"CompositionEvent"in window,$l=null;Ei&&"documentMode"in document&&($l=document.documentMode);var Xl=Ei&&"TextEvent"in window&&!$l,Yl=Ei&&(!ki||$l&&8<$l&&11>=$l),_o=" ",Ef=!1;function Gc(r,s){switch(r){case"keyup":return Hl.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mf(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var $a=!1;function Hu(r,s){switch(r){case"compositionend":return Mf(s);case"keypress":return s.which!==32?null:(Ef=!0,_o);case"textInput":return r=s.data,r===_o&&Ef?null:r;default:return null}}function Af(r,s){if($a)return r==="compositionend"||!ki&&Gc(r,s)?(r=po(),di=ms=aa=null,$a=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Yl&&s.locale!=="ko"?null:s.data;default:return null}}var Cf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $u(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Cf[r.type]:s==="textarea"}function Xu(r,s,d,_){Ji?Fi?Fi.push(_):Fi=[_]:Ji=_,s=Nd(s,"onChange"),0<s.length&&(d=new Nc("onChange","change",null,d,_),r.push({event:d,listeners:s}))}var el=null,Kl=null;function zf(r){Hg(r,0)}function Zc(r){var s=ds(r);if(Wh(s))return r}function vo(r,s){if(r==="change")return s}var nd=!1;if(Ei){var Hc;if(Ei){var xo="oninput"in document;if(!xo){var id=document.createElement("div");id.setAttribute("oninput","return;"),xo=typeof id.oninput=="function"}Hc=xo}else Hc=!1;nd=Hc&&(!document.documentMode||9<document.documentMode)}function $c(){el&&(el.detachEvent("onpropertychange",Df),Kl=el=null)}function Df(r){if(r.propertyName==="value"&&Zc(Kl)){var s=[];Xu(s,Kl,r,Bc(r)),Kn(zf,s)}}function Qp(r,s,d){r==="focusin"?($c(),el=s,Kl=d,el.attachEvent("onpropertychange",Df)):r==="focusout"&&$c()}function Pf(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Zc(Kl)}function Xc(r,s){if(r==="click")return Zc(s)}function If(r,s){if(r==="input"||r==="change")return Zc(s)}function rd(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Vr=typeof Object.is=="function"?Object.is:rd;function bo(r,s){if(Vr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),_=Object.keys(s);if(d.length!==_.length)return!1;for(_=0;_<d.length;_++){var M=d[_];if(!Pr.call(s,M)||!Vr(r[M],s[M]))return!1}return!0}function Ea(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Yc(r,s){var d=Ea(r);r=0;for(var _;d;){if(d.nodeType===3){if(_=r+d.textContent.length,r<=s&&_>=s)return{node:d,offset:s-r};r=_}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Ea(d)}}function Yu(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?Yu(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function Ku(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Rc(r.document);s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=Rc(r.document)}return s}function Kc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var Wu=Ei&&"documentMode"in document&&11>=document.documentMode,Ma=null,Wc=null,Qc=null,Qu=!1;function kf(r,s,d){var _=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Qu||Ma==null||Ma!==Rc(_)||(_=Ma,"selectionStart"in _&&Kc(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Qc&&bo(Qc,_)||(Qc=_,_=Nd(Wc,"onSelect"),0<_.length&&(s=new Nc("onSelect","select",null,s,d),r.push({event:s,listeners:_}),s.target=Ma)))}function tl(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var nl={animationend:tl("Animation","AnimationEnd"),animationiteration:tl("Animation","AnimationIteration"),animationstart:tl("Animation","AnimationStart"),transitionrun:tl("Transition","TransitionRun"),transitionstart:tl("Transition","TransitionStart"),transitioncancel:tl("Transition","TransitionCancel"),transitionend:tl("Transition","TransitionEnd")},ad={},Ln={};Ei&&(Ln=document.createElement("div").style,"AnimationEvent"in window||(delete nl.animationend.animation,delete nl.animationiteration.animation,delete nl.animationstart.animation),"TransitionEvent"in window||delete nl.transitionend.transition);function ys(r){if(ad[r])return ad[r];if(!nl[r])return r;var s=nl[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in Ln)return ad[r]=s[d];return r}var Jc=ys("animationend"),eu=ys("animationiteration"),Ju=ys("animationstart"),il=ys("transitionrun"),tu=ys("transitionstart"),Wl=ys("transitioncancel"),oa=ys("transitionend"),sd=new Map,eh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");eh.push("scrollEnd");function la(r,s){sd.set(r,s),Mn(s,[r])}var _s=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Nr=[],qs=0,rl=0;function al(){for(var r=qs,s=rl=qs=0;s<r;){var d=Nr[s];Nr[s++]=null;var _=Nr[s];Nr[s++]=null;var M=Nr[s];Nr[s++]=null;var P=Nr[s];if(Nr[s++]=null,_!==null&&M!==null){var V=_.pending;V===null?M.next=M:(M.next=V.next,V.next=M),_.pending=M}P!==0&&od(d,M,P)}}function nu(r,s,d,_){Nr[qs++]=r,Nr[qs++]=s,Nr[qs++]=d,Nr[qs++]=_,rl|=_,r.lanes|=_,r=r.alternate,r!==null&&(r.lanes|=_)}function wo(r,s,d,_){return nu(r,s,d,_),Ql(r)}function Aa(r,s){return nu(r,null,null,s),Ql(r)}function od(r,s,d){r.lanes|=d;var _=r.alternate;_!==null&&(_.lanes|=d);for(var M=!1,P=r.return;P!==null;)P.childLanes|=d,_=P.alternate,_!==null&&(_.childLanes|=d),P.tag===22&&(r=P.stateNode,r===null||r._visibility&1||(M=!0)),r=P,P=P.return;return r.tag===3?(P=r.stateNode,M&&s!==null&&(M=31-Qe(d),r=P.hiddenUpdates,_=r[M],_===null?r[M]=[s]:_.push(s),s.lane=d|536870912),P):null}function Ql(r){if(50<kd)throw kd=0,gm=null,Error(S(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var hn={};function th(r,s,d,_){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ca(r,s,d,_){return new th(r,s,d,_)}function nh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ua(r,s){var d=r.alternate;return d===null?(d=ca(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function Rf(r,s){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,s=d.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function ih(r,s,d,_,M,P){var V=0;if(_=r,typeof r=="function")nh(r)&&(V=1);else if(typeof r=="string")V=Ap(r,d,Pt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case st:return r=ca(31,d,s,M),r.elementType=st,r.lanes=P,r;case pe:return To(d.children,M,P,s);case ie:V=8,M|=24;break;case Re:return r=ca(12,d,s,M|2),r.elementType=Re,r.lanes=P,r;case bt:return r=ca(13,d,s,M),r.elementType=bt,r.lanes=P,r;case rt:return r=ca(19,d,s,M),r.elementType=rt,r.lanes=P,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case it:V=10;break e;case We:V=9;break e;case Dt:V=11;break e;case at:V=14;break e;case Ie:V=16,_=null;break e}V=29,d=Error(S(130,r===null?"null":typeof r,"")),_=null}return s=ca(V,d,s,M),s.elementType=r,s.type=_,s.lanes=P,s}function To(r,s,d,_){return r=ca(7,r,_,s),r.lanes=d,r}function ld(r,s,d){return r=ca(6,r,null,s),r.lanes=d,r}function rh(r){var s=ca(18,null,null,0);return s.stateNode=r,s}function So(r,s,d){return s=ca(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var Jl=new WeakMap;function Fr(r,s){if(typeof r=="object"&&r!==null){var d=Jl.get(r);return d!==void 0?d:(s={value:r,source:s,stack:na(s)},Jl.set(r,s),s)}return{value:r,source:s,stack:na(s)}}var Eo=[],Mo=0,sl=null,Ao=0,tr=[],rr=0,vs=null,xs=1,qr="";function Gs(r,s){Eo[Mo++]=Ao,Eo[Mo++]=sl,sl=r,Ao=s}function cd(r,s,d){tr[rr++]=xs,tr[rr++]=qr,tr[rr++]=vs,vs=r;var _=xs;r=qr;var M=32-Qe(_)-1;_&=~(1<<M),d+=1;var P=32-Qe(s)+M;if(30<P){var V=M-M%5;P=(_&(1<<V)-1).toString(32),_>>=V,M-=V,xs=1<<32-Qe(s)+M|d<<M|_,qr=P+r}else xs=1<<P|d<<M|_,qr=r}function ol(r){r.return!==null&&(Gs(r,1),cd(r,1,0))}function ec(r){for(;r===sl;)sl=Eo[--Mo],Eo[Mo]=null,Ao=Eo[--Mo],Eo[Mo]=null;for(;r===vs;)vs=tr[--rr],tr[rr]=null,qr=tr[--rr],tr[rr]=null,xs=tr[--rr],tr[rr]=null}function ud(r,s){tr[rr++]=xs,tr[rr++]=qr,tr[rr++]=vs,xs=s.id,qr=s.overflow,vs=r}var ar=null,Wn=null,En=!1,Zs=null,ha=!1,_i=Error(S(519));function Gr(r){var s=Error(S(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Hs(Fr(s,r)),_i}function Zr(r){var s=r.stateNode,d=r.type,_=r.memoizedProps;switch(s[ni]=r,s[At]=_,d){case"dialog":kn("cancel",s),kn("close",s);break;case"iframe":case"object":case"embed":kn("load",s);break;case"video":case"audio":for(d=0;d<mc.length;d++)kn(mc[d],s);break;case"source":kn("error",s);break;case"img":case"image":case"link":kn("error",s),kn("load",s);break;case"details":kn("toggle",s);break;case"input":kn("invalid",s),Vu(s,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0);break;case"select":kn("invalid",s);break;case"textarea":kn("invalid",s),Ul(s,_.value,_.defaultValue,_.children)}d=_.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||s.textContent===""+d||_.suppressHydrationWarning===!0||Dm(s.textContent,d)?(_.popover!=null&&(kn("beforetoggle",s),kn("toggle",s)),_.onScroll!=null&&kn("scroll",s),_.onScrollEnd!=null&&kn("scrollend",s),_.onClick!=null&&(s.onclick=Ha),s=!0):s=!1,s||Gr(r,!0)}function iu(r){for(ar=r.return;ar;)switch(ar.tag){case 5:case 31:case 13:ha=!1;return;case 27:case 3:ha=!0;return;default:ar=ar.return}}function bs(r){if(r!==ar)return!1;if(!En)return iu(r),En=!0,!1;var s=r.tag,d;if((d=s!==3&&s!==27)&&((d=s===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||xp(r.type,r.memoizedProps)),d=!d),d&&Wn&&Gr(r),iu(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));Wn=fr(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));Wn=fr(r)}else s===27?(s=Wn,_c(r.type)?(r=va,va=null,Wn=r):Wn=s):Wn=ar?as(r.stateNode.nextSibling):null;return!0}function ws(){Wn=ar=null,En=!1}function Ts(){var r=Zs;return r!==null&&(Ba===null?Ba=r:Ba.push.apply(Ba,r),Zs=null),r}function Hs(r){Zs===null?Zs=[r]:Zs.push(r)}var $s=we(null),Ca=null,Ss=null;function Xs(r,s,d){vt($s,s._currentValue),s._currentValue=d}function Es(r){r._currentValue=$s.current,$e($s)}function ah(r,s,d){for(;r!==null;){var _=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,_!==null&&(_.childLanes|=s)):_!==null&&(_.childLanes&s)!==s&&(_.childLanes|=s),r===d)break;r=r.return}}function sh(r,s,d,_){var M=r.child;for(M!==null&&(M.return=r);M!==null;){var P=M.dependencies;if(P!==null){var V=M.child;P=P.firstContext;e:for(;P!==null;){var te=P;P=M;for(var Me=0;Me<s.length;Me++)if(te.context===s[Me]){P.lanes|=d,te=P.alternate,te!==null&&(te.lanes|=d),ah(P.return,d,r),_||(V=null);break e}P=te.next}}else if(M.tag===18){if(V=M.return,V===null)throw Error(S(341));V.lanes|=d,P=V.alternate,P!==null&&(P.lanes|=d),ah(V,d,r),V=null}else V=M.child;if(V!==null)V.return=M;else for(V=M;V!==null;){if(V===r){V=null;break}if(M=V.sibling,M!==null){M.return=V.return,V=M;break}V=V.return}M=V}}function da(r,s,d,_){r=null;for(var M=s,P=!1;M!==null;){if(!P){if((M.flags&524288)!==0)P=!0;else if((M.flags&262144)!==0)break}if(M.tag===10){var V=M.alternate;if(V===null)throw Error(S(387));if(V=V.memoizedProps,V!==null){var te=M.type;Vr(M.pendingProps.value,V.value)||(r!==null?r.push(te):r=[te])}}else if(M===Qt.current){if(V=M.alternate,V===null)throw Error(S(387));V.memoizedState.memoizedState!==M.memoizedState.memoizedState&&(r!==null?r.push(Oh):r=[Oh])}M=M.return}r!==null&&sh(s,r,d,_),s.flags|=262144}function tc(r){for(r=r.firstContext;r!==null;){if(!Vr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ys(r){Ca=r,Ss=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ji(r){return oh(Ca,r)}function ru(r,s){return Ca===null&&Ys(r),oh(r,s)}function oh(r,s){var d=s._currentValue;if(s={context:s,memoizedValue:d,next:null},Ss===null){if(r===null)throw Error(S(308));Ss=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Ss=Ss.next=s;return d}var hd=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(d,_){r.push(_)}};this.abort=function(){s.aborted=!0,r.forEach(function(d){return d()})}},Lf=h.unstable_scheduleCallback,dd=h.unstable_NormalPriority,Ri={$$typeof:it,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ms(){return{controller:new hd,data:new Map,refCount:0}}function nc(r){r.refCount--,r.refCount===0&&Lf(dd,function(){r.controller.abort()})}var Sr=null,fa=0,ll=0,Er=null;function Jp(r,s){if(Sr===null){var d=Sr=[];fa=0,ll=Em(),Er={status:"pending",value:void 0,then:function(_){d.push(_)}}}return fa++,s.then(ic,ic),s}function ic(){if(--fa===0&&Sr!==null){Er!==null&&(Er.status="fulfilled");var r=Sr;Sr=null,ll=0,Er=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function au(r,s){var d=[],_={status:"pending",value:null,reason:null,then:function(M){d.push(M)}};return r.then(function(){_.status="fulfilled",_.value=s;for(var M=0;M<d.length;M++)(0,d[M])(s)},function(M){for(_.status="rejected",_.reason=M,M=0;M<d.length;M++)(0,d[M])(void 0)}),_}var nr=Te.S;Te.S=function(r,s){zg=Ti(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Jp(r,s),nr!==null&&nr(r,s)};var Xa=we(null);function lh(){var r=Xa.current;return r!==null?r:gi.pooledCache}function ch(r,s){s===null?vt(Xa,Xa.current):vt(Xa,s.pool)}function Of(){var r=lh();return r===null?null:{parent:Ri._currentValue,pool:r}}var Ya=Error(S(460)),Co=Error(S(474)),Hr=Error(S(542)),Rt={then:function(){}};function su(r){return r=r.status,r==="fulfilled"||r==="rejected"}function uh(r,s,d){switch(d=r[d],d===void 0?r.push(s):d!==s&&(s.then(Ha,Ha),s=d),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,hh(r),r;default:if(typeof s.status=="string")s.then(Ha,Ha);else{if(r=gi,r!==null&&100<r.shellSuspendCounter)throw Error(S(482));r=s,r.status="pending",r.then(function(_){if(s.status==="pending"){var M=s;M.status="fulfilled",M.value=_}},function(_){if(s.status==="pending"){var M=s;M.status="rejected",M.reason=_}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,hh(r),r}throw Ka=s,Ya}}function za(r){try{var s=r._init;return s(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(Ka=d,Ya):d}}var Ka=null;function rc(){if(Ka===null)throw Error(S(459));var r=Ka;return Ka=null,r}function hh(r){if(r===Ya||r===Hr)throw Error(S(483))}var As=null,cl=0;function ou(r){var s=cl;return cl+=1,As===null&&(As=[]),uh(As,r,s)}function Cs(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function dh(r,s){throw s.$$typeof===Ee?Error(S(525)):(r=Object.prototype.toString.call(s),Error(S(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function lu(r){function s(Be,ze){if(r){var Ge=Be.deletions;Ge===null?(Be.deletions=[ze],Be.flags|=16):Ge.push(ze)}}function d(Be,ze){if(!r)return null;for(;ze!==null;)s(Be,ze),ze=ze.sibling;return null}function _(Be){for(var ze=new Map;Be!==null;)Be.key!==null?ze.set(Be.key,Be):ze.set(Be.index,Be),Be=Be.sibling;return ze}function M(Be,ze){return Be=ua(Be,ze),Be.index=0,Be.sibling=null,Be}function P(Be,ze,Ge){return Be.index=Ge,r?(Ge=Be.alternate,Ge!==null?(Ge=Ge.index,Ge<ze?(Be.flags|=67108866,ze):Ge):(Be.flags|=67108866,ze)):(Be.flags|=1048576,ze)}function V(Be){return r&&Be.alternate===null&&(Be.flags|=67108866),Be}function te(Be,ze,Ge,mt){return ze===null||ze.tag!==6?(ze=ld(Ge,Be.mode,mt),ze.return=Be,ze):(ze=M(ze,Ge),ze.return=Be,ze)}function Me(Be,ze,Ge,mt){var en=Ge.type;return en===pe?ht(Be,ze,Ge.props.children,mt,Ge.key):ze!==null&&(ze.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===Ie&&za(en)===ze.type)?(ze=M(ze,Ge.props),Cs(ze,Ge),ze.return=Be,ze):(ze=ih(Ge.type,Ge.key,Ge.props,null,Be.mode,mt),Cs(ze,Ge),ze.return=Be,ze)}function Xe(Be,ze,Ge,mt){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==Ge.containerInfo||ze.stateNode.implementation!==Ge.implementation?(ze=So(Ge,Be.mode,mt),ze.return=Be,ze):(ze=M(ze,Ge.children||[]),ze.return=Be,ze)}function ht(Be,ze,Ge,mt,en){return ze===null||ze.tag!==7?(ze=To(Ge,Be.mode,mt,en),ze.return=Be,ze):(ze=M(ze,Ge),ze.return=Be,ze)}function yt(Be,ze,Ge){if(typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint")return ze=ld(""+ze,Be.mode,Ge),ze.return=Be,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case Ae:return Ge=ih(ze.type,ze.key,ze.props,null,Be.mode,Ge),Cs(Ge,ze),Ge.return=Be,Ge;case Pe:return ze=So(ze,Be.mode,Ge),ze.return=Be,ze;case Ie:return ze=za(ze),yt(Be,ze,Ge)}if(ut(ze)||Tt(ze))return ze=To(ze,Be.mode,Ge,null),ze.return=Be,ze;if(typeof ze.then=="function")return yt(Be,ou(ze),Ge);if(ze.$$typeof===it)return yt(Be,ru(Be,ze),Ge);dh(Be,ze)}return null}function Ye(Be,ze,Ge,mt){var en=ze!==null?ze.key:null;if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint")return en!==null?null:te(Be,ze,""+Ge,mt);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case Ae:return Ge.key===en?Me(Be,ze,Ge,mt):null;case Pe:return Ge.key===en?Xe(Be,ze,Ge,mt):null;case Ie:return Ge=za(Ge),Ye(Be,ze,Ge,mt)}if(ut(Ge)||Tt(Ge))return en!==null?null:ht(Be,ze,Ge,mt,null);if(typeof Ge.then=="function")return Ye(Be,ze,ou(Ge),mt);if(Ge.$$typeof===it)return Ye(Be,ze,ru(Be,Ge),mt);dh(Be,Ge)}return null}function Je(Be,ze,Ge,mt,en){if(typeof mt=="string"&&mt!==""||typeof mt=="number"||typeof mt=="bigint")return Be=Be.get(Ge)||null,te(ze,Be,""+mt,en);if(typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case Ae:return Be=Be.get(mt.key===null?Ge:mt.key)||null,Me(ze,Be,mt,en);case Pe:return Be=Be.get(mt.key===null?Ge:mt.key)||null,Xe(ze,Be,mt,en);case Ie:return mt=za(mt),Je(Be,ze,Ge,mt,en)}if(ut(mt)||Tt(mt))return Be=Be.get(Ge)||null,ht(ze,Be,mt,en,null);if(typeof mt.then=="function")return Je(Be,ze,Ge,ou(mt),en);if(mt.$$typeof===it)return Je(Be,ze,Ge,ru(ze,mt),en);dh(ze,mt)}return null}function Zt(Be,ze,Ge,mt){for(var en=null,$n=null,Ht=ze,Wt=ze=0,Cn=null;Ht!==null&&Wt<Ge.length;Wt++){Ht.index>Wt?(Cn=Ht,Ht=null):Cn=Ht.sibling;var Vn=Ye(Be,Ht,Ge[Wt],mt);if(Vn===null){Ht===null&&(Ht=Cn);break}r&&Ht&&Vn.alternate===null&&s(Be,Ht),ze=P(Vn,ze,Wt),$n===null?en=Vn:$n.sibling=Vn,$n=Vn,Ht=Cn}if(Wt===Ge.length)return d(Be,Ht),En&&Gs(Be,Wt),en;if(Ht===null){for(;Wt<Ge.length;Wt++)Ht=yt(Be,Ge[Wt],mt),Ht!==null&&(ze=P(Ht,ze,Wt),$n===null?en=Ht:$n.sibling=Ht,$n=Ht);return En&&Gs(Be,Wt),en}for(Ht=_(Ht);Wt<Ge.length;Wt++)Cn=Je(Ht,Be,Wt,Ge[Wt],mt),Cn!==null&&(r&&Cn.alternate!==null&&Ht.delete(Cn.key===null?Wt:Cn.key),ze=P(Cn,ze,Wt),$n===null?en=Cn:$n.sibling=Cn,$n=Cn);return r&&Ht.forEach(function(Dl){return s(Be,Dl)}),En&&Gs(Be,Wt),en}function nn(Be,ze,Ge,mt){if(Ge==null)throw Error(S(151));for(var en=null,$n=null,Ht=ze,Wt=ze=0,Cn=null,Vn=Ge.next();Ht!==null&&!Vn.done;Wt++,Vn=Ge.next()){Ht.index>Wt?(Cn=Ht,Ht=null):Cn=Ht.sibling;var Dl=Ye(Be,Ht,Vn.value,mt);if(Dl===null){Ht===null&&(Ht=Cn);break}r&&Ht&&Dl.alternate===null&&s(Be,Ht),ze=P(Dl,ze,Wt),$n===null?en=Dl:$n.sibling=Dl,$n=Dl,Ht=Cn}if(Vn.done)return d(Be,Ht),En&&Gs(Be,Wt),en;if(Ht===null){for(;!Vn.done;Wt++,Vn=Ge.next())Vn=yt(Be,Vn.value,mt),Vn!==null&&(ze=P(Vn,ze,Wt),$n===null?en=Vn:$n.sibling=Vn,$n=Vn);return En&&Gs(Be,Wt),en}for(Ht=_(Ht);!Vn.done;Wt++,Vn=Ge.next())Vn=Je(Ht,Be,Wt,Vn.value,mt),Vn!==null&&(r&&Vn.alternate!==null&&Ht.delete(Vn.key===null?Wt:Vn.key),ze=P(Vn,ze,Wt),$n===null?en=Vn:$n.sibling=Vn,$n=Vn);return r&&Ht.forEach(function(Qm){return s(Be,Qm)}),En&&Gs(Be,Wt),en}function oi(Be,ze,Ge,mt){if(typeof Ge=="object"&&Ge!==null&&Ge.type===pe&&Ge.key===null&&(Ge=Ge.props.children),typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case Ae:e:{for(var en=Ge.key;ze!==null;){if(ze.key===en){if(en=Ge.type,en===pe){if(ze.tag===7){d(Be,ze.sibling),mt=M(ze,Ge.props.children),mt.return=Be,Be=mt;break e}}else if(ze.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===Ie&&za(en)===ze.type){d(Be,ze.sibling),mt=M(ze,Ge.props),Cs(mt,Ge),mt.return=Be,Be=mt;break e}d(Be,ze);break}else s(Be,ze);ze=ze.sibling}Ge.type===pe?(mt=To(Ge.props.children,Be.mode,mt,Ge.key),mt.return=Be,Be=mt):(mt=ih(Ge.type,Ge.key,Ge.props,null,Be.mode,mt),Cs(mt,Ge),mt.return=Be,Be=mt)}return V(Be);case Pe:e:{for(en=Ge.key;ze!==null;){if(ze.key===en)if(ze.tag===4&&ze.stateNode.containerInfo===Ge.containerInfo&&ze.stateNode.implementation===Ge.implementation){d(Be,ze.sibling),mt=M(ze,Ge.children||[]),mt.return=Be,Be=mt;break e}else{d(Be,ze);break}else s(Be,ze);ze=ze.sibling}mt=So(Ge,Be.mode,mt),mt.return=Be,Be=mt}return V(Be);case Ie:return Ge=za(Ge),oi(Be,ze,Ge,mt)}if(ut(Ge))return Zt(Be,ze,Ge,mt);if(Tt(Ge)){if(en=Tt(Ge),typeof en!="function")throw Error(S(150));return Ge=en.call(Ge),nn(Be,ze,Ge,mt)}if(typeof Ge.then=="function")return oi(Be,ze,ou(Ge),mt);if(Ge.$$typeof===it)return oi(Be,ze,ru(Be,Ge),mt);dh(Be,Ge)}return typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint"?(Ge=""+Ge,ze!==null&&ze.tag===6?(d(Be,ze.sibling),mt=M(ze,Ge),mt.return=Be,Be=mt):(d(Be,ze),mt=ld(Ge,Be.mode,mt),mt.return=Be,Be=mt),V(Be)):d(Be,ze)}return function(Be,ze,Ge,mt){try{cl=0;var en=oi(Be,ze,Ge,mt);return As=null,en}catch(Ht){if(Ht===Ya||Ht===Hr)throw Ht;var $n=ca(29,Ht,null,Be.mode);return $n.lanes=mt,$n.return=Be,$n}}}var zs=lu(!0),fd=lu(!1),Ds=!1;function fh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function cu(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Ps(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ks(r,s,d){var _=r.updateQueue;if(_===null)return null;if(_=_.shared,(ei&2)!==0){var M=_.pending;return M===null?s.next=s:(s.next=M.next,M.next=s),_.pending=s,s=Ql(r),od(r,null,d),s}return nu(r,_,s,d),Ql(r)}function Da(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194048)!==0)){var _=s.lanes;_&=r.pendingLanes,d|=_,s.lanes=d,ai(r,d)}}function jn(r,s){var d=r.updateQueue,_=r.alternate;if(_!==null&&(_=_.updateQueue,d===_)){var M=null,P=null;if(d=d.firstBaseUpdate,d!==null){do{var V={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};P===null?M=P=V:P=P.next=V,d=d.next}while(d!==null);P===null?M=P=s:P=P.next=s}else M=P=s;d={baseState:_.baseState,firstBaseUpdate:M,lastBaseUpdate:P,shared:_.shared,callbacks:_.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}var pd=!1;function Ws(){if(pd){var r=Er;if(r!==null)throw r}}function zo(r,s,d,_){pd=!1;var M=r.updateQueue;Ds=!1;var P=M.firstBaseUpdate,V=M.lastBaseUpdate,te=M.shared.pending;if(te!==null){M.shared.pending=null;var Me=te,Xe=Me.next;Me.next=null,V===null?P=Xe:V.next=Xe,V=Me;var ht=r.alternate;ht!==null&&(ht=ht.updateQueue,te=ht.lastBaseUpdate,te!==V&&(te===null?ht.firstBaseUpdate=Xe:te.next=Xe,ht.lastBaseUpdate=Me))}if(P!==null){var yt=M.baseState;V=0,ht=Xe=Me=null,te=P;do{var Ye=te.lane&-536870913,Je=Ye!==te.lane;if(Je?(In&Ye)===Ye:(_&Ye)===Ye){Ye!==0&&Ye===ll&&(pd=!0),ht!==null&&(ht=ht.next={lane:0,tag:te.tag,payload:te.payload,callback:null,next:null});e:{var Zt=r,nn=te;Ye=s;var oi=d;switch(nn.tag){case 1:if(Zt=nn.payload,typeof Zt=="function"){yt=Zt.call(oi,yt,Ye);break e}yt=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=nn.payload,Ye=typeof Zt=="function"?Zt.call(oi,yt,Ye):Zt,Ye==null)break e;yt=re({},yt,Ye);break e;case 2:Ds=!0}}Ye=te.callback,Ye!==null&&(r.flags|=64,Je&&(r.flags|=8192),Je=M.callbacks,Je===null?M.callbacks=[Ye]:Je.push(Ye))}else Je={lane:Ye,tag:te.tag,payload:te.payload,callback:te.callback,next:null},ht===null?(Xe=ht=Je,Me=yt):ht=ht.next=Je,V|=Ye;if(te=te.next,te===null){if(te=M.shared.pending,te===null)break;Je=te,te=Je.next,Je.next=null,M.lastBaseUpdate=Je,M.shared.pending=null}}while(!0);ht===null&&(Me=yt),M.baseState=Me,M.firstBaseUpdate=Xe,M.lastBaseUpdate=ht,P===null&&(M.shared.lanes=0),Tl|=V,r.lanes=V,r.memoizedState=yt}}function uu(r,s){if(typeof r!="function")throw Error(S(191,r));r.call(s)}function ph(r,s){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)uu(d[r],s)}var ul=we(null),hu=we(0);function md(r,s){r=wl,vt(hu,r),vt(ul,s),wl=r|s.baseLanes}function pa(){vt(hu,wl),vt(ul,ul.current)}function hl(){wl=hu.current,$e(ul),$e(hu)}var Bt=we(null),qt=null;function Pa(r){var s=r.alternate;vt(Ai,Ai.current&1),vt(Bt,r),qt===null&&(s===null||ul.current!==null||s.memoizedState!==null)&&(qt=r)}function ac(r){vt(Ai,Ai.current),vt(Bt,r),qt===null&&(qt=r)}function du(r){r.tag===22?(vt(Ai,Ai.current),vt(Bt,r),qt===null&&(qt=r)):Li()}function Li(){vt(Ai,Ai.current),vt(Bt,Bt.current)}function vi(r){$e(Bt),qt===r&&(qt=null),$e(Ai)}var Ai=we(0);function fu(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Kr(d)||Xi(d)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Qs=0,yn=null,Nn=null,mn=null,pi=!1,Ia=!1,Wa=!1,dl=0,fl=0,Js=null,gd=0;function li(){throw Error(S(321))}function Qa(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!Vr(r[d],s[d]))return!1;return!0}function sc(r,s,d,_,M,P){return Qs=P,yn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Te.H=r===null||r.memoizedState===null?Jn:Ui,Wa=!1,P=d(_,M),Wa=!1,Ia&&(P=pu(s,d,_,M)),oc(r),P}function oc(r){Te.H=Un;var s=Nn!==null&&Nn.next!==null;if(Qs=0,mn=Nn=yn=null,pi=!1,fl=0,Js=null,s)throw Error(S(300));r===null||lr||(r=r.dependencies,r!==null&&tc(r)&&(lr=!0))}function pu(r,s,d,_){yn=r;var M=0;do{if(Ia&&(Js=null),fl=0,Ia=!1,25<=M)throw Error(S(301));if(M+=1,mn=Nn=null,r.updateQueue!=null){var P=r.updateQueue;P.lastEffect=null,P.events=null,P.stores=null,P.memoCache!=null&&(P.memoCache.index=0)}Te.H=$i,P=s(d,_)}while(Ia);return P}function mu(){var r=Te.H,s=r.useState()[0];return s=typeof s.then=="function"?pl(s):s,r=r.useState()[0],(Nn!==null?Nn.memoizedState:null)!==r&&(yn.flags|=1024),s}function gu(){var r=dl!==0;return dl=0,r}function Do(r,s,d){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~d}function eo(r){if(pi){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}pi=!1}Qs=0,mn=Nn=yn=null,Ia=!1,fl=dl=0,Js=null}function gr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mn===null?yn.memoizedState=mn=r:mn=mn.next=r,mn}function mi(){if(Nn===null){var r=yn.alternate;r=r!==null?r.memoizedState:null}else r=Nn.next;var s=mn===null?yn.memoizedState:mn.next;if(s!==null)mn=s,Nn=r;else{if(r===null)throw yn.alternate===null?Error(S(467)):Error(S(310));Nn=r,r={memoizedState:Nn.memoizedState,baseState:Nn.baseState,baseQueue:Nn.baseQueue,queue:Nn.queue,next:null},mn===null?yn.memoizedState=mn=r:mn=mn.next=r}return mn}function Is(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function pl(r){var s=fl;return fl+=1,Js===null&&(Js=[]),r=uh(Js,r,s),s=yn,(mn===null?s.memoizedState:mn.next)===null&&(s=s.alternate,Te.H=s===null||s.memoizedState===null?Jn:Ui),r}function ml(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return pl(r);if(r.$$typeof===it)return ji(r)}throw Error(S(438,String(r)))}function lc(r){var s=null,d=yn.updateQueue;if(d!==null&&(s=d.memoCache),s==null){var _=yn.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(s={data:_.data.map(function(M){return M.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),d===null&&(d=Is(),yn.updateQueue=d),d.memoCache=s,d=s.data[s.index],d===void 0)for(d=s.data[s.index]=Array(r),_=0;_<r;_++)d[_]=tt;return s.index++,d}function Ja(r,s){return typeof s=="function"?s(r):s}function y(r){var s=mi();return t(s,Nn,r)}function t(r,s,d){var _=r.queue;if(_===null)throw Error(S(311));_.lastRenderedReducer=d;var M=r.baseQueue,P=_.pending;if(P!==null){if(M!==null){var V=M.next;M.next=P.next,P.next=V}s.baseQueue=M=P,_.pending=null}if(P=r.baseState,M===null)r.memoizedState=P;else{s=M.next;var te=V=null,Me=null,Xe=s,ht=!1;do{var yt=Xe.lane&-536870913;if(yt!==Xe.lane?(In&yt)===yt:(Qs&yt)===yt){var Ye=Xe.revertLane;if(Ye===0)Me!==null&&(Me=Me.next={lane:0,revertLane:0,gesture:null,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null}),yt===ll&&(ht=!0);else if((Qs&Ye)===Ye){Xe=Xe.next,Ye===ll&&(ht=!0);continue}else yt={lane:0,revertLane:Xe.revertLane,gesture:null,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null},Me===null?(te=Me=yt,V=P):Me=Me.next=yt,yn.lanes|=Ye,Tl|=Ye;yt=Xe.action,Wa&&d(P,yt),P=Xe.hasEagerState?Xe.eagerState:d(P,yt)}else Ye={lane:yt,revertLane:Xe.revertLane,gesture:Xe.gesture,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null},Me===null?(te=Me=Ye,V=P):Me=Me.next=Ye,yn.lanes|=yt,Tl|=yt;Xe=Xe.next}while(Xe!==null&&Xe!==s);if(Me===null?V=P:Me.next=te,!Vr(P,r.memoizedState)&&(lr=!0,ht&&(d=Er,d!==null)))throw d;r.memoizedState=P,r.baseState=V,r.baseQueue=Me,_.lastRenderedState=P}return M===null&&(_.lanes=0),[r.memoizedState,_.dispatch]}function a(r){var s=mi(),d=s.queue;if(d===null)throw Error(S(311));d.lastRenderedReducer=r;var _=d.dispatch,M=d.pending,P=s.memoizedState;if(M!==null){d.pending=null;var V=M=M.next;do P=r(P,V.action),V=V.next;while(V!==M);Vr(P,s.memoizedState)||(lr=!0),s.memoizedState=P,s.baseQueue===null&&(s.baseState=P),d.lastRenderedState=P}return[P,_]}function c(r,s,d){var _=yn,M=mi(),P=En;if(P){if(d===void 0)throw Error(S(407));d=d()}else d=s();var V=!Vr((Nn||M).memoizedState,d);if(V&&(M.memoizedState=d,lr=!0),M=M.queue,Ve(w.bind(null,_,M,r),[r]),M.getSnapshot!==s||V||mn!==null&&mn.memoizedState.tag&1){if(_.flags|=2048,me(9,{destroy:void 0},v.bind(null,_,M,d,s),null),gi===null)throw Error(S(349));P||(Qs&127)!==0||f(_,s,d)}return d}function f(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=yn.updateQueue,s===null?(s=Is(),yn.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function v(r,s,d,_){s.value=d,s.getSnapshot=_,E(s)&&D(r)}function w(r,s,d){return d(function(){E(s)&&D(r)})}function E(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!Vr(r,d)}catch{return!0}}function D(r){var s=Aa(r,2);s!==null&&Fa(s,r,2)}function R(r){var s=gr();if(typeof r=="function"){var d=r;if(r=d(),Wa){Oe(!0);try{d()}finally{Oe(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:r},s}function O(r,s,d,_){return r.baseState=d,t(r,Nn,typeof _=="function"?_:Ja)}function U(r,s,d,_,M){if(ma(r))throw Error(S(485));if(r=s.action,r!==null){var P={payload:M,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(V){P.listeners.push(V)}};Te.T!==null?d(!0):P.isTransition=!1,_(P),d=s.pending,d===null?(P.next=s.pending=P,j(s,P)):(P.next=d.next,s.pending=d.next=P)}}function j(r,s){var d=s.action,_=s.payload,M=r.state;if(s.isTransition){var P=Te.T,V={};Te.T=V;try{var te=d(M,_),Me=Te.S;Me!==null&&Me(V,te),Z(r,s,te)}catch(Xe){se(r,s,Xe)}finally{P!==null&&V.types!==null&&(P.types=V.types),Te.T=P}}else try{P=d(M,_),Z(r,s,P)}catch(Xe){se(r,s,Xe)}}function Z(r,s,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(_){W(r,s,_)},function(_){return se(r,s,_)}):W(r,s,d)}function W(r,s,d){s.status="fulfilled",s.value=d,le(s),r.state=d,s=r.pending,s!==null&&(d=s.next,d===s?r.pending=null:(d=d.next,s.next=d,j(r,d)))}function se(r,s,d){var _=r.pending;if(r.pending=null,_!==null){_=_.next;do s.status="rejected",s.reason=d,le(s),s=s.next;while(s!==_)}r.action=null}function le(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function oe(r,s){return s}function ue(r,s){if(En){var d=gi.formState;if(d!==null){e:{var _=yn;if(En){if(Wn){t:{for(var M=Wn,P=ha;M.nodeType!==8;){if(!P){M=null;break t}if(M=as(M.nextSibling),M===null){M=null;break t}}P=M.data,M=P==="F!"||P==="F"?M:null}if(M){Wn=as(M.nextSibling),_=M.data==="F!";break e}}Gr(_)}_=!1}_&&(s=d[0])}}return d=gr(),d.memoizedState=d.baseState=s,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oe,lastRenderedState:s},d.queue=_,d=cc.bind(null,yn,_),_.dispatch=d,_=R(!1),P=Xr.bind(null,yn,!1,_.queue),_=gr(),M={state:s,dispatch:null,action:r,pending:null},_.queue=M,d=U.bind(null,yn,M,P,d),M.dispatch=d,_.memoizedState=r,[s,d,!1]}function xe(r){var s=mi();return ce(s,Nn,r)}function ce(r,s,d){if(s=t(r,s,oe)[0],r=y(Ja)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var _=pl(s)}catch(V){throw V===Ya?Hr:V}else _=s;s=mi();var M=s.queue,P=M.dispatch;return d!==s.memoizedState&&(yn.flags|=2048,me(9,{destroy:void 0},_e.bind(null,M,d),null)),[_,P,r]}function _e(r,s){r.action=s}function Se(r){var s=mi(),d=Nn;if(d!==null)return ce(s,d,r);mi(),s=s.memoizedState,d=mi();var _=d.queue.dispatch;return d.memoizedState=r,[s,_,!1]}function me(r,s,d,_){return r={tag:r,create:d,deps:_,inst:s,next:null},s=yn.updateQueue,s===null&&(s=Is(),yn.updateQueue=s),d=s.lastEffect,d===null?s.lastEffect=r.next=r:(_=d.next,d.next=r,r.next=_,s.lastEffect=r),r}function Ce(){return mi().memoizedState}function qe(r,s,d,_){var M=gr();yn.flags|=r,M.memoizedState=me(1|s,{destroy:void 0},d,_===void 0?null:_)}function Fe(r,s,d,_){var M=mi();_=_===void 0?null:_;var P=M.memoizedState.inst;Nn!==null&&_!==null&&Qa(_,Nn.memoizedState.deps)?M.memoizedState=me(s,P,d,_):(yn.flags|=r,M.memoizedState=me(1|s,P,d,_))}function Ue(r,s){qe(8390656,8,r,s)}function Ve(r,s){Fe(2048,8,r,s)}function wt(r){yn.flags|=4;var s=yn.updateQueue;if(s===null)s=Is(),yn.updateQueue=s,s.events=[r];else{var d=s.events;d===null?s.events=[r]:d.push(r)}}function St(r){var s=mi().memoizedState;return wt({ref:s,nextImpl:r}),function(){if((ei&2)!==0)throw Error(S(440));return s.impl.apply(void 0,arguments)}}function dt(r,s){return Fe(4,2,r,s)}function Ct(r,s){return Fe(4,4,r,s)}function an(r,s){if(typeof s=="function"){r=r();var d=s(r);return function(){typeof d=="function"?d():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function Fn(r,s,d){d=d!=null?d.concat([r]):null,Fe(4,4,an.bind(null,s,r),d)}function ii(){}function Qn(r,s){var d=mi();s=s===void 0?null:s;var _=d.memoizedState;return s!==null&&Qa(s,_[1])?_[0]:(d.memoizedState=[r,s],r)}function ci(r,s){var d=mi();s=s===void 0?null:s;var _=d.memoizedState;if(s!==null&&Qa(s,_[1]))return _[0];if(_=r(),Wa){Oe(!0);try{r()}finally{Oe(!1)}}return d.memoizedState=[_,s],_}function Zn(r,s,d){return d===void 0||(Qs&1073741824)!==0&&(In&261930)===0?r.memoizedState=s:(r.memoizedState=d,r=Pg(),yn.lanes|=r,Tl|=r,d)}function xi(r,s,d,_){return Vr(d,s)?d:ul.current!==null?(r=Zn(r,d,_),Vr(r,s)||(lr=!0),r):(Qs&42)===0||(Qs&1073741824)!==0&&(In&261930)===0?(lr=!0,r.memoizedState=d):(r=Pg(),yn.lanes|=r,Tl|=r,s)}function ui(r,s,d,_,M){var P=He.p;He.p=P!==0&&8>P?P:8;var V=Te.T,te={};Te.T=te,Xr(r,!1,s,d);try{var Me=M(),Xe=Te.S;if(Xe!==null&&Xe(te,Me),Me!==null&&typeof Me=="object"&&typeof Me.then=="function"){var ht=au(Me,_);ts(r,s,ht,Na(r))}else ts(r,s,_,Na(r))}catch(yt){ts(r,s,{then:function(){},status:"rejected",reason:yt},Na())}finally{He.p=P,V!==null&&te.types!==null&&(V.types=te.types),Te.T=V}}function sr(){}function Ci(r,s,d,_){if(r.tag!==5)throw Error(S(476));var M=zi(r).queue;ui(r,M,s,pt,d===null?sr:function(){return or(r),d(_)})}function zi(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:pt,baseState:pt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:pt},next:null};var d={};return s.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:d},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function or(r){var s=zi(r);s.next===null&&(s=r.alternate.memoizedState),ts(r,s.next.queue,{},Na())}function ks(){return ji(Oh)}function Rs(){return mi().memoizedState}function es(){return mi().memoizedState}function $r(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var d=Na();r=Ps(d);var _=Ks(s,r,d);_!==null&&(Fa(_,s,d),Da(_,s,d)),s={cache:Ms()},r.payload=s;return}s=s.return}}function gl(r,s,d){var _=Na();d={lane:_,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},ma(r)?ka(s,d):(d=wo(r,s,d,_),d!==null&&(Fa(d,r,_),Ra(d,s,_)))}function cc(r,s,d){var _=Na();ts(r,s,d,_)}function ts(r,s,d,_){var M={lane:_,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(ma(r))ka(s,M);else{var P=r.alternate;if(r.lanes===0&&(P===null||P.lanes===0)&&(P=s.lastRenderedReducer,P!==null))try{var V=s.lastRenderedState,te=P(V,d);if(M.hasEagerState=!0,M.eagerState=te,Vr(te,V))return nu(r,s,M,0),gi===null&&al(),!1}catch{}if(d=wo(r,s,M,_),d!==null)return Fa(d,r,_),Ra(d,s,_),!0}return!1}function Xr(r,s,d,_){if(_={lane:2,revertLane:Em(),gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},ma(r)){if(s)throw Error(S(479))}else s=wo(r,d,_,2),s!==null&&Fa(s,r,2)}function ma(r){var s=r.alternate;return r===yn||s!==null&&s===yn}function ka(r,s){Ia=pi=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function Ra(r,s,d){if((d&4194048)!==0){var _=s.lanes;_&=r.pendingLanes,d|=_,s.lanes=d,ai(r,d)}}var Un={readContext:ji,use:ml,useCallback:li,useContext:li,useEffect:li,useImperativeHandle:li,useLayoutEffect:li,useInsertionEffect:li,useMemo:li,useReducer:li,useRef:li,useState:li,useDebugValue:li,useDeferredValue:li,useTransition:li,useSyncExternalStore:li,useId:li,useHostTransitionStatus:li,useFormState:li,useActionState:li,useOptimistic:li,useMemoCache:li,useCacheRefresh:li};Un.useEffectEvent=li;var Jn={readContext:ji,use:ml,useCallback:function(r,s){return gr().memoizedState=[r,s===void 0?null:s],r},useContext:ji,useEffect:Ue,useImperativeHandle:function(r,s,d){d=d!=null?d.concat([r]):null,qe(4194308,4,an.bind(null,s,r),d)},useLayoutEffect:function(r,s){return qe(4194308,4,r,s)},useInsertionEffect:function(r,s){qe(4,2,r,s)},useMemo:function(r,s){var d=gr();s=s===void 0?null:s;var _=r();if(Wa){Oe(!0);try{r()}finally{Oe(!1)}}return d.memoizedState=[_,s],_},useReducer:function(r,s,d){var _=gr();if(d!==void 0){var M=d(s);if(Wa){Oe(!0);try{d(s)}finally{Oe(!1)}}}else M=s;return _.memoizedState=_.baseState=M,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:M},_.queue=r,r=r.dispatch=gl.bind(null,yn,r),[_.memoizedState,r]},useRef:function(r){var s=gr();return r={current:r},s.memoizedState=r},useState:function(r){r=R(r);var s=r.queue,d=cc.bind(null,yn,s);return s.dispatch=d,[r.memoizedState,d]},useDebugValue:ii,useDeferredValue:function(r,s){var d=gr();return Zn(d,r,s)},useTransition:function(){var r=R(!1);return r=ui.bind(null,yn,r.queue,!0,!1),gr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,d){var _=yn,M=gr();if(En){if(d===void 0)throw Error(S(407));d=d()}else{if(d=s(),gi===null)throw Error(S(349));(In&127)!==0||f(_,s,d)}M.memoizedState=d;var P={value:d,getSnapshot:s};return M.queue=P,Ue(w.bind(null,_,P,r),[r]),_.flags|=2048,me(9,{destroy:void 0},v.bind(null,_,P,d,s),null),d},useId:function(){var r=gr(),s=gi.identifierPrefix;if(En){var d=qr,_=xs;d=(_&~(1<<32-Qe(_)-1)).toString(32)+d,s="_"+s+"R_"+d,d=dl++,0<d&&(s+="H"+d.toString(32)),s+="_"}else d=gd++,s="_"+s+"r_"+d.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:ks,useFormState:ue,useActionState:ue,useOptimistic:function(r){var s=gr();s.memoizedState=s.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=d,s=Xr.bind(null,yn,!0,d),d.dispatch=s,[r,s]},useMemoCache:lc,useCacheRefresh:function(){return gr().memoizedState=$r.bind(null,yn)},useEffectEvent:function(r){var s=gr(),d={impl:r};return s.memoizedState=d,function(){if((ei&2)!==0)throw Error(S(440));return d.impl.apply(void 0,arguments)}}},Ui={readContext:ji,use:ml,useCallback:Qn,useContext:ji,useEffect:Ve,useImperativeHandle:Fn,useInsertionEffect:dt,useLayoutEffect:Ct,useMemo:ci,useReducer:y,useRef:Ce,useState:function(){return y(Ja)},useDebugValue:ii,useDeferredValue:function(r,s){var d=mi();return xi(d,Nn.memoizedState,r,s)},useTransition:function(){var r=y(Ja)[0],s=mi().memoizedState;return[typeof r=="boolean"?r:pl(r),s]},useSyncExternalStore:c,useId:Rs,useHostTransitionStatus:ks,useFormState:xe,useActionState:xe,useOptimistic:function(r,s){var d=mi();return O(d,Nn,r,s)},useMemoCache:lc,useCacheRefresh:es};Ui.useEffectEvent=St;var $i={readContext:ji,use:ml,useCallback:Qn,useContext:ji,useEffect:Ve,useImperativeHandle:Fn,useInsertionEffect:dt,useLayoutEffect:Ct,useMemo:ci,useReducer:a,useRef:Ce,useState:function(){return a(Ja)},useDebugValue:ii,useDeferredValue:function(r,s){var d=mi();return Nn===null?Zn(d,r,s):xi(d,Nn.memoizedState,r,s)},useTransition:function(){var r=a(Ja)[0],s=mi().memoizedState;return[typeof r=="boolean"?r:pl(r),s]},useSyncExternalStore:c,useId:Rs,useHostTransitionStatus:ks,useFormState:Se,useActionState:Se,useOptimistic:function(r,s){var d=mi();return Nn!==null?O(d,Nn,r,s):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:lc,useCacheRefresh:es};$i.useEffectEvent=St;function mh(r,s,d,_){s=r.memoizedState,d=d(_,s),d=d==null?s:re({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var gh={enqueueSetState:function(r,s,d){r=r._reactInternals;var _=Na(),M=Ps(_);M.payload=s,d!=null&&(M.callback=d),s=Ks(r,M,_),s!==null&&(Fa(s,r,_),Da(s,r,_))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var _=Na(),M=Ps(_);M.tag=1,M.payload=s,d!=null&&(M.callback=d),s=Ks(r,M,_),s!==null&&(Fa(s,r,_),Da(s,r,_))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=Na(),_=Ps(d);_.tag=2,s!=null&&(_.callback=s),s=Ks(r,_,d),s!==null&&(Fa(s,r,d),Da(s,r,d))}};function Po(r,s,d,_,M,P,V){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(_,P,V):s.prototype&&s.prototype.isPureReactComponent?!bo(d,_)||!bo(M,P):!0}function Bf(r,s,d,_){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,_),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,_),s.state!==r&&gh.enqueueReplaceState(s,s.state,null)}function Io(r,s){var d=s;if("ref"in s){d={};for(var _ in s)_!=="ref"&&(d[_]=s[_])}if(r=r.defaultProps){d===s&&(d=re({},d));for(var M in r)d[M]===void 0&&(d[M]=r[M])}return d}function yh(r){_s(r)}function to(r){console.error(r)}function no(r){_s(r)}function ns(r,s){try{var d=r.onUncaughtError;d(s.value,{componentStack:s.stack})}catch(_){setTimeout(function(){throw _})}}function _h(r,s,d){try{var _=r.onCaughtError;_(d.value,{componentStack:d.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(M){setTimeout(function(){throw M})}}function yu(r,s,d){return d=Ps(d),d.tag=3,d.payload={element:null},d.callback=function(){ns(r,s)},d}function _u(r){return r=Ps(r),r.tag=3,r}function vu(r,s,d,_){var M=d.type.getDerivedStateFromError;if(typeof M=="function"){var P=_.value;r.payload=function(){return M(P)},r.callback=function(){_h(s,d,_)}}var V=d.stateNode;V!==null&&typeof V.componentDidCatch=="function"&&(r.callback=function(){_h(s,d,_),typeof M!="function"&&(Sl===null?Sl=new Set([this]):Sl.add(this));var te=_.stack;this.componentDidCatch(_.value,{componentStack:te!==null?te:""})})}function Nf(r,s,d,_,M){if(d.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(s=d.alternate,s!==null&&da(s,d,M,!0),d=Bt.current,d!==null){switch(d.tag){case 31:case 13:return qt===null?Ld():d.alternate===null&&Vi===0&&(Vi=3),d.flags&=-257,d.flags|=65536,d.lanes=M,_===Rt?d.flags|=16384:(s=d.updateQueue,s===null?d.updateQueue=new Set([_]):s.add(_),cp(r,_,M)),!1;case 22:return d.flags|=65536,_===Rt?d.flags|=16384:(s=d.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([_])},d.updateQueue=s):(d=s.retryQueue,d===null?s.retryQueue=new Set([_]):d.add(_)),cp(r,_,M)),!1}throw Error(S(435,d.tag))}return cp(r,_,M),Ld(),!1}if(En)return s=Bt.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=M,_!==_i&&(r=Error(S(422),{cause:_}),Hs(Fr(r,d)))):(_!==_i&&(s=Error(S(423),{cause:_}),Hs(Fr(s,d))),r=r.current.alternate,r.flags|=65536,M&=-M,r.lanes|=M,_=Fr(_,d),M=yu(r.stateNode,_,M),jn(r,M),Vi!==4&&(Vi=2)),!1;var P=Error(S(520),{cause:_});if(P=Fr(P,d),Pd===null?Pd=[P]:Pd.push(P),Vi!==4&&(Vi=2),s===null)return!0;_=Fr(_,d),d=s;do{switch(d.tag){case 3:return d.flags|=65536,r=M&-M,d.lanes|=r,r=yu(d.stateNode,_,r),jn(d,r),!1;case 1:if(s=d.type,P=d.stateNode,(d.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||P!==null&&typeof P.componentDidCatch=="function"&&(Sl===null||!Sl.has(P))))return d.flags|=65536,M&=-M,d.lanes|=M,M=_u(M),vu(M,r,d,_),jn(d,M),!1}d=d.return}while(d!==null);return!1}var Ff=Error(S(461)),lr=!1;function yr(r,s,d,_){s.child=r===null?fd(s,null,d,_):zs(s,r.child,d,_)}function pg(r,s,d,_,M){d=d.render;var P=s.ref;if("ref"in _){var V={};for(var te in _)te!=="ref"&&(V[te]=_[te])}else V=_;return Ys(s),_=sc(r,s,d,V,P,M),te=gu(),r!==null&&!lr?(Do(r,s,M),Ro(r,s,M)):(En&&te&&ol(s),s.flags|=1,yr(r,s,_,M),s.child)}function jf(r,s,d,_,M){if(r===null){var P=d.type;return typeof P=="function"&&!nh(P)&&P.defaultProps===void 0&&d.compare===null?(s.tag=15,s.type=P,em(r,s,P,_,M)):(r=ih(d.type,null,_,s,s.mode,M),r.ref=s.ref,r.return=s,s.child=r)}if(P=r.child,!vd(r,M)){var V=P.memoizedProps;if(d=d.compare,d=d!==null?d:bo,d(V,_)&&r.ref===s.ref)return Ro(r,s,M)}return s.flags|=1,r=ua(P,_),r.ref=s.ref,r.return=s,s.child=r}function em(r,s,d,_,M){if(r!==null){var P=r.memoizedProps;if(bo(P,_)&&r.ref===s.ref)if(lr=!1,s.pendingProps=_=P,vd(r,M))(r.flags&131072)!==0&&(lr=!0);else return s.lanes=r.lanes,Ro(r,s,M)}return nm(r,s,d,_,M)}function tm(r,s,d,_){var M=_.children,P=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.mode==="hidden"){if((s.flags&128)!==0){if(P=P!==null?P.baseLanes|d:d,r!==null){for(_=s.child=r.child,M=0;_!==null;)M=M|_.lanes|_.childLanes,_=_.sibling;_=M&~P}else _=0,s.child=null;return mg(r,s,P,d,_)}if((d&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&ch(s,P!==null?P.cachePool:null),P!==null?md(s,P):pa(),du(s);else return _=s.lanes=536870912,mg(r,s,P!==null?P.baseLanes|d:d,d,_)}else P!==null?(ch(s,P.cachePool),md(s,P),Li(),s.memoizedState=null):(r!==null&&ch(s,null),pa(),Li());return yr(r,s,M,d),s.child}function ko(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function mg(r,s,d,_,M){var P=lh();return P=P===null?null:{parent:Ri._currentValue,pool:P},s.memoizedState={baseLanes:d,cachePool:P},r!==null&&ch(s,null),pa(),du(s),r!==null&&da(r,s,_,!0),s.childLanes=M,null}function yl(r,s){return s=Zf({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function yd(r,s,d){return zs(s,r.child,null,d),r=yl(s,s.pendingProps),r.flags|=2,vi(s),s.memoizedState=null,r}function Uf(r,s,d){var _=s.pendingProps,M=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(En){if(_.mode==="hidden")return r=yl(s,_),s.lanes=536870912,ko(null,r);if(ac(s),(r=Wn)?(r=vc(r,ha),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:vs!==null?{id:xs,overflow:qr}:null,retryLane:536870912,hydrationErrors:null},d=rh(r),d.return=s,s.child=d,ar=s,Wn=null)):r=null,r===null)throw Gr(s);return s.lanes=536870912,null}return yl(s,_)}var P=r.memoizedState;if(P!==null){var V=P.dehydrated;if(ac(s),M)if(s.flags&256)s.flags&=-257,s=yd(r,s,d);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(S(558));else if(lr||da(r,s,d,!1),M=(d&r.childLanes)!==0,lr||M){if(_=gi,_!==null&&(V=Bl(_,d),V!==0&&V!==P.retryLane))throw P.retryLane=V,Aa(r,V),Fa(_,r,V),Ff;Ld(),s=yd(r,s,d)}else r=P.treeContext,Wn=as(V.nextSibling),ar=s,En=!0,Zs=null,ha=!1,r!==null&&ud(s,r),s=yl(s,_),s.flags|=4096;return s}return r=ua(r.child,{mode:_.mode,children:_.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Vf(r,s){var d=s.ref;if(d===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(S(284));(r===null||r.ref!==d)&&(s.flags|=4194816)}}function nm(r,s,d,_,M){return Ys(s),d=sc(r,s,d,_,void 0,M),_=gu(),r!==null&&!lr?(Do(r,s,M),Ro(r,s,M)):(En&&_&&ol(s),s.flags|=1,yr(r,s,d,M),s.child)}function gg(r,s,d,_,M,P){return Ys(s),s.updateQueue=null,d=pu(s,_,d,M),oc(r),_=gu(),r!==null&&!lr?(Do(r,s,P),Ro(r,s,P)):(En&&_&&ol(s),s.flags|=1,yr(r,s,d,P),s.child)}function yg(r,s,d,_,M){if(Ys(s),s.stateNode===null){var P=hn,V=d.contextType;typeof V=="object"&&V!==null&&(P=ji(V)),P=new d(_,P),s.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,P.updater=gh,s.stateNode=P,P._reactInternals=s,P=s.stateNode,P.props=_,P.state=s.memoizedState,P.refs={},fh(s),V=d.contextType,P.context=typeof V=="object"&&V!==null?ji(V):hn,P.state=s.memoizedState,V=d.getDerivedStateFromProps,typeof V=="function"&&(mh(s,d,V,_),P.state=s.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(V=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),V!==P.state&&gh.enqueueReplaceState(P,P.state,null),zo(s,_,P,M),Ws(),P.state=s.memoizedState),typeof P.componentDidMount=="function"&&(s.flags|=4194308),_=!0}else if(r===null){P=s.stateNode;var te=s.memoizedProps,Me=Io(d,te);P.props=Me;var Xe=P.context,ht=d.contextType;V=hn,typeof ht=="object"&&ht!==null&&(V=ji(ht));var yt=d.getDerivedStateFromProps;ht=typeof yt=="function"||typeof P.getSnapshotBeforeUpdate=="function",te=s.pendingProps!==te,ht||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(te||Xe!==V)&&Bf(s,P,_,V),Ds=!1;var Ye=s.memoizedState;P.state=Ye,zo(s,_,P,M),Ws(),Xe=s.memoizedState,te||Ye!==Xe||Ds?(typeof yt=="function"&&(mh(s,d,yt,_),Xe=s.memoizedState),(Me=Ds||Po(s,d,Me,_,Ye,Xe,V))?(ht||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(s.flags|=4194308)):(typeof P.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=_,s.memoizedState=Xe),P.props=_,P.state=Xe,P.context=V,_=Me):(typeof P.componentDidMount=="function"&&(s.flags|=4194308),_=!1)}else{P=s.stateNode,cu(r,s),V=s.memoizedProps,ht=Io(d,V),P.props=ht,yt=s.pendingProps,Ye=P.context,Xe=d.contextType,Me=hn,typeof Xe=="object"&&Xe!==null&&(Me=ji(Xe)),te=d.getDerivedStateFromProps,(Xe=typeof te=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(V!==yt||Ye!==Me)&&Bf(s,P,_,Me),Ds=!1,Ye=s.memoizedState,P.state=Ye,zo(s,_,P,M),Ws();var Je=s.memoizedState;V!==yt||Ye!==Je||Ds||r!==null&&r.dependencies!==null&&tc(r.dependencies)?(typeof te=="function"&&(mh(s,d,te,_),Je=s.memoizedState),(ht=Ds||Po(s,d,ht,_,Ye,Je,Me)||r!==null&&r.dependencies!==null&&tc(r.dependencies))?(Xe||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(_,Je,Me),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(_,Je,Me)),typeof P.componentDidUpdate=="function"&&(s.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof P.componentDidUpdate!="function"||V===r.memoizedProps&&Ye===r.memoizedState||(s.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||V===r.memoizedProps&&Ye===r.memoizedState||(s.flags|=1024),s.memoizedProps=_,s.memoizedState=Je),P.props=_,P.state=Je,P.context=Me,_=ht):(typeof P.componentDidUpdate!="function"||V===r.memoizedProps&&Ye===r.memoizedState||(s.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||V===r.memoizedProps&&Ye===r.memoizedState||(s.flags|=1024),_=!1)}return P=_,Vf(r,s),_=(s.flags&128)!==0,P||_?(P=s.stateNode,d=_&&typeof d.getDerivedStateFromError!="function"?null:P.render(),s.flags|=1,r!==null&&_?(s.child=zs(s,r.child,null,M),s.child=zs(s,null,d,M)):yr(r,s,d,M),s.memoizedState=P.state,r=s.child):r=Ro(r,s,M),r}function _g(r,s,d,_){return ws(),s.flags|=256,yr(r,s,d,_),s.child}var qf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _d(r){return{baseLanes:r,cachePool:Of()}}function Gf(r,s,d){return r=r!==null?r.childLanes&~d:0,s&&(r|=jr),r}function im(r,s,d){var _=s.pendingProps,M=!1,P=(s.flags&128)!==0,V;if((V=P)||(V=r!==null&&r.memoizedState===null?!1:(Ai.current&2)!==0),V&&(M=!0,s.flags&=-129),V=(s.flags&32)!==0,s.flags&=-33,r===null){if(En){if(M?Pa(s):Li(),(r=Wn)?(r=vc(r,ha),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:vs!==null?{id:xs,overflow:qr}:null,retryLane:536870912,hydrationErrors:null},d=rh(r),d.return=s,s.child=d,ar=s,Wn=null)):r=null,r===null)throw Gr(s);return Xi(r)?s.lanes=32:s.lanes=536870912,null}var te=_.children;return _=_.fallback,M?(Li(),M=s.mode,te=Zf({mode:"hidden",children:te},M),_=To(_,M,d,null),te.return=s,_.return=s,te.sibling=_,s.child=te,_=s.child,_.memoizedState=_d(d),_.childLanes=Gf(r,V,d),s.memoizedState=qf,ko(null,_)):(Pa(s),rm(s,te))}var Me=r.memoizedState;if(Me!==null&&(te=Me.dehydrated,te!==null)){if(P)s.flags&256?(Pa(s),s.flags&=-257,s=Hf(r,s,d)):s.memoizedState!==null?(Li(),s.child=r.child,s.flags|=128,s=null):(Li(),te=_.fallback,M=s.mode,_=Zf({mode:"visible",children:_.children},M),te=To(te,M,d,null),te.flags|=2,_.return=s,te.return=s,_.sibling=te,s.child=_,zs(s,r.child,null,d),_=s.child,_.memoizedState=_d(d),_.childLanes=Gf(r,V,d),s.memoizedState=qf,s=ko(null,_));else if(Pa(s),Xi(te)){if(V=te.nextSibling&&te.nextSibling.dataset,V)var Xe=V.dgst;V=Xe,_=Error(S(419)),_.stack="",_.digest=V,Hs({value:_,source:null,stack:null}),s=Hf(r,s,d)}else if(lr||da(r,s,d,!1),V=(d&r.childLanes)!==0,lr||V){if(V=gi,V!==null&&(_=Bl(V,d),_!==0&&_!==Me.retryLane))throw Me.retryLane=_,Aa(r,_),Fa(V,r,_),Ff;Kr(te)||Ld(),s=Hf(r,s,d)}else Kr(te)?(s.flags|=192,s.child=r.child,s=null):(r=Me.treeContext,Wn=as(te.nextSibling),ar=s,En=!0,Zs=null,ha=!1,r!==null&&ud(s,r),s=rm(s,_.children),s.flags|=4096);return s}return M?(Li(),te=_.fallback,M=s.mode,Me=r.child,Xe=Me.sibling,_=ua(Me,{mode:"hidden",children:_.children}),_.subtreeFlags=Me.subtreeFlags&65011712,Xe!==null?te=ua(Xe,te):(te=To(te,M,d,null),te.flags|=2),te.return=s,_.return=s,_.sibling=te,s.child=_,ko(null,_),_=s.child,te=r.child.memoizedState,te===null?te=_d(d):(M=te.cachePool,M!==null?(Me=Ri._currentValue,M=M.parent!==Me?{parent:Me,pool:Me}:M):M=Of(),te={baseLanes:te.baseLanes|d,cachePool:M}),_.memoizedState=te,_.childLanes=Gf(r,V,d),s.memoizedState=qf,ko(r.child,_)):(Pa(s),d=r.child,r=d.sibling,d=ua(d,{mode:"visible",children:_.children}),d.return=s,d.sibling=null,r!==null&&(V=s.deletions,V===null?(s.deletions=[r],s.flags|=16):V.push(r)),s.child=d,s.memoizedState=null,d)}function rm(r,s){return s=Zf({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Zf(r,s){return r=ca(22,r,null,s),r.lanes=0,r}function Hf(r,s,d){return zs(s,r.child,null,d),r=rm(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function am(r,s,d){r.lanes|=s;var _=r.alternate;_!==null&&(_.lanes|=s),ah(r.return,s,d)}function sm(r,s,d,_,M,P){var V=r.memoizedState;V===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:_,tail:d,tailMode:M,treeForkCount:P}:(V.isBackwards=s,V.rendering=null,V.renderingStartTime=0,V.last=_,V.tail=d,V.tailMode=M,V.treeForkCount=P)}function $f(r,s,d){var _=s.pendingProps,M=_.revealOrder,P=_.tail;_=_.children;var V=Ai.current,te=(V&2)!==0;if(te?(V=V&1|2,s.flags|=128):V&=1,vt(Ai,V),yr(r,s,_,d),_=En?Ao:0,!te&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&am(r,d,s);else if(r.tag===19)am(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(M){case"forwards":for(d=s.child,M=null;d!==null;)r=d.alternate,r!==null&&fu(r)===null&&(M=d),d=d.sibling;d=M,d===null?(M=s.child,s.child=null):(M=d.sibling,d.sibling=null),sm(s,!1,M,d,P,_);break;case"backwards":case"unstable_legacy-backwards":for(d=null,M=s.child,s.child=null;M!==null;){if(r=M.alternate,r!==null&&fu(r)===null){s.child=M;break}r=M.sibling,M.sibling=d,d=M,M=r}sm(s,!0,d,null,P,_);break;case"together":sm(s,!1,null,null,void 0,_);break;default:s.memoizedState=null}return s.child}function Ro(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),Tl|=s.lanes,(d&s.childLanes)===0)if(r!==null){if(da(r,s,d,!1),(d&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(S(153));if(s.child!==null){for(r=s.child,d=ua(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=ua(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function vd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&tc(r)))}function xd(r,s,d){switch(s.tag){case 3:rn(s,s.stateNode.containerInfo),Xs(s,Ri,r.memoizedState.cache),ws();break;case 27:case 5:on(s);break;case 4:rn(s,s.stateNode.containerInfo);break;case 10:Xs(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,ac(s),null;break;case 13:var _=s.memoizedState;if(_!==null)return _.dehydrated!==null?(Pa(s),s.flags|=128,null):(d&s.child.childLanes)!==0?im(r,s,d):(Pa(s),r=Ro(r,s,d),r!==null?r.sibling:null);Pa(s);break;case 19:var M=(r.flags&128)!==0;if(_=(d&s.childLanes)!==0,_||(da(r,s,d,!1),_=(d&s.childLanes)!==0),M){if(_)return $f(r,s,d);s.flags|=128}if(M=s.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),vt(Ai,Ai.current),_)break;return null;case 22:return s.lanes=0,tm(r,s,d,s.pendingProps);case 24:Xs(s,Ri,r.memoizedState.cache)}return Ro(r,s,d)}function Yr(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps)lr=!0;else{if(!vd(r,d)&&(s.flags&128)===0)return lr=!1,xd(r,s,d);lr=(r.flags&131072)!==0}else lr=!1,En&&(s.flags&1048576)!==0&&cd(s,Ao,s.index);switch(s.lanes=0,s.tag){case 16:e:{var _=s.pendingProps;if(r=za(s.elementType),s.type=r,typeof r=="function")nh(r)?(_=Io(r,_),s.tag=1,s=yg(null,s,r,_,d)):(s.tag=0,s=nm(null,s,r,_,d));else{if(r!=null){var M=r.$$typeof;if(M===Dt){s.tag=11,s=pg(null,s,r,_,d);break e}else if(M===at){s.tag=14,s=jf(null,s,r,_,d);break e}}throw s=Gt(r)||r,Error(S(306,s,""))}}return s;case 0:return nm(r,s,s.type,s.pendingProps,d);case 1:return _=s.type,M=Io(_,s.pendingProps),yg(r,s,_,M,d);case 3:e:{if(rn(s,s.stateNode.containerInfo),r===null)throw Error(S(387));_=s.pendingProps;var P=s.memoizedState;M=P.element,cu(r,s),zo(s,_,null,d);var V=s.memoizedState;if(_=V.cache,Xs(s,Ri,_),_!==P.cache&&sh(s,[Ri],d,!0),Ws(),_=V.element,P.isDehydrated)if(P={element:_,isDehydrated:!1,cache:V.cache},s.updateQueue.baseState=P,s.memoizedState=P,s.flags&256){s=_g(r,s,_,d);break e}else if(_!==M){M=Fr(Error(S(424)),s),Hs(M),s=_g(r,s,_,d);break e}else for(r=s.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Wn=as(r.firstChild),ar=s,En=!0,Zs=null,ha=!0,d=fd(s,null,_,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(ws(),_===M){s=Ro(r,s,d);break e}yr(r,s,_,d)}s=s.child}return s;case 26:return Vf(r,s),r===null?(d=jm(s.type,null,s.pendingProps,null))?s.memoizedState=d:En||(d=s.type,r=s.pendingProps,_=Ud(Xt.current).createElement(d),_[ni]=s,_[At]=r,vr(_,d,r),Si(_),s.stateNode=_):s.memoizedState=jm(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return on(s),r===null&&En&&(_=s.stateNode=Qg(s.type,s.pendingProps,Xt.current),ar=s,ha=!0,M=Wn,_c(s.type)?(va=M,Wn=as(_.firstChild)):Wn=M),yr(r,s,s.pendingProps.children,d),Vf(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&En&&((M=_=Wn)&&(_=Mr(_,s.type,s.pendingProps,ha),_!==null?(s.stateNode=_,ar=s,Wn=as(_.firstChild),ha=!1,M=!0):M=!1),M||Gr(s)),on(s),M=s.type,P=s.pendingProps,V=r!==null?r.memoizedProps:null,_=P.children,xp(M,P)?_=null:V!==null&&xp(M,V)&&(s.flags|=32),s.memoizedState!==null&&(M=sc(r,s,mu,null,null,d),Oh._currentValue=M),Vf(r,s),yr(r,s,_,d),s.child;case 6:return r===null&&En&&((r=d=Wn)&&(d=oo(d,s.pendingProps,ha),d!==null?(s.stateNode=d,ar=s,Wn=null,r=!0):r=!1),r||Gr(s)),null;case 13:return im(r,s,d);case 4:return rn(s,s.stateNode.containerInfo),_=s.pendingProps,r===null?s.child=zs(s,null,_,d):yr(r,s,_,d),s.child;case 11:return pg(r,s,s.type,s.pendingProps,d);case 7:return yr(r,s,s.pendingProps,d),s.child;case 8:return yr(r,s,s.pendingProps.children,d),s.child;case 12:return yr(r,s,s.pendingProps.children,d),s.child;case 10:return _=s.pendingProps,Xs(s,s.type,_.value),yr(r,s,_.children,d),s.child;case 9:return M=s.type._context,_=s.pendingProps.children,Ys(s),M=ji(M),_=_(M),s.flags|=1,yr(r,s,_,d),s.child;case 14:return jf(r,s,s.type,s.pendingProps,d);case 15:return em(r,s,s.type,s.pendingProps,d);case 19:return $f(r,s,d);case 31:return Uf(r,s,d);case 22:return tm(r,s,d,s.pendingProps);case 24:return Ys(s),_=ji(Ri),r===null?(M=lh(),M===null&&(M=gi,P=Ms(),M.pooledCache=P,P.refCount++,P!==null&&(M.pooledCacheLanes|=d),M=P),s.memoizedState={parent:_,cache:M},fh(s),Xs(s,Ri,M)):((r.lanes&d)!==0&&(cu(r,s),zo(s,null,null,d),Ws()),M=r.memoizedState,P=s.memoizedState,M.parent!==_?(M={parent:_,cache:_},s.memoizedState=M,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=M),Xs(s,Ri,_)):(_=P.cache,Xs(s,Ri,_),_!==M.cache&&sh(s,[Ri],d,!0))),yr(r,s,s.pendingProps.children,d),s.child;case 29:throw s.pendingProps}throw Error(S(156,s.tag))}function Lo(r){r.flags|=4}function bd(r,s,d,_,M){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(M&335544128)===M)if(r.stateNode.complete)r.flags|=8192;else if(_m())r.flags|=8192;else throw Ka=Rt,Co}else r.flags&=-16777217}function vg(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Zd(s))if(_m())r.flags|=8192;else throw Ka=Rt,Co}function wd(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?tn():536870912,r.lanes|=s,Su|=s)}function Td(r,s){if(!En)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:_.sibling=null}}function Di(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,_=0;if(s)for(var M=r.child;M!==null;)d|=M.lanes|M.childLanes,_|=M.subtreeFlags&65011712,_|=M.flags&65011712,M.return=r,M=M.sibling;else for(M=r.child;M!==null;)d|=M.lanes|M.childLanes,_|=M.subtreeFlags,_|=M.flags,M.return=r,M=M.sibling;return r.subtreeFlags|=_,r.childLanes=d,s}function xg(r,s,d){var _=s.pendingProps;switch(ec(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Di(s),null;case 1:return Di(s),null;case 3:return d=s.stateNode,_=null,r!==null&&(_=r.memoizedState.cache),s.memoizedState.cache!==_&&(s.flags|=2048),Es(Ri),Yt(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(bs(s)?Lo(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Ts())),Di(s),null;case 26:var M=s.type,P=s.memoizedState;return r===null?(Lo(s),P!==null?(Di(s),vg(s,P)):(Di(s),bd(s,M,null,_,d))):P?P!==r.memoizedState?(Lo(s),Di(s),vg(s,P)):(Di(s),s.flags&=-16777217):(r=r.memoizedProps,r!==_&&Lo(s),Di(s),bd(s,M,r,_,d)),null;case 27:if(xn(s),d=Xt.current,M=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&Lo(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return Di(s),null}r=Pt.current,bs(s)?Zr(s):(r=Qg(M,_,d),s.stateNode=r,Lo(s))}return Di(s),null;case 5:if(xn(s),M=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&Lo(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return Di(s),null}if(P=Pt.current,bs(s))Zr(s);else{var V=Ud(Xt.current);switch(P){case 1:P=V.createElementNS("http://www.w3.org/2000/svg",M);break;case 2:P=V.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;default:switch(M){case"svg":P=V.createElementNS("http://www.w3.org/2000/svg",M);break;case"math":P=V.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;case"script":P=V.createElement("div"),P.innerHTML="<script><\/script>",P=P.removeChild(P.firstChild);break;case"select":P=typeof _.is=="string"?V.createElement("select",{is:_.is}):V.createElement("select"),_.multiple?P.multiple=!0:_.size&&(P.size=_.size);break;default:P=typeof _.is=="string"?V.createElement(M,{is:_.is}):V.createElement(M)}}P[ni]=s,P[At]=_;e:for(V=s.child;V!==null;){if(V.tag===5||V.tag===6)P.appendChild(V.stateNode);else if(V.tag!==4&&V.tag!==27&&V.child!==null){V.child.return=V,V=V.child;continue}if(V===s)break e;for(;V.sibling===null;){if(V.return===null||V.return===s)break e;V=V.return}V.sibling.return=V.return,V=V.sibling}s.stateNode=P;e:switch(vr(P,M,_),M){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}_&&Lo(s)}}return Di(s),bd(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,d),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==_&&Lo(s);else{if(typeof _!="string"&&s.stateNode===null)throw Error(S(166));if(r=Xt.current,bs(s)){if(r=s.stateNode,d=s.memoizedProps,_=null,M=ar,M!==null)switch(M.tag){case 27:case 5:_=M.memoizedProps}r[ni]=s,r=!!(r.nodeValue===d||_!==null&&_.suppressHydrationWarning===!0||Dm(r.nodeValue,d)),r||Gr(s,!0)}else r=Ud(r).createTextNode(_),r[ni]=s,s.stateNode=r}return Di(s),null;case 31:if(d=s.memoizedState,r===null||r.memoizedState!==null){if(_=bs(s),d!==null){if(r===null){if(!_)throw Error(S(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(557));r[ni]=s}else ws(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Di(s),r=!1}else d=Ts(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return s.flags&256?(vi(s),s):(vi(s),null);if((s.flags&128)!==0)throw Error(S(558))}return Di(s),null;case 13:if(_=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(M=bs(s),_!==null&&_.dehydrated!==null){if(r===null){if(!M)throw Error(S(318));if(M=s.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(S(317));M[ni]=s}else ws(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Di(s),M=!1}else M=Ts(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=M),M=!0;if(!M)return s.flags&256?(vi(s),s):(vi(s),null)}return vi(s),(s.flags&128)!==0?(s.lanes=d,s):(d=_!==null,r=r!==null&&r.memoizedState!==null,d&&(_=s.child,M=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(M=_.alternate.memoizedState.cachePool.pool),P=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(P=_.memoizedState.cachePool.pool),P!==M&&(_.flags|=2048)),d!==r&&d&&(s.child.flags|=8192),wd(s,s.updateQueue),Di(s),null);case 4:return Yt(),r===null&&Cm(s.stateNode.containerInfo),Di(s),null;case 10:return Es(s.type),Di(s),null;case 19:if($e(Ai),_=s.memoizedState,_===null)return Di(s),null;if(M=(s.flags&128)!==0,P=_.rendering,P===null)if(M)Td(_,!1);else{if(Vi!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(P=fu(r),P!==null){for(s.flags|=128,Td(_,!1),r=P.updateQueue,s.updateQueue=r,wd(s,r),s.subtreeFlags=0,r=d,d=s.child;d!==null;)Rf(d,r),d=d.sibling;return vt(Ai,Ai.current&1|2),En&&Gs(s,_.treeForkCount),s.child}r=r.sibling}_.tail!==null&&Ti()>Id&&(s.flags|=128,M=!0,Td(_,!1),s.lanes=4194304)}else{if(!M)if(r=fu(P),r!==null){if(s.flags|=128,M=!0,r=r.updateQueue,s.updateQueue=r,wd(s,r),Td(_,!0),_.tail===null&&_.tailMode==="hidden"&&!P.alternate&&!En)return Di(s),null}else 2*Ti()-_.renderingStartTime>Id&&d!==536870912&&(s.flags|=128,M=!0,Td(_,!1),s.lanes=4194304);_.isBackwards?(P.sibling=s.child,s.child=P):(r=_.last,r!==null?r.sibling=P:s.child=P,_.last=P)}return _.tail!==null?(r=_.tail,_.rendering=r,_.tail=r.sibling,_.renderingStartTime=Ti(),r.sibling=null,d=Ai.current,vt(Ai,M?d&1|2:d&1),En&&Gs(s,_.treeForkCount),r):(Di(s),null);case 22:case 23:return vi(s),hl(),_=s.memoizedState!==null,r!==null?r.memoizedState!==null!==_&&(s.flags|=8192):_&&(s.flags|=8192),_?(d&536870912)!==0&&(s.flags&128)===0&&(Di(s),s.subtreeFlags&6&&(s.flags|=8192)):Di(s),d=s.updateQueue,d!==null&&wd(s,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),_=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),_!==d&&(s.flags|=2048),r!==null&&$e(Xa),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Es(Ri),Di(s),null;case 25:return null;case 30:return null}throw Error(S(156,s.tag))}function Ky(r,s){switch(ec(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Es(Ri),Yt(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return xn(s),null;case 31:if(s.memoizedState!==null){if(vi(s),s.alternate===null)throw Error(S(340));ws()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(vi(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(S(340));ws()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return $e(Ai),null;case 4:return Yt(),null;case 10:return Es(s.type),null;case 22:case 23:return vi(s),hl(),r!==null&&$e(Xa),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Es(Ri),null;case 25:return null;default:return null}}function Xf(r,s){switch(ec(s),s.tag){case 3:Es(Ri),Yt();break;case 26:case 27:case 5:xn(s);break;case 4:Yt();break;case 31:s.memoizedState!==null&&vi(s);break;case 13:vi(s);break;case 19:$e(Ai);break;case 10:Es(s.type);break;case 22:case 23:vi(s),hl(),r!==null&&$e(Xa);break;case 24:Es(Ri)}}function vh(r,s){try{var d=s.updateQueue,_=d!==null?d.lastEffect:null;if(_!==null){var M=_.next;d=M;do{if((d.tag&r)===r){_=void 0;var P=d.create,V=d.inst;_=P(),V.destroy=_}d=d.next}while(d!==M)}}catch(te){ti(s,s.return,te)}}function _l(r,s,d){try{var _=s.updateQueue,M=_!==null?_.lastEffect:null;if(M!==null){var P=M.next;_=P;do{if((_.tag&r)===r){var V=_.inst,te=V.destroy;if(te!==void 0){V.destroy=void 0,M=s;var Me=d,Xe=te;try{Xe()}catch(ht){ti(M,Me,ht)}}}_=_.next}while(_!==P)}}catch(ht){ti(s,s.return,ht)}}function bg(r){var s=r.updateQueue;if(s!==null){var d=r.stateNode;try{ph(s,d)}catch(_){ti(r,r.return,_)}}}function wg(r,s,d){d.props=Io(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(_){ti(r,s,_)}}function Sd(r,s){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var _=r.stateNode;break;case 30:_=r.stateNode;break;default:_=r.stateNode}typeof d=="function"?r.refCleanup=d(_):d.current=_}}catch(M){ti(r,s,M)}}function is(r,s){var d=r.ref,_=r.refCleanup;if(d!==null)if(typeof _=="function")try{_()}catch(M){ti(r,s,M)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(M){ti(r,s,M)}else d.current=null}function Yf(r){var s=r.type,d=r.memoizedProps,_=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":d.autoFocus&&_.focus();break e;case"img":d.src?_.src=d.src:d.srcSet&&(_.srcset=d.srcSet)}}catch(M){ti(r,r.return,M)}}function Kf(r,s,d){try{var _=r.stateNode;Kg(_,r.type,d,s),_[At]=s}catch(M){ti(r,r.return,M)}}function uc(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&_c(r.type)||r.tag===4}function xu(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||uc(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&_c(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function om(r,s,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,s):(s=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,s.appendChild(r),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=Ha));else if(_!==4&&(_===27&&_c(r.type)&&(d=r.stateNode,s=null),r=r.child,r!==null))for(om(r,s,d),r=r.sibling;r!==null;)om(r,s,d),r=r.sibling}function Wf(r,s,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(_!==4&&(_===27&&_c(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(Wf(r,s,d),r=r.sibling;r!==null;)Wf(r,s,d),r=r.sibling}function Tg(r){var s=r.stateNode,d=r.memoizedProps;try{for(var _=r.type,M=s.attributes;M.length;)s.removeAttributeNode(M[0]);vr(s,_,d),s[ni]=r,s[At]=d}catch(P){ti(r,r.return,P)}}var vl=!1,cr=!1,lm=!1,Sg=typeof WeakSet=="function"?WeakSet:Set,ur=null;function Wy(r,s){if(r=r.containerInfo,jd=Kd,r=Ku(r),Kc(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var _=d.getSelection&&d.getSelection();if(_&&_.rangeCount!==0){d=_.anchorNode;var M=_.anchorOffset,P=_.focusNode;_=_.focusOffset;try{d.nodeType,P.nodeType}catch{d=null;break e}var V=0,te=-1,Me=-1,Xe=0,ht=0,yt=r,Ye=null;t:for(;;){for(var Je;yt!==d||M!==0&&yt.nodeType!==3||(te=V+M),yt!==P||_!==0&&yt.nodeType!==3||(Me=V+_),yt.nodeType===3&&(V+=yt.nodeValue.length),(Je=yt.firstChild)!==null;)Ye=yt,yt=Je;for(;;){if(yt===r)break t;if(Ye===d&&++Xe===M&&(te=V),Ye===P&&++ht===_&&(Me=V),(Je=yt.nextSibling)!==null)break;yt=Ye,Ye=yt.parentNode}yt=Je}d=te===-1||Me===-1?null:{start:te,end:Me}}else d=null}d=d||{start:0,end:0}}else d=null;for(Pm={focusedElem:r,selectionRange:d},Kd=!1,ur=s;ur!==null;)if(s=ur,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,ur=r;else for(;ur!==null;){switch(s=ur,P=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)M=r[d],M.ref.impl=M.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&P!==null){r=void 0,d=s,M=P.memoizedProps,P=P.memoizedState,_=d.stateNode;try{var Zt=Io(d.type,M);r=_.getSnapshotBeforeUpdate(Zt,P),_.__reactInternalSnapshotBeforeUpdate=r}catch(nn){ti(d,d.return,nn)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,d=r.nodeType,d===9)so(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":so(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(S(163))}if(r=s.sibling,r!==null){r.return=s.return,ur=r;break}ur=s.return}}function cm(r,s,d){var _=d.flags;switch(d.tag){case 0:case 11:case 15:Oa(r,d),_&4&&vh(5,d);break;case 1:if(Oa(r,d),_&4)if(r=d.stateNode,s===null)try{r.componentDidMount()}catch(V){ti(d,d.return,V)}else{var M=Io(d.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(M,s,r.__reactInternalSnapshotBeforeUpdate)}catch(V){ti(d,d.return,V)}}_&64&&bg(d),_&512&&Sd(d,d.return);break;case 3:if(Oa(r,d),_&64&&(r=d.updateQueue,r!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{ph(r,s)}catch(V){ti(d,d.return,V)}}break;case 27:s===null&&_&4&&Tg(d);case 26:case 5:Oa(r,d),s===null&&_&4&&Yf(d),_&512&&Sd(d,d.return);break;case 12:Oa(r,d);break;case 31:Oa(r,d),_&4&&Ed(r,d);break;case 13:Oa(r,d),_&4&&Md(r,d),_&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=xm.bind(null,d),dr(r,d))));break;case 22:if(_=d.memoizedState!==null||vl,!_){s=s!==null&&s.memoizedState!==null||cr,M=vl;var P=cr;vl=_,(cr=s)&&!P?xl(r,d,(d.subtreeFlags&8772)!==0):Oa(r,d),vl=M,cr=P}break;case 30:break;default:Oa(r,d)}}function xh(r){var s=r.alternate;s!==null&&(r.alternate=null,xh(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&Zo(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Oi=null,On=!1;function La(r,s,d){for(d=d.child;d!==null;)um(r,s,d),d=d.sibling}function um(r,s,d){if(ye&&typeof ye.onCommitFiberUnmount=="function")try{ye.onCommitFiberUnmount(ke,d)}catch{}switch(d.tag){case 26:cr||is(d,s),La(r,s,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:cr||is(d,s);var _=Oi,M=On;_c(d.type)&&(Oi=d.stateNode,On=!1),La(r,s,d),kh(d.stateNode),Oi=_,On=M;break;case 5:cr||is(d,s);case 6:if(_=Oi,M=On,Oi=null,La(r,s,d),Oi=_,On=M,Oi!==null)if(On)try{(Oi.nodeType===9?Oi.body:Oi.nodeName==="HTML"?Oi.ownerDocument.body:Oi).removeChild(d.stateNode)}catch(P){ti(d,s,P)}else try{Oi.removeChild(d.stateNode)}catch(P){ti(d,s,P)}break;case 18:Oi!==null&&(On?(r=Oi,Wg(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),Sc(r)):Wg(Oi,d.stateNode));break;case 4:_=Oi,M=On,Oi=d.stateNode.containerInfo,On=!0,La(r,s,d),Oi=_,On=M;break;case 0:case 11:case 14:case 15:_l(2,d,s),cr||_l(4,d,s),La(r,s,d);break;case 1:cr||(is(d,s),_=d.stateNode,typeof _.componentWillUnmount=="function"&&wg(d,s,_)),La(r,s,d);break;case 21:La(r,s,d);break;case 22:cr=(_=cr)||d.memoizedState!==null,La(r,s,d),cr=_;break;default:La(r,s,d)}}function Ed(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Sc(r)}catch(d){ti(s,s.return,d)}}}function Md(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Sc(r)}catch(d){ti(s,s.return,d)}}function Ad(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Sg),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Sg),s;default:throw Error(S(435,r.tag))}}function Cd(r,s){var d=Ad(r);s.forEach(function(_){if(!d.has(_)){d.add(_);var M=e_.bind(null,r,_);_.then(M,M)}})}function ga(r,s){var d=s.deletions;if(d!==null)for(var _=0;_<d.length;_++){var M=d[_],P=r,V=s,te=V;e:for(;te!==null;){switch(te.tag){case 27:if(_c(te.type)){Oi=te.stateNode,On=!1;break e}break;case 5:Oi=te.stateNode,On=!1;break e;case 3:case 4:Oi=te.stateNode.containerInfo,On=!0;break e}te=te.return}if(Oi===null)throw Error(S(160));um(P,V,M),Oi=null,On=!1,P=M.alternate,P!==null&&(P.return=null),M.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Qf(s,r),s=s.sibling}var ya=null;function Qf(r,s){var d=r.alternate,_=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:ga(s,r),_r(r),_&4&&(_l(3,r,r.return),vh(3,r),_l(5,r,r.return));break;case 1:ga(s,r),_r(r),_&512&&(cr||d===null||is(d,d.return)),_&64&&vl&&(r=r.updateQueue,r!==null&&(_=r.callbacks,_!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?_:d.concat(_))));break;case 26:var M=ya;if(ga(s,r),_r(r),_&512&&(cr||d===null||is(d,d.return)),_&4){var P=d!==null?d.memoizedState:null;if(_=r.memoizedState,d===null)if(_===null)if(r.stateNode===null){e:{_=r.type,d=r.memoizedProps,M=M.ownerDocument||M;t:switch(_){case"title":P=M.getElementsByTagName("title")[0],(!P||P[sn]||P[ni]||P.namespaceURI==="http://www.w3.org/2000/svg"||P.hasAttribute("itemprop"))&&(P=M.createElement(_),M.head.insertBefore(P,M.querySelector("head > title"))),vr(P,_,d),P[ni]=r,Si(P),_=P;break e;case"link":var V=Gm("link","href",M).get(_+(d.href||""));if(V){for(var te=0;te<V.length;te++)if(P=V[te],P.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&P.getAttribute("rel")===(d.rel==null?null:d.rel)&&P.getAttribute("title")===(d.title==null?null:d.title)&&P.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){V.splice(te,1);break t}}P=M.createElement(_),vr(P,_,d),M.head.appendChild(P);break;case"meta":if(V=Gm("meta","content",M).get(_+(d.content||""))){for(te=0;te<V.length;te++)if(P=V[te],P.getAttribute("content")===(d.content==null?null:""+d.content)&&P.getAttribute("name")===(d.name==null?null:d.name)&&P.getAttribute("property")===(d.property==null?null:d.property)&&P.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&P.getAttribute("charset")===(d.charSet==null?null:d.charSet)){V.splice(te,1);break t}}P=M.createElement(_),vr(P,_,d),M.head.appendChild(P);break;default:throw Error(S(468,_))}P[ni]=r,Si(P),_=P}r.stateNode=_}else Gd(M,r.type,r.stateNode);else r.stateNode=qm(M,_,r.memoizedProps);else P!==_?(P===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):P.count--,_===null?Gd(M,r.type,r.stateNode):qm(M,_,r.memoizedProps)):_===null&&r.stateNode!==null&&Kf(r,r.memoizedProps,d.memoizedProps)}break;case 27:ga(s,r),_r(r),_&512&&(cr||d===null||is(d,d.return)),d!==null&&_&4&&Kf(r,r.memoizedProps,d.memoizedProps);break;case 5:if(ga(s,r),_r(r),_&512&&(cr||d===null||is(d,d.return)),r.flags&32){M=r.stateNode;try{Vs(M,"")}catch(Zt){ti(r,r.return,Zt)}}_&4&&r.stateNode!=null&&(M=r.memoizedProps,Kf(r,M,d!==null?d.memoizedProps:M)),_&1024&&(lm=!0);break;case 6:if(ga(s,r),_r(r),_&4){if(r.stateNode===null)throw Error(S(162));_=r.memoizedProps,d=r.stateNode;try{d.nodeValue=_}catch(Zt){ti(r,r.return,Zt)}}break;case 3:if(Mp=null,M=ya,ya=Tp(s.containerInfo),ga(s,r),ya=M,_r(r),_&4&&d!==null&&d.memoizedState.isDehydrated)try{Sc(s.containerInfo)}catch(Zt){ti(r,r.return,Zt)}lm&&(lm=!1,zd(r));break;case 4:_=ya,ya=Tp(r.stateNode.containerInfo),ga(s,r),_r(r),ya=_;break;case 12:ga(s,r),_r(r);break;case 31:ga(s,r),_r(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 13:ga(s,r),_r(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(tp=Ti()),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 22:M=r.memoizedState!==null;var Me=d!==null&&d.memoizedState!==null,Xe=vl,ht=cr;if(vl=Xe||M,cr=ht||Me,ga(s,r),cr=ht,vl=Xe,_r(r),_&8192)e:for(s=r.stateNode,s._visibility=M?s._visibility&-2:s._visibility|1,M&&(d===null||Me||vl||cr||io(r)),d=null,s=r;;){if(s.tag===5||s.tag===26){if(d===null){Me=d=s;try{if(P=Me.stateNode,M)V=P.style,typeof V.setProperty=="function"?V.setProperty("display","none","important"):V.display="none";else{te=Me.stateNode;var yt=Me.memoizedProps.style,Ye=yt!=null&&yt.hasOwnProperty("display")?yt.display:null;te.style.display=Ye==null||typeof Ye=="boolean"?"":(""+Ye).trim()}}catch(Zt){ti(Me,Me.return,Zt)}}}else if(s.tag===6){if(d===null){Me=s;try{Me.stateNode.nodeValue=M?"":Me.memoizedProps}catch(Zt){ti(Me,Me.return,Zt)}}}else if(s.tag===18){if(d===null){Me=s;try{var Je=Me.stateNode;M?vn(Je,!0):vn(Me.stateNode,!1)}catch(Zt){ti(Me,Me.return,Zt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;d===s&&(d=null),s=s.return}d===s&&(d=null),s.sibling.return=s.return,s=s.sibling}_&4&&(_=r.updateQueue,_!==null&&(d=_.retryQueue,d!==null&&(_.retryQueue=null,Cd(r,d))));break;case 19:ga(s,r),_r(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 30:break;case 21:break;default:ga(s,r),_r(r)}}function _r(r){var s=r.flags;if(s&2){try{for(var d,_=r.return;_!==null;){if(uc(_)){d=_;break}_=_.return}if(d==null)throw Error(S(160));switch(d.tag){case 27:var M=d.stateNode,P=xu(r);Wf(r,P,M);break;case 5:var V=d.stateNode;d.flags&32&&(Vs(V,""),d.flags&=-33);var te=xu(r);Wf(r,te,V);break;case 3:case 4:var Me=d.stateNode.containerInfo,Xe=xu(r);om(r,Xe,Me);break;default:throw Error(S(161))}}catch(ht){ti(r,r.return,ht)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function zd(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;zd(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function Oa(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)cm(r,s.alternate,s),s=s.sibling}function io(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:_l(4,s,s.return),io(s);break;case 1:is(s,s.return);var d=s.stateNode;typeof d.componentWillUnmount=="function"&&wg(s,s.return,d),io(s);break;case 27:kh(s.stateNode);case 26:case 5:is(s,s.return),io(s);break;case 22:s.memoizedState===null&&io(s);break;case 30:io(s);break;default:io(s)}r=r.sibling}}function xl(r,s,d){for(d=d&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var _=s.alternate,M=r,P=s,V=P.flags;switch(P.tag){case 0:case 11:case 15:xl(M,P,d),vh(4,P);break;case 1:if(xl(M,P,d),_=P,M=_.stateNode,typeof M.componentDidMount=="function")try{M.componentDidMount()}catch(Xe){ti(_,_.return,Xe)}if(_=P,M=_.updateQueue,M!==null){var te=_.stateNode;try{var Me=M.shared.hiddenCallbacks;if(Me!==null)for(M.shared.hiddenCallbacks=null,M=0;M<Me.length;M++)uu(Me[M],te)}catch(Xe){ti(_,_.return,Xe)}}d&&V&64&&bg(P),Sd(P,P.return);break;case 27:Tg(P);case 26:case 5:xl(M,P,d),d&&_===null&&V&4&&Yf(P),Sd(P,P.return);break;case 12:xl(M,P,d);break;case 31:xl(M,P,d),d&&V&4&&Ed(M,P);break;case 13:xl(M,P,d),d&&V&4&&Md(M,P);break;case 22:P.memoizedState===null&&xl(M,P,d),Sd(P,P.return);break;case 30:break;default:xl(M,P,d)}s=s.sibling}}function Jf(r,s){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&nc(d))}function bl(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&nc(r))}function ro(r,s,d,_){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)hm(r,s,d,_),s=s.sibling}function hm(r,s,d,_){var M=s.flags;switch(s.tag){case 0:case 11:case 15:ro(r,s,d,_),M&2048&&vh(9,s);break;case 1:ro(r,s,d,_);break;case 3:ro(r,s,d,_),M&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&nc(r)));break;case 12:if(M&2048){ro(r,s,d,_),r=s.stateNode;try{var P=s.memoizedProps,V=P.id,te=P.onPostCommit;typeof te=="function"&&te(V,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(Me){ti(s,s.return,Me)}}else ro(r,s,d,_);break;case 31:ro(r,s,d,_);break;case 13:ro(r,s,d,_);break;case 23:break;case 22:P=s.stateNode,V=s.alternate,s.memoizedState!==null?P._visibility&2?ro(r,s,d,_):bu(r,s):P._visibility&2?ro(r,s,d,_):(P._visibility|=2,Oo(r,s,d,_,(s.subtreeFlags&10256)!==0||!1)),M&2048&&Jf(V,s);break;case 24:ro(r,s,d,_),M&2048&&bl(s.alternate,s);break;default:ro(r,s,d,_)}}function Oo(r,s,d,_,M){for(M=M&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var P=r,V=s,te=d,Me=_,Xe=V.flags;switch(V.tag){case 0:case 11:case 15:Oo(P,V,te,Me,M),vh(8,V);break;case 23:break;case 22:var ht=V.stateNode;V.memoizedState!==null?ht._visibility&2?Oo(P,V,te,Me,M):bu(P,V):(ht._visibility|=2,Oo(P,V,te,Me,M)),M&&Xe&2048&&Jf(V.alternate,V);break;case 24:Oo(P,V,te,Me,M),M&&Xe&2048&&bl(V.alternate,V);break;default:Oo(P,V,te,Me,M)}s=s.sibling}}function bu(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var d=r,_=s,M=_.flags;switch(_.tag){case 22:bu(d,_),M&2048&&Jf(_.alternate,_);break;case 24:bu(d,_),M&2048&&bl(_.alternate,_);break;default:bu(d,_)}s=s.sibling}}var bh=8192;function wu(r,s,d){if(r.subtreeFlags&bh)for(r=r.child;r!==null;)Eg(r,s,d),r=r.sibling}function Eg(r,s,d){switch(r.tag){case 26:wu(r,s,d),r.flags&bh&&r.memoizedState!==null&&Zm(d,ya,r.memoizedState,r.memoizedProps);break;case 5:wu(r,s,d);break;case 3:case 4:var _=ya;ya=Tp(r.stateNode.containerInfo),wu(r,s,d),ya=_;break;case 22:r.memoizedState===null&&(_=r.alternate,_!==null&&_.memoizedState!==null?(_=bh,bh=16777216,wu(r,s,d),bh=_):wu(r,s,d));break;default:wu(r,s,d)}}function Mg(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function Dd(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var _=s[d];ur=_,wh(_,r)}Mg(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Ag(r),r=r.sibling}function Ag(r){switch(r.tag){case 0:case 11:case 15:Dd(r),r.flags&2048&&_l(9,r,r.return);break;case 3:Dd(r);break;case 12:Dd(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,ep(r)):Dd(r);break;default:Dd(r)}}function ep(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var _=s[d];ur=_,wh(_,r)}Mg(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:_l(8,s,s.return),ep(s);break;case 22:d=s.stateNode,d._visibility&2&&(d._visibility&=-3,ep(s));break;default:ep(s)}r=r.sibling}}function wh(r,s){for(;ur!==null;){var d=ur;switch(d.tag){case 0:case 11:case 15:_l(8,d,s);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var _=d.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:nc(d.memoizedState.cache)}if(_=d.child,_!==null)_.return=d,ur=_;else e:for(d=r;ur!==null;){_=ur;var M=_.sibling,P=_.return;if(xh(_),_===d){ur=null;break e}if(M!==null){M.return=P,ur=M;break e}ur=P}}}var Qy={getCacheForType:function(r){var s=ji(Ri),d=s.data.get(r);return d===void 0&&(d=r(),s.data.set(r,d)),d},cacheSignal:function(){return ji(Ri).controller.signal}},Cg=typeof WeakMap=="function"?WeakMap:Map,ei=0,gi=null,Pn=null,In=0,si=0,_a=null,Ls=!1,hc=!1,dm=!1,wl=0,Vi=0,Tl=0,Tu=0,fm=0,jr=0,Su=0,Pd=null,Ba=null,pm=!1,tp=0,zg=0,Id=1/0,Th=null,Sl=null,hr=0,El=null,Sh=null,Os=0,mm=0,np=null,Dg=null,kd=0,gm=null;function Na(){return(ei&2)!==0&&In!==0?In&-In:Te.T!==null?Em():br()}function Pg(){if(jr===0)if((In&536870912)===0||En){var r=gn;gn<<=1,(gn&3932160)===0&&(gn=262144),jr=r}else jr=536870912;return r=Bt.current,r!==null&&(r.flags|=32),jr}function Fa(r,s,d){(r===gi&&(si===2||si===9)||r.cancelPendingCommit!==null)&&(Mh(r,0),dc(r,In,jr,!1)),Sn(r,d),((ei&2)===0||r!==gi)&&(r===gi&&((ei&2)===0&&(Tu|=d),Vi===4&&dc(r,In,jr,!1)),ao(r))}function ir(r,s,d){if((ei&6)!==0)throw Error(S(327));var _=!d&&(s&127)===0&&(s&r.expiredLanes)===0||Ot(r,s),M=_?Ah(r,s):ap(r,s,!0),P=_;do{if(M===0){hc&&!_&&dc(r,s,0,!1);break}else{if(d=r.current.alternate,P&&!Jy(d)){M=ap(r,s,!1),P=!1;continue}if(M===2){if(P=s,r.errorRecoveryDisabledLanes&P)var V=0;else V=r.pendingLanes&-536870913,V=V!==0?V:V&536870912?536870912:0;if(V!==0){s=V;e:{var te=r;M=Pd;var Me=te.current.memoizedState.isDehydrated;if(Me&&(Mh(te,V).flags|=256),V=ap(te,V,!1),V!==2){if(dm&&!Me){te.errorRecoveryDisabledLanes|=P,Tu|=P,M=4;break e}P=Ba,Ba=M,P!==null&&(Ba===null?Ba=P:Ba.push.apply(Ba,P))}M=V}if(P=!1,M!==2)continue}}if(M===1){Mh(r,0),dc(r,s,0,!0);break}e:{switch(_=r,P=M,P){case 0:case 1:throw Error(S(345));case 4:if((s&4194048)!==s)break;case 6:dc(_,s,jr,!Ls);break e;case 2:Ba=null;break;case 3:case 5:break;default:throw Error(S(329))}if((s&62914560)===s&&(M=tp+300-Ti(),10<M)){if(dc(_,s,jr,!Ls),lt(_,0,!0)!==0)break e;Os=s,_.timeoutHandle=wp(Eh.bind(null,_,d,Ba,Th,pm,s,jr,Tu,Su,Ls,P,"Throttled",-0,0),M);break e}Eh(_,d,Ba,Th,pm,s,jr,Tu,Su,Ls,P,null,-0,0)}}break}while(!0);ao(r)}function Eh(r,s,d,_,M,P,V,te,Me,Xe,ht,yt,Ye,Je){if(r.timeoutHandle=-1,yt=s.subtreeFlags,yt&8192||(yt&16785408)===16785408){yt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ha},Eg(s,P,yt);var Zt=(P&62914560)===P?tp-Ti():(P&4194048)===P?zg-Ti():0;if(Zt=Hm(yt,Zt),Zt!==null){Os=P,r.cancelPendingCommit=Zt(Og.bind(null,r,s,P,d,_,M,V,te,Me,ht,yt,null,Ye,Je)),dc(r,P,V,!Xe);return}}Og(r,s,P,d,_,M,V,te,Me)}function Jy(r){for(var s=r;;){var d=s.tag;if((d===0||d===11||d===15)&&s.flags&16384&&(d=s.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var _=0;_<d.length;_++){var M=d[_],P=M.getSnapshot;M=M.value;try{if(!Vr(P(),M))return!1}catch{return!1}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function dc(r,s,d,_){s&=~fm,s&=~Tu,r.suspendedLanes|=s,r.pingedLanes&=~s,_&&(r.warmLanes|=s),_=r.expirationTimes;for(var M=s;0<M;){var P=31-Qe(M),V=1<<P;_[P]=-1,M&=~V}d!==0&&Dn(r,d,s)}function Rd(){return(ei&6)===0?(rs(0),!1):!0}function ip(){if(Pn!==null){if(si===0)var r=Pn.return;else r=Pn,Ss=Ca=null,eo(r),As=null,cl=0,r=Pn;for(;r!==null;)Xf(r.alternate,r),r=r.return;Pn=null}}function Mh(r,s){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,km(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),Os=0,ip(),gi=r,Pn=d=ua(r.current,null),In=s,si=0,_a=null,Ls=!1,hc=Ot(r,s),dm=!1,Su=jr=fm=Tu=Tl=Vi=0,Ba=Pd=null,pm=!1,(s&8)!==0&&(s|=s&32);var _=r.entangledLanes;if(_!==0)for(r=r.entanglements,_&=s;0<_;){var M=31-Qe(_),P=1<<M;s|=r[M],_&=~P}return wl=s,al(),d}function ym(r,s){yn=null,Te.H=Un,s===Ya||s===Hr?(s=rc(),si=3):s===Co?(s=rc(),si=4):si=s===Ff?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,_a=s,Pn===null&&(Vi=1,ns(r,Fr(s,r.current)))}function _m(){var r=Bt.current;return r===null?!0:(In&4194048)===In?qt===null:(In&62914560)===In||(In&536870912)!==0?r===qt:!1}function Eu(){var r=Te.H;return Te.H=Un,r===null?Un:r}function rp(){var r=Te.A;return Te.A=Qy,r}function Ld(){Vi=4,Ls||(In&4194048)!==In&&Bt.current!==null||(hc=!0),(Tl&134217727)===0&&(Tu&134217727)===0||gi===null||dc(gi,In,jr,!1)}function ap(r,s,d){var _=ei;ei|=2;var M=Eu(),P=rp();(gi!==r||In!==s)&&(Th=null,Mh(r,s)),s=!1;var V=Vi;e:do try{if(si!==0&&Pn!==null){var te=Pn,Me=_a;switch(si){case 8:ip(),V=6;break e;case 3:case 2:case 9:case 6:Bt.current===null&&(s=!0);var Xe=si;if(si=0,_a=null,Ch(r,te,Me,Xe),d&&hc){V=0;break e}break;default:Xe=si,si=0,_a=null,Ch(r,te,Me,Xe)}}sp(),V=Vi;break}catch(ht){ym(r,ht)}while(!0);return s&&r.shellSuspendCounter++,Ss=Ca=null,ei=_,Te.H=M,Te.A=P,Pn===null&&(gi=null,In=0,al()),V}function sp(){for(;Pn!==null;)kg(Pn)}function Ah(r,s){var d=ei;ei|=2;var _=Eu(),M=rp();gi!==r||In!==s?(Th=null,Id=Ti()+500,Mh(r,s)):hc=Ot(r,s);e:do try{if(si!==0&&Pn!==null){s=Pn;var P=_a;t:switch(si){case 1:si=0,_a=null,Ch(r,s,P,1);break;case 2:case 9:if(su(P)){si=0,_a=null,Rg(s);break}s=function(){si!==2&&si!==9||gi!==r||(si=7),ao(r)},P.then(s,s);break e;case 3:si=7;break e;case 4:si=5;break e;case 7:su(P)?(si=0,_a=null,Rg(s)):(si=0,_a=null,Ch(r,s,P,7));break;case 5:var V=null;switch(Pn.tag){case 26:V=Pn.memoizedState;case 5:case 27:var te=Pn;if(V?Zd(V):te.stateNode.complete){si=0,_a=null;var Me=te.sibling;if(Me!==null)Pn=Me;else{var Xe=te.return;Xe!==null?(Pn=Xe,op(Xe)):Pn=null}break t}}si=0,_a=null,Ch(r,s,P,5);break;case 6:si=0,_a=null,Ch(r,s,P,6);break;case 8:ip(),Vi=6;break e;default:throw Error(S(462))}}Ig();break}catch(ht){ym(r,ht)}while(!0);return Ss=Ca=null,Te.H=_,Te.A=M,ei=d,Pn!==null?0:(gi=null,In=0,al(),Vi)}function Ig(){for(;Pn!==null&&!Ir();)kg(Pn)}function kg(r){var s=Yr(r.alternate,r,wl);r.memoizedProps=r.pendingProps,s===null?op(r):Pn=s}function Rg(r){var s=r,d=s.alternate;switch(s.tag){case 15:case 0:s=gg(d,s,s.pendingProps,s.type,void 0,In);break;case 11:s=gg(d,s,s.pendingProps,s.type.render,s.ref,In);break;case 5:eo(s);default:Xf(d,s),s=Pn=Rf(s,wl),s=Yr(d,s,wl)}r.memoizedProps=r.pendingProps,s===null?op(r):Pn=s}function Ch(r,s,d,_){Ss=Ca=null,eo(s),As=null,cl=0;var M=s.return;try{if(Nf(r,M,s,d,In)){Vi=1,ns(r,Fr(d,r.current)),Pn=null;return}}catch(P){if(M!==null)throw Pn=M,P;Vi=1,ns(r,Fr(d,r.current)),Pn=null;return}s.flags&32768?(En||_===1?r=!0:hc||(In&536870912)!==0?r=!1:(Ls=r=!0,(_===2||_===9||_===3||_===6)&&(_=Bt.current,_!==null&&_.tag===13&&(_.flags|=16384))),Lg(s,r)):op(s)}function op(r){var s=r;do{if((s.flags&32768)!==0){Lg(s,Ls);return}r=s.return;var d=xg(s.alternate,s,wl);if(d!==null){Pn=d;return}if(s=s.sibling,s!==null){Pn=s;return}Pn=s=r}while(s!==null);Vi===0&&(Vi=5)}function Lg(r,s){do{var d=Ky(r.alternate,r);if(d!==null){d.flags&=32767,Pn=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!s&&(r=r.sibling,r!==null)){Pn=r;return}Pn=r=d}while(r!==null);Vi=6,Pn=null}function Og(r,s,d,_,M,P,V,te,Me){r.cancelPendingCommit=null;do lp();while(hr!==0);if((ei&6)!==0)throw Error(S(327));if(s!==null){if(s===r.current)throw Error(S(177));if(P=s.lanes|s.childLanes,P|=rl,un(r,d,P,V,te,Me),r===gi&&(Pn=gi=null,In=0),Sh=s,El=r,Os=d,mm=P,np=M,Dg=_,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Vg($,function(){return Ug(),null})):(r.callbackNode=null,r.callbackPriority=0),_=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||_){_=Te.T,Te.T=null,M=He.p,He.p=2,V=ei,ei|=4;try{Wy(r,s,d)}finally{ei=V,He.p=M,Te.T=_}}hr=1,Bg(),Ng(),Fg()}}function Bg(){if(hr===1){hr=0;var r=El,s=Sh,d=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||d){d=Te.T,Te.T=null;var _=He.p;He.p=2;var M=ei;ei|=4;try{Qf(s,r);var P=Pm,V=Ku(r.containerInfo),te=P.focusedElem,Me=P.selectionRange;if(V!==te&&te&&te.ownerDocument&&Yu(te.ownerDocument.documentElement,te)){if(Me!==null&&Kc(te)){var Xe=Me.start,ht=Me.end;if(ht===void 0&&(ht=Xe),"selectionStart"in te)te.selectionStart=Xe,te.selectionEnd=Math.min(ht,te.value.length);else{var yt=te.ownerDocument||document,Ye=yt&&yt.defaultView||window;if(Ye.getSelection){var Je=Ye.getSelection(),Zt=te.textContent.length,nn=Math.min(Me.start,Zt),oi=Me.end===void 0?nn:Math.min(Me.end,Zt);!Je.extend&&nn>oi&&(V=oi,oi=nn,nn=V);var Be=Yc(te,nn),ze=Yc(te,oi);if(Be&&ze&&(Je.rangeCount!==1||Je.anchorNode!==Be.node||Je.anchorOffset!==Be.offset||Je.focusNode!==ze.node||Je.focusOffset!==ze.offset)){var Ge=yt.createRange();Ge.setStart(Be.node,Be.offset),Je.removeAllRanges(),nn>oi?(Je.addRange(Ge),Je.extend(ze.node,ze.offset)):(Ge.setEnd(ze.node,ze.offset),Je.addRange(Ge))}}}}for(yt=[],Je=te;Je=Je.parentNode;)Je.nodeType===1&&yt.push({element:Je,left:Je.scrollLeft,top:Je.scrollTop});for(typeof te.focus=="function"&&te.focus(),te=0;te<yt.length;te++){var mt=yt[te];mt.element.scrollLeft=mt.left,mt.element.scrollTop=mt.top}}Kd=!!jd,Pm=jd=null}finally{ei=M,He.p=_,Te.T=d}}r.current=s,hr=2}}function Ng(){if(hr===2){hr=0;var r=El,s=Sh,d=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||d){d=Te.T,Te.T=null;var _=He.p;He.p=2;var M=ei;ei|=4;try{cm(r,s.alternate,s)}finally{ei=M,He.p=_,Te.T=d}}hr=3}}function Fg(){if(hr===4||hr===3){hr=0,cs();var r=El,s=Sh,d=Os,_=Dg;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?hr=5:(hr=0,Sh=El=null,jg(r,r.pendingLanes));var M=r.pendingLanes;if(M===0&&(Sl=null),xt(d),s=s.stateNode,ye&&typeof ye.onCommitFiberRoot=="function")try{ye.onCommitFiberRoot(ke,s,void 0,(s.current.flags&128)===128)}catch{}if(_!==null){s=Te.T,M=He.p,He.p=2,Te.T=null;try{for(var P=r.onRecoverableError,V=0;V<_.length;V++){var te=_[V];P(te.value,{componentStack:te.stack})}}finally{Te.T=s,He.p=M}}(Os&3)!==0&&lp(),ao(r),M=r.pendingLanes,(d&261930)!==0&&(M&42)!==0?r===gm?kd++:(kd=0,gm=r):kd=0,rs(0)}}function jg(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,nc(s)))}function lp(){return Bg(),Ng(),Fg(),Ug()}function Ug(){if(hr!==5)return!1;var r=El,s=mm;mm=0;var d=xt(Os),_=Te.T,M=He.p;try{He.p=32>d?32:d,Te.T=null,d=np,np=null;var P=El,V=Os;if(hr=0,Sh=El=null,Os=0,(ei&6)!==0)throw Error(S(331));var te=ei;if(ei|=4,Ag(P.current),hm(P,P.current,V,d),ei=te,rs(0,!1),ye&&typeof ye.onPostCommitFiberRoot=="function")try{ye.onPostCommitFiberRoot(ke,P)}catch{}return!0}finally{He.p=M,Te.T=_,jg(r,s)}}function vm(r,s,d){s=Fr(d,s),s=yu(r.stateNode,s,2),r=Ks(r,s,2),r!==null&&(Sn(r,2),ao(r))}function ti(r,s,d){if(r.tag===3)vm(r,r,d);else for(;s!==null;){if(s.tag===3){vm(s,r,d);break}else if(s.tag===1){var _=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Sl===null||!Sl.has(_))){r=Fr(d,r),d=_u(2),_=Ks(s,d,2),_!==null&&(vu(d,_,s,r),Sn(_,2),ao(_));break}}s=s.return}}function cp(r,s,d){var _=r.pingCache;if(_===null){_=r.pingCache=new Cg;var M=new Set;_.set(s,M)}else M=_.get(s),M===void 0&&(M=new Set,_.set(s,M));M.has(d)||(dm=!0,M.add(d),r=fc.bind(null,r,s,d),s.then(r,r))}function fc(r,s,d){var _=r.pingCache;_!==null&&_.delete(s),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,gi===r&&(In&d)===d&&(Vi===4||Vi===3&&(In&62914560)===In&&300>Ti()-tp?(ei&2)===0&&Mh(r,0):fm|=d,Su===In&&(Su=0)),ao(r)}function Od(r,s){s===0&&(s=tn()),r=Aa(r,s),r!==null&&(Sn(r,s),ao(r))}function xm(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),Od(r,d)}function e_(r,s){var d=0;switch(r.tag){case 31:case 13:var _=r.stateNode,M=r.memoizedState;M!==null&&(d=M.retryLane);break;case 19:_=r.stateNode;break;case 22:_=r.stateNode._retryCache;break;default:throw Error(S(314))}_!==null&&_.delete(s),Od(r,d)}function Vg(r,s){return ia(r,s)}var up=null,zh=null,bm=!1,hp=!1,wm=!1,Ml=0;function ao(r){r!==zh&&r.next===null&&(zh===null?up=zh=r:zh=zh.next=r),hp=!0,bm||(bm=!0,Sm())}function rs(r,s){if(!wm&&hp){wm=!0;do for(var d=!1,_=up;_!==null;){if(r!==0){var M=_.pendingLanes;if(M===0)var P=0;else{var V=_.suspendedLanes,te=_.pingedLanes;P=(1<<31-Qe(42|r)+1)-1,P&=M&~(V&~te),P=P&201326741?P&201326741|1:P?P|2:0}P!==0&&(d=!0,Bd(_,P))}else P=In,P=lt(_,_===gi?P:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(P&3)===0||Ot(_,P)||(d=!0,Bd(_,P));_=_.next}while(d);wm=!1}}function pc(){Tm()}function Tm(){hp=bm=!1;var r=0;Ml!==0&&bp()&&(r=Ml);for(var s=Ti(),d=null,_=up;_!==null;){var M=_.next,P=dp(_,s);P===0?(_.next=null,d===null?up=M:d.next=M,M===null&&(zh=d)):(d=_,(r!==0||(P&3)!==0)&&(hp=!0)),_=M}hr!==0&&hr!==5||rs(r),Ml!==0&&(Ml=0)}function dp(r,s){for(var d=r.suspendedLanes,_=r.pingedLanes,M=r.expirationTimes,P=r.pendingLanes&-62914561;0<P;){var V=31-Qe(P),te=1<<V,Me=M[V];Me===-1?((te&d)===0||(te&_)!==0)&&(M[V]=Mt(te,s)):Me<=s&&(r.expiredLanes|=te),P&=~te}if(s=gi,d=In,d=lt(r,r===s?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_=r.callbackNode,d===0||r===s&&(si===2||si===9)||r.cancelPendingCommit!==null)return _!==null&&_!==null&&Ur(_),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||Ot(r,d)){if(s=d&-d,s===r.callbackPriority)return s;switch(_!==null&&Ur(_),xt(d)){case 2:case 8:d=H;break;case 32:d=$;break;case 268435456:d=de;break;default:d=$}return _=qg.bind(null,r),d=ia(d,_),r.callbackPriority=s,r.callbackNode=d,s}return _!==null&&_!==null&&Ur(_),r.callbackPriority=2,r.callbackNode=null,2}function qg(r,s){if(hr!==0&&hr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(lp()&&r.callbackNode!==d)return null;var _=In;return _=lt(r,r===gi?_:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_===0?null:(ir(r,_,s),dp(r,Ti()),r.callbackNode!=null&&r.callbackNode===d?qg.bind(null,r):null)}function Bd(r,s){if(lp())return null;ir(r,s,!0)}function Sm(){Lm(function(){(ei&6)!==0?ia(fe,pc):Tm()})}function Em(){if(Ml===0){var r=ll;r===0&&(r=Kt,Kt<<=1,(Kt&261888)===0&&(Kt=256)),Ml=r}return Ml}function fp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:dn(""+r)}function pp(r,s){var d=s.ownerDocument.createElement("input");return d.name=s.name,d.value=s.value,r.id&&d.setAttribute("form",r.id),s.parentNode.insertBefore(d,s),r=new FormData(r),d.parentNode.removeChild(d),r}function Dh(r,s,d,_,M){if(s==="submit"&&d&&d.stateNode===M){var P=fp((M[At]||null).action),V=_.submitter;V&&(s=(s=V[At]||null)?fp(s.formAction):V.getAttribute("formAction"),s!==null&&(P=s,V=null));var te=new Nc("action","action",null,_,M);r.push({event:te,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if(Ml!==0){var Me=V?pp(M,V):new FormData(M);Ci(d,{pending:!0,data:Me,method:M.method,action:P},null,Me)}}else typeof P=="function"&&(te.preventDefault(),Me=V?pp(M,V):new FormData(M),Ci(d,{pending:!0,data:Me,method:M.method,action:P},P,Me))},currentTarget:M}]})}}for(var mp=0;mp<eh.length;mp++){var gp=eh[mp],Mm=gp.toLowerCase(),Gg=gp[0].toUpperCase()+gp.slice(1);la(Mm,"on"+Gg)}la(Jc,"onAnimationEnd"),la(eu,"onAnimationIteration"),la(Ju,"onAnimationStart"),la("dblclick","onDoubleClick"),la("focusin","onFocus"),la("focusout","onBlur"),la(il,"onTransitionRun"),la(tu,"onTransitionStart"),la(Wl,"onTransitionCancel"),la(oa,"onTransitionEnd"),Us("onMouseEnter",["mouseout","mouseover"]),Us("onMouseLeave",["mouseout","mouseover"]),Us("onPointerEnter",["pointerout","pointerover"]),Us("onPointerLeave",["pointerout","pointerover"]),Mn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Mn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Mn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Mn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Mn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Mn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mc));function Hg(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var _=r[d],M=_.event;_=_.listeners;e:{var P=void 0;if(s)for(var V=_.length-1;0<=V;V--){var te=_[V],Me=te.instance,Xe=te.currentTarget;if(te=te.listener,Me!==P&&M.isPropagationStopped())break e;P=te,M.currentTarget=Xe;try{P(M)}catch(ht){_s(ht)}M.currentTarget=null,P=Me}else for(V=0;V<_.length;V++){if(te=_[V],Me=te.instance,Xe=te.currentTarget,te=te.listener,Me!==P&&M.isPropagationStopped())break e;P=te,M.currentTarget=Xe;try{P(M)}catch(ht){_s(ht)}M.currentTarget=null,P=Me}}}}function kn(r,s){var d=s[fn];d===void 0&&(d=s[fn]=new Set);var _=r+"__bubble";d.has(_)||(_p(s,r,2,!1),d.add(_))}function Am(r,s,d){var _=0;s&&(_|=4),_p(d,r,_,s)}var yp="_reactListening"+Math.random().toString(36).slice(2);function Cm(r){if(!r[yp]){r[yp]=!0,Nl.forEach(function(d){d!=="selectionchange"&&(Zg.has(d)||Am(d,!1,r),Am(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[yp]||(s[yp]=!0,Am("selectionchange",!1,s))}}function _p(r,s,d,_){switch(Cu(s)){case 2:var M=Wd;break;case 8:M=sy;break;default:M=Xm}d=M.bind(null,s,d,r),M=void 0,!Rr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(M=!0),_?M!==void 0?r.addEventListener(s,d,{capture:!0,passive:M}):r.addEventListener(s,d,!0):M!==void 0?r.addEventListener(s,d,{passive:M}):r.addEventListener(s,d,!1)}function Bo(r,s,d,_,M){var P=_;if((s&1)===0&&(s&2)===0&&_!==null)e:for(;;){if(_===null)return;var V=_.tag;if(V===3||V===4){var te=_.stateNode.containerInfo;if(te===M)break;if(V===4)for(V=_.return;V!==null;){var Me=V.tag;if((Me===3||Me===4)&&V.stateNode.containerInfo===M)return;V=V.return}for(;te!==null;){if(V=hs(te),V===null)return;if(Me=V.tag,Me===5||Me===6||Me===26||Me===27){_=P=V;continue e}te=te.parentNode}}_=_.return}Kn(function(){var Xe=P,ht=Bc(d),yt=[];e:{var Ye=sd.get(r);if(Ye!==void 0){var Je=Nc,Zt=r;switch(r){case"keypress":if(sa(d)===0)break e;case"keydown":case"keyup":Je=Mi;break;case"focusin":Zt="focus",Je=go;break;case"focusout":Zt="blur",Je=go;break;case"beforeblur":case"afterblur":Je=go;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Je=Qo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Je=Fc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Je=Wp;break;case Jc:case eu:case Ju:Je=wf;break;case oa:Je=Zu;break;case"scroll":case"scrollend":Je=Wo;break;case"wheel":Je=td;break;case"copy":case"cut":case"paste":Je=Jh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Je=Gu;break;case"toggle":case"beforetoggle":Je=Zl}var nn=(s&4)!==0,oi=!nn&&(r==="scroll"||r==="scrollend"),Be=nn?Ye!==null?Ye+"Capture":null:Ye;nn=[];for(var ze=Xe,Ge;ze!==null;){var mt=ze;if(Ge=mt.stateNode,mt=mt.tag,mt!==5&&mt!==26&&mt!==27||Ge===null||Be===null||(mt=Ta(ze,Be),mt!=null&&nn.push(Ph(ze,mt,Ge))),oi)break;ze=ze.return}0<nn.length&&(Ye=new Je(Ye,Zt,null,d,ht),yt.push({event:Ye,listeners:nn}))}}if((s&7)===0){e:{if(Ye=r==="mouseover"||r==="pointerover",Je=r==="mouseout"||r==="pointerout",Ye&&d!==Qh&&(Zt=d.relatedTarget||d.fromElement)&&(hs(Zt)||Zt[ln]))break e;if((Je||Ye)&&(Ye=ht.window===ht?ht:(Ye=ht.ownerDocument)?Ye.defaultView||Ye.parentWindow:window,Je?(Zt=d.relatedTarget||d.toElement,Je=Xe,Zt=Zt?hs(Zt):null,Zt!==null&&(oi=k(Zt),nn=Zt.tag,Zt!==oi||nn!==5&&nn!==27&&nn!==6)&&(Zt=null)):(Je=null,Zt=Xe),Je!==Zt)){if(nn=Qo,mt="onMouseLeave",Be="onMouseEnter",ze="mouse",(r==="pointerout"||r==="pointerover")&&(nn=Gu,mt="onPointerLeave",Be="onPointerEnter",ze="pointer"),oi=Je==null?Ye:ds(Je),Ge=Zt==null?Ye:ds(Zt),Ye=new nn(mt,ze+"leave",Je,d,ht),Ye.target=oi,Ye.relatedTarget=Ge,mt=null,hs(ht)===Xe&&(nn=new nn(Be,ze+"enter",Zt,d,ht),nn.target=Ge,nn.relatedTarget=oi,mt=nn),oi=mt,Je&&Zt)t:{for(nn=$g,Be=Je,ze=Zt,Ge=0,mt=Be;mt;mt=nn(mt))Ge++;mt=0;for(var en=ze;en;en=nn(en))mt++;for(;0<Ge-mt;)Be=nn(Be),Ge--;for(;0<mt-Ge;)ze=nn(ze),mt--;for(;Ge--;){if(Be===ze||ze!==null&&Be===ze.alternate){nn=Be;break t}Be=nn(Be),ze=nn(ze)}nn=null}else nn=null;Je!==null&&zm(yt,Ye,Je,nn,!1),Zt!==null&&oi!==null&&zm(yt,oi,Zt,nn,!0)}}e:{if(Ye=Xe?ds(Xe):window,Je=Ye.nodeName&&Ye.nodeName.toLowerCase(),Je==="select"||Je==="input"&&Ye.type==="file")var $n=vo;else if($u(Ye))if(nd)$n=If;else{$n=Pf;var Ht=Qp}else Je=Ye.nodeName,!Je||Je.toLowerCase()!=="input"||Ye.type!=="checkbox"&&Ye.type!=="radio"?Xe&&Xo(Xe.elementType)&&($n=vo):$n=Xc;if($n&&($n=$n(r,Xe))){Xu(yt,$n,d,ht);break e}Ht&&Ht(r,Ye,Xe),r==="focusout"&&Xe&&Ye.type==="number"&&Xe.memoizedProps.value!=null&&Oc(Ye,"number",Ye.value)}switch(Ht=Xe?ds(Xe):window,r){case"focusin":($u(Ht)||Ht.contentEditable==="true")&&(Ma=Ht,Wc=Xe,Qc=null);break;case"focusout":Qc=Wc=Ma=null;break;case"mousedown":Qu=!0;break;case"contextmenu":case"mouseup":case"dragend":Qu=!1,kf(yt,d,ht);break;case"selectionchange":if(Wu)break;case"keydown":case"keyup":kf(yt,d,ht)}var Wt;if(ki)e:{switch(r){case"compositionstart":var Cn="onCompositionStart";break e;case"compositionend":Cn="onCompositionEnd";break e;case"compositionupdate":Cn="onCompositionUpdate";break e}Cn=void 0}else $a?Gc(r,d)&&(Cn="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Cn="onCompositionStart");Cn&&(Yl&&d.locale!=="ko"&&($a||Cn!=="onCompositionStart"?Cn==="onCompositionEnd"&&$a&&(Wt=po()):(aa=ht,ms="value"in aa?aa.value:aa.textContent,$a=!0)),Ht=Nd(Xe,Cn),0<Ht.length&&(Cn=new ed(Cn,r,null,d,ht),yt.push({event:Cn,listeners:Ht}),Wt?Cn.data=Wt:(Wt=Mf(d),Wt!==null&&(Cn.data=Wt)))),(Wt=Xl?Hu(r,d):Af(r,d))&&(Cn=Nd(Xe,"onBeforeInput"),0<Cn.length&&(Ht=new ed("onBeforeInput","beforeinput",null,d,ht),yt.push({event:Ht,listeners:Cn}),Ht.data=Wt)),Dh(yt,r,Xe,d,ht)}Hg(yt,s)})}function Ph(r,s,d){return{instance:r,listener:s,currentTarget:d}}function Nd(r,s){for(var d=s+"Capture",_=[];r!==null;){var M=r,P=M.stateNode;if(M=M.tag,M!==5&&M!==26&&M!==27||P===null||(M=Ta(r,d),M!=null&&_.unshift(Ph(r,M,P)),M=Ta(r,s),M!=null&&_.push(Ph(r,M,P))),r.tag===3)return _;r=r.return}return[]}function $g(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function zm(r,s,d,_,M){for(var P=s._reactName,V=[];d!==null&&d!==_;){var te=d,Me=te.alternate,Xe=te.stateNode;if(te=te.tag,Me!==null&&Me===_)break;te!==5&&te!==26&&te!==27||Xe===null||(Me=Xe,M?(Xe=Ta(d,P),Xe!=null&&V.unshift(Ph(d,Xe,Me))):M||(Xe=Ta(d,P),Xe!=null&&V.push(Ph(d,Xe,Me)))),d=d.return}V.length!==0&&r.push({event:s,listeners:V})}var Xg=/\r\n?/g,Yg=/\u0000|\uFFFD/g;function Fd(r){return(typeof r=="string"?r:""+r).replace(Xg,`
`).replace(Yg,"")}function Dm(r,s){return s=Fd(s),Fd(r)===s}function Hn(r,s,d,_,M,P){switch(d){case"children":typeof _=="string"?s==="body"||s==="textarea"&&_===""||Vs(r,_):(typeof _=="number"||typeof _=="bigint")&&s!=="body"&&Vs(r,""+_);break;case"className":ps(r,"class",_);break;case"tabIndex":ps(r,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":ps(r,d,_);break;case"style":qu(r,_,P);break;case"data":if(s!=="object"){ps(r,"data",_);break}case"src":case"href":if(_===""&&(s!=="a"||d!=="href")){r.removeAttribute(d);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(d);break}_=dn(""+_),r.setAttribute(d,_);break;case"action":case"formAction":if(typeof _=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof P=="function"&&(d==="formAction"?(s!=="input"&&Hn(r,s,"name",M.name,M,null),Hn(r,s,"formEncType",M.formEncType,M,null),Hn(r,s,"formMethod",M.formMethod,M,null),Hn(r,s,"formTarget",M.formTarget,M,null)):(Hn(r,s,"encType",M.encType,M,null),Hn(r,s,"method",M.method,M,null),Hn(r,s,"target",M.target,M,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(d);break}_=dn(""+_),r.setAttribute(d,_);break;case"onClick":_!=null&&(r.onclick=Ha);break;case"onScroll":_!=null&&kn("scroll",r);break;case"onScrollEnd":_!=null&&kn("scrollend",r);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(d=_.__html,d!=null){if(M.children!=null)throw Error(S(60));r.innerHTML=d}}break;case"multiple":r.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":r.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){r.removeAttribute("xlink:href");break}d=dn(""+_),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,""+_):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":_===!0?r.setAttribute(d,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,_):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?r.setAttribute(d,_):r.removeAttribute(d);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?r.removeAttribute(d):r.setAttribute(d,_);break;case"popover":kn("beforetoggle",r),kn("toggle",r),kc(r,"popover",_);break;case"xlinkActuate":wa(r,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":wa(r,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":wa(r,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":wa(r,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":wa(r,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":wa(r,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":wa(r,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":wa(r,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":wa(r,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":kc(r,"is",_);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=fo.get(d)||d,kc(r,d,_))}}function vp(r,s,d,_,M,P){switch(d){case"style":qu(r,_,P);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(d=_.__html,d!=null){if(M.children!=null)throw Error(S(60));r.innerHTML=d}}break;case"children":typeof _=="string"?Vs(r,_):(typeof _=="number"||typeof _=="bigint")&&Vs(r,""+_);break;case"onScroll":_!=null&&kn("scroll",r);break;case"onScrollEnd":_!=null&&kn("scrollend",r);break;case"onClick":_!=null&&(r.onclick=Ha);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Tr.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(M=d.endsWith("Capture"),s=d.slice(2,M?d.length-7:void 0),P=r[At]||null,P=P!=null?P[d]:null,typeof P=="function"&&r.removeEventListener(s,P,M),typeof _=="function")){typeof P!="function"&&P!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(s,_,M);break e}d in r?r[d]=_:_===!0?r.setAttribute(d,""):kc(r,d,_)}}}function vr(r,s,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":kn("error",r),kn("load",r);var _=!1,M=!1,P;for(P in d)if(d.hasOwnProperty(P)){var V=d[P];if(V!=null)switch(P){case"src":_=!0;break;case"srcSet":M=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:Hn(r,s,P,V,d,null)}}M&&Hn(r,s,"srcSet",d.srcSet,d,null),_&&Hn(r,s,"src",d.src,d,null);return;case"input":kn("invalid",r);var te=P=V=M=null,Me=null,Xe=null;for(_ in d)if(d.hasOwnProperty(_)){var ht=d[_];if(ht!=null)switch(_){case"name":M=ht;break;case"type":V=ht;break;case"checked":Me=ht;break;case"defaultChecked":Xe=ht;break;case"value":P=ht;break;case"defaultValue":te=ht;break;case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(S(137,s));break;default:Hn(r,s,_,ht,d,null)}}Vu(r,P,te,Me,Xe,V,M,!1);return;case"select":kn("invalid",r),_=V=P=null;for(M in d)if(d.hasOwnProperty(M)&&(te=d[M],te!=null))switch(M){case"value":P=te;break;case"defaultValue":V=te;break;case"multiple":_=te;default:Hn(r,s,M,te,d,null)}s=P,d=V,r.multiple=!!_,s!=null?ho(r,!!_,s,!1):d!=null&&ho(r,!!_,d,!0);return;case"textarea":kn("invalid",r),P=M=_=null;for(V in d)if(d.hasOwnProperty(V)&&(te=d[V],te!=null))switch(V){case"value":_=te;break;case"defaultValue":M=te;break;case"children":P=te;break;case"dangerouslySetInnerHTML":if(te!=null)throw Error(S(91));break;default:Hn(r,s,V,te,d,null)}Ul(r,_,M,P);return;case"option":for(Me in d)d.hasOwnProperty(Me)&&(_=d[Me],_!=null)&&(Me==="selected"?r.selected=_&&typeof _!="function"&&typeof _!="symbol":Hn(r,s,Me,_,d,null));return;case"dialog":kn("beforetoggle",r),kn("toggle",r),kn("cancel",r),kn("close",r);break;case"iframe":case"object":kn("load",r);break;case"video":case"audio":for(_=0;_<mc.length;_++)kn(mc[_],r);break;case"image":kn("error",r),kn("load",r);break;case"details":kn("toggle",r);break;case"embed":case"source":case"link":kn("error",r),kn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Xe in d)if(d.hasOwnProperty(Xe)&&(_=d[Xe],_!=null))switch(Xe){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:Hn(r,s,Xe,_,d,null)}return;default:if(Xo(s)){for(ht in d)d.hasOwnProperty(ht)&&(_=d[ht],_!==void 0&&vp(r,s,ht,_,d,void 0));return}}for(te in d)d.hasOwnProperty(te)&&(_=d[te],_!=null&&Hn(r,s,te,_,d,null))}function Kg(r,s,d,_){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var M=null,P=null,V=null,te=null,Me=null,Xe=null,ht=null;for(Je in d){var yt=d[Je];if(d.hasOwnProperty(Je)&&yt!=null)switch(Je){case"checked":break;case"value":break;case"defaultValue":Me=yt;default:_.hasOwnProperty(Je)||Hn(r,s,Je,null,_,yt)}}for(var Ye in _){var Je=_[Ye];if(yt=d[Ye],_.hasOwnProperty(Ye)&&(Je!=null||yt!=null))switch(Ye){case"type":P=Je;break;case"name":M=Je;break;case"checked":Xe=Je;break;case"defaultChecked":ht=Je;break;case"value":V=Je;break;case"defaultValue":te=Je;break;case"children":case"dangerouslySetInnerHTML":if(Je!=null)throw Error(S(137,s));break;default:Je!==yt&&Hn(r,s,Ye,Je,_,yt)}}Lc(r,V,te,Me,Xe,ht,P,M);return;case"select":Je=V=te=Ye=null;for(P in d)if(Me=d[P],d.hasOwnProperty(P)&&Me!=null)switch(P){case"value":break;case"multiple":Je=Me;default:_.hasOwnProperty(P)||Hn(r,s,P,null,_,Me)}for(M in _)if(P=_[M],Me=d[M],_.hasOwnProperty(M)&&(P!=null||Me!=null))switch(M){case"value":Ye=P;break;case"defaultValue":te=P;break;case"multiple":V=P;default:P!==Me&&Hn(r,s,M,P,_,Me)}s=te,d=V,_=Je,Ye!=null?ho(r,!!d,Ye,!1):!!_!=!!d&&(s!=null?ho(r,!!d,s,!0):ho(r,!!d,d?[]:"",!1));return;case"textarea":Je=Ye=null;for(te in d)if(M=d[te],d.hasOwnProperty(te)&&M!=null&&!_.hasOwnProperty(te))switch(te){case"value":break;case"children":break;default:Hn(r,s,te,null,_,M)}for(V in _)if(M=_[V],P=d[V],_.hasOwnProperty(V)&&(M!=null||P!=null))switch(V){case"value":Ye=M;break;case"defaultValue":Je=M;break;case"children":break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(S(91));break;default:M!==P&&Hn(r,s,V,M,_,P)}xf(r,Ye,Je);return;case"option":for(var Zt in d)Ye=d[Zt],d.hasOwnProperty(Zt)&&Ye!=null&&!_.hasOwnProperty(Zt)&&(Zt==="selected"?r.selected=!1:Hn(r,s,Zt,null,_,Ye));for(Me in _)Ye=_[Me],Je=d[Me],_.hasOwnProperty(Me)&&Ye!==Je&&(Ye!=null||Je!=null)&&(Me==="selected"?r.selected=Ye&&typeof Ye!="function"&&typeof Ye!="symbol":Hn(r,s,Me,Ye,_,Je));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var nn in d)Ye=d[nn],d.hasOwnProperty(nn)&&Ye!=null&&!_.hasOwnProperty(nn)&&Hn(r,s,nn,null,_,Ye);for(Xe in _)if(Ye=_[Xe],Je=d[Xe],_.hasOwnProperty(Xe)&&Ye!==Je&&(Ye!=null||Je!=null))switch(Xe){case"children":case"dangerouslySetInnerHTML":if(Ye!=null)throw Error(S(137,s));break;default:Hn(r,s,Xe,Ye,_,Je)}return;default:if(Xo(s)){for(var oi in d)Ye=d[oi],d.hasOwnProperty(oi)&&Ye!==void 0&&!_.hasOwnProperty(oi)&&vp(r,s,oi,void 0,_,Ye);for(ht in _)Ye=_[ht],Je=d[ht],!_.hasOwnProperty(ht)||Ye===Je||Ye===void 0&&Je===void 0||vp(r,s,ht,Ye,_,Je);return}}for(var Be in d)Ye=d[Be],d.hasOwnProperty(Be)&&Ye!=null&&!_.hasOwnProperty(Be)&&Hn(r,s,Be,null,_,Ye);for(yt in _)Ye=_[yt],Je=d[yt],!_.hasOwnProperty(yt)||Ye===Je||Ye==null&&Je==null||Hn(r,s,yt,Ye,_,Je)}function ja(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Ih(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,d=performance.getEntriesByType("resource"),_=0;_<d.length;_++){var M=d[_],P=M.transferSize,V=M.initiatorType,te=M.duration;if(P&&te&&ja(V)){for(V=0,te=M.responseEnd,_+=1;_<d.length;_++){var Me=d[_],Xe=Me.startTime;if(Xe>te)break;var ht=Me.transferSize,yt=Me.initiatorType;ht&&ja(yt)&&(Me=Me.responseEnd,V+=ht*(Me<te?1:(te-Xe)/(Me-Xe)))}if(--_,s+=8*(P+V)/(M.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var jd=null,Pm=null;function Ud(r){return r.nodeType===9?r:r.ownerDocument}function gc(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Im(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function xp(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var yc=null;function bp(){var r=window.event;return r&&r.type==="popstate"?r===yc?!1:(yc=r,!0):(yc=null,!1)}var wp=typeof setTimeout=="function"?setTimeout:void 0,km=typeof clearTimeout=="function"?clearTimeout:void 0,Rm=typeof Promise=="function"?Promise:void 0,Lm=typeof queueMicrotask=="function"?queueMicrotask:typeof Rm<"u"?function(r){return Rm.resolve(null).then(r).catch(Om)}:wp;function Om(r){setTimeout(function(){throw r})}function _c(r){return r==="head"}function Wg(r,s){var d=s,_=0;do{var M=d.nextSibling;if(r.removeChild(d),M&&M.nodeType===8)if(d=M.data,d==="/$"||d==="/&"){if(_===0){r.removeChild(M),Sc(s);return}_--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")_++;else if(d==="html")kh(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,kh(d);for(var P=d.firstChild;P;){var V=P.nextSibling,te=P.nodeName;P[sn]||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&P.rel.toLowerCase()==="stylesheet"||d.removeChild(P),P=V}}else d==="body"&&kh(r.ownerDocument.body);d=M}while(d);Sc(s)}function vn(r,s){var d=r;r=0;do{var _=d.nextSibling;if(d.nodeType===1?s?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(s?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),_&&_.nodeType===8)if(d=_.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=_}while(d)}function so(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var d=s;switch(s=s.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":so(d),Zo(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function Mr(r,s,d,_){for(;r.nodeType===1;){var M=d;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!_&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(_){if(!r[sn])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(P=r.getAttribute("rel"),P==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(P!==M.rel||r.getAttribute("href")!==(M.href==null||M.href===""?null:M.href)||r.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin)||r.getAttribute("title")!==(M.title==null?null:M.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(P=r.getAttribute("src"),(P!==(M.src==null?null:M.src)||r.getAttribute("type")!==(M.type==null?null:M.type)||r.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin))&&P&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var P=M.name==null?null:""+M.name;if(M.type==="hidden"&&r.getAttribute("name")===P)return r}else return r;if(r=as(r.nextSibling),r===null)break}return null}function oo(r,s,d){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=as(r.nextSibling),r===null))return null;return r}function vc(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=as(r.nextSibling),r===null))return null;return r}function Kr(r){return r.data==="$?"||r.data==="$~"}function Xi(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function dr(r,s){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||d.readyState!=="loading")s();else{var _=function(){s(),d.removeEventListener("DOMContentLoaded",_)};d.addEventListener("DOMContentLoaded",_),r._reactRetry=_}}function as(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var va=null;function fr(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(s===0)return as(r.nextSibling);s--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||s++}r=r.nextSibling}return null}function Vd(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(s===0)return r;s--}else d!=="/$"&&d!=="/&"||s++}r=r.previousSibling}return null}function Qg(r,s,d){switch(s=Ud(d),r){case"html":if(r=s.documentElement,!r)throw Error(S(452));return r;case"head":if(r=s.head,!r)throw Error(S(453));return r;case"body":if(r=s.body,!r)throw Error(S(454));return r;default:throw Error(S(451))}}function kh(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);Zo(r)}var Ar=new Map,Mu=new Set;function Tp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var No=He.d;He.d={f:Jg,r:ey,D:Nm,C:Wr,L:lo,m:Qr,X:Sp,S:bc,M:Fm};function Jg(){var r=No.f(),s=Rd();return r||s}function ey(r){var s=js(r);s!==null&&s.tag===5&&s.type==="form"?or(s):No.r(r)}var xc=typeof document>"u"?null:document;function Bm(r,s,d){var _=xc;if(_&&typeof s=="string"&&s){var M=kr(s);M='link[rel="'+r+'"][href="'+M+'"]',typeof d=="string"&&(M+='[crossorigin="'+d+'"]'),Mu.has(M)||(Mu.add(M),r={rel:r,crossOrigin:d,href:s},_.querySelector(M)===null&&(s=_.createElement("link"),vr(s,"link",r),Si(s),_.head.appendChild(s)))}}function Nm(r){No.D(r),Bm("dns-prefetch",r,null)}function Wr(r,s){No.C(r,s),Bm("preconnect",r,s)}function lo(r,s,d){No.L(r,s,d);var _=xc;if(_&&r&&s){var M='link[rel="preload"][as="'+kr(s)+'"]';s==="image"&&d&&d.imageSrcSet?(M+='[imagesrcset="'+kr(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(M+='[imagesizes="'+kr(d.imageSizes)+'"]')):M+='[href="'+kr(r)+'"]';var P=M;switch(s){case"style":P=Au(r);break;case"script":P=Al(r)}Ar.has(P)||(r=re({rel:"preload",href:s==="image"&&d&&d.imageSrcSet?void 0:r,as:s},d),Ar.set(P,r),_.querySelector(M)!==null||s==="style"&&_.querySelector(Rh(P))||s==="script"&&_.querySelector(Lh(P))||(s=_.createElement("link"),vr(s,"link",r),Si(s),_.head.appendChild(s)))}}function Qr(r,s){No.m(r,s);var d=xc;if(d&&r){var _=s&&typeof s.as=="string"?s.as:"script",M='link[rel="modulepreload"][as="'+kr(_)+'"][href="'+kr(r)+'"]',P=M;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":P=Al(r)}if(!Ar.has(P)&&(r=re({rel:"modulepreload",href:r},s),Ar.set(P,r),d.querySelector(M)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Lh(P)))return}_=d.createElement("link"),vr(_,"link",r),Si(_),d.head.appendChild(_)}}}function bc(r,s,d){No.S(r,s,d);var _=xc;if(_&&r){var M=fs(_).hoistableStyles,P=Au(r);s=s||"default";var V=M.get(P);if(!V){var te={loading:0,preload:null};if(V=_.querySelector(Rh(P)))te.loading=5;else{r=re({rel:"stylesheet",href:r,"data-precedence":s},d),(d=Ar.get(P))&&qd(r,d);var Me=V=_.createElement("link");Si(Me),vr(Me,"link",r),Me._p=new Promise(function(Xe,ht){Me.onload=Xe,Me.onerror=ht}),Me.addEventListener("load",function(){te.loading|=1}),Me.addEventListener("error",function(){te.loading|=2}),te.loading|=4,Cl(V,s,_)}V={type:"stylesheet",instance:V,count:1,state:te},M.set(P,V)}}}function Sp(r,s){No.X(r,s);var d=xc;if(d&&r){var _=fs(d).hoistableScripts,M=Al(r),P=_.get(M);P||(P=d.querySelector(Lh(M)),P||(r=re({src:r,async:!0},s),(s=Ar.get(M))&&Ep(r,s),P=d.createElement("script"),Si(P),vr(P,"link",r),d.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},_.set(M,P))}}function Fm(r,s){No.M(r,s);var d=xc;if(d&&r){var _=fs(d).hoistableScripts,M=Al(r),P=_.get(M);P||(P=d.querySelector(Lh(M)),P||(r=re({src:r,async:!0,type:"module"},s),(s=Ar.get(M))&&Ep(r,s),P=d.createElement("script"),Si(P),vr(P,"link",r),d.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},_.set(M,P))}}function jm(r,s,d,_){var M=(M=Xt.current)?Tp(M):null;if(!M)throw Error(S(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(s=Au(d.href),d=fs(M).hoistableStyles,_=d.get(s),_||(_={type:"style",instance:null,count:0,state:null},d.set(s,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=Au(d.href);var P=fs(M).hoistableStyles,V=P.get(r);if(V||(M=M.ownerDocument||M,V={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},P.set(r,V),(P=M.querySelector(Rh(r)))&&!P._p&&(V.instance=P,V.state.loading=5),Ar.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Ar.set(r,d),P||Vm(M,r,d,V.state))),s&&_===null)throw Error(S(528,""));return V}if(s&&_!==null)throw Error(S(529,""));return null;case"script":return s=d.async,d=d.src,typeof d=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Al(d),d=fs(M).hoistableScripts,_=d.get(s),_||(_={type:"script",instance:null,count:0,state:null},d.set(s,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,r))}}function Au(r){return'href="'+kr(r)+'"'}function Rh(r){return'link[rel="stylesheet"]['+r+"]"}function Um(r){return re({},r,{"data-precedence":r.precedence,precedence:null})}function Vm(r,s,d,_){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?_.loading=1:(s=r.createElement("link"),_.preload=s,s.addEventListener("load",function(){return _.loading|=1}),s.addEventListener("error",function(){return _.loading|=2}),vr(s,"link",d),Si(s),r.head.appendChild(s))}function Al(r){return'[src="'+kr(r)+'"]'}function Lh(r){return"script[async]"+r}function qm(r,s,d){if(s.count++,s.instance===null)switch(s.type){case"style":var _=r.querySelector('style[data-href~="'+kr(d.href)+'"]');if(_)return s.instance=_,Si(_),_;var M=re({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return _=(r.ownerDocument||r).createElement("style"),Si(_),vr(_,"style",M),Cl(_,d.precedence,r),s.instance=_;case"stylesheet":M=Au(d.href);var P=r.querySelector(Rh(M));if(P)return s.state.loading|=4,s.instance=P,Si(P),P;_=Um(d),(M=Ar.get(M))&&qd(_,M),P=(r.ownerDocument||r).createElement("link"),Si(P);var V=P;return V._p=new Promise(function(te,Me){V.onload=te,V.onerror=Me}),vr(P,"link",_),s.state.loading|=4,Cl(P,d.precedence,r),s.instance=P;case"script":return P=Al(d.src),(M=r.querySelector(Lh(P)))?(s.instance=M,Si(M),M):(_=d,(M=Ar.get(P))&&(_=re({},d),Ep(_,M)),r=r.ownerDocument||r,M=r.createElement("script"),Si(M),vr(M,"link",_),r.head.appendChild(M),s.instance=M);case"void":return null;default:throw Error(S(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(_=s.instance,s.state.loading|=4,Cl(_,d.precedence,r));return s.instance}function Cl(r,s,d){for(var _=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),M=_.length?_[_.length-1]:null,P=M,V=0;V<_.length;V++){var te=_[V];if(te.dataset.precedence===s)P=te;else if(P!==M)break}P?P.parentNode.insertBefore(r,P.nextSibling):(s=d.nodeType===9?d.head:d,s.insertBefore(r,s.firstChild))}function qd(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function Ep(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Mp=null;function Gm(r,s,d){if(Mp===null){var _=new Map,M=Mp=new Map;M.set(d,_)}else M=Mp,_=M.get(d),_||(_=new Map,M.set(d,_));if(_.has(r))return _;for(_.set(r,null),d=d.getElementsByTagName(r),M=0;M<d.length;M++){var P=d[M];if(!(P[sn]||P[ni]||r==="link"&&P.getAttribute("rel")==="stylesheet")&&P.namespaceURI!=="http://www.w3.org/2000/svg"){var V=P.getAttribute(s)||"";V=r+V;var te=_.get(V);te?te.push(P):_.set(V,[P])}}return _}function Gd(r,s,d){r=r.ownerDocument||r,r.head.insertBefore(d,s==="title"?r.querySelector("head > title"):null)}function Ap(r,s,d){if(d===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(r=s.disabled,typeof s.precedence=="string"&&r==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Zd(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function Zm(r,s,d,_){if(d.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var M=Au(_.href),P=s.querySelector(Rh(M));if(P){s=P._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=$d.bind(r),s.then(r,r)),d.state.loading|=4,d.instance=P,Si(P);return}P=s.ownerDocument||s,_=Um(_),(M=Ar.get(M))&&qd(_,M),P=P.createElement("link"),Si(P);var V=P;V._p=new Promise(function(te,Me){V.onload=te,V.onerror=Me}),vr(P,"link",_),d.instance=P}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,s),(s=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=$d.bind(r),s.addEventListener("load",d),s.addEventListener("error",d))}}var Hd=0;function Hm(r,s){return r.stylesheets&&r.count===0&&Yd(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var _=setTimeout(function(){if(r.stylesheets&&Yd(r,r.stylesheets),r.unsuspend){var P=r.unsuspend;r.unsuspend=null,P()}},6e4+s);0<r.imgBytes&&Hd===0&&(Hd=62500*Ih());var M=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Yd(r,r.stylesheets),r.unsuspend)){var P=r.unsuspend;r.unsuspend=null,P()}},(r.imgBytes>Hd?50:800)+s);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(_),clearTimeout(M)}}:null}function $d(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Yd(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Xd=null;function Yd(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Xd=new Map,s.forEach(ty,r),Xd=null,$d.call(r))}function ty(r,s){if(!(s.state.loading&4)){var d=Xd.get(r);if(d)var _=d.get(null);else{d=new Map,Xd.set(r,d);for(var M=r.querySelectorAll("link[data-precedence],style[data-precedence]"),P=0;P<M.length;P++){var V=M[P];(V.nodeName==="LINK"||V.getAttribute("media")!=="not all")&&(d.set(V.dataset.precedence,V),_=V)}_&&d.set(null,_)}M=s.instance,V=M.getAttribute("data-precedence"),P=d.get(V)||_,P===_&&d.set(null,M),d.set(V,M),this.count++,_=$d.bind(this),M.addEventListener("load",_),M.addEventListener("error",_),P?P.parentNode.insertBefore(M,P.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(M,r.firstChild)),s.state.loading|=4}}var Oh={$$typeof:it,Provider:null,Consumer:null,_currentValue:pt,_currentValue2:pt,_threadCount:0};function t_(r,s,d,_,M,P,V,te,Me){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Tn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tn(0),this.hiddenUpdates=Tn(null),this.identifierPrefix=_,this.onUncaughtError=M,this.onCaughtError=P,this.onRecoverableError=V,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Me,this.incompleteTransitions=new Map}function $m(r,s,d,_,M,P,V,te,Me,Xe,ht,yt){return r=new t_(r,s,d,V,Me,Xe,ht,yt,te),s=1,P===!0&&(s|=24),P=ca(3,null,null,s),r.current=P,P.stateNode=r,s=Ms(),s.refCount++,r.pooledCache=s,s.refCount++,P.memoizedState={element:_,isDehydrated:d,cache:s},fh(P),r}function ny(r){return r?(r=hn,r):hn}function iy(r,s,d,_,M,P){M=ny(M),_.context===null?_.context=M:_.pendingContext=M,_=Ps(s),_.payload={element:d},P=P===void 0?null:P,P!==null&&(_.callback=P),d=Ks(r,_,s),d!==null&&(Fa(d,r,s),Da(d,r,s))}function Cp(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function zp(r,s){Cp(r,s),(r=r.alternate)&&Cp(r,s)}function ry(r){if(r.tag===13||r.tag===31){var s=Aa(r,67108864);s!==null&&Fa(s,r,67108864),zp(r,67108864)}}function ay(r){if(r.tag===13||r.tag===31){var s=Na();s=Go(s);var d=Aa(r,s);d!==null&&Fa(d,r,s),zp(r,s)}}var Kd=!0;function Wd(r,s,d,_){var M=Te.T;Te.T=null;var P=He.p;try{He.p=2,Xm(r,s,d,_)}finally{He.p=P,Te.T=M}}function sy(r,s,d,_){var M=Te.T;Te.T=null;var P=He.p;try{He.p=8,Xm(r,s,d,_)}finally{He.p=P,Te.T=M}}function Xm(r,s,d,_){if(Kd){var M=Qd(_);if(M===null)Bo(r,s,_,Bh,d),oy(r,_);else if(i_(M,r,s,d,_))_.stopPropagation();else if(oy(r,_),s&4&&-1<n_.indexOf(r)){for(;M!==null;){var P=js(M);if(P!==null)switch(P.tag){case 3:if(P=P.stateNode,P.current.memoizedState.isDehydrated){var V=Ne(P.pendingLanes);if(V!==0){var te=P;for(te.pendingLanes|=2,te.entangledLanes|=2;V;){var Me=1<<31-Qe(V);te.entanglements[1]|=Me,V&=~Me}ao(P),(ei&6)===0&&(Id=Ti()+500,rs(0))}}break;case 31:case 13:te=Aa(P,2),te!==null&&Fa(te,P,2),Rd(),zp(P,2)}if(P=Qd(_),P===null&&Bo(r,s,_,Bh,d),P===M)break;M=P}M!==null&&_.stopPropagation()}else Bo(r,s,_,null,d)}}function Qd(r){return r=Bc(r),Dp(r)}var Bh=null;function Dp(r){if(Bh=null,r=hs(r),r!==null){var s=k(r);if(s===null)r=null;else{var d=s.tag;if(d===13){if(r=A(s),r!==null)return r;r=null}else if(d===31){if(r=l(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Bh=r,null}function Cu(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Qi()){case fe:return 2;case H:return 8;case $:case Q:return 32;case de:return 268435456;default:return 32}default:return 32}}var Pp=!1,wc=null,Bs=null,Tc=null,Jd=new Map,Nh=new Map,zl=[],n_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function oy(r,s){switch(r){case"focusin":case"focusout":wc=null;break;case"dragenter":case"dragleave":Bs=null;break;case"mouseover":case"mouseout":Tc=null;break;case"pointerover":case"pointerout":Jd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nh.delete(s.pointerId)}}function ef(r,s,d,_,M,P){return r===null||r.nativeEvent!==P?(r={blockedOn:s,domEventName:d,eventSystemFlags:_,nativeEvent:P,targetContainers:[M]},s!==null&&(s=js(s),s!==null&&ry(s)),r):(r.eventSystemFlags|=_,s=r.targetContainers,M!==null&&s.indexOf(M)===-1&&s.push(M),r)}function i_(r,s,d,_,M){switch(s){case"focusin":return wc=ef(wc,r,s,d,_,M),!0;case"dragenter":return Bs=ef(Bs,r,s,d,_,M),!0;case"mouseover":return Tc=ef(Tc,r,s,d,_,M),!0;case"pointerover":var P=M.pointerId;return Jd.set(P,ef(Jd.get(P)||null,r,s,d,_,M)),!0;case"gotpointercapture":return P=M.pointerId,Nh.set(P,ef(Nh.get(P)||null,r,s,d,_,M)),!0}return!1}function ly(r){var s=hs(r.target);if(s!==null){var d=k(s);if(d!==null){if(s=d.tag,s===13){if(s=A(d),s!==null){r.blockedOn=s,wr(r.priority,function(){ay(d)});return}}else if(s===31){if(s=l(d),s!==null){r.blockedOn=s,wr(r.priority,function(){ay(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function tf(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=Qd(r.nativeEvent);if(d===null){d=r.nativeEvent;var _=new d.constructor(d.type,d);Qh=_,d.target.dispatchEvent(_),Qh=null}else return s=js(d),s!==null&&ry(s),r.blockedOn=d,!1;s.shift()}return!0}function cy(r,s,d){tf(r)&&d.delete(s)}function nf(){Pp=!1,wc!==null&&tf(wc)&&(wc=null),Bs!==null&&tf(Bs)&&(Bs=null),Tc!==null&&tf(Tc)&&(Tc=null),Jd.forEach(cy),Nh.forEach(cy)}function Ip(r,s){r.blockedOn===s&&(r.blockedOn=null,Pp||(Pp=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,nf)))}var kp=null;function uy(r){kp!==r&&(kp=r,h.unstable_scheduleCallback(h.unstable_NormalPriority,function(){kp===r&&(kp=null);for(var s=0;s<r.length;s+=3){var d=r[s],_=r[s+1],M=r[s+2];if(typeof _!="function"){if(Dp(_||d)===null)continue;break}var P=js(d);P!==null&&(r.splice(s,3),s-=3,Ci(P,{pending:!0,data:M,method:d.method,action:_},_,M))}}))}function Sc(r){function s(Me){return Ip(Me,r)}wc!==null&&Ip(wc,r),Bs!==null&&Ip(Bs,r),Tc!==null&&Ip(Tc,r),Jd.forEach(s),Nh.forEach(s);for(var d=0;d<zl.length;d++){var _=zl[d];_.blockedOn===r&&(_.blockedOn=null)}for(;0<zl.length&&(d=zl[0],d.blockedOn===null);)ly(d),d.blockedOn===null&&zl.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(_=0;_<d.length;_+=3){var M=d[_],P=d[_+1],V=M[At]||null;if(typeof P=="function")V||uy(d);else if(V){var te=null;if(P&&P.hasAttribute("formAction")){if(M=P,V=P[At]||null)te=V.formAction;else if(Dp(M)!==null)continue}else te=V.action;typeof te=="function"?d[_+1]=te:(d.splice(_,3),_-=3),uy(d)}}}function Ym(){function r(P){P.canIntercept&&P.info==="react-transition"&&P.intercept({handler:function(){return new Promise(function(V){return M=V})},focusReset:"manual",scroll:"manual"})}function s(){M!==null&&(M(),M=null),_||setTimeout(d,20)}function d(){if(!_&&!navigation.transition){var P=navigation.currentEntry;P&&P.url!=null&&navigation.navigate(P.url,{state:P.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var _=!1,M=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(d,100),function(){_=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),M!==null&&(M(),M=null)}}}function Km(r){this._internalRoot=r}Rp.prototype.render=Km.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(S(409));var d=s.current,_=Na();iy(d,_,r,s,null,null)},Rp.prototype.unmount=Km.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;iy(r.current,2,null,r,null,null),Rd(),s[ln]=null}};function Rp(r){this._internalRoot=r}Rp.prototype.unstable_scheduleHydration=function(r){if(r){var s=br();r={blockedOn:null,target:r,priority:s};for(var d=0;d<zl.length&&s!==0&&s<zl[d].priority;d++);zl.splice(d,0,r),d===0&&ly(r)}};var Wm=m.version;if(Wm!=="19.2.3")throw Error(S(527,Wm,"19.2.3"));He.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(S(188)):(r=Object.keys(r).join(","),Error(S(268,r)));return r=K(s),r=r!==null?ne(r):null,r=r===null?null:r.stateNode,r};var hy={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Te,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lp.isDisabled&&Lp.supportsFiber)try{ke=Lp.inject(hy),ye=Lp}catch{}}return ig.createRoot=function(r,s){if(!z(r))throw Error(S(299));var d=!1,_="",M=yh,P=to,V=no;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(_=s.identifierPrefix),s.onUncaughtError!==void 0&&(M=s.onUncaughtError),s.onCaughtError!==void 0&&(P=s.onCaughtError),s.onRecoverableError!==void 0&&(V=s.onRecoverableError)),s=$m(r,1,!1,null,null,d,_,null,M,P,V,Ym),r[ln]=s.current,Cm(r),new Km(s)},ig.hydrateRoot=function(r,s,d){if(!z(r))throw Error(S(299));var _=!1,M="",P=yh,V=to,te=no,Me=null;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(M=d.identifierPrefix),d.onUncaughtError!==void 0&&(P=d.onUncaughtError),d.onCaughtError!==void 0&&(V=d.onCaughtError),d.onRecoverableError!==void 0&&(te=d.onRecoverableError),d.formState!==void 0&&(Me=d.formState)),s=$m(r,1,!0,s,d??null,_,M,Me,P,V,te,Ym),s.context=ny(null),d=s.current,_=Na(),_=Go(_),M=Ps(_),M.callback=null,Ks(d,M,_),d=_,s.current.lanes=d,Sn(s,d),ao(s),r[ln]=s.current,Cm(r),new Rp(s)},ig.version="19.2.3",ig}var av;function L1(){if(av)return m_.exports;av=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(m){console.error(m)}}return h(),m_.exports=R1(),m_.exports}var O1=L1();const B1=Iy(O1),N1="modulepreload",F1=function(h){return"/parlens-pwa/"+h},sv={},ix=function(m,b,S){let z=Promise.resolve();if(b&&b.length>0){let K=function(ne){return Promise.all(ne.map(re=>Promise.resolve(re).then(Ee=>({status:"fulfilled",value:Ee}),Ee=>({status:"rejected",reason:Ee}))))};var A=K;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),N=l?.nonce||l?.getAttribute("nonce");z=K(b.map(ne=>{if(ne=F1(ne),ne in sv)return;sv[ne]=!0;const re=ne.endsWith(".css"),Ee=re?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${ne}"]${Ee}`))return;const Ae=document.createElement("link");if(Ae.rel=re?"stylesheet":N1,re||(Ae.as="script"),Ae.crossOrigin="",Ae.href=ne,N&&Ae.setAttribute("nonce",N),document.head.appendChild(Ae),re)return new Promise((Pe,pe)=>{Ae.addEventListener("load",Pe),Ae.addEventListener("error",()=>pe(new Error(`Unable to preload CSS for ${ne}`)))})}))}function k(l){const N=new Event("vite:preloadError",{cancelable:!0});if(N.payload=l,window.dispatchEvent(N),!N.defaultPrevented)throw l}return z.then(l=>{for(const N of l||[])N.status==="rejected"&&k(N.reason);return m().catch(k)})};function ov(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`Wrong positive integer: ${h}`)}function rx(h,...m){if(!(h instanceof Uint8Array))throw new Error("Expected Uint8Array");if(m.length>0&&!m.includes(h.length))throw new Error(`Expected Uint8Array of length ${m}, not of length=${h.length}`)}function j1(h){if(typeof h!="function"||typeof h.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ov(h.outputLen),ov(h.blockLen)}function by(h,m=!0){if(h.destroyed)throw new Error("Hash instance has been destroyed");if(m&&h.finished)throw new Error("Hash#digest() has already been called")}function U1(h,m){rx(h);const b=m.outputLen;if(h.length<b)throw new Error(`digestInto() expects output buffer of length at least ${b}`)}const v_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const ax=h=>h instanceof Uint8Array,x_=h=>new DataView(h.buffer,h.byteOffset,h.byteLength),Mc=(h,m)=>h<<32-m|h>>>m,V1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!V1)throw new Error("Non little-endian hardware is not supported");function q1(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function n0(h){if(typeof h=="string"&&(h=q1(h)),!ax(h))throw new Error(`expected Uint8Array, got ${typeof h}`);return h}function G1(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!ax(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}let sx=class{clone(){return this._cloneInto()}};function Z1(h){const m=S=>h().update(n0(S)).digest(),b=h();return m.outputLen=b.outputLen,m.blockLen=b.blockLen,m.create=()=>h(),m}function ox(h=32){if(v_&&typeof v_.getRandomValues=="function")return v_.getRandomValues(new Uint8Array(h));throw new Error("crypto.getRandomValues must be defined")}function H1(h,m,b,S){if(typeof h.setBigUint64=="function")return h.setBigUint64(m,b,S);const z=BigInt(32),k=BigInt(4294967295),A=Number(b>>z&k),l=Number(b&k),N=S?4:0,K=S?0:4;h.setUint32(m+N,A,S),h.setUint32(m+K,l,S)}let $1=class extends sx{constructor(m,b,S,z){super(),this.blockLen=m,this.outputLen=b,this.padOffset=S,this.isLE=z,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=x_(this.buffer)}update(m){by(this);const{view:b,buffer:S,blockLen:z}=this;m=n0(m);const k=m.length;for(let A=0;A<k;){const l=Math.min(z-this.pos,k-A);if(l===z){const N=x_(m);for(;z<=k-A;A+=z)this.process(N,A);continue}S.set(m.subarray(A,A+l),this.pos),this.pos+=l,A+=l,this.pos===z&&(this.process(b,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){by(this),U1(m,this),this.finished=!0;const{buffer:b,view:S,blockLen:z,isLE:k}=this;let{pos:A}=this;b[A++]=128,this.buffer.subarray(A).fill(0),this.padOffset>z-A&&(this.process(S,0),A=0);for(let re=A;re<z;re++)b[re]=0;H1(S,z-8,BigInt(this.length*8),k),this.process(S,0);const l=x_(m),N=this.outputLen;if(N%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const K=N/4,ne=this.get();if(K>ne.length)throw new Error("_sha2: outputLen bigger than state");for(let re=0;re<K;re++)l.setUint32(4*re,ne[re],k)}digest(){const{buffer:m,outputLen:b}=this;this.digestInto(m);const S=m.slice(0,b);return this.destroy(),S}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:b,buffer:S,length:z,finished:k,destroyed:A,pos:l}=this;return m.length=z,m.pos=l,m.finished=k,m.destroyed=A,z%b&&m.buffer.set(S),m}};const X1=(h,m,b)=>h&m^~h&b,Y1=(h,m,b)=>h&m^h&b^m&b,K1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),jh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Uh=new Uint32Array(64);let W1=class extends $1{constructor(){super(64,32,8,!1),this.A=jh[0]|0,this.B=jh[1]|0,this.C=jh[2]|0,this.D=jh[3]|0,this.E=jh[4]|0,this.F=jh[5]|0,this.G=jh[6]|0,this.H=jh[7]|0}get(){const{A:m,B:b,C:S,D:z,E:k,F:A,G:l,H:N}=this;return[m,b,S,z,k,A,l,N]}set(m,b,S,z,k,A,l,N){this.A=m|0,this.B=b|0,this.C=S|0,this.D=z|0,this.E=k|0,this.F=A|0,this.G=l|0,this.H=N|0}process(m,b){for(let re=0;re<16;re++,b+=4)Uh[re]=m.getUint32(b,!1);for(let re=16;re<64;re++){const Ee=Uh[re-15],Ae=Uh[re-2],Pe=Mc(Ee,7)^Mc(Ee,18)^Ee>>>3,pe=Mc(Ae,17)^Mc(Ae,19)^Ae>>>10;Uh[re]=pe+Uh[re-7]+Pe+Uh[re-16]|0}let{A:S,B:z,C:k,D:A,E:l,F:N,G:K,H:ne}=this;for(let re=0;re<64;re++){const Ee=Mc(l,6)^Mc(l,11)^Mc(l,25),Ae=ne+Ee+X1(l,N,K)+K1[re]+Uh[re]|0,pe=(Mc(S,2)^Mc(S,13)^Mc(S,22))+Y1(S,z,k)|0;ne=K,K=N,N=l,l=A+Ae|0,A=k,k=z,z=S,S=Ae+pe|0}S=S+this.A|0,z=z+this.B|0,k=k+this.C|0,A=A+this.D|0,l=l+this.E|0,N=N+this.F|0,K=K+this.G|0,ne=ne+this.H|0,this.set(S,z,k,A,l,N,K,ne)}roundClean(){Uh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const R_=Z1(()=>new W1);const lx=BigInt(0),ky=BigInt(1),Q1=BigInt(2),Ry=h=>h instanceof Uint8Array,J1=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function Vp(h){if(!Ry(h))throw new Error("Uint8Array expected");let m="";for(let b=0;b<h.length;b++)m+=J1[h[b]];return m}function cx(h){const m=h.toString(16);return m.length&1?`0${m}`:m}function i0(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);return BigInt(h===""?"0":`0x${h}`)}function qp(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const b=new Uint8Array(m/2);for(let S=0;S<b.length;S++){const z=S*2,k=h.slice(z,z+2),A=Number.parseInt(k,16);if(Number.isNaN(A)||A<0)throw new Error("Invalid byte sequence");b[S]=A}return b}function Fs(h){return i0(Vp(h))}function r0(h){if(!Ry(h))throw new Error("Uint8Array expected");return i0(Vp(Uint8Array.from(h).reverse()))}function Hh(h,m){return qp(h.toString(16).padStart(m*2,"0"))}function a0(h,m){return Hh(h,m).reverse()}function ew(h){return qp(cx(h))}function Va(h,m,b){let S;if(typeof m=="string")try{S=qp(m)}catch(k){throw new Error(`${h} must be valid hex string, got "${m}". Cause: ${k}`)}else if(Ry(m))S=Uint8Array.from(m);else throw new Error(`${h} must be hex string or Uint8Array`);const z=S.length;if(typeof b=="number"&&z!==b)throw new Error(`${h} expected ${b} bytes, got ${z}`);return S}function pf(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!Ry(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}function tw(h,m){if(h.length!==m.length)return!1;for(let b=0;b<h.length;b++)if(h[b]!==m[b])return!1;return!0}function nw(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function iw(h){let m;for(m=0;h>lx;h>>=ky,m+=1);return m}function rw(h,m){return h>>BigInt(m)&ky}const aw=(h,m,b)=>h|(b?ky:lx)<<BigInt(m),s0=h=>(Q1<<BigInt(h-1))-ky,b_=h=>new Uint8Array(h),lv=h=>Uint8Array.from(h);function ux(h,m,b){if(typeof h!="number"||h<2)throw new Error("hashLen must be a number");if(typeof m!="number"||m<2)throw new Error("qByteLen must be a number");if(typeof b!="function")throw new Error("hmacFn must be a function");let S=b_(h),z=b_(h),k=0;const A=()=>{S.fill(1),z.fill(0),k=0},l=(...re)=>b(z,S,...re),N=(re=b_())=>{z=l(lv([0]),re),S=l(),re.length!==0&&(z=l(lv([1]),re),S=l())},K=()=>{if(k++>=1e3)throw new Error("drbg: tried 1000 values");let re=0;const Ee=[];for(;re<m;){S=l();const Ae=S.slice();Ee.push(Ae),re+=S.length}return pf(...Ee)};return(re,Ee)=>{A(),N(re);let Ae;for(;!(Ae=Ee(K()));)N();return A(),Ae}}const sw={bigint:h=>typeof h=="bigint",function:h=>typeof h=="function",boolean:h=>typeof h=="boolean",string:h=>typeof h=="string",stringOrUint8Array:h=>typeof h=="string"||h instanceof Uint8Array,isSafeInteger:h=>Number.isSafeInteger(h),array:h=>Array.isArray(h),field:(h,m)=>m.Fp.isValid(h),hash:h=>typeof h=="function"&&Number.isSafeInteger(h.outputLen)};function fg(h,m,b={}){const S=(z,k,A)=>{const l=sw[k];if(typeof l!="function")throw new Error(`Invalid validator "${k}", expected function`);const N=h[z];if(!(A&&N===void 0)&&!l(N,h))throw new Error(`Invalid param ${String(z)}=${N} (${typeof N}), expected ${k}`)};for(const[z,k]of Object.entries(m))S(z,k,!1);for(const[z,k]of Object.entries(b))S(z,k,!0);return h}const ow=Object.freeze(Object.defineProperty({__proto__:null,bitGet:rw,bitLen:iw,bitMask:s0,bitSet:aw,bytesToHex:Vp,bytesToNumberBE:Fs,bytesToNumberLE:r0,concatBytes:pf,createHmacDrbg:ux,ensureBytes:Va,equalBytes:tw,hexToBytes:qp,hexToNumber:i0,numberToBytesBE:Hh,numberToBytesLE:a0,numberToHexUnpadded:cx,numberToVarBytesBE:ew,utf8ToBytes:nw,validateObject:fg},Symbol.toStringTag,{value:"Module"}));const ta=BigInt(0),xr=BigInt(1),uf=BigInt(2),lw=BigInt(3),L_=BigInt(4),cv=BigInt(5),uv=BigInt(8);BigInt(9);BigInt(16);function ba(h,m){const b=h%m;return b>=ta?b:m+b}function cw(h,m,b){if(b<=ta||m<ta)throw new Error("Expected power/modulo > 0");if(b===xr)return ta;let S=xr;for(;m>ta;)m&xr&&(S=S*h%b),h=h*h%b,m>>=xr;return S}function jo(h,m,b){let S=h;for(;m-- >ta;)S*=S,S%=b;return S}function O_(h,m){if(h===ta||m<=ta)throw new Error(`invert: expected positive integers, got n=${h} mod=${m}`);let b=ba(h,m),S=m,z=ta,k=xr;for(;b!==ta;){const l=S/b,N=S%b,K=z-k*l;S=b,b=N,z=k,k=K}if(S!==xr)throw new Error("invert: does not exist");return ba(z,m)}function uw(h){const m=(h-xr)/uf;let b,S,z;for(b=h-xr,S=0;b%uf===ta;b/=uf,S++);for(z=uf;z<h&&cw(z,m,h)!==h-xr;z++);if(S===1){const A=(h+xr)/L_;return function(N,K){const ne=N.pow(K,A);if(!N.eql(N.sqr(ne),K))throw new Error("Cannot find square root");return ne}}const k=(b+xr)/uf;return function(l,N){if(l.pow(N,m)===l.neg(l.ONE))throw new Error("Cannot find square root");let K=S,ne=l.pow(l.mul(l.ONE,z),b),re=l.pow(N,k),Ee=l.pow(N,b);for(;!l.eql(Ee,l.ONE);){if(l.eql(Ee,l.ZERO))return l.ZERO;let Ae=1;for(let pe=l.sqr(Ee);Ae<K&&!l.eql(pe,l.ONE);Ae++)pe=l.sqr(pe);const Pe=l.pow(ne,xr<<BigInt(K-Ae-1));ne=l.sqr(Pe),re=l.mul(re,Pe),Ee=l.mul(Ee,ne),K=Ae}return re}}function hw(h){if(h%L_===lw){const m=(h+xr)/L_;return function(S,z){const k=S.pow(z,m);if(!S.eql(S.sqr(k),z))throw new Error("Cannot find square root");return k}}if(h%uv===cv){const m=(h-cv)/uv;return function(S,z){const k=S.mul(z,uf),A=S.pow(k,m),l=S.mul(z,A),N=S.mul(S.mul(l,uf),A),K=S.mul(l,S.sub(N,S.ONE));if(!S.eql(S.sqr(K),z))throw new Error("Cannot find square root");return K}}return uw(h)}const dw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function fw(h){const m={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},b=dw.reduce((S,z)=>(S[z]="function",S),m);return fg(h,b)}function pw(h,m,b){if(b<ta)throw new Error("Expected power > 0");if(b===ta)return h.ONE;if(b===xr)return m;let S=h.ONE,z=m;for(;b>ta;)b&xr&&(S=h.mul(S,z)),z=h.sqr(z),b>>=xr;return S}function mw(h,m){const b=new Array(m.length),S=m.reduce((k,A,l)=>h.is0(A)?k:(b[l]=k,h.mul(k,A)),h.ONE),z=h.inv(S);return m.reduceRight((k,A,l)=>h.is0(A)?k:(b[l]=h.mul(k,b[l]),h.mul(k,A)),z),b}function hx(h,m){const b=m!==void 0?m:h.toString(2).length,S=Math.ceil(b/8);return{nBitLength:b,nByteLength:S}}function gw(h,m,b=!1,S={}){if(h<=ta)throw new Error(`Expected Field ORDER > 0, got ${h}`);const{nBitLength:z,nByteLength:k}=hx(h,m);if(k>2048)throw new Error("Field lengths over 2048 bytes are not supported");const A=hw(h),l=Object.freeze({ORDER:h,BITS:z,BYTES:k,MASK:s0(z),ZERO:ta,ONE:xr,create:N=>ba(N,h),isValid:N=>{if(typeof N!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof N}`);return ta<=N&&N<h},is0:N=>N===ta,isOdd:N=>(N&xr)===xr,neg:N=>ba(-N,h),eql:(N,K)=>N===K,sqr:N=>ba(N*N,h),add:(N,K)=>ba(N+K,h),sub:(N,K)=>ba(N-K,h),mul:(N,K)=>ba(N*K,h),pow:(N,K)=>pw(l,N,K),div:(N,K)=>ba(N*O_(K,h),h),sqrN:N=>N*N,addN:(N,K)=>N+K,subN:(N,K)=>N-K,mulN:(N,K)=>N*K,inv:N=>O_(N,h),sqrt:S.sqrt||(N=>A(l,N)),invertBatch:N=>mw(l,N),cmov:(N,K,ne)=>ne?K:N,toBytes:N=>b?a0(N,k):Hh(N,k),fromBytes:N=>{if(N.length!==k)throw new Error(`Fp.fromBytes: expected ${k}, got ${N.length}`);return b?r0(N):Fs(N)}});return Object.freeze(l)}function dx(h){if(typeof h!="bigint")throw new Error("field order must be bigint");const m=h.toString(2).length;return Math.ceil(m/8)}function fx(h){const m=dx(h);return m+Math.ceil(m/2)}function yw(h,m,b=!1){const S=h.length,z=dx(m),k=fx(m);if(S<16||S<k||S>1024)throw new Error(`expected ${k}-1024 bytes of input, got ${S}`);const A=b?Fs(h):r0(h),l=ba(A,m-xr)+xr;return b?a0(l,z):Hh(l,z)}const _w=BigInt(0),w_=BigInt(1);function vw(h,m){const b=(z,k)=>{const A=k.negate();return z?A:k},S=z=>{const k=Math.ceil(m/z)+1,A=2**(z-1);return{windows:k,windowSize:A}};return{constTimeNegate:b,unsafeLadder(z,k){let A=h.ZERO,l=z;for(;k>_w;)k&w_&&(A=A.add(l)),l=l.double(),k>>=w_;return A},precomputeWindow(z,k){const{windows:A,windowSize:l}=S(k),N=[];let K=z,ne=K;for(let re=0;re<A;re++){ne=K,N.push(ne);for(let Ee=1;Ee<l;Ee++)ne=ne.add(K),N.push(ne);K=ne.double()}return N},wNAF(z,k,A){const{windows:l,windowSize:N}=S(z);let K=h.ZERO,ne=h.BASE;const re=BigInt(2**z-1),Ee=2**z,Ae=BigInt(z);for(let Pe=0;Pe<l;Pe++){const pe=Pe*N;let ie=Number(A&re);A>>=Ae,ie>N&&(ie-=Ee,A+=w_);const Re=pe,We=pe+Math.abs(ie)-1,it=Pe%2!==0,Dt=ie<0;ie===0?ne=ne.add(b(it,k[Re])):K=K.add(b(Dt,k[We]))}return{p:K,f:ne}},wNAFCached(z,k,A,l){const N=z._WINDOW_SIZE||1;let K=k.get(z);return K||(K=this.precomputeWindow(z,N),N!==1&&k.set(z,l(K))),this.wNAF(N,K,A)}}}function px(h){return fw(h.Fp),fg(h,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...hx(h.n,h.nBitLength),...h,p:h.Fp.ORDER})}function xw(h){const m=px(h);fg(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:b,Fp:S,a:z}=m;if(b){if(!S.eql(z,S.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof b!="object"||typeof b.beta!="bigint"||typeof b.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})}const{bytesToNumberBE:bw,hexToBytes:ww}=ow,df={Err:class extends Error{constructor(m=""){super(m)}},_parseInt(h){const{Err:m}=df;if(h.length<2||h[0]!==2)throw new m("Invalid signature integer tag");const b=h[1],S=h.subarray(2,b+2);if(!b||S.length!==b)throw new m("Invalid signature integer: wrong length");if(S[0]&128)throw new m("Invalid signature integer: negative");if(S[0]===0&&!(S[1]&128))throw new m("Invalid signature integer: unnecessary leading zero");return{d:bw(S),l:h.subarray(b+2)}},toSig(h){const{Err:m}=df,b=typeof h=="string"?ww(h):h;if(!(b instanceof Uint8Array))throw new Error("ui8a expected");let S=b.length;if(S<2||b[0]!=48)throw new m("Invalid signature tag");if(b[1]!==S-2)throw new m("Invalid signature: incorrect length");const{d:z,l:k}=df._parseInt(b.subarray(2)),{d:A,l}=df._parseInt(k);if(l.length)throw new m("Invalid signature: left bytes after parsing");return{r:z,s:A}},hexFromSig(h){const m=K=>Number.parseInt(K[0],16)&8?"00"+K:K,b=K=>{const ne=K.toString(16);return ne.length&1?`0${ne}`:ne},S=m(b(h.s)),z=m(b(h.r)),k=S.length/2,A=z.length/2,l=b(k),N=b(A);return`30${b(A+k+4)}02${N}${z}02${l}${S}`}},ku=BigInt(0),Uo=BigInt(1);BigInt(2);const hv=BigInt(3);BigInt(4);function Tw(h){const m=xw(h),{Fp:b}=m,S=m.toBytes||((Pe,pe,ie)=>{const Re=pe.toAffine();return pf(Uint8Array.from([4]),b.toBytes(Re.x),b.toBytes(Re.y))}),z=m.fromBytes||(Pe=>{const pe=Pe.subarray(1),ie=b.fromBytes(pe.subarray(0,b.BYTES)),Re=b.fromBytes(pe.subarray(b.BYTES,2*b.BYTES));return{x:ie,y:Re}});function k(Pe){const{a:pe,b:ie}=m,Re=b.sqr(Pe),We=b.mul(Re,Pe);return b.add(b.add(We,b.mul(Pe,pe)),ie)}if(!b.eql(b.sqr(m.Gy),k(m.Gx)))throw new Error("bad generator point: equation left != right");function A(Pe){return typeof Pe=="bigint"&&ku<Pe&&Pe<m.n}function l(Pe){if(!A(Pe))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function N(Pe){const{allowedPrivateKeyLengths:pe,nByteLength:ie,wrapPrivateKey:Re,n:We}=m;if(pe&&typeof Pe!="bigint"){if(Pe instanceof Uint8Array&&(Pe=Vp(Pe)),typeof Pe!="string"||!pe.includes(Pe.length))throw new Error("Invalid key");Pe=Pe.padStart(ie*2,"0")}let it;try{it=typeof Pe=="bigint"?Pe:Fs(Va("private key",Pe,ie))}catch{throw new Error(`private key must be ${ie} bytes, hex or bigint, not ${typeof Pe}`)}return Re&&(it=ba(it,We)),l(it),it}const K=new Map;function ne(Pe){if(!(Pe instanceof re))throw new Error("ProjectivePoint expected")}class re{constructor(pe,ie,Re){if(this.px=pe,this.py=ie,this.pz=Re,pe==null||!b.isValid(pe))throw new Error("x required");if(ie==null||!b.isValid(ie))throw new Error("y required");if(Re==null||!b.isValid(Re))throw new Error("z required")}static fromAffine(pe){const{x:ie,y:Re}=pe||{};if(!pe||!b.isValid(ie)||!b.isValid(Re))throw new Error("invalid affine point");if(pe instanceof re)throw new Error("projective point not allowed");const We=it=>b.eql(it,b.ZERO);return We(ie)&&We(Re)?re.ZERO:new re(ie,Re,b.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(pe){const ie=b.invertBatch(pe.map(Re=>Re.pz));return pe.map((Re,We)=>Re.toAffine(ie[We])).map(re.fromAffine)}static fromHex(pe){const ie=re.fromAffine(z(Va("pointHex",pe)));return ie.assertValidity(),ie}static fromPrivateKey(pe){return re.BASE.multiply(N(pe))}_setWindowSize(pe){this._WINDOW_SIZE=pe,K.delete(this)}assertValidity(){if(this.is0()){if(m.allowInfinityPoint&&!b.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:pe,y:ie}=this.toAffine();if(!b.isValid(pe)||!b.isValid(ie))throw new Error("bad point: x or y not FE");const Re=b.sqr(ie),We=k(pe);if(!b.eql(Re,We))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:pe}=this.toAffine();if(b.isOdd)return!b.isOdd(pe);throw new Error("Field doesn't support isOdd")}equals(pe){ne(pe);const{px:ie,py:Re,pz:We}=this,{px:it,py:Dt,pz:bt}=pe,rt=b.eql(b.mul(ie,bt),b.mul(it,We)),at=b.eql(b.mul(Re,bt),b.mul(Dt,We));return rt&&at}negate(){return new re(this.px,b.neg(this.py),this.pz)}double(){const{a:pe,b:ie}=m,Re=b.mul(ie,hv),{px:We,py:it,pz:Dt}=this;let bt=b.ZERO,rt=b.ZERO,at=b.ZERO,Ie=b.mul(We,We),st=b.mul(it,it),tt=b.mul(Dt,Dt),ct=b.mul(We,it);return ct=b.add(ct,ct),at=b.mul(We,Dt),at=b.add(at,at),bt=b.mul(pe,at),rt=b.mul(Re,tt),rt=b.add(bt,rt),bt=b.sub(st,rt),rt=b.add(st,rt),rt=b.mul(bt,rt),bt=b.mul(ct,bt),at=b.mul(Re,at),tt=b.mul(pe,tt),ct=b.sub(Ie,tt),ct=b.mul(pe,ct),ct=b.add(ct,at),at=b.add(Ie,Ie),Ie=b.add(at,Ie),Ie=b.add(Ie,tt),Ie=b.mul(Ie,ct),rt=b.add(rt,Ie),tt=b.mul(it,Dt),tt=b.add(tt,tt),Ie=b.mul(tt,ct),bt=b.sub(bt,Ie),at=b.mul(tt,st),at=b.add(at,at),at=b.add(at,at),new re(bt,rt,at)}add(pe){ne(pe);const{px:ie,py:Re,pz:We}=this,{px:it,py:Dt,pz:bt}=pe;let rt=b.ZERO,at=b.ZERO,Ie=b.ZERO;const st=m.a,tt=b.mul(m.b,hv);let ct=b.mul(ie,it),Tt=b.mul(Re,Dt),jt=b.mul(We,bt),Gt=b.add(ie,Re),ut=b.add(it,Dt);Gt=b.mul(Gt,ut),ut=b.add(ct,Tt),Gt=b.sub(Gt,ut),ut=b.add(ie,We);let Te=b.add(it,bt);return ut=b.mul(ut,Te),Te=b.add(ct,jt),ut=b.sub(ut,Te),Te=b.add(Re,We),rt=b.add(Dt,bt),Te=b.mul(Te,rt),rt=b.add(Tt,jt),Te=b.sub(Te,rt),Ie=b.mul(st,ut),rt=b.mul(tt,jt),Ie=b.add(rt,Ie),rt=b.sub(Tt,Ie),Ie=b.add(Tt,Ie),at=b.mul(rt,Ie),Tt=b.add(ct,ct),Tt=b.add(Tt,ct),jt=b.mul(st,jt),ut=b.mul(tt,ut),Tt=b.add(Tt,jt),jt=b.sub(ct,jt),jt=b.mul(st,jt),ut=b.add(ut,jt),ct=b.mul(Tt,ut),at=b.add(at,ct),ct=b.mul(Te,ut),rt=b.mul(Gt,rt),rt=b.sub(rt,ct),ct=b.mul(Gt,Tt),Ie=b.mul(Te,Ie),Ie=b.add(Ie,ct),new re(rt,at,Ie)}subtract(pe){return this.add(pe.negate())}is0(){return this.equals(re.ZERO)}wNAF(pe){return Ae.wNAFCached(this,K,pe,ie=>{const Re=b.invertBatch(ie.map(We=>We.pz));return ie.map((We,it)=>We.toAffine(Re[it])).map(re.fromAffine)})}multiplyUnsafe(pe){const ie=re.ZERO;if(pe===ku)return ie;if(l(pe),pe===Uo)return this;const{endo:Re}=m;if(!Re)return Ae.unsafeLadder(this,pe);let{k1neg:We,k1:it,k2neg:Dt,k2:bt}=Re.splitScalar(pe),rt=ie,at=ie,Ie=this;for(;it>ku||bt>ku;)it&Uo&&(rt=rt.add(Ie)),bt&Uo&&(at=at.add(Ie)),Ie=Ie.double(),it>>=Uo,bt>>=Uo;return We&&(rt=rt.negate()),Dt&&(at=at.negate()),at=new re(b.mul(at.px,Re.beta),at.py,at.pz),rt.add(at)}multiply(pe){l(pe);let ie=pe,Re,We;const{endo:it}=m;if(it){const{k1neg:Dt,k1:bt,k2neg:rt,k2:at}=it.splitScalar(ie);let{p:Ie,f:st}=this.wNAF(bt),{p:tt,f:ct}=this.wNAF(at);Ie=Ae.constTimeNegate(Dt,Ie),tt=Ae.constTimeNegate(rt,tt),tt=new re(b.mul(tt.px,it.beta),tt.py,tt.pz),Re=Ie.add(tt),We=st.add(ct)}else{const{p:Dt,f:bt}=this.wNAF(ie);Re=Dt,We=bt}return re.normalizeZ([Re,We])[0]}multiplyAndAddUnsafe(pe,ie,Re){const We=re.BASE,it=(bt,rt)=>rt===ku||rt===Uo||!bt.equals(We)?bt.multiplyUnsafe(rt):bt.multiply(rt),Dt=it(this,ie).add(it(pe,Re));return Dt.is0()?void 0:Dt}toAffine(pe){const{px:ie,py:Re,pz:We}=this,it=this.is0();pe==null&&(pe=it?b.ONE:b.inv(We));const Dt=b.mul(ie,pe),bt=b.mul(Re,pe),rt=b.mul(We,pe);if(it)return{x:b.ZERO,y:b.ZERO};if(!b.eql(rt,b.ONE))throw new Error("invZ was invalid");return{x:Dt,y:bt}}isTorsionFree(){const{h:pe,isTorsionFree:ie}=m;if(pe===Uo)return!0;if(ie)return ie(re,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:pe,clearCofactor:ie}=m;return pe===Uo?this:ie?ie(re,this):this.multiplyUnsafe(m.h)}toRawBytes(pe=!0){return this.assertValidity(),S(re,this,pe)}toHex(pe=!0){return Vp(this.toRawBytes(pe))}}re.BASE=new re(m.Gx,m.Gy,b.ONE),re.ZERO=new re(b.ZERO,b.ONE,b.ZERO);const Ee=m.nBitLength,Ae=vw(re,m.endo?Math.ceil(Ee/2):Ee);return{CURVE:m,ProjectivePoint:re,normPrivateKeyToScalar:N,weierstrassEquation:k,isWithinCurveOrder:A}}function Sw(h){const m=px(h);return fg(m,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...m})}function Ew(h){const m=Sw(h),{Fp:b,n:S}=m,z=b.BYTES+1,k=2*b.BYTES+1;function A(ut){return ku<ut&&ut<b.ORDER}function l(ut){return ba(ut,S)}function N(ut){return O_(ut,S)}const{ProjectivePoint:K,normPrivateKeyToScalar:ne,weierstrassEquation:re,isWithinCurveOrder:Ee}=Tw({...m,toBytes(ut,Te,He){const pt=Te.toAffine(),_t=b.toBytes(pt.x),Ft=pf;return He?Ft(Uint8Array.from([Te.hasEvenY()?2:3]),_t):Ft(Uint8Array.from([4]),_t,b.toBytes(pt.y))},fromBytes(ut){const Te=ut.length,He=ut[0],pt=ut.subarray(1);if(Te===z&&(He===2||He===3)){const _t=Fs(pt);if(!A(_t))throw new Error("Point is not on curve");const Ft=re(_t);let we=b.sqrt(Ft);const $e=(we&Uo)===Uo;return(He&1)===1!==$e&&(we=b.neg(we)),{x:_t,y:we}}else if(Te===k&&He===4){const _t=b.fromBytes(pt.subarray(0,b.BYTES)),Ft=b.fromBytes(pt.subarray(b.BYTES,2*b.BYTES));return{x:_t,y:Ft}}else throw new Error(`Point of length ${Te} was invalid. Expected ${z} compressed bytes or ${k} uncompressed bytes`)}}),Ae=ut=>Vp(Hh(ut,m.nByteLength));function Pe(ut){const Te=S>>Uo;return ut>Te}function pe(ut){return Pe(ut)?l(-ut):ut}const ie=(ut,Te,He)=>Fs(ut.slice(Te,He));class Re{constructor(Te,He,pt){this.r=Te,this.s=He,this.recovery=pt,this.assertValidity()}static fromCompact(Te){const He=m.nByteLength;return Te=Va("compactSignature",Te,He*2),new Re(ie(Te,0,He),ie(Te,He,2*He))}static fromDER(Te){const{r:He,s:pt}=df.toSig(Va("DER",Te));return new Re(He,pt)}assertValidity(){if(!Ee(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!Ee(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Te){return new Re(this.r,this.s,Te)}recoverPublicKey(Te){const{r:He,s:pt,recovery:_t}=this,Ft=at(Va("msgHash",Te));if(_t==null||![0,1,2,3].includes(_t))throw new Error("recovery id invalid");const we=_t===2||_t===3?He+m.n:He;if(we>=b.ORDER)throw new Error("recovery id 2 or 3 invalid");const $e=(_t&1)===0?"02":"03",vt=K.fromHex($e+Ae(we)),Pt=N(we),Vt=l(-Ft*Pt),Xt=l(pt*Pt),Qt=K.BASE.multiplyAndAddUnsafe(vt,Vt,Xt);if(!Qt)throw new Error("point at infinify");return Qt.assertValidity(),Qt}hasHighS(){return Pe(this.s)}normalizeS(){return this.hasHighS()?new Re(this.r,l(-this.s),this.recovery):this}toDERRawBytes(){return qp(this.toDERHex())}toDERHex(){return df.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return qp(this.toCompactHex())}toCompactHex(){return Ae(this.r)+Ae(this.s)}}const We={isValidPrivateKey(ut){try{return ne(ut),!0}catch{return!1}},normPrivateKeyToScalar:ne,randomPrivateKey:()=>{const ut=fx(m.n);return yw(m.randomBytes(ut),m.n)},precompute(ut=8,Te=K.BASE){return Te._setWindowSize(ut),Te.multiply(BigInt(3)),Te}};function it(ut,Te=!0){return K.fromPrivateKey(ut).toRawBytes(Te)}function Dt(ut){const Te=ut instanceof Uint8Array,He=typeof ut=="string",pt=(Te||He)&&ut.length;return Te?pt===z||pt===k:He?pt===2*z||pt===2*k:ut instanceof K}function bt(ut,Te,He=!0){if(Dt(ut))throw new Error("first arg must be private key");if(!Dt(Te))throw new Error("second arg must be public key");return K.fromHex(Te).multiply(ne(ut)).toRawBytes(He)}const rt=m.bits2int||function(ut){const Te=Fs(ut),He=ut.length*8-m.nBitLength;return He>0?Te>>BigInt(He):Te},at=m.bits2int_modN||function(ut){return l(rt(ut))},Ie=s0(m.nBitLength);function st(ut){if(typeof ut!="bigint")throw new Error("bigint expected");if(!(ku<=ut&&ut<Ie))throw new Error(`bigint expected < 2^${m.nBitLength}`);return Hh(ut,m.nByteLength)}function tt(ut,Te,He=ct){if(["recovered","canonical"].some(Yt=>Yt in He))throw new Error("sign() legacy options not supported");const{hash:pt,randomBytes:_t}=m;let{lowS:Ft,prehash:we,extraEntropy:$e}=He;Ft==null&&(Ft=!0),ut=Va("msgHash",ut),we&&(ut=Va("prehashed msgHash",pt(ut)));const vt=at(ut),Pt=ne(Te),Vt=[st(Pt),st(vt)];if($e!=null){const Yt=$e===!0?_t(b.BYTES):$e;Vt.push(Va("extraEntropy",Yt))}const Xt=pf(...Vt),Qt=vt;function rn(Yt){const on=rt(Yt);if(!Ee(on))return;const xn=N(on),qn=K.BASE.multiply(on).toAffine(),Ki=l(qn.x);if(Ki===ku)return;const zn=l(xn*l(Qt+Ki*Pt));if(zn===ku)return;let wi=(qn.x===Ki?0:2)|Number(qn.y&Uo),Wi=zn;return Ft&&Pe(zn)&&(Wi=pe(zn),wi^=1),new Re(Ki,Wi,wi)}return{seed:Xt,k2sig:rn}}const ct={lowS:m.lowS,prehash:!1},Tt={lowS:m.lowS,prehash:!1};function jt(ut,Te,He=ct){const{seed:pt,k2sig:_t}=tt(ut,Te,He),Ft=m;return ux(Ft.hash.outputLen,Ft.nByteLength,Ft.hmac)(pt,_t)}K.BASE._setWindowSize(8);function Gt(ut,Te,He,pt=Tt){const _t=ut;if(Te=Va("msgHash",Te),He=Va("publicKey",He),"strict"in pt)throw new Error("options.strict was renamed to lowS");const{lowS:Ft,prehash:we}=pt;let $e,vt;try{if(typeof _t=="string"||_t instanceof Uint8Array)try{$e=Re.fromDER(_t)}catch(qn){if(!(qn instanceof df.Err))throw qn;$e=Re.fromCompact(_t)}else if(typeof _t=="object"&&typeof _t.r=="bigint"&&typeof _t.s=="bigint"){const{r:qn,s:Ki}=_t;$e=new Re(qn,Ki)}else throw new Error("PARSE");vt=K.fromHex(He)}catch(qn){if(qn.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Ft&&$e.hasHighS())return!1;we&&(Te=m.hash(Te));const{r:Pt,s:Vt}=$e,Xt=at(Te),Qt=N(Vt),rn=l(Xt*Qt),Yt=l(Pt*Qt),on=K.BASE.multiplyAndAddUnsafe(vt,rn,Yt)?.toAffine();return on?l(on.x)===Pt:!1}return{CURVE:m,getPublicKey:it,getSharedSecret:bt,sign:jt,verify:Gt,ProjectivePoint:K,Signature:Re,utils:We}}let mx=class extends sx{constructor(m,b){super(),this.finished=!1,this.destroyed=!1,j1(m);const S=n0(b);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const z=this.blockLen,k=new Uint8Array(z);k.set(S.length>z?m.create().update(S).digest():S);for(let A=0;A<k.length;A++)k[A]^=54;this.iHash.update(k),this.oHash=m.create();for(let A=0;A<k.length;A++)k[A]^=106;this.oHash.update(k),k.fill(0)}update(m){return by(this),this.iHash.update(m),this}digestInto(m){by(this),rx(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:b,iHash:S,finished:z,destroyed:k,blockLen:A,outputLen:l}=this;return m=m,m.finished=z,m.destroyed=k,m.blockLen=A,m.outputLen=l,m.oHash=b._cloneInto(m.oHash),m.iHash=S._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const gx=(h,m,b)=>new mx(h,m).update(b).digest();gx.create=(h,m)=>new mx(h,m);function Mw(h){return{hash:h,hmac:(m,...b)=>gx(h,m,G1(...b)),randomBytes:ox}}function Aw(h,m){const b=S=>Ew({...h,...Mw(S)});return Object.freeze({...b(m),create:b})}const Ly=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),wy=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),yx=BigInt(1),Ty=BigInt(2),dv=(h,m)=>(h+m/Ty)/m;function _x(h){const m=Ly,b=BigInt(3),S=BigInt(6),z=BigInt(11),k=BigInt(22),A=BigInt(23),l=BigInt(44),N=BigInt(88),K=h*h*h%m,ne=K*K*h%m,re=jo(ne,b,m)*ne%m,Ee=jo(re,b,m)*ne%m,Ae=jo(Ee,Ty,m)*K%m,Pe=jo(Ae,z,m)*Ae%m,pe=jo(Pe,k,m)*Pe%m,ie=jo(pe,l,m)*pe%m,Re=jo(ie,N,m)*ie%m,We=jo(Re,l,m)*pe%m,it=jo(We,b,m)*ne%m,Dt=jo(it,A,m)*Pe%m,bt=jo(Dt,S,m)*K%m,rt=jo(bt,Ty,m);if(!B_.eql(B_.sqr(rt),h))throw new Error("Cannot find square root");return rt}const B_=gw(Ly,void 0,void 0,{sqrt:_x}),Hp=Aw({a:BigInt(0),b:BigInt(7),Fp:B_,n:wy,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:h=>{const m=wy,b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),S=-yx*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),z=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),k=b,A=BigInt("0x100000000000000000000000000000000"),l=dv(k*h,m),N=dv(-S*h,m);let K=ba(h-l*b-N*z,m),ne=ba(-l*S-N*k,m);const re=K>A,Ee=ne>A;if(re&&(K=m-K),Ee&&(ne=m-ne),K>A||ne>A)throw new Error("splitScalar: Endomorphism failed, k="+h);return{k1neg:re,k1:K,k2neg:Ee,k2:ne}}}},R_),Oy=BigInt(0),vx=h=>typeof h=="bigint"&&Oy<h&&h<Ly,Cw=h=>typeof h=="bigint"&&Oy<h&&h<wy,fv={};function Sy(h,...m){let b=fv[h];if(b===void 0){const S=R_(Uint8Array.from(h,z=>z.charCodeAt(0)));b=pf(S,S),fv[h]=b}return R_(pf(b,...m))}const o0=h=>h.toRawBytes(!0).slice(1),N_=h=>Hh(h,32),T_=h=>ba(h,Ly),sg=h=>ba(h,wy),l0=Hp.ProjectivePoint,zw=(h,m,b)=>l0.BASE.multiplyAndAddUnsafe(h,m,b);function F_(h){let m=Hp.utils.normPrivateKeyToScalar(h),b=l0.fromPrivateKey(m);return{scalar:b.hasEvenY()?m:sg(-m),bytes:o0(b)}}function xx(h){if(!vx(h))throw new Error("bad x: need 0 < x < p");const m=T_(h*h),b=T_(m*h+BigInt(7));let S=_x(b);S%Ty!==Oy&&(S=T_(-S));const z=new l0(h,S,yx);return z.assertValidity(),z}function bx(...h){return sg(Fs(Sy("BIP0340/challenge",...h)))}function Dw(h){return F_(h).bytes}function Pw(h,m,b=ox(32)){const S=Va("message",h),{bytes:z,scalar:k}=F_(m),A=Va("auxRand",b,32),l=N_(k^Fs(Sy("BIP0340/aux",A))),N=Sy("BIP0340/nonce",l,z,S),K=sg(Fs(N));if(K===Oy)throw new Error("sign failed: k is zero");const{bytes:ne,scalar:re}=F_(K),Ee=bx(ne,z,S),Ae=new Uint8Array(64);if(Ae.set(ne,0),Ae.set(N_(sg(re+Ee*k)),32),!wx(Ae,S,z))throw new Error("sign: Invalid signature produced");return Ae}function wx(h,m,b){const S=Va("signature",h,64),z=Va("message",m),k=Va("publicKey",b,32);try{const A=xx(Fs(k)),l=Fs(S.subarray(0,32));if(!vx(l))return!1;const N=Fs(S.subarray(32,64));if(!Cw(N))return!1;const K=bx(N_(l),o0(A),z),ne=zw(A,N,sg(-K));return!(!ne||!ne.hasEvenY()||ne.toAffine().x!==l)}catch{return!1}}const zc={getPublicKey:Dw,sign:Pw,verify:wx,utils:{randomPrivateKey:Hp.utils.randomPrivateKey,lift_x:xx,pointToBytes:o0,numberToBytesBE:Hh,bytesToNumberBE:Fs,taggedHash:Sy,mod:ba}},S_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const c0=h=>h instanceof Uint8Array,E_=h=>new DataView(h.buffer,h.byteOffset,h.byteLength),Ac=(h,m)=>h<<32-m|h>>>m,Iw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Iw)throw new Error("Non little-endian hardware is not supported");const kw=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function Dr(h){if(!c0(h))throw new Error("Uint8Array expected");let m="";for(let b=0;b<h.length;b++)m+=kw[h[b]];return m}function mf(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const b=new Uint8Array(m/2);for(let S=0;S<b.length;S++){const z=S*2,k=h.slice(z,z+2),A=Number.parseInt(k,16);if(Number.isNaN(A)||A<0)throw new Error("Invalid byte sequence");b[S]=A}return b}function Rw(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function og(h){if(typeof h=="string"&&(h=Rw(h)),!c0(h))throw new Error(`expected Uint8Array, got ${typeof h}`);return h}function By(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!c0(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}class Tx{clone(){return this._cloneInto()}}function Sx(h){const m=S=>h().update(og(S)).digest(),b=h();return m.outputLen=b.outputLen,m.blockLen=b.blockLen,m.create=()=>h(),m}function Ex(h=32){if(S_&&typeof S_.getRandomValues=="function")return S_.getRandomValues(new Uint8Array(h));throw new Error("crypto.getRandomValues must be defined")}function j_(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`Wrong positive integer: ${h}`)}function Lw(h){if(typeof h!="boolean")throw new Error(`Expected boolean, not ${h}`)}function Mx(h,...m){if(!(h instanceof Uint8Array))throw new Error("Expected Uint8Array");if(m.length>0&&!m.includes(h.length))throw new Error(`Expected Uint8Array of length ${m}, not of length=${h.length}`)}function Ow(h){if(typeof h!="function"||typeof h.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");j_(h.outputLen),j_(h.blockLen)}function Bw(h,m=!0){if(h.destroyed)throw new Error("Hash instance has been destroyed");if(m&&h.finished)throw new Error("Hash#digest() has already been called")}function Nw(h,m){Mx(h);const b=m.outputLen;if(h.length<b)throw new Error(`digestInto() expects output buffer of length at least ${b}`)}const Dc={number:j_,bool:Lw,bytes:Mx,hash:Ow,exists:Bw,output:Nw};function Fw(h,m,b,S){if(typeof h.setBigUint64=="function")return h.setBigUint64(m,b,S);const z=BigInt(32),k=BigInt(4294967295),A=Number(b>>z&k),l=Number(b&k),N=S?4:0,K=S?0:4;h.setUint32(m+N,A,S),h.setUint32(m+K,l,S)}class jw extends Tx{constructor(m,b,S,z){super(),this.blockLen=m,this.outputLen=b,this.padOffset=S,this.isLE=z,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=E_(this.buffer)}update(m){Dc.exists(this);const{view:b,buffer:S,blockLen:z}=this;m=og(m);const k=m.length;for(let A=0;A<k;){const l=Math.min(z-this.pos,k-A);if(l===z){const N=E_(m);for(;z<=k-A;A+=z)this.process(N,A);continue}S.set(m.subarray(A,A+l),this.pos),this.pos+=l,A+=l,this.pos===z&&(this.process(b,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){Dc.exists(this),Dc.output(m,this),this.finished=!0;const{buffer:b,view:S,blockLen:z,isLE:k}=this;let{pos:A}=this;b[A++]=128,this.buffer.subarray(A).fill(0),this.padOffset>z-A&&(this.process(S,0),A=0);for(let re=A;re<z;re++)b[re]=0;Fw(S,z-8,BigInt(this.length*8),k),this.process(S,0);const l=E_(m),N=this.outputLen;if(N%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const K=N/4,ne=this.get();if(K>ne.length)throw new Error("_sha2: outputLen bigger than state");for(let re=0;re<K;re++)l.setUint32(4*re,ne[re],k)}digest(){const{buffer:m,outputLen:b}=this;this.digestInto(m);const S=m.slice(0,b);return this.destroy(),S}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:b,buffer:S,length:z,finished:k,destroyed:A,pos:l}=this;return m.length=z,m.pos=l,m.finished=k,m.destroyed=A,z%b&&m.buffer.set(S),m}}const Uw=(h,m,b)=>h&m^~h&b,Vw=(h,m,b)=>h&m^h&b^m&b,qw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Vh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),qh=new Uint32Array(64);class Ax extends jw{constructor(){super(64,32,8,!1),this.A=Vh[0]|0,this.B=Vh[1]|0,this.C=Vh[2]|0,this.D=Vh[3]|0,this.E=Vh[4]|0,this.F=Vh[5]|0,this.G=Vh[6]|0,this.H=Vh[7]|0}get(){const{A:m,B:b,C:S,D:z,E:k,F:A,G:l,H:N}=this;return[m,b,S,z,k,A,l,N]}set(m,b,S,z,k,A,l,N){this.A=m|0,this.B=b|0,this.C=S|0,this.D=z|0,this.E=k|0,this.F=A|0,this.G=l|0,this.H=N|0}process(m,b){for(let re=0;re<16;re++,b+=4)qh[re]=m.getUint32(b,!1);for(let re=16;re<64;re++){const Ee=qh[re-15],Ae=qh[re-2],Pe=Ac(Ee,7)^Ac(Ee,18)^Ee>>>3,pe=Ac(Ae,17)^Ac(Ae,19)^Ae>>>10;qh[re]=pe+qh[re-7]+Pe+qh[re-16]|0}let{A:S,B:z,C:k,D:A,E:l,F:N,G:K,H:ne}=this;for(let re=0;re<64;re++){const Ee=Ac(l,6)^Ac(l,11)^Ac(l,25),Ae=ne+Ee+Uw(l,N,K)+qw[re]+qh[re]|0,pe=(Ac(S,2)^Ac(S,13)^Ac(S,22))+Vw(S,z,k)|0;ne=K,K=N,N=l,l=A+Ae|0,A=k,k=z,z=S,S=Ae+pe|0}S=S+this.A|0,z=z+this.B|0,k=k+this.C|0,A=A+this.D|0,l=l+this.E|0,N=N+this.F|0,K=K+this.G|0,ne=ne+this.H|0,this.set(S,z,k,A,l,N,K,ne)}roundClean(){qh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Gw extends Ax{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Xh=Sx(()=>new Ax);Sx(()=>new Gw);function $p(h){if(!Number.isSafeInteger(h))throw new Error(`Wrong integer: ${h}`)}function Bu(...h){const m=(z,k)=>A=>z(k(A)),b=Array.from(h).reverse().reduce((z,k)=>z?m(z,k.encode):k.encode,void 0),S=h.reduce((z,k)=>z?m(z,k.decode):k.decode,void 0);return{encode:b,decode:S}}function Nu(h){return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return m.map(b=>{if($p(b),b<0||b>=h.length)throw new Error(`Digit index outside alphabet: ${b} (alphabet: ${h.length})`);return h[b]})},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("alphabet.decode input should be array of strings");return m.map(b=>{if(typeof b!="string")throw new Error(`alphabet.decode: not string element=${b}`);const S=h.indexOf(b);if(S===-1)throw new Error(`Unknown letter: "${b}". Allowed: ${h}`);return S})}}}function Fu(h=""){if(typeof h!="string")throw new Error("join separator should be string");return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("join.encode input should be array of strings");for(let b of m)if(typeof b!="string")throw new Error(`join.encode: non-string input=${b}`);return m.join(h)},decode:m=>{if(typeof m!="string")throw new Error("join.decode input should be string");return m.split(h)}}}function Ny(h,m="="){if($p(h),typeof m!="string")throw new Error("padding chr should be string");return{encode(b){if(!Array.isArray(b)||b.length&&typeof b[0]!="string")throw new Error("padding.encode input should be array of strings");for(let S of b)if(typeof S!="string")throw new Error(`padding.encode: non-string input=${S}`);for(;b.length*h%8;)b.push(m);return b},decode(b){if(!Array.isArray(b)||b.length&&typeof b[0]!="string")throw new Error("padding.encode input should be array of strings");for(let z of b)if(typeof z!="string")throw new Error(`padding.decode: non-string input=${z}`);let S=b.length;if(S*h%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;S>0&&b[S-1]===m;S--)if(!((S-1)*h%8))throw new Error("Invalid padding: string has too much padding");return b.slice(0,S)}}}function Cx(h){if(typeof h!="function")throw new Error("normalize fn should be function");return{encode:m=>m,decode:m=>h(m)}}function pv(h,m,b){if(m<2)throw new Error(`convertRadix: wrong from=${m}, base cannot be less than 2`);if(b<2)throw new Error(`convertRadix: wrong to=${b}, base cannot be less than 2`);if(!Array.isArray(h))throw new Error("convertRadix: data should be array");if(!h.length)return[];let S=0;const z=[],k=Array.from(h);for(k.forEach(A=>{if($p(A),A<0||A>=m)throw new Error(`Wrong integer: ${A}`)});;){let A=0,l=!0;for(let N=S;N<k.length;N++){const K=k[N],ne=m*A+K;if(!Number.isSafeInteger(ne)||m*A/m!==A||ne-K!==m*A)throw new Error("convertRadix: carry overflow");if(A=ne%b,k[N]=Math.floor(ne/b),!Number.isSafeInteger(k[N])||k[N]*b+A!==ne)throw new Error("convertRadix: carry overflow");if(l)k[N]?l=!1:S=N;else continue}if(z.push(A),l)break}for(let A=0;A<h.length-1&&h[A]===0;A++)z.push(0);return z.reverse()}const zx=(h,m)=>m?zx(m,h%m):h,Ey=(h,m)=>h+(m-zx(h,m));function U_(h,m,b,S){if(!Array.isArray(h))throw new Error("convertRadix2: data should be array");if(m<=0||m>32)throw new Error(`convertRadix2: wrong from=${m}`);if(b<=0||b>32)throw new Error(`convertRadix2: wrong to=${b}`);if(Ey(m,b)>32)throw new Error(`convertRadix2: carry overflow from=${m} to=${b} carryBits=${Ey(m,b)}`);let z=0,k=0;const A=2**b-1,l=[];for(const N of h){if($p(N),N>=2**m)throw new Error(`convertRadix2: invalid data word=${N} from=${m}`);if(z=z<<m|N,k+m>32)throw new Error(`convertRadix2: carry overflow pos=${k} from=${m}`);for(k+=m;k>=b;k-=b)l.push((z>>k-b&A)>>>0);z&=2**k-1}if(z=z<<b-k&A,!S&&k>=m)throw new Error("Excess padding");if(!S&&z)throw new Error(`Non-zero padding: ${z}`);return S&&k>0&&l.push(z>>>0),l}function Zw(h){return $p(h),{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return pv(Array.from(m),2**8,h)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(pv(m,h,2**8))}}}function Yh(h,m=!1){if($p(h),h<=0||h>32)throw new Error("radix2: bits should be in (0..32]");if(Ey(8,h)>32||Ey(h,8)>32)throw new Error("radix2: carry overflow");return{encode:b=>{if(!(b instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return U_(Array.from(b),8,h,!m)},decode:b=>{if(!Array.isArray(b)||b.length&&typeof b[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(U_(b,h,8,m))}}}function mv(h){if(typeof h!="function")throw new Error("unsafeWrapper fn should be function");return function(...m){try{return h.apply(null,m)}catch{}}}const Hw=Bu(Yh(4),Nu("0123456789ABCDEF"),Fu("")),$w=Bu(Yh(5),Nu("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Ny(5),Fu(""));Bu(Yh(5),Nu("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Ny(5),Fu(""));Bu(Yh(5),Nu("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Fu(""),Cx(h=>h.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Ou=Bu(Yh(6),Nu("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Ny(6),Fu("")),Xw=Bu(Yh(6),Nu("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Ny(6),Fu("")),u0=h=>Bu(Zw(58),Nu(h),Fu("")),V_=u0("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");u0("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");u0("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const gv=[0,2,3,5,6,7,9,10,11],Yw={encode(h){let m="";for(let b=0;b<h.length;b+=8){const S=h.subarray(b,b+8);m+=V_.encode(S).padStart(gv[S.length],"1")}return m},decode(h){let m=[];for(let b=0;b<h.length;b+=11){const S=h.slice(b,b+11),z=gv.indexOf(S.length),k=V_.decode(S);for(let A=0;A<k.length-z;A++)if(k[A]!==0)throw new Error("base58xmr: wrong padding");m=m.concat(Array.from(k.slice(k.length-z)))}return Uint8Array.from(m)}},q_=Bu(Nu("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Fu("")),yv=[996825010,642813549,513874426,1027748829,705979059];function rg(h){const m=h>>25;let b=(h&33554431)<<5;for(let S=0;S<yv.length;S++)(m>>S&1)===1&&(b^=yv[S]);return b}function _v(h,m,b=1){const S=h.length;let z=1;for(let k=0;k<S;k++){const A=h.charCodeAt(k);if(A<33||A>126)throw new Error(`Invalid prefix (${h})`);z=rg(z)^A>>5}z=rg(z);for(let k=0;k<S;k++)z=rg(z)^h.charCodeAt(k)&31;for(let k of m)z=rg(z)^k;for(let k=0;k<6;k++)z=rg(z);return z^=b,q_.encode(U_([z%2**30],30,5,!1))}function Dx(h){const m=h==="bech32"?1:734539939,b=Yh(5),S=b.decode,z=b.encode,k=mv(S);function A(ne,re,Ee=90){if(typeof ne!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof ne}`);if(!Array.isArray(re)||re.length&&typeof re[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof re}`);const Ae=ne.length+7+re.length;if(Ee!==!1&&Ae>Ee)throw new TypeError(`Length ${Ae} exceeds limit ${Ee}`);return ne=ne.toLowerCase(),`${ne}1${q_.encode(re)}${_v(ne,re,m)}`}function l(ne,re=90){if(typeof ne!="string")throw new Error(`bech32.decode input should be string, not ${typeof ne}`);if(ne.length<8||re!==!1&&ne.length>re)throw new TypeError(`Wrong string length: ${ne.length} (${ne}). Expected (8..${re})`);const Ee=ne.toLowerCase();if(ne!==Ee&&ne!==ne.toUpperCase())throw new Error("String must be lowercase or uppercase");ne=Ee;const Ae=ne.lastIndexOf("1");if(Ae===0||Ae===-1)throw new Error('Letter "1" must be present between prefix and data only');const Pe=ne.slice(0,Ae),pe=ne.slice(Ae+1);if(pe.length<6)throw new Error("Data must be at least 6 characters long");const ie=q_.decode(pe).slice(0,-6),Re=_v(Pe,ie,m);if(!pe.endsWith(Re))throw new Error(`Invalid checksum in ${ne}: expected "${Re}"`);return{prefix:Pe,words:ie}}const N=mv(l);function K(ne){const{prefix:re,words:Ee}=l(ne,!1);return{prefix:re,words:Ee,bytes:S(Ee)}}return{encode:A,decode:l,decodeToBytes:K,decodeUnsafe:N,fromWords:S,fromWordsUnsafe:k,toWords:z}}const Gp=Dx("bech32");Dx("bech32m");const Kw={encode:h=>new TextDecoder().decode(h),decode:h=>new TextEncoder().encode(h)},Ww=Bu(Yh(4),Nu("0123456789abcdef"),Fu(""),Cx(h=>{if(typeof h!="string"||h.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof h} with length ${h.length}`);return h.toLowerCase()})),Qw={utf8:Kw,hex:Ww,base16:Hw,base32:$w,base64:Ou,base64url:Xw,base58:V_,base58xmr:Yw};`${Object.keys(Qw).join(", ")}`;function M_(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`positive integer expected, not ${h}`)}function vv(h){if(typeof h!="boolean")throw new Error(`boolean expected, not ${h}`)}function Jw(h){return h instanceof Uint8Array||h!=null&&typeof h=="object"&&h.constructor.name==="Uint8Array"}function Pc(h,...m){if(!Jw(h))throw new Error("Uint8Array expected");if(m.length>0&&!m.includes(h.length))throw new Error(`Uint8Array expected of length ${m}, not of length=${h.length}`)}const qa=h=>new Uint32Array(h.buffer,h.byteOffset,Math.floor(h.byteLength/4)),e2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!e2)throw new Error("Non little-endian hardware is not supported");const t2=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function Fp(h){Pc(h);let m="";for(let b=0;b<h.length;b++)m+=t2[h[b]];return m}const Pu={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function xv(h){if(h>=Pu._0&&h<=Pu._9)return h-Pu._0;if(h>=Pu._A&&h<=Pu._F)return h-(Pu._A-10);if(h>=Pu._a&&h<=Pu._f)return h-(Pu._a-10)}function Px(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length,b=m/2;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const S=new Uint8Array(b);for(let z=0,k=0;z<b;z++,k+=2){const A=xv(h.charCodeAt(k)),l=xv(h.charCodeAt(k+1));if(A===void 0||l===void 0){const N=h[k]+h[k+1];throw new Error('hex string expected, got non-hex character "'+N+'" at index '+k)}S[z]=A*16+l}return S}function n2(h,m){if(m==null||typeof m!="object")throw new Error("options must be defined");return Object.assign(h,m)}function i2(h,m){if(h.length!==m.length)return!1;let b=0;for(let S=0;S<h.length;S++)b|=h[S]^m[S];return b===0}const r2=(h,m)=>(Object.assign(m,h),m),Zh=16,a2=283;function h0(h){return h<<1^a2&-(h>>7)}function jp(h,m){let b=0;for(;m>0;m>>=1)b^=h&-(m&1),h=h0(h);return b}const G_=(()=>{let h=new Uint8Array(256);for(let b=0,S=1;b<256;b++,S^=h0(S))h[b]=S;const m=new Uint8Array(256);m[0]=99;for(let b=0;b<255;b++){let S=h[255-b];S|=S<<8,m[h[b]]=(S^S>>4^S>>5^S>>6^S>>7^99)&255}return m})(),s2=G_.map((h,m)=>G_.indexOf(m)),o2=h=>h<<24|h>>>8,A_=h=>h<<8|h>>>24;function Ix(h,m){if(h.length!==256)throw new Error("Wrong sbox length");const b=new Uint32Array(256).map((K,ne)=>m(h[ne])),S=b.map(A_),z=S.map(A_),k=z.map(A_),A=new Uint32Array(256*256),l=new Uint32Array(256*256),N=new Uint16Array(256*256);for(let K=0;K<256;K++)for(let ne=0;ne<256;ne++){const re=K*256+ne;A[re]=b[K]^S[ne],l[re]=z[K]^k[ne],N[re]=h[K]<<8|h[ne]}return{sbox:h,sbox2:N,T0:b,T1:S,T2:z,T3:k,T01:A,T23:l}}const d0=Ix(G_,h=>jp(h,3)<<24|h<<16|h<<8|jp(h,2)),kx=Ix(s2,h=>jp(h,11)<<24|jp(h,13)<<16|jp(h,9)<<8|jp(h,14)),l2=(()=>{const h=new Uint8Array(16);for(let m=0,b=1;m<16;m++,b=h0(b))h[m]=b;return h})();function Rx(h){Pc(h);const m=h.length;if(![16,24,32].includes(m))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${m}`);const{sbox2:b}=d0,S=qa(h),z=S.length,k=l=>Ic(b,l,l,l,l),A=new Uint32Array(m+28);A.set(S);for(let l=z;l<A.length;l++){let N=A[l-1];l%z===0?N=k(o2(N))^l2[l/z-1]:z>6&&l%z===4&&(N=k(N)),A[l]=A[l-z]^N}return A}function c2(h){const m=Rx(h),b=m.slice(),S=m.length,{sbox2:z}=d0,{T0:k,T1:A,T2:l,T3:N}=kx;for(let K=0;K<S;K+=4)for(let ne=0;ne<4;ne++)b[K+ne]=m[S-K-4+ne];m.fill(0);for(let K=4;K<S-4;K++){const ne=b[K],re=Ic(z,ne,ne,ne,ne);b[K]=k[re&255]^A[re>>>8&255]^l[re>>>16&255]^N[re>>>24]}return b}function Gh(h,m,b,S,z,k){return h[b<<8&65280|S>>>8&255]^m[z>>>8&65280|k>>>24&255]}function Ic(h,m,b,S,z){return h[m&255|b&65280]|h[S>>>16&255|z>>>16&65280]<<16}function bv(h,m,b,S,z){const{sbox2:k,T01:A,T23:l}=d0;let N=0;m^=h[N++],b^=h[N++],S^=h[N++],z^=h[N++];const K=h.length/4-2;for(let Pe=0;Pe<K;Pe++){const pe=h[N++]^Gh(A,l,m,b,S,z),ie=h[N++]^Gh(A,l,b,S,z,m),Re=h[N++]^Gh(A,l,S,z,m,b),We=h[N++]^Gh(A,l,z,m,b,S);m=pe,b=ie,S=Re,z=We}const ne=h[N++]^Ic(k,m,b,S,z),re=h[N++]^Ic(k,b,S,z,m),Ee=h[N++]^Ic(k,S,z,m,b),Ae=h[N++]^Ic(k,z,m,b,S);return{s0:ne,s1:re,s2:Ee,s3:Ae}}function u2(h,m,b,S,z){const{sbox2:k,T01:A,T23:l}=kx;let N=0;m^=h[N++],b^=h[N++],S^=h[N++],z^=h[N++];const K=h.length/4-2;for(let Pe=0;Pe<K;Pe++){const pe=h[N++]^Gh(A,l,m,z,S,b),ie=h[N++]^Gh(A,l,b,m,z,S),Re=h[N++]^Gh(A,l,S,b,m,z),We=h[N++]^Gh(A,l,z,S,b,m);m=pe,b=ie,S=Re,z=We}const ne=h[N++]^Ic(k,m,z,S,b),re=h[N++]^Ic(k,b,m,z,S),Ee=h[N++]^Ic(k,S,b,m,z),Ae=h[N++]^Ic(k,z,S,b,m);return{s0:ne,s1:re,s2:Ee,s3:Ae}}function Lx(h,m){if(!m)return new Uint8Array(h);if(Pc(m),m.length<h)throw new Error(`aes: wrong destination length, expected at least ${h}, got: ${m.length}`);return m}function h2(h){if(Pc(h),h.length%Zh!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Zh}`)}function d2(h,m,b){let S=h.length;const z=S%Zh;if(!m&&z!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const k=qa(h);if(m){let N=Zh-z;N||(N=Zh),S=S+N}const A=Lx(S,b),l=qa(A);return{b:k,o:l,out:A}}function f2(h,m){if(!m)return h;const b=h.length;if(!b)throw new Error("aes/pcks5: empty ciphertext not allowed");const S=h[b-1];if(S<=0||S>16)throw new Error(`aes/pcks5: wrong padding byte: ${S}`);const z=h.subarray(0,-S);for(let k=0;k<S;k++)if(h[b-k-1]!==S)throw new Error("aes/pcks5: wrong padding");return z}function p2(h){const m=new Uint8Array(16),b=qa(m);m.set(h);const S=Zh-h.length;for(let z=Zh-S;z<Zh;z++)m[z]=S;return b}const Ox=r2({blockSize:16,nonceLength:16},function(m,b,S={}){Pc(m),Pc(b,16);const z=!S.disablePadding;return{encrypt:(k,A)=>{const l=Rx(m),{b:N,o:K,out:ne}=d2(k,z,A),re=qa(b);let Ee=re[0],Ae=re[1],Pe=re[2],pe=re[3],ie=0;for(;ie+4<=N.length;)Ee^=N[ie+0],Ae^=N[ie+1],Pe^=N[ie+2],pe^=N[ie+3],{s0:Ee,s1:Ae,s2:Pe,s3:pe}=bv(l,Ee,Ae,Pe,pe),K[ie++]=Ee,K[ie++]=Ae,K[ie++]=Pe,K[ie++]=pe;if(z){const Re=p2(k.subarray(ie*4));Ee^=Re[0],Ae^=Re[1],Pe^=Re[2],pe^=Re[3],{s0:Ee,s1:Ae,s2:Pe,s3:pe}=bv(l,Ee,Ae,Pe,pe),K[ie++]=Ee,K[ie++]=Ae,K[ie++]=Pe,K[ie++]=pe}return l.fill(0),ne},decrypt:(k,A)=>{h2(k);const l=c2(m),N=qa(b),K=Lx(k.length,A),ne=qa(k),re=qa(K);let Ee=N[0],Ae=N[1],Pe=N[2],pe=N[3];for(let ie=0;ie+4<=ne.length;){const Re=Ee,We=Ae,it=Pe,Dt=pe;Ee=ne[ie+0],Ae=ne[ie+1],Pe=ne[ie+2],pe=ne[ie+3];const{s0:bt,s1:rt,s2:at,s3:Ie}=u2(l,Ee,Ae,Pe,pe);re[ie++]=bt^Re,re[ie++]=rt^We,re[ie++]=at^it,re[ie++]=Ie^Dt}return l.fill(0),f2(K,z)}}}),Bx=h=>Uint8Array.from(h.split("").map(m=>m.charCodeAt(0))),m2=Bx("expand 16-byte k"),g2=Bx("expand 32-byte k"),y2=qa(m2),Nx=qa(g2);Nx.slice();function ri(h,m){return h<<m|h>>>32-m}function Z_(h){return h.byteOffset%4===0}const py=64,_2=16,Fx=2**32-1,wv=new Uint32Array;function v2(h,m,b,S,z,k,A,l){const N=z.length,K=new Uint8Array(py),ne=qa(K),re=Z_(z)&&Z_(k),Ee=re?qa(z):wv,Ae=re?qa(k):wv;for(let Pe=0;Pe<N;A++){if(h(m,b,S,ne,A,l),A>=Fx)throw new Error("arx: counter overflow");const pe=Math.min(py,N-Pe);if(re&&pe===py){const ie=Pe/4;if(Pe%4!==0)throw new Error("arx: invalid block position");for(let Re=0,We;Re<_2;Re++)We=ie+Re,Ae[We]=Ee[We]^ne[Re];Pe+=py;continue}for(let ie=0,Re;ie<pe;ie++)Re=Pe+ie,k[Re]=z[Re]^K[ie];Pe+=pe}}function x2(h,m){const{allowShortKeys:b,extendNonceFn:S,counterLength:z,counterRight:k,rounds:A}=n2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},m);if(typeof h!="function")throw new Error("core must be a function");return M_(z),M_(A),vv(k),vv(b),(l,N,K,ne,re=0)=>{Pc(l),Pc(N),Pc(K);const Ee=K.length;if(ne||(ne=new Uint8Array(Ee)),Pc(ne),M_(re),re<0||re>=Fx)throw new Error("arx: counter overflow");if(ne.length<Ee)throw new Error(`arx: output (${ne.length}) is shorter than data (${Ee})`);const Ae=[];let Pe=l.length,pe,ie;if(Pe===32)pe=l.slice(),Ae.push(pe),ie=Nx;else if(Pe===16&&b)pe=new Uint8Array(32),pe.set(l),pe.set(l,16),ie=y2,Ae.push(pe);else throw new Error(`arx: invalid 32-byte key, got length=${Pe}`);Z_(N)||(N=N.slice(),Ae.push(N));const Re=qa(pe);if(S){if(N.length!==24)throw new Error("arx: extended nonce must be 24 bytes");S(ie,Re,qa(N.subarray(0,16)),Re),N=N.subarray(16)}const We=16-z;if(We!==N.length)throw new Error(`arx: nonce must be ${We} or 16 bytes`);if(We!==12){const Dt=new Uint8Array(12);Dt.set(N,k?0:12-N.length),N=Dt,Ae.push(N)}const it=qa(N);for(v2(h,ie,Re,it,K,ne,re,A);Ae.length>0;)Ae.pop().fill(0);return ne}}function b2(h,m,b,S,z,k=20){let A=h[0],l=h[1],N=h[2],K=h[3],ne=m[0],re=m[1],Ee=m[2],Ae=m[3],Pe=m[4],pe=m[5],ie=m[6],Re=m[7],We=z,it=b[0],Dt=b[1],bt=b[2],rt=A,at=l,Ie=N,st=K,tt=ne,ct=re,Tt=Ee,jt=Ae,Gt=Pe,ut=pe,Te=ie,He=Re,pt=We,_t=it,Ft=Dt,we=bt;for(let vt=0;vt<k;vt+=2)rt=rt+tt|0,pt=ri(pt^rt,16),Gt=Gt+pt|0,tt=ri(tt^Gt,12),rt=rt+tt|0,pt=ri(pt^rt,8),Gt=Gt+pt|0,tt=ri(tt^Gt,7),at=at+ct|0,_t=ri(_t^at,16),ut=ut+_t|0,ct=ri(ct^ut,12),at=at+ct|0,_t=ri(_t^at,8),ut=ut+_t|0,ct=ri(ct^ut,7),Ie=Ie+Tt|0,Ft=ri(Ft^Ie,16),Te=Te+Ft|0,Tt=ri(Tt^Te,12),Ie=Ie+Tt|0,Ft=ri(Ft^Ie,8),Te=Te+Ft|0,Tt=ri(Tt^Te,7),st=st+jt|0,we=ri(we^st,16),He=He+we|0,jt=ri(jt^He,12),st=st+jt|0,we=ri(we^st,8),He=He+we|0,jt=ri(jt^He,7),rt=rt+ct|0,we=ri(we^rt,16),Te=Te+we|0,ct=ri(ct^Te,12),rt=rt+ct|0,we=ri(we^rt,8),Te=Te+we|0,ct=ri(ct^Te,7),at=at+Tt|0,pt=ri(pt^at,16),He=He+pt|0,Tt=ri(Tt^He,12),at=at+Tt|0,pt=ri(pt^at,8),He=He+pt|0,Tt=ri(Tt^He,7),Ie=Ie+jt|0,_t=ri(_t^Ie,16),Gt=Gt+_t|0,jt=ri(jt^Gt,12),Ie=Ie+jt|0,_t=ri(_t^Ie,8),Gt=Gt+_t|0,jt=ri(jt^Gt,7),st=st+tt|0,Ft=ri(Ft^st,16),ut=ut+Ft|0,tt=ri(tt^ut,12),st=st+tt|0,Ft=ri(Ft^st,8),ut=ut+Ft|0,tt=ri(tt^ut,7);let $e=0;S[$e++]=A+rt|0,S[$e++]=l+at|0,S[$e++]=N+Ie|0,S[$e++]=K+st|0,S[$e++]=ne+tt|0,S[$e++]=re+ct|0,S[$e++]=Ee+Tt|0,S[$e++]=Ae+jt|0,S[$e++]=Pe+Gt|0,S[$e++]=pe+ut|0,S[$e++]=ie+Te|0,S[$e++]=Re+He|0,S[$e++]=We+pt|0,S[$e++]=it+_t|0,S[$e++]=Dt+Ft|0,S[$e++]=bt+we|0}const jx=x2(b2,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Ux extends Tx{constructor(m,b){super(),this.finished=!1,this.destroyed=!1,Dc.hash(m);const S=og(b);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const z=this.blockLen,k=new Uint8Array(z);k.set(S.length>z?m.create().update(S).digest():S);for(let A=0;A<k.length;A++)k[A]^=54;this.iHash.update(k),this.oHash=m.create();for(let A=0;A<k.length;A++)k[A]^=106;this.oHash.update(k),k.fill(0)}update(m){return Dc.exists(this),this.iHash.update(m),this}digestInto(m){Dc.exists(this),Dc.bytes(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:b,iHash:S,finished:z,destroyed:k,blockLen:A,outputLen:l}=this;return m=m,m.finished=z,m.destroyed=k,m.blockLen=A,m.outputLen=l,m.oHash=b._cloneInto(m.oHash),m.iHash=S._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Fy=(h,m,b)=>new Ux(h,m).update(b).digest();Fy.create=(h,m)=>new Ux(h,m);function w2(h,m,b){return Dc.hash(h),Fy(h,og(b),og(m))}const C_=new Uint8Array([0]),Tv=new Uint8Array;function T2(h,m,b,S=32){if(Dc.hash(h),Dc.number(S),S>255*h.outputLen)throw new Error("Length should be <= 255*HashLen");const z=Math.ceil(S/h.outputLen);b===void 0&&(b=Tv);const k=new Uint8Array(z*h.outputLen),A=Fy.create(h,m),l=A._cloneInto(),N=new Uint8Array(A.outputLen);for(let K=0;K<z;K++)C_[0]=K+1,l.update(K===0?Tv:N).update(b).update(C_).digestInto(N),k.set(N,h.outputLen*K),A._cloneInto(l);return A.destroy(),l.destroy(),N.fill(0),C_.fill(0),k.slice(0,S)}var S2=Object.defineProperty,Zi=(h,m)=>{for(var b in m)S2(h,b,{get:m[b],enumerable:!0})},lf=Symbol("verified"),E2=h=>h instanceof Object;function f0(h){if(!E2(h)||typeof h.kind!="number"||typeof h.content!="string"||typeof h.created_at!="number"||typeof h.pubkey!="string"||!h.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(h.tags))return!1;for(let m=0;m<h.tags.length;m++){let b=h.tags[m];if(!Array.isArray(b))return!1;for(let S=0;S<b.length;S++)if(typeof b[S]!="string")return!1}return!0}var M2={};Zi(M2,{Queue:()=>qx,QueueNode:()=>Vx,binarySearch:()=>p0,bytesToHex:()=>Dr,hexToBytes:()=>mf,insertEventIntoAscendingList:()=>C2,insertEventIntoDescendingList:()=>A2,normalizeURL:()=>hf,utf8Decoder:()=>Lu,utf8Encoder:()=>Ol});var Lu=new TextDecoder("utf-8"),Ol=new TextEncoder;function hf(h){try{h.indexOf("://")===-1&&(h="wss://"+h);let m=new URL(h);return m.protocol==="http:"?m.protocol="ws:":m.protocol==="https:"&&(m.protocol="wss:"),m.pathname=m.pathname.replace(/\/+/g,"/"),m.pathname.endsWith("/")&&(m.pathname=m.pathname.slice(0,-1)),(m.port==="80"&&m.protocol==="ws:"||m.port==="443"&&m.protocol==="wss:")&&(m.port=""),m.searchParams.sort(),m.hash="",m.toString()}catch{throw new Error(`Invalid URL: ${h}`)}}function A2(h,m){const[b,S]=p0(h,z=>m.id===z.id?0:m.created_at===z.created_at?-1:z.created_at-m.created_at);return S||h.splice(b,0,m),h}function C2(h,m){const[b,S]=p0(h,z=>m.id===z.id?0:m.created_at===z.created_at?-1:m.created_at-z.created_at);return S||h.splice(b,0,m),h}function p0(h,m){let b=0,S=h.length-1;for(;b<=S;){const z=Math.floor((b+S)/2),k=m(h[z]);if(k===0)return[z,!0];k<0?S=z-1:b=z+1}return[b,!1]}var Vx=class{value;next=null;prev=null;constructor(h){this.value=h}},qx=class{first;last;constructor(){this.first=null,this.last=null}enqueue(h){const m=new Vx(h);return this.last?this.last===this.first?(this.last=m,this.last.prev=this.first,this.first.next=m):(m.prev=this.last,this.last.next=m,this.last=m):(this.first=m,this.last=m),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const m=this.first;return this.first=null,this.last=null,m.value}const h=this.first;return this.first=h.next,this.first&&(this.first.prev=null),h.value}},z2=class{generateSecretKey(){return zc.utils.randomPrivateKey()}getPublicKey(m){return Dr(zc.getPublicKey(m))}finalizeEvent(m,b){const S=m;return S.pubkey=Dr(zc.getPublicKey(b)),S.id=yy(S),S.sig=Dr(zc.sign(yy(S),b)),S[lf]=!0,S}verifyEvent(m){if(typeof m[lf]=="boolean")return m[lf];const b=yy(m);if(b!==m.id)return m[lf]=!1,!1;try{const S=zc.verify(m.sig,b,m.pubkey);return m[lf]=S,S}catch{return m[lf]=!1,!1}}};function D2(h){if(!f0(h))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content])}function yy(h){let m=Xh(Ol.encode(D2(h)));return Dr(m)}var jy=new z2,Gx=jy.generateSecretKey,lg=jy.getPublicKey,qo=jy.finalizeEvent,Uy=jy.verifyEvent,P2={};Zi(P2,{Application:()=>qT,BadgeAward:()=>F2,BadgeDefinition:()=>OT,BlockedRelaysList:()=>_T,BlossomServerList:()=>ET,BookmarkList:()=>mT,Bookmarksets:()=>kT,Calendar:()=>KT,CalendarEventRSVP:()=>WT,ChannelCreation:()=>Kx,ChannelHideMessage:()=>Jx,ChannelMessage:()=>Qx,ChannelMetadata:()=>Wx,ChannelMuteUser:()=>eb,ChatMessage:()=>j2,ClassifiedListing:()=>HT,ClientAuth:()=>nb,Comment:()=>Y2,CommunitiesList:()=>gT,CommunityDefinition:()=>tS,CommunityPostApproval:()=>iT,Contacts:()=>O2,CreateOrUpdateProduct:()=>FT,CreateOrUpdateStall:()=>NT,Curationsets:()=>RT,Date:()=>XT,DirectMessageRelaysList:()=>TT,DraftClassifiedListing:()=>$T,DraftLong:()=>UT,Emojisets:()=>VT,EncryptedDirectMessage:()=>B2,EventDeletion:()=>N2,FavoriteRelays:()=>xT,FileMessage:()=>V2,FileMetadata:()=>X2,FileServerPreference:()=>ST,Followsets:()=>DT,ForumThread:()=>U2,GenericRepost:()=>v0,Genericlists:()=>PT,GiftWrap:()=>tb,GroupMetadata:()=>nS,HTTPAuth:()=>x0,Handlerinformation:()=>eS,Handlerrecommendation:()=>JT,Highlights:()=>uT,InterestsList:()=>bT,Interestsets:()=>BT,JobFeedback:()=>sT,JobRequest:()=>rT,JobResult:()=>aT,Label:()=>nT,LightningPubRPC:()=>AT,LiveChatMessage:()=>K2,LiveEvent:()=>GT,LongFormArticle:()=>jT,Metadata:()=>R2,Mutelist:()=>dT,NWCWalletInfo:()=>MT,NWCWalletRequest:()=>ib,NWCWalletResponse:()=>CT,NormalVideo:()=>G2,NostrConnect:()=>zT,OpenTimestamps:()=>H2,Photo:()=>q2,Pinlist:()=>fT,Poll:()=>$2,PollResponse:()=>hT,PrivateDirectMessage:()=>Yx,ProblemTracker:()=>J2,ProfileBadges:()=>LT,PublicChatsList:()=>yT,Reaction:()=>_0,RecommendRelay:()=>L2,RelayList:()=>pT,RelayReview:()=>QT,Relaysets:()=>IT,Report:()=>eT,Reporting:()=>tT,Repost:()=>y0,Seal:()=>Xx,SearchRelaysList:()=>vT,ShortTextNote:()=>$x,ShortVideo:()=>Z2,Time:()=>YT,UserEmojiList:()=>wT,UserStatuses:()=>ZT,Voice:()=>W2,VoiceComment:()=>Q2,Zap:()=>cT,ZapGoal:()=>oT,ZapRequest:()=>lT,classifyKind:()=>I2,isAddressableKind:()=>g0,isEphemeralKind:()=>Hx,isKind:()=>k2,isRegularKind:()=>Zx,isReplaceableKind:()=>m0});function Zx(h){return h<1e4&&h!==0&&h!==3}function m0(h){return h===0||h===3||1e4<=h&&h<2e4}function Hx(h){return 2e4<=h&&h<3e4}function g0(h){return 3e4<=h&&h<4e4}function I2(h){return Zx(h)?"regular":m0(h)?"replaceable":Hx(h)?"ephemeral":g0(h)?"parameterized":"unknown"}function k2(h,m){const b=m instanceof Array?m:[m];return f0(h)&&b.includes(h.kind)||!1}var R2=0,$x=1,L2=2,O2=3,B2=4,N2=5,y0=6,_0=7,F2=8,j2=9,U2=11,Xx=13,Yx=14,V2=15,v0=16,q2=20,G2=21,Z2=22,Kx=40,Wx=41,Qx=42,Jx=43,eb=44,H2=1040,tb=1059,$2=1068,X2=1063,Y2=1111,K2=1311,W2=1222,Q2=1244,J2=1971,eT=1984,tT=1984,nT=1985,iT=4550,rT=5999,aT=6999,sT=7e3,oT=9041,lT=9734,cT=9735,uT=9802,hT=1018,dT=1e4,fT=10001,pT=10002,mT=10003,gT=10004,yT=10005,_T=10006,vT=10007,xT=10012,bT=10015,wT=10030,TT=10050,ST=10096,ET=10063,MT=13194,AT=21e3,nb=22242,ib=23194,CT=23195,zT=24133,x0=27235,DT=3e4,PT=30001,IT=30002,kT=30003,RT=30004,LT=30008,OT=30009,BT=30015,NT=30017,FT=30018,jT=30023,UT=30024,VT=30030,qT=30078,GT=30311,ZT=30315,HT=30402,$T=30403,XT=31922,YT=31923,KT=31924,WT=31925,QT=31987,JT=31989,eS=31990,tS=34550,nS=39e3;function iS(h,m){if(h.ids&&h.ids.indexOf(m.id)===-1||h.kinds&&h.kinds.indexOf(m.kind)===-1||h.authors&&h.authors.indexOf(m.pubkey)===-1)return!1;for(let b in h)if(b[0]==="#"){let S=b.slice(1),z=h[`#${S}`];if(z&&!m.tags.find(([k,A])=>k===b.slice(1)&&z.indexOf(A)!==-1))return!1}return!(h.since&&m.created_at<h.since||h.until&&m.created_at>h.until)}function rS(h,m){for(let b=0;b<h.length;b++)if(iS(h[b],m))return!0;return!1}var aS={};Zi(aS,{getHex64:()=>Vy,getInt:()=>rb,getSubscriptionId:()=>ab,matchEventId:()=>sS,matchEventKind:()=>lS,matchEventPubkey:()=>oS});function Vy(h,m){let b=m.length+3,S=h.indexOf(`"${m}":`)+b,z=h.slice(S).indexOf('"')+S+1;return h.slice(z,z+64)}function rb(h,m){let b=m.length,S=h.indexOf(`"${m}":`)+b+3,z=h.slice(S),k=Math.min(z.indexOf(","),z.indexOf("}"));return parseInt(z.slice(0,k),10)}function ab(h){let m=h.slice(0,22).indexOf('"EVENT"');if(m===-1)return null;let b=h.slice(m+7+1).indexOf('"');if(b===-1)return null;let S=m+7+1+b,z=h.slice(S+1,80).indexOf('"');if(z===-1)return null;let k=S+1+z;return h.slice(S+1,k)}function sS(h,m){return m===Vy(h,"id")}function oS(h,m){return m===Vy(h,"pubkey")}function lS(h,m){return m===rb(h,"kind")}var cS={};Zi(cS,{makeAuthEvent:()=>sb});function sb(h,m){return{kind:nb,created_at:Math.floor(Date.now()/1e3),tags:[["relay",h],["challenge",m]],content:""}}async function uS(){return new Promise((h,m)=>{try{if(typeof MessageChannel<"u"){const b=new MessageChannel,S=()=>{b.port1.removeEventListener("message",S),h()};b.port1.addEventListener("message",S),b.port2.postMessage(0),b.port1.start()}else typeof setImmediate<"u"?setImmediate(h):typeof setTimeout<"u"?setTimeout(h,0):h()}catch(b){console.error("during yield: ",b),m(b)}})}var hS=h=>(h[lf]=!0,!0),ob=class extends Error{constructor(h,m){super(`Tried to send message '${h} on a closed connection to ${m}.`),this.name="SendingOnClosedConnection"}},lb=class{url;_connected=!1;onclose=null;onnotice=h=>console.debug(`NOTICE from ${this.url}: ${h}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new qx;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(h,m){this.url=hf(h),this.verifyEvent=m.verifyEvent,this._WebSocket=m.websocketImplementation||WebSocket,this.enablePing=m.enablePing,this.enableReconnect=m.enableReconnect||!1}static async connect(h,m){const b=new lb(h,m);return await b.connect(),b}closeAllSubscriptions(h){for(let[m,b]of this.openSubs)b.close(h);this.openSubs.clear();for(let[m,b]of this.openEventPublishes)b.reject(new Error(h));this.openEventPublishes.clear();for(let[m,b]of this.openCountRequests)b.reject(new Error(h));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const h=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},h)}handleHardClose(h){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const m=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!m?this.reconnect():this.closeAllSubscriptions(h)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((h,m)=>{this.connectionTimeoutHandle=setTimeout(()=>{m("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(b){clearTimeout(this.connectionTimeoutHandle),m(b);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const b=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const S of this.openSubs.values()){if(S.eosed=!1,b)for(let z=0;z<S.filters.length;z++)S.lastEmitted&&(S.filters[z].since=S.lastEmitted+1);S.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),h()},this.ws.onerror=b=>{clearTimeout(this.connectionTimeoutHandle),m(b.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=b=>{clearTimeout(this.connectionTimeoutHandle),m(b.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(h=>{this.ws.once("pong",()=>h(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((h,m)=>{if(!this.connectionPromise)return m(new Error(`no connection to ${this.url}, can't ping`));try{const b=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{h(!0),b.close()},onclose(){h(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(b){m(b)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(m=>setTimeout(()=>m(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await uS();this.queueRunning=!1}handleNext(){const h=this.incomingMessageQueue.dequeue();if(!h)return!1;const m=ab(h);if(m){const b=this.openSubs.get(m);if(!b)return;const S=Vy(h,"id"),z=b.alreadyHaveEvent?.(S);if(b.receivedEvent?.(this,S),z)return}try{let b=JSON.parse(h);switch(b[0]){case"EVENT":{const S=this.openSubs.get(b[1]),z=b[2];this.verifyEvent(z)&&rS(S.filters,z)&&S.onevent(z),(!S.lastEmitted||S.lastEmitted<z.created_at)&&(S.lastEmitted=z.created_at);return}case"COUNT":{const S=b[1],z=b[2],k=this.openCountRequests.get(S);k&&(k.resolve(z.count),this.openCountRequests.delete(S));return}case"EOSE":{const S=this.openSubs.get(b[1]);if(!S)return;S.receivedEose();return}case"OK":{const S=b[1],z=b[2],k=b[3],A=this.openEventPublishes.get(S);A&&(clearTimeout(A.timeout),z?A.resolve(k):A.reject(new Error(k)),this.openEventPublishes.delete(S));return}case"CLOSED":{const S=b[1],z=this.openSubs.get(S);if(!z)return;z.closed=!0,z.close(b[2]);return}case"NOTICE":{this.onnotice(b[1]);return}case"AUTH":{this.challenge=b[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(b[1])?.oncustom?.(b);return}}}catch{return}}async send(h){if(!this.connectionPromise)throw new ob(h,this.url);this.connectionPromise.then(()=>{this.ws?.send(h)})}async auth(h){const m=this.challenge;if(!m)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(b,S)=>{try{let z=await h(sb(this.url,m)),k=setTimeout(()=>{let A=this.openEventPublishes.get(z.id);A&&(A.reject(new Error("auth timed out")),this.openEventPublishes.delete(z.id))},this.publishTimeout);this.openEventPublishes.set(z.id,{resolve:b,reject:S,timeout:k}),this.send('["AUTH",'+JSON.stringify(z)+"]")}catch(z){console.warn("subscribe auth function failed:",z)}}),this.authPromise)}async publish(h){const m=new Promise((b,S)=>{const z=setTimeout(()=>{const k=this.openEventPublishes.get(h.id);k&&(k.reject(new Error("publish timed out")),this.openEventPublishes.delete(h.id))},this.publishTimeout);this.openEventPublishes.set(h.id,{resolve:b,reject:S,timeout:z})});return this.send('["EVENT",'+JSON.stringify(h)+"]"),m}async count(h,m){this.serial++;const b=m?.id||"count:"+this.serial,S=new Promise((z,k)=>{this.openCountRequests.set(b,{resolve:z,reject:k})});return this.send('["COUNT","'+b+'",'+JSON.stringify(h).substring(1)),S}subscribe(h,m){const b=this.prepareSubscription(h,m);return b.fire(),b}prepareSubscription(h,m){this.serial++;const b=m.id||(m.label?m.label+":":"sub:")+this.serial,S=new dS(this,b,h,m);return this.openSubs.set(b,S),S}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(h){this.incomingMessageQueue.enqueue(h.data),this.queueRunning||this.runQueue()}},dS=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(h,m,b,S){if(b.length===0)throw new Error("subscription can't be created with zero filters");this.relay=h,this.filters=b,this.id=m,this.alreadyHaveEvent=S.alreadyHaveEvent,this.receivedEvent=S.receivedEvent,this.eoseTimeout=S.eoseTimeout||h.baseEoseTimeout,this.oneose=S.oneose,this.onclose=S.onclose,this.onevent=S.onevent||(z=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,z)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(h="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(m){if(!(m instanceof ob))throw m}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(h)}},fS;try{fS=WebSocket}catch{}var pS=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(h){this.verifyEvent=h.verifyEvent,this._WebSocket=h.websocketImplementation,this.enablePing=h.enablePing,this.enableReconnect=h.enableReconnect||!1,this.automaticallyAuth=h.automaticallyAuth}async ensureRelay(h,m){h=hf(h);let b=this.relays.get(h);if(b||(b=new lb(h,{verifyEvent:this.trustedRelayURLs.has(h)?hS:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),b.onclose=()=>{b&&!b.enableReconnect&&this.relays.delete(h)},m?.connectionTimeout&&(b.connectionTimeout=m.connectionTimeout),this.relays.set(h,b)),this.automaticallyAuth){const S=this.automaticallyAuth(h);S&&(b.onauth=S)}return await b.connect(),b}close(h){h.map(hf).forEach(m=>{this.relays.get(m)?.close(),this.relays.delete(m)})}subscribe(h,m,b){const S=[];for(let z=0;z<h.length;z++){const k=hf(h[z]);S.find(A=>A.url===k)||S.push({url:k,filter:m})}return this.subscribeMap(S,b)}subscribeMany(h,m,b){const S=[],z=[];for(let k=0;k<h.length;k++){const A=hf(h[k]);z.indexOf(A)===-1&&(z.push(A),S.push({url:A,filter:m}))}return this.subscribeMap(S,b)}subscribeMap(h,m){const b=new Map;for(const Ee of h){const{url:Ae,filter:Pe}=Ee;b.has(Ae)||b.set(Ae,[]),b.get(Ae).push(Pe)}const S=Array.from(b.entries()).map(([Ee,Ae])=>({url:Ee,filters:Ae}));this.trackRelays&&(m.receivedEvent=(Ee,Ae)=>{let Pe=this.seenOn.get(Ae);Pe||(Pe=new Set,this.seenOn.set(Ae,Pe)),Pe.add(Ee)});const z=new Set,k=[],A=[];let l=Ee=>{A[Ee]||(A[Ee]=!0,A.filter(Ae=>Ae).length===S.length&&(m.oneose?.(),l=()=>{}))};const N=[];let K=(Ee,Ae)=>{N[Ee]||(l(Ee),N[Ee]=Ae,N.filter(Pe=>Pe).length===S.length&&(m.onclose?.(N),K=()=>{}))};const ne=Ee=>{if(m.alreadyHaveEvent?.(Ee))return!0;const Ae=z.has(Ee);return z.add(Ee),Ae},re=Promise.all(S.map(async({url:Ee,filters:Ae},Pe)=>{let pe;try{pe=await this.ensureRelay(Ee,{connectionTimeout:m.maxWait?Math.max(m.maxWait*.8,m.maxWait-1e3):void 0})}catch(Re){K(Pe,Re?.message||String(Re));return}let ie=pe.subscribe(Ae,{...m,oneose:()=>l(Pe),onclose:Re=>{Re.startsWith("auth-required: ")&&m.onauth?pe.auth(m.onauth).then(()=>{pe.subscribe(Ae,{...m,oneose:()=>l(Pe),onclose:We=>{K(Pe,We)},alreadyHaveEvent:ne,eoseTimeout:m.maxWait})}).catch(We=>{K(Pe,`auth was required and attempted, but failed with: ${We}`)}):K(Pe,Re)},alreadyHaveEvent:ne,eoseTimeout:m.maxWait});k.push(ie)}));return{async close(Ee){await re,k.forEach(Ae=>{Ae.close(Ee)})}}}subscribeEose(h,m,b){const S=this.subscribe(h,m,{...b,oneose(){S.close("closed automatically on eose")}});return S}subscribeManyEose(h,m,b){const S=this.subscribeMany(h,m,{...b,oneose(){S.close("closed automatically on eose")}});return S}async querySync(h,m,b){return new Promise(async S=>{const z=[];this.subscribeEose(h,m,{...b,onevent(k){z.push(k)},onclose(k){S(z)}})})}async get(h,m,b){m.limit=1;const S=await this.querySync(h,m,b);return S.sort((z,k)=>k.created_at-z.created_at),S[0]||null}publish(h,m,b){return h.map(hf).map(async(S,z,k)=>{if(k.indexOf(S)!==z)return Promise.reject("duplicate url");let A=await this.ensureRelay(S);return A.publish(m).catch(async l=>{if(l instanceof Error&&l.message.startsWith("auth-required: ")&&b?.onauth)return await A.auth(b.onauth),A.publish(m);throw l}).then(l=>{if(this.trackRelays){let N=this.seenOn.get(m.id);N||(N=new Set,this.seenOn.set(m.id,N)),N.add(A)}return l})})}listConnectionStatus(){const h=new Map;return this.relays.forEach((m,b)=>h.set(b,m.connected)),h}destroy(){this.relays.forEach(h=>h.close()),this.relays=new Map}},cb;try{cb=WebSocket}catch{}var mS=class extends pS{constructor(h){super({verifyEvent:Uy,websocketImplementation:cb,...h})}},ff={};Zi(ff,{BECH32_REGEX:()=>ub,Bech32MaxSize:()=>b0,NostrTypeGuard:()=>gS,decode:()=>qy,decodeNostrURI:()=>_S,encodeBytes:()=>Zy,naddrEncode:()=>SS,neventEncode:()=>TS,noteEncode:()=>bS,nprofileEncode:()=>wS,npubEncode:()=>xS,nsecEncode:()=>vS});var gS={isNProfile:h=>/^nprofile1[a-z\d]+$/.test(h||""),isNEvent:h=>/^nevent1[a-z\d]+$/.test(h||""),isNAddr:h=>/^naddr1[a-z\d]+$/.test(h||""),isNSec:h=>/^nsec1[a-z\d]{58}$/.test(h||""),isNPub:h=>/^npub1[a-z\d]{58}$/.test(h||""),isNote:h=>/^note1[a-z\d]+$/.test(h||""),isNcryptsec:h=>/^ncryptsec1[a-z\d]+$/.test(h||"")},b0=5e3,ub=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function yS(h){const m=new Uint8Array(4);return m[0]=h>>24&255,m[1]=h>>16&255,m[2]=h>>8&255,m[3]=h&255,m}function _S(h){try{return h.startsWith("nostr:")&&(h=h.substring(6)),qy(h)}catch{return{type:"invalid",data:null}}}function qy(h){let{prefix:m,words:b}=Gp.decode(h,b0),S=new Uint8Array(Gp.fromWords(b));switch(m){case"nprofile":{let z=z_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(z[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Dr(z[0][0]),relays:z[1]?z[1].map(k=>Lu.decode(k)):[]}}}case"nevent":{let z=z_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for nevent");if(z[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(z[2]&&z[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(z[3]&&z[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Dr(z[0][0]),relays:z[1]?z[1].map(k=>Lu.decode(k)):[],author:z[2]?.[0]?Dr(z[2][0]):void 0,kind:z[3]?.[0]?parseInt(Dr(z[3][0]),16):void 0}}}case"naddr":{let z=z_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!z[2]?.[0])throw new Error("missing TLV 2 for naddr");if(z[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!z[3]?.[0])throw new Error("missing TLV 3 for naddr");if(z[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Lu.decode(z[0][0]),pubkey:Dr(z[2][0]),kind:parseInt(Dr(z[3][0]),16),relays:z[1]?z[1].map(k=>Lu.decode(k)):[]}}}case"nsec":return{type:m,data:S};case"npub":case"note":return{type:m,data:Dr(S)};default:throw new Error(`unknown prefix ${m}`)}}function z_(h){let m={},b=h;for(;b.length>0;){let S=b[0],z=b[1],k=b.slice(2,2+z);if(b=b.slice(2+z),k.length<z)throw new Error(`not enough data to read on TLV ${S}`);m[S]=m[S]||[],m[S].push(k)}return m}function vS(h){return Zy("nsec",h)}function xS(h){return Zy("npub",mf(h))}function bS(h){return Zy("note",mf(h))}function Gy(h,m){let b=Gp.toWords(m);return Gp.encode(h,b,b0)}function Zy(h,m){return Gy(h,m)}function wS(h){let m=w0({0:[mf(h.pubkey)],1:(h.relays||[]).map(b=>Ol.encode(b))});return Gy("nprofile",m)}function TS(h){let m;h.kind!==void 0&&(m=yS(h.kind));let b=w0({0:[mf(h.id)],1:(h.relays||[]).map(S=>Ol.encode(S)),2:h.author?[mf(h.author)]:[],3:m?[new Uint8Array(m)]:[]});return Gy("nevent",b)}function SS(h){let m=new ArrayBuffer(4);new DataView(m).setUint32(0,h.kind,!1);let b=w0({0:[Ol.encode(h.identifier)],1:(h.relays||[]).map(S=>Ol.encode(S)),2:[mf(h.pubkey)],3:[new Uint8Array(m)]});return Gy("naddr",b)}function w0(h){let m=[];return Object.entries(h).reverse().forEach(([b,S])=>{S.forEach(z=>{let k=new Uint8Array(z.length+2);k.set([parseInt(b)],0),k.set([z.length],1),k.set(z,2),m.push(k)})}),By(...m)}var ES={};Zi(ES,{decrypt:()=>MS,encrypt:()=>hb});function hb(h,m,b){const S=h instanceof Uint8Array?Dr(h):h,z=Hp.getSharedSecret(S,"02"+m),k=db(z);let A=Uint8Array.from(Ex(16)),l=Ol.encode(b),N=Ox(k,A).encrypt(l),K=Ou.encode(new Uint8Array(N)),ne=Ou.encode(new Uint8Array(A.buffer));return`${K}?iv=${ne}`}function MS(h,m,b){const S=h instanceof Uint8Array?Dr(h):h;let[z,k]=b.split("?iv="),A=Hp.getSharedSecret(S,"02"+m),l=db(A),N=Ou.decode(k),K=Ou.decode(z),ne=Ox(l,N).decrypt(K);return Lu.decode(ne)}function db(h){return h.slice(1,33)}var AS={};Zi(AS,{NIP05_REGEX:()=>T0,isNip05:()=>CS,isValid:()=>PS,queryProfile:()=>fb,searchDomain:()=>DS,useFetchImplementation:()=>zS});var T0=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,CS=h=>T0.test(h||""),Hy;try{Hy=fetch}catch{}function zS(h){Hy=h}async function DS(h,m=""){try{const b=`https://${h}/.well-known/nostr.json?name=${m}`,S=await Hy(b,{redirect:"manual"});if(S.status!==200)throw Error("Wrong response code");return(await S.json()).names}catch{return{}}}async function fb(h){const m=h.match(T0);if(!m)return null;const[,b="_",S]=m;try{const z=`https://${S}/.well-known/nostr.json?name=${b}`,k=await Hy(z,{redirect:"manual"});if(k.status!==200)throw Error("Wrong response code");const A=await k.json(),l=A.names[b];return l?{pubkey:l,relays:A.relays?.[l]}:null}catch{return null}}async function PS(h,m){const b=await fb(m);return b?b.pubkey===h:!1}var IS={};Zi(IS,{parse:()=>kS});function kS(h){const m={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let b,S;for(let z=h.tags.length-1;z>=0;z--){const k=h.tags[z];if(k[0]==="e"&&k[1]){const[A,l,N,K,ne]=k,re={id:l,relays:N?[N]:[],author:ne};if(K==="root"){m.root=re;continue}if(K==="reply"){m.reply=re;continue}if(K==="mention"){m.mentions.push(re);continue}b?S=re:b=re,m.mentions.push(re);continue}if(k[0]==="q"&&k[1]){const[A,l,N]=k;m.quotes.push({id:l,relays:N?[N]:[]})}if(k[0]==="p"&&k[1]){m.profiles.push({pubkey:k[1],relays:k[2]?[k[2]]:[]});continue}}return m.root||(m.root=S||b||m.reply),m.reply||(m.reply=b||m.root),[m.reply,m.root].forEach(z=>{if(!z)return;let k=m.mentions.indexOf(z);if(k!==-1&&m.mentions.splice(k,1),z.author){let A=m.profiles.find(l=>l.pubkey===z.author);A&&A.relays&&(z.relays||(z.relays=[]),A.relays.forEach(l=>{z.relays?.indexOf(l)===-1&&z.relays.push(l)}),A.relays=z.relays)}}),m.mentions.forEach(z=>{if(z.author){let k=m.profiles.find(A=>A.pubkey===z.author);k&&k.relays&&(z.relays||(z.relays=[]),k.relays.forEach(A=>{z.relays.indexOf(A)===-1&&z.relays.push(A)}),k.relays=z.relays)}}),m}var RS={};Zi(RS,{fetchRelayInformation:()=>OS,useFetchImplementation:()=>LS});var pb;try{pb=fetch}catch{}function LS(h){pb=h}async function OS(h){return await(await fetch(h.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var BS={};Zi(BS,{fastEventHash:()=>gb,getPow:()=>mb,minePow:()=>NS});function mb(h){let m=0;for(let b=0;b<64;b+=8){const S=parseInt(h.substring(b,b+8),16);if(S===0)m+=32;else{m+=Math.clz32(S);break}}return m}function NS(h,m){let b=0;const S=h,z=["nonce",b.toString(),m.toString()];for(S.tags.push(z);;){const k=Math.floor(new Date().getTime()/1e3);if(k!==S.created_at&&(b=0,S.created_at=k),z[1]=(++b).toString(),S.id=gb(S),mb(S.id)>=m)break}return S}function gb(h){return Dr(Xh(Ol.encode(JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content]))))}var FS={};Zi(FS,{unwrapEvent:()=>KS,unwrapManyEvents:()=>WS,wrapEvent:()=>zb,wrapManyEvents:()=>YS});var jS={};Zi(jS,{createRumor:()=>Eb,createSeal:()=>Mb,createWrap:()=>Ab,unwrapEvent:()=>C0,unwrapManyEvents:()=>Cb,wrapEvent:()=>My,wrapManyEvents:()=>$S});var cg={};Zi(cg,{decrypt:()=>A0,encrypt:()=>M0,getConversationKey:()=>S0,v2:()=>ZS});var yb=1,_b=65535;function S0(h,m){const b=Hp.getSharedSecret(h,"02"+m).subarray(1,33);return w2(Xh,b,"nip44-v2")}function vb(h,m){const b=T2(Xh,h,m,76);return{chacha_key:b.subarray(0,32),chacha_nonce:b.subarray(32,44),hmac_key:b.subarray(44,76)}}function E0(h){if(!Number.isSafeInteger(h)||h<1)throw new Error("expected positive integer");if(h<=32)return 32;const m=1<<Math.floor(Math.log2(h-1))+1,b=m<=256?32:m/8;return b*(Math.floor((h-1)/b)+1)}function US(h){if(!Number.isSafeInteger(h)||h<yb||h>_b)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const m=new Uint8Array(2);return new DataView(m.buffer).setUint16(0,h,!1),m}function VS(h){const m=Ol.encode(h),b=m.length,S=US(b),z=new Uint8Array(E0(b)-b);return By(S,m,z)}function qS(h){const m=new DataView(h.buffer).getUint16(0),b=h.subarray(2,2+m);if(m<yb||m>_b||b.length!==m||h.length!==2+E0(m))throw new Error("invalid padding");return Lu.decode(b)}function xb(h,m,b){if(b.length!==32)throw new Error("AAD associated data must be 32 bytes");const S=By(b,m);return Fy(Xh,h,S)}function GS(h){if(typeof h!="string")throw new Error("payload must be a valid string");const m=h.length;if(m<132||m>87472)throw new Error("invalid payload length: "+m);if(h[0]==="#")throw new Error("unknown encryption version");let b;try{b=Ou.decode(h)}catch(k){throw new Error("invalid base64: "+k.message)}const S=b.length;if(S<99||S>65603)throw new Error("invalid data length: "+S);const z=b[0];if(z!==2)throw new Error("unknown encryption version "+z);return{nonce:b.subarray(1,33),ciphertext:b.subarray(33,-32),mac:b.subarray(-32)}}function M0(h,m,b=Ex(32)){const{chacha_key:S,chacha_nonce:z,hmac_key:k}=vb(m,b),A=VS(h),l=jx(S,z,A),N=xb(k,l,b);return Ou.encode(By(new Uint8Array([2]),b,l,N))}function A0(h,m){const{nonce:b,ciphertext:S,mac:z}=GS(h),{chacha_key:k,chacha_nonce:A,hmac_key:l}=vb(m,b),N=xb(l,S,b);if(!i2(N,z))throw new Error("invalid MAC");const K=jx(k,A,S);return qS(K)}var ZS={utils:{getConversationKey:S0,calcPaddedLen:E0},encrypt:M0,decrypt:A0},HS=2880*60,bb=()=>Math.round(Date.now()/1e3),wb=()=>Math.round(bb()-Math.random()*HS),Tb=(h,m)=>S0(h,m),Sb=(h,m,b)=>M0(JSON.stringify(h),Tb(m,b)),Sv=(h,m)=>JSON.parse(A0(h.content,Tb(m,h.pubkey)));function Eb(h,m){const b={created_at:bb(),content:"",tags:[],...h,pubkey:lg(m)};return b.id=yy(b),b}function Mb(h,m,b){return qo({kind:Xx,content:Sb(h,m,b),created_at:wb(),tags:[]},m)}function Ab(h,m){const b=Gx();return qo({kind:tb,content:Sb(h,b,m),created_at:wb(),tags:[["p",m]]},b)}function My(h,m,b){const S=Eb(h,m),z=Mb(S,m,b);return Ab(z,b)}function $S(h,m,b){if(!b||b.length===0)throw new Error("At least one recipient is required.");const S=lg(m),z=[My(h,m,S)];return b.forEach(k=>{z.push(My(h,m,k))}),z}function C0(h,m){const b=Sv(h,m);return Sv(b,m)}function Cb(h,m){let b=[];return h.forEach(S=>{b.push(C0(S,m))}),b.sort((S,z)=>S.created_at-z.created_at),b}function XS(h,m,b,S){const z={created_at:Math.ceil(Date.now()/1e3),kind:Yx,tags:[],content:m};return(Array.isArray(h)?h:[h]).forEach(({publicKey:A,relayUrl:l})=>{z.tags.push(l?["p",A,l]:["p",A])}),S&&z.tags.push(["e",S.eventId,S.relayUrl||"","reply"]),b&&z.tags.push(["subject",b]),z}function zb(h,m,b,S,z){const k=XS(m,b,S,z);return My(k,h,m.publicKey)}function YS(h,m,b,S,z){if(!m||m.length===0)throw new Error("At least one recipient is required.");return[{publicKey:lg(h)},...m].map(A=>zb(h,A,b,S,z))}var KS=C0,WS=Cb,QS={};Zi(QS,{finishRepostEvent:()=>JS,getRepostedEvent:()=>eE,getRepostedEventPointer:()=>Db});function JS(h,m,b,S){let z;const k=[...h.tags??[],["e",m.id,b],["p",m.pubkey]];return m.kind===$x?z=y0:(z=v0,k.push(["k",String(m.kind)])),qo({kind:z,tags:k,content:h.content===""||m.tags?.find(A=>A[0]==="-")?"":JSON.stringify(m),created_at:h.created_at},S)}function Db(h){if(![y0,v0].includes(h.kind))return;let m,b;for(let S=h.tags.length-1;S>=0&&(m===void 0||b===void 0);S--){const z=h.tags[S];z.length>=2&&(z[0]==="e"&&m===void 0?m=z:z[0]==="p"&&b===void 0&&(b=z))}if(m!==void 0)return{id:m[1],relays:[m[2],b?.[2]].filter(S=>typeof S=="string"),author:b?.[1]}}function eE(h,{skipVerification:m}={}){const b=Db(h);if(b===void 0||h.content==="")return;let S;try{S=JSON.parse(h.content)}catch{return}if(S.id===b.id&&!(!m&&!Uy(S)))return S}var tE={};Zi(tE,{NOSTR_URI_REGEX:()=>z0,parse:()=>iE,test:()=>nE});var z0=new RegExp(`nostr:(${ub.source})`);function nE(h){return typeof h=="string"&&new RegExp(`^${z0.source}$`).test(h)}function iE(h){const m=h.match(new RegExp(`^${z0.source}$`));if(!m)throw new Error(`Invalid Nostr URI: ${h}`);return{uri:m[0],value:m[1],decoded:qy(m[1])}}var rE={};Zi(rE,{finishReactionEvent:()=>aE,getReactedEventPointer:()=>sE});function aE(h,m,b){const S=m.tags.filter(z=>z.length>=2&&(z[0]==="e"||z[0]==="p"));return qo({...h,kind:_0,tags:[...h.tags??[],...S,["e",m.id],["p",m.pubkey]],content:h.content??"+"},b)}function sE(h){if(h.kind!==_0)return;let m,b;for(let S=h.tags.length-1;S>=0&&(m===void 0||b===void 0);S--){const z=h.tags[S];z.length>=2&&(z[0]==="e"&&m===void 0?m=z:z[0]==="p"&&b===void 0&&(b=z))}if(!(m===void 0||b===void 0))return{id:m[1],relays:[m[2],b[2]].filter(S=>S!==void 0),author:b[1]}}var oE={};Zi(oE,{parse:()=>cE});var Ev=/\W/m,Mv=/[^\w\/] |[^\w\/]$|$|,| /m,lE=42;function*cE(h){let m=[];if(typeof h!="string"){for(let k=0;k<h.tags.length;k++){const A=h.tags[k];A[0]==="emoji"&&A.length>=3&&m.push({type:"emoji",shortcode:A[1],url:A[2]})}h=h.content}const b=h.length;let S=0,z=0;e:for(;z<b;){const k=h.indexOf(":",z),A=h.indexOf("#",z);if(k===-1&&A===-1)break e;if(k===-1||A>=0&&A<k){if(A===0||h[A-1]===" "){const l=h.slice(A+1,A+lE).match(Ev),N=l?A+1+l.index:b;yield{type:"text",text:h.slice(S,A)},yield{type:"hashtag",value:h.slice(A+1,N)},z=N,S=z;continue e}z=A+1;continue e}if(h.slice(k-5,k)==="nostr"){const l=h.slice(k+60).match(Ev),N=l?k+60+l.index:b;try{let K,{data:ne,type:re}=qy(h.slice(k+1,N));switch(re){case"npub":K={pubkey:ne};break;case"note":K={id:ne};break;case"nsec":z=N+1;continue;default:K=ne}S!==k-5&&(yield{type:"text",text:h.slice(S,k-5)}),yield{type:"reference",pointer:K},z=N,S=z;continue e}catch{z=k+1;continue e}}else if(h.slice(k-5,k)==="https"||h.slice(k-4,k)==="http"){const l=h.slice(k+4).match(Mv),N=l?k+4+l.index:b,K=h[k-1]==="s"?5:4;try{let ne=new URL(h.slice(k-K,N));if(ne.hostname.indexOf(".")===-1)throw new Error("invalid url");if(S!==k-K&&(yield{type:"text",text:h.slice(S,k-K)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(ne.pathname)){yield{type:"image",url:ne.toString()},z=N,S=z;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(ne.pathname)){yield{type:"video",url:ne.toString()},z=N,S=z;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(ne.pathname)){yield{type:"audio",url:ne.toString()},z=N,S=z;continue e}yield{type:"url",url:ne.toString()},z=N,S=z;continue e}catch{z=N+1;continue e}}else if(h.slice(k-3,k)==="wss"||h.slice(k-2,k)==="ws"){const l=h.slice(k+4).match(Mv),N=l?k+4+l.index:b,K=h[k-1]==="s"?3:2;try{let ne=new URL(h.slice(k-K,N));if(ne.hostname.indexOf(".")===-1)throw new Error("invalid ws url");S!==k-K&&(yield{type:"text",text:h.slice(S,k-K)}),yield{type:"relay",url:ne.toString()},z=N,S=z;continue e}catch{z=N+1;continue e}}else{for(let l=0;l<m.length;l++){const N=m[l];if(h[k+N.shortcode.length+1]===":"&&h.slice(k+1,k+N.shortcode.length+1)===N.shortcode){S!==k&&(yield{type:"text",text:h.slice(S,k)}),yield N,z=k+N.shortcode.length+2,S=z;continue e}}z=k+1;continue e}}S!==b&&(yield{type:"text",text:h.slice(S)})}var uE={};Zi(uE,{channelCreateEvent:()=>hE,channelHideMessageEvent:()=>pE,channelMessageEvent:()=>fE,channelMetadataEvent:()=>dE,channelMuteUserEvent:()=>mE});var hE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return qo({kind:Kx,tags:[...h.tags??[]],content:b,created_at:h.created_at},m)},dE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return qo({kind:Wx,tags:[["e",h.channel_create_event_id],...h.tags??[]],content:b,created_at:h.created_at},m)},fE=(h,m)=>{const b=[["e",h.channel_create_event_id,h.relay_url,"root"]];return h.reply_to_channel_message_event_id&&b.push(["e",h.reply_to_channel_message_event_id,h.relay_url,"reply"]),qo({kind:Qx,tags:[...b,...h.tags??[]],content:h.content,created_at:h.created_at},m)},pE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return qo({kind:Jx,tags:[["e",h.channel_message_event_id],...h.tags??[]],content:b,created_at:h.created_at},m)},mE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return qo({kind:eb,tags:[["p",h.pubkey_to_mute],...h.tags??[]],content:b,created_at:h.created_at},m)},gE={};Zi(gE,{EMOJI_SHORTCODE_REGEX:()=>Pb,matchAll:()=>yE,regex:()=>D0,replaceAll:()=>_E});var Pb=/:(\w+):/,D0=()=>new RegExp(`\\B${Pb.source}\\B`,"g");function*yE(h){const m=h.matchAll(D0());for(const b of m)try{const[S,z]=b;yield{shortcode:S,name:z,start:b.index,end:b.index+S.length}}catch{}}function _E(h,m){return h.replaceAll(D0(),(b,S)=>m({shortcode:b,name:S}))}var vE={};Zi(vE,{useFetchImplementation:()=>xE,validateGithub:()=>bE});var P0;try{P0=fetch}catch{}function xE(h){P0=h}async function bE(h,m,b){try{return await(await P0(`https://gist.github.com/${m}/${b}/raw`)).text()===`Verifying that I control the following Nostr public key: ${h}`}catch{return!1}}var wE={};Zi(wE,{makeNwcRequestEvent:()=>SE,parseConnectionString:()=>TE});function TE(h){const{host:m,pathname:b,searchParams:S}=new URL(h),z=b||m,k=S.get("relay"),A=S.get("secret");if(!z||!k||!A)throw new Error("invalid connection string");return{pubkey:z,relay:k,secret:A}}async function SE(h,m,b){const z=hb(m,h,JSON.stringify({method:"pay_invoice",params:{invoice:b}})),k={kind:ib,created_at:Math.round(Date.now()/1e3),content:z,tags:[["p",h]]};return qo(k,m)}var EE={};Zi(EE,{normalizeIdentifier:()=>ME});function ME(h){return h=h.trim().toLowerCase(),h=h.normalize("NFKC"),Array.from(h).map(m=>new RegExp("\\p{Letter}","u").test(m)||new RegExp("\\p{Number}","u").test(m)?m:"-").join("")}var AE={};Zi(AE,{getSatoshisAmountFromBolt11:()=>kE,getZapEndpoint:()=>zE,makeZapReceipt:()=>IE,makeZapRequest:()=>DE,useFetchImplementation:()=>CE,validateZapRequest:()=>PE});var I0;try{I0=fetch}catch{}function CE(h){I0=h}async function zE(h){try{let m="",{lud06:b,lud16:S}=JSON.parse(h.content);if(S){let[A,l]=S.split("@");m=new URL(`/.well-known/lnurlp/${A}`,`https://${l}`).toString()}else if(b){let{words:A}=Gp.decode(b,1e3),l=Gp.fromWords(A);m=Lu.decode(l)}else return null;let k=await(await I0(m)).json();if(k.allowsNostr&&k.nostrPubkey)return k.callback}catch{}return null}function DE(h){let m={kind:9734,created_at:Math.round(Date.now()/1e3),content:h.comment||"",tags:[["p","pubkey"in h?h.pubkey:h.event.pubkey],["amount",h.amount.toString()],["relays",...h.relays]]};if("event"in h){if(m.tags.push(["e",h.event.id]),m0(h.event.kind)){const b=["a",`${h.event.kind}:${h.event.pubkey}:`];m.tags.push(b)}else if(g0(h.event.kind)){let b=h.event.tags.find(([z,k])=>z==="d"&&k);if(!b)throw new Error("d tag not found or is empty");const S=["a",`${h.event.kind}:${h.event.pubkey}:${b[1]}`];m.tags.push(S)}m.tags.push(["k",h.event.kind.toString()])}return m}function PE(h){let m;try{m=JSON.parse(h)}catch{return"Invalid zap request JSON."}if(!f0(m))return"Zap request is not a valid Nostr event.";if(!Uy(m))return"Invalid signature on zap request.";let b=m.tags.find(([k,A])=>k==="p"&&A);if(!b)return"Zap request doesn't have a 'p' tag.";if(!b[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let S=m.tags.find(([k,A])=>k==="e"&&A);return S&&!S[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":m.tags.find(([k,A])=>k==="relays"&&A)?null:"Zap request doesn't have a 'relays' tag."}function IE({zapRequest:h,preimage:m,bolt11:b,paidAt:S}){let z=JSON.parse(h),k=z.tags.filter(([l])=>l==="e"||l==="p"||l==="a"),A={kind:9735,created_at:Math.round(S.getTime()/1e3),content:"",tags:[...k,["P",z.pubkey],["bolt11",b],["description",h]]};return m&&A.tags.push(["preimage",m]),A}function kE(h){if(h.length<50)return 0;h=h.substring(0,50);const m=h.lastIndexOf("1");if(m===-1)return 0;const b=h.substring(0,m);if(!b.startsWith("lnbc"))return 0;const S=b.substring(4);if(S.length<1)return 0;const z=S[S.length-1],k=z.charCodeAt(0)-48,A=k>=0&&k<=9;let l=S.length-1;if(A&&l++,l<1)return 0;const N=parseInt(S.substring(0,l));switch(z){case"m":return N*1e5;case"u":return N*100;case"n":return N/10;case"p":return N/1e4;default:return N*1e8}}var RE={};Zi(RE,{Negentropy:()=>kb,NegentropyStorageVector:()=>BE,NegentropySync:()=>NE});var D_=97,Up=32,Ib=16,of={Skip:0,Fingerprint:1,IdList:2},Ru=class{_raw;length;constructor(h){typeof h=="number"?(this._raw=new Uint8Array(h),this.length=0):h instanceof Uint8Array?(this._raw=new Uint8Array(h),this.length=h.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(h){if(h instanceof Ru&&(h=h.unwrap()),typeof h.length!="number")throw Error("bad length");const m=h.length+this.length;if(this.capacity<m){const b=this._raw,S=Math.max(this.capacity*2,m);this._raw=new Uint8Array(S),this._raw.set(b)}this._raw.set(h,this.length),this.length+=h.length}shift(){const h=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,h}shiftN(h=1){const m=this._raw.subarray(0,h);return this._raw=this._raw.subarray(h),this.length-=h,m}};function my(h){let m=0;for(;;){if(h.length===0)throw Error("parse ends prematurely");let b=h.shift();if(m=m<<7|b&127,(b&128)===0)break}return m}function Iu(h){if(h===0)return new Ru(new Uint8Array([0]));let m=[];for(;h!==0;)m.push(h&127),h>>>=7;m.reverse();for(let b=0;b<m.length-1;b++)m[b]|=128;return new Ru(new Uint8Array(m))}function LE(h){return _y(h,1)[0]}function _y(h,m){if(h.length<m)throw Error("parse ends prematurely");return h.shiftN(m)}var OE=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(Up)}add(h){let m=0,b=0,S=new DataView(this.buf.buffer),z=new DataView(h.buffer);for(let k=0;k<8;k++){let A=k*4,l=S.getUint32(A,!0),N=z.getUint32(A,!0),K=l;K+=m,K+=N,K>4294967295&&(b=1),S.setUint32(A,K&4294967295,!0),m=b,b=0}}negate(){let h=new DataView(this.buf.buffer);for(let b=0;b<8;b++){let S=b*4;h.setUint32(S,~h.getUint32(S,!0))}let m=new Uint8Array(Up);m[0]=1,this.add(m)}getFingerprint(h){let m=new Ru;return m.extend(this.buf),m.extend(Iu(h)),Xh(m.unwrap()).subarray(0,Ib)}},BE=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(h,m){if(this.sealed)throw Error("already sealed");const b=Px(m);if(b.byteLength!==Up)throw Error("bad id size for added item");this.items.push({timestamp:h,id:b})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(P_);for(let h=1;h<this.items.length;h++)if(P_(this.items[h-1],this.items[h])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(h){if(this._checkSealed(),h>=this.items.length)throw Error("out of range");return this.items[h]}iterate(h,m,b){this._checkSealed(),this._checkBounds(h,m);for(let S=h;S<m&&b(this.items[S],S);++S);}findLowerBound(h,m,b){return this._checkSealed(),this._checkBounds(h,m),this._binarySearch(this.items,h,m,S=>P_(S,b)<0)}fingerprint(h,m){let b=new OE;return b.setToZero(),this.iterate(h,m,S=>(b.add(S.id),!0)),b.getFingerprint(m-h)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(h,m){if(h>m||m>this.items.length)throw Error("bad range")}_binarySearch(h,m,b,S){let z=b-m;for(;z>0;){let k=m,A=Math.floor(z/2);k+=A,S(h[k])?(m=++k,z-=A+1):z=A}return m}},kb=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(h,m=6e4){if(m<4096)throw Error("frameSizeLimit too small");this.storage=h,this.frameSizeLimit=m,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(h,m){return{timestamp:h,id:m||new Uint8Array(0)}}initiate(){let h=new Ru;return h.extend(new Uint8Array([D_])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),h),Fp(h.unwrap())}reconcile(h,m,b){const S=new Ru(Px(h));this.lastTimestampIn=this.lastTimestampOut=0;let z=new Ru;z.extend(new Uint8Array([D_]));let k=LE(S);if(k<96||k>111)throw Error("invalid negentropy protocol version byte");if(k!==D_)throw Error("unsupported negentropy protocol version requested: "+(k-96));let A=this.storage.size(),l=this._bound(0),N=0,K=!1;for(;S.length!==0;){let ne=new Ru,re=()=>{K&&(K=!1,ne.extend(this.encodeBound(l)),ne.extend(Iu(of.Skip)))},Ee=this.decodeBound(S),Ae=my(S),Pe=N,pe=this.storage.findLowerBound(N,A,Ee);if(Ae===of.Skip)K=!0;else if(Ae===of.Fingerprint){let ie=_y(S,Ib),Re=this.storage.fingerprint(Pe,pe);Rb(ie,Re)!==0?(re(),this.splitRange(Pe,pe,Ee,ne)):K=!0}else if(Ae===of.IdList){let ie=my(S),Re={};for(let We=0;We<ie;We++){let it=_y(S,Up);Re[Fp(it)]=it}if(K=!0,this.storage.iterate(Pe,pe,We=>{let it=We.id;const Dt=Fp(it);return Re[Dt]?delete Re[Fp(it)]:m?.(Dt),!0}),b)for(let We of Object.values(Re))b(Fp(We))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(z.length+ne.length)){let ie=this.storage.fingerprint(pe,A);z.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),z.extend(Iu(of.Fingerprint)),z.extend(ie);break}else z.extend(ne);N=pe,l=Ee}return z.length===1?null:Fp(z.unwrap())}splitRange(h,m,b,S){let z=m-h,k=16;if(z<k*2)S.extend(this.encodeBound(b)),S.extend(Iu(of.IdList)),S.extend(Iu(z)),this.storage.iterate(h,m,A=>(S.extend(A.id),!0));else{let A=Math.floor(z/k),l=z%k,N=h;for(let K=0;K<k;K++){let ne=A+(K<l?1:0),re=this.storage.fingerprint(N,N+ne);N+=ne;let Ee;if(N===m)Ee=b;else{let Ae,Pe;this.storage.iterate(N-1,N+1,(pe,ie)=>(ie===N-1?Ae=pe:Pe=pe,!0)),Ee=this.getMinimalBound(Ae,Pe)}S.extend(this.encodeBound(Ee)),S.extend(Iu(of.Fingerprint)),S.extend(re)}}}exceededFrameSizeLimit(h){return h>this.frameSizeLimit-200}decodeTimestampIn(h){let m=my(h);return m=m===0?Number.MAX_VALUE:m-1,this.lastTimestampIn===Number.MAX_VALUE||m===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(m+=this.lastTimestampIn,this.lastTimestampIn=m,m)}decodeBound(h){let m=this.decodeTimestampIn(h),b=my(h);if(b>Up)throw Error("bound key too long");let S=_y(h,b);return{timestamp:m,id:S}}encodeTimestampOut(h){if(h===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,Iu(0);let m=h;return h-=this.lastTimestampOut,this.lastTimestampOut=m,Iu(h+1)}encodeBound(h){let m=new Ru;return m.extend(this.encodeTimestampOut(h.timestamp)),m.extend(Iu(h.id.length)),m.extend(h.id),m}getMinimalBound(h,m){if(m.timestamp!==h.timestamp)return this._bound(m.timestamp);{let b=0,S=m.id,z=h.id;for(let k=0;k<Up&&S[k]===z[k];k++)b++;return this._bound(m.timestamp,m.id.subarray(0,b+1))}}};function Rb(h,m){for(let b=0;b<h.byteLength;b++){if(h[b]<m[b])return-1;if(h[b]>m[b])return 1}return h.byteLength>m.byteLength?1:h.byteLength<m.byteLength?-1:0}function P_(h,m){return h.timestamp===m.timestamp?Rb(h.id,m.id):h.timestamp-m.timestamp}var NE=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(h,m,b,S={}){this.relay=h,this.storage=m,this.neg=new kb(m),this.onhave=S.onhave,this.onneed=S.onneed,this.filter=b,this.subscription=this.relay.prepareSubscription([{}],{label:S.label||"negentropy"}),this.subscription.oncustom=z=>{switch(z[0]){case"NEG-MSG":{z.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${z}`);try{const k=this.neg.reconcile(z[2],this.onhave,this.onneed);k?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${k}"]`):(this.close(),S.onclose?.())}catch(k){console.error("negentropy reconcile error:",k),S?.onclose?.(`reconcile error: ${k}`)}break}case"NEG-CLOSE":{const k=z[2];console.warn("negentropy error:",k),S.onclose?.(k);break}case"NEG-ERR":S.onclose?.()}}}async start(){const h=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${h}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},FE={};Zi(FE,{getToken:()=>jE,hashPayload:()=>k0,unpackEventFromToken:()=>Ob,validateEvent:()=>Vb,validateEventKind:()=>Nb,validateEventMethodTag:()=>jb,validateEventPayloadTag:()=>Ub,validateEventTimestamp:()=>Bb,validateEventUrlTag:()=>Fb,validateToken:()=>UE});var Lb="Nostr ";async function jE(h,m,b,S=!1,z){const k={kind:x0,tags:[["u",h],["method",m]],created_at:Math.round(new Date().getTime()/1e3),content:""};z&&k.tags.push(["payload",k0(z)]);const A=await b(k);return(S?Lb:"")+Ou.encode(Ol.encode(JSON.stringify(A)))}async function UE(h,m,b){const S=await Ob(h).catch(k=>{throw k});return await Vb(S,m,b).catch(k=>{throw k})}async function Ob(h){if(!h)throw new Error("Missing token");h=h.replace(Lb,"");const m=Lu.decode(Ou.decode(h));if(!m||m.length===0||!m.startsWith("{"))throw new Error("Invalid token");return JSON.parse(m)}function Bb(h){return h.created_at?Math.round(new Date().getTime()/1e3)-h.created_at<60:!1}function Nb(h){return h.kind===x0}function Fb(h,m){const b=h.tags.find(S=>S[0]==="u");return b?b.length>0&&b[1]===m:!1}function jb(h,m){const b=h.tags.find(S=>S[0]==="method");return b?b.length>0&&b[1].toLowerCase()===m.toLowerCase():!1}function k0(h){const m=Xh(Ol.encode(JSON.stringify(h)));return Dr(m)}function Ub(h,m){const b=h.tags.find(z=>z[0]==="payload");if(!b)return!1;const S=k0(m);return b.length>0&&b[1]===S}async function Vb(h,m,b,S){if(!Uy(h))throw new Error("Invalid nostr event, signature invalid");if(!Nb(h))throw new Error("Invalid nostr event, kind invalid");if(!Bb(h))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Fb(h,m))throw new Error("Invalid nostr event, url tag invalid");if(!jb(h,b))throw new Error("Invalid nostr event, method tag invalid");if(S&&typeof S=="object"&&Object.keys(S).length>0&&!Ub(h,S))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Av=h=>Array.from(h).map(m=>m.toString(16).padStart(2,"0")).join(""),qb=De.createContext(null),VE=({children:h})=>{const[m,b]=De.useState(localStorage.getItem("parlens_pubkey")),[S]=De.useState(()=>new mS({enablePing:!0,enableReconnect:!0})),z=async(l,N,K)=>{let ne="",re=null;if(l==="extension"){if(!window.nostr)throw new Error("Nostr extension not found");ne=await window.nostr.getPublicKey()}else if(l==="nsec"&&N)try{const Ee=ff.decode(N);if(Ee.type!=="nsec")throw new Error("Not an nsec");re=Ee.data,ne=lg(re),localStorage.setItem("parlens_privkey",Av(re))}catch{throw new Error("Invalid nsec format")}else l==="create"&&(re=Gx(),ne=lg(re),localStorage.setItem("parlens_privkey",Av(re)));if(b(ne),localStorage.setItem("parlens_pubkey",ne),l==="create"&&K&&re)try{const Ee=qo({kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:K,display_name:K,picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${ne}`})},re);await Promise.any([S.publish(["wss://relay.damus.io","wss://nos.lol"],Ee)])}catch(Ee){console.warn("Failed to publish metadata:",Ee)}},k=()=>{b(null),localStorage.removeItem("parlens_pubkey"),localStorage.removeItem("parlens_privkey")},A=async l=>{const N=localStorage.getItem("parlens_privkey");if(N){const K=new Uint8Array(N.match(/.{1,2}/g).map(ne=>parseInt(ne,16)));return qo(l,K)}if(window.nostr)return await window.nostr.signEvent(l);throw new Error("No signing method available")};return Y.jsx(qb.Provider,{value:{pubkey:m,login:z,logout:k,pool:S,signEvent:A},children:h})},Xp=()=>{const h=De.useContext(qb);if(!h)throw new Error("useAuth must be used within AuthProvider");return h};const qE=h=>h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),GE=h=>h.replace(/^([A-Z])|[\s-_]+(\w)/g,(m,b,S)=>S?S.toUpperCase():b.toLowerCase()),Cv=h=>{const m=GE(h);return m.charAt(0).toUpperCase()+m.slice(1)},Gb=(...h)=>h.filter((m,b,S)=>!!m&&m.trim()!==""&&S.indexOf(m)===b).join(" ").trim(),ZE=h=>{for(const m in h)if(m.startsWith("aria-")||m==="role"||m==="title")return!0};var HE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const $E=De.forwardRef(({color:h="currentColor",size:m=24,strokeWidth:b=2,absoluteStrokeWidth:S,className:z="",children:k,iconNode:A,...l},N)=>De.createElement("svg",{ref:N,...HE,width:m,height:m,stroke:h,strokeWidth:S?Number(b)*24/Number(m):b,className:Gb("lucide",z),...!k&&!ZE(l)&&{"aria-hidden":"true"},...l},[...A.map(([K,ne])=>De.createElement(K,ne)),...Array.isArray(k)?k:[k]]));const Ni=(h,m)=>{const b=De.forwardRef(({className:S,...z},k)=>De.createElement($E,{ref:k,iconNode:m,className:Gb(`lucide-${qE(Cv(h))}`,`lucide-${h}`,S),...z}));return b.displayName=Cv(h),b};const XE=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],YE=Ni("arrow-right",XE);const KE=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],WE=Ni("arrow-up-down",KE);const QE=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],JE=Ni("arrow-up",QE);const eM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],tM=Ni("check",eM);const nM=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],gf=Ni("chevron-down",nM);const iM=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ay=Ni("chevron-right",iM);const rM=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],R0=Ni("chevron-up",rM);const aM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],zv=Ni("circle-question-mark",aM);const sM=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Zb=Ni("clock",sM);const oM=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],lM=Ni("eye-off",oM);const cM=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],uM=Ni("eye",cM);const hM=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],dM=Ni("folder-open",hM);const fM=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],H_=Ni("key",fM);const pM=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],mM=Ni("locate",pM);const gM=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],$h=Ni("map-pin",gM);const yM=[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]],_M=Ni("map-pinned",yM);const vM=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],xM=Ni("navigation",vM);const bM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],wM=Ni("pencil",bM);const TM=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],SM=Ni("route",TM);const EM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],MM=Ni("save",EM);const AM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],CM=Ni("search",AM);const zM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Hb=Ni("shield",zM);const DM=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],$_=Ni("trash-2",DM);const PM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],IM=Ni("user-plus",PM);const kM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],RM=Ni("user",kM);const LM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],L0=Ni("x",LM),OM=De.createContext(null);function BM(h,m){const b=Array.isArray(h)?h[0]:h?h.x:0,S=Array.isArray(h)?h[1]:h?h.y:0,z=Array.isArray(m)?m[0]:m?m.x:0,k=Array.isArray(m)?m[1]:m?m.y:0;return b===z&&S===k}function Ns(h,m){if(h===m)return!0;if(!h||!m)return!1;if(Array.isArray(h)){if(!Array.isArray(m)||h.length!==m.length)return!1;for(let b=0;b<h.length;b++)if(!Ns(h[b],m[b]))return!1;return!0}else if(Array.isArray(m))return!1;if(typeof h=="object"&&typeof m=="object"){const b=Object.keys(h),S=Object.keys(m);if(b.length!==S.length)return!1;for(const z of b)if(!m.hasOwnProperty(z)||!Ns(h[z],m[z]))return!1;return!0}return!1}function Dv(h){return{longitude:h.center.lng,latitude:h.center.lat,zoom:h.zoom,pitch:h.pitch,bearing:h.bearing,padding:h.padding}}function Pv(h,m){const b=m.viewState||m,S={};if("longitude"in b&&"latitude"in b&&(b.longitude!==h.center.lng||b.latitude!==h.center.lat)){const z=h.center.constructor;S.center=new z(b.longitude,b.latitude)}return"zoom"in b&&b.zoom!==h.zoom&&(S.zoom=b.zoom),"bearing"in b&&b.bearing!==h.bearing&&(S.bearing=b.bearing),"pitch"in b&&b.pitch!==h.pitch&&(S.pitch=b.pitch),b.padding&&h.padding&&!Ns(b.padding,h.padding)&&(S.padding=b.padding),S}const NM=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Iv(h){if(!h)return null;if(typeof h=="string"||("toJS"in h&&(h=h.toJS()),!h.layers))return h;const m={};for(const S of h.layers)m[S.id]=S;const b=h.layers.map(S=>{let z=null;"interactive"in S&&(z=Object.assign({},S),delete z.interactive);const k=m[S.ref];if(k){z=z||Object.assign({},S),delete z.ref;for(const A of NM)A in k&&(z[A]=k[A])}return z||S});return{...h,layers:b}}const kv={version:8,sources:{},layers:[]},Rv={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Lv={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Ov={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},FM=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],jM=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Zp{constructor(m,b,S){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=z=>{const k=this.props[Ov[z.type]];k?k(z):z.type==="error"&&console.error(z.error)},this._onCameraEvent=z=>{if(this._internalUpdate)return;z.viewState=this._propsedCameraUpdate||Dv(this._map.transform);const k=this.props[Lv[z.type]];k&&k(z)},this._onCameraUpdate=z=>this._internalUpdate?z:(this._propsedCameraUpdate=Dv(z),Pv(z,this.props)),this._onPointerEvent=z=>{(z.type==="mousemove"||z.type==="mouseout")&&this._updateHover(z);const k=this.props[Rv[z.type]];k&&(this.props.interactiveLayerIds&&z.type!=="mouseover"&&z.type!=="mouseout"&&(z.features=this._hoveredFeatures||this._queryRenderedFeatures(z.point)),k(z),delete z.features)},this._MapClass=m,this.props=b,this._initialize(S)}get map(){return this._map}setProps(m){const b=this.props;this.props=m;const S=this._updateSettings(m,b),z=this._updateSize(m),k=this._updateViewState(m);this._updateStyle(m,b),this._updateStyleComponents(m),this._updateHandlers(m,b),(S||z||k&&!this._map.isMoving())&&this.redraw()}static reuse(m,b){const S=Zp.savedMaps.pop();if(!S)return null;const z=S.map,k=z.getContainer();for(b.className=k.className;k.childNodes.length>0;)b.appendChild(k.childNodes[0]);z._container=b;const A=z._resizeObserver;A&&(A.disconnect(),A.observe(b)),S.setProps({...m,styleDiffing:!1}),z.resize();const{initialViewState:l}=m;return l&&(l.bounds?z.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):S._updateViewState(l)),z.isStyleLoaded()?z.fire("load"):z.once("style.load",()=>z.fire("load")),z._update(),S}_initialize(m){const{props:b}=this,{mapStyle:S=kv}=b,z={...b,...b.initialViewState,container:m,style:Iv(S)},k=z.initialViewState||z.viewState||z;if(Object.assign(z,{center:[k.longitude||0,k.latitude||0],zoom:k.zoom||0,pitch:k.pitch||0,bearing:k.bearing||0}),b.gl){const l=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=l,b.gl)}const A=new this._MapClass(z);k.padding&&A.setPadding(k.padding),b.cursor&&(A.getCanvas().style.cursor=b.cursor),A.transformCameraUpdate=this._onCameraUpdate,A.on("style.load",()=>{this._styleComponents={light:A.getLight(),sky:A.getSky(),projection:A.getProjection?.(),terrain:A.getTerrain()},this._updateStyleComponents(this.props)}),A.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const l in Rv)A.on(l,this._onPointerEvent);for(const l in Lv)A.on(l,this._onCameraEvent);for(const l in Ov)A.on(l,this._onEvent);this._map=A}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Zp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const m=this._map;m.style&&(m._frame&&(m._frame.cancel(),m._frame=null),m._render())}_updateSize(m){const{viewState:b}=m;if(b){const S=this._map;if(b.width!==S.transform.width||b.height!==S.transform.height)return S.resize(),!0}return!1}_updateViewState(m){const b=this._map,S=b.transform;if(!b.isMoving()){const k=Pv(S,m);if(Object.keys(k).length>0)return this._internalUpdate=!0,b.jumpTo(k),this._internalUpdate=!1,!0}return!1}_updateSettings(m,b){const S=this._map;let z=!1;for(const k of FM)k in m&&!Ns(m[k],b[k])&&(z=!0,S[`set${k[0].toUpperCase()}${k.slice(1)}`]?.call(S,m[k]));return z}_updateStyle(m,b){if(m.cursor!==b.cursor&&(this._map.getCanvas().style.cursor=m.cursor||""),m.mapStyle!==b.mapStyle){const{mapStyle:S=kv,styleDiffing:z=!0}=m,k={diff:z};"localIdeographFontFamily"in m&&(k.localIdeographFontFamily=m.localIdeographFontFamily),this._map.setStyle(Iv(S),k)}}_updateStyleComponents({light:m,projection:b,sky:S,terrain:z}){const k=this._map,A=this._styleComponents;k.style._loaded&&(m&&!Ns(m,A.light)&&(A.light=m,k.setLight(m)),b&&!Ns(b,A.projection)&&b!==A.projection?.type&&(A.projection=typeof b=="string"?{type:b}:b,k.setProjection?.(A.projection)),S&&!Ns(S,A.sky)&&(A.sky=S,k.setSky(S)),z!==void 0&&!Ns(z,A.terrain)&&(!z||k.getSource(z.source))&&(A.terrain=z,k.setTerrain(z)))}_updateHandlers(m,b){const S=this._map;for(const z of jM){const k=m[z]??!0,A=b[z]??!0;Ns(k,A)||(k?S[z].enable(k):S[z].disable())}}_queryRenderedFeatures(m){const b=this._map,{interactiveLayerIds:S=[]}=this.props;try{return b.queryRenderedFeatures(m,{layers:S.filter(b.getLayer.bind(b))})}catch{return[]}}_updateHover(m){const{props:b}=this;if(b.interactiveLayerIds&&(b.onMouseMove||b.onMouseEnter||b.onMouseLeave)){const z=m.type,k=this._hoveredFeatures?.length>0,A=this._queryRenderedFeatures(m.point),l=A.length>0;!l&&k&&(m.type="mouseleave",this._onPointerEvent(m)),this._hoveredFeatures=A,l&&!k&&(m.type="mouseenter",this._onPointerEvent(m)),m.type=z}else this._hoveredFeatures=null}}Zp.savedMaps=[];const UM=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function VM(h){if(!h)return null;const m=h.map,b={getMap:()=>m};for(const S of qM(m))!(S in b)&&!UM.includes(S)&&(b[S]=m[S].bind(m));return b}function qM(h){const m=new Set;let b=h;for(;b;){for(const S of Object.getOwnPropertyNames(b))S[0]!=="_"&&typeof h[S]=="function"&&S!=="fire"&&S!=="setEventedParent"&&m.add(S);b=Object.getPrototypeOf(b)}return Array.from(m)}const GM=typeof document<"u"?De.useLayoutEffect:De.useEffect;function ZM(h,m){const{RTLTextPlugin:b,maxParallelImageRequests:S,workerCount:z,workerUrl:k}=m;if(b&&h.getRTLTextPluginStatus&&h.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:A,lazy:l=!0}=typeof b=="string"?{pluginUrl:b}:b;h.setRTLTextPlugin(A,N=>{N&&console.error(N)},l)}S!==void 0&&h.setMaxParallelImageRequests(S),z!==void 0&&h.setWorkerCount(z),k!==void 0&&h.setWorkerUrl(k)}const Yp=De.createContext(null);function HM(h,m){const b=De.useContext(OM),[S,z]=De.useState(null),k=De.useRef(),{current:A}=De.useRef({mapLib:null,map:null});De.useEffect(()=>{const K=h.mapLib;let ne=!0,re;return Promise.resolve(K||ix(()=>Promise.resolve().then(()=>uA),void 0)).then(Ee=>{if(!ne)return;if(!Ee)throw new Error("Invalid mapLib");const Ae="Map"in Ee?Ee:Ee.default;if(!Ae.Map)throw new Error("Invalid mapLib");ZM(Ae,h),h.reuseMaps&&(re=Zp.reuse(h,k.current)),re||(re=new Zp(Ae.Map,h,k.current)),A.map=VM(re),A.mapLib=Ae,z(re),b?.onMapMount(A.map,h.id)}).catch(Ee=>{const{onError:Ae}=h;Ae?Ae({type:"error",target:null,originalEvent:null,error:Ee}):console.error(Ee)}),()=>{ne=!1,re&&(b?.onMapUnmount(h.id),h.reuseMaps?re.recycle():re.destroy())}},[]),GM(()=>{S&&S.setProps(h)}),De.useImperativeHandle(m,()=>A.map,[S]);const l=De.useMemo(()=>({position:"relative",width:"100%",height:"100%",...h.style}),[h.style]),N={height:"100%"};return De.createElement("div",{id:h.id,ref:k,style:l},S&&De.createElement(Yp.Provider,{value:A},De.createElement("div",{"mapboxgl-children":"",style:N},h.children)))}const $M=De.forwardRef(HM);var $b=nx();const XM=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ju(h,m){if(!h||!m)return;const b=h.style;for(const S in m){const z=m[S];Number.isFinite(z)&&!XM.test(S)?b[S]=`${z}px`:b[S]=z}}function Xb(h,m){if(h===m)return null;const b=Bv(h),S=Bv(m),z=[];for(const k of S)b.has(k)||z.push(k);for(const k of b)S.has(k)||z.push(k);return z.length===0?null:z}function Bv(h){return new Set(h?h.trim().split(/\s+/):[])}const ag=De.memo(De.forwardRef((h,m)=>{const{map:b,mapLib:S}=De.useContext(Yp),z=De.useRef({props:h}),k=De.useMemo(()=>{let Re=!1;De.Children.forEach(h.children,Dt=>{Dt&&(Re=!0)});const We={...h,element:Re?document.createElement("div"):void 0},it=new S.Marker(We);return it.setLngLat([h.longitude,h.latitude]),it.getElement().addEventListener("click",Dt=>{z.current.props.onClick?.({type:"click",target:it,originalEvent:Dt})}),it.on("dragstart",Dt=>{const bt=Dt;bt.lngLat=k.getLngLat(),z.current.props.onDragStart?.(bt)}),it.on("drag",Dt=>{const bt=Dt;bt.lngLat=k.getLngLat(),z.current.props.onDrag?.(bt)}),it.on("dragend",Dt=>{const bt=Dt;bt.lngLat=k.getLngLat(),z.current.props.onDragEnd?.(bt)}),it},[]);De.useEffect(()=>(k.addTo(b.getMap()),()=>{k.remove()}),[]);const{longitude:A,latitude:l,offset:N,style:K,draggable:ne=!1,popup:re=null,rotation:Ee=0,rotationAlignment:Ae="auto",pitchAlignment:Pe="auto"}=h;De.useEffect(()=>{ju(k.getElement(),K)},[K]),De.useImperativeHandle(m,()=>k,[]);const pe=z.current.props;(k.getLngLat().lng!==A||k.getLngLat().lat!==l)&&k.setLngLat([A,l]),N&&!BM(k.getOffset(),N)&&k.setOffset(N),k.isDraggable()!==ne&&k.setDraggable(ne),k.getRotation()!==Ee&&k.setRotation(Ee),k.getRotationAlignment()!==Ae&&k.setRotationAlignment(Ae),k.getPitchAlignment()!==Pe&&k.setPitchAlignment(Pe),k.getPopup()!==re&&k.setPopup(re);const ie=Xb(pe.className,h.className);if(ie)for(const Re of ie)k.toggleClassName(Re);return z.current.props=h,$b.createPortal(h.children,k.getElement())}));De.memo(De.forwardRef((h,m)=>{const{map:b,mapLib:S}=De.useContext(Yp),z=De.useMemo(()=>document.createElement("div"),[]),k=De.useRef({props:h}),A=De.useMemo(()=>{const l={...h},N=new S.Popup(l);return N.setLngLat([h.longitude,h.latitude]),N.once("open",K=>{k.current.props.onOpen?.(K)}),N},[]);if(De.useEffect(()=>{const l=N=>{k.current.props.onClose?.(N)};return A.on("close",l),A.setDOMContent(z).addTo(b.getMap()),()=>{A.off("close",l),A.isOpen()&&A.remove()}},[]),De.useEffect(()=>{ju(A.getElement(),h.style)},[h.style]),De.useImperativeHandle(m,()=>A,[]),A.isOpen()){const l=k.current.props;(A.getLngLat().lng!==h.longitude||A.getLngLat().lat!==h.latitude)&&A.setLngLat([h.longitude,h.latitude]),h.offset&&!Ns(l.offset,h.offset)&&A.setOffset(h.offset),(l.anchor!==h.anchor||l.maxWidth!==h.maxWidth)&&(A.options.anchor=h.anchor,A.setMaxWidth(h.maxWidth));const N=Xb(l.className,h.className);if(N)for(const K of N)A.toggleClassName(K);k.current.props=h}return $b.createPortal(h.children,z)}));function yf(h,m,b,S){const z=De.useContext(Yp),k=De.useMemo(()=>h(z),[]);return De.useEffect(()=>{const A=m,l=null,N=typeof m=="function"?m:null,{map:K}=z;return K.hasControl(k)||(K.addControl(k,A?.position),l&&l(z)),()=>{N&&N(z),K.hasControl(k)&&K.removeControl(k)}},[]),k}function YM(h){const m=yf(({mapLib:b})=>new b.AttributionControl(h),{position:h.position});return De.useEffect(()=>{ju(m._container,h.style)},[h.style]),null}De.memo(YM);function KM(h){const m=yf(({mapLib:b})=>new b.FullscreenControl({container:h.containerId&&document.getElementById(h.containerId)}),{position:h.position});return De.useEffect(()=>{ju(m._controlContainer,h.style)},[h.style]),null}De.memo(KM);function WM(h,m){const b=De.useRef({props:h}),S=yf(({mapLib:z})=>{const k=new z.GeolocateControl(h),A=k._setupUI;return k._setupUI=()=>{k._container.hasChildNodes()||A()},k.on("geolocate",l=>{b.current.props.onGeolocate?.(l)}),k.on("error",l=>{b.current.props.onError?.(l)}),k.on("outofmaxbounds",l=>{b.current.props.onOutOfMaxBounds?.(l)}),k.on("trackuserlocationstart",l=>{b.current.props.onTrackUserLocationStart?.(l)}),k.on("trackuserlocationend",l=>{b.current.props.onTrackUserLocationEnd?.(l)}),k},{position:h.position});return b.current.props=h,De.useImperativeHandle(m,()=>S,[]),De.useEffect(()=>{ju(S._container,h.style)},[h.style]),null}De.memo(De.forwardRef(WM));function QM(h){const m=yf(({mapLib:b})=>new b.NavigationControl(h),{position:h.position});return De.useEffect(()=>{ju(m._container,h.style)},[h.style]),null}De.memo(QM);function JM(h){const m=yf(({mapLib:k})=>new k.ScaleControl(h),{position:h.position}),b=De.useRef(h),S=b.current;b.current=h;const{style:z}=h;return h.maxWidth!==void 0&&h.maxWidth!==S.maxWidth&&(m.options.maxWidth=h.maxWidth),h.unit!==void 0&&h.unit!==S.unit&&m.setUnit(h.unit),De.useEffect(()=>{ju(m._container,z)},[z]),null}De.memo(JM);function eA(h){const m=yf(({mapLib:b})=>new b.TerrainControl(h),{position:h.position});return De.useEffect(()=>{ju(m._container,h.style)},[h.style]),null}De.memo(eA);function tA(h){const m=yf(({mapLib:b})=>new b.LogoControl(h),{position:h.position});return De.useEffect(()=>{ju(m._container,h.style)},[h.style]),null}De.memo(tA);function Cy(h,m){if(!h)throw new Error(m)}let nA=0;function iA(h,m,b){if(h.style&&h.style._loaded){const S={...b};return delete S.id,delete S.children,h.addSource(m,S),h.getSource(m)}return null}function rA(h,m,b){Cy(m.id===b.id,"source id changed"),Cy(m.type===b.type,"source type changed");let S="",z=0;for(const A in m)A!=="children"&&A!=="id"&&!Ns(b[A],m[A])&&(S=A,z++);if(!z)return;const k=m.type;if(k==="geojson")h.setData(m.data);else if(k==="image")h.updateImage({url:m.url,coordinates:m.coordinates});else switch(S){case"coordinates":h.setCoordinates?.(m.coordinates);break;case"url":h.setUrl?.(m.url);break;case"tiles":h.setTiles?.(m.tiles);break;default:console.warn(`Unable to update <Source> prop: ${S}`)}}function Nv(h){const m=De.useContext(Yp).map.getMap(),b=De.useRef(h),[,S]=De.useState(0),z=De.useMemo(()=>h.id||`jsx-source-${nA++}`,[]);De.useEffect(()=>{if(m){const A=()=>setTimeout(()=>S(l=>l+1),0);return m.on("styledata",A),A(),()=>{if(m.off("styledata",A),m.style&&m.style._loaded&&m.getSource(z)){const l=m.getStyle()?.layers;if(l)for(const N of l)N.source===z&&m.removeLayer(N.id);m.removeSource(z)}}}},[m]);let k=m&&m.style&&m.getSource(z);return k?rA(k,h,b.current):k=iA(m,z,h),b.current=h,k&&De.Children.map(h.children,A=>A&&De.cloneElement(A,{source:z}))||null}function aA(h,m,b,S){if(Cy(b.id===S.id,"layer id changed"),Cy(b.type===S.type,"layer type changed"),b.type==="custom"||S.type==="custom")return;const{layout:z={},paint:k={},filter:A,minzoom:l,maxzoom:N,beforeId:K}=b;if(K!==S.beforeId&&h.moveLayer(m,K),z!==S.layout){const ne=S.layout||{};for(const re in z)Ns(z[re],ne[re])||h.setLayoutProperty(m,re,z[re]);for(const re in ne)z.hasOwnProperty(re)||h.setLayoutProperty(m,re,void 0)}if(k!==S.paint){const ne=S.paint||{};for(const re in k)Ns(k[re],ne[re])||h.setPaintProperty(m,re,k[re]);for(const re in ne)k.hasOwnProperty(re)||h.setPaintProperty(m,re,void 0)}Ns(A,S.filter)||h.setFilter(m,A),(l!==S.minzoom||N!==S.maxzoom)&&h.setLayerZoomRange(m,l,N)}function sA(h,m,b){if(h.style&&h.style._loaded&&(!("source"in b)||h.getSource(b.source))){const S={...b,id:m};delete S.beforeId,h.addLayer(S,b.beforeId)}}let oA=0;function Fv(h){const m=De.useContext(Yp).map.getMap(),b=De.useRef(h),[,S]=De.useState(0),z=De.useMemo(()=>h.id||`jsx-layer-${oA++}`,[]);if(De.useEffect(()=>{if(m){const A=()=>S(l=>l+1);return m.on("styledata",A),A(),()=>{m.off("styledata",A),m.style&&m.style._loaded&&m.getLayer(z)&&m.removeLayer(z)}}},[m]),m&&m.style&&m.getLayer(z))try{aA(m,z,h,b.current)}catch(A){console.warn(A)}else sA(m,z,h);return b.current=h,null}var vy={exports:{}};var lA=vy.exports,jv;function cA(){return jv||(jv=1,(function(h,m){(function(b,S){h.exports=S()})(lA,(function(){var b={},S={};function z(A,l,N){if(S[A]=N,A==="index"){var K="var sharedModule = {}; ("+S.shared+")(sharedModule); ("+S.worker+")(sharedModule);",ne={};return S.shared(ne),S.index(b,ne),typeof window<"u"&&b.setWorkerUrl(window.URL.createObjectURL(new Blob([K],{type:"text/javascript"}))),b}}z("shared",["exports"],(function(A){function l(i,e,n,o){return new(n||(n=Promise))((function(u,p){function g(C){try{T(o.next(C))}catch(I){p(I)}}function x(C){try{T(o.throw(C))}catch(I){p(I)}}function T(C){var I;C.done?u(C.value):(I=C.value,I instanceof n?I:new n((function(L){L(I)}))).then(g,x)}T((o=o.apply(i,e||[])).next())}))}function N(i,e){this.x=i,this.y=e}function K(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ne,re;typeof SuppressedError=="function"&&SuppressedError,N.prototype={clone(){return new N(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround(i,e){const n=Math.cos(i),o=Math.sin(i),u=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:N},N.convert=function(i){if(i instanceof N)return i;if(Array.isArray(i))return new N(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new N(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var Ee=(function(){if(re)return ne;function i(e,n,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=u}return re=1,ne=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<n)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var x=0,T=1;for(o=e,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<n));u++)e>p?x=o:T=o,o=.5*(T-x)+x;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},ne})(),Ae=K(Ee);let Pe,pe;function ie(){return Pe==null&&(Pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pe}function Re(){if(pe==null&&(pe=!1,ie())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){pe=!0;break}}}return pe||!1}var We=1e-6,it=typeof Float32Array<"u"?Float32Array:Array;function Dt(){var i=new it(9);return it!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function bt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function rt(){var i=new it(3);return it!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function at(i){var e=i[0],n=i[1],o=i[2];return Math.sqrt(e*e+n*n+o*o)}function Ie(i,e,n){var o=new it(3);return o[0]=i,o[1]=e,o[2]=n,o}function st(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function tt(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function ct(i,e,n){var o=e[0],u=e[1],p=e[2],g=n[0],x=n[1],T=n[2];return i[0]=u*T-p*x,i[1]=p*g-o*T,i[2]=o*x-u*g,i}var Tt,jt=at;function Gt(i,e,n){var o=e[0],u=e[1],p=e[2],g=e[3];return i[0]=n[0]*o+n[4]*u+n[8]*p+n[12]*g,i[1]=n[1]*o+n[5]*u+n[9]*p+n[13]*g,i[2]=n[2]*o+n[6]*u+n[10]*p+n[14]*g,i[3]=n[3]*o+n[7]*u+n[11]*p+n[15]*g,i}function ut(){var i=new it(4);return it!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Te(i,e,n,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;e*=p,o*=p,n*=p;var g=Math.sin(e),x=Math.cos(e),T=Math.sin(n),C=Math.cos(n),I=Math.sin(o),L=Math.cos(o);switch(u){case"xyz":i[0]=g*C*L+x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L-g*T*I;break;case"xzy":i[0]=g*C*L-x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L+g*T*I;break;case"yxz":i[0]=g*C*L+x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L+g*T*I;break;case"yzx":i[0]=g*C*L+x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L-g*T*I;break;case"zxy":i[0]=g*C*L-x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L-g*T*I;break;case"zyx":i[0]=g*C*L-x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L+g*T*I;break;default:throw new Error("Unknown angle order "+u)}return i}function He(){var i=new it(2);return it!=Float32Array&&(i[0]=0,i[1]=0),i}function pt(i,e){var n=new it(2);return n[0]=i,n[1]=e,n}rt(),Tt=new it(4),it!=Float32Array&&(Tt[0]=0,Tt[1]=0,Tt[2]=0,Tt[3]=0),rt(),Ie(1,0,0),Ie(0,1,0),ut(),ut(),Dt(),He();const _t=8192;function Ft(i,e,n){return e*(_t/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function we(i,e){return(i%e+e)%e}function $e(i,e,n){return i*(1-n)+e*n}function vt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Pt(i,e,n,o){const u=new Ae(i,e,n,o);return p=>u.solve(p)}const Vt=Pt(.25,.1,.25,1);function Xt(i,e,n){return Math.min(n,Math.max(e,i))}function Qt(i,e,n){const o=n-e,u=((i-e)%o+o)%o+e;return u===e?n:u}function rn(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let Yt=1;function on(i,e,n){const o={};for(const u in i)o[u]=e.call(this,i[u],u,i);return o}function xn(i,e,n){const o={};for(const u in i)e.call(this,i[u],u,i)&&(o[u]=i[u]);return o}function qn(i){return Array.isArray(i)?i.map(qn):typeof i=="object"&&i?on(i,qn):i}const Ki={};function zn(i){Ki[i]||(typeof console<"u"&&console.warn(i),Ki[i]=!0)}function wi(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Wi(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Yn=null;function na(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Pr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ia(i,e,n,o,u){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const g=p?.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const x=g.startsWith("BGR"),T=new Uint8ClampedArray(o*u*4);if(yield p.copyTo(T,(function(C,I,L,B,F){const q=4*Math.max(-I,0),G=(Math.max(0,L)-L)*B*4+q,X=4*B,J=Math.max(0,I),he=Math.max(0,L);return{rect:{x:J,y:he,width:Math.min(C.width,I+B)-J,height:Math.min(C.height,L+F)-he},layout:[{offset:G,stride:X}]}})(i,e,n,o,u)),x)for(let C=0;C<T.length;C+=4){const I=T[C];T[C]=T[C+2],T[C+2]=I}return T}finally{p.close()}}))}let Ur,Ir;function cs(i,e,n,o){return i.addEventListener(e,n,o),{unsubscribe:()=>{i.removeEventListener(e,n,o)}}}function Ti(i){return i*Math.PI/180}function Qi(i){return i/Math.PI*180}const fe={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},H={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},$="AbortError";class Q extends Error{constructor(e=$){super(e instanceof Error?e.message:e),this.name=$,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function de(i){return i.name===$}const ve={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Le(i){return ve.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const ke="global-dispatcher";class ye extends Error{constructor(e,n,o,u){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=u}}const Oe=()=>Wi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Qe=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=Le(i.url);if(o)return o(i,e);if(Wi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:ke},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Oe())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return l(this,void 0,void 0,(function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Oe(),signal:u.signal});let g,x;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{g=yield fetch(p)}catch(C){throw de(C)?C:new ye(0,C.message,o.url,new Blob)}if(!g.ok){const C=yield g.blob();throw new ye(g.status,g.statusText,o.url,C)}x=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const T=yield x;return u.signal.throwIfAborted(),{data:T,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(i,e);if(Wi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:ke},e)}var n;return(function(o,u){return new Promise(((p,g)=>{var x;const T=new XMLHttpRequest;T.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(T.responseType="arraybuffer");for(const C in o.headers)T.setRequestHeader(C,o.headers[C]);o.type==="json"&&(T.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=o.credentials==="include",T.onerror=()=>{g(new Error(T.statusText))},T.onload=()=>{if(!u.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let C=T.response;if(o.type==="json")try{C=JSON.parse(T.response)}catch(I){return void g(I)}p({data:C,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const C=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});g(new ye(T.status,T.statusText,o.url,C))}},u.signal.addEventListener("abort",(()=>{T.abort(),g(new Q(u.signal.reason))})),T.send(o.body)}))})(i,e)};function nt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Et(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function It(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class Kt{constructor(e,n={}){rn(this,n),this.type=e}}class gn extends Kt{constructor(e,n={}){super("error",rn({error:e},n))}}class pn{on(e,n){return this._listeners=this._listeners||{},Et(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return It(e,n,this._listeners),It(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Et(e,n,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,n){typeof e=="string"&&(e=new Kt(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of u)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of p)It(o,x,this._oneTimeListeners),x.call(this,e);const g=this._eventedParent;g&&(rn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof gn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ne={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const lt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ot(i,e){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return lt.forEach((o=>{o in e&&(n[o]=e[o])})),n}function Mt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!Mt(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!Mt(i[n],e[n]))return!1;return!0}return i===e}function tn(i,e){i.push(e)}function Tn(i,e,n){tn(n,{command:"addSource",args:[i,e[i]]})}function Sn(i,e,n){tn(e,{command:"removeSource",args:[i]}),n[i]=!0}function un(i,e,n,o){Sn(i,n,o),Tn(i,e,n)}function Dn(i,e,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!Mt(i[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!Mt(i[n][o],e[n][o]))return!1;return!0}function ai(i,e,n,o,u,p){i=i||{},e=e||{};for(const g in i)Object.prototype.hasOwnProperty.call(i,g)&&(Mt(i[g],e[g])||n.push({command:p,args:[o,g,e[g],u]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(Mt(i[g],e[g])||n.push({command:p,args:[o,g,e[g],u]}))}function Bl(i){return i.id}function Go(i,e){return i[e.id]=e,i}class xt{constructor(e,n,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function br(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}class wr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Ga{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(e){return new Ga(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ni={kind:"null"},At={kind:"number"},ln={kind:"string"},fn={kind:"boolean"},ra={kind:"color"},Uu={kind:"projectionDefinition"},us={kind:"object"},sn={kind:"value"},Zo={kind:"collator"},hs={kind:"formatted"},js={kind:"padding"},ds={kind:"colorArray"},fs={kind:"numberArray"},Si={kind:"resolvedImage"},Nl={kind:"variableAnchorOffsetCollection"};function Tr(i,e){return{kind:"array",itemType:i,N:e}}function Mn(i){if(i.kind==="array"){const e=Mn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Us=[ni,At,ln,fn,ra,Uu,hs,us,Tr(sn),js,fs,ds,Si,Nl];function Fl(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Fl(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Us)if(!Fl(n,e))return null}}return`Expected ${Mn(i)} but found ${Mn(e)} instead.`}function jl(i,e){return e.some((n=>n.kind===i.kind))}function uo(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function Za(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const kc=.96422,ps=.82521,wa=4/29,Rn=6/29,Kh=3*Rn*Rn,_f=Rn*Rn*Rn,Ho=Math.PI/180,Wh=180/Math.PI;function Rc(i){return(i%=360)<0&&(i+=360),i}function vf([i,e,n,o]){let u,p;const g=Lc((.2225045*(i=kr(i))+.7168786*(e=kr(e))+.0606169*(n=kr(n)))/1);i===e&&e===n?u=p=g:(u=Lc((.4360747*i+.3850649*e+.1430804*n)/kc),p=Lc((.0139322*i+.0971045*e+.7141733*n)/ps));const x=116*g-16;return[x<0?0:x,500*(u-g),200*(g-p),o]}function kr(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Lc(i){return i>_f?Math.pow(i,1/3):i/Kh+wa}function Vu([i,e,n,o]){let u=(i+16)/116,p=isNaN(e)?u:u+e/500,g=isNaN(n)?u:u-n/200;return u=1*ho(u),p=kc*ho(p),g=ps*ho(g),[Oc(3.1338561*p-1.6168667*u-.4906146*g),Oc(-.9787684*p+1.9161415*u+.033454*g),Oc(.0719453*p-.2289914*u+1.4052427*g),o]}function Oc(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function ho(i){return i>Rn?i*i*i:Kh*(i-wa)}const xf=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Ul(i,e){return xf(i,e)?i[e]:void 0}function Vs(i){return parseInt(i.padEnd(2,i),16)/255}function bf(i,e){return $o(e?i/100:i,0,1)}function $o(i,e,n){return Math.min(Math.max(e,i),n)}function qu(i){return!i.some(Number.isNaN)}const Xo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function fo(i,e,n){return i+n*(e-i)}function Vl(i,e,n){return i.map(((o,u)=>fo(o,e[u],n)))}class dn{constructor(e,n,o,u=1,p=!0){this.r=e,this.g=n,this.b=o,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,n,o,u]))}static parse(e){if(e instanceof dn)return e;if(typeof e!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Ul(Xo,o);if(u){const[g,x,T]=u;return[g/255,x/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let x=1;return[Vs(o.slice(x,x+=g)),Vs(o.slice(x,x+=g)),Vs(o.slice(x,x+=g)),Vs(o.slice(x,x+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[x,T,C,I,L,B,F,q,G,X,J,he]=g,ee=[I||" ",F||" ",X].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ae=[C,B,G].join(""),ge=ae==="%%%"?100:ae===""?255:0;if(ge){const be=[$o(+T/ge,0,1),$o(+L/ge,0,1),$o(+q/ge,0,1),J?bf(+J,he):1];if(qu(be))return be}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[g,x,T,C,I,L,B,F,q]=p,G=[T||" ",I||" ",B].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const X=[+x,$o(+C,0,100),$o(+L,0,100),F?bf(+F,q):1];if(qu(X))return(function([J,he,ee,ae]){function ge(be){const je=(be+J/30)%12,ot=he*Math.min(ee,1-ee);return ee-ot*Math.max(-1,Math.min(je-3,9-je,1))}return J=Rc(J),he/=100,ee/=100,[ge(0),ge(8),ge(4),ae]})(X)}}})(e);return n?new dn(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[e/p,n/p,o/p,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,o,u,p]=vf(e),g=Math.sqrt(o*o+u*u);return[Math.round(1e4*g)?Rc(Math.atan2(u,o)*Wh):NaN,g,n,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",vf(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,u]=this.rgb;return`rgba(${[e,n,o].map((p=>Math.round(255*p))).join(",")},${u})`}static interpolate(e,n,o,u="rgb"){switch(u){case"rgb":{const[p,g,x,T]=Vl(e.rgb,n.rgb,o);return new dn(p,g,x,T,!1)}case"hcl":{const[p,g,x,T]=e.hcl,[C,I,L,B]=n.hcl;let F,q;if(isNaN(p)||isNaN(C))isNaN(p)?isNaN(C)?F=NaN:(F=C,x!==1&&x!==0||(q=I)):(F=p,L!==1&&L!==0||(q=g));else{let ee=C-p;C>p&&ee>180?ee-=360:C<p&&p-C>180&&(ee+=360),F=p+o*ee}const[G,X,J,he]=(function([ee,ae,ge,be]){return ee=isNaN(ee)?0:ee*Ho,Vu([ge,Math.cos(ee)*ae,Math.sin(ee)*ae,be])})([F,q??fo(g,I,o),fo(x,L,o),fo(T,B,o)]);return new dn(G,X,J,he,!1)}case"lab":{const[p,g,x,T]=Vu(Vl(e.lab,n.lab,o));return new dn(p,g,x,T,!1)}}}}dn.black=new dn(0,0,0,1),dn.white=new dn(1,1,1,1),dn.transparent=new dn(0,0,0,0),dn.red=new dn(1,0,0,1);class Ha{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Qh=["bottom","center","top"];class Bc{constructor(e,n,o,u,p,g){this.text=e,this.image=n,this.scale=o,this.fontStack=u,this.textColor=p,this.verticalAlign=g}}class Ji{constructor(e){this.sections=e}static fromString(e){return new Ji([new Bc(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Ji?e:Ji.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Fi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Fi)return e;if(typeof e=="number")return new Fi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Fi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new Fi(Vl(e.values,n.values,o))}}class hi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof hi)return e;if(typeof e=="number")return new hi([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new hi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new hi(Vl(e.values,n.values,o))}}class Jt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Jt)return e;if(typeof e=="string"){const o=dn.parse(e);return o?new Jt([o]):void 0}if(!Array.isArray(e))return;const n=[];for(const o of e){if(typeof o!="string")return;const u=dn.parse(o);if(!u)return;n.push(u)}return new Jt(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o,u="rgb"){const p=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)p.push(dn.interpolate(e.values[g],n.values[g],o,u));return new Jt(p)}}class Kn extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ta=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ei{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ei)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],u=e[n+1];if(typeof o!="string"||!Ta.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new Ei(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){const u=e.values,p=n.values;if(u.length!==p.length)throw new Kn(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const g=[];for(let x=0;x<u.length;x+=2){if(u[x]!==p[x])throw new Kn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${u[x]}, to[${x}]: ${p[x]}`);g.push(u[x]);const[T,C]=u[x+1],[I,L]=p[x+1];g.push([fo(T,I,o),fo(C,L,o)])}return new Ei(g)}}class Rr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Rr({name:e,available:!1}):null}}class er{constructor(e,n,o){this.from=e,this.to=n,this.transition=o}static interpolate(e,n,o){return new er(e,n,o)}static parse(e){return e instanceof er?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new er(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new er(e.from,e.to,e.transition):typeof e=="string"?new er(e,e,1):void 0}}function aa(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ms(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof er||i instanceof dn||i instanceof Ha||i instanceof Ji||i instanceof Fi||i instanceof hi||i instanceof Jt||i instanceof Ei||i instanceof Rr)return!0;if(Array.isArray(i)){for(const e of i)if(!ms(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ms(i[e]))return!1;return!0}return!1}function di(i){if(i===null)return ni;if(typeof i=="string")return ln;if(typeof i=="boolean")return fn;if(typeof i=="number")return At;if(i instanceof dn)return ra;if(i instanceof er)return Uu;if(i instanceof Ha)return Zo;if(i instanceof Ji)return hs;if(i instanceof Fi)return js;if(i instanceof hi)return fs;if(i instanceof Jt)return ds;if(i instanceof Ei)return Nl;if(i instanceof Rr)return Si;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const u=di(o);if(n){if(n===u)continue;n=sn;break}n=u}return Tr(n||sn,e)}return us}function po(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof dn||i instanceof er||i instanceof Ji||i instanceof Fi||i instanceof hi||i instanceof Jt||i instanceof Ei||i instanceof Rr?i.toString():JSON.stringify(i)}class sa{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ms(e[1]))return n.error("invalid value");const o=e[1];let u=di(o);const p=n.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new sa(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Yo={string:ln,number:At,boolean:fn,object:us};class Lr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,u=1;const p=e[0];if(p==="array"){let x,T;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in Yo)||C==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);x=Yo[C],u++}else x=sn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],u++}o=Tr(x,T)}else{if(!Yo[p])throw new Error(`Types doesn't contain name = ${p}`);o=Yo[p]}const g=[];for(;u<e.length;u++){const x=n.parse(e[u],u,sn);if(!x)return null;g.push(x)}return new Lr(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!Fl(this.type,di(o)))return o;if(n===this.args.length-1)throw new Kn(`Expected value to be of type ${Mn(this.type)}, but found ${Mn(di(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Hi={"to-boolean":fn,"to-color":ra,"to-number":At,"to-string":ln};class Or{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!Hi[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const u=Hi[o],p=[];for(let g=1;g<e.length;g++){const x=n.parse(e[g],g,sn);if(!x)return null;p.push(x)}return new Or(u,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(e),o=null,n instanceof dn)return n;if(typeof n=="string"){const p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:aa(n[0],n[1],n[2],n[3]),!o))return new dn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Kn(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const u=Fi.parse(n);if(u)return u}throw new Kn(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(e);const u=hi.parse(n);if(u)return u}throw new Kn(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(e);const u=Jt.parse(n);if(u)return u}throw new Kn(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const u=Ei.parse(n);if(u)return u}throw new Kn(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Kn(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Ji.fromString(po(this.args[0].evaluate(e)));case"resolvedImage":return Rr.fromString(po(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return po(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Nc=["Unknown","Point","LineString","Polygon"];class Ko{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Nc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=dn.parse(e),this._parseColorCache.set(e,n)),n}}class Wo{constructor(e,n,o=[],u,p=new Ga,g=[]){this.registry=e,this.path=o,this.key=o.map((x=>`[${x}]`)).join(""),this.scope=p,this.errors=g,this.expectedType=u,this._isConstant=n}parse(e,n,o,u,p={}){return n?this.concat(n,o,u)._parse(e,p):this._parse(e,p)}_parse(e,n){function o(u,p,g){return g==="assert"?new Lr(p,[u]):g==="coerce"?new Or(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,T=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||T.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(T.kind)||x.kind==="colorArray"&&["value","string","array"].includes(T.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))g=o(g,x,n.typeAnnotation||"coerce");else if(this.checkSubtype(x,T))return null}else g=o(g,x,n.typeAnnotation||"assert")}if(!(g instanceof sa)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const x=new Ko;try{g=new sa(g.type,g.evaluate(x))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const u=typeof e=="number"?this.path.concat(e):this.path,p=o?this.scope.concat(o):this.scope;return new Wo(this.registry,this._isConstant,u,n||null,p,this.errors)}error(e,...n){const o=`${this.key}${n.map((u=>`[${u}]`)).join("")}`;this.errors.push(new wr(o,e))}checkSubtype(e,n){const o=Fl(e,n);return o&&this.error(o),o}}class Gn{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=n.parse(e[p+1],p+1);if(!x)return null;o.push([g,x])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return u?new Gn(o,u):null}outputDefined(){return this.result.outputDefined()}}class mo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new mo(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class _n{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,At),u=n.parse(e[2],2,Tr(n.expectedType||sn));return o&&u?new _n(u.type.itemType,o,u):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Kn(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Kn(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Kn(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class cn{constructor(e,n){this.type=fn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,sn),u=n.parse(e[2],2,sn);return o&&u?jl(o.type,[fn,ln,At,ni,sn])?new cn(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!uo(n,["boolean","string","number","null"]))throw new Kn(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(di(n))} instead.`);if(!uo(o,["string","array"]))throw new Kn(`Expected second argument to be of type array or string, but found ${Mn(di(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Qo{constructor(e,n,o){this.type=At,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,sn),u=n.parse(e[2],2,sn);if(!o||!u)return null;if(!jl(o.type,[fn,ln,At,ni,sn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(o.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,At);return p?new Qo(o,u,p):null}return new Qo(o,u)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!uo(n,["boolean","string","number","null"]))throw new Kn(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(di(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),uo(o,["string"])){const p=o.indexOf(n,u);return p===-1?-1:[...o.slice(0,p)].length}if(uo(o,["array"]))return o.indexOf(n,u);throw new Kn(`Expected second argument to be of type array or string, but found ${Mn(di(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class An{constructor(e,n,o,u,p,g){this.inputType=e,this.type=n,this.input=o,this.cases=u,this.outputs=p,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const p={},g=[];for(let C=2;C<e.length-1;C+=2){let I=e[C];const L=e[C+1];Array.isArray(I)||(I=[I]);const B=n.concat(C);if(I.length===0)return B.error("Expected at least one branch label.");for(const q of I){if(typeof q!="number"&&typeof q!="string")return B.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,di(q)))return null}else o=di(q);if(p[String(q)]!==void 0)return B.error("Branch labels must be unique.");p[String(q)]=g.length}const F=n.parse(L,C,u);if(!F)return null;u=u||F.type,g.push(F)}const x=n.parse(e[1],1,sn);if(!x)return null;const T=n.parse(e[e.length-1],e.length-1,u);return T?x.type.kind!=="value"&&n.concat(1).checkSubtype(o,x.type)?null:new An(o,u,x,p,g,T):null}evaluate(e){const n=this.input.evaluate(e);return(di(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Fc{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const x=n.parse(e[g],g,fn);if(!x)return null;const T=n.parse(e[g+1],g+1,o);if(!T)return null;u.push([x,T]),o=o||T.type}const p=n.parse(e[e.length-1],e.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new Fc(o,u,p)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Sa{constructor(e,n,o,u){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,sn),u=n.parse(e[2],2,At);if(!o||!u)return null;if(!jl(o.type,[Tr(sn),ln,sn]))return n.error(`Expected first argument to be of type array or string, but found ${Mn(o.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,At);return p?new Sa(o.type,o,u,p):null}return new Sa(o.type,o,u)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),uo(n,["string"]))return[...n].slice(o,u).join("");if(uo(n,["array"]))return n.slice(o,u);throw new Kn(`Expected first argument to be of type array or string, but found ${Mn(di(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function go(i,e){const n=i.length-1;let o,u,p=0,g=n,x=0;for(;p<=g;)if(x=Math.floor((p+g)/2),o=i[x],u=i[x+1],o<=e){if(x===n||e<u)return x;p=x+1}else{if(!(o>e))throw new Kn("Input is not a number.");g=x-1}return 0}class yo{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,p]of o)this.labels.push(u),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,At);if(!o)return null;const u=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let g=1;g<e.length;g+=2){const x=g===1?-1/0:e[g],T=e[g+1],C=g,I=g+1;if(typeof x!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=x)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const L=n.parse(T,I,p);if(!L)return null;p=p||L.type,u.push([x,L])}return new yo(p,o,u)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return o[0].evaluate(e);const p=n.length;return u>=n[p-1]?o[p-1].evaluate(e):o[go(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function wf(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var jc,Jh,Kp=(function(){if(Jh)return jc;function i(e,n,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=u}return Jh=1,jc=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<n)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var x=0,T=1;for(o=e,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<n));u++)e>p?x=o:T=o,o=.5*(T-x)+x;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},jc})(),ed=wf(Kp);class Br{constructor(e,n,o,u,p){this.type=e,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,n,o,u){let p=0;if(e.name==="exponential")p=gs(n,e.base,o,u);else if(e.name==="linear")p=gs(n,1,o,u);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new ed(g[0],g[1],g[2],g[3]).solve(gs(n,1,o,u))}return p}static parse(e,n){let[o,u,p,...g]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const C=u[1];if(typeof C!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(C.length!==4||C.some((I=>typeof I!="number"||I<0||I>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,At),!p)return null;const x=[];let T=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==ds?n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType):T=ra;for(let C=0;C<g.length;C+=2){const I=g[C],L=g[C+1],B=C+3,F=C+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(x.length&&x[x.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const q=n.parse(L,F,T);if(!q)return null;T=T||q.type,x.push([I,q])}return Za(T,At)||Za(T,Uu)||Za(T,ra)||Za(T,js)||Za(T,fs)||Za(T,ds)||Za(T,Nl)||Za(T,Tr(At))?new Br(T,o,u,p,x):n.error(`Type ${Mn(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return o[0].evaluate(e);const p=n.length;if(u>=n[p-1])return o[p-1].evaluate(e);const g=go(n,u),x=Br.interpolationFactor(this.interpolation,u,n[g],n[g+1]),T=o[g].evaluate(e),C=o[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return fo(T,C,x);case"color":return dn.interpolate(T,C,x);case"padding":return Fi.interpolate(T,C,x);case"colorArray":return Jt.interpolate(T,C,x);case"numberArray":return hi.interpolate(T,C,x);case"variableAnchorOffsetCollection":return Ei.interpolate(T,C,x);case"array":return Vl(T,C,x);case"projectionDefinition":return er.interpolate(T,C,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return dn.interpolate(T,C,x,"hcl");case"colorArray":return Jt.interpolate(T,C,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return dn.interpolate(T,C,x,"lab");case"colorArray":return Jt.interpolate(T,C,x,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function gs(i,e,n,o){const u=o-n,p=i-n;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}const fi={color:dn.interpolate,number:fo,padding:Fi.interpolate,numberArray:hi.interpolate,colorArray:Jt.interpolate,variableAnchorOffsetCollection:Ei.interpolate,array:Vl};class Jo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const p=[];for(const x of e.slice(1)){const T=n.parse(x,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,p.push(T)}if(!o)throw new Error("No output type");const g=u&&p.some((x=>Fl(u,x.type)));return new Jo(g?sn:o,p)}evaluate(e){let n,o=null,u=0;for(const p of this.args)if(u++,o=p.evaluate(e),o&&o instanceof Rr&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Uc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Vc(i,e,n,o){return o.compare(e,n)===0}function Mi(i,e,n){const o=i!=="=="&&i!=="!=";return class Yb{constructor(p,g,x){this.type=fn,this.lhs=p,this.rhs=g,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const x=p[0];let T=g.parse(p[1],1,sn);if(!T)return null;if(!Uc(x,T.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${Mn(T.type)}'.`);let C=g.parse(p[2],2,sn);if(!C)return null;if(!Uc(x,C.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${Mn(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${Mn(T.type)}' and '${Mn(C.type)}'.`);o&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new Lr(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new Lr(T.type,[C])));let I=null;if(p.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(p[3],3,Zo),!I)return null}return new Yb(T,C,I)}evaluate(p){const g=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const T=di(g),C=di(x);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new Kn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=di(g),C=di(x);if(T.kind!=="string"||C.kind!=="string")return e(p,g,x)}return this.collator?n(p,g,x,this.collator.evaluate(p)):e(p,g,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Tf=Mi("==",(function(i,e,n){return e===n}),Vc),Gu=Mi("!=",(function(i,e,n){return e!==n}),(function(i,e,n,o){return!Vc(0,e,n,o)})),Sf=Mi("<",(function(i,e,n){return e<n}),(function(i,e,n,o){return o.compare(e,n)<0})),Wp=Mi(">",(function(i,e,n){return e>n}),(function(i,e,n,o){return o.compare(e,n)>0})),ql=Mi("<=",(function(i,e,n){return e<=n}),(function(i,e,n,o){return o.compare(e,n)<=0})),Zu=Mi(">=",(function(i,e,n){return e>=n}),(function(i,e,n,o){return o.compare(e,n)>=0}));class Gl{constructor(e,n,o){this.type=Zo,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,fn);if(!u)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,fn);if(!p)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,ln),!g)?null:new Gl(u,p,g)}evaluate(e){return new Ha(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class td{constructor(e,n,o,u,p){this.type=ln,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,At);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=n.parse(u.locale,1,ln),!p))return null;let g=null;if(u.currency&&(g=n.parse(u.currency,1,ln),!g))return null;let x=null;if(u["min-fraction-digits"]&&(x=n.parse(u["min-fraction-digits"],1,At),!x))return null;let T=null;return u["max-fraction-digits"]&&(T=n.parse(u["max-fraction-digits"],1,At),!T)?null:new td(o,p,g,x,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class qc{constructor(e){this.type=hs,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let p=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let T=null;if(x["font-scale"]&&(T=n.parse(x["font-scale"],1,At),!T))return null;let C=null;if(x["text-font"]&&(C=n.parse(x["text-font"],1,Tr(ln)),!C))return null;let I=null;if(x["text-color"]&&(I=n.parse(x["text-color"],1,ra),!I))return null;let L=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!Qh.includes(x["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(L=n.parse(x["vertical-align"],1,ln),!L)return null}const B=u[u.length-1];B.scale=T,B.font=C,B.textColor=I,B.verticalAlign=L}else{const T=n.parse(e[g],1,sn);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new qc(u)}evaluate(e){return new Ji(this.sections.map((n=>{const o=n.content.evaluate(e);return di(o)===Si?new Bc("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Bc(po(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class Zl{constructor(e){this.type=Si,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,ln);return o?new Zl(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Rr.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Hl{constructor(e){this.type=At,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Mn(o.type)} instead.`):new Hl(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Kn(`Expected value to be of type string or array, but found ${Mn(di(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ki=8192;function $l(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*ki),Math.round(o*u*ki)]}function Xl(i,e){const n=Math.pow(2,e.z);return[(u=(i[0]/ki+e.x)/n,360*u-180),(o=(i[1]/ki+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Yl(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function _o(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Ef(i,e,n){const o=i[0]-e[0],u=i[1]-e[1],p=i[0]-n[0],g=i[1]-n[1];return o*g-p*u==0&&o*p<=0&&u*g<=0}function Gc(i,e,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(p=[e[0]-i[0],e[1]-i[1]])[1]-u[1]*p[0]!=0&&!(!$u(i,e,n,o)||!$u(n,o,i,e));var u,p}function Mf(i,e,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(Gc(i,e,o[u],o[u+1]))return!0;return!1}function $a(i,e,n=!1){let o=!1;for(const x of e)for(let T=0;T<x.length-1;T++){if(Ef(i,x[T],x[T+1]))return n;(p=x[T])[1]>(u=i)[1]!=(g=x[T+1])[1]>u[1]&&u[0]<(g[0]-p[0])*(u[1]-p[1])/(g[1]-p[1])+p[0]&&(o=!o)}var u,p,g;return o}function Hu(i,e){for(const n of e)if($a(i,n))return!0;return!1}function Af(i,e){for(const n of i)if(!$a(n,e))return!1;for(let n=0;n<i.length-1;++n)if(Mf(i[n],i[n+1],e))return!1;return!0}function Cf(i,e){for(const n of e)if(Af(i,n))return!0;return!1}function $u(i,e,n,o){const u=o[0]-n[0],p=o[1]-n[1],g=(i[0]-n[0])*p-u*(i[1]-n[1]),x=(e[0]-n[0])*p-u*(e[1]-n[1]);return g>0&&x<0||g<0&&x>0}function Xu(i,e,n){const o=[];for(let u=0;u<i.length;u++){const p=[];for(let g=0;g<i[u].length;g++){const x=$l(i[u][g],n);Yl(e,x),p.push(x)}o.push(p)}return o}function el(i,e,n){const o=[];for(let u=0;u<i.length;u++){const p=Xu(i[u],e,n);o.push(p)}return o}function Kl(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const u=.5*o;let p=i[0]-n[0]>u?-o:n[0]-i[0]>u?o:0;p===0&&(p=i[0]-n[2]>u?-o:n[2]-i[0]>u?o:0),i[0]+=p}Yl(e,i)}function zf(i,e,n,o){const u=Math.pow(2,o.z)*ki,p=[o.x*ki,o.y*ki],g=[];for(const x of i)for(const T of x){const C=[T.x+p[0],T.y+p[1]];Kl(C,e,n,u),g.push(C)}return g}function Zc(i,e,n,o){const u=Math.pow(2,o.z)*ki,p=[o.x*ki,o.y*ki],g=[];for(const T of i){const C=[];for(const I of T){const L=[I.x+p[0],I.y+p[1]];Yl(e,L),C.push(L)}g.push(C)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of g)for(const C of T)Kl(C,e,n,u)}var x;return g}class vo{constructor(e,n){this.type=fn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ms(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const p of o.features){const{type:g,coordinates:x}=p.geometry;g==="Polygon"&&u.push(x),g==="MultiPolygon"&&u.push(...x)}if(u.length)return new vo(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new vo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new vo(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=Xu(o.coordinates,p,g),T=zf(n.geometry(),u,p,g);if(!_o(u,p))return!1;for(const C of T)if(!$a(C,x))return!1}if(o.type==="MultiPolygon"){const x=el(o.coordinates,p,g),T=zf(n.geometry(),u,p,g);if(!_o(u,p))return!1;for(const C of T)if(!Hu(C,x))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=Xu(o.coordinates,p,g),T=Zc(n.geometry(),u,p,g);if(!_o(u,p))return!1;for(const C of T)if(!Af(C,x))return!1}if(o.type==="MultiPolygon"){const x=el(o.coordinates,p,g),T=Zc(n.geometry(),u,p,g);if(!_o(u,p))return!1;for(const C of T)if(!Cf(C,x))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let nd=class{constructor(i=[],e=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,o=e[i];for(;i>0;){const u=i-1>>1,p=e[u];if(n(o,p)>=0)break;e[i]=p,i=u}e[i]=o}_down(i){const{data:e,compare:n}=this,o=this.length>>1,u=e[i];for(;i<o;){let p=1+(i<<1);const g=p+1;if(g<this.length&&n(e[g],e[p])<0&&(p=g),n(e[p],u)>=0)break;e[i]=e[p],i=p}e[i]=u}};function Hc(i,e,n=0,o=i.length-1,u=id){for(;o>n;){if(o-n>600){const T=o-n+1,C=e-n+1,I=Math.log(T),L=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*L*(T-L)/T)*(C-T/2<0?-1:1);Hc(i,e,Math.max(n,Math.floor(e-C*L/T+B)),Math.min(o,Math.floor(e+(T-C)*L/T+B)),u)}const p=i[e];let g=n,x=o;for(xo(i,n,e),u(i[o],p)>0&&xo(i,n,o);g<x;){for(xo(i,g,x),g++,x--;u(i[g],p)<0;)g++;for(;u(i[x],p)>0;)x--}u(i[n],p)===0?xo(i,n,x):(x++,xo(i,x,o)),x<=e&&(n=x+1),e<=x&&(o=x-1)}}function xo(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function id(i,e){return i<e?-1:i>e?1:0}function $c(i,e){if(i.length<=1)return[i];const n=[];let o,u;for(const p of i){const g=Qp(p);g!==0&&(p.area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(o&&n.push(o),o=[p]):o.push(p))}if(o&&n.push(o),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||(Hc(n[p],e,1,n[p].length-1,Df),n[p]=n[p].slice(0,e));return n}function Df(i,e){return e.area-i.area}function Qp(i){let e=0;for(let n,o,u=0,p=i.length,g=p-1;u<p;g=u++)n=i[u],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}const Pf=1/298.257223563,Xc=Pf*(2-Pf),If=Math.PI/180;class rd{constructor(e){const n=6378.137*If*1e3,o=Math.cos(e*If),u=1/(1-Xc*(1-o*o)),p=Math.sqrt(u);this.kx=n*p*o,this.ky=n*p*u*(1-Xc)}distance(e,n){const o=this.wrap(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,n){let o,u,p,g,x=1/0;for(let T=0;T<e.length-1;T++){let C=e[T][0],I=e[T][1],L=this.wrap(e[T+1][0]-C)*this.kx,B=(e[T+1][1]-I)*this.ky,F=0;L===0&&B===0||(F=(this.wrap(n[0]-C)*this.kx*L+(n[1]-I)*this.ky*B)/(L*L+B*B),F>1?(C=e[T+1][0],I=e[T+1][1]):F>0&&(C+=L/this.kx*F,I+=B/this.ky*F)),L=this.wrap(n[0]-C)*this.kx,B=(n[1]-I)*this.ky;const q=L*L+B*B;q<x&&(x=q,o=C,u=I,p=T,g=F)}return{point:[o,u],index:p,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Vr(i,e){return e[0]-i[0]}function bo(i){return i[1]-i[0]+1}function Ea(i,e){return i[1]>=i[0]&&i[1]<e}function Yc(i,e){if(i[0]>i[1])return[null,null];const n=bo(i);if(e){if(n===2)return[i,null];const u=Math.floor(n/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function Yu(i,e){if(!Ea(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Yl(n,i[o]);return n}function Ku(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)Yl(e,o);return e}function Kc(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Wu(i,e,n){if(!Kc(i)||!Kc(e))return NaN;let o=0,u=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(u=i[1]-e[3]),i[3]<e[1]&&(u=e[1]-i[3]),n.distance([0,0],[o,u])}function Ma(i,e,n){const o=n.pointOnLine(e,i);return n.distance(i,o.point)}function Wc(i,e,n,o,u){const p=Math.min(Ma(i,[n,o],u),Ma(e,[n,o],u)),g=Math.min(Ma(n,[i,e],u),Ma(o,[i,e],u));return Math.min(p,g)}function Qc(i,e,n,o,u){if(!Ea(e,i.length)||!Ea(o,n.length))return 1/0;let p=1/0;for(let g=e[0];g<e[1];++g){const x=i[g],T=i[g+1];for(let C=o[0];C<o[1];++C){const I=n[C],L=n[C+1];if(Gc(x,T,I,L))return 0;p=Math.min(p,Wc(x,T,I,L,u))}}return p}function Qu(i,e,n,o,u){if(!Ea(e,i.length)||!Ea(o,n.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let x=o[0];x<=o[1];++x)if(p=Math.min(p,u.distance(i[g],n[x])),p===0)return p;return p}function kf(i,e,n){if($a(i,e,!0))return 0;let o=1/0;for(const u of e){const p=u[0],g=u[u.length-1];if(p!==g&&(o=Math.min(o,Ma(i,[g,p],n)),o===0))return o;const x=n.pointOnLine(u,i);if(o=Math.min(o,n.distance(i,x.point)),o===0)return o}return o}function tl(i,e,n,o){if(!Ea(e,i.length))return NaN;for(let p=e[0];p<=e[1];++p)if($a(i[p],n,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p){const g=i[p],x=i[p+1];for(const T of n)for(let C=0,I=T.length,L=I-1;C<I;L=C++){const B=T[L],F=T[C];if(Gc(g,x,B,F))return 0;u=Math.min(u,Wc(g,x,B,F,o))}}return u}function nl(i,e){for(const n of i)for(const o of n)if($a(o,e,!0))return!0;return!1}function ad(i,e,n,o=1/0){const u=Ku(i),p=Ku(e);if(o!==1/0&&Wu(u,p,n)>=o)return o;if(_o(u,p)){if(nl(i,e))return 0}else if(nl(e,i))return 0;let g=1/0;for(const x of i)for(let T=0,C=x.length,I=C-1;T<C;I=T++){const L=x[I],B=x[T];for(const F of e)for(let q=0,G=F.length,X=G-1;q<G;X=q++){const J=F[X],he=F[q];if(Gc(L,B,J,he))return 0;g=Math.min(g,Wc(L,B,J,he,n))}}return g}function Ln(i,e,n,o,u,p){if(!p)return;const g=Wu(Yu(o,p),u,n);g<e&&i.push([g,p,[0,0]])}function ys(i,e,n,o,u,p,g){if(!p||!g)return;const x=Wu(Yu(o,p),Yu(u,g),n);x<e&&i.push([x,p,g])}function Jc(i,e,n,o,u=1/0){let p=Math.min(o.distance(i[0],n[0][0]),u);if(p===0)return p;const g=new nd([[0,[0,i.length-1],[0,0]]],Vr),x=Ku(n);for(;g.length>0;){const T=g.pop();if(T[0]>=p)continue;const C=T[1],I=e?50:100;if(bo(C)<=I){if(!Ea(C,i.length))return NaN;if(e){const L=tl(i,C,n,o);if(isNaN(L)||L===0)return L;p=Math.min(p,L)}else for(let L=C[0];L<=C[1];++L){const B=kf(i[L],n,o);if(p=Math.min(p,B),p===0)return 0}}else{const L=Yc(C,e);Ln(g,p,o,i,x,L[0]),Ln(g,p,o,i,x,L[1])}}return p}function eu(i,e,n,o,u,p=1/0){let g=Math.min(p,u.distance(i[0],n[0]));if(g===0)return g;const x=new nd([[0,[0,i.length-1],[0,n.length-1]]],Vr);for(;x.length>0;){const T=x.pop();if(T[0]>=g)continue;const C=T[1],I=T[2],L=e?50:100,B=o?50:100;if(bo(C)<=L&&bo(I)<=B){if(!Ea(C,i.length)&&Ea(I,n.length))return NaN;let F;if(e&&o)F=Qc(i,C,n,I,u),g=Math.min(g,F);else if(e&&!o){const q=i.slice(C[0],C[1]+1);for(let G=I[0];G<=I[1];++G)if(F=Ma(n[G],q,u),g=Math.min(g,F),g===0)return g}else if(!e&&o){const q=n.slice(I[0],I[1]+1);for(let G=C[0];G<=C[1];++G)if(F=Ma(i[G],q,u),g=Math.min(g,F),g===0)return g}else F=Qu(i,C,n,I,u),g=Math.min(g,F)}else{const F=Yc(C,e),q=Yc(I,o);ys(x,g,u,i,n,F[0],q[0]),ys(x,g,u,i,n,F[0],q[1]),ys(x,g,u,i,n,F[1],q[0]),ys(x,g,u,i,n,F[1],q[1])}}return g}function Ju(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class il{constructor(e,n){this.type=At,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ms(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new il(o,o.features.map((u=>Ju(u.geometry))).flat());if(o.type==="Feature")return new il(o,Ju(o.geometry));if("type"in o&&"coordinates"in o)return new il(o,Ju(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const u=n.geometry(),p=u.flat().map((T=>Xl([T.x,T.y],n.canonical)));if(u.length===0)return NaN;const g=new rd(p[0][1]);let x=1/0;for(const T of o){switch(T.type){case"Point":x=Math.min(x,eu(p,!1,[T.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,eu(p,!1,T.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,Jc(p,!1,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const u=n.geometry(),p=u.flat().map((T=>Xl([T.x,T.y],n.canonical)));if(u.length===0)return NaN;const g=new rd(p[0][1]);let x=1/0;for(const T of o){switch(T.type){case"Point":x=Math.min(x,eu(p,!0,[T.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,eu(p,!0,T.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,Jc(p,!0,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const p=$c(u,0).map((T=>T.map((C=>C.map((I=>Xl([I.x,I.y],n.canonical))))))),g=new rd(p[0][0][0][1]);let x=1/0;for(const T of o)for(const C of p){switch(T.type){case"Point":x=Math.min(x,Jc([T.coordinates],!1,C,g,x));break;case"LineString":x=Math.min(x,Jc(T.coordinates,!0,C,g,x));break;case"Polygon":x=Math.min(x,ad(C,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class tu{constructor(e){this.type=sn,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new tu(o)}evaluate(e){var n;const o=(n=e.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?Ul(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Wl={"==":Tf,"!=":Gu,">":Wp,"<":Sf,">=":Zu,"<=":ql,array:Lr,at:_n,boolean:Lr,case:Fc,coalesce:Jo,collator:Gl,format:qc,image:Zl,in:cn,"index-of":Qo,interpolate:Br,"interpolate-hcl":Br,"interpolate-lab":Br,length:Hl,let:Gn,literal:sa,match:An,number:Lr,"number-format":td,object:Lr,slice:Sa,step:yo,string:Lr,"to-boolean":Or,"to-color":Or,"to-number":Or,"to-string":Or,var:mo,within:vo,distance:il,"global-state":tu};class oa{constructor(e,n,o,u){this.name=e,this.type=n,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],u=oa.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=g.filter((([C])=>!Array.isArray(C)||C.length===e.length-1));let T=null;for(const[C,I]of x){T=new Wo(n.registry,Nr,n.path,null,n.scope);const L=[];let B=!1;for(let F=1;F<e.length;F++){const q=e[F],G=Array.isArray(C)?C[F-1]:C.type,X=T.parse(q,1+L.length,G);if(!X){B=!0;break}L.push(X)}if(!B)if(Array.isArray(C)&&C.length!==L.length)T.error(`Expected ${C.length} arguments, but found ${L.length} instead.`);else{for(let F=0;F<L.length;F++){const q=Array.isArray(C)?C[F]:C.type,G=L[F];T.concat(F+1).checkSubtype(q,G.type)}if(T.errors.length===0)return new oa(o,p,I,L)}}if(x.length===1)n.errors.push(...T.errors);else{const C=(x.length?x:g).map((([L])=>{return B=L,Array.isArray(B)?`(${B.map(Mn).join(", ")})`:`(${Mn(B.type)}...)`;var B})).join(" | "),I=[];for(let L=1;L<e.length;L++){const B=n.parse(e[L],1+I.length);if(!B)return null;I.push(Mn(B.type))}n.error(`Expected arguments of type ${C}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){oa.definitions=n;for(const o in n)e[o]=oa}}function sd(i,[e,n,o,u]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const p=u?u.evaluate(i):1,g=aa(e,n,o,p);if(g)throw new Kn(g);return new dn(e/255,n/255,o/255,p,!1)}function eh(i,e){return i in e}function la(i,e){const n=e[i];return n===void 0?null:n}function _s(i){return{type:i}}function Nr(i){if(i instanceof mo)return Nr(i.boundExpression);if(i instanceof oa&&i.name==="error"||i instanceof Gl||i instanceof vo||i instanceof il||i instanceof tu)return!1;const e=i instanceof Or||i instanceof Lr;let n=!0;return i.eachChild((o=>{n=e?n&&Nr(o):n&&o instanceof sa})),!!n&&qs(i)&&al(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function qs(i){if(i instanceof oa&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof vo||i instanceof il)return!1;let e=!0;return i.eachChild((n=>{e&&!qs(n)&&(e=!1)})),e}function rl(i){if(i instanceof oa&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!rl(n)&&(e=!1)})),e}function al(i,e){if(i instanceof oa&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((o=>{n&&!al(o,e)&&(n=!1)})),n}function nu(i){return{result:"success",value:i}}function wo(i){return{result:"error",value:i}}function Aa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function od(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ql(i){return!!i.expression&&i.expression.interpolated}function hn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function th(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&di(i)===us}function ca(i){return i}function nh(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",o=n||!(n||i.property!==void 0),u=i.type||(Ql(e)?"exponential":"interval"),p=(function(I){switch(I.type){case"color":return dn.parse;case"padding":return Fi.parse;case"numberArray":return hi.parse;case"colorArray":return Jt.parse;default:return null}})(e);if(p&&((i=br({},i)).stops&&(i.stops=i.stops.map((I=>[I[0],p(I[1])]))),i.default=p(i.default?i.default:e.default)),i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;const x=(function(I){switch(I){case"exponential":return To;case"interval":return ih;case"categorical":return Rf;case"identity":return ld;default:throw new Error(`Unknown function type "${I}"`)}})(u);let T,C;if(u==="categorical"){T=Object.create(null);for(const I of i.stops)T[I[0]]=I[1];C=typeof i.stops[0][0]}if(n){const I={},L=[];for(let q=0;q<i.stops.length;q++){const G=i.stops[q],X=G[0].zoom;I[X]===void 0&&(I[X]={zoom:X,type:i.type,property:i.property,default:i.default,stops:[]},L.push(X)),I[X].stops.push([G[0].value,G[1]])}const B=[];for(const q of L)B.push([I[q].zoom,nh(I[q],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Br.interpolationFactor.bind(void 0,F),zoomStops:B.map((q=>q[0])),evaluate:({zoom:q},G)=>To({stops:B,base:i.base},e,q).evaluate(q,G)}}if(o){const I=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Br.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map((L=>L[0])),evaluate:({zoom:L})=>x(i,e,L,T,C)}}return{kind:"source",evaluate(I,L){const B=L&&L.properties?L.properties[i.property]:void 0;return B===void 0?ua(i.default,e.default):x(i,e,B,T,C)}}}function ua(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Rf(i,e,n,o,u){return ua(typeof n===u?o[n]:void 0,i.default,e.default)}function ih(i,e,n){if(hn(n)!=="number")return ua(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const u=go(i.stops.map((p=>p[0])),n);return i.stops[u][1]}function To(i,e,n){const o=i.base!==void 0?i.base:1;if(hn(n)!=="number")return ua(i.default,e.default);const u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];const p=go(i.stops.map((I=>I[0])),n),g=(function(I,L,B,F){const q=F-B,G=I-B;return q===0?0:L===1?G/q:(Math.pow(L,G)-1)/(Math.pow(L,q)-1)})(n,o,i.stops[p][0],i.stops[p+1][0]),x=i.stops[p][1],T=i.stops[p+1][1],C=fi[e.type]||ca;return typeof x.evaluate=="function"?{evaluate(...I){const L=x.evaluate.apply(void 0,I),B=T.evaluate.apply(void 0,I);if(L!==void 0&&B!==void 0)return C(L,B,g,i.colorSpace)}}:C(x,T,g,i.colorSpace)}function ld(i,e,n){switch(e.type){case"color":n=dn.parse(n);break;case"formatted":n=Ji.fromString(n.toString());break;case"resolvedImage":n=Rr.fromString(n.toString());break;case"padding":n=Fi.parse(n);break;case"colorArray":n=Jt.parse(n);break;case"numberArray":n=hi.parse(n);break;default:hn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return ua(n,i.default,e.default)}oa.register(Wl,{error:[{kind:"error"},[ln],(i,[e])=>{throw new Kn(e.evaluate(i))}],typeof:[ln,[sn],(i,[e])=>Mn(di(e.evaluate(i)))],"to-rgba":[Tr(At,4),[ra],(i,[e])=>{const[n,o,u,p]=e.evaluate(i).rgb;return[255*n,255*o,255*u,p]}],rgb:[ra,[At,At,At],sd],rgba:[ra,[At,At,At,At],sd],has:{type:fn,overloads:[[[ln],(i,[e])=>eh(e.evaluate(i),i.properties())],[[ln,us],(i,[e,n])=>eh(e.evaluate(i),n.evaluate(i))]]},get:{type:sn,overloads:[[[ln],(i,[e])=>la(e.evaluate(i),i.properties())],[[ln,us],(i,[e,n])=>la(e.evaluate(i),n.evaluate(i))]]},"feature-state":[sn,[ln],(i,[e])=>la(e.evaluate(i),i.featureState||{})],properties:[us,[],i=>i.properties()],"geometry-type":[ln,[],i=>i.geometryType()],id:[sn,[],i=>i.id()],zoom:[At,[],i=>i.globals.zoom],"heatmap-density":[At,[],i=>i.globals.heatmapDensity||0],elevation:[At,[],i=>i.globals.elevation||0],"line-progress":[At,[],i=>i.globals.lineProgress||0],accumulated:[sn,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[At,_s(At),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[At,_s(At),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:At,overloads:[[[At,At],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[At],(i,[e])=>-e.evaluate(i)]]},"/":[At,[At,At],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[At,[At,At],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[At,[],()=>Math.LN2],pi:[At,[],()=>Math.PI],e:[At,[],()=>Math.E],"^":[At,[At,At],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[At,[At],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[At,[At],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[At,[At],(i,[e])=>Math.log(e.evaluate(i))],log2:[At,[At],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[At,[At],(i,[e])=>Math.sin(e.evaluate(i))],cos:[At,[At],(i,[e])=>Math.cos(e.evaluate(i))],tan:[At,[At],(i,[e])=>Math.tan(e.evaluate(i))],asin:[At,[At],(i,[e])=>Math.asin(e.evaluate(i))],acos:[At,[At],(i,[e])=>Math.acos(e.evaluate(i))],atan:[At,[At],(i,[e])=>Math.atan(e.evaluate(i))],min:[At,_s(At),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[At,_s(At),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[At,[At],(i,[e])=>Math.abs(e.evaluate(i))],round:[At,[At],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[At,[At],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[At,[At],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[fn,[ln,sn],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[fn,[sn],(i,[e])=>i.id()===e.value],"filter-type-==":[fn,[ln],(i,[e])=>i.geometryType()===e.value],"filter-<":[fn,[ln,sn],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[fn,[sn],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[fn,[ln,sn],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[fn,[sn],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[fn,[ln,sn],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[fn,[sn],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[fn,[ln,sn],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[fn,[sn],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[fn,[sn],(i,[e])=>e.value in i.properties()],"filter-has-id":[fn,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[fn,[Tr(ln)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[fn,[Tr(sn)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[fn,[ln,Tr(sn)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[fn,[ln,Tr(sn)],(i,[e,n])=>(function(o,u,p,g){for(;p<=g;){const x=p+g>>1;if(u[x]===o)return!0;u[x]>o?g=x-1:p=x+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:fn,overloads:[[[fn,fn],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[_s(fn),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:fn,overloads:[[[fn,fn],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[_s(fn),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[fn,[fn],(i,[e])=>!e.evaluate(i)],"is-supported-script":[fn,[ln],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[ln,[ln],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ln,[ln],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ln,_s(sn),(i,e)=>e.map((n=>po(n.evaluate(i)))).join("")],"resolved-locale":[ln,[Zo],(i,[e])=>e.evaluate(i).resolvedLocale()]});class rh{constructor(e,n,o){this.expression=e,this._warningHistory={},this._evaluator=new Ko,this._defaultValue=n?(function(u){if(u.type==="color"&&th(u.default))return new dn(0,0,0,0);switch(u.type){case"color":return dn.parse(u.default)||null;case"padding":return Fi.parse(u.default)||null;case"numberArray":return hi.parse(u.default)||null;case"colorArray":return Jt.parse(u.default)||null;case"variableAnchorOffsetCollection":return Ei.parse(u.default)||null;case"projectionDefinition":return er.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=rr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,u,p,g){this._globalState&&(e=rr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Kn(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function So(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Wl}function Jl(i,e,n){const o=new Wo(Wl,Nr,[],e?(function(p){const g={color:ra,string:ln,number:At,enum:ln,boolean:fn,formatted:hs,padding:js,numberArray:fs,colorArray:ds,projectionDefinition:Uu,resolvedImage:Si,variableAnchorOffsetCollection:Nl};return p.type==="array"?Tr(g[p.value]||sn,p.length):g[p.type]})(e):void 0),u=o.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?nu(new rh(u,e,n)):wo(o.errors)}class Fr{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!rl(n.expression),this.globalStateRefs=tr(n.expression),this._globalState=o}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=rr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,o,u,p,g)}evaluate(e,n,o,u,p,g){return this._globalState&&(e=rr(e,this._globalState)),this._styleExpression.evaluate(e,n,o,u,p,g)}}class Eo{constructor(e,n,o,u,p){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!rl(n.expression),this.globalStateRefs=tr(n.expression),this.interpolationType=u,this._globalState=p}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=rr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,o,u,p,g)}evaluate(e,n,o,u,p,g){return this._globalState&&(e=rr(e,this._globalState)),this._styleExpression.evaluate(e,n,o,u,p,g)}interpolationFactor(e,n,o){return this.interpolationType?Br.interpolationFactor(this.interpolationType,e,n,o):0}}function Mo(i,e,n){const o=Jl(i,e,n);if(o.result==="error")return o;const u=o.value.expression,p=qs(u);if(!p&&!Aa(e))return wo([new wr("","data expressions not supported")]);const g=al(u,["zoom"]);if(!g&&!od(e))return wo([new wr("","zoom expressions not supported")]);const x=Ao(u);return x||g?x instanceof wr?wo([x]):x instanceof Br&&!Ql(e)?wo([new wr("",'"interpolate" expressions cannot be used with this property')]):nu(x?new Eo(p?"camera":"composite",o.value,x.labels,x instanceof Br?x.interpolation:void 0,n):new Fr(p?"constant":"source",o.value,n)):wo([new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sl{constructor(e,n){this._parameters=e,this._specification=n,br(this,nh(this._parameters,this._specification))}static deserialize(e){return new sl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ao(i){let e=null;if(i instanceof Gn)e=Ao(i.result);else if(i instanceof Jo){for(const n of i.args)if(e=Ao(n),e)break}else(i instanceof yo||i instanceof Br)&&i.input instanceof oa&&i.input.name==="zoom"&&(e=i);return e instanceof wr||i.eachChild((n=>{const o=Ao(n);o instanceof wr?e=o:!e&&o?e=new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function tr(i,e=new Set){return i instanceof tu&&e.add(i.key),i.eachChild((n=>{tr(n,e)})),e}function rr(i,e){const{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:g,accumulated:x}=i??{};return{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:g,accumulated:x,globalState:e}}function vs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!vs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const xs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function qr(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};vs(i)||(i=ol(i));const n=Jl(i,xs,e);if(n.result==="error")throw new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,p)=>n.value.evaluate(o,u,{},p),needGeometry:cd(i),getGlobalStateRefs:()=>tr(n.value.expression)}}function Gs(i,e){return i<e?-1:i>e?1:0}function cd(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(cd(i[e]))return!0;return!1}function ol(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ec(i[1],i[2],"=="):e==="!="?Wn(ec(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ec(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(ol))):e==="all"?["all"].concat(i.slice(1).map(ol)):e==="none"?["all"].concat(i.slice(1).map(ol).map(Wn)):e==="in"?ud(i[1],i.slice(2)):e==="!in"?Wn(ud(i[1],i.slice(2))):e==="has"?ar(i[1]):e!=="!has"||Wn(ar(i[1]));var n}function ec(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function ud(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Gs)]]:["filter-in-small",i,["literal",e]]}}function ar(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Wn(i){return["!",i]}function En(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const p of i)u+=`${En(p)},`;return`${u}]`}const n=Object.keys(i).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${En(i[n[u]])},`;return`${o}}`}function Zs(i){let e="";for(const n of lt)e+=`/${En(i[n])}`;return e}function ha(i){const e=i.value;return e?[new xt(i.key,e,"constants have been deprecated as of v8")]:[]}function _i(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Gr(i){if(Array.isArray(i))return i.map(Gr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Gr(i[n]);return e}return _i(i)}function Zr(i){const e=i.key,n=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},p=i.style,g=i.styleSpec,x=i.validateSpec;let T=[];const C=hn(n);if(C!=="object")return[new xt(e,n,`object expected, ${C} found`)];for(const I in n){const L=I.split(".")[0],B=Ul(o,L)||o["*"];let F;if(Ul(u,L))F=u[L];else if(Ul(o,L)){if(n[I]===void 0)continue;F=x}else if(u["*"])F=u["*"];else{if(!o["*"]){T.push(new xt(e,n[I],`unknown property "${I}"`));continue}F=x}T=T.concat(F({key:(e&&`${e}.`)+I,value:n[I],valueSpec:B,style:p,styleSpec:g,object:n,objectKey:I,validateSpec:x},n))}for(const I in o)u[I]||o[I].required&&o[I].default===void 0&&n[I]===void 0&&T.push(new xt(e,n,`missing required property "${I}"`));return T}function iu(i){const e=i.value,n=i.valueSpec,o=i.style,u=i.styleSpec,p=i.key,g=i.arrayElementValidator||i.validateSpec;if(hn(e)!=="array")return[new xt(p,e,`array expected, ${hn(e)} found`)];if(n.length&&e.length!==n.length)return[new xt(p,e,`array length ${n.length} expected, length ${e.length} found`)];let x={type:n.value,values:n.values};u.$version<7&&(x.function=n.function),hn(n.value)==="object"&&(x=n.value);let T=[];for(let C=0;C<e.length;C++)T=T.concat(g({array:e,arrayIndex:C,value:e[C],valueSpec:x,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${p}[${C}]`}));return T}function bs(i){const e=i.key,n=i.value,o=i.valueSpec;let u=hn(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new xt(e,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new xt(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new xt(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function ws(i){const e=i.valueSpec,n=_i(i.value.type);let o,u,p,g={};const x=n!=="categorical"&&i.value.property===void 0,T=!x,C=hn(i.value.stops)==="array"&&hn(i.value.stops[0])==="array"&&hn(i.value.stops[0][0])==="object",I=Zr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new xt(F.key,F.value,'identity function may not have a "stops" property')];let q=[];const G=F.value;return q=q.concat(iu({key:F.key,value:G,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:L})),hn(G)==="array"&&G.length===0&&q.push(new xt(F.key,G,"array must have at least one stop")),q},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&x&&I.push(new xt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||I.push(new xt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Ql(i.valueSpec)&&I.push(new xt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!Aa(i.valueSpec)?I.push(new xt(i.key,i.value,"property functions not supported")):x&&!od(i.valueSpec)&&I.push(new xt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!C||i.value.property!==void 0||I.push(new xt(i.key,i.value,'"property" property is required')),I;function L(F){let q=[];const G=F.value,X=F.key;if(hn(G)!=="array")return[new xt(X,G,`array expected, ${hn(G)} found`)];if(G.length!==2)return[new xt(X,G,`array length 2 expected, length ${G.length} found`)];if(C){if(hn(G[0])!=="object")return[new xt(X,G,`object expected, ${hn(G[0])} found`)];if(G[0].zoom===void 0)return[new xt(X,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new xt(X,G,"object stop key must have value")];if(p&&p>_i(G[0].zoom))return[new xt(X,G[0].zoom,"stop zoom values must appear in ascending order")];_i(G[0].zoom)!==p&&(p=_i(G[0].zoom),u=void 0,g={}),q=q.concat(Zr({key:`${X}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:bs,value:B}}))}else q=q.concat(B({key:`${X}[0]`,value:G[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},G));return So(Gr(G[1]))?q.concat([new xt(`${X}[1]`,G[1],"expressions are not allowed in function stops.")]):q.concat(F.validateSpec({key:`${X}[1]`,value:G[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function B(F,q){const G=hn(F.value),X=_i(F.value),J=F.value!==null?F.value:q;if(o){if(G!==o)return[new xt(F.key,J,`${G} stop domain type must match previous stop domain type ${o}`)]}else o=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new xt(F.key,J,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&n!=="categorical"){let he=`number expected, ${G} found`;return Aa(e)&&n===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(F.key,J,he)]}return n!=="categorical"||G!=="number"||isFinite(X)&&Math.floor(X)===X?n!=="categorical"&&G==="number"&&u!==void 0&&X<u?[new xt(F.key,J,"stop domain values must appear in ascending order")]:(u=X,n==="categorical"&&X in g?[new xt(F.key,J,"stop domain values must be unique")]:(g[X]=!0,[])):[new xt(F.key,J,`integer expected, found ${X}`)]}}function Ts(i){const e=(i.expressionContext==="property"?Mo:Jl)(Gr(i.value),i.valueSpec);if(e.result==="error")return e.value.map((o=>new xt(`${i.key}${o.key}`,i.value,o.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new xt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!rl(n))return[new xt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!rl(n))return[new xt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!al(n,["zoom","feature-state"]))return[new xt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!qs(n))return[new xt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(i){const e=i.key,n=i.value,o=hn(n);return o!=="string"?[new xt(e,n,`color expected, ${o} found`)]:dn.parse(String(n))?[]:[new xt(e,n,`color expected, "${n}" found`)]}function $s(i){const e=i.key,n=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(_i(n))===-1&&u.push(new xt(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(_i(n))===-1&&u.push(new xt(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Ca(i){return vs(Gr(i.value))?Ts(br({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ss(i)}function Ss(i){const e=i.value,n=i.key;if(hn(e)!=="array")return[new xt(n,e,`array expected, ${hn(e)} found`)];const o=i.styleSpec;let u,p=[];if(e.length<1)return[new xt(n,e,"filter array must have at least 1 element")];switch(p=p.concat($s({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),_i(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&_i(e[1])==="$type"&&p.push(new xt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new xt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=hn(e[1]),u!=="string"&&p.push(new xt(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=hn(e[g]),_i(e[1])==="$type"?p=p.concat($s({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new xt(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Ss({key:`${n}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=hn(e[1]),e.length!==2?p.push(new xt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new xt(`${n}[1]`,e[1],`string expected, ${u} found`))}return p}function Xs(i,e){const n=i.key,o=i.validateSpec,u=i.style,p=i.styleSpec,g=i.value,x=i.objectKey,T=p[`${e}_${i.layerType}`];if(!T)return[];const C=x.match(/^(.*)-transition$/);if(e==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return o({key:n,value:g,valueSpec:p.transition,style:u,styleSpec:p});const I=i.valueSpec||T[x];if(!I)return[new xt(n,g,`unknown property "${x}"`)];let L;if(hn(g)==="string"&&Aa(I)&&!I.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new xt(n,g,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const B=[];return i.layerType==="symbol"&&x==="text-font"&&th(Gr(g))&&_i(g.type)==="identity"&&B.push(new xt(n,g,'"text-font" does not support identity functions')),B.concat(o({key:i.key,value:g,valueSpec:I,style:u,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:x}))}function Es(i){return Xs(i,"paint")}function ah(i){return Xs(i,"layout")}function sh(i){let e=[];const n=i.value,o=i.key,u=i.style,p=i.styleSpec;if(hn(n)!=="object")return[new xt(o,n,`object expected, ${hn(n)} found`)];n.type||n.ref||e.push(new xt(o,n,'either "type" or "ref" is required'));let g=_i(n.type);const x=_i(n.ref);if(n.id){const T=_i(n.id);for(let C=0;C<i.arrayIndex;C++){const I=u.layers[C];_i(I.id)===T&&e.push(new xt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach((C=>{C in n&&e.push(new xt(o,n[C],`"${C}" is prohibited for ref layers`))})),u.layers.forEach((C=>{_i(C.id)===x&&(T=C)})),T?T.ref?e.push(new xt(o,n.ref,"ref cannot reference another ref layer")):g=_i(T.type):e.push(new xt(o,n.ref,`ref layer "${x}" not found`))}else if(g!=="background")if(n.source){const T=u.sources&&u.sources[n.source],C=T&&_i(T.type);T?C==="vector"&&g==="raster"?e.push(new xt(o,n.source,`layer "${n.id}" requires a raster source`)):C!=="raster-dem"&&g==="hillshade"||C!=="raster-dem"&&g==="color-relief"?e.push(new xt(o,n.source,`layer "${n.id}" requires a raster-dem source`)):C==="raster"&&g!=="raster"?e.push(new xt(o,n.source,`layer "${n.id}" requires a vector source`)):C!=="vector"||n["source-layer"]?C==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new xt(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||C==="geojson"&&T.lineMetrics||e.push(new xt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new xt(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new xt(o,n.source,`source "${n.source}" not found`))}else e.push(new xt(o,n,'missing required property "source"'));return e=e.concat(Zr({key:o,value:n,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Ca,layout:T=>Zr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>ah(br({layerType:g},C))}}),paint:T=>Zr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Es(br({layerType:g},C))}})}})),e}function da(i){const e=i.value,n=i.key,o=hn(e);return o!=="string"?[new xt(n,e,`string expected, ${o} found`)]:[]}const tc={promoteId:function({key:i,value:e}){if(hn(e)==="string")return da({key:i,value:e});{const n=[];for(const o in e)n.push(...da({key:`${i}.${o}`,value:e[o]}));return n}}};function Ys(i){const e=i.value,n=i.key,o=i.styleSpec,u=i.style,p=i.validateSpec;if(!e.type)return[new xt(n,e,'"type" is required')];const g=_i(e.type);let x;switch(g){case"vector":case"raster":return x=Zr({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:tc,validateSpec:p}),x;case"raster-dem":return x=(function(T){var C;const I=(C=T.sourceName)!==null&&C!==void 0?C:"",L=T.value,B=T.styleSpec,F=B.source_raster_dem,q=T.style;let G=[];const X=hn(L);if(L===void 0)return G;if(X!=="object")return G.push(new xt("source_raster_dem",L,`object expected, ${X} found`)),G;const J=_i(L.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],ee=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ae in L)!J&&he.includes(ae)?G.push(new xt(ae,L[ae],`In "${I}": "${ae}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):F[ae]?G=G.concat(T.validateSpec({key:ae,value:L[ae],valueSpec:F[ae],validateSpec:T.validateSpec,style:q,styleSpec:B})):G.push(new xt(ae,L[ae],`unknown property "${ae}"`));return G})({sourceName:n,value:e,style:i.style,styleSpec:o,validateSpec:p}),x;case"geojson":if(x=Zr({key:n,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:p,objectElementValidators:tc}),e.cluster)for(const T in e.clusterProperties){const[C,I]=e.clusterProperties[T],L=typeof C=="string"?[C,["accumulated"],["get",T]]:C;x.push(...Ts({key:`${n}.${T}.map`,value:I,expressionContext:"cluster-map"})),x.push(...Ts({key:`${n}.${T}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return Zr({key:n,value:e,valueSpec:o.source_video,style:u,validateSpec:p,styleSpec:o});case"image":return Zr({key:n,value:e,valueSpec:o.source_image,style:u,validateSpec:p,styleSpec:o});case"canvas":return[new xt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $s({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ji(i){const e=i.value,n=i.styleSpec,o=n.light,u=i.style;let p=[];const g=hn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new xt("light",e,`object expected, ${g} found`)]),p;for(const x in e){const T=x.match(/^(.*)-transition$/);p=p.concat(T&&o[T[1]]&&o[T[1]].transition?i.validateSpec({key:x,value:e[x],valueSpec:n.transition,validateSpec:i.validateSpec,style:u,styleSpec:n}):o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new xt(x,e[x],`unknown property "${x}"`)])}return p}function ru(i){const e=i.value,n=i.styleSpec,o=n.sky,u=i.style,p=hn(e);if(e===void 0)return[];if(p!=="object")return[new xt("sky",e,`object expected, ${p} found`)];let g=[];for(const x in e)g=g.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],style:u,styleSpec:n}):[new xt(x,e[x],`unknown property "${x}"`)]);return g}function oh(i){const e=i.value,n=i.styleSpec,o=n.terrain,u=i.style;let p=[];const g=hn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new xt("terrain",e,`object expected, ${g} found`)]),p;for(const x in e)p=p.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new xt(x,e[x],`unknown property "${x}"`)]);return p}function hd(i){let e=[];const n=i.value,o=i.key;if(Array.isArray(n)){const u=[],p=[];for(const g in n)n[g].id&&u.includes(n[g].id)&&e.push(new xt(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),u.push(n[g].id),n[g].url&&p.includes(n[g].url)&&e.push(new xt(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),p.push(n[g].url),e=e.concat(Zr({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return da({key:o,value:n})}function Lf(i){return!!i&&i.constructor===Object}function dd(i){return Lf(i.value)?[]:[new xt(i.key,i.value,`object expected, ${hn(i.value)} found`)]}const Ri={"*":()=>[],array:iu,boolean:function(i){const e=i.value,n=i.key,o=hn(e);return o!=="boolean"?[new xt(n,e,`boolean expected, ${o} found`)]:[]},number:bs,color:Hs,constants:ha,enum:$s,filter:Ca,function:ws,layer:sh,object:Zr,source:Ys,light:ji,sky:ru,terrain:oh,projection:function(i){const e=i.value,n=i.styleSpec,o=n.projection,u=i.style,p=hn(e);if(e===void 0)return[];if(p!=="object")return[new xt("projection",e,`object expected, ${p} found`)];let g=[];for(const x in e)g=g.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],style:u,styleSpec:n}):[new xt(x,e[x],`unknown property "${x}"`)]);return g},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const o=hn(n);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(n)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(n)?["array","string"].includes(o)?[]:[new xt(e,n,`projection expected, invalid type "${o}" found`)]:[new xt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:da,formatted:function(i){return da(i).length===0?[]:Ts(i)},resolvedImage:function(i){return da(i).length===0?[]:Ts(i)},padding:function(i){const e=i.key,n=i.value;if(hn(n)==="array"){if(n.length<1||n.length>4)return[new xt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let p=0;p<n.length;p++)u=u.concat(i.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return u}return bs({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(hn(n)==="array"){const o={type:"number"};if(n.length<1)return[new xt(e,n,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<n.length;p++)u=u.concat(i.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return u}return bs({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(hn(n)==="array"){if(n.length<1)return[new xt(e,n,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<n.length;u++)o=o.concat(Hs({key:`${e}[${u}]`,value:n[u]}));return o}return Hs({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,o=hn(n),u=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new xt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let g=0;g<n.length;g+=2)p=p.concat($s({key:`${e}[${g}]`,value:n[g],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(iu({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return p},sprite:hd,state:dd,fontFaces:function(i){const e=i.key,n=i.value,o=i.validateSpec,u=i.styleSpec,p=i.style;if(!Lf(n))return[new xt(e,n,`object expected, ${hn(n)} found`)];const g=[];for(const x in n){const T=n[x],C=hn(T);if(C==="string")g.push(...da({key:`${e}.${x}`,value:T}));else if(C==="array"){const I={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[L,B]of T.entries())g.push(...Zr({key:`${e}.${x}[${L}]`,value:B,valueSpec:I,styleSpec:u,style:p,validateSpec:o}))}else g.push(new xt(`${e}.${x}`,T,`string or array expected, ${C} found`))}return g}};function Ms(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=Ms,n.expression&&th(_i(e))?ws(i):n.expression&&So(Gr(e))?Ts(i):n.type&&Ri[n.type]?Ri[n.type](i):Zr(br({},i,{valueSpec:n.type?o[n.type]:n}))}function nc(i){const e=i.value,n=i.key,o=da(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new xt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new xt(n,e,'"glyphs" url must include a "{range}" token'))),o}function Sr(i,e=Ne){let n=[];return n=n.concat(Ms({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Ms,objectElementValidators:{glyphs:nc,"*":()=>[]}})),i.constants&&(n=n.concat(ha({key:"constants",value:i.constants}))),ll(n)}function fa(i){return function(e){return i(Object.assign({},e,{validateSpec:Ms}))}}function ll(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function Er(i){return function(...e){return ll(i.apply(this,e))}}Sr.source=Er(fa(Ys)),Sr.sprite=Er(fa(hd)),Sr.glyphs=Er(fa(nc)),Sr.light=Er(fa(ji)),Sr.sky=Er(fa(ru)),Sr.terrain=Er(fa(oh)),Sr.state=Er(fa(dd)),Sr.layer=Er(fa(sh)),Sr.filter=Er(fa(Ca)),Sr.paintProperty=Er(fa(Es)),Sr.layoutProperty=Er(fa(ah));const Jp={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class ic{constructor(e,n){this._globalState=n,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=Jl(e,Jp,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=tr(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const au=Ne,nr=Sr,Xa=nr.light,lh=nr.sky,ch=nr.paintProperty,Of=nr.layoutProperty;function Ya(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new gn(new Error(o.message))),n=!0;return n}class Co{constructor(e,n,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let T=0;T<this.d*this.d;T++){const C=g[3+T],I=g[3+T+1];u.push(C===I?null:g.subarray(C,I))}const x=g[3+u.length+1];this.keys=g.subarray(g[3+u.length],x),this.bboxes=g.subarray(x),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const p=o/n*e;this.min=-p,this.max=e+p}insert(e,n,o,u,p){this._forEachCell(n,o,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,u,p,g){this.cells[p].push(g)}query(e,n,o,u,p){const g=this.min,x=this.max;if(e<=g&&n<=g&&x<=o&&x<=u&&!p)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,o,u,this._queryCell,T,{},p),T}}_queryCell(e,n,o,u,p,g,x,T){const C=this.cells[p];if(C!==null){const I=this.keys,L=this.bboxes;for(let B=0;B<C.length;B++){const F=C[B];if(x[F]===void 0){const q=4*F;(T?T(L[q+0],L[q+1],L[q+2],L[q+3]):e<=L[q+2]&&n<=L[q+3]&&o>=L[q+0]&&u>=L[q+1])?(x[F]=!0,g.push(I[F])):x[F]=!1}}}}_forEachCell(e,n,o,u,p,g,x,T){const C=this._convertToCellCoord(e),I=this._convertToCellCoord(n),L=this._convertToCellCoord(o),B=this._convertToCellCoord(u);for(let F=C;F<=L;F++)for(let q=I;q<=B;q++){const G=this.d*q+F;if((!T||T(this._convertFromCellCoord(F),this._convertFromCellCoord(q),this._convertFromCellCoord(F+1),this._convertFromCellCoord(q+1)))&&p.call(this,e,n,o,u,G,g,x,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=n;for(let g=0;g<e.length;g++){const x=e[g];u[3+g]=p,u.set(x,p),p+=x.length}return u[3+e.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+e.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new Co(e.buffer)}}const Hr={};function Rt(i,e,n={}){if(Hr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Hr[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Rt("Object",Object),Rt("Set",Set),Rt("TransferableGridIndex",Co),Rt("Color",dn),Rt("Error",Error),Rt("AJAXError",ye),Rt("ResolvedImage",Rr),Rt("StylePropertyFunction",sl),Rt("StyleExpression",rh,{omit:["_evaluator"]}),Rt("ZoomDependentExpression",Eo),Rt("ZoomConstantExpression",Fr),Rt("CompoundExpression",oa,{omit:["_evaluate"]});for(const i in Wl)Wl[i]._classRegistryKey||Rt(`Expression_${i}`,Wl[i]);function su(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function uh(i){return i.$name||i.constructor._classRegistryKey}function za(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=uh(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||su(i)||na(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Ka(i,e){if(za(i))return(su(i)||na(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const p=[];for(const g of i)p.push(Ka(g,e));return p}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=uh(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Hr[n])throw new Error(`${n} is not registered.`);const{klass:o}=Hr[n],u=o.serialize?o.serialize(i,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||Hr[n].omit.indexOf(p)>=0)continue;const g=i[p];u[p]=Hr[n].shallow.indexOf(p)>=0?g:Ka(g,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function rc(i){if(za(i))return i;if(Array.isArray(i))return i.map(rc);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=uh(i)||"Object";if(!Hr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Hr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const p=i[u];o[u]=Hr[e].shallow.indexOf(u)>=0?p:rc(p)}return o}class hh{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function As(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function cl(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function ou(i){return/\s/u.test(String.fromCodePoint(i))}function Cs(i){for(const e of i)if(cl(e.codePointAt(0)))return!0;return!1}function dh(i){for(const e of i)if(!fd(e.codePointAt(0)))return!1;return!0}function lu(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const zs=lu(["Arab","Dupl","Mong","Ougr","Syrc"]);function fd(i){return!zs.test(String.fromCodePoint(i))}function Ds(i){return!(cl(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const fh=lu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function cu(i){return fh.test(String.fromCodePoint(i))}function Ps(i,e){return!(!e&&cu(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Ks(i){for(const e of i)if(cu(e.codePointAt(0)))return!0;return!1}const Da=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Da.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,o=new Promise((p=>{this.loadScriptResolve=p}));e(n);const u=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:n};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class jn{constructor(e,n){this.isSupportedScript=pd,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new hh,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}function pd(i){return(function(e,n){for(const o of e)if(!Ps(o.codePointAt(0),n))return!1;return!0})(i,Da.getRTLTextPluginStatus()==="loaded")}const Ws="-transition";class zo{constructor(e,n,o){this.property=e,this.value=n,this.expression=(function(u,p,g){if(th(u))return new sl(u,p);if(So(u)){const x=Mo(u,p,g);if(x.result==="error")throw new Error(x.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return x.value}{let x=u;return p.type==="color"&&typeof u=="string"?x=dn.parse(u):p.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?p.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?p.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?x=Ei.parse(u):p.type==="projectionDefinition"&&typeof u=="string"&&(x=er.parse(u)):x=Jt.parse(u):x=hi.parse(u):x=Fi.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>x}}})(n===void 0?e.specification.default:n,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class uu{constructor(e,n){this.property=e,this.value=new zo(e,void 0,n)}transitioned(e,n){return new ul(this.property,this.value,n,rn({},e.transition,this.transition),e.now)}untransitioned(){return new ul(this.property,this.value,null,{},0)}}class ph{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return qn(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new uu(this._values[e].property,this._globalState)),this._values[e].value=new zo(this._values[e].property,n===null?void 0:qn(n),this._globalState)}getTransition(e){return qn(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new uu(this._values[e].property,this._globalState)),this._values[e].transition=qn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const u=this.getTransition(n);u!==void 0&&(e[`${n}${Ws}`]=u)}return e}transitioned(e,n){const o=new hu(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,n._values[u]);return o}untransitioned(){const e=new hu(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ul{constructor(e,n,o,u,p){this.property=e,this.value=n,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const u=e.now||0,p=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return g.possiblyEvaluate(e,n,o);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),p,vt(x))}}return p}}class hu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const u=new hl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,n,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class md{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return qn(this._values[e].value)}setValue(e,n){this._values[e]=new zo(this._values[e].property,n===null?void 0:qn(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const u=new hl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,n,o);return u}}class pa{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,u){return this.property.evaluate(this.value,this.parameters,e,n,o,u)}}class hl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Bt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const u=fi[this.specification.type];return u?u(e,n,o):e}}class qt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,u){return new pa(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,u)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new pa(this,{kind:"constant",value:void 0},e.parameters);const u=fi[this.specification.type];if(u){const p=u(e.value.value,n.value.value,o);return new pa(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,n,o,u,p,g){return e.kind==="constant"?e.value:e.evaluate(n,o,u,p,g)}}class Pa extends qt{possiblyEvaluate(e,n,o,u){if(e.value===void 0)return new pa(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},o,u),g=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,x=this._calculate(g,g,g,n);return new pa(this,{kind:"constant",value:x},n)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new pa(this,{kind:"constant",value:p},n)}return new pa(this,e.expression,n)}evaluate(e,n,o,u,p,g){if(e.kind==="source"){const x=e.evaluate(n,o,u,p,g);return this._calculate(x,x,x,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,u),e.evaluate({zoom:Math.floor(n.zoom)},o,u),e.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):e.value}_calculate(e,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class ac{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},o,u);return this._calculate(p,p,p,n)}return this._calculate(e.expression.evaluate(new jn(Math.floor(n.zoom-1),n)),e.expression.evaluate(new jn(Math.floor(n.zoom),n)),e.expression.evaluate(new jn(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class du{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,u){return!!e.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class Li{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new zo(o,void 0,void 0),p=this.defaultTransitionablePropertyValues[n]=new uu(o,void 0);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}Rt("DataDrivenProperty",qt),Rt("DataConstantProperty",Bt),Rt("CrossFadedDataDrivenProperty",Pa),Rt("CrossFadedProperty",ac),Rt("ColorRampProperty",du);class vi extends pn{constructor(e,n,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(u,p){return new ic(u,p)})(this.visibility,o),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=qr(e.filter,o)),n.layout&&(this._unevaluatedLayout=new md(n.layout,o)),n.paint)){this._transitionablePaint=new ph(n.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hl(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=qr(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())e.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const u of o.getGlobalStateRefs())e.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const p of u.getGlobalStateRefs()){const g=(e=n.get(p))!==null&&e!==void 0?e:[];g.push({name:o,value:u.value}),n.set(p,g)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,n,o={}){if(n==null||!this._validate(Of,`layers.${this.id}.layout.${e}`,e,n,o))return e==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,n)}getPaintProperty(e){return e.endsWith(Ws)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(ch,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(Ws))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[e],p=u.property.specification["property-type"]==="cross-faded-data-driven",g=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||g||p||this._handleOverridablePaintPropertyUpdate(e,x,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e=this.minzoom,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),xn(e,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(e,n,o,u,p={}){return(!p||p.validate!==!1)&&Ya(this,e.call(nr,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:Ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof pa&&Aa(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let Ai;var fu={get paint(){return Ai=Ai||new Li({"raster-opacity":new Bt(Ne.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bt(Ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bt(Ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bt(Ne.paint_raster["raster-brightness-max"]),"raster-saturation":new Bt(Ne.paint_raster["raster-saturation"]),"raster-contrast":new Bt(Ne.paint_raster["raster-contrast"]),"raster-resampling":new Bt(Ne.paint_raster["raster-resampling"]),"raster-fade-duration":new Bt(Ne.paint_raster["raster-fade-duration"])})}};class Qs extends vi{constructor(e,n){super(e,fu,n)}}const yn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Nn{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function pi(i,e=1){let n=0,o=0;return{members:i.map((u=>{const p=yn[u.type].BYTES_PER_ELEMENT,g=n=Ia(n,Math.max(e,p)),x=u.components||1;return o=Math.max(o,p),n+=p*x,{name:u.name,type:u.type,components:x,offset:g}})),size:Ia(n,Math.max(o,e)),alignment:e}}function Ia(i,e){return Math.ceil(i/e)*e}class Wa extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=o,e}}Wa.prototype.bytesPerElement=4,Rt("StructArrayLayout2i4",Wa);class dl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=u,e}}dl.prototype.bytesPerElement=6,Rt("StructArrayLayout3i6",dl);class fl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,u)}emplace(e,n,o,u,p){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=u,this.int16[g+3]=p,e}}fl.prototype.bytesPerElement=8,Rt("StructArrayLayout4i8",fl);class Js extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=u,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=x,e}}Js.prototype.bytesPerElement=12,Rt("StructArrayLayout2i4i12",Js);class gd extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=4*e,C=8*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.uint8[C+4]=u,this.uint8[C+5]=p,this.uint8[C+6]=g,this.uint8[C+7]=x,e}}gd.prototype.bytesPerElement=8,Rt("StructArrayLayout2i4ub8",gd);class li extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=o,e}}li.prototype.bytesPerElement=8,Rt("StructArrayLayout2f8",li);class Qa extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I){const L=this.length;return this.resize(L+1),this.emplace(L,e,n,o,u,p,g,x,T,C,I)}emplace(e,n,o,u,p,g,x,T,C,I,L){const B=10*e;return this.uint16[B+0]=n,this.uint16[B+1]=o,this.uint16[B+2]=u,this.uint16[B+3]=p,this.uint16[B+4]=g,this.uint16[B+5]=x,this.uint16[B+6]=T,this.uint16[B+7]=C,this.uint16[B+8]=I,this.uint16[B+9]=L,e}}Qa.prototype.bytesPerElement=20,Rt("StructArrayLayout10ui20",Qa);class sc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,o,u,p,g,x,T)}emplace(e,n,o,u,p,g,x,T,C){const I=8*e;return this.uint16[I+0]=n,this.uint16[I+1]=o,this.uint16[I+2]=u,this.uint16[I+3]=p,this.uint16[I+4]=g,this.uint16[I+5]=x,this.uint16[I+6]=T,this.uint16[I+7]=C,e}}sc.prototype.bytesPerElement=16,Rt("StructArrayLayout8ui16",sc);class oc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,u,p,g,x,T,C,I,L,B)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F){const q=12*e;return this.int16[q+0]=n,this.int16[q+1]=o,this.int16[q+2]=u,this.int16[q+3]=p,this.uint16[q+4]=g,this.uint16[q+5]=x,this.uint16[q+6]=T,this.uint16[q+7]=C,this.int16[q+8]=I,this.int16[q+9]=L,this.int16[q+10]=B,this.int16[q+11]=F,e}}oc.prototype.bytesPerElement=24,Rt("StructArrayLayout4i4ui4i24",oc);class pu extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,e}}pu.prototype.bytesPerElement=12,Rt("StructArrayLayout3f12",pu);class mu extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}mu.prototype.bytesPerElement=4,Rt("StructArrayLayout1ul4",mu);class gu extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,o,u,p,g,x,T,C)}emplace(e,n,o,u,p,g,x,T,C,I){const L=10*e,B=5*e;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=u,this.int16[L+3]=p,this.int16[L+4]=g,this.int16[L+5]=x,this.uint32[B+3]=T,this.uint16[L+8]=C,this.uint16[L+9]=I,e}}gu.prototype.bytesPerElement=20,Rt("StructArrayLayout6i1ul2ui20",gu);class Do extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=u,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=x,e}}Do.prototype.bytesPerElement=12,Rt("StructArrayLayout2i2i2i12",Do);class eo extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,u,p)}emplace(e,n,o,u,p,g){const x=4*e,T=8*e;return this.float32[x+0]=n,this.float32[x+1]=o,this.float32[x+2]=u,this.int16[T+6]=p,this.int16[T+7]=g,e}}eo.prototype.bytesPerElement=16,Rt("StructArrayLayout2f1f2i16",eo);class gr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=16*e,C=4*e,I=8*e;return this.uint8[T+0]=n,this.uint8[T+1]=o,this.float32[C+1]=u,this.float32[C+2]=p,this.int16[I+6]=g,this.int16[I+7]=x,e}}gr.prototype.bytesPerElement=16,Rt("StructArrayLayout2ub2f2i16",gr);class mi extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=u,e}}mi.prototype.bytesPerElement=6,Rt("StructArrayLayout3ui6",mi);class Is extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,X,J){const he=this.length;return this.resize(he+1),this.emplace(he,e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,X,J)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,X,J,he){const ee=24*e,ae=12*e,ge=48*e;return this.int16[ee+0]=n,this.int16[ee+1]=o,this.uint16[ee+2]=u,this.uint16[ee+3]=p,this.uint32[ae+2]=g,this.uint32[ae+3]=x,this.uint32[ae+4]=T,this.uint16[ee+10]=C,this.uint16[ee+11]=I,this.uint16[ee+12]=L,this.float32[ae+7]=B,this.float32[ae+8]=F,this.uint8[ge+36]=q,this.uint8[ge+37]=G,this.uint8[ge+38]=X,this.uint32[ae+10]=J,this.int16[ee+22]=he,e}}Is.prototype.bytesPerElement=48,Rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Is);class pl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,X,J,he,ee,ae,ge,be,je,ot,Ke,ft,zt,gt){const et=this.length;return this.resize(et+1),this.emplace(et,e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,X,J,he,ee,ae,ge,be,je,ot,Ke,ft,zt,gt)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,X,J,he,ee,ae,ge,be,je,ot,Ke,ft,zt,gt,et){const Ze=32*e,Nt=16*e;return this.int16[Ze+0]=n,this.int16[Ze+1]=o,this.int16[Ze+2]=u,this.int16[Ze+3]=p,this.int16[Ze+4]=g,this.int16[Ze+5]=x,this.int16[Ze+6]=T,this.int16[Ze+7]=C,this.uint16[Ze+8]=I,this.uint16[Ze+9]=L,this.uint16[Ze+10]=B,this.uint16[Ze+11]=F,this.uint16[Ze+12]=q,this.uint16[Ze+13]=G,this.uint16[Ze+14]=X,this.uint16[Ze+15]=J,this.uint16[Ze+16]=he,this.uint16[Ze+17]=ee,this.uint16[Ze+18]=ae,this.uint16[Ze+19]=ge,this.uint16[Ze+20]=be,this.uint16[Ze+21]=je,this.uint16[Ze+22]=ot,this.uint32[Nt+12]=Ke,this.float32[Nt+13]=ft,this.float32[Nt+14]=zt,this.uint16[Ze+30]=gt,this.uint16[Ze+31]=et,e}}pl.prototype.bytesPerElement=64,Rt("StructArrayLayout8i15ui1ul2f2ui64",pl);class ml extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}ml.prototype.bytesPerElement=4,Rt("StructArrayLayout1f4",ml);class lc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.uint16[6*e+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,e}}lc.prototype.bytesPerElement=12,Rt("StructArrayLayout1ui2f12",lc);class Ja extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=4*e;return this.uint32[2*e+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=u,e}}Ja.prototype.bytesPerElement=8,Rt("StructArrayLayout1ul2ui8",Ja);class y extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,e}}y.prototype.bytesPerElement=4,Rt("StructArrayLayout2ui4",y);class t extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,Rt("StructArrayLayout1ui2",t);class a extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,u)}emplace(e,n,o,u,p){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=u,this.float32[g+3]=p,e}}a.prototype.bytesPerElement=16,Rt("StructArrayLayout4f16",a);class c extends Nn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class f extends gu{get(e){return new c(this,e)}}Rt("CollisionBoxArray",f);class v extends Nn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}v.prototype.size=48;class w extends Is{get(e){return new v(this,e)}}Rt("PlacedSymbolArray",w);class E extends Nn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}E.prototype.size=64;class D extends pl{get(e){return new E(this,e)}}Rt("SymbolInstanceArray",D);class R extends ml{getoffsetX(e){return this.float32[1*e+0]}}Rt("GlyphOffsetArray",R);class O extends dl{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Rt("SymbolLineVertexArray",O);class U extends Nn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}U.prototype.size=12;class j extends lc{get(e){return new U(this,e)}}Rt("TextAnchorOffsetArray",j);class Z extends Nn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Z.prototype.size=8;class W extends Ja{get(e){return new Z(this,e)}}Rt("FeatureIndexArray",W);class se extends Wa{}class le extends Wa{}class oe extends Wa{}class ue extends Js{}class xe extends gd{}class ce extends li{}class _e extends Qa{}class Se extends sc{}class me extends oc{}class Ce extends pu{}class qe extends mu{}class Fe extends Do{}class Ue extends gr{}class Ve extends mi{}class wt extends y{}const St=pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:dt}=St;class Ct{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,o,u){const p=this.segments[this.segments.length-1];return e>Ct.MAX_VERTEX_ARRAY_LENGTH&&zn(`Max vertices per segment is ${Ct.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ct.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>Ct.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u?this.createNewSegment(n,o,u):p}createNewSegment(e,n,o){const u={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,n,o){return this.prepareSegment(0,e,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,u){return new Ct([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function an(i,e){return 256*(i=Xt(Math.floor(i),0,255))+Xt(Math.floor(e),0,255)}Ct.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt("SegmentVector",Ct);const Fn=pi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ii=pi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Qn,ci,Zn,xi={exports:{}},ui={exports:{}},sr={exports:{}},Ci=(function(){if(Zn)return xi.exports;Zn=1;var i=(Qn||(Qn=1,ui.exports=function(n,o){var u,p,g,x,T,C,I,L;for(p=n.length-(u=3&n.length),g=o,T=3432918353,C=461845907,L=0;L<p;)I=255&n.charCodeAt(L)|(255&n.charCodeAt(++L))<<8|(255&n.charCodeAt(++L))<<16|(255&n.charCodeAt(++L))<<24,++L,g=27492+(65535&(x=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*C+(((I>>>16)*C&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,u){case 3:I^=(255&n.charCodeAt(L+2))<<16;case 2:I^=(255&n.charCodeAt(L+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&n.charCodeAt(L)))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*C+(((I>>>16)*C&65535)<<16)&4294967295}return g^=n.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),ui.exports),e=(ci||(ci=1,sr.exports=function(n,o){for(var u,p=n.length,g=o^p,x=0;p>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(x)|(255&n.charCodeAt(++x))<<8|(255&n.charCodeAt(++x))<<16|(255&n.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:g^=(255&n.charCodeAt(x+2))<<16;case 2:g^=(255&n.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&n.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),sr.exports);return xi.exports=i,xi.exports.murmur3=i,xi.exports.murmur2=e,xi.exports})(),zi=K(Ci);class or{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,u){this.ids.push(ks(e)),this.positions.push(n,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=ks(e);let o=0,u=this.ids.length-1;for(;o<u;){const g=o+u>>1;this.ids[g]>=n?u=g:o=g+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(e,n){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Rs(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const n=new or;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function ks(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:zi(String(i))}function Rs(i,e,n,o){for(;n<o;){const u=i[n+o>>1];let p=n-1,g=o+1;for(;;){do p++;while(i[p]<u);do g--;while(i[g]>u);if(p>=g)break;es(i,p,g),es(e,3*p,3*g),es(e,3*p+1,3*g+1),es(e,3*p+2,3*g+2)}g-n<o-g?(Rs(i,e,n,g),n=g+1):(Rs(i,e,g+1,o),o=g)}}function es(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}Rt("FeaturePositionMap",or);class $r{constructor(e,n){this.gl=e.gl,this.location=n}}class gl extends $r{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class cc extends $r{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ts extends $r{constructor(e,n){super(e,n),this.current=dn.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Xr=new Float32Array(16);function ma(i){return[an(255*i.r,255*i.g),an(255*i.b,255*i.a)]}class ka{constructor(e,n,o){this.value=e,this.uniformNames=n.map((u=>`u_${u}`)),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new ts(e,n):new gl(e,n)}}class Ra{constructor(e,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,o,u){let p=null;u==="u_pattern_to"?p=this.patternTo:u==="u_pattern_from"?p=this.patternFrom:u==="u_dasharray_to"?p=this.dashTo:u==="u_dasharray_from"?p=this.dashFrom:u==="u_pixel_ratio_to"?p=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&e.set(p)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new cc(e,n):new gl(e,n)}}class Un{constructor(e,n,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,n,o){const u=this.paintVertexArray.length,p=this.expression.evaluate(new jn(0,o),n,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,p)}updatePaintArray(e,n,o,u,p){const g=this.expression.evaluate(new jn(0,p),o,u);this._setPaintValue(e,n,g)}_setPaintValue(e,n,o){if(this.type==="color"){const u=ma(o);for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jn{constructor(e,n,o,u,p,g){this.expression=e,this.uniformNames=n.map((x=>`u_${x}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map((x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(e,n,o){const u=this.expression.evaluate(new jn(this.zoom,o),n,{},o.canonical,[],o.formattedSection),p=this.expression.evaluate(new jn(this.zoom+1,o),n,{},o.canonical,[],o.formattedSection),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,u,p)}updatePaintArray(e,n,o,u,p){const g=this.expression.evaluate(new jn(this.zoom,p),o,u),x=this.expression.evaluate(new jn(this.zoom+1,p),o,u);this._setPaintValue(e,n,g,x)}_setPaintValue(e,n,o,u){if(this.type==="color"){const p=ma(o),g=ma(u);for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,p[0],p[1],g[0],g[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=Xt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,n,o){return new gl(e,n)}}class Ui{constructor(e,n,o,u,p,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=g,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(n),o)}updatePaintArray(e,n,o,u,p){this._setPaintValues(e,n,this.getPositionIds(o),p)}_setPaintValues(e,n,o,u){const p=this.getPositions(u);if(!p||!o)return;const g=p[o.min],x=p[o.mid],T=p[o.max];if(g&&x&&T)for(let C=e;C<n;C++)this.emplace(this.zoomInPaintVertexArray,C,x,g),this.emplace(this.zoomOutPaintVertexArray,C,x,T)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $i extends Ui{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Fn.members}emplace(e,n,o,u){e.emplace(n,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class mh extends Ui{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return ii.members}emplace(e,n,o,u){e.emplace(n,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class gh{constructor(e,n,o){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!o(p))continue;const g=e.paint.get(p);if(!(g instanceof pa&&Aa(g.property.specification)))continue;const x=Bf(p,e.type),T=g.value,C=g.property.specification.type,I=g.property.useIntegerZoom,L=g.property.specification["property-type"],B=L==="cross-faded"||L==="cross-faded-data-driven";if(T.kind==="constant")this.binders[p]=B?new Ra(T.value,x):new ka(T.value,x,C),u.push(`/u_${p}`);else if(T.kind==="source"||B){const F=Io(p,C,"source");this.binders[p]=B?p==="line-dasharray"?new mh(T,C,I,n,F,e.id):new $i(T,C,I,n,F,e.id):new Un(T,x,C,F),u.push(`/a_${p}`)}else{const F=Io(p,C,"composite");this.binders[p]=new Jn(T,x,C,I,n,F),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Un||n instanceof Jn?n.maxValue:0}populatePaintArrays(e,n,o){for(const u in this.binders){const p=this.binders[u];(p instanceof Un||p instanceof Jn||p instanceof Ui)&&p.populatePaintArray(e,n,o)}}setConstantPatternPositions(e,n){for(const o in this.binders){const u=this.binders[o];u instanceof Ra&&u.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const o in this.binders){const u=this.binders[o];u instanceof Ra&&u.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,o,u,p){let g=!1;for(const x in e){const T=n.getPositions(x);for(const C of T){const I=o.feature(C.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof Un||B instanceof Jn||B instanceof Ui)&&B.expression.isStateDependent===!0){const F=u.paint.get(L);B.expression=F.value,B.updatePaintArray(C.start,C.end,I,e[x],p),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof ka||o instanceof Ra)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Un||o instanceof Jn)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof Ui){const u=o.getVertexAttributes();for(const p of u)e.push(p.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ka||o instanceof Ra||o instanceof Jn)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof ka||p instanceof Ra||p instanceof Jn){for(const g of p.uniformNames)if(n[g]){const x=p.getBinding(e,n[g],g);o.push({name:g,property:u,binding:x})}}}return o}setUniforms(e,n,o,u){for(const{name:p,property:g,binding:x}of n)this.binders[g].setUniform(x,u,o.get(g),p)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof Ui){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Un||o instanceof Jn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof Un||o instanceof Jn||o instanceof Ui)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Un||n instanceof Jn||n instanceof Ui)&&n.destroy()}}}class Po{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new gh(u,n,o);this.needsUpload=!1,this._featureMap=new or,this._bufferOffset=0}populatePaintArrays(e,n,o,u){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,u);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,n,p,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Bf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Io(i,e,n){const o={color:{source:li,composite:a},number:{source:ml,composite:li}},u=(function(p){return{"line-pattern":{source:_e,composite:_e},"fill-pattern":{source:_e,composite:_e},"fill-extrusion-pattern":{source:_e,composite:_e},"line-dasharray":{source:Se,composite:Se}}[p]})(i);return u&&u[n]||o[e][n]}Rt("ConstantBinder",ka),Rt("CrossFadedConstantBinder",Ra),Rt("SourceExpressionBinder",Un),Rt("CrossFadedPatternBinder",$i),Rt("CrossFadedDasharrayBinder",mh),Rt("CompositeExpressionBinder",Jn),Rt("ProgramConfiguration",gh,{omit:["_buffers"]}),Rt("ProgramConfigurationSet",Po);const yh=Math.pow(2,14)-1,to=-yh-1;function no(i){const e=_t/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let p=0;p<u.length;p++){const g=u[p],x=Math.round(g.x*e),T=Math.round(g.y*e);g.x=Xt(x,to,yh),g.y=Xt(T,to,yh),(x<g.x||x>g.x+1||T<g.y||T>g.y+1)&&zn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ns(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?no(i):[]}}const _h=-32768;function yu(i,e,n,o,u){i.emplaceBack(_h+8*e+o,_h+8*n+u)}class _u{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new le,this.indexArray=new Ve,this.segments=new Ct,this.programConfigurations=new Po(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){const u=this.layers[0],p=[];let g=null,x=!1,T=u.type==="heatmap";if(u.type==="circle"){const I=u;g=I.layout.get("circle-sort-key"),x=!g.isConstant(),T=T||I.paint.get("circle-pitch-alignment")==="map"}const C=T?n.subdivisionGranularity.circle:1;for(const{feature:I,id:L,index:B,sourceLayerIndex:F}of e){const q=this.layers[0]._featureFilter.needGeometry,G=ns(I,q);if(!this.layers[0]._featureFilter.filter(new jn(this.zoom),G,o))continue;const X=x?g.evaluate(G,{},o):void 0,J={id:L,properties:I.properties,type:I.type,sourceLayerIndex:F,index:B,geometry:q?G.geometry:no(I),patterns:{},sortKey:X};p.push(J)}x&&p.sort(((I,L)=>I.sortKey-L.sortKey));for(const I of p){const{geometry:L,index:B,sourceLayerIndex:F}=I,q=e[B].feature;this.addFeature(I,L,B,o,C),n.featureIndex.insert(q,L,B,F,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,u,p=1){let g;switch(p){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const x=g.length;for(const T of n)for(const C of T){const I=C.x,L=C.y;if(I<0||I>=_t||L<0||L>=_t)continue;const B=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,e.sortKey),F=B.vertexLength;for(let q=0;q<x;q++)for(let G=0;G<x;G++)yu(this.layoutVertexArray,I,L,g[G],g[q]);for(let q=0;q<x-1;q++)for(let G=0;G<x-1;G++){const X=F+q*x+G,J=F+(q+1)*x+G;this.indexArray.emplaceBack(X,J+1,X+1),this.indexArray.emplaceBack(X,J,J+1)}B.vertexLength+=x*x,B.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function vu(i,e){for(let n=0;n<i.length;n++)if(ko(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(ko(i,e[n]))return!0;return!!yr(i,e)}function Nf(i,e,n){return!!ko(i,e)||!!jf(e,i,n)}function Ff(i,e){if(i.length===1)return tm(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let u=0;u<o.length;u++)if(ko(i,o[u]))return!0}for(let n=0;n<i.length;n++)if(tm(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(yr(i,e[n]))return!0;return!1}function lr(i,e,n){if(i.length>1){if(yr(i,e))return!0;for(let o=0;o<e.length;o++)if(jf(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(jf(i[o],e,n))return!0;return!1}function yr(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],u=i[n+1];for(let p=0;p<e.length-1;p++)if(pg(o,u,e[p],e[p+1]))return!0}return!1}function pg(i,e,n,o){return wi(i,n,o)!==wi(e,n,o)&&wi(i,e,n)!==wi(i,e,o)}function jf(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(em(i,e[u-1],e[u])<o)return!0;return!1}function em(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const u=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function tm(i,e){let n,o,u,p=!1;for(let g=0;g<i.length;g++){n=i[g];for(let x=0,T=n.length-1;x<n.length;T=x++)o=n[x],u=n[T],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(p=!p)}return p}function ko(i,e){let n=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const p=i[o],g=i[u];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(n=!n)}return n}function mg(i,e,n){const o=n[0],u=n[2];if(i.x<o.x&&e.x<o.x||i.x>u.x&&e.x>u.x||i.y<o.y&&e.y<o.y||i.y>u.y&&e.y>u.y)return!1;const p=wi(i,e,n[0]);return p!==wi(i,e,n[1])||p!==wi(i,e,n[2])||p!==wi(i,e,n[3])}function yl(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function yd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Uf(i,e,n,o,u){if(!e[0]&&!e[1])return i;const p=N.convert(e)._mult(u);n==="viewport"&&p._rotate(-o);const g=[];for(let x=0;x<i.length;x++)g.push(i[x].sub(p));return g}function Vf(i){const e=[];for(let n=0;n<i.length;n++){const o=i[n],u=e.at(-1);(n===0||u&&!o.equals(u))&&e.push(o)}return e}function nm({queryGeometry:i,size:e},n){return Nf(i,n,e)}function gg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){return Nf(i,p,e*(n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera/n.cameraToCenterDistance))}function yg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){const g=n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera,x=e*(n.cameraToCenterDistance/g);return Nf(i,_d(p,n,o,u),x)}function _g({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){return Nf(i,_d(p,n,o,u),e)}function qf({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u,pitchAlignment:p="map",pitchScale:g="map"},x){const T=p==="map"?g==="map"?nm:gg:g==="map"?yg:_g,C={queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u};for(const I of x)for(const L of I)if(T(C,L))return!0;return!1}function _d(i,e,n,o){const u=e.projectTileCoordinates(i.x,i.y,n,o).point;return new N((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let Gf,im;Rt("CircleBucket",_u,{omit:["layers"]});var rm={get paint(){return im=im||new Li({"circle-radius":new qt(Ne.paint_circle["circle-radius"]),"circle-color":new qt(Ne.paint_circle["circle-color"]),"circle-blur":new qt(Ne.paint_circle["circle-blur"]),"circle-opacity":new qt(Ne.paint_circle["circle-opacity"]),"circle-translate":new Bt(Ne.paint_circle["circle-translate"]),"circle-translate-anchor":new Bt(Ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bt(Ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bt(Ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qt(Ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qt(Ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qt(Ne.paint_circle["circle-stroke-opacity"])})},get layout(){return Gf=Gf||new Li({"circle-sort-key":new qt(Ne.layout_circle["circle-sort-key"])})}};class Zf extends vi{constructor(e,n){super(e,rm,n)}createBucket(e){return new _u(e)}queryRadius(e){const n=e;return yl("circle-radius",this,n)+yl("circle-stroke-width",this,n)+yd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,unwrappedTileID:x,getElevation:T}){const C=Uf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,g),I=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),L=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let F,q;return B==="map"?(F=C,q=I*g):(F=(function(G,X,J,he){return G.map((ee=>_d(ee,X,J,he)))})(C,p,x,T),q=I),qf({queryGeometry:F,size:q,transform:p,unwrappedTileID:x,getElevation:T,pitchAlignment:B,pitchScale:L},u)}}class Hf extends _u{}let am;Rt("HeatmapBucket",Hf,{omit:["layers"]});var sm={get paint(){return am=am||new Li({"heatmap-radius":new qt(Ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qt(Ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bt(Ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new du(Ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bt(Ne.paint_heatmap["heatmap-opacity"])})}};function $f(i,{width:e,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*n*o}`)}else u=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=u,i}function Ro(i,{width:e,height:n},o){if(e===i.width&&n===i.height)return;const u=$f({},{width:e,height:n},o);vd(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},o),i.width=e,i.height=n,i.data=u.data}function vd(i,e,n,o,u,p){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,x=e.data;if(g===x)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<u.height;T++){const C=((n.y+T)*i.width+n.x)*p,I=((o.y+T)*e.width+o.x)*p;for(let L=0;L<u.width*p;L++)x[I+L]=g[C+L]}return e}class xd{constructor(e,n){$f(this,e,1,n)}resize(e){Ro(this,e,1)}clone(){return new xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,u,p){vd(e,n,o,u,p,1)}}class Yr{constructor(e,n){$f(this,e,4,n)}resize(e){Ro(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Yr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,u,p){vd(e,n,o,u,p,4)}setPixel(e,n,o){const u=4*(e*this.width+n);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function Lo(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new Yr({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(g,x,T)=>{e[i.evaluationKey]=T;const C=i.expression.evaluate(e);u.setPixel(g/4/n,x/4,C)};if(i.clips)for(let g=0,x=0;g<o;++g,x+=4*n)for(let T=0,C=0;T<n;T++,C+=4){const I=T/(n-1),{start:L,end:B}=i.clips[g];p(x,C,L*(1-I)+B*I)}else for(let g=0,x=0;g<n;g++,x+=4)p(0,x,g/(n-1));return u}Rt("AlphaImage",xd),Rt("RGBAImage",Yr);const bd="big-fb";class vg extends vi{createBucket(e){return new Hf(e)}constructor(e,n){super(e,sm,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(bd)&&this.heatmapFbos.delete(bd)}queryRadius(e){return yl("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,unwrappedTileID:x,getElevation:T}){return qf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,o)*g,transform:p,unwrappedTileID:x,getElevation:T},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let wd;var Td={get paint(){return wd=wd||new Li({"hillshade-illumination-direction":new Bt(Ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Bt(Ne.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Bt(Ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bt(Ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bt(Ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bt(Ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bt(Ne.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Bt(Ne.paint_hillshade["hillshade-method"])})}};class Di extends vi{constructor(e,n){super(e,Td,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,n.length,o.length,u.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),n=n.concat(Array(p-n.length).fill(n.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),u=u.concat(Array(p-u.length).fill(u.at(-1)));const g=n.map(Ti);return{directionRadians:e.map(Ti),altitudeRadians:g,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let xg;var Ky={get paint(){return xg=xg||new Li({"color-relief-opacity":new Bt(Ne["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new du(Ne["paint_color-relief"]["color-relief-color"])})}};class Xf{constructor(e,n,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,o){const{width:u,height:p}=e,g=!(this.size&&this.size[0]===u&&this.size[1]===p||o),{context:x}=this,{gl:T}=x;if(this.useMipmap=!!(n&&n.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),g)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||na(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:C,y:I}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||na(e)?T.texSubImage2D(T.TEXTURE_2D,0,C,I,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,C,I,u,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||e),this.filter=e),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class vh{constructor(e,n,o,u=1,p=1,g=1,x=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void zn(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=g,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<T;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(T,C)]=this.data[this._idx(T-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,T)]=this.data[this._idx(C,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<T;C++)for(let I=0;I<T;I++){const L=this.get(C,I);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(e,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return _l(e,this.getUnpackVector())}getPixels(){return new Yr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,p=n*this.dim+this.dim,g=o*this.dim,x=o*this.dim+this.dim;switch(n){case-1:u=p-1;break;case 1:p=u+1}switch(o){case-1:g=x-1;break;case 1:x=g+1}const T=-n*this.dim,C=-o*this.dim;for(let I=g;I<x;I++)for(let L=u;L<p;L++)this.data[this._idx(L,I)]=e.data[this._idx(L+T,I+C)]}}function _l(i,e){const n=e[0],o=e[1],u=e[2],p=e[3],g=Math.min(n,o,u),x=Math.round((i+p)/g);return{r:Math.floor(x*g/n)%256,g:Math.floor(x*g/o)%256,b:Math.floor(x*g/u)%256}}Rt("DEMData",vh);class bg extends vi{constructor(e,n){super(e,Ky,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Fr&&o._styleExpression.expression instanceof Br){this.colorRampExpression=o;const g=o._styleExpression.expression;n.elevationStops=g.labels,n.colorStops=[];for(const x of n.elevationStops)n.colorStops.push(g.evaluate({globals:{elevation:x}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[dn.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const u={elevationStops:[],colorStops:[]},p=(n.elevationStops.length-1)/(e-1);for(let g=0;g<n.elevationStops.length-.5;g+=p)u.elevationStops.push(n.elevationStops[Math.round(g)]),u.colorStops.push(n.colorStops[Math.round(g)]);return zn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),p=new Yr({width:u.colorStops.length,height:1}),g=new Yr({width:u.colorStops.length,height:1});for(let x=0;x<u.elevationStops.length;x++){const T=_l(u.elevationStops[x],o);g.setPixel(0,x,new dn(T.r/255,T.g/255,T.b/255,1)),p.setPixel(0,x,u.colorStops[x])}return this.colorRampTextures={elevationTexture:new Xf(e,g,e.gl.RGBA),colorTexture:new Xf(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const wg=pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sd}=wg;function is(i,e,n){const o=n.patternDependencies;let u=!1;for(const p of e){const g=p.paint.get(`${i}-pattern`);g.isConstant()||(u=!0);const x=g.constantOr(null);x&&(u=!0,o[x.to]=!0,o[x.from]=!0)}return u}function Yf(i,e,n,o,u){const{zoom:p}=o,g=u.patternDependencies;for(const x of e){const T=x.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:p-1},n,{},u.availableImages),I=T.evaluate({zoom:p},n,{},u.availableImages),L=T.evaluate({zoom:p+1},n,{},u.availableImages);C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,g[C]=!0,g[I]=!0,g[L]=!0,n.patterns[x.id]={min:C,mid:I,max:L}}}return n}function Kf(i,e,n,o,u){let p;if(u===(function(g,x,T,C){let I=0;for(let L=x,B=T-C;L<T;L+=C)I+=(g[B]-g[L])*(g[L+1]+g[B+1]),B=L;return I})(i,e,n,o)>0)for(let g=e;g<n;g+=o)p=ga(g/o|0,i[g],i[g+1],p);else for(let g=n-o;g>=e;g-=o)p=ga(g/o|0,i[g],i[g+1],p);return p&&La(p,p.next)&&(ya(p),p=p.next),p}function uc(i,e){if(!i)return i;e||(e=i);let n,o=i;do if(n=!1,o.steiner||!La(o,o.next)&&On(o.prev,o,o.next)!==0)o=o.next;else{if(ya(o),o=e=o.prev,o===o.next)break;n=!0}while(n||o!==e);return e}function xu(i,e,n,o,u,p,g){if(!i)return;!g&&p&&(function(T,C,I,L){let B=T;do B.z===0&&(B.z=ur(B.x,B.y,C,I,L)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==T);B.prevZ.nextZ=null,B.prevZ=null,(function(F){let q,G=1;do{let X,J=F;F=null;let he=null;for(q=0;J;){q++;let ee=J,ae=0;for(let be=0;be<G&&(ae++,ee=ee.nextZ,ee);be++);let ge=G;for(;ae>0||ge>0&&ee;)ae!==0&&(ge===0||!ee||J.z<=ee.z)?(X=J,J=J.nextZ,ae--):(X=ee,ee=ee.nextZ,ge--),he?he.nextZ=X:F=X,X.prevZ=he,he=X;J=ee}he.nextZ=null,G*=2}while(q>1)})(B)})(i,o,u,p);let x=i;for(;i.prev!==i.next;){const T=i.prev,C=i.next;if(p?Wf(i,o,u,p):om(i))e.push(T.i,i.i,C.i),ya(i),i=C.next,x=C.next;else if((i=C)===x){g?g===1?xu(i=Tg(uc(i),e),e,n,o,u,p,2):g===2&&vl(i,e,n,o,u,p):xu(uc(i),e,n,o,u,p,1);break}}}function om(i){const e=i.prev,n=i,o=i.next;if(On(e,n,o)>=0)return!1;const u=e.x,p=n.x,g=o.x,x=e.y,T=n.y,C=o.y,I=Math.min(u,p,g),L=Math.min(x,T,C),B=Math.max(u,p,g),F=Math.max(x,T,C);let q=o.next;for(;q!==e;){if(q.x>=I&&q.x<=B&&q.y>=L&&q.y<=F&&xh(u,x,p,T,g,C,q.x,q.y)&&On(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function Wf(i,e,n,o){const u=i.prev,p=i,g=i.next;if(On(u,p,g)>=0)return!1;const x=u.x,T=p.x,C=g.x,I=u.y,L=p.y,B=g.y,F=Math.min(x,T,C),q=Math.min(I,L,B),G=Math.max(x,T,C),X=Math.max(I,L,B),J=ur(F,q,e,n,o),he=ur(G,X,e,n,o);let ee=i.prevZ,ae=i.nextZ;for(;ee&&ee.z>=J&&ae&&ae.z<=he;){if(ee.x>=F&&ee.x<=G&&ee.y>=q&&ee.y<=X&&ee!==u&&ee!==g&&xh(x,I,T,L,C,B,ee.x,ee.y)&&On(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ae.x>=F&&ae.x<=G&&ae.y>=q&&ae.y<=X&&ae!==u&&ae!==g&&xh(x,I,T,L,C,B,ae.x,ae.y)&&On(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ee&&ee.z>=J;){if(ee.x>=F&&ee.x<=G&&ee.y>=q&&ee.y<=X&&ee!==u&&ee!==g&&xh(x,I,T,L,C,B,ee.x,ee.y)&&On(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ae&&ae.z<=he;){if(ae.x>=F&&ae.x<=G&&ae.y>=q&&ae.y<=X&&ae!==u&&ae!==g&&xh(x,I,T,L,C,B,ae.x,ae.y)&&On(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function Tg(i,e){let n=i;do{const o=n.prev,u=n.next.next;!La(o,u)&&um(o,n,n.next,u)&&Ad(o,u)&&Ad(u,o)&&(e.push(o.i,n.i,u.i),ya(n),ya(n.next),n=i=u),n=n.next}while(n!==i);return uc(n)}function vl(i,e,n,o,u,p){let g=i;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&Oi(g,x)){let T=Cd(g,x);return g=uc(g,g.next),T=uc(T,T.next),xu(g,e,n,o,u,p,0),void xu(T,e,n,o,u,p,0)}x=x.next}g=g.next}while(g!==i)}function cr(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function lm(i,e){const n=(function(u,p){let g=p;const x=u.x,T=u.y;let C,I=-1/0;if(La(u,g))return g;do{if(La(u,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){const G=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(G<=x&&G>I&&(I=G,C=g.x<g.next.x?g:g.next,G===x))return C}g=g.next}while(g!==p);if(!C)return null;const L=C,B=C.x,F=C.y;let q=1/0;g=C;do{if(x>=g.x&&g.x>=B&&x!==g.x&&cm(T<F?x:I,T,B,F,T<F?I:x,T,g.x,g.y)){const G=Math.abs(T-g.y)/(x-g.x);Ad(g,u)&&(G<q||G===q&&(g.x>C.x||g.x===C.x&&Sg(C,g)))&&(C=g,q=G)}g=g.next}while(g!==L);return C})(i,e);if(!n)return e;const o=Cd(n,i);return uc(o,o.next),uc(n,n.next)}function Sg(i,e){return On(i.prev,i,e.prev)<0&&On(e.next,i,i.next)<0}function ur(i,e,n,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wy(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function cm(i,e,n,o,u,p,g,x){return(u-g)*(e-x)>=(i-g)*(p-x)&&(i-g)*(o-x)>=(n-g)*(e-x)&&(n-g)*(p-x)>=(u-g)*(o-x)}function xh(i,e,n,o,u,p,g,x){return!(i===g&&e===x)&&cm(i,e,n,o,u,p,g,x)}function Oi(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&um(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1})(i,e)&&(Ad(i,e)&&Ad(e,i)&&(function(n,o){let u=n,p=!1;const g=(n.x+o.x)/2,x=(n.y+o.y)/2;do u.y>x!=u.next.y>x&&u.next.y!==u.y&&g<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==n);return p})(i,e)&&(On(i.prev,i,e.prev)||On(i,e.prev,e))||La(i,e)&&On(i.prev,i,i.next)>0&&On(e.prev,e,e.next)>0)}function On(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function La(i,e){return i.x===e.x&&i.y===e.y}function um(i,e,n,o){const u=Md(On(i,e,n)),p=Md(On(i,e,o)),g=Md(On(n,o,i)),x=Md(On(n,o,e));return u!==p&&g!==x||!(u!==0||!Ed(i,n,e))||!(p!==0||!Ed(i,o,e))||!(g!==0||!Ed(n,i,o))||!(x!==0||!Ed(n,e,o))}function Ed(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Md(i){return i>0?1:i<0?-1:0}function Ad(i,e){return On(i.prev,i,i.next)<0?On(i,e,i.next)>=0&&On(i,i.prev,e)>=0:On(i,e,i.prev)<0||On(i,i.next,e)<0}function Cd(i,e){const n=Qf(i.i,i.x,i.y),o=Qf(e.i,e.x,e.y),u=i.next,p=e.prev;return i.next=e,e.prev=i,n.next=u,u.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function ga(i,e,n,o){const u=Qf(i,e,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function ya(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Qf(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class _r{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class zd{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}zd.noSubdivision=new zd({fill:new _r(0,0),line:new _r(0,0),tile:new _r(0,0),stencil:new _r(0,0),circle:1}),Rt("SubdivisionGranularityExpression",_r),Rt("SubdivisionGranularitySetting",zd);const Oa=-32768,io=32767;class xl{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=_t/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(n),p=this._getKey(o,u);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,g),this._vertexBuffer.push(o,u),g}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,p){const g=[];for(let x=0;x<p.length;x+=3){const T=p[x],C=p[x+1],I=p[x+2],L=u[2*T],B=u[2*T+1];(u[2*C]-L)*(u[2*I+1]-B)-(u[2*C+1]-B)*(u[2*I]-L)>0?(g.push(T),g.push(I),g.push(C)):(g.push(T),g.push(C),g.push(I))}return g})(this._vertexBuffer,e);const n=[],o=e.length;for(let u=0;u<o;u+=3){const p=[e[u+0],e[u+1],e[u+2]],g=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let x=1/0,T=1/0,C=-1/0,I=-1/0;for(let G=0;G<3;G++){const X=g[2*G],J=g[2*G+1];x=Math.min(x,X),C=Math.max(C,X),T=Math.min(T,J),I=Math.max(I,J)}if(x===C||T===I)continue;const L=Math.floor(x/this._granularityCellSize),B=Math.ceil(C/this._granularityCellSize),F=Math.floor(T/this._granularityCellSize),q=Math.ceil(I/this._granularityCellSize);if(L!==B||F!==q)for(let G=F;G<q;G++){const X=this._scanlineGenerateVertexRingForCellRow(G,g,p);ro(this._vertexBuffer,X,n)}else n.push(...p)}return n}_scanlineGenerateVertexRingForCellRow(e,n,o){const u=e*this._granularityCellSize,p=u+this._granularityCellSize,g=[];for(let x=0;x<3;x++){const T=n[2*x],C=n[2*x+1],I=n[2*(x+1)%6],L=n[(2*(x+1)+1)%6],B=n[2*(x+2)%6],F=n[(2*(x+2)+1)%6],q=I-T,G=L-C,X=q===0,J=G===0,he=(u-C)/G,ee=(p-C)/G,ae=Math.min(he,ee),ge=Math.max(he,ee);if(!J&&(ae>=1||ge<=0)||J&&(C<u||C>p)){L>=u&&L<=p&&g.push(o[(x+1)%3]);continue}!J&&ae>0&&g.push(this._vertexToIndex(T+q*ae,C+G*ae));const be=T+q*Math.max(ae,0),je=T+q*Math.min(ge,1);X||this._generateIntraEdgeVertices(g,T,C,I,L,be,je),!J&&ge<1&&g.push(this._vertexToIndex(T+q*ge,C+G*ge)),(J||L>=u&&L<=p)&&g.push(o[(x+1)%3]),!J&&(L<=u||L>=p)&&this._generateInterEdgeVertices(g,T,C,I,L,B,F,je,u,p)}return g}_generateIntraEdgeVertices(e,n,o,u,p,g,x){const T=u-n,C=p-o,I=C===0,L=I?Math.min(n,u):Math.min(g,x),B=I?Math.max(n,u):Math.max(g,x),F=Math.floor(L/this._granularityCellSize)+1,q=Math.ceil(B/this._granularityCellSize)-1;if(I?n<u:g<x)for(let G=F;G<=q;G++){const X=G*this._granularityCellSize;e.push(this._vertexToIndex(X,o+C*(X-n)/T))}else for(let G=q;G>=F;G--){const X=G*this._granularityCellSize;e.push(this._vertexToIndex(X,o+C*(X-n)/T))}}_generateInterEdgeVertices(e,n,o,u,p,g,x,T,C,I){const L=p-o,B=g-u,F=x-p,q=(C-p)/F,G=(I-p)/F,X=Math.min(q,G),J=Math.max(q,G),he=u+B*X;let ee=Math.floor(Math.min(he,T)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(he,T)/this._granularityCellSize)-1,ge=T<he;const be=F===0;if(be&&(x===C||x===I))return;if(be||X>=1||J<=0){const ot=o-x,Ke=g+(n-g)*Math.min((C-x)/ot,(I-x)/ot);ee=Math.floor(Math.min(Ke,T)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(Ke,T)/this._granularityCellSize)-1,ge=T<Ke}const je=L>0?I:C;if(ge)for(let ot=ee;ot<=ae;ot++)e.push(this._vertexToIndex(ot*this._granularityCellSize,je));else for(let ot=ae;ot>=ee;ot--)e.push(this._vertexToIndex(ot*this._granularityCellSize,je))}_generateOutline(e){const n=[];for(const o of e){const u=bl(o,this._granularity,!0),p=this._pointArrayToIndices(u),g=[];for(let x=1;x<p.length;x++)g.push(p[x-1]),g.push(p[x]);n.push(g)}return n}_handlePoles(e){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(e,n,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const o=e[n+1];o===Oa&&(e[n+1]=-32767),o===io&&(e[n+1]=32766)}}_generatePoleQuad(e,n,o,u,p,g){u>p!=(g===Oa)?(e.push(n),e.push(o),e.push(this._vertexToIndex(u,g)),e.push(o),e.push(this._vertexToIndex(p,g)),e.push(this._vertexToIndex(u,g))):(e.push(o),e.push(n),e.push(this._vertexToIndex(u,g)),e.push(this._vertexToIndex(p,g)),e.push(o),e.push(this._vertexToIndex(u,g)))}_fillPoles(e,n,o){const u=this._vertexBuffer,p=_t,g=e.length;for(let x=2;x<g;x+=3){const T=e[x-2],C=e[x-1],I=e[x],L=u[2*T],B=u[2*T+1],F=u[2*C],q=u[2*C+1],G=u[2*I],X=u[2*I+1];n&&(B===0&&q===0&&this._generatePoleQuad(e,T,C,L,F,Oa),q===0&&X===0&&this._generatePoleQuad(e,C,I,F,G,Oa),X===0&&B===0&&this._generatePoleQuad(e,I,T,G,L,Oa)),o&&(B===p&&q===p&&this._generatePoleQuad(e,T,C,L,F,io),q===p&&X===p&&this._generatePoleQuad(e,C,I,F,G,io),X===p&&B===p&&this._generatePoleQuad(e,I,T,G,L,io))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(x){const T=[],C=[];for(const I of x)if(I.length!==0){I!==x[0]&&T.push(C.length/2);for(let L=0;L<I.length;L++)C.push(I[L].x),C.push(I[L].y)}return{flattened:C,holeIndices:T}})(e);let p;this._initializeVertices(o);try{const x=(function(C,I,L=2){const B=I&&I.length,F=B?I[0]*L:C.length;let q=Kf(C,0,F,L,!0);const G=[];if(!q||q.next===q.prev)return G;let X,J,he;if(B&&(q=(function(ee,ae,ge,be){const je=[];for(let ot=0,Ke=ae.length;ot<Ke;ot++){const ft=Kf(ee,ae[ot]*be,ot<Ke-1?ae[ot+1]*be:ee.length,be,!1);ft===ft.next&&(ft.steiner=!0),je.push(Wy(ft))}je.sort(cr);for(let ot=0;ot<je.length;ot++)ge=lm(je[ot],ge);return ge})(C,I,q,L)),C.length>80*L){X=C[0],J=C[1];let ee=X,ae=J;for(let ge=L;ge<F;ge+=L){const be=C[ge],je=C[ge+1];be<X&&(X=be),je<J&&(J=je),be>ee&&(ee=be),je>ae&&(ae=je)}he=Math.max(ee-X,ae-J),he=he!==0?32767/he:0}return xu(q,G,L,X,J,he,0),G})(o,u),T=this._convertIndices(o,x);p=this._subdivideTrianglesScanline(T)}catch(x){console.error(x)}let g=[];return n&&(g=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:g}}_convertIndices(e,n){const o=[];for(let u=0;u<n.length;u++)o.push(this._vertexToIndex(e[2*n[u]],e[2*n[u]+1]));return o}_pointArrayToIndices(e){const n=[];for(let o=0;o<e.length;o++){const u=e[o];n.push(this._vertexToIndex(u.x,u.y))}return n}}function Jf(i,e,n,o=!0){return new xl(n,e).subdividePolygonInternal(i,o)}function bl(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const o=i[0],u=i[i.length-1],p=n&&(o.x!==u.x||o.y!==u.y);if(e<2)return p?[...i,i[0]]:[...i];const g=Math.floor(_t/e),x=[];x.push(new N(i[0].x,i[0].y));const T=i.length,C=p?T:T-1;for(let I=0;I<C;I++){const L=i[I],B=I<T-1?i[I+1]:i[0],F=L.x,q=L.y,G=B.x,X=B.y,J=F!==G,he=q!==X;if(!J&&!he)continue;const ee=G-F,ae=X-q,ge=Math.abs(ee),be=Math.abs(ae);let je=F,ot=q;for(;;){const ft=ee>0?(Math.floor(je/g)+1)*g:(Math.ceil(je/g)-1)*g,zt=ae>0?(Math.floor(ot/g)+1)*g:(Math.ceil(ot/g)-1)*g,gt=Math.abs(je-ft),et=Math.abs(ot-zt),Ze=Math.abs(je-G),Nt=Math.abs(ot-X),Lt=J?gt/ge:Number.POSITIVE_INFINITY,Ut=he?et/be:Number.POSITIVE_INFINITY;if((Ze<=gt||!J)&&(Nt<=et||!he))break;if(Lt<Ut&&J||!he){je=ft,ot+=ae*Lt;const kt=new N(je,Math.round(ot));x[x.length-1].x===kt.x&&x[x.length-1].y===kt.y||x.push(kt)}else{je+=ee*Ut,ot=zt;const kt=new N(Math.round(je),ot);x[x.length-1].x===kt.x&&x[x.length-1].y===kt.y||x.push(kt)}}const Ke=new N(G,X);x[x.length-1].x===Ke.x&&x[x.length-1].y===Ke.y||x.push(Ke)}return x}function ro(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=i[2*e[0]];for(let T=1;T<e.length;T++){const C=i[2*e[T]];C<u&&(u=C,o=T)}const p=e.length;let g=o,x=(g+1)%p;for(;;){const T=g-1>=0?g-1:p-1,C=(x+1)%p,I=i[2*e[T]],L=i[2*e[C]],B=i[2*e[g]],F=i[2*e[g]+1],q=i[2*e[x]+1];let G=!1;if(I<L)G=!0;else if(I>L)G=!1;else{const X=q-F,J=-(i[2*e[x]]-B),he=F<q?1:-1;((I-B)*X+(i[2*e[T]+1]-F)*J)*he>((L-B)*X+(i[2*e[C]+1]-F)*J)*he&&(G=!0)}if(G){const X=e[T],J=e[g],he=e[x];X!==J&&X!==he&&J!==he&&n.push(he,J,X),g--,g<0&&(g=p-1)}else{const X=e[C],J=e[g],he=e[x];X!==J&&X!==he&&J!==he&&n.push(he,J,X),x++,x>=p&&(x=0)}if(T===C)break}}function hm(i,e,n,o,u,p,g,x,T){const C=u.length/2,I=g&&x&&T;if(C<Ct.MAX_VERTEX_ARRAY_LENGTH){const L=e.prepareSegment(C,n,o),B=L.vertexLength;for(let G=0;G<p.length;G+=3)o.emplaceBack(B+p[G],B+p[G+1],B+p[G+2]);let F,q;L.vertexLength+=C,L.primitiveLength+=p.length/3,I&&(q=g.prepareSegment(C,n,x),F=q.vertexLength,q.vertexLength+=C);for(let G=0;G<u.length;G+=2)i(u[G],u[G+1]);if(I)for(let G=0;G<T.length;G++){const X=T[G];for(let J=1;J<X.length;J+=2)x.emplaceBack(F+X[J-1],F+X[J]);q.primitiveLength+=X.length/2}}else(function(L,B,F,q,G,X){const J=[];for(let be=0;be<q.length/2;be++)J.push(-1);const he={count:0};let ee=0,ae=L.getOrCreateLatestSegment(B,F),ge=ae.vertexLength;for(let be=2;be<G.length;be+=3){const je=G[be-2],ot=G[be-1],Ke=G[be];let ft=J[je]<ee,zt=J[ot]<ee,gt=J[Ke]<ee;ae.vertexLength+((ft?1:0)+(zt?1:0)+(gt?1:0))>Ct.MAX_VERTEX_ARRAY_LENGTH&&(ae=L.createNewSegment(B,F),ee=he.count,ft=!0,zt=!0,gt=!0,ge=0);const et=Oo(J,q,X,he,je,ft,ae),Ze=Oo(J,q,X,he,ot,zt,ae),Nt=Oo(J,q,X,he,Ke,gt,ae);F.emplaceBack(ge+et-ee,ge+Ze-ee,ge+Nt-ee),ae.primitiveLength++}})(e,n,o,u,p,i),I&&(function(L,B,F,q,G,X){const J=[];for(let be=0;be<q.length/2;be++)J.push(-1);const he={count:0};let ee=0,ae=L.getOrCreateLatestSegment(B,F),ge=ae.vertexLength;for(let be=0;be<G.length;be++){const je=G[be];for(let ot=1;ot<G[be].length;ot+=2){const Ke=je[ot-1],ft=je[ot];let zt=J[Ke]<ee,gt=J[ft]<ee;ae.vertexLength+((zt?1:0)+(gt?1:0))>Ct.MAX_VERTEX_ARRAY_LENGTH&&(ae=L.createNewSegment(B,F),ee=he.count,zt=!0,gt=!0,ge=0);const et=Oo(J,q,X,he,Ke,zt,ae),Ze=Oo(J,q,X,he,ft,gt,ae);F.emplaceBack(ge+et-ee,ge+Ze-ee),ae.primitiveLength++}}})(g,n,x,u,T,i),e.forceNewSegmentOnNextPrepare(),g?.forceNewSegmentOnNextPrepare()}function Oo(i,e,n,o,u,p,g){if(p){const x=o.count;return n(e[2*u],e[2*u+1]),i[u]=o.count,o.count++,g.vertexLength++,x}return i[u]}class bu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new oe,this.indexArray=new Ve,this.indexArray2=new wt,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new Ct,this.segments2=new Ct,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.hasDependencies=is("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),g=[];for(const{feature:x,id:T,index:C,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,B=ns(x,L);if(!this.layers[0]._featureFilter.filter(new jn(this.zoom),B,o))continue;const F=p?u.evaluate(B,{},o,n.availableImages):void 0,q={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:C,geometry:L?B.geometry:no(x),patterns:{},sortKey:F};g.push(q)}p&&g.sort(((x,T)=>x.sortKey-T.sortKey));for(const x of g){const{geometry:T,index:C,sourceLayerIndex:I}=x;if(this.hasDependencies){const L=Yf("fill",this.layers,x,{zoom:this.zoom},n);this.patternFeatures.push(L)}else this.addFeature(x,T,C,o,{},n.subdivisionGranularity);n.featureIndex.insert(e[C].feature,T,C,I,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,u,p,g){for(const x of $c(n,500)){const T=Jf(x,u,g.fill.getGranularityForZoomLevel(u.z)),C=this.layoutVertexArray;hm(((I,L)=>{C.emplaceBack(I,L)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:u})}}let bh,wu;Rt("FillBucket",bu,{omit:["layers","patternFeatures"]});var Eg={get paint(){return wu=wu||new Li({"fill-antialias":new Bt(Ne.paint_fill["fill-antialias"]),"fill-opacity":new qt(Ne.paint_fill["fill-opacity"]),"fill-color":new qt(Ne.paint_fill["fill-color"]),"fill-outline-color":new qt(Ne.paint_fill["fill-outline-color"]),"fill-translate":new Bt(Ne.paint_fill["fill-translate"]),"fill-translate-anchor":new Bt(Ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pa(Ne.paint_fill["fill-pattern"])})},get layout(){return bh=bh||new Li({"fill-sort-key":new qt(Ne.layout_fill["fill-sort-key"])})}};class Mg extends vi{constructor(e,n){super(e,Eg,n)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new bu(e)}queryRadius(){return yd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:o,pixelsToTileUnits:u}){return Ff(Uf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),n)}isTileClipped(){return!0}}const Dd=pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ag=pi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ep}=Dd;class wh{constructor(e,n,o,u,p){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=p,e.readFields(Qy,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,o=[];let u,p=1,g=0,x=0,T=0;for(;e.pos<n;){if(g<=0){const C=e.readVarint();p=7&C,g=C>>3}if(g--,p===1||p===2)x+=e.readSVarint(),T+=e.readSVarint(),p===1&&(u&&o.push(u),u=[]),u&&u.push(new N(x,T));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let o=1,u=0,p=0,g=0,x=1/0,T=-1/0,C=1/0,I=-1/0;for(;e.pos<n;){if(u<=0){const L=e.readVarint();o=7&L,u=L>>3}if(u--,o===1||o===2)p+=e.readSVarint(),g+=e.readSVarint(),p<x&&(x=p),p>T&&(T=p),g<C&&(C=g),g>I&&(I=g);else if(o!==7)throw new Error(`unknown command ${o}`)}return[x,C,T,I]}toGeoJSON(e,n,o){const u=this.extent*Math.pow(2,o),p=this.extent*e,g=this.extent*n,x=this.loadGeometry();function T(B){return[360*(B.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+g)/u)*Math.PI))-90]}function C(B){return B.map(T)}let I;if(this.type===1){const B=[];for(const q of x)B.push(q[0]);const F=C(B);I=B.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const B=x.map(C);I=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=Cg(x),F=[];for(const q of B)F.push(q.map(C));I=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const L={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(L.id=this.id),L}}function Qy(i,e,n){i===1?e.id=n.readVarint():i===2?(function(o,u){const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=u._keys[o.readVarint()],x=u._values[o.readVarint()];u.properties[g]=x}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function Cg(i){const e=i.length;if(e<=1)return[i];const n=[];let o,u;for(let p=0;p<e;p++){const g=ei(i[p]);g!==0&&(u===void 0&&(u=g<0),u===g<0?(o&&n.push(o),o=[i[p]]):o&&o.push(i[p]))}return o&&n.push(o),n}function ei(i){let e=0;for(let n,o,u=0,p=i.length,g=p-1;u<p;g=u++)n=i[u],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}wh.types=["Unknown","Point","LineString","Polygon"];class gi{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Pn,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new wh(this._pbf,n,this.extent,this._keys,this._values)}}function Pn(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(o){let u=null;const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=o.readVarint()>>3;u=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(n))}class In{constructor(e,n){this.layers=e.readFields(si,{},n)}}function si(i,e,n){if(i===3){const o=new gi(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}const _a=Math.pow(2,13);function Ls(i,e,n,o,u,p,g,x){i.emplaceBack(e,n,2*Math.floor(o*_a)+g,u*_a*2,p*_a*2,Math.round(x))}class hc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ue,this.centroidVertexArray=new se,this.indexArray=new Ve,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new Ct,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.features=[],this.hasDependencies=is("fill-extrusion",this.layers,n);for(const{feature:u,id:p,index:g,sourceLayerIndex:x}of e){const T=this.layers[0]._featureFilter.needGeometry,C=ns(u,T);if(!this.layers[0]._featureFilter.filter(new jn(this.zoom),C,o))continue;const I={id:p,sourceLayerIndex:x,index:g,geometry:T?C.geometry:no(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Yf("fill-extrusion",this.layers,I,{zoom:this.zoom},n)):this.addFeature(I,I.geometry,g,o,{},n.subdivisionGranularity),n.featureIndex.insert(u,I.geometry,g,x,this.index,!0)}}addFeatures(e,n,o){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,n,o,e.subdivisionGranularity)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ep),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ag.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,u,p,g){for(const x of $c(n,500)){const T={x:0,y:0,sampleCount:0},C=this.layoutVertexArray.length;this.processPolygon(T,u,e,x,g);const I=this.layoutVertexArray.length-C,L=Math.floor(T.x/T.sampleCount),B=Math.floor(T.y/T.sampleCount);for(let F=0;F<I;F++)this.centroidVertexArray.emplaceBack(L,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:u})}processPolygon(e,n,o,u,p){if(u.length<1||Vi(u[0]))return;for(const L of u)L.length!==0&&dm(e,L);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=p.fill.getGranularityForZoomLevel(n.z),T=wh.types[o.type]==="Polygon";for(const L of u){if(L.length===0||Vi(L))continue;const B=bl(L,x,T);this._generateSideFaces(B,g)}if(!T)return;const C=Jf(u,n,x,!1),I=this.layoutVertexArray;hm(((L,B)=>{Ls(I,L,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles)}_generateSideFaces(e,n){let o=0;for(let u=1;u<e.length;u++){const p=e[u],g=e[u-1];if(wl(p,g))continue;n.segment.vertexLength+4>Ct.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=p.sub(g)._perp()._unit(),T=g.dist(p);o+T>32768&&(o=0),Ls(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,0,o),Ls(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,1,o),o+=T,Ls(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,0,o),Ls(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,1,o);const C=n.segment.vertexLength;this.indexArray.emplaceBack(C,C+2,C+1),this.indexArray.emplaceBack(C+1,C+2,C+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function dm(i,e){for(let n=0;n<e.length;n++){const o=e[n];n===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(i.x+=o.x,i.y+=o.y,i.sampleCount++)}}function wl(i,e){return i.x===e.x&&(i.x<0||i.x>_t)||i.y===e.y&&(i.y<0||i.y>_t)}function Vi(i){return i.every((e=>e.x<0))||i.every((e=>e.x>_t))||i.every((e=>e.y<0))||i.every((e=>e.y>_t))}let Tl;Rt("FillExtrusionBucket",hc,{omit:["layers","features"]});var Tu={get paint(){return Tl=Tl||new Li({"fill-extrusion-opacity":new Bt(Ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qt(Ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bt(Ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bt(Ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pa(Ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qt(Ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qt(Ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bt(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class fm extends vi{constructor(e,n){super(e,Tu,n)}createBucket(e){return new hc(e)}queryRadius(){return yd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,pixelPosMatrix:x}){const T=Uf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,g),C=this.paint.get("fill-extrusion-height").evaluate(n,o),I=this.paint.get("fill-extrusion-base").evaluate(n,o),L=(function(F,q){const G=[];for(const X of F){const J=[X.x,X.y,0,1];Gt(J,J,q),G.push(new N(J[0]/J[3],J[1]/J[3]))}return G})(T,x),B=(function(F,q,G,X){const J=[],he=[],ee=X[8]*q,ae=X[9]*q,ge=X[10]*q,be=X[11]*q,je=X[8]*G,ot=X[9]*G,Ke=X[10]*G,ft=X[11]*G;for(const zt of F){const gt=[],et=[];for(const Ze of zt){const Nt=Ze.x,Lt=Ze.y,Ut=X[0]*Nt+X[4]*Lt+X[12],kt=X[1]*Nt+X[5]*Lt+X[13],$t=X[2]*Nt+X[6]*Lt+X[14],Bn=X[3]*Nt+X[7]*Lt+X[15],wn=$t+ge,Pi=Bn+be,Jr=Ut+je,pr=kt+ot,Ii=$t+Ke,bi=Bn+ft,Xn=new N((Ut+ee)/Pi,(kt+ae)/Pi);Xn.z=wn/Pi,gt.push(Xn);const qi=new N(Jr/bi,pr/bi);qi.z=Ii/bi,et.push(qi)}J.push(gt),he.push(et)}return[J,he]})(u,I,C,x);return(function(F,q,G){let X=1/0;Ff(G,q)&&(X=Su(G,q[0]));for(let J=0;J<q.length;J++){const he=q[J],ee=F[J];for(let ae=0;ae<he.length-1;ae++){const ge=he[ae],be=[ge,he[ae+1],ee[ae+1],ee[ae],ge];vu(G,be)&&(X=Math.min(X,Su(G,be)))}}return X!==1/0&&X})(B[0],B[1],L)}}function jr(i,e){return i.x*e.x+i.y*e.y}function Su(i,e){if(i.length===1){let n=0;const o=e[n++];let u;for(;!u||o.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const p=e[n],g=i[0],x=u.sub(o),T=p.sub(o),C=g.sub(o),I=jr(x,x),L=jr(x,T),B=jr(T,T),F=jr(C,x),q=jr(C,T),G=I*B-L*L,X=(B*F-L*q)/G,J=(I*q-L*F)/G,he=o.z*(1-X-J)+u.z*X+p.z*J;if(isFinite(he))return he}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const Pd=pi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ba}=Pd,pm=pi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tp}=pm,zg=Math.cos(Math.PI/180*37.5),Id=Math.pow(2,14)/.5;class Th{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new xe,this.layoutVertexArray2=new ce,this.indexArray=new Ve,this.programConfigurations=new Po(e.layers,e.zoom),this.segments=new Ct,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.hasDependencies=is("line",this.layers,n)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),g=[];for(const{feature:x,id:T,index:C,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,B=ns(x,L);if(!this.layers[0]._featureFilter.filter(new jn(this.zoom),B,o))continue;const F=p?u.evaluate(B,{},o):void 0,q={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:C,geometry:L?B.geometry:no(x),patterns:{},dashes:{},sortKey:F};g.push(q)}p&&g.sort(((x,T)=>x.sortKey-T.sortKey));for(const x of g){const{geometry:T,index:C,sourceLayerIndex:I}=x;this.hasDependencies?(is("line",this.layers,n)?Yf("line",this.layers,x,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,x,this.zoom,n),this.patternFeatures.push(x)):this.addFeature(x,T,C,o,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[C].feature,T,C,I,this.index)}}update(e,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,n,o,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,tp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ba),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,u,p,g,x){const T=this.layers[0].layout,C=T.get("line-join").evaluate(e,{}),I=T.get("line-cap"),L=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of n)this.addLine(F,e,C,I,L,B,u,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,dashPositions:g,canonical:u})}addLine(e,n,o,u,p,g,x,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=bl(e,x?T.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=wh.types[n.type]==="Polygon";let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let L=0;for(;L<I-1&&e[L].equals(e[L+1]);)L++;if(I<(C?3:2))return;o==="bevel"&&(p=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let q,G,X,J,he;this.e1=this.e2=-1,C&&(q=e[I-2],he=e[L].sub(q)._unit()._perp());for(let ee=L;ee<I;ee++){if(X=ee===I-1?C?e[L+1]:void 0:e[ee+1],X&&e[ee].equals(X))continue;he&&(J=he),q&&(G=q),q=e[ee],he=X?X.sub(q)._unit()._perp():J,J=J||he;let ae=J.add(he);ae.x===0&&ae.y===0||ae._unit();const ge=J.x*he.x+J.y*he.y,be=ae.x*he.x+ae.y*he.y,je=be!==0?1/be:1/0,ot=2*Math.sqrt(2-2*be),Ke=be<zg&&G&&X,ft=J.x*he.y-J.y*he.x>0;if(Ke&&ee>L){const et=q.dist(G);if(et>2*B){const Ze=q.sub(q.sub(G)._mult(B/et)._round());this.updateDistance(G,Ze),this.addCurrentVertex(Ze,J,0,0,F),G=Ze}}const zt=G&&X;let gt=zt?o:C?"butt":u;if(zt&&gt==="round"&&(je<g?gt="miter":je<=2&&(gt="fakeround")),gt==="miter"&&je>p&&(gt="bevel"),gt==="bevel"&&(je>2&&(gt="flipbevel"),je<p&&(gt="miter")),G&&this.updateDistance(G,q),gt==="miter")ae._mult(je),this.addCurrentVertex(q,ae,0,0,F);else if(gt==="flipbevel"){if(je>100)ae=he.mult(-1);else{const et=je*J.add(he).mag()/J.sub(he).mag();ae._perp()._mult(et*(ft?-1:1))}this.addCurrentVertex(q,ae,0,0,F),this.addCurrentVertex(q,ae.mult(-1),0,0,F)}else if(gt==="bevel"||gt==="fakeround"){const et=-Math.sqrt(je*je-1),Ze=ft?et:0,Nt=ft?0:et;if(G&&this.addCurrentVertex(q,J,Ze,Nt,F),gt==="fakeround"){const Lt=Math.round(180*ot/Math.PI/20);for(let Ut=1;Ut<Lt;Ut++){let kt=Ut/Lt;if(kt!==.5){const Bn=kt-.5;kt+=kt*Bn*(kt-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*Bn*Bn+(.848013+ge*(.215638*ge-1.06021)))}const $t=he.sub(J)._mult(kt)._add(J)._unit()._mult(ft?-1:1);this.addHalfVertex(q,$t.x,$t.y,!1,ft,0,F)}}X&&this.addCurrentVertex(q,he,-Ze,-Nt,F)}else if(gt==="butt")this.addCurrentVertex(q,ae,0,0,F);else if(gt==="square"){const et=G?1:-1;this.addCurrentVertex(q,ae,et,et,F)}else gt==="round"&&(G&&(this.addCurrentVertex(q,J,0,0,F),this.addCurrentVertex(q,J,1,1,F,!0)),X&&(this.addCurrentVertex(q,he,-1,-1,F,!0),this.addCurrentVertex(q,he,0,0,F)));if(Ke&&ee<I-1){const et=q.dist(X);if(et>2*B){const Ze=q.add(X.sub(q)._mult(B/et)._round());this.updateDistance(q,Ze),this.addCurrentVertex(Ze,he,0,0,F),q=Ze}}}}addCurrentVertex(e,n,o,u,p,g=!1){const x=n.y*u-n.x,T=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,p),this.addHalfVertex(e,x,T,g,!0,-u,p),this.distance>Id/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,u,p,g))}addHalfVertex({x:e,y:n},o,u,p,g,x,T){const C=.5*(this.lineClips?this.scaledDistance*(Id-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),T.primitiveLength++),g?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const o=n.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,n,o,u){for(const p of e){const g=p.paint.get("line-dasharray");if(!g||g.value.kind==="constant")continue;const x=p.layout.get("line-cap")==="round",T={dasharray:g.value.evaluate({zoom:o-1},n,{}),round:x},C={dasharray:g.value.evaluate({zoom:o},n,{}),round:x},I={dasharray:g.value.evaluate({zoom:o+1},n,{}),round:x},L=`${T.dasharray.join(",")},${T.round}`,B=`${C.dasharray.join(",")},${C.round}`,F=`${I.dasharray.join(",")},${I.round}`;u.dashDependencies[L]=T,u.dashDependencies[B]=C,u.dashDependencies[F]=I,n.dashes[p.id]={min:L,mid:B,max:F}}}}let Sl,hr;Rt("LineBucket",Th,{omit:["layers","patternFeatures"]});var El={get paint(){return hr=hr||new Li({"line-opacity":new qt(Ne.paint_line["line-opacity"]),"line-color":new qt(Ne.paint_line["line-color"]),"line-translate":new Bt(Ne.paint_line["line-translate"]),"line-translate-anchor":new Bt(Ne.paint_line["line-translate-anchor"]),"line-width":new qt(Ne.paint_line["line-width"]),"line-gap-width":new qt(Ne.paint_line["line-gap-width"]),"line-offset":new qt(Ne.paint_line["line-offset"]),"line-blur":new qt(Ne.paint_line["line-blur"]),"line-dasharray":new Pa(Ne.paint_line["line-dasharray"]),"line-pattern":new Pa(Ne.paint_line["line-pattern"]),"line-gradient":new du(Ne.paint_line["line-gradient"])})},get layout(){return Sl=Sl||new Li({"line-cap":new Bt(Ne.layout_line["line-cap"]),"line-join":new qt(Ne.layout_line["line-join"]),"line-miter-limit":new Bt(Ne.layout_line["line-miter-limit"]),"line-round-limit":new Bt(Ne.layout_line["line-round-limit"]),"line-sort-key":new qt(Ne.layout_line["line-sort-key"])})}};class Sh extends qt{possiblyEvaluate(e,n){return n=new jn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,u){return n=rn({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,u)}}let Os;class mm extends vi{constructor(e,n){super(e,El,n),this.gradientVersion=0,Os||(Os=new Sh(El.paint.properties["line-width"].specification),Os.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof yo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Os.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Th(e)}queryRadius(e){const n=e,o=np(yl("line-width",this,n),yl("line-gap-width",this,n)),u=yl("line-offset",this,n);return o/2+Math.abs(u)+yd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g}){const x=Uf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,g),T=g/2*np(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),C=this.paint.get("line-offset").evaluate(n,o);return C&&(u=(function(I,L){const B=[];for(let F=0;F<I.length;F++){const q=Vf(I[F]),G=[];for(let X=0;X<q.length;X++){const J=q[X],he=q[X-1],ee=q[X+1],ae=X===0?new N(0,0):J.sub(he)._unit()._perp(),ge=X===q.length-1?new N(0,0):ee.sub(J)._unit()._perp(),be=ae._add(ge)._unit(),je=be.x*ge.x+be.y*ge.y;je!==0&&be._mult(1/je),G.push(be._mult(L)._add(J))}B.push(G)}return B})(u,C*g)),(function(I,L,B){for(let F=0;F<L.length;F++){const q=L[F];if(I.length>=3){for(let G=0;G<q.length;G++)if(ko(I,q[G]))return!0}if(lr(I,q,B))return!0}return!1})(x,u,T)}isTileClipped(){return!0}}function np(i,e){return e>0?e+2*i:i}const Dg=pi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kd=pi([{name:"a_projected_pos",components:3,type:"Float32"}],4);pi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gm=pi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);pi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Na=pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pg=pi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fa(i,e,n){return i.sections.forEach((o=>{o.text=(function(u,p,g){const x=p.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?u=u.toLocaleUpperCase():x==="lowercase"&&(u=u.toLocaleLowerCase()),Da.applyArabicShaping&&(u=Da.applyArabicShaping(u)),u})(o.text,e,n)})),i}pi([{name:"triangle",components:3,type:"Uint16"}]),pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),pi([{type:"Float32",name:"offsetX"}]),pi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),pi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var ir=24;const Eh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Jy={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},dc={40:!0};function Rd(i,e,n,o,u,p){if("fontStack"in e){const g=n[e.fontStack],x=g&&g[i];return x?x.metrics.advance*e.scale+u:0}{const g=o[e.imageName];return g?g.displaySize[0]*e.scale*ir/p+u:0}}function ip(i,e,n,o){const u=Math.pow(i-e,2);return o?i<e?u/2:2*u:u+Math.abs(n)*n}function Mh(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function ym(i,e,n,o,u,p){let g=null,x=ip(e,n,u,p);for(const T of o){const C=ip(e-T.x,n,u,p)+T.badness;C<=x&&(g=T,x=C)}return{index:i,x:e,priorBreak:g,badness:x}}function _m(i){return i?_m(i.priorBreak).concat(i.index):[]}class Eu{constructor(e="",n=[],o=[]){this.text=e,this.sections=n,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,n){const o=new Eu;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let p=u.next();const g=e[Symbol.iterator]();g.next();let x=g.next();for(;!p.done;)n+=!x.done&&Ds(x.value.codePointAt(0))&&!Eh[x.value]||!o.premature&&Ds(o.value.codePointAt(0))&&!Eh[o.value]||!Eh[p.value]?p.value:Eh[p.value],o={value:p.value,premature:!1},p=u.next(),x=g.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(n,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-u)}substring(e,n){const o=[...this.text].slice(e,n).join(""),u=this.sectionIndex.slice(e,n);return new Eu(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,o=0;for(let u=0;u<this.length();u++){const p=this.getSection(u);if("imageName"in p){const g=e[p.imageName];if(!g)continue;const x=g.displaySize;n=Math.max(n,x[0]),o=Math.max(o,x[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void zn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):zn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,o,u,p){const g=[],x=this.determineAverageLineWidth(e,n,o,u,p),T=this.hasZeroWidthSpaces();let C=0,I=0;const L=this.text[Symbol.iterator]();let B=L.next();const F=this.text[Symbol.iterator]();F.next();let q=F.next();const G=this.text[Symbol.iterator]();G.next(),G.next();let X=G.next();for(;!B.done;){const J=this.getSection(I),he=B.value.codePointAt(0);if(ou(he)||(C+=Rd(he,J,o,u,e,p)),!q.done){const ee=As(he),ae=q.value.codePointAt(0);(Jy[he]||ee||"imageName"in J||!X.done&&dc[ae])&&g.push(ym(I+1,C,x,g,Mh(he,ae,ee&&T),!1))}I++,B=L.next(),q=F.next(),X=G.next()}return _m(ym(this.length(),C,x,g,0,!0))}determineAverageLineWidth(e,n,o,u,p){let g=0,x=0;for(const T of this.text){const C=this.getSection(x);g+=Rd(T.codePointAt(0),C,o,u,e,p),x++}return g/Math.max(1,Math.ceil(g/n))}}const rp=4294967296,Ld=1/rp,ap=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class sp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,o=this.length){for(;this.pos<o;){const u=this.readVarint(),p=u>>3,g=this.pos;this.type=7&u,e(p,n,this),this.pos===g&&this.skip(u)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*rp;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*rp;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let o,u;return u=n[this.pos++],o=127&u,u<128?o:(u=n[this.pos++],o|=(127&u)<<7,u<128?o:(u=n[this.pos++],o|=(127&u)<<14,u<128?o:(u=n[this.pos++],o|=(127&u)<<21,u<128?o:(u=n[this.pos],o|=(15&u)<<28,(function(p,g,x){const T=x.buf;let C,I;if(I=T[x.pos++],C=(112&I)>>4,I<128||(I=T[x.pos++],C|=(127&I)<<3,I<128)||(I=T[x.pos++],C|=(127&I)<<10,I<128)||(I=T[x.pos++],C|=(127&I)<<17,I<128)||(I=T[x.pos++],C|=(127&I)<<24,I<128)||(I=T[x.pos++],C|=(1&I)<<31,I<128))return Ah(p,C,g);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&ap?ap.decode(this.buf.subarray(n,e)):(function(o,u,p){let g="",x=u;for(;x<p;){const T=o[x];let C,I,L,B=null,F=T>239?4:T>223?3:T>191?2:1;if(x+F>p)break;F===1?T<128&&(B=T):F===2?(C=o[x+1],(192&C)==128&&(B=(31&T)<<6|63&C,B<=127&&(B=null))):F===3?(C=o[x+1],I=o[x+2],(192&C)==128&&(192&I)==128&&(B=(15&T)<<12|(63&C)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(C=o[x+1],I=o[x+2],L=o[x+3],(192&C)==128&&(192&I)==128&&(192&L)==128&&(B=(15&T)<<18|(63&C)<<12|(63&I)<<6|63&L,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),x+=F}return g})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ld),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ld),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,o){let u,p;if(n>=0?(u=n%4294967296|0,p=n/4294967296|0):(u=~(-n%4294967296),p=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(g,x,T){T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,T.buf[T.pos]=127&(g>>>=7)})(u,0,o),(function(g,x){const T=(7&g)<<4;x.buf[x.pos++]|=T|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))})(p,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(u,p,g){for(let x,T,C=0;C<p.length;C++){if(x=p.charCodeAt(C),x>55295&&x<57344){if(!T){x>56319||C+1===p.length?(u[g++]=239,u[g++]=191,u[g++]=189):T=x;continue}if(x<56320){u[g++]=239,u[g++]=191,u[g++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(u[g++]=239,u[g++]=191,u[g++]=189,T=null);x<128?u[g++]=x:(x<2048?u[g++]=x>>6|192:(x<65536?u[g++]=x>>12|224:(u[g++]=x>>18|240,u[g++]=x>>12&63|128),u[g++]=x>>6&63|128),u[g++]=63&x|128)}return g})(this.buf,e,this.pos);const o=this.pos-n;o>=128&&Ig(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,n){this.pos++;const o=this.pos;e(n,this);const u=this.pos-o;u>=128&&Ig(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,n,o){this.writeTag(e,2),this.writeRawMessage(n,o)}writePackedVarint(e,n){n.length&&this.writeMessage(e,kg,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,Rg,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,Lg,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,Ch,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,op,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,Og,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,Bg,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,Ng,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,Fg,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function Ah(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Ig(i,e,n){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(let u=n.pos-1;u>=i;u--)n.buf[u+o]=n.buf[u]}function kg(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function Rg(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function Ch(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function op(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function Lg(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function Og(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function Bg(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function Ng(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function Fg(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function jg(i,e,n){i===1&&n.readMessage(lp,e)}function lp(i,e,n){if(i===3){const{id:o,bitmap:u,width:p,height:g,left:x,top:T,advance:C}=n.readMessage(Ug,{});e.push({id:o,bitmap:new xd({width:p+6,height:g+6},u),metrics:{width:p,height:g,left:x,top:T,advance:C}})}}function Ug(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function vm(i){let e=0,n=0;for(const g of i)e+=g.w*g.h,n=Math.max(n,g.w);i.sort(((g,x)=>x.h-g.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,p=0;for(const g of i)for(let x=o.length-1;x>=0;x--){const T=o[x];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,p=Math.max(p,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===T.w&&g.h===T.h){const C=o.pop();C&&x<o.length&&(o[x]=C)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(o.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}class ti{constructor(e,{pixelRatio:n,version:o,stretchX:u,stretchY:p,content:g,textFitWidth:x,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=p,this.content=g,this.version=o,this.textFitWidth=x,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class cp{constructor(e,n){const o={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,p),this.addImages(n,u,p);const{w:g,h:x}=vm(p),T=new Yr({width:g||1,height:x||1});for(const C in e){const I=e[C],L=o[C].paddedRect;Yr.copy(I.data,T,{x:0,y:0},{x:L.x+1,y:L.y+1},I.data)}for(const C in n){const I=n[C],L=u[C].paddedRect,B=L.x+1,F=L.y+1,q=I.data.width,G=I.data.height;Yr.copy(I.data,T,{x:0,y:0},{x:B,y:F},I.data),Yr.copy(I.data,T,{x:0,y:G-1},{x:B,y:F-1},{width:q,height:1}),Yr.copy(I.data,T,{x:0,y:0},{x:B,y:F+G},{width:q,height:1}),Yr.copy(I.data,T,{x:q-1,y:0},{x:B-1,y:F},{width:1,height:G}),Yr.copy(I.data,T,{x:0,y:0},{x:B+q,y:F},{width:1,height:G})}this.image=T,this.iconPositions=o,this.patternPositions=u}addImages(e,n,o){for(const u in e){const p=e[u],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(g),n[u]=new ti(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,p]=e.tl;o.update(n.data,void 0,{x:u,y:p})}}var fc;function Od(i,e,n,o,u,p,g,x,T,C,I,L,B,F,q){const G=Eu.fromFeature(i,u);let X;L===A.az.vertical&&G.verticalizePunctuation();let J=G.determineLineBreaks(C,p,e,o,F);const{processBidirectionalText:he,processStyledBidirectionalText:ee}=Da;if(he&&G.sections.length===1){X=[],J=J.map((je=>G.toCodeUnitIndex(je)));const be=he(G.toString(),J);for(const je of be){const ot=[...je].map((()=>0));X.push(new Eu(je,G.sections,ot))}}else if(ee){X=[],J=J.map((Ke=>G.toCodeUnitIndex(Ke)));let be=0;const je=[];for(const Ke of G.text)je.push(...Array(Ke.length).fill(G.sectionIndex[be])),be++;const ot=ee(G.text,je,J);for(const Ke of ot){const ft=[];let zt="";for(const gt of Ke[0])ft.push(Ke[1][zt.length]),zt+=gt;X.push(new Eu(Ke[0],G.sections,ft))}}else X=(function(be,je){const ot=[];let Ke=0;for(const ft of je)ot.push(be.substring(Ke,ft)),Ke=ft;return Ke<be.length()&&ot.push(be.substring(Ke,be.length())),ot})(G,J);const ae=[],ge={positionedLines:ae,text:G.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:L,iconsInText:!1,verticalizable:!1};return(function(be,je,ot,Ke,ft,zt,gt,et,Ze,Nt,Lt,Ut){let kt=0,$t=0,Bn=0,wn=0;const Pi=et==="right"?1:et==="left"?0:.5,Jr=ir/Ut;let pr=0;for(const Xn of ft){Xn.trim();const qi=Xn.getMaxScale(),Yi={positionedGlyphs:[],lineOffset:0};be.positionedLines[pr]=Yi;const yi=Yi.positionedGlyphs;let ss=0;if(!Xn.length()){$t+=zt,++pr;continue}const ea=e_(Ke,Xn,Jr);let os=0;for(const Cr of Xn.text){const Bi=Xn.getSection(os),mr=Cr.codePointAt(0),Gi=up(Ze,Lt,mr),zr={glyph:mr,imageName:null,x:kt,y:$t+-17,vertical:Gi,scale:1,fontStack:"",sectionIndex:Xn.getSectionIndex(os),metrics:null,rect:null};let zu;if("fontStack"in Bi){if(zu=zh(Bi,mr,Gi,ea,je,ot),!zu)continue;zr.fontStack=Bi.fontStack}else{if(be.iconsInText=!0,Bi.scale*=Jr,zu=bm(Bi,Gi,qi,ea,Ke),!zu)continue;ss=Math.max(ss,zu.imageOffset),zr.imageName=Bi.imageName}const{rect:Pl,metrics:tg,baselineOffset:Fh}=zu;zr.y+=Fh,zr.scale=Bi.scale,zr.metrics=tg,zr.rect=Pl,yi.push(zr),Gi?(be.verticalizable=!0,kt+=("imageName"in Bi?tg.advance:ir)*Bi.scale+Nt):kt+=tg.advance*Bi.scale+Nt,os++}yi.length!==0&&(Bn=Math.max(kt-Nt,Bn),hp(yi,0,yi.length-1,Pi)),kt=0,Yi.lineOffset=Math.max(ss,(qi-1)*ir);const Fo=zt*qi+ss;$t+=Fo,wn=Math.max(Fo,wn),++pr}const{horizontalAlign:Ii,verticalAlign:bi}=xm(gt);(function(Xn,qi,Yi,yi,ss,ea,os,Fo,Cr){const Bi=(qi-Yi)*ss;let mr=0;mr=ea!==os?-Fo*yi- -17:-yi*Cr*os+.5*os;for(const Gi of Xn)for(const zr of Gi.positionedGlyphs)zr.x+=Bi,zr.y+=mr})(be.positionedLines,Pi,Ii,bi,Bn,wn,zt,$t,ft.length),be.top+=-bi*$t,be.bottom=be.top+$t,be.left+=-Ii*Bn,be.right=be.left+Bn})(ge,e,n,o,X,g,x,T,L,C,B,q),!(function(be){for(const je of be)if(je.positionedGlyphs.length!==0)return!1;return!0})(ae)&&ge}function xm(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function e_(i,e,n){const o=e.getMaxScale()*ir,{maxImageWidth:u,maxImageHeight:p}=e.getMaxImageSize(i),g=Math.max(o,p*n);return{verticalLineContentWidth:Math.max(o,u*n),horizontalLineContentHeight:g}}function Vg(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function up(i,e,n){return!(i===A.az.horizontal||!e&&!cl(n)||e&&(ou(n)||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function zh(i,e,n,o,u,p){const g=p[i.fontStack],x=(function(C,I,L,B){if(C&&C.rect)return C;const F=I[L.fontStack],q=F&&F[B];return q?{rect:null,metrics:q.metrics}:null})(g&&g[e],u,i,e);if(x===null)return null;let T;if(n)T=o.verticalLineContentWidth-i.scale*ir;else{const C=Vg(i.verticalAlign);T=(o.horizontalLineContentHeight-i.scale*ir)*C}return{rect:x.rect,metrics:x.metrics,baselineOffset:T}}function bm(i,e,n,o,u){const p=u[i.imageName];if(!p)return null;const g=p.paddedRect,x=p.displaySize,T={width:x[0],height:x[1],left:1,top:-3,advance:e?x[1]:x[0]};let C;if(e)C=o.verticalLineContentWidth-x[1]*i.scale;else{const I=Vg(i.verticalAlign);C=(o.horizontalLineContentHeight-x[1]*i.scale)*I}return{rect:g,metrics:T,baselineOffset:C,imageOffset:(e?x[0]:x[1])*i.scale-ir*n}}function hp(i,e,n,o){if(o===0)return;const u=i[n],p=(i[n].x+u.metrics.advance*u.scale)*o;for(let g=e;g<=n;g++)i[g].x-=p}function wm(i,e,n){const{horizontalAlign:o,verticalAlign:u}=xm(n),p=e[0]-i.displaySize[0]*o,g=e[1]-i.displaySize[1]*u;return{image:i,top:g,bottom:g+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Ml(i){var e,n;let o=i.left,u=i.top,p=i.right-o,g=i.bottom-u;const x=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",C=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(T==="proportional"){if(x==="stretchOnly"&&p/g<C||x==="proportional"){const I=Math.ceil(g*C);o*=I/p,p=I}}else if(x==="proportional"&&T==="stretchOnly"&&C!==0&&p/g>C){const I=Math.ceil(p/C);u*=I/g,g=I}return{x1:o,y1:u,x2:o+p,y2:u+g}}function ao(i,e,n,o,u,p){const g=i.image;let x;if(g.content){const X=g.content,J=g.pixelRatio||1;x=[X[0]/J,X[1]/J,g.displaySize[0]-X[2]/J,g.displaySize[1]-X[3]/J]}const T=e.left*p,C=e.right*p;let I,L,B,F;n==="width"||n==="both"?(F=u[0]+T-o[3],L=u[0]+C+o[1]):(F=u[0]+(T+C-g.displaySize[0])/2,L=F+g.displaySize[0]);const q=e.top*p,G=e.bottom*p;return n==="height"||n==="both"?(I=u[1]+q-o[0],B=u[1]+G+o[2]):(I=u[1]+(q+G-g.displaySize[1])/2,B=I+g.displaySize[1]),{image:g,top:I,right:L,bottom:B,left:F,collisionPadding:x}}Rt("ImagePosition",ti),Rt("ImageAtlas",cp),A.az=void 0,(fc=A.az||(A.az={}))[fc.none=0]="none",fc[fc.horizontal=1]="horizontal",fc[fc.vertical=2]="vertical",fc[fc.horizontalOnly=3]="horizontalOnly";const rs=128,pc=32640;function Tm(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new jn(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let p=0;for(;p<o.length&&o[p]<=i;)p++;p=Math.max(0,p-1);let g=p;for(;g<o.length&&o[g]<i+1;)g++;g=Math.min(o.length-1,g);const x=o[p],T=o[g];return n.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:T,minSize:n.evaluate(new jn(x)),maxSize:n.evaluate(new jn(T)),interpolationType:u}}}function dp(i,e,n){let o="never";const u=i.get(e);return u?o=u:i.get(n)&&(o="always"),o}const qg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bd(i,e,n,o,u,p,g,x,T,C,I,L,B){const F=x?Math.min(pc,Math.round(x[0])):0,q=x?Math.min(pc,Math.round(x[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*u),p,g,(F<<1)+(T?1:0),q,16*C,16*I,256*L,256*B)}function Sm(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Em(i){for(const e of i.sections)if(Ks(e.text))return!0;return!1}class fp{constructor(e){this.layoutVertexArray=new me,this.indexArray=new Ve,this.programConfigurations=e,this.segments=new Ct,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new qe,this.hasVisibleVertices=!1,this.placedSymbolArray=new w}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,qg,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Rt("SymbolBuffers",fp);class pp{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Ct,this.collisionVertexArray=new Ue}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,gm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Rt("CollisionBuffers",pp);class Dh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tm(this.zoom,n["text-size"]),this.iconSizeData=Tm(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=dp(o,"text-overlap","text-allow-overlap")!=="never"||dp(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((g=>A.az[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=e.sourceID}createArrays(){this.text=new fp(new Po(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new fp(new Po(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new R,this.lineVertexArray=new O,this.symbolInstances=new D,this.textAnchorOffsets=new j}calculateGlyphDependencies(e,n,o,u,p){for(const g of e)if(n[g.codePointAt(0)]=!0,(o||u)&&p){const x=Eh[g];x&&(n[x.codePointAt(0)]=!0)}}populate(e,n,o){const u=this.layers[0],p=u.layout,g=p.get("text-font"),x=p.get("text-field"),T=p.get("icon-image"),C=(x.value.kind!=="constant"||x.value.value instanceof Ji&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),I=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!C&&!I)return;const B=n.iconDependencies,F=n.glyphDependencies,q=n.availableImages,G=new jn(this.zoom);for(const{feature:X,id:J,index:he,sourceLayerIndex:ee}of e){const ae=u._featureFilter.needGeometry,ge=ns(X,ae);if(!u._featureFilter.filter(G,ge,o))continue;let be,je;if(ae||(ge.geometry=no(X)),C){const Ke=u.getValueAndResolveTokens("text-field",ge,o,q),ft=Ji.factory(Ke),zt=this.hasRTLText=this.hasRTLText||Em(ft);(!zt||Da.getRTLTextPluginStatus()==="unavailable"||zt&&Da.isParsed())&&(be=Fa(ft,u,ge))}if(I){const Ke=u.getValueAndResolveTokens("icon-image",ge,o,q);je=Ke instanceof Rr?Ke:Rr.fromString(Ke)}if(!be&&!je)continue;const ot=this.sortFeaturesByKey?L.evaluate(ge,{},o):void 0;if(this.features.push({id:J,text:be,icon:je,index:he,sourceLayerIndex:ee,geometry:ge.geometry,properties:X.properties,type:wh.types[X.type],sortKey:ot}),je&&(B[je.name]=!0),be){const Ke=g.evaluate(ge,{},o).join(","),ft=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(A.az.vertical)>=0;for(const zt of be.sections)if(zt.image)B[zt.image.name]=!0;else{const gt=Cs(be.toString()),et=zt.fontStack||Ke,Ze=F[et]=F[et]||{};this.calculateGlyphDependencies(zt.text,Ze,ft,this.allowVerticalPlacement,gt)}}}p.get("symbol-placement")==="line"&&(this.features=(function(X){const J={},he={},ee=[];let ae=0;function ge(Ke){ee.push(X[Ke]),ae++}function be(Ke,ft,zt){const gt=he[Ke];return delete he[Ke],he[ft]=gt,ee[gt].geometry[0].pop(),ee[gt].geometry[0]=ee[gt].geometry[0].concat(zt[0]),gt}function je(Ke,ft,zt){const gt=J[ft];return delete J[ft],J[Ke]=gt,ee[gt].geometry[0].shift(),ee[gt].geometry[0]=zt[0].concat(ee[gt].geometry[0]),gt}function ot(Ke,ft,zt){const gt=zt?ft[0][ft[0].length-1]:ft[0][0];return`${Ke}:${gt.x}:${gt.y}`}for(let Ke=0;Ke<X.length;Ke++){const ft=X[Ke],zt=ft.geometry,gt=ft.text?ft.text.toString():null;if(!gt){ge(Ke);continue}const et=ot(gt,zt),Ze=ot(gt,zt,!0);if(et in he&&Ze in J&&he[et]!==J[Ze]){const Nt=je(et,Ze,zt),Lt=be(et,Ze,ee[Nt].geometry);delete J[et],delete he[Ze],he[ot(gt,ee[Lt].geometry,!0)]=Lt,ee[Nt].geometry=null}else et in he?be(et,Ze,zt):Ze in J?je(et,Ze,zt):(ge(Ke),J[et]=ae-1,he[Ze]=ae-1)}return ee.filter((Ke=>Ke.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((X,J)=>X.sortKey-J.sortKey))}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(n[e.segment+1]),p=e.dist(n[e.segment]);const g={};for(let x=e.segment+1;x<n.length;x++)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:u},x<n.length-1&&(u+=n[x+1].dist(n[x]));for(let x=e.segment||0;x>=0;x--)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const T=g[x];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,u,p,g,x,T,C,I,L,B){const F=e.indexArray,q=e.layoutVertexArray,G=e.segments.prepareSegment(4*n.length,q,F,this.canOverlap?g.sortKey:void 0),X=this.glyphOffsetArray.length,J=G.vertexLength,he=this.allowVerticalPlacement&&x===A.az.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let ae=0;ae<n.length;ae++){const{tl:ge,tr:be,bl:je,br:ot,tex:Ke,pixelOffsetTL:ft,pixelOffsetBR:zt,minFontScaleX:gt,minFontScaleY:et,glyphOffset:Ze,isSDF:Nt,sectionIndex:Lt}=n[ae],Ut=G.vertexLength,kt=Ze[1];Bd(q,T.x,T.y,ge.x,kt+ge.y,Ke.x,Ke.y,o,Nt,ft.x,ft.y,gt,et),Bd(q,T.x,T.y,be.x,kt+be.y,Ke.x+Ke.w,Ke.y,o,Nt,zt.x,ft.y,gt,et),Bd(q,T.x,T.y,je.x,kt+je.y,Ke.x,Ke.y+Ke.h,o,Nt,ft.x,zt.y,gt,et),Bd(q,T.x,T.y,ot.x,kt+ot.y,Ke.x+Ke.w,Ke.y+Ke.h,o,Nt,zt.x,zt.y,gt,et),Sm(e.dynamicLayoutVertexArray,T,he),F.emplaceBack(Ut,Ut+2,Ut+1),F.emplaceBack(Ut+1,Ut+2,Ut+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ze[0]),ae!==n.length-1&&Lt===n[ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,g,g.index,{imagePositions:{},canonical:B,formattedSection:ee&&ee[Lt]})}e.placedSymbolArray.emplaceBack(T.x,T.y,X,this.glyphOffsetArray.length-X,J,C,I,T.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],x,0,!1,0,L)}_addCollisionDebugVertex(e,n,o,u,p,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,p,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,u,p,g,x){const T=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),C=T.vertexLength,I=p.layoutVertexArray,L=p.collisionVertexArray,B=x.anchorX,F=x.anchorY;this._addCollisionDebugVertex(I,L,g,B,F,new N(e,n)),this._addCollisionDebugVertex(I,L,g,B,F,new N(o,n)),this._addCollisionDebugVertex(I,L,g,B,F,new N(o,u)),this._addCollisionDebugVertex(I,L,g,B,F,new N(e,u)),T.vertexLength+=4;const q=p.indexArray;q.emplaceBack(C,C+1),q.emplaceBack(C+1,C+2),q.emplaceBack(C+2,C+3),q.emplaceBack(C+3,C),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,u){for(let p=e;p<n;p++){const g=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,u?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pp(Fe,Na.members,wt),this.iconCollisionBox=new pp(Fe,Na.members,wt);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,u,p,g,x,T,C){const I={};for(let L=n;L<o;L++){const B=e.get(L);I.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.textFeatureIndex=B.featureIndex;break}for(let L=u;L<p;L++){const B=e.get(L);I.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.verticalTextFeatureIndex=B.featureIndex;break}for(let L=g;L<x;L++){const B=e.get(L);I.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.iconFeatureIndex=B.featureIndex;break}for(let L=T;L<C;L++){const B=e.get(L);I.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.verticalIconFeatureIndex=B.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+2,p+1),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),u=[],p=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const T=this.symbolInstances.get(x);u.push(0|Math.round(n*T.anchorX+o*T.anchorY)),p.push(T.featureIndex)}return g.sort(((x,T)=>u[x]-u[T]||p[T]-p[x])),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,p,g)=>{u>=0&&g.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mp,gp;Rt("SymbolBucket",Dh,{omit:["layers","collisionBoxArray","features","compareText"]}),Dh.MAX_GLYPHS=65535,Dh.addDynamicAttributes=Sm;var Mm={get paint(){return gp=gp||new Li({"icon-opacity":new qt(Ne.paint_symbol["icon-opacity"]),"icon-color":new qt(Ne.paint_symbol["icon-color"]),"icon-halo-color":new qt(Ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new qt(Ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qt(Ne.paint_symbol["icon-halo-blur"]),"icon-translate":new Bt(Ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bt(Ne.paint_symbol["icon-translate-anchor"]),"text-opacity":new qt(Ne.paint_symbol["text-opacity"]),"text-color":new qt(Ne.paint_symbol["text-color"],{runtimeType:ra,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new qt(Ne.paint_symbol["text-halo-color"]),"text-halo-width":new qt(Ne.paint_symbol["text-halo-width"]),"text-halo-blur":new qt(Ne.paint_symbol["text-halo-blur"]),"text-translate":new Bt(Ne.paint_symbol["text-translate"]),"text-translate-anchor":new Bt(Ne.paint_symbol["text-translate-anchor"])})},get layout(){return mp=mp||new Li({"symbol-placement":new Bt(Ne.layout_symbol["symbol-placement"]),"symbol-spacing":new Bt(Ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bt(Ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qt(Ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bt(Ne.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bt(Ne.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Bt(Ne.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Bt(Ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bt(Ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bt(Ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new qt(Ne.layout_symbol["icon-size"]),"icon-text-fit":new Bt(Ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bt(Ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new qt(Ne.layout_symbol["icon-image"]),"icon-rotate":new qt(Ne.layout_symbol["icon-rotate"]),"icon-padding":new qt(Ne.layout_symbol["icon-padding"]),"icon-keep-upright":new Bt(Ne.layout_symbol["icon-keep-upright"]),"icon-offset":new qt(Ne.layout_symbol["icon-offset"]),"icon-anchor":new qt(Ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bt(Ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bt(Ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bt(Ne.layout_symbol["text-rotation-alignment"]),"text-field":new qt(Ne.layout_symbol["text-field"]),"text-font":new qt(Ne.layout_symbol["text-font"]),"text-size":new qt(Ne.layout_symbol["text-size"]),"text-max-width":new qt(Ne.layout_symbol["text-max-width"]),"text-line-height":new Bt(Ne.layout_symbol["text-line-height"]),"text-letter-spacing":new qt(Ne.layout_symbol["text-letter-spacing"]),"text-justify":new qt(Ne.layout_symbol["text-justify"]),"text-radial-offset":new qt(Ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bt(Ne.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qt(Ne.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qt(Ne.layout_symbol["text-anchor"]),"text-max-angle":new Bt(Ne.layout_symbol["text-max-angle"]),"text-writing-mode":new Bt(Ne.layout_symbol["text-writing-mode"]),"text-rotate":new qt(Ne.layout_symbol["text-rotate"]),"text-padding":new Bt(Ne.layout_symbol["text-padding"]),"text-keep-upright":new Bt(Ne.layout_symbol["text-keep-upright"]),"text-transform":new qt(Ne.layout_symbol["text-transform"]),"text-offset":new qt(Ne.layout_symbol["text-offset"]),"text-allow-overlap":new Bt(Ne.layout_symbol["text-allow-overlap"]),"text-overlap":new Bt(Ne.layout_symbol["text-overlap"]),"text-ignore-placement":new Bt(Ne.layout_symbol["text-ignore-placement"]),"text-optional":new Bt(Ne.layout_symbol["text-optional"])})}};class Gg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ni,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt("FormatSectionOverride",Gg,{omit:["defaultValue"]});class mc extends vi{constructor(e,n){super(e,Mm,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const p of o)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,u){const p=this.layout.get(e).evaluate(n,{},o,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||So(g.value)||!p?p:(function(x,T){return T.replace(/{([^{}]+)}/g,((C,I)=>x&&I in x?String(x[I]):""))})(n.properties,p)}createBucket(e){return new Dh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Mm.paint.overridableProperties){if(!mc.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new Gg(n),u=new rh(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new Fr("source",u):new Eo("composite",u,n.value.zoomStops),this.paint._values[e]=new pa(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&mc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),u=Mm.paint.properties[n];let p=!1;const g=x=>{for(const T of x)if(u.overrides&&u.overrides.hasOverride(T))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Ji)g(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const x=C=>{p||(C instanceof sa&&di(C.value)===hs?g(C.value.sections):C instanceof qc?g(C.sections):C.eachChild(x))},T=o.value;T._styleExpression&&x(T._styleExpression.expression)}return p}}let Zg;var Hg={get paint(){return Zg=Zg||new Li({"background-color":new Bt(Ne.paint_background["background-color"]),"background-pattern":new ac(Ne.paint_background["background-pattern"]),"background-opacity":new Bt(Ne.paint_background["background-opacity"])})}};class kn extends vi{constructor(e,n){super(e,Hg,n)}}class Am extends vi{constructor(e,n){super(e,{},n),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Cm={once:!0},_p=63710088e-1;class Bo{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Bo(Qt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,u=e.lat*n,p=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return _p*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof Bo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Bo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Bo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ph=2*Math.PI*_p;function Nd(i){return Ph*Math.cos(i*Math.PI/180)}function $g(i){return(180+i)/360}function zm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Xg(i,e){return i/Nd(e)}function Yg(i){return 360*i-180}function Fd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Dm(i,e){return i*Nd(Fd(e))}class Hn{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=Bo.convert(e);return new Hn($g(o.lng),zm(o.lat),Xg(n,o.lat))}toLngLat(){return new Bo(Yg(this.x),Fd(this.y))}toAltitude(){return Dm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ph*(e=Fd(this.y),1/Math.cos(e*Math.PI/180));var e}}function vp(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class vr{constructor(e,n,o){if(!(function(u,p,g){return!(u<0||u>25||g<0||g>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))})(e,n,o))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=Ih(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const u=(function(g,x,T){var C=vp(256*g,256*(x=Math.pow(2,T)-x-1),T),I=vp(256*(g+1),256*(x+1),T);return C[0]+","+C[1]+","+I[0]+","+I[1]})(this.x,this.y,this.z),p=(function(g,x,T){let C,I="";for(let L=g;L>0;L--)C=1<<L-1,I+=(x&C?1:0)+(T&C?2:0);return I})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,p).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new N((e.x*n-this.x)*_t,(e.y*n-this.y)*_t)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kg{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Ih(e,n.z,n.z,n.x,n.y)}}class ja{constructor(e,n,o,u,p){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new vr(o,+u,+p),this.key=Ih(n,e,o,u,p)}clone(){return new ja(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new ja(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ja(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Ih(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Ih(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ja(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new ja(n,this.wrap,n,o,u),new ja(n,this.wrap,n,o+1,u),new ja(n,this.wrap,n,o,u+1),new ja(n,this.wrap,n,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ja(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ja(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Hn(e.x-this.wrap,e.y))}}function Ih(i,e,n,o,u){(i*=2)<0&&(i=-1*i-1);const p=1<<n;return(p*p*i+p*u+o).toString(36)+n.toString(36)+e.toString(36)}function jd(i,e){return e?i.properties[e]:i.id}function Pm(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=i.addOrUpdateProperties.findIndex((p=>p.key===o));u>-1&&i.addOrUpdateProperties.splice(u,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function Ud(i){var e,n;if(!i)return{};const o={};return o.removeAll=i.removeAll,o.remove=new Set(i.remove||[]),o.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((u=>[u.id,u]))),o}Rt("CanonicalTileID",vr),Rt("OverscaledTileID",ja,{omit:["terrainRttPosMatrix32f"]});class gc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new gc;return n.extend(e(new N(this.minX,this.minY))),n.extend(e(new N(this.maxX,this.minY))),n.extend(e(new N(this.minX,this.maxY))),n.extend(e(new N(this.maxX,this.maxY))),n}static fromPoints(e){const n=new gc;for(const o of e)n.extend(o);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Im{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class xp{constructor(e,n,o,u,p){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=n,this.properties=e.properties,this.id=p}projectPoint(e,n,o,u){return[360*(e.x+n)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,n,o,u){return e.map((p=>this.projectPoint(p,n,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,p=e.loadGeometry();switch(e.type){case 1:{const g=[];for(const T of p)g.push(T[0]);const x=this.projectLine(g,o,u,n);this._geometry=g.length===1?{type:"Point",coordinates:x[0]}:{type:"MultiPoint",coordinates:x};break}case 2:{const g=p.map((x=>this.projectLine(x,o,u,n)));this._geometry=g.length===1?{type:"LineString",coordinates:g[0]}:{type:"MultiLineString",coordinates:g};break}case 3:{const g=Cg(p),x=[];for(const T of g)x.push(T.map((C=>this.projectLine(C,o,u,n))));this._geometry=x.length===1?{type:"Polygon",coordinates:x[0]}:{type:"MultiPolygon",coordinates:x};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class yc{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,o){this._name=e,this.dataBuffer=n,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class bp extends yc{}class wp extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class km extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Rm extends yc{delta;constructor(e,n,o,u){super(e,n,u),this.delta=o}}class Lm extends Rm{constructor(e,n,o,u){super(e,Int32Array.of(n),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Om extends yc{constructor(e,n,o){super(e,Int32Array.of(n),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class _c{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,o,u,p=4096){this._name=e,this._geometryVector=n,this._idVector=o,this._propertyVectors=u,this._extent=p}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const u=e?.next().value,p={};for(const g of this.propertyVectors){if(!g)continue;const x=g.name,T=g.getValue(n);T!==null&&(p[x]=T)}n++,yield{id:o,geometry:u,properties:p}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const p={coordinates:n[o],type:this.geometryVector.geometryType(o)},g={};for(const x of this.propertyVectors){if(!x)continue;const T=x.name,C=x.getValue(o);C!==null&&(g[T]=C)}e.push({id:u,geometry:p,properties:g})}return e}containsMaxSaveIntegerValues(e){return e instanceof wp||e instanceof Om&&e instanceof Lm||e instanceof km}}class Wg{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var vn,so,Mr,oo,vc,Kr,Xi,dr,as,va;function fr(i,e,n){const o=new Int32Array(n);let u=0,p=e.get();for(let g=0;g<o.length;g++){let x=i[p++],T=127&x;x<128||(x=i[p++],T|=(127&x)<<7,x<128||(x=i[p++],T|=(127&x)<<14,x<128||(x=i[p++],T|=(127&x)<<21,x<128||(x=i[p++],T|=(15&x)<<28)))),o[u++]=T}return e.set(p),o}function Vd(i,e,n){const o=new BigInt64Array(n);for(let u=0;u<o.length;u++)o[u]=Tp(i,e);return o}function Qg(i,e){let n,o;return o=i[e.get()],e.increment(),n=127&o,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<7,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<14,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<21,o<128?n:(o=i[e.get()],n|=(15&o)<<28,(function(u,p,g){let x,T;if(T=p[g.get()],g.increment(),x=(112&T)>>4,T<128||(T=p[g.get()],g.increment(),x|=(127&T)<<3,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<10,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<17,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<24,T<128)||(T=p[g.get()],g.increment(),x|=(1&T)<<31,T<128))return 4294967296*x+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function kh(i,e,n,o){throw new Error("FastPFor is not implemented yet.")}function Ar(i){return i>>>1^-(1&i)}function Mu(i){return i>>1n^-(1n&i)}function Tp(i,e){let n=0n,o=0,u=e.get();for(;u<i.length;){const p=i[u++];if(n|=BigInt(127&p)<<BigInt(o),!(128&p))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),n}function No(i,e,n){const o=new Int32Array(n);let u=0;for(let p=0;p<e;p++){const g=i[p];o.fill(i[p+e],u,u+g),u+=g}return o}function Jg(i,e,n){const o=new BigInt64Array(n);let u=0;for(let p=0;p<e;p++){const g=Number(i[p]);o.fill(i[p+e],u,u+g),u+=g}return o}function ey(i,e,n){const o=new Float64Array(n);let u=0;for(let p=0;p<e;p++){const g=i[p];o.fill(i[p+e],u,u+g),u+=g}return o}function xc(i){const e=i.length/4*4;let n=1;if(e>=4)for(let o=i[0];n<e-4;n+=4)o=i[n]+=o,o=i[n+1]+=o,o=i[n+2]+=o,o=i[n+3]+=o;for(;n!=i.length;)i[n]+=i[n-1],++n}function Bm(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const o=i[n],u=i[n+1],p=i[n+2],g=i[n+3];i[n]=(o>>>1^-(1&o))+i[n-2],i[n+1]=(u>>>1^-(1&u))+i[n-1],i[n+2]=(p>>>1^-(1&p))+i[n],i[n+3]=(g>>>1^-(1&g))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(vn||(vn={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(so||(so={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(Mr||(Mr={}));class Nm{_dictionaryType;_offsetType;_lengthType;constructor(e,n,o){this._dictionaryType=e,this._offsetType=n,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Wr(i,e){const n=(function(o,u){const p=o[u.get()],g=Object.values(Mr)[p>>4];let x=null;switch(g){case Mr.DATA:x=new Nm(Object.values(oo)[15&p]);break;case Mr.OFFSET:x=new Nm(null,Object.values(vc)[15&p]);break;case Mr.LENGTH:x=new Nm(null,null,Object.values(Kr)[15&p])}u.increment();const T=o[u.get()],C=Object.values(vn)[T>>5],I=Object.values(vn)[T>>2&7],L=Object.values(so)[3&T];u.increment();const B=fr(o,u,2),F=B[0];return{physicalStreamType:g,logicalStreamType:x,logicalLevelTechnique1:C,logicalLevelTechnique2:I,physicalLevelTechnique:L,numValues:F,byteLength:B[1],decompressedCount:F}})(i,e);return n.logicalLevelTechnique1===vn.MORTON?(function(o,u,p){const g=fr(u,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:g[0],coordinateShift:g[1]}})(n,i,e):vn.RLE!==n.logicalLevelTechnique1&&vn.RLE!==n.logicalLevelTechnique2||so.NONE===n.physicalLevelTechnique?n:(function(o,u,p){const g=fr(u,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:g[1],runs:g[0],numRleValues:g[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(oo||(oo={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(vc||(vc={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(Kr||(Kr={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Xi||(Xi={}));class lo{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const o=Math.floor(e/8);this.values[o]=this.values[o]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Qr(i,e,n,o,u){return(function(p,g,x){switch(g.logicalLevelTechnique1){case vn.DELTA:return g.logicalLevelTechnique2===vn.RLE?(function(T,C,I){const L=new Int32Array(I);let B=0,F=0;for(let q=0;q<C;q++){const G=T[q],X=Ar(T[q+C]);for(let J=0;J<G;J++)F+=X,L[B++]=F}return L})(p,g.runs,g.numRleValues):((function(T){T[0]=T[0]>>>1^-(1&T[0]);const C=T.length/4*4;let I=1;if(C>=4)for(;I<C-4;I+=4){const L=T[I],B=T[I+1],F=T[I+2],q=T[I+3];T[I]=(L>>>1^-(1&L))+T[I-1],T[I+1]=(B>>>1^-(1&B))+T[I],T[I+2]=(F>>>1^-(1&F))+T[I+1],T[I+3]=(q>>>1^-(1&q))+T[I+2]}for(;I!=T.length;++I)T[I]=(T[I]>>>1^-(1&T[I]))+T[I-1]})(p),p);case vn.RLE:return(function(T,C,I){return I?(function(L,B,F){const q=new Int32Array(F);let G=0;for(let X=0;X<B;X++){const J=L[X];let he=L[X+B];he=he>>>1^-(1&he),q.fill(he,G,G+J),G+=J}return q})(T,C.runs,C.numRleValues):No(T,C.runs,C.numRleValues)})(p,g,x);case vn.MORTON:return xc(p),p;case vn.COMPONENTWISE_DELTA:return Bm(p),p;case vn.NONE:return x&&(function(T){for(let C=0;C<T.length;C++){const I=T[C];T[C]=I>>>1^-(1&I)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${g.logicalLevelTechnique1}`)}})(Sp(i,e,n),n,o)}function bc(i,e,n){return(function(o,u){if(u.logicalLevelTechnique1===vn.DELTA&&u.logicalLevelTechnique2===vn.NONE)return(function(g){const x=new Int32Array(g.length+1);x[0]=0,x[1]=Ar(g[0]);let T=x[1],C=2;for(;C!=x.length;++C){const I=g[C-1];T+=I>>>1^-(1&I),x[C]=x[C-1]+T}return x})(o);if(u.logicalLevelTechnique1===vn.RLE&&u.logicalLevelTechnique2===vn.NONE)return(function(g,x,T){const C=new Int32Array(T+1);C[0]=0;let I=1,L=C[0];for(let B=0;B<x;B++){const F=g[B],q=g[B+x];for(let G=I;G<I+F;G++)C[G]=q+L,L=C[G];I+=F}return C})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===vn.NONE&&u.logicalLevelTechnique2===vn.NONE){(function(g){let x=0;for(let T=0;T<g.length;T++)g[T]+=x,x=g[T]})(o);const p=new Int32Array(u.numValues+1);return p[0]=0,p.set(o,1),p}if(u.logicalLevelTechnique1===vn.DELTA&&u.logicalLevelTechnique2===vn.RLE){const p=(function(g,x,T){const C=new Int32Array(T+1);C[0]=0;let I=1,L=C[0];for(let B=0;B<x;B++){const F=g[B];let q=g[B+x];q=q>>>1^-(1&q);for(let G=I;G<I+F;G++)C[G]=q+L,L=C[G];I+=F}return C})(o,u.runs,u.numRleValues);return xc(p),p}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Sp(i,e,n),n)}function Sp(i,e,n){const o=n.physicalLevelTechnique;if(o===so.FAST_PFOR)return kh();if(o===so.VARINT)return fr(i,e,n.numValues);if(o===so.NONE){const u=e.get();e.add(n.byteLength);const p=i.subarray(u,e.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Fm(i,e,n,o){const u=Sp(i,e,n);if(u.length===1){const p=u[0];return o?Ar(p):p}return o?(function(p){return Ar(p[1])})(u):(function(p){return p[1]})(u)}function jm(i,e,n){return(function(o){if(o.length==2){const u=Ar(o[1]);return[u,u]}return[Ar(o[2]),Ar(o[3])]})(Sp(i,e,n))}function Au(i,e,n){return(function(o){if(o.length==2){const u=Mu(o[1]);return[u,u]}return[Mu(o[2]),Mu(o[3])]})(Vd(i,e,n.numValues))}function Rh(i,e,n,o){return(function(u,p,g){switch(p.logicalLevelTechnique1){case vn.DELTA:return p.logicalLevelTechnique2===vn.RLE?(function(x,T,C){const I=new BigInt64Array(C);let L=0,B=0n;for(let F=0;F<T;F++){const q=Number(x[F]),G=Mu(x[F+T]);for(let X=0;X<q;X++)B+=G,I[L++]=B}return I})(u,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>1n^-(1n&x[0]);const T=x.length/4*4;let C=1;if(T>=4)for(;C<T-4;C+=4){const I=x[C],L=x[C+1],B=x[C+2],F=x[C+3];x[C]=(I>>1n^-(1n&I))+x[C-1],x[C+1]=(L>>1n^-(1n&L))+x[C],x[C+2]=(B>>1n^-(1n&B))+x[C+1],x[C+3]=(F>>1n^-(1n&F))+x[C+2]}for(;C!=x.length;++C)x[C]=(x[C]>>1n^-(1n&x[C]))+x[C-1]})(u),u);case vn.RLE:return(function(x,T,C){return C?(function(I,L,B){const F=new BigInt64Array(B);let q=0;for(let G=0;G<L;G++){const X=Number(I[G]);let J=I[G+L];J=J>>1n^-(1n&J),F.fill(J,q,q+X),q+=X}return F})(x,T.runs,T.numRleValues):Jg(x,T.runs,T.numRleValues)})(u,p,g);case vn.NONE:return g&&(function(x){for(let T=0;T<x.length;T++){const C=x[T];x[T]=C>>1n^-(1n&C)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(Vd(i,e,n.numValues),n,o)}function Um(i,e,n,o){const u=Vd(i,e,n.numValues);if(u.length===1){const p=u[0];return o?Mu(p):p}return o?(function(p){return Mu(p[1])})(u):(function(p){return p[1]})(u)}function Vm(i,e,n,o,u){return(function(p,g,x,T){switch(g.logicalLevelTechnique1){case vn.DELTA:return g.logicalLevelTechnique2===vn.RLE&&(p=No(p,g.runs,g.numRleValues)),(function(C,I){const L=new Int32Array(C.size());let B=0;C.get(0)?(L[0]=C.get(0)?I[0]>>>1^-(1&I[0]):0,B=1):L[0]=0;let F=1;for(;F!=L.length;++F)L[F]=C.get(F)?L[F-1]+(I[B]>>>1^-(1&I[B++])):L[F-1];return L})(T,p);case vn.RLE:return(function(C,I,L,B){const F=I;return L?(function(q,G,X){const J=new Int32Array(q.size());let he=0;for(let ee=0;ee<X;ee++){const ae=G[ee];let ge=G[ee+X];ge=ge>>>1^-(1&ge);for(let be=he;be<he+ae;be++)q.get(be)?J[be]=ge:(J[be]=0,he++);he+=ae}return J})(B,C,F.runs):(function(q,G,X){const J=new Int32Array(q.size());let he=0;for(let ee=0;ee<X;ee++){const ae=G[ee],ge=G[ee+X];for(let be=he;be<he+ae;be++)q.get(be)?J[be]=ge:(J[be]=0,he++);he+=ae}return J})(B,C,F.runs)})(p,g,x,T);case vn.MORTON:return xc(p),p;case vn.COMPONENTWISE_DELTA:return Bm(p),p;case vn.NONE:return p=x?(function(C,I){const L=new Int32Array(C.size());let B=0,F=0;for(;F!=L.length;++F)if(C.get(F)){const q=I[B++];L[F]=q>>>1^-(1&q)}else L[F]=0;return L})(T,p):(function(C,I){const L=new Int32Array(C.size());let B=0,F=0;for(;F!=L.length;++F)L[F]=C.get(F)?I[B++]:0;return L})(T,p),p;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===so.FAST_PFOR?kh():fr(i,e,n.numValues),n,o,u)}function Al(i,e,n,o){const u=i.logicalLevelTechnique1;if(u===vn.RLE)return i.runs===1?Xi.CONST:Xi.FLAT;const p=e instanceof lo?e.size():e;if(u===vn.DELTA&&i.logicalLevelTechnique2===vn.RLE){const g=i.runs,x=2;if(i.numRleValues!==p)return Xi.FLAT;if(g===1)return Xi.SEQUENCE;if(g===2){const T=o.get();let C;if(i.physicalLevelTechnique===so.VARINT)C=fr(n,o,4);else{const I=o.get();C=new Int32Array(n.buffer,n.byteOffset+I,4)}if(o.set(T),C[2]===x&&C[3]===x)return Xi.SEQUENCE}}return i.numValues===1?Xi.CONST:Xi.FLAT}class Lh extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class qm extends Rm{constructor(e,n,o,u){super(e,BigInt64Array.of(n),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Cl{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,o){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function qd(i,e,n){return{x:Ep(i,e)-n,y:Ep(i>>1,e)-n}}function Ep(i,e){let n=0;for(let o=0;o<e;o++)n|=(i&1<<2*o)>>o;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(dr||(dr={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(as||(as={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(va||(va={}));class Mp{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function Gm(i){const e=new Array(i.numGeometries);let n=1,o=1,u=1,p=0;const g=new Mp;let x=0,T=0;const C=i.mortonSettings,I=i.topologyVector,L=I.geometryOffsets,B=I.partOffsets,F=I.ringOffsets,q=i.vertexOffsets,G=i.containsPolygonGeometry(),X=i.vertexBuffer;for(let J=0;J<i.numGeometries;J++){const he=i.geometryType(J);if(he===dr.POINT){if(q&&q.length!==0)if(i.vertexBufferType===va.VEC_2){const ee=2*q[T++],ae=new N(X[ee],X[ee+1]);e[p++]=g.createPoint(ae)}else{const ee=qd(X[q[T++]],C.numBits,C.coordinateShift),ae=new N(ee.x,ee.y);e[p++]=g.createPoint(ae)}else{const ee=new N(X[x++],X[x++]);e[p++]=g.createPoint(ee)}L&&u++,B&&n++,F&&o++}else if(he===dr.MULTIPOINT){const ee=L[u]-L[u-1];u++;const ae=new Array(ee);if(q&&q.length!==0){for(let ge=0;ge<ee;ge++){const be=2*q[T++];ae[ge]=new N(X[be],X[be+1])}e[p++]=g.createMultiPoint(ae)}else{for(let ge=0;ge<ee;ge++){const be=X[x++],je=X[x++];ae[ge]=new N(be,je)}e[p++]=g.createMultiPoint(ae)}}else if(he===dr.LINESTRING){let ee,ae=0;G?(ae=F[o]-F[o-1],o++):ae=B[n]-B[n-1],n++,q&&q.length!==0?(ee=i.vertexBufferType===va.VEC_2?Hd(X,q,T,ae,!1):Hm(X,q,T,ae,!1,C),T+=ae):(ee=Zm(X,x,ae,!1),x+=2*ae),e[p++]=g.createLineString(ee),L&&u++}else if(he===dr.POLYGON){const ee=B[n]-B[n-1];n++;const ae=new Array(ee-1);let ge=F[o]-F[o-1];if(o++,q&&q.length!==0){const be=i.vertexBufferType===va.VEC_2?Ap(X,q,T,ge):Zd(X,q,T,ge,0,C);T+=ge;for(let je=0;je<ae.length;je++)ge=F[o]-F[o-1],o++,ae[je]=i.vertexBufferType===va.VEC_2?Ap(X,q,T,ge):Zd(X,q,T,ge,0,C),T+=ge;e[p++]=g.createPolygon(be,ae)}else{const be=Gd(X,x,ge);x+=2*ge;for(let je=0;je<ae.length;je++)ge=F[o]-F[o-1],o++,ae[je]=Gd(X,x,ge),x+=2*ge;e[p++]=g.createPolygon(be,ae)}L&&u++}else if(he===dr.MULTILINESTRING){const ee=L[u]-L[u-1];u++;const ae=new Array(ee);if(q&&q.length!==0){for(let ge=0;ge<ee;ge++){let be=0;G?(be=F[o]-F[o-1],o++):be=B[n]-B[n-1],n++;const je=i.vertexBufferType===va.VEC_2?Hd(X,q,T,be,!1):Hm(X,q,T,be,!1,C);ae[ge]=je,T+=be}e[p++]=g.createMultiLineString(ae)}else{for(let ge=0;ge<ee;ge++){let be=0;G?(be=F[o]-F[o-1],o++):be=B[n]-B[n-1],n++,ae[ge]=Zm(X,x,be,!1),x+=2*be}e[p++]=g.createMultiLineString(ae)}}else{if(he!==dr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ee=L[u]-L[u-1];u++;const ae=new Array(ee);let ge=0;if(q&&q.length!==0){for(let be=0;be<ee;be++){const je=B[n]-B[n-1];n++;const ot=new Array(je-1);ge=F[o]-F[o-1],o++;const Ke=i.vertexBufferType===va.VEC_2?Ap(X,q,T,ge):Zd(X,q,T,ge,0,C);T+=ge;for(let ft=0;ft<ot.length;ft++)ge=F[o]-F[o-1],o++,ot[ft]=i.vertexBufferType===va.VEC_2?Ap(X,q,T,ge):Zd(X,q,T,ge,0,C),T+=ge;ae[be]=g.createPolygon(Ke,ot)}e[p++]=g.createMultiPolygon(ae)}else{for(let be=0;be<ee;be++){const je=B[n]-B[n-1];n++;const ot=new Array(je-1);ge=F[o]-F[o-1],o++;const Ke=Gd(X,x,ge);x+=2*ge;for(let ft=0;ft<ot.length;ft++){const zt=F[o]-F[o-1];o++,ot[ft]=Gd(X,x,zt),x+=2*zt}ae[be]=g.createPolygon(Ke,ot)}e[p++]=g.createMultiPolygon(ae)}}}}return e}function Gd(i,e,n){return Zm(i,e,n,!0)}function Ap(i,e,n,o){return Hd(i,e,n,o,!0)}function Zd(i,e,n,o,u,p){return Hm(i,e,n,o,!0,p)}function Zm(i,e,n,o){const u=new Array(o?n+1:n);for(let p=0;p<2*n;p+=2)u[p/2]=new N(i[e+p],i[e+p+1]);return o&&(u[u.length-1]=u[0]),u}function Hd(i,e,n,o,u){const p=new Array(u?o+1:o);for(let g=0;g<2*o;g+=2){const x=2*e[n+g/2];p[g/2]=new N(i[x],i[x+1])}return u&&(p[p.length-1]=p[0]),p}function Hm(i,e,n,o,u,p){const g=new Array(u?o+1:o);for(let x=0;x<o;x++){const T=qd(i[e[n+x]],p.numBits,p.coordinateShift);g[x]=new N(T.x,T.y)}return u&&(g[g.length-1]=g[0]),g}class $d{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,o,u,p){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=p}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Gm(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=qd(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return Gm(this)}get mortonSettings(){return this._mortonSettings}}class Xd extends $d{_numGeometries;_geometryType;constructor(e,n,o,u,p,g,x){super(o,u,p,g,x),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===dr.POLYGON||this._geometryType===dr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Yd extends $d{_geometryTypes;constructor(e,n,o,u,p,g){super(e,o,u,p,g),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===dr.POLYGON||this.geometryType(e)===dr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class ty{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,o,u){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,o=n.partOffsets,u=n.ringOffsets,p=n.geometryOffsets;let g=0,x=1,T=1,C=1;for(let I=0;I<this.numGeometries;I++)switch(this.geometryType(I)){case dr.POLYGON:{const L=o[x]-o[x-1];x++;const B=[];for(let F=0;F<L;F++){const q=u[T]-u[T-1];T++;const G=[];for(let X=0;X<q;X++){const J=this._vertexBuffer[g++],he=this._vertexBuffer[g++];G.push(new N(J,he))}G.length>0&&G.push(G[0]),B.push(G)}e[I]=B,p&&C++}break;case dr.MULTIPOLYGON:{const L=p[C]-p[C-1];C++;const B=[];for(let F=0;F<L;F++){const q=o[x]-o[x-1];x++;for(let G=0;G<q;G++){const X=u[T]-u[T-1];T++;const J=[];for(let he=0;he<X;he++){const ee=this._vertexBuffer[g++],ae=this._vertexBuffer[g++];J.push(new N(ee,ae))}J.length>0&&J.push(J[0]),B.push(J)}}e[I]=B}}return e}[Symbol.iterator](){return null}}function Oh(i,e,n,o,u,p){return new t_(i,e,n,o,u,p)}class t_ extends ty{_numGeometries;_geometryType;constructor(e,n,o,u,p,g){super(o,u,p,g),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function $m(i,e,n,o,u){return new ny(i,e,n,o,u)}class ny extends ty{_geometryTypes;constructor(e,n,o,u,p){super(n,o,u,p),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function iy(i,e,n,o,u){const p=Wr(i,n);let g=null,x=null,T=null,C=null,I=null,L=null,B=null,F=null;if(Al(p,o,i,n)===Xi.CONST){const G=Fm(i,n,p,!1);for(let X=0;X<e-1;X++){const J=Wr(i,n);switch(J.physicalStreamType){case Mr.LENGTH:switch(J.logicalStreamType.lengthType){case Kr.GEOMETRIES:g=bc(i,n,J);break;case Kr.PARTS:x=bc(i,n,J);break;case Kr.RINGS:T=bc(i,n,J);break;case Kr.TRIANGLES:B=bc(i,n,J)}break;case Mr.OFFSET:switch(J.logicalStreamType.offsetType){case vc.VERTEX:C=Qr(i,n,J,!1);break;case vc.INDEX:F=Qr(i,n,J,!1)}break;case Mr.DATA:oo.VERTEX===J.logicalStreamType.dictionaryType?I=Qr(i,n,J,!0):(L={numBits:J.numBits,coordinateShift:J.coordinateShift},I=Qr(i,n,J,!1))}}return F!==null?g!=null||x!=null?Oh(o,G,B,F,I,new Cl(g,x,T)):Oh(o,G,B,F,I):L===null?(function(X,J,he,ee,ae){return new Xd(X,J,va.VEC_2,he,ee,ae)})(o,G,new Cl(g,x,T),C,I):(function(X,J,he,ee,ae,ge){return new Xd(X,J,va.MORTON,he,ee,ae,ge)})(o,G,new Cl(g,x,T),C,I,L)}const q=Qr(i,n,p,!1);for(let G=0;G<e-1;G++){const X=Wr(i,n);switch(X.physicalStreamType){case Mr.LENGTH:switch(X.logicalStreamType.lengthType){case Kr.GEOMETRIES:g=Qr(i,n,X,!1);break;case Kr.PARTS:x=Qr(i,n,X,!1);break;case Kr.RINGS:T=Qr(i,n,X,!1);break;case Kr.TRIANGLES:B=bc(i,n,X)}break;case Mr.OFFSET:switch(X.logicalStreamType.offsetType){case vc.VERTEX:C=Qr(i,n,X,!1);break;case vc.INDEX:F=Qr(i,n,X,!1)}break;case Mr.DATA:oo.VERTEX===X.logicalStreamType.dictionaryType?I=Qr(i,n,X,!0):(L={numBits:X.numBits,coordinateShift:X.coordinateShift},I=Qr(i,n,X,!1))}}return F!==null&&x===null?$m(q,B,F,I):(g!==null?(g=Cp(q,g,2),x!==null&&T!==null?(x=zp(q,g,x,!1),T=(function(G,X,J,he){const ee=new Int32Array(J[J.length-1]+1);let ae=0;ee[0]=ae;let ge=1,be=1,je=0;for(let ot=0;ot<G.length;ot++){const Ke=G[ot],ft=X[ot+1]-X[ot];if(Ke!==0&&Ke!==3)for(let zt=0;zt<ft;zt++){const gt=J[ge]-J[ge-1];ge++;for(let et=0;et<gt;et++)ae=ee[be++]=ae+he[je++]}else for(let zt=0;zt<ft;zt++)ee[be++]=++ae,ge++}return ee})(q,g,x,T)):x!==null&&(x=(function(G,X,J){const he=new Int32Array(X[X.length-1]+1);let ee=0;he[0]=ee;let ae=1,ge=0;for(let be=0;be<G.length;be++){const je=G[be],ot=X[be+1]-X[be];if(je===4||je===1)for(let Ke=0;Ke<ot;Ke++)ee=he[ae++]=ee+J[ge++];else for(let Ke=0;Ke<ot;Ke++)he[ae++]=++ee}return he})(q,g,x))):x!==null&&T!==null?(x=Cp(q,x,1),T=zp(q,x,T,!0)):x!==null&&(x=Cp(q,x,0)),F!==null?$m(q,B,F,I,new Cl(g,x,T)):L===null?(function(G,X,J,he){return new Yd(va.VEC_2,G,X,J,he)})(q,new Cl(g,x,T),C,I):(function(G,X,J,he,ee){return new Yd(va.MORTON,G,X,J,he,ee)})(q,new Cl(g,x,T),C,I,L))}function Cp(i,e,n){const o=new Int32Array(i.length+1);let u=0;o[0]=u;let p=0;for(let g=0;g<i.length;g++)u=o[g+1]=u+(i[g]>n?e[p++]:1);return o}function zp(i,e,n,o){const u=new Int32Array(e[e.length-1]+1);let p=0;u[0]=p;let g=1,x=0;for(let T=0;T<i.length;T++){const C=i[T],I=e[T+1]-e[T];if(C===5||C===2||o&&(C===4||C===1))for(let L=0;L<I;L++)p=u[g++]=p+n[x++];else for(let L=0;L<I;L++)u[g++]=++p}return u}class ry extends yc{dataVector;constructor(e,n,o){super(e,n.getBuffer(),o),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class ay extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Kd extends yc{constructor(e,n,o){super(e,BigInt64Array.of(n),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Wd(i,e,n){return sy(i,Math.ceil(e/8),n)}function sy(i,e,n){const o=new Uint8Array(e);let u=0;for(;u<e;){const p=i[n.increment()];if(p<=127){const g=p+3,x=i[n.increment()],T=u+g;o.fill(x,u,T),u=T}else{const g=256-p;for(let x=0;x<g;x++)o[u++]=i[n.increment()]}}return o}const Xm=new TextDecoder;function Qd(i,e,n){return n-e>=12?Xm.decode(i.subarray(e,n)):(function(o,u,p){let g="",x=u;for(;x<p;){const T=o[x];let C,I,L,B=null,F=T>239?4:T>223?3:T>191?2:1;if(x+F>p)break;F===1?T<128&&(B=T):F===2?(C=o[x+1],(192&C)==128&&(B=(31&T)<<6|63&C,B<=127&&(B=null))):F===3?(C=o[x+1],I=o[x+2],(192&C)==128&&(192&I)==128&&(B=(15&T)<<12|(63&C)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(C=o[x+1],I=o[x+2],L=o[x+3],(192&C)==128&&(192&I)==128&&(192&L)==128&&(B=(15&T)<<18|(63&C)<<12|(63&I)<<6|63&L,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),x+=F}return g})(i,e,n)}class Bh extends yc{offsetBuffer;constructor(e,n,o,u){super(e,o,u),this.offsetBuffer=n}}class Dp extends Bh{textEncoder;constructor(e,n,o,u){super(e,n,o,u??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Qd(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Cu extends Bh{indexBuffer;textEncoder;constructor(e,n,o,u,p){super(e,o,u,p??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return Qd(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class Pp extends Bh{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,o,u,p,g,x){super(e,o,u,x),this.indexBuffer=n,this.symbolOffsetBuffer=p,this.symbolTableBuffer=g,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,p){const g=[],x=new Array(u.length).fill(0);for(let T=1;T<u.length;T++)x[T]=x[T-1]+u[T-1];for(let T=0;T<p.length;T++)if(p[T]===255)g.push(p[++T]);else{const C=u[p[T]],I=x[p[T]];for(let L=0;L<C;L++)g.push(o[I+L])}return new Uint8Array(g)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return Qd(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const p=e[u];n[u-1]=p-o,o=p}return n}}function wc(i,e,n,o,u,p){return n.type==="scalarType"?(function(g,x,T,C,I,L){let B=null,F=0;if(g===0)return null;if(L.nullable){const G=Wr(x,T);F=G.numValues;const X=T.get(),J=Wd(x,F,T);T.set(X+G.byteLength),B=new lo(J,G.numValues)}const q=B??C;switch(I.physicalType){case 4:case 3:return(function(G,X,J,he,ee){const ae=Wr(G,X),ge=Al(ae,ee,G,X),be=he.physicalType===3;if(ge===Xi.FLAT){const je=Bs(ee)?Vm(G,X,ae,be,ee):Qr(G,X,ae,be);return new wp(J.name,je,ee)}if(ge===Xi.SEQUENCE){const je=jm(G,X,ae);return new Lm(J.name,je[0],je[1],ae.numRleValues)}{const je=Fm(G,X,ae,be);return new Om(J.name,je,ee)}})(x,T,L,I,q);case 9:return(function(G,X,J,he,ee){let ae=null,ge=null,be=null,je=null,ot=null,Ke=null,ft=null,zt=null;for(let gt=0;gt<he;gt++){const et=Wr(X,J);if(et.byteLength!==0)switch(et.physicalStreamType){case Mr.PRESENT:{const Ze=Wd(X,et.numValues,J);Ke=new lo(Ze,et.numValues);break}case Mr.OFFSET:ge=ee!=null||Ke!=null?Vm(X,J,et,!1,ee??Ke):Qr(X,J,et,!1);break;case Mr.LENGTH:{const Ze=bc(X,J,et);Kr.DICTIONARY===et.logicalStreamType.lengthType?ae=Ze:Kr.SYMBOL===et.logicalStreamType.lengthType?je=Ze:ft=Ze;break}case Mr.DATA:{const Ze=X.subarray(J.get(),J.get()+et.byteLength);J.add(et.byteLength);const Nt=et.logicalStreamType.dictionaryType;oo.FSST===Nt?ot=Ze:oo.SINGLE===Nt||oo.SHARED===Nt?be=Ze:oo.NONE===Nt&&(zt=Ze);break}}}return(function(gt,et,Ze,Nt,Lt,Ut,kt){return et?new Pp(gt,Ze,Nt,Lt,Ut,et,kt):null})(G,ot,ge,ae,be,je,ee??Ke)??(function(gt,et,Ze,Nt,Lt){return et?Lt?new Cu(gt,Ze,Nt,et,Lt):new Cu(gt,Ze,Nt,et):null})(G,be,ge,ae,ee??Ke)??(function(gt,et,Ze,Nt,Lt){if(!et||!Ze)return null;if(Nt)return Lt?new Cu(gt,Nt,et,Ze,Lt):new Cu(gt,Nt,et,Ze);if(Lt&&Lt.size()!==et.length-1){const Ut=new Int32Array(Lt.size());let kt=0;for(let $t=0;$t<Lt.size();$t++)Ut[$t]=Lt.get($t)?kt++:0;return new Cu(gt,Ut,et,Ze,Lt)}return Lt?new Dp(gt,et,Ze,Lt):new Dp(gt,et,Ze)})(G,ft,zt,ge,ee??Ke)})(L.name,x,T,L.nullable?g-1:g,B);case 0:return(function(G,X,J,he,ee){const ae=Wr(G,X),ge=ae.numValues,be=X.get(),je=Bs(ee)?(function(Ke,ft,zt,gt){const et=sy(Ke,Math.ceil(ft/8),zt),Ze=new lo(et,ft),Nt=gt.size(),Lt=new lo(new Uint8Array(Nt),Nt);let Ut=0;for(let kt=0;kt<gt.size();kt++){const $t=!!gt.get(kt)&&Ze.get(Ut++);Lt.set(kt,$t)}return Lt.getBuffer()})(G,ge,X,ee):Wd(G,ge,X);X.set(be+ae.byteLength);const ot=new lo(je,ge);return new ry(J.name,ot,ee)})(x,T,L,0,q);case 6:case 5:return(function(G,X,J,he,ee){const ae=Wr(G,X),ge=Al(ae,he,G,X),be=ee.physicalType===5;if(ge===Xi.FLAT){const je=Bs(he)?(function(ot,Ke,ft,zt,gt){return(function(et,Ze,Nt,Lt){switch(Ze.logicalLevelTechnique1){case vn.DELTA:return Ze.logicalLevelTechnique2===vn.RLE&&(et=Jg(et,Ze.runs,Ze.numRleValues)),(function(Ut,kt){const $t=new BigInt64Array(Ut.size());let Bn=0;Ut.get(0)?($t[0]=Ut.get(0)?kt[0]>>1n^-(1n&kt[0]):0n,Bn=1):$t[0]=0n;let wn=1;for(;wn!=$t.length;++wn)$t[wn]=Ut.get(wn)?$t[wn-1]+(kt[Bn]>>1n^-(1n&kt[Bn++])):$t[wn-1];return $t})(Lt,et);case vn.RLE:return(function(Ut,kt,$t,Bn){const wn=kt;return $t?(function(Pi,Jr,pr){const Ii=new BigInt64Array(Pi.size());let bi=0;for(let Xn=0;Xn<pr;Xn++){const qi=Number(Jr[Xn]);let Yi=Jr[Xn+pr];Yi=Yi>>1n^-(1n&Yi);for(let yi=bi;yi<bi+qi;yi++)Pi.get(yi)?Ii[yi]=Yi:(Ii[yi]=0n,bi++);bi+=qi}return Ii})(Bn,Ut,wn.runs):(function(Pi,Jr,pr){const Ii=new BigInt64Array(Pi.size());let bi=0;for(let Xn=0;Xn<pr;Xn++){const qi=Number(Jr[Xn]),Yi=Jr[Xn+pr];for(let yi=bi;yi<bi+qi;yi++)Pi.get(yi)?Ii[yi]=Yi:(Ii[yi]=0n,bi++);bi+=qi}return Ii})(Bn,Ut,wn.runs)})(et,Ze,Nt,Lt);case vn.NONE:return et=Nt?(function(Ut,kt){const $t=new BigInt64Array(Ut.size());let Bn=0,wn=0;for(;wn!=$t.length;++wn)if(Ut.get(wn)){const Pi=kt[Bn++];$t[wn]=Pi>>1n^-(1n&Pi)}else $t[wn]=0n;return $t})(Lt,et):(function(Ut,kt){const $t=new BigInt64Array(Ut.size());let Bn=0,wn=0;for(;wn!=$t.length;++wn)$t[wn]=Ut.get(wn)?kt[Bn++]:0n;return $t})(Lt,et),et;default:throw new Error("The specified Logical level technique is not supported")}})(Vd(ot,Ke,ft.numValues),ft,zt,gt)})(G,X,ae,be,he):Rh(G,X,ae,be);return new Lh(J.name,je,he)}if(ge===Xi.SEQUENCE){const je=Au(G,X,ae);return new qm(J.name,je[0],je[1],ae.numRleValues)}{const je=Um(G,X,ae,be);return new Kd(J.name,je,he)}})(x,T,L,q,I);case 7:return(function(G,X,J,he){const ee=Wr(G,X),ae=Bs(he)?(function(ge,be,je,ot){const Ke=be.get(),ft=Ke+ot*Float32Array.BYTES_PER_ELEMENT,zt=new Uint8Array(ge.subarray(Ke,ft)).buffer,gt=new Float32Array(zt);be.set(ft);const et=je.size(),Ze=new Float32Array(et);let Nt=0;for(let Lt=0;Lt<et;Lt++)Ze[Lt]=je.get(Lt)?gt[Nt++]:0;return Ze})(G,X,he,ee.numValues):(function(ge,be,je){const ot=be.get(),Ke=ot+je*Float32Array.BYTES_PER_ELEMENT,ft=new Uint8Array(ge.subarray(ot,Ke)).buffer,zt=new Float32Array(ft);return be.set(Ke),zt})(G,X,ee.numValues);return new ay(J.name,ae,he)})(x,T,L,q);case 8:return(function(G,X,J,he){const ee=Wr(G,X),ae=Bs(he)?(function(ge,be,je,ot){const Ke=be.get(),ft=Ke+ot*Float64Array.BYTES_PER_ELEMENT,zt=new Uint8Array(ge.subarray(Ke,ft)).buffer,gt=new Float64Array(zt);be.set(ft);const et=je.size(),Ze=new Float64Array(et);let Nt=0;for(let Lt=0;Lt<et;Lt++)Ze[Lt]=je.get(Lt)?gt[Nt++]:0;return Ze})(G,X,he,ee.numValues):(function(ge,be,je){const ot=be.get(),Ke=ot+je*Float64Array.BYTES_PER_ELEMENT,ft=new Uint8Array(ge.subarray(ot,Ke)).buffer,zt=new Float64Array(ft);return be.set(Ke),zt})(G,X,ee.numValues);return new km(J.name,ae,he)})(x,T,L,q);default:throw new Error(`The specified data type for the field is currently not supported: ${I}`)}})(o,i,e,u,n.scalarType,n):o!=1?null:(function(g,x,T,C){let I=null,L=null,B=null,F=null,q=!1;for(;!q;){const he=Wr(g,x);switch(he.physicalStreamType){case Mr.LENGTH:Kr.DICTIONARY===he.logicalStreamType.lengthType?I=bc(g,x,he):B=bc(g,x,he);break;case Mr.DATA:oo.SINGLE===he.logicalStreamType.dictionaryType||oo.SHARED===he.logicalStreamType.dictionaryType?(L=g.subarray(x.get(),x.get()+he.byteLength),q=!0):F=g.subarray(x.get(),x.get()+he.byteLength),x.add(he.byteLength)}}const G=T.complexType.children,X=[];let J=0;for(const he of G){const ee=fr(g,x,1)[0];if(ee==0)continue;const ae=`${T.name}${he.name==="default"?"":":"+he.name}`;if(ee!==2||he.type!=="scalarField"||he.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const ge=Wr(g,x),be=Wd(g,ge.numValues,x),je=Wr(g,x),ot=je.decompressedCount!==C?Vm(g,x,je,!1,new lo(be,ge.numValues)):Qr(g,x,je,!1);X[J++]=F?new Pp(ae,ot,I,L,B,F,new lo(be,ge.numValues)):new Cu(ae,ot,I,L,new lo(be,ge.numValues))}return X})(i,e,n,u)}function Bs(i){return i instanceof lo}function Tc(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Jd=new TextDecoder;function Nh(i,e){const n=fr(i,e,1)[0];if(n===0)return"";const o=e.get(),u=i.subarray(o,o+n);return e.add(n),Jd.decode(u)}function zl(i,e){const n=fr(i,e,1)[0]>>>0,o=!!(4&n),u=!!(2&n),p=fr(i,e,1)[0]>>>0,g={};if(1&n&&(g.nullable=!0),u){const x={};if(o?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),8&n){const T=fr(i,e,1)[0]>>>0;x.children=new Array(T);for(let C=0;C<T;C++)x.children[C]=zl(i,e)}g.type="complexField",g.complexField=x}else{const x={};o?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),g.type="scalarField",g.scalarField=x}return g}function n_(i,e){const n=fr(i,e,1)[0]>>>0,o=(function(u){switch(u){case 0:case 1:case 2:case 3:{const p={};p.nullable=!!(1&u),p.columnScope=0;const g={};return g.physicalType=u>1?6:4,g.type="physicalType",p.scalarType=g,p.type="scalarType",p}case 4:{const p={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:0};return p.type="complexType",p.complexType=g,p}case 30:{const p={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:1};return p.type="complexType",p.complexType=g,p}default:return(function(p){let g=null;switch(p){case 10:case 11:g=0;break;case 12:case 13:g=1;break;case 14:case 15:g=2;break;case 16:case 17:g=3;break;case 18:case 19:g=4;break;case 20:case 21:g=5;break;case 22:case 23:g=6;break;case 24:case 25:g=7;break;case 26:case 27:g=8;break;case 28:case 29:g=9;break;default:return null}const x={};x.nullable=!!(1&p),x.columnScope=0;const T={type:"physicalType"};return T.physicalType=g,x.type="scalarType",x.scalarType=T,x})(u)}})(n);if(!o)throw new Error(`Unsupported column type code: ${n}`);if((function(u){return u>=10})(n)?o.name=Nh(i,e):n>=0&&n<=3?o.name="id":n===4&&(o.name="geometry"),(function(u){return u===30})(n)){const u=fr(i,e,1)[0]>>>0,p=o.complexType;p.children=new Array(u);for(let g=0;g<u;g++)p.children[g]=zl(i,e)}return o}function oy(i,e){const n={featureTables:[]},o={};o.name=Nh(i,e);const u=fr(i,e,1)[0]>>>0,p=fr(i,e,1)[0]>>>0;o.columns=new Array(p);for(let g=0;g<p;g++)o.columns[g]=n_(i,e);return n.featureTables.push(o),[n,u]}function ef(i,e,n,o,u,p,g=!1){const x=e.scalarType.physicalType,T=Al(u,p,i,n);if(x===4)switch(T){case Xi.FLAT:{const C=Qr(i,n,u,!1);return new wp(o,C,p)}case Xi.SEQUENCE:{const C=jm(i,n,u);return new Lm(o,C[0],C[1],u.numRleValues)}case Xi.CONST:{const C=Fm(i,n,u,!1);return new Om(o,C,p)}}else switch(T){case Xi.FLAT:{if(g){const I=(function(L,B,F,q){const G=(function(X,J,he){const ee=new Float64Array(J);for(let ae=0;ae<J;ae++)ee[ae]=Qg(X,he);return ee})(L,F.numValues,B);return(function(X,J,he){switch(J.logicalLevelTechnique1){case vn.DELTA:return J.logicalLevelTechnique2===vn.RLE&&(X=ey(X,J.runs,J.numRleValues)),(function(ee){ee[0]=ee[0]%2==1?(ee[0]+1)/-2:ee[0]/2;const ae=ee.length/4*4;let ge=1;if(ae>=4)for(;ge<ae-4;ge+=4){const be=ee[ge],je=ee[ge+1],ot=ee[ge+2],Ke=ee[ge+3];ee[ge]=(be%2==1?(be+1)/-2:be/2)+ee[ge-1],ee[ge+1]=(je%2==1?(je+1)/-2:je/2)+ee[ge],ee[ge+2]=(ot%2==1?(ot+1)/-2:ot/2)+ee[ge+1],ee[ge+3]=(Ke%2==1?(Ke+1)/-2:Ke/2)+ee[ge+2]}for(;ge!=ee.length;++ge)ee[ge]=(ee[ge]%2==1?(ee[ge]+1)/-2:ee[ge]/2)+ee[ge-1]})(X),X;case vn.RLE:return(function(ee,ae,ge){return ey(ee,ae.runs,ae.numRleValues)})(X,J);case vn.NONE:return X;default:throw new Error(`The specified Logical level technique is not supported: ${J.logicalLevelTechnique1}`)}})(G,F)})(i,n,u);return new km(o,I,p)}const C=Rh(i,n,u,!1);return new Lh(o,C,p)}case Xi.SEQUENCE:{const C=Au(i,n,u);return new qm(o,C[0],C[1],u.numRleValues)}case Xi.CONST:{const C=Um(i,n,u,!1);return new Kd(o,C,p)}}throw new Error("Vector type not supported for id column.")}class i_{constructor(e,n){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case dr.POINT:case dr.MULTIPOINT:this.type=1;break;case dr.LINESTRING:case dr.MULTILINESTRING:this.type=2;break;case dr.POLYGON:case dr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const o=[];for(const u of n)o.push(new N(u.x,u.y));e.push(o)}return e}}class ly{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new i_(this.features[e],this.extent)}}class tf{constructor(e){this.layers={};const n=(function(o,u,p=!0){const g=new Wg(0),x=[];for(;g.get()<o.length;){const T=fr(o,g,1)[0]>>>0,C=g.get()+T;if(C>o.length)throw new Error(`Block overruns tile: ${C} > ${o.length}`);if(fr(o,g,1)[0]>>>0!=1){g.set(C);continue}const I=oy(o,g),L=I[1],B=I[0].featureTables[0];let F=null,q=null;const G=[];let X=0;for(const he of B.columns){const ee=he.name;if(ee==="id"){let ae=null;if(he.nullable){const be=Wr(o,g),je=g.get(),ot=Wd(o,be.numValues,g);g.set(je+be.byteLength),ae=new lo(ot,be.numValues)}const ge=Wr(o,g);X=ge.decompressedCount,F=ef(o,he,g,ee,ge,ae??X,p)}else if(ee==="geometry"){const ae=fr(o,g,1)[0];if(X===0){const ge=g.get();X=Wr(o,g).decompressedCount,g.set(ge)}q=iy(o,ae,g,X)}else{const ae=Tc(he)?fr(o,g,1)[0]:1;if(ae===0&&he.type==="scalarType")continue;const ge=wc(o,g,he,ae,X);if(ge)if(Array.isArray(ge))for(const be of ge)G.push(be);else G.push(ge)}}const J=new _c(B.name,q,F,G,L);x.push(J),g.set(C)}return x})(new Uint8Array(e));this.layers=n.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new ly(u)})),{})}}class cy{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of n){const u=[];for(const p of o)u.push(new N(p[0],p[1]));e.push(u)}return e}}const nf="_geojsonTileLayer";function Ip(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let p=0;p<i.length;p++)n.feature=i.feature(p),e.writeMessage(2,kp,n);const o=n.keys;for(const p of o)e.writeStringField(3,p);const u=n.values;for(const p of u)e.writeMessage(4,Rp,p)}function kp(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,uy,i),e.writeVarintField(3,n.type),e.writeMessage(4,Km,n)}function uy(i,e){for(const n in i.feature?.properties){let o=i.feature.properties[n],u=i.keycache[n];if(o==null)continue;u===void 0&&(i.keys.push(n),u=i.keys.length-1,i.keycache[n]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const p=typeof o+":"+o;let g=i.valuecache[p];g===void 0&&(i.values.push(o),g=i.values.length-1,i.valuecache[p]=g),e.writeVarint(g)}}function Sc(i,e){return(e<<3)+(7&i)}function Ym(i){return i<<1^i>>31}function Km(i,e){const n=i.loadGeometry(),o=i.type;let u=0,p=0;for(const g of n){let x=1;o===1&&(x=g.length),e.writeVarint(Sc(1,x));const T=o===3?g.length-1:g.length;for(let C=0;C<T;C++){C===1&&o!==1&&e.writeVarint(Sc(2,T-1));const I=g[C].x-u,L=g[C].y-p;e.writeVarint(Ym(I)),e.writeVarint(Ym(L)),u+=I,p+=L}i.type===3&&e.writeVarint(Sc(7,1))}}function Rp(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Wm{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Co(_t,16,0),this.grid3D=new Co(_t,16,0),this.featureIndexArray=new W,this.promoteId=n}insert(e,n,o,u,p,g){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,p);const T=g?this.grid3D:this.grid;for(let C=0;C<n.length;C++){const I=n[C],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<I.length;B++){const F=I[B];L[0]=Math.min(L[0],F.x),L[1]=Math.min(L[1],F.y),L[2]=Math.max(L[2],F.x),L[3]=Math.max(L[3],F.y)}L[0]<_t&&L[1]<_t&&L[2]>=0&&L[3]>=0&&T.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new In(new sp(this.rawTileData)).layers:new tf(this.rawTileData).layers,this.sourceLayerCoder=new Im(this.vtLayers?Object.keys(this.vtLayers).sort():[nf])),this.vtLayers}query(e,n,o,u){this.loadVTLayers();const p=e.params,g=_t/e.tileSize/e.scale,x=qr(p.filter,p.globalState),T=e.queryGeometry,C=e.queryPadding*g,I=gc.fromPoints(T),L=this.grid.query(I.minX-C,I.minY-C,I.maxX+C,I.maxY+C),B=gc.fromPoints(e.cameraQueryGeometry).expandBy(C),F=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,((X,J,he,ee)=>(function(ae,ge,be,je,ot){for(const ft of ae)if(ge<=ft.x&&be<=ft.y&&je>=ft.x&&ot>=ft.y)return!0;const Ke=[new N(ge,be),new N(ge,ot),new N(je,ot),new N(je,be)];if(ae.length>2){for(const ft of Ke)if(ko(ae,ft))return!0}for(let ft=0;ft<ae.length-1;ft++)if(mg(ae[ft],ae[ft+1],Ke))return!0;return!1})(e.cameraQueryGeometry,X-C,J-C,he+C,ee+C)));for(const X of F)L.push(X);L.sort(Lp);const q={};let G;for(let X=0;X<L.length;X++){const J=L[X];if(J===G)continue;G=J;const he=this.featureIndexArray.get(J);let ee=null;this.loadMatchingFeature(q,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,x,p.layers,p.availableImages,n,o,u,((ae,ge,be)=>(ee||(ee=no(ae)),ge.queryIntersectsFeature({queryGeometry:T,feature:ae,featureState:be,geometry:ee,zoom:this.z,transform:e.transform,pixelsToTileUnits:g,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return q}loadMatchingFeature(e,n,o,u,p,g,x,T,C,I,L){const B=this.bucketLayerIDs[n];if(g&&!B.some((X=>g.has(X))))return;const F=this.sourceLayerCoder.decode(o),q=this.vtLayers[F].feature(u);if(p.needGeometry){const X=ns(q,!0);if(!p.filter(new jn(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!p.filter(new jn(this.tileID.overscaledZ),q))return;const G=this.getId(q,F);for(let X=0;X<B.length;X++){const J=B[X];if(g&&!g.has(J))continue;const he=T[J];if(!he)continue;let ee={};G&&I&&(ee=I.getState(he.sourceLayer||nf,G));const ae=rn({},C[J]);ae.paint=hy(ae.paint,he.paint,q,ee,x),ae.layout=hy(ae.layout,he.layout,q,ee,x);const ge=!L||L(q,he,ee);if(!ge)continue;const be=new xp(q,this.z,this.x,this.y,G);be.layer=ae;let je=e[J];je===void 0&&(je=e[J]=[]),je.push({featureIndex:u,feature:be,intersectionZ:ge})}}lookupSymbolFeatures(e,n,o,u,p,g,x,T){const C={};this.loadVTLayers();const I=qr(p.filterSpec,p.globalState);for(const L of e)this.loadMatchingFeature(C,o,u,L,I,g,x,T,n);return C}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function hy(i,e,n,o,u){return on(i,((p,g)=>{const x=e instanceof hl?e.get(g):null;return x&&x.evaluate?x.evaluate(n,o,u):x}))}function Lp(i,e){return e-i}function r(i,e,n,o,u){const p=[];for(let g=0;g<i.length;g++){const x=i[g];let T;for(let C=0;C<x.length-1;C++){let I=x[C],L=x[C+1];I.x<e&&L.x<e||(I.x<e?I=new N(e,I.y+(e-I.x)/(L.x-I.x)*(L.y-I.y))._round():L.x<e&&(L=new N(e,I.y+(e-I.x)/(L.x-I.x)*(L.y-I.y))._round()),I.y<n&&L.y<n||(I.y<n?I=new N(I.x+(n-I.y)/(L.y-I.y)*(L.x-I.x),n)._round():L.y<n&&(L=new N(I.x+(n-I.y)/(L.y-I.y)*(L.x-I.x),n)._round()),I.x>=o&&L.x>=o||(I.x>=o?I=new N(o,I.y+(o-I.x)/(L.x-I.x)*(L.y-I.y))._round():L.x>=o&&(L=new N(o,I.y+(o-I.x)/(L.x-I.x)*(L.y-I.y))._round()),I.y>=u&&L.y>=u||(I.y>=u?I=new N(I.x+(u-I.y)/(L.y-I.y)*(L.x-I.x),u)._round():L.y>=u&&(L=new N(I.x+(u-I.y)/(L.y-I.y)*(L.x-I.x),u)._round()),T&&I.equals(T[T.length-1])||(T=[I],p.push(T)),T.push(L)))))}}return p}function s(i,e,n,o,u){switch(e){case 1:return(function(p,g,x,T){const C=[];for(const I of p)for(const L of I){const B=T===0?L.x:L.y;B>=g&&B<=x&&C.push([L])}return C})(i,n,o,u);case 2:return _(i,n,o,u,!1);case 3:return _(i,n,o,u,!0)}return[]}function d(i,e,n,o,u){const p=o===0?M:P;let g=[];const x=[];for(let I=0;I<i.length-1;I++){const L=i[I],B=i[I+1],F=o===0?L.x:L.y,q=o===0?B.x:B.y;let G=!1;F<e?q>e&&g.push(p(L,B,e)):F>n?q<n&&g.push(p(L,B,n)):g.push(L),q<e&&F>=e&&(g.push(p(L,B,e)),G=!0),q>n&&F<=n&&(g.push(p(L,B,n)),G=!0),!u&&G&&(x.push(g),g=[])}const T=i.length-1,C=o===0?i[T].x:i[T].y;return C>=e&&C<=n&&g.push(i[T]),u&&g.length>0&&!g[0].equals(g[g.length-1])&&g.push(new N(g[0].x,g[0].y)),g.length>0&&x.push(g),x}function _(i,e,n,o,u){const p=[];for(const g of i){const x=d(g,e,n,o,u);x.length>0&&p.push(...x)}return p}function M(i,e,n){return new N(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function P(i,e,n){return new N(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}Rt("FeatureIndex",Wm,{omit:["rawTileData","sourceLayerCoder"]});class V extends N{constructor(e,n,o,u){super(e,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new V(this.x,this.y,this.angle,this.segment)}}function te(i,e,n,o,u){if(e.segment===void 0||n===0)return!0;let p=e,g=e.segment+1,x=0;for(;x>-n/2;){if(g--,g<0)return!1;x-=i[g].dist(p),p=i[g]}x+=i[g].dist(i[g+1]),g++;const T=[];let C=0;for(;x<n/2;){const I=i[g],L=i[g+1];if(!L)return!1;let B=i[g-1].angleTo(I)-I.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:B}),C+=B;x-T[0].distance>o;)C-=T.shift().angleDelta;if(C>u)return!1;g++,x+=I.dist(L)}return!0}function Me(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function Xe(i,e,n){return i?.6*e*n:0}function ht(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function yt(i,e,n,o,u,p){const g=Xe(n,u,p),x=ht(n,o)*p;let T=0;const C=Me(i)/2;for(let I=0;I<i.length-1;I++){const L=i[I],B=i[I+1],F=L.dist(B);if(T+F>C){const q=(C-T)/F,G=fi.number(L.x,B.x,q),X=fi.number(L.y,B.y,q),J=new V(G,X,B.angleTo(L),I);return J._round(),!g||te(i,J,x,g,e)?J:void 0}T+=F}}function Ye(i,e,n,o,u,p,g,x,T){const C=Xe(o,p,g),I=ht(o,u),L=I*g,B=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-L<e/4&&(e=L+e/4),Je(i,B?e/2*x%e:(I/2+2*p)*g*x%e,e,C,n,L,B,!1,T)}function Je(i,e,n,o,u,p,g,x,T){const C=p/2,I=Me(i);let L=0,B=e-n,F=[];for(let q=0;q<i.length-1;q++){const G=i[q],X=i[q+1],J=G.dist(X),he=X.angleTo(G);for(;B+n<L+J;){B+=n;const ee=(B-L)/J,ae=fi.number(G.x,X.x,ee),ge=fi.number(G.y,X.y,ee);if(ae>=0&&ae<T&&ge>=0&&ge<T&&B-C>=0&&B+C<=I){const be=new V(ae,ge,he,q);be._round(),o&&!te(i,be,p,o,u)||F.push(be)}}L+=J}return x||F.length||g||(F=Je(i,L/2,n,o,u,p,g,!0,T)),F}function Zt(i,e,n,o){const u=[],p=i.image,g=p.pixelRatio,x=p.paddedRect.w-2,T=p.paddedRect.h-2;let C={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const I=p.stretchX||[[0,x]],L=p.stretchY||[[0,T]],B=(Ze,Nt)=>Ze+Nt[1]-Nt[0],F=I.reduce(B,0),q=L.reduce(B,0),G=x-F,X=T-q;let J=0,he=F,ee=0,ae=q,ge=0,be=G,je=0,ot=X;if(p.content&&o){const Ze=p.content,Nt=Ze[2]-Ze[0],Lt=Ze[3]-Ze[1];(p.textFitWidth||p.textFitHeight)&&(C=Ml(i)),J=nn(I,0,Ze[0]),ee=nn(L,0,Ze[1]),he=nn(I,Ze[0],Ze[2]),ae=nn(L,Ze[1],Ze[3]),ge=Ze[0]-J,je=Ze[1]-ee,be=Nt-he,ot=Lt-ae}const Ke=C.x1,ft=C.y1,zt=C.x2-Ke,gt=C.y2-ft,et=(Ze,Nt,Lt,Ut)=>{const kt=Be(Ze.stretch-J,he,zt,Ke),$t=ze(Ze.fixed-ge,be,Ze.stretch,F),Bn=Be(Nt.stretch-ee,ae,gt,ft),wn=ze(Nt.fixed-je,ot,Nt.stretch,q),Pi=Be(Lt.stretch-J,he,zt,Ke),Jr=ze(Lt.fixed-ge,be,Lt.stretch,F),pr=Be(Ut.stretch-ee,ae,gt,ft),Ii=ze(Ut.fixed-je,ot,Ut.stretch,q),bi=new N(kt,Bn),Xn=new N(Pi,Bn),qi=new N(Pi,pr),Yi=new N(kt,pr),yi=new N($t/g,wn/g),ss=new N(Jr/g,Ii/g),ea=e*Math.PI/180;if(ea){const Cr=Math.sin(ea),Bi=Math.cos(ea),mr=[Bi,-Cr,Cr,Bi];bi._matMult(mr),Xn._matMult(mr),Yi._matMult(mr),qi._matMult(mr)}const os=Ze.stretch+Ze.fixed,Fo=Nt.stretch+Nt.fixed;return{tl:bi,tr:Xn,bl:Yi,br:qi,tex:{x:p.paddedRect.x+1+os,y:p.paddedRect.y+1+Fo,w:Lt.stretch+Lt.fixed-os,h:Ut.stretch+Ut.fixed-Fo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yi,pixelOffsetBR:ss,minFontScaleX:be/g/zt,minFontScaleY:ot/g/gt,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const Ze=oi(I,G,F),Nt=oi(L,X,q);for(let Lt=0;Lt<Ze.length-1;Lt++){const Ut=Ze[Lt],kt=Ze[Lt+1];for(let $t=0;$t<Nt.length-1;$t++)u.push(et(Ut,Nt[$t],kt,Nt[$t+1]))}}else u.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return u}function nn(i,e,n){let o=0;for(const u of i)o+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return o}function oi(i,e,n){const o=[{fixed:-1,stretch:0}];for(const[u,p]of i){const g=o[o.length-1];o.push({fixed:u-g.stretch,stretch:g.stretch}),o.push({fixed:u-g.stretch,stretch:g.stretch+(p-u)})}return o.push({fixed:e+1,stretch:n}),o}function Be(i,e,n,o){return i/e*n+o}function ze(i,e,n,o){return i-e*n/o}Rt("Anchor",V);class Ge{constructor(e,n,o,u,p,g,x,T,C,I){var L;if(this.boxStartIndex=e.length,C){let B=g.top,F=g.bottom;const q=g.collisionPadding;q&&(B-=q[1],F+=q[3]);let G=F-B;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{const B=!((L=g.image)===null||L===void 0)&&L.content&&(g.image.textFitWidth||g.image.textFitHeight)?Ml(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};B.y1=B.y1*x-T[0],B.y2=B.y2*x+T[2],B.x1=B.x1*x-T[3],B.x2=B.x2*x+T[1];const F=g.collisionPadding;if(F&&(B.x1-=F[0]*x,B.y1-=F[1]*x,B.x2+=F[2]*x,B.y2+=F[3]*x),I){const q=new N(B.x1,B.y1),G=new N(B.x2,B.y1),X=new N(B.x1,B.y2),J=new N(B.x2,B.y2),he=I*Math.PI/180;q._rotate(he),G._rotate(he),X._rotate(he),J._rotate(he),B.x1=Math.min(q.x,G.x,X.x,J.x),B.x2=Math.max(q.x,G.x,X.x,J.x),B.y1=Math.min(q.y,G.y,X.y,J.y),B.y2=Math.max(q.y,G.y,X.y,J.y)}e.emplaceBack(n.x,n.y,B.x1,B.y1,B.x2,B.y2,o,u,p)}this.boxEndIndex=e.length}}class mt{constructor(e=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,u=n[e];for(;e>0;){const p=e-1>>1,g=n[p];if(o(u,g)>=0)break;n[e]=g,e=p}n[e]=u}_down(e){const{data:n,compare:o}=this,u=this.length>>1,p=n[e];for(;e<u;){let g=1+(e<<1);const x=g+1;if(x<this.length&&o(n[x],n[g])<0&&(g=x),o(n[g],p)>=0)break;n[e]=n[g],e=g}n[e]=p}}function en(i,e=1,n=!1){const o=gc.fromPoints(i[0]),u=Math.min(o.width(),o.height());let p=u/2;const g=new mt([],$n),{minX:x,minY:T,maxX:C,maxY:I}=o;if(u===0)return new N(x,T);for(let F=x;F<C;F+=u)for(let q=T;q<I;q+=u)g.push(new Ht(F+p,q+p,p,i));let L=(function(F){let q=0,G=0,X=0;const J=F[0];for(let he=0,ee=J.length,ae=ee-1;he<ee;ae=he++){const ge=J[he],be=J[ae],je=ge.x*be.y-be.x*ge.y;G+=(ge.x+be.x)*je,X+=(ge.y+be.y)*je,q+=3*je}return new Ht(G/q,X/q,0,F)})(i),B=g.length;for(;g.length;){const F=g.pop();(F.d>L.d||!L.d)&&(L=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,B)),F.max-L.d<=e||(p=F.h/2,g.push(new Ht(F.p.x-p,F.p.y-p,p,i)),g.push(new Ht(F.p.x+p,F.p.y-p,p,i)),g.push(new Ht(F.p.x-p,F.p.y+p,p,i)),g.push(new Ht(F.p.x+p,F.p.y+p,p,i)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function $n(i,e){return e.max-i.max}function Ht(i,e,n,o){this.p=new N(i,e),this.h=n,this.d=(function(u,p){let g=!1,x=1/0;for(let T=0;T<p.length;T++){const C=p[T];for(let I=0,L=C.length,B=L-1;I<L;B=I++){const F=C[I],q=C[B];F.y>u.y!=q.y>u.y&&u.x<(q.x-F.x)*(u.y-F.y)/(q.y-F.y)+F.x&&(g=!g),x=Math.min(x,em(u,F,q))}}return(g?1:-1)*Math.sqrt(x)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Wt;A.aP=void 0,(Wt=A.aP||(A.aP={}))[Wt.center=1]="center",Wt[Wt.left=2]="left",Wt[Wt.right=3]="right",Wt[Wt.top=4]="top",Wt[Wt.bottom=5]="bottom",Wt[Wt["top-left"]=6]="top-left",Wt[Wt["top-right"]=7]="top-right",Wt[Wt["bottom-left"]=8]="bottom-left",Wt[Wt["bottom-right"]=9]="bottom-right";const Cn=Number.POSITIVE_INFINITY;function Vn(i,e){return e[1]!==Cn?(function(n,o,u){let p=0,g=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,g]})(i,e[0],e[1]):(function(n,o){let u=0,p=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":p=g-7;break;case"bottom-right":case"bottom-left":p=7-g;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=o;break;case"right":u=-o}return[u,p]})(i,e[0])}function Dl(i,e,n){var o;const u=i.layout,p=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(p){const x=p.values,T=[];for(let C=0;C<x.length;C+=2){const I=T[C]=x[C],L=x[C+1].map((B=>B*ir));I.startsWith("top")?L[1]-=7:I.startsWith("bottom")&&(L[1]+=7),T[C+1]=L}return new Ei(T)}const g=u.get("text-variable-anchor");if(g){let x;x=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},n)*ir,Cn]:u.get("text-offset").evaluate(e,{},n).map((C=>C*ir));const T=[];for(const C of g)T.push(C,Vn(C,x));return new Ei(T)}return null}function Qm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function f1(i,e,n,o,u,p,g,x,T,C,I,L){let B=p.textMaxSize.evaluate(e,{});B===void 0&&(B=g);const F=i.layers[0].layout,q=F.get("icon-offset").evaluate(e,{},I),G=F0(n.horizontal),X=g/24,J=i.tilePixelRatio*X,he=i.tilePixelRatio*B/24,ee=i.tilePixelRatio*x,ae=i.tilePixelRatio*F.get("symbol-spacing"),ge=F.get("text-padding")*i.tilePixelRatio,be=(function(Lt,Ut,kt,$t=1){const Bn=Lt.get("icon-padding").evaluate(Ut,{},kt),wn=Bn&&Bn.values;return[wn[0]*$t,wn[1]*$t,wn[2]*$t,wn[3]*$t]})(F,e,I,i.tilePixelRatio),je=F.get("text-max-angle")/180*Math.PI,ot=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",Ke=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",ft=F.get("symbol-placement"),zt=ae/2,gt=F.get("icon-text-fit");let et;o&&gt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(et=ao(o,n.vertical,gt,F.get("icon-text-fit-padding"),q,X)),G&&(o=ao(o,G,gt,F.get("icon-text-fit-padding"),q,X)));const Ze=I?L.line.getGranularityForZoomLevel(I.z):1,Nt=(Lt,Ut)=>{Ut.x<0||Ut.x>=_t||Ut.y<0||Ut.y>=_t||(function(kt,$t,Bn,wn,Pi,Jr,pr,Ii,bi,Xn,qi,Yi,yi,ss,ea,os,Fo,Cr,Bi,mr,Gi,zr,zu,Pl,tg){const Fh=kt.addToLineVertexArray($t,Bn);let rf,Op,Bp,Np,q0=0,G0=0,Z0=0,H0=0,h_=-1,d_=-1;const Du={};let $0=zi("");if(kt.allowVerticalPlacement&&wn.vertical){const xa=Ii.layout.get("text-rotate").evaluate(Gi,{},Pl)+90;Bp=new Ge(bi,$t,Xn,qi,Yi,wn.vertical,yi,ss,ea,xa),pr&&(Np=new Ge(bi,$t,Xn,qi,Yi,pr,Fo,Cr,ea,xa))}if(Pi){const xa=Ii.layout.get("icon-rotate").evaluate(Gi,{}),co=Ii.layout.get("icon-text-fit")!=="none",af=Zt(Pi,xa,zu,co),kl=pr?Zt(pr,xa,zu,co):void 0;Op=new Ge(bi,$t,Xn,qi,Yi,Pi,Fo,Cr,!1,xa),q0=4*af.length;const sf=kt.iconSizeData;let Ec=null;sf.kind==="source"?(Ec=[rs*Ii.layout.get("icon-size").evaluate(Gi,{})],Ec[0]>pc&&zn(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):sf.kind==="composite"&&(Ec=[rs*zr.compositeIconSizes[0].evaluate(Gi,{},Pl),rs*zr.compositeIconSizes[1].evaluate(Gi,{},Pl)],(Ec[0]>pc||Ec[1]>pc)&&zn(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),kt.addSymbols(kt.icon,af,Ec,mr,Bi,Gi,A.az.none,$t,Fh.lineStartIndex,Fh.lineLength,-1,Pl),h_=kt.icon.placedSymbolArray.length-1,kl&&(G0=4*kl.length,kt.addSymbols(kt.icon,kl,Ec,mr,Bi,Gi,A.az.vertical,$t,Fh.lineStartIndex,Fh.lineLength,-1,Pl),d_=kt.icon.placedSymbolArray.length-1)}const X0=Object.keys(wn.horizontal);for(const xa of X0){const co=wn.horizontal[xa];if(!rf){$0=zi(co.text);const kl=Ii.layout.get("text-rotate").evaluate(Gi,{},Pl);rf=new Ge(bi,$t,Xn,qi,Yi,co,yi,ss,ea,kl)}const af=co.positionedLines.length===1;if(Z0+=N0(kt,$t,co,Jr,Ii,ea,Gi,os,Fh,wn.vertical?A.az.horizontal:A.az.horizontalOnly,af?X0:[xa],Du,h_,zr,Pl),af)break}wn.vertical&&(H0+=N0(kt,$t,wn.vertical,Jr,Ii,ea,Gi,os,Fh,A.az.vertical,["vertical"],Du,d_,zr,Pl));const g1=rf?rf.boxStartIndex:kt.collisionBoxArray.length,y1=rf?rf.boxEndIndex:kt.collisionBoxArray.length,_1=Bp?Bp.boxStartIndex:kt.collisionBoxArray.length,v1=Bp?Bp.boxEndIndex:kt.collisionBoxArray.length,x1=Op?Op.boxStartIndex:kt.collisionBoxArray.length,b1=Op?Op.boxEndIndex:kt.collisionBoxArray.length,w1=Np?Np.boxStartIndex:kt.collisionBoxArray.length,T1=Np?Np.boxEndIndex:kt.collisionBoxArray.length;let Il=-1;const fy=(xa,co)=>xa&&xa.circleDiameter?Math.max(xa.circleDiameter,co):co;Il=fy(rf,Il),Il=fy(Bp,Il),Il=fy(Op,Il),Il=fy(Np,Il);const Y0=Il>-1?1:0;Y0&&(Il*=tg/ir),kt.glyphOffsetArray.length>=Dh.MAX_GLYPHS&&zn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gi.sortKey!==void 0&&kt.addToSortKeyRanges(kt.symbolInstances.length,Gi.sortKey);const S1=Dl(Ii,Gi,Pl),[E1,M1]=(function(xa,co){const af=xa.length,kl=co?.values;if(kl?.length>0)for(let sf=0;sf<kl.length;sf+=2){const Ec=kl[sf+1];xa.emplaceBack(A.aP[kl[sf]],Ec[0],Ec[1])}return[af,xa.length]})(kt.textAnchorOffsets,S1);kt.symbolInstances.emplaceBack($t.x,$t.y,Du.right>=0?Du.right:-1,Du.center>=0?Du.center:-1,Du.left>=0?Du.left:-1,Du.vertical||-1,h_,d_,$0,g1,y1,_1,v1,x1,b1,w1,T1,Xn,Z0,H0,q0,G0,Y0,0,yi,Il,E1,M1)})(i,Ut,Lt,n,o,u,et,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,J,[ge,ge,ge,ge],ot,T,ee,be,Ke,q,e,p,C,I,g)};if(ft==="line")for(const Lt of r(e.geometry,0,0,_t,_t)){const Ut=bl(Lt,Ze),kt=Ye(Ut,ae,je,n.vertical||G,o,24,he,i.overscaling,_t);for(const $t of kt)G&&p1(i,G.text,zt,$t)||Nt(Ut,$t)}else if(ft==="line-center"){for(const Lt of e.geometry)if(Lt.length>1){const Ut=bl(Lt,Ze),kt=yt(Ut,je,n.vertical||G,o,24,he);kt&&Nt(Ut,kt)}}else if(e.type==="Polygon")for(const Lt of $c(e.geometry,0)){const Ut=en(Lt,16);Nt(bl(Lt[0],Ze,!0),new V(Ut.x,Ut.y,0))}else if(e.type==="LineString")for(const Lt of e.geometry){const Ut=bl(Lt,Ze);Nt(Ut,new V(Ut[0].x,Ut[0].y,0))}else if(e.type==="Point")for(const Lt of e.geometry)for(const Ut of Lt)Nt([Ut],new V(Ut.x,Ut.y,0))}function N0(i,e,n,o,u,p,g,x,T,C,I,L,B,F,q){const G=(function(he,ee,ae,ge,be,je,ot,Ke){const ft=ge.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,zt=[];for(const gt of ee.positionedLines)for(const et of gt.positionedGlyphs){if(!et.rect)continue;const Ze=et.rect||{};let Nt=4,Lt=!0,Ut=1,kt=0;const $t=(be||Ke)&&et.vertical,Bn=et.metrics.advance*et.scale/2;if(Ke&&ee.verticalizable&&(kt=gt.lineOffset/2-(et.imageName?-(ir-et.metrics.width*et.scale)/2:(et.scale-1)*ir)),et.imageName){const Cr=ot[et.imageName];Lt=Cr.sdf,Ut=Cr.pixelRatio,Nt=1/Ut}const wn=be?[et.x+Bn,et.y]:[0,0];let Pi=be?[0,0]:[et.x+Bn+ae[0],et.y+ae[1]-kt],Jr=[0,0];$t&&(Jr=Pi,Pi=[0,0]);const pr=et.metrics.isDoubleResolution?2:1,Ii=(et.metrics.left-Nt)*et.scale-Bn+Pi[0],bi=(-et.metrics.top-Nt)*et.scale+Pi[1],Xn=Ii+Ze.w/pr*et.scale/Ut,qi=bi+Ze.h/pr*et.scale/Ut,Yi=new N(Ii,bi),yi=new N(Xn,bi),ss=new N(Ii,qi),ea=new N(Xn,qi);if($t){const Cr=new N(-Bn,Bn- -17),Bi=-Math.PI/2,mr=12-Bn,Gi=new N(22-mr,-(et.imageName?mr:0)),zr=new N(...Jr);Yi._rotateAround(Bi,Cr)._add(Gi)._add(zr),yi._rotateAround(Bi,Cr)._add(Gi)._add(zr),ss._rotateAround(Bi,Cr)._add(Gi)._add(zr),ea._rotateAround(Bi,Cr)._add(Gi)._add(zr)}if(ft){const Cr=Math.sin(ft),Bi=Math.cos(ft),mr=[Bi,-Cr,Cr,Bi];Yi._matMult(mr),yi._matMult(mr),ss._matMult(mr),ea._matMult(mr)}const os=new N(0,0),Fo=new N(0,0);zt.push({tl:Yi,tr:yi,bl:ss,br:ea,tex:Ze,writingMode:ee.writingMode,glyphOffset:wn,sectionIndex:et.sectionIndex,isSDF:Lt,pixelOffsetTL:os,pixelOffsetBR:Fo,minFontScaleX:0,minFontScaleY:0})}return zt})(0,n,x,u,p,g,o,i.allowVerticalPlacement),X=i.textSizeData;let J=null;X.kind==="source"?(J=[rs*u.layout.get("text-size").evaluate(g,{})],J[0]>pc&&zn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):X.kind==="composite"&&(J=[rs*F.compositeTextSizes[0].evaluate(g,{},q),rs*F.compositeTextSizes[1].evaluate(g,{},q)],(J[0]>pc||J[1]>pc)&&zn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,G,J,x,p,g,C,e,T.lineStartIndex,T.lineLength,B,q);for(const he of I)L[he]=i.text.placedSymbolArray.length-1;return 4*G.length}function F0(i){for(const e in i)return i[e];return null}function p1(i,e,n,o){const u=i.compareText;if(e in u){const p=u[e];for(let g=p.length-1;g>=0;g--)if(o.dist(p[g])<n)return!0}else u[e]=[];return u[e].push(o),!1}const j0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class r_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=j0[15&o];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new r_(x,g,p,e)}constructor(e,n=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=j0.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return a_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:x}=this,T=[0,p.length-1,0],C=[];for(;T.length;){const I=T.pop()||0,L=T.pop()||0,B=T.pop()||0;if(L-B<=x){for(let X=B;X<=L;X++){const J=g[2*X],he=g[2*X+1];J>=e&&J<=o&&he>=n&&he<=u&&C.push(p[X])}continue}const F=B+L>>1,q=g[2*F],G=g[2*F+1];q>=e&&q<=o&&G>=n&&G<=u&&C.push(p[F]),(I===0?e<=q:n<=G)&&(T.push(B),T.push(F-1),T.push(1-I)),(I===0?o>=q:u>=G)&&(T.push(F+1),T.push(L),T.push(1-I))}return C}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:g}=this,x=[0,u.length-1,0],T=[],C=o*o;for(;x.length;){const I=x.pop()||0,L=x.pop()||0,B=x.pop()||0;if(L-B<=g){for(let X=B;X<=L;X++)V0(p[2*X],p[2*X+1],e,n)<=C&&T.push(u[X]);continue}const F=B+L>>1,q=p[2*F],G=p[2*F+1];V0(q,G,e,n)<=C&&T.push(u[F]),(I===0?e-o<=q:n-o<=G)&&(x.push(B),x.push(F-1),x.push(1-I)),(I===0?e+o>=q:n+o>=G)&&(x.push(F+1),x.push(L),x.push(1-I))}return T}}function a_(i,e,n,o,u,p){if(u-o<=n)return;const g=o+u>>1;U0(i,e,g,o,u,p),a_(i,e,n,o,g-1,1-p),a_(i,e,n,g+1,u,1-p)}function U0(i,e,n,o,u,p){for(;u>o;){if(u-o>600){const C=u-o+1,I=n-o+1,L=Math.log(C),B=.5*Math.exp(2*L/3),F=.5*Math.sqrt(L*B*(C-B)/C)*(I-C/2<0?-1:1);U0(i,e,n,Math.max(o,Math.floor(n-I*B/C+F)),Math.min(u,Math.floor(n+(C-I)*B/C+F)),p)}const g=e[2*n+p];let x=o,T=u;for(Jm(i,e,o,n),e[2*u+p]>g&&Jm(i,e,o,u);x<T;){for(Jm(i,e,x,T),x++,T--;e[2*x+p]<g;)x++;for(;e[2*T+p]>g;)T--}e[2*o+p]===g?Jm(i,e,o,T):(T++,Jm(i,e,T,u)),T<=n&&(o=T+1),n<=T&&(u=T-1)}}function Jm(i,e,n,o){s_(i,n,o),s_(e,2*n,2*o),s_(e,2*n+1,2*o+1)}function s_(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function V0(i,e,n,o){const u=i-n,p=e-o;return u*u+p*p}var o_;A.cH=void 0,(o_=A.cH||(A.cH={})).create="create",o_.load="load",o_.fullLoad="fullLoad";let dy=null,eg=[];const l_=1e3/60,c_="loadTime",u_="fullLoadTime",m1={mark(i){performance.mark(i)},frame(i){const e=i;dy!=null&&eg.push(e-dy),dy=e},clearMetrics(){dy=null,eg=[],performance.clearMeasures(c_),performance.clearMeasures(u_);for(const i in A.cH)performance.clearMarks(A.cH[i])},getPerformanceMetrics(){performance.measure(c_,A.cH.create,A.cH.load),performance.measure(u_,A.cH.create,A.cH.fullLoad);const i=performance.getEntriesByName(c_)[0].duration,e=performance.getEntriesByName(u_)[0].duration,n=eg.length,o=1/(eg.reduce(((p,g)=>p+g),0)/n/1e3),u=eg.filter((p=>p>l_)).reduce(((p,g)=>p+(g-l_)/l_),0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};A.$=ie,A.A=it,A.B=Ya,A.C=nr,A.D=Bt,A.E=pn,A.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},A.G=fi,A.H=jn,A.I=ti,A.J=lh,A.K=function(i){if(Yn==null){const e=i.navigator?i.navigator.userAgent:null;Yn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Yn},A.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yp((()=>this.process())),this.subscription=cs(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Wi(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=e?cs(e.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[u];const T={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),Cm):null;this.resolveRejects[u]={resolve:T=>{p?.unsubscribe(),n(T)},reject:T=>{p?.unsubscribe(),o(T)}};const g=[],x=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Ka(i.data,g)});this.target.postMessage(x,{transfer:g})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Wi(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return l(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(e.error?u.reject(rc(e.error)):u.resolve(rc(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=rc(e.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,n,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}}))}completeTask(i,e,n){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Ka(e):null,data:Ka(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},A.M=ke,A.N=function(){var i=new it(16);return it!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},A.O=function(i,e,n){var o,u,p,g,x,T,C,I,L,B,F,q,G=n[0],X=n[1],J=n[2];return e===i?(i[12]=e[0]*G+e[4]*X+e[8]*J+e[12],i[13]=e[1]*G+e[5]*X+e[9]*J+e[13],i[14]=e[2]*G+e[6]*X+e[10]*J+e[14],i[15]=e[3]*G+e[7]*X+e[11]*J+e[15]):(u=e[1],p=e[2],g=e[3],x=e[4],T=e[5],C=e[6],I=e[7],L=e[8],B=e[9],F=e[10],q=e[11],i[0]=o=e[0],i[1]=u,i[2]=p,i[3]=g,i[4]=x,i[5]=T,i[6]=C,i[7]=I,i[8]=L,i[9]=B,i[10]=F,i[11]=q,i[12]=o*G+x*X+L*J+e[12],i[13]=u*G+T*X+B*J+e[13],i[14]=p*G+C*X+F*J+e[14],i[15]=g*G+I*X+q*J+e[15]),i},A.P=N,A.Q=function(i,e,n){var o=n[0],u=n[1],p=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},A.R=Yr,A.S=function(i,e,n){var o=e[0],u=e[1],p=e[2],g=e[3],x=e[4],T=e[5],C=e[6],I=e[7],L=e[8],B=e[9],F=e[10],q=e[11],G=e[12],X=e[13],J=e[14],he=e[15],ee=n[0],ae=n[1],ge=n[2],be=n[3];return i[0]=ee*o+ae*x+ge*L+be*G,i[1]=ee*u+ae*T+ge*B+be*X,i[2]=ee*p+ae*C+ge*F+be*J,i[3]=ee*g+ae*I+ge*q+be*he,i[4]=(ee=n[4])*o+(ae=n[5])*x+(ge=n[6])*L+(be=n[7])*G,i[5]=ee*u+ae*T+ge*B+be*X,i[6]=ee*p+ae*C+ge*F+be*J,i[7]=ee*g+ae*I+ge*q+be*he,i[8]=(ee=n[8])*o+(ae=n[9])*x+(ge=n[10])*L+(be=n[11])*G,i[9]=ee*u+ae*T+ge*B+be*X,i[10]=ee*p+ae*C+ge*F+be*J,i[11]=ee*g+ae*I+ge*q+be*he,i[12]=(ee=n[12])*o+(ae=n[13])*x+(ge=n[14])*L+(be=n[15])*G,i[13]=ee*u+ae*T+ge*B+be*X,i[14]=ee*p+ae*C+ge*F+be*J,i[15]=ee*g+ae*I+ge*q+be*he,i},A.T=Xf,A.U=function(i,e){const n={};for(let o=0;o<e.length;o++){const u=e[o];u in i&&(n[u]=i[u])}return n},A.V=Bo,A.W=Qt,A.X=zm,A.Y=$g,A.Z=de,A._=l,A.a=Q,A.a$=tt,A.a0=Re,A.a1=ia,A.a2=ja,A.a3=Yg,A.a4=Fd,A.a5=_t,A.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const o=Ud(i),u=Ud(e);(function(g,x){x.removeAll&&(g.add.clear(),g.update.clear(),g.remove.clear(),x.remove.clear());for(const T of x.remove)g.add.delete(T),g.update.delete(T);for(const[T,C]of x.update){const I=g.update.get(T);I&&(x.update.set(T,Pm(I,C)),g.update.delete(T))}})(o,u);const p={};if((o.removeAll||u.removeAll)&&(p.removeAll=!0),p.remove=new Set([...o.remove,...u.remove]),p.add=new Map([...o.add,...u.add]),p.update=new Map([...o.update,...u.update]),p.remove.size&&p.add.size)for(const g of p.add.keys())p.remove.delete(g);return(function(g){const x={};return g.removeAll&&(x.removeAll=g.removeAll),g.remove&&(x.remove=Array.from(g.remove)),g.add&&(x.add=Array.from(g.add.values())),g.update&&(x.update=Array.from(g.update.values())),x})(p)},A.a7=function(i,e){const n=new Map;if(i==null||i.type==null)return n;if(i.type==="Feature"){const o=jd(i,e);return o==null?void 0:(n.set(o,i),n)}if(i.type==="FeatureCollection"){const o=new Set;for(const u of i.features){const p=jd(u,e);if(p==null||o.has(p))return;o.add(p),n.set(p,u)}return n}},A.a8=function(i,e,n){var o,u;const p=[];if(e.removeAll)i.clear();else if(e.remove)for(const g of e.remove){const x=i.get(g);x&&(p.push(x.geometry),i.delete(g))}if(e.add)for(const g of e.add){const x=jd(g,n);if(x==null)continue;const T=i.get(x);T&&p.push(T.geometry),p.push(g.geometry),i.set(x,g)}if(e.update)for(const g of e.update){const x=i.get(g.id);if(!x)continue;const T=!!g.newGeometry,C=g.removeAllProperties||((o=g.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=g.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!T&&!C)continue;p.push(x.geometry);const I=Object.assign({},x);if(i.set(g.id,I),T&&(p.push(g.newGeometry),I.geometry=g.newGeometry),C){if(I.properties=g.removeAllProperties?{}:Object.assign({},I.properties||{}),g.removeProperties)for(const L of g.removeProperties)delete I.properties[L];if(g.addOrUpdateProperties)for(const{key:L,value:B}of g.addOrUpdateProperties)I.properties[L]=B}}return p},A.a9=Hn,A.aA=function(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/rs:i.kind==="composite"?fi.number(o/rs,u/rs,n):e},A.aB=function(i,e){var n=e[0],o=e[1],u=e[2],p=e[3],g=e[4],x=e[5],T=e[6],C=e[7],I=e[8],L=e[9],B=e[10],F=e[11],q=e[12],G=e[13],X=e[14],J=e[15],he=n*x-o*g,ee=n*T-u*g,ae=n*C-p*g,ge=o*T-u*x,be=o*C-p*x,je=u*C-p*T,ot=I*G-L*q,Ke=I*X-B*q,ft=I*J-F*q,zt=L*X-B*G,gt=L*J-F*G,et=B*J-F*X,Ze=he*et-ee*gt+ae*zt+ge*ft-be*Ke+je*ot;return Ze?(i[0]=(x*et-T*gt+C*zt)*(Ze=1/Ze),i[1]=(u*gt-o*et-p*zt)*Ze,i[2]=(G*je-X*be+J*ge)*Ze,i[3]=(B*be-L*je-F*ge)*Ze,i[4]=(T*ft-g*et-C*Ke)*Ze,i[5]=(n*et-u*ft+p*Ke)*Ze,i[6]=(X*ae-q*je-J*ee)*Ze,i[7]=(I*je-B*ae+F*ee)*Ze,i[8]=(g*gt-x*ft+C*ot)*Ze,i[9]=(o*ft-n*gt-p*ot)*Ze,i[10]=(q*be-G*ae+J*he)*Ze,i[11]=(L*ae-I*be-F*he)*Ze,i[12]=(x*Ke-g*zt-T*ot)*Ze,i[13]=(n*zt-o*Ke+u*ot)*Ze,i[14]=(G*ee-q*ge-X*he)*Ze,i[15]=(I*ge-L*ee+B*he)*Ze,i):null},A.aC=He,A.aD=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},A.aE=function(i){return i[0]=0,i[1]=0,i},A.aF=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},A.aG=Sm,A.aH=Gt,A.aI=function(i,e,n,o){const u=e.y-i.y,p=e.x-i.x,g=o.y-n.y,x=o.x-n.x,T=g*p-x*u;if(T===0)return null;const C=(x*(i.y-n.y)-g*(i.x-n.x))/T;return new N(i.x+C*p,i.y+C*u)},A.aJ=r,A.aK=vu,A.aL=function(i){let e=1/0,n=1/0,o=-1/0,u=-1/0;for(const p of i)e=Math.min(e,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return[e,n,o,u]},A.aM=ir,A.aN=Ft,A.aO=function(i,e,n,o,u=!1){if(!n[0]&&!n[1])return[0,0];const p=u?o==="map"?-i.bearingInRadians:0:o==="viewport"?i.bearingInRadians:0;if(p){const g=Math.sin(p),x=Math.cos(p);n=[n[0]*x-n[1]*g,n[0]*g+n[1]*x]}return[u?n[0]:Ft(e,n[0],i.zoom),u?n[1]:Ft(e,n[1],i.zoom)]},A.aQ=dp,A.aR=Qm,A.aS=xm,A.aT=r_,A.aU=pi,A.aV=zd,A.aW=se,A.aX=Ct,A.aY=Ve,A.aZ=Qi,A.a_=Dm,A.aa=gc,A.ab=25,A.ac=vr,A.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const o of i){const u=window.document.createElement("source");nt(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},A.ae=xt,A.af=function(){return Yt++},A.ag=f,A.ah=Dh,A.ai=nf,A.aj=qr,A.ak=ns,A.al=xp,A.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,u,p)=>{const g=u||p;return e[o]=!g||g.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},A.an=Xt,A.ao=85.051129,A.ap=Ti,A.aq=function(i){return Math.pow(2,i)},A.ar=bt,A.as=Xg,A.at=function(i){return Math.log(i)/Math.LN2},A.au=function(i){var e=i[0],n=i[1];return e*e+n*n},A.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((T=>T.canonical.z)));let n=1/0,o=-1/0,u=1/0,p=-1/0;const g=[];for(const T of i){const{x:C,y:I,z:L}=T.canonical,B=Math.pow(2,e-L),F=C*B,q=I*B;g.push({id:T,x:F,y:q}),F<n&&(n=F),F>o&&(o=F),q<u&&(u=q),q>p&&(p=q)}const x=new Set;for(const T of g)T.x!==n&&T.x!==o&&T.y!==u&&T.y!==p||x.add(T.id);return x},A.aw=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},A.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const o=i.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout((()=>{this.remove(i,u)}),n)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,o=e===void 0?0:this.data[n].indexOf(e),u=this.data[n][o];return this.data[n].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const o of this.data[n])i(o.value)||e.push(o);for(const n of e)this.remove(n.value.tileID,n)}},A.ay=function(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:g}=i,x=u?Xt(Br.interpolationFactor(u,e,p,g),0,1):0;i.kind==="camera"?o=fi.number(i.minSize,i.maxSize,x):n=x}return{uSizeT:n,uSize:o}},A.b=na,A.b$=ts,A.b0=st,A.b1=function(i){var e=new it(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},A.b2=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},A.b3=function(i,e){var n=e[0],o=e[1],u=e[2],p=n*n+o*o+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i},A.b4=ct,A.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},A.b6=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},A.b7=at,A.b8=function(i,e,n){const o=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return o===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/o},A.b9=jt,A.bA=function(i,e,n,o){return i[0]=e[0]+n[0]*o,i[1]=e[1]+n[1]*o,i[2]=e[2]+n[2]*o,i},A.bB=Te,A.bC=function(i,e,n){var o=n[0],u=n[1],p=n[2],g=n[3],x=e[0],T=e[1],C=e[2],I=u*C-p*T,L=p*x-o*C,B=o*T-u*x;return i[0]=x+g*(I+=I)+u*(B+=B)-p*(L+=L),i[1]=T+g*L+p*I-o*B,i[2]=C+g*B+o*L-u*I,i},A.bD=function(i,e,n){const o=(function(T){var C=T[3],I=T[4],L=T[5],B=T[6],F=T[7],q=T[8];return T[0]*(q*I-L*F)+T[1]*(-q*C+L*B)+T[2]*(F*C-I*B)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(o===0)return null;const u=ct([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),p=ct([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),g=ct([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),x=tt([],u,-i[3]);return st(x,x,tt([],p,-e[3])),st(x,x,tt([],g,-n[3])),tt(x,x,1/o),x},A.bE=_p,A.bF=function(){return new Float64Array(4)},A.bG=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),p[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),p[2]=u[2],i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bH=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[0],p[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),p[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bI=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),p[1]=u[1],p[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bJ=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[0],g=e[1],x=e[2],T=e[3],C=e[8],I=e[9],L=e[10],B=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u-C*o,i[1]=g*u-I*o,i[2]=x*u-L*o,i[3]=T*u-B*o,i[8]=p*o+C*u,i[9]=g*o+I*u,i[10]=x*o+L*u,i[11]=T*o+B*u,i},A.bK=function(i,e){const n=we(i,360),o=we(e,360),u=o-n,p=o>n?u-360:u+360;return Math.abs(u)<Math.abs(p)?u:p},A.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},A.bM=function(i,e,n,o){const u=Math.sqrt(i*i+e*e),p=Math.sqrt(n*n+o*o);i/=u,e/=u,n/=p,o/=p;const g=Math.acos(i*n+e*o);return-e*n+i*o>0?g:-g},A.bN=function(i,e){const n=we(i,2*Math.PI),o=we(e,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},A.bO=function(){const i={},e=Ne.$version;for(const n in Ne.$root){const o=Ne.$root[n];if(o.required){let u=null;u=n==="version"?e:o.type==="array"?[]:{},u!=null&&(i[n]=u)}}return i},A.bP=Oe,A.bQ=hh,A.bR=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!i(e[o],n[o]))return!1;return!0}return e===n},A.bS=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Ot(i[n],e[i[n].ref]));return i},A.bT=function(i,e){if(i.type==="custom")return new Am(i,e);switch(i.type){case"background":return new kn(i,e);case"circle":return new Zf(i,e);case"color-relief":return new bg(i,e);case"fill":return new Mg(i,e);case"fill-extrusion":return new fm(i,e);case"heatmap":return new vg(i,e);case"hillshade":return new Di(i,e);case"line":return new mm(i,e);case"raster":return new Qs(i,e);case"symbol":return new mc(i,e)}},A.bU=i=>i.type==="raster",A.bV=qn,A.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!Mt(i.version,e.version))return[{command:"setStyle",args:[e]}];Mt(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),Mt(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),Mt(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Mt(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),Mt(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),Mt(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),Mt(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),Mt(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),Mt(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),Mt(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),Mt(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),Mt(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),Mt(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),Mt(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(g,x,T,C){let I;for(I in x=x||{},g=g||{})Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(x,I)||Sn(I,T,C));for(I in x)Object.prototype.hasOwnProperty.call(x,I)&&(Object.prototype.hasOwnProperty.call(g,I)?Mt(g[I],x[I])||(g[I].type==="geojson"&&x[I].type==="geojson"&&Dn(g,x,I)?tn(T,{command:"setGeoJSONSourceData",args:[I,x[I].data]}):un(I,x,T,C)):Tn(I,x,T))})(i.sources,e.sources,u,o);const p=[];i.layers&&i.layers.forEach((g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):p.push(g)})),n=n.concat(u),(function(g,x,T){x=x||[];const C=(g=g||[]).map(Bl),I=x.map(Bl),L=g.reduce(Go,{}),B=x.reduce(Go,{}),F=C.slice(),q=Object.create(null);let G,X,J,he,ee;for(let ae=0,ge=0;ae<C.length;ae++)G=C[ae],Object.prototype.hasOwnProperty.call(B,G)?ge++:(tn(T,{command:"removeLayer",args:[G]}),F.splice(F.indexOf(G,ge),1));for(let ae=0,ge=0;ae<I.length;ae++)G=I[I.length-1-ae],F[F.length-1-ae]!==G&&(Object.prototype.hasOwnProperty.call(L,G)?(tn(T,{command:"removeLayer",args:[G]}),F.splice(F.lastIndexOf(G,F.length-ge),1)):ge++,he=F[F.length-ae],tn(T,{command:"addLayer",args:[B[G],he]}),F.splice(F.length-ae,0,G),q[G]=!0);for(let ae=0;ae<I.length;ae++)if(G=I[ae],X=L[G],J=B[G],!q[G]&&!Mt(X,J))if(Mt(X.source,J.source)&&Mt(X["source-layer"],J["source-layer"])&&Mt(X.type,J.type)){for(ee in ai(X.layout,J.layout,T,G,null,"setLayoutProperty"),ai(X.paint,J.paint,T,G,null,"setPaintProperty"),Mt(X.filter,J.filter)||tn(T,{command:"setFilter",args:[G,J.filter]}),Mt(X.minzoom,J.minzoom)&&Mt(X.maxzoom,J.maxzoom)||tn(T,{command:"setLayerZoomRange",args:[G,J.minzoom,J.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?ai(X[ee],J[ee],T,G,ee.slice(6),"setPaintProperty"):Mt(X[ee],J[ee])||tn(T,{command:"setLayerProperty",args:[G,ee,J[ee]]}));for(ee in J)Object.prototype.hasOwnProperty.call(J,ee)&&!Object.prototype.hasOwnProperty.call(X,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?ai(X[ee],J[ee],T,G,ee.slice(6),"setPaintProperty"):Mt(X[ee],J[ee])||tn(T,{command:"setLayerProperty",args:[G,ee,J[ee]]}))}else tn(T,{command:"removeLayer",args:[G]}),he=F[F.lastIndexOf(G)+1],tn(T,{command:"addLayer",args:[J,he]})})(p,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[e]}]}return n},A.bX=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},A.bY=on,A.bZ=xn,A.b_=class extends $r{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},A.ba=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},A.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},A.bc=Kg,A.bd=Ih,A.be=function(i,e,n,o,u){var p=1/Math.tan(e/2);if(i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0){var g=1/(o-u);i[10]=(u+o)*g,i[14]=2*u*o*g}else i[10]=-1,i[14]=-2*o;return i},A.bf=function(i){var e=new it(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},A.bg=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[0],g=e[1],x=e[2],T=e[3],C=e[4],I=e[5],L=e[6],B=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u+C*o,i[1]=g*u+I*o,i[2]=x*u+L*o,i[3]=T*u+B*o,i[4]=C*u-p*o,i[5]=I*u-g*o,i[6]=L*u-x*o,i[7]=B*u-T*o,i},A.bh=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[4],g=e[5],x=e[6],T=e[7],C=e[8],I=e[9],L=e[10],B=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*u+C*o,i[5]=g*u+I*o,i[6]=x*u+L*o,i[7]=T*u+B*o,i[8]=C*u-p*o,i[9]=I*u-g*o,i[10]=L*u-x*o,i[11]=B*u-T*o,i},A.bi=function(){const i=new Float32Array(16);return bt(i),i},A.bj=function(){const i=new Float64Array(16);return bt(i),i},A.bk=function(){return new Float64Array(16)},A.bl=function(i,e,n){const o=new Float64Array(4);return Te(o,i,e-90,n),o},A.bm=function(i,e,n,o){var u,p,g,x,T,C=e[0],I=e[1],L=e[2],B=e[3],F=n[0],q=n[1],G=n[2],X=n[3];return(p=C*F+I*q+L*G+B*X)<0&&(p=-p,F=-F,q=-q,G=-G,X=-X),1-p>We?(u=Math.acos(p),g=Math.sin(u),x=Math.sin((1-o)*u)/g,T=Math.sin(o*u)/g):(x=1-o,T=o),i[0]=x*C+T*F,i[1]=x*I+T*q,i[2]=x*L+T*G,i[3]=x*B+T*X,i},A.bn=function(i){const e=new Float64Array(9);(function(p,g){var x=g[0],T=g[1],C=g[2],I=g[3],L=x+x,B=T+T,F=C+C,q=x*L,G=T*L,X=T*B,J=C*L,he=C*B,ee=C*F,ae=I*L,ge=I*B,be=I*F;p[0]=1-X-ee,p[3]=G-be,p[6]=J+ge,p[1]=G+be,p[4]=1-q-ee,p[7]=he-ae,p[2]=J-ge,p[5]=he+ae,p[8]=1-q-X})(e,i);const n=Qi(-Math.asin(Xt(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-Qi(Math.atan2(e[3],e[4]))):(o=Qi(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=Qi(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:n+90,bearing:u}},A.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},A.bp=dn,A.bq=gl,A.br=Oa,A.bs=io,A.bt=_r,A.bu=$e,A.bv=vt,A.bw=er,A.bx=function(i,e,n,o,u){return $e(o,u,Xt((i-e)/(n-e),0,1))},A.by=we,A.bz=function(){return new Float64Array(3)},A.c=ve,A.c$=function(i,e,n,o,u){return l(this,void 0,void 0,(function*(){if(Re())try{return yield ia(i,e,n,o,u)}catch{}return(function(p,g,x,T,C){const I=p.width,L=p.height;Ur&&Ir||(Ur=new OffscreenCanvas(I,L),Ir=Ur.getContext("2d",{willReadFrequently:!0})),Ur.width=I,Ur.height=L,Ir.drawImage(p,0,0,I,L);const B=Ir.getImageData(g,x,T,C);return Ir.clearRect(0,0,I,L),B.data})(i,e,n,o,u)}))},A.c0=class extends $r{constructor(i,e){super(i,e),this.current=Xr}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},A.c1=cc,A.c2=class extends $r{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},A.c3=class extends $r{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},A.c4=Dt,A.c5=function(i,e){var n=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},A.c6=function(i,e,n){var o=e[0],u=e[1],p=e[2];return i[0]=o*n[0]+u*n[3]+p*n[6],i[1]=o*n[1]+u*n[4]+p*n[7],i[2]=o*n[2]+u*n[5]+p*n[8],i},A.c7=function(i,e,n,o,u,p,g){var x=1/(e-n),T=1/(o-u),C=1/(p-g);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+n)*x,i[13]=(u+o)*T,i[14]=(g+p)*C,i[15]=1,i},A.c8=class extends $r{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},A.c9=class extends $r{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},A.cA=function(i,e){return fe[e]&&"touches"in i},A.cB=function(i){return fe[i]||H[i]},A.cC=function(i,e,n){var o=e[0],u=e[1];return i[0]=n[0]*o+n[4]*u+n[12],i[1]=n[1]*o+n[5]*u+n[13],i},A.cD=function(i,e){const{x:n,y:o}=Hn.fromLngLat(e);return!(i<0||i>25||o<0||o>=1||n<0||n>=1)},A.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},A.cF=class extends dl{},A.cG=m1,A.cI=ye,A.cJ=function(i,e){ve.REGISTERED_PROTOCOLS[i]=e},A.cK=function(i){delete ve.REGISTERED_PROTOCOLS[i]},A.cL=function(i,e){const n={};for(let u=0;u<i.length;u++){const p=e&&e[i[u].id]||Zs(i[u]);e&&(e[i[u].id]=p);let g=n[p];g||(g=n[p]=[]),g.push(i[u])}const o=[];for(const u in n)o.push(n[u]);return o},A.cM=Rt,A.cN=Im,A.cO=Wm,A.cP=cp,A.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=_t/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new jn(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new jn(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new jn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new jn(C),i.canonical),o["text-size"].possiblyEvaluate(new jn(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new jn(C),i.canonical),o["icon-size"].possiblyEvaluate(new jn(I),i.canonical)]}const p=n.get("text-line-height")*ir,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",x=n.get("text-keep-upright"),T=n.get("text-size");for(const C of i.bucket.features){const I=n.get("text-font").evaluate(C,{},i.canonical).join(","),L=T.evaluate(C,{},i.canonical),B=u.layoutTextSize.evaluate(C,{},i.canonical),F=u.layoutIconSize.evaluate(C,{},i.canonical),q={horizontal:{},vertical:void 0},G=C.text;let X,J=[0,0];if(G){const ae=G.toString(),ge=n.get("text-letter-spacing").evaluate(C,{},i.canonical)*ir,be=dh(ae)?ge:0,je=n.get("text-anchor").evaluate(C,{},i.canonical),ot=Dl(e,C,i.canonical);if(!ot){const gt=n.get("text-radial-offset").evaluate(C,{},i.canonical);J=gt?Vn(je,[gt*ir,Cn]):n.get("text-offset").evaluate(C,{},i.canonical).map((et=>et*ir))}let Ke=g?"center":n.get("text-justify").evaluate(C,{},i.canonical);const ft=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(C,{},i.canonical)*ir:1/0,zt=()=>{i.bucket.allowVerticalPlacement&&Cs(ae)&&(q.vertical=Od(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,ft,p,je,"left",be,J,A.az.vertical,!0,B,L))};if(!g&&ot){const gt=new Set;if(Ke==="auto")for(let Ze=0;Ze<ot.values.length;Ze+=2)gt.add(Qm(ot.values[Ze]));else gt.add(Ke);let et=!1;for(const Ze of gt)if(!q.horizontal[Ze])if(et)q.horizontal[Ze]=q.horizontal[0];else{const Nt=Od(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,ft,p,"center",Ze,be,J,A.az.horizontal,!1,B,L);Nt&&(q.horizontal[Ze]=Nt,et=Nt.positionedLines.length===1)}zt()}else{Ke==="auto"&&(Ke=Qm(je));const gt=Od(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,ft,p,je,Ke,be,J,A.az.horizontal,!1,B,L);gt&&(q.horizontal[Ke]=gt),zt(),Cs(ae)&&g&&x&&(q.vertical=Od(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,ft,p,je,Ke,be,J,A.az.vertical,!1,B,L))}}let he=!1;if(C.icon&&C.icon.name){const ae=i.imageMap[C.icon.name];ae&&(X=wm(i.imagePositions[C.icon.name],n.get("icon-offset").evaluate(C,{},i.canonical),n.get("icon-anchor").evaluate(C,{},i.canonical)),he=!!ae.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=he:i.bucket.sdfIcons!==he&&zn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ee=F0(q.horizontal)||q.vertical;i.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||X)&&f1(i.bucket,C,q,X,i.imageMap,u,B,F,J,he,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},A.cR=bu,A.cS=hc,A.cT=Th,A.cU=function(i){const e=new sp;return(function(n,o){for(const u in n.layers)o.writeMessage(3,Ip,n.layers[u])})(i,e),e.finish()},A.cV=function(i,e,n,o,u,p){let g=s(i,e,n,u,0);return g=s(g,e,o,p,1),g},A.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},A.cX=In,A.cY=sp,A.cZ=tf,A.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},A.ca=class extends eo{},A.cb=Pg,A.cc=class extends mi{},A.cd=bd,A.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},A.cf=Lo,A.cg=function(i,e,n){var o=e[0],u=e[1],p=e[2],g=n[3]*o+n[7]*u+n[11]*p+n[15];return i[0]=(n[0]*o+n[4]*u+n[8]*p+n[12])/(g=g||1),i[1]=(n[1]*o+n[5]*u+n[9]*p+n[13])/g,i[2]=(n[2]*o+n[6]*u+n[10]*p+n[14])/g,i},A.ch=class extends fl{},A.ci=class extends t{},A.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},A.ck=function(i,e){var n=i[0],o=i[1],u=i[2],p=i[3],g=i[4],x=i[5],T=i[6],C=i[7],I=i[8],L=i[9],B=i[10],F=i[11],q=i[12],G=i[13],X=i[14],J=i[15],he=e[0],ee=e[1],ae=e[2],ge=e[3],be=e[4],je=e[5],ot=e[6],Ke=e[7],ft=e[8],zt=e[9],gt=e[10],et=e[11],Ze=e[12],Nt=e[13],Lt=e[14],Ut=e[15];return Math.abs(n-he)<=We*Math.max(1,Math.abs(n),Math.abs(he))&&Math.abs(o-ee)<=We*Math.max(1,Math.abs(o),Math.abs(ee))&&Math.abs(u-ae)<=We*Math.max(1,Math.abs(u),Math.abs(ae))&&Math.abs(p-ge)<=We*Math.max(1,Math.abs(p),Math.abs(ge))&&Math.abs(g-be)<=We*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(x-je)<=We*Math.max(1,Math.abs(x),Math.abs(je))&&Math.abs(T-ot)<=We*Math.max(1,Math.abs(T),Math.abs(ot))&&Math.abs(C-Ke)<=We*Math.max(1,Math.abs(C),Math.abs(Ke))&&Math.abs(I-ft)<=We*Math.max(1,Math.abs(I),Math.abs(ft))&&Math.abs(L-zt)<=We*Math.max(1,Math.abs(L),Math.abs(zt))&&Math.abs(B-gt)<=We*Math.max(1,Math.abs(B),Math.abs(gt))&&Math.abs(F-et)<=We*Math.max(1,Math.abs(F),Math.abs(et))&&Math.abs(q-Ze)<=We*Math.max(1,Math.abs(q),Math.abs(Ze))&&Math.abs(G-Nt)<=We*Math.max(1,Math.abs(G),Math.abs(Nt))&&Math.abs(X-Lt)<=We*Math.max(1,Math.abs(X),Math.abs(Lt))&&Math.abs(J-Ut)<=We*Math.max(1,Math.abs(J),Math.abs(Ut))},A.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},A.cm=i=>i.type==="symbol",A.cn=i=>i.type==="circle",A.co=i=>i.type==="heatmap",A.cp=i=>i.type==="line",A.cq=i=>i.type==="fill",A.cr=i=>i.type==="fill-extrusion",A.cs=i=>i.type==="hillshade",A.ct=i=>i.type==="color-relief",A.cu=i=>i.type==="background",A.cv=i=>i.type==="custom",A.cw=Pt,A.cx=function(i,e,n){const o=pt(e.x-n.x,e.y-n.y),u=pt(i.x-n.x,i.y-n.y),p=Math.atan2(o[0]*u[1]-o[1]*u[0],(function(g,x){return g[0]*x[0]+g[1]*x[1]})(o,u));return Qi(p)},A.cy=Vt,A.cz=function(i,e){return H[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},A.d=nt,A.d0=vh,A.d1=K,A.d2=class{constructor(i,e){this.layers={[nf]:this},this.name=nf,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new cy(this.features[i],this.extent)}},A.d3=Jl,A.d4=Da,A.e=rn,A.f=i=>l(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),A.g=Le,A.h=i=>new Promise(((e,n)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=Pr}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):Pr})),A.i=Wi,A.j=(i,e)=>Qe(rn(i,{type:"json"}),e),A.k=gn,A.l=Kt,A.m=Qe,A.n=(i,e)=>Qe(rn(i,{type:"arrayBuffer"}),e),A.o=function(i){return new sp(i).readFields(jg,[])},A.p=vm,A.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},A.r=xd,A.s=cs,A.t=Li,A.u=Ne,A.v=au,A.w=zn,A.x=ph,A.y=Xa,A.z=Ws})),z("worker",["./shared"],(function(A){class l{constructor(H,$){this.keyCache={},H&&this.replace(H,$)}replace(H,$){this._layerConfigs={},this._layers={},this.update(H,[],$)}update(H,$,Q){for(const ve of H){this._layerConfigs[ve.id]=ve;const Le=this._layers[ve.id]=A.bT(ve,Q);Le._featureFilter=A.aj(Le.filter,Q),this.keyCache[ve.id]&&delete this.keyCache[ve.id]}for(const ve of $)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const de=A.cL(Object.values(this._layerConfigs),this.keyCache);for(const ve of de){const Le=ve.map((Et=>this._layers[Et.id])),ke=Le[0];if(ke.isHidden())continue;const ye=ke.source||"";let Oe=this.familiesBySource[ye];Oe||(Oe=this.familiesBySource[ye]={});const Qe=ke.sourceLayer||A.ai;let nt=Oe[Qe];nt||(nt=Oe[Qe]=[]),nt.push(Le)}}}class N{constructor(H){const $={},Q=[];for(const ke in H){const ye=H[ke],Oe=$[ke]={};for(const Qe in ye){const nt=ye[+Qe];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const Et={x:0,y:0,w:nt.bitmap.width+2,h:nt.bitmap.height+2};Q.push(Et),Oe[Qe]={rect:Et,metrics:nt.metrics}}}const{w:de,h:ve}=A.p(Q),Le=new A.r({width:de||1,height:ve||1});for(const ke in H){const ye=H[ke];for(const Oe in ye){const Qe=ye[+Oe];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const nt=$[ke][Oe].rect;A.r.copy(Qe.bitmap,Le,{x:0,y:0},{x:nt.x+1,y:nt.y+1},Qe.bitmap)}}this.image=Le,this.positions=$}}A.cM("GlyphAtlas",N);class K{constructor(H){this.tileID=new A.a2(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[]}parse(H,$,Q,de,ve){return A._(this,void 0,void 0,(function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new A.ag;const Le=new A.cN(Object.keys(H.layers).sort()),ke=new A.cO(this.tileID,this.promoteId);ke.bucketLayerIDs=[];const ye={},Oe={featureIndex:ke,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:Q,subdivisionGranularity:ve},Qe=$.familiesBySource[this.source];for(const Dn in Qe){const ai=H.layers[Dn];if(!ai)continue;ai.version===1&&A.w(`Vector tile source "${this.source}" layer "${Dn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bl=Le.encode(Dn),Go=[];for(let xt=0;xt<ai.length;xt++){const br=ai.feature(xt),wr=ke.getId(br,Dn);Go.push({feature:br,id:wr,index:xt,sourceLayerIndex:Bl})}for(const xt of Qe[Dn]){const br=xt[0];br.source!==this.source&&A.w(`layer.source = ${br.source} does not equal this.source = ${this.source}`),br.isHidden(this.zoom,!0)||(ne(xt,this.zoom,Q),(ye[br.id]=br.createBucket({index:ke.bucketLayerIDs.length,layers:xt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bl,sourceID:this.source})).populate(Go,Oe,this.tileID.canonical),ke.bucketLayerIDs.push(xt.map((wr=>wr.id))))}}const nt=A.bY(Oe.glyphDependencies,(Dn=>Object.keys(Dn).map(Number)));this.inFlightDependencies.forEach((Dn=>Dn?.abort())),this.inFlightDependencies=[];let Et=Promise.resolve({});if(Object.keys(nt).length){const Dn=new AbortController;this.inFlightDependencies.push(Dn),Et=de.sendAsync({type:"GG",data:{stacks:nt,source:this.source,tileID:this.tileID,type:"glyphs"}},Dn)}const It=Object.keys(Oe.iconDependencies);let Kt=Promise.resolve({});if(It.length){const Dn=new AbortController;this.inFlightDependencies.push(Dn),Kt=de.sendAsync({type:"GI",data:{icons:It,source:this.source,tileID:this.tileID,type:"icons"}},Dn)}const gn=Object.keys(Oe.patternDependencies);let pn=Promise.resolve({});if(gn.length){const Dn=new AbortController;this.inFlightDependencies.push(Dn),pn=de.sendAsync({type:"GI",data:{icons:gn,source:this.source,tileID:this.tileID,type:"patterns"}},Dn)}const Ne=Oe.dashDependencies;let lt=Promise.resolve({});if(Object.keys(Ne).length){const Dn=new AbortController;this.inFlightDependencies.push(Dn),lt=de.sendAsync({type:"GDA",data:{dashes:Ne}},Dn)}const[Ot,Mt,tn,Tn]=yield Promise.all([Et,Kt,pn,lt]),Sn=new N(Ot),un=new A.cP(Mt,tn);for(const Dn in ye){const ai=ye[Dn];ai instanceof A.ah?(ne(ai.layers,this.zoom,Q),A.cQ({bucket:ai,glyphMap:Ot,glyphPositions:Sn.positions,imageMap:Mt,imagePositions:un.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Oe.subdivisionGranularity})):ai.hasDependencies&&(ai instanceof A.cR||ai instanceof A.cS||ai instanceof A.cT)&&(ne(ai.layers,this.zoom,Q),ai.addFeatures(Oe,this.tileID.canonical,un.patternPositions,Tn))}return this.status="done",{buckets:Object.values(ye).filter((Dn=>!Dn.isEmpty())),featureIndex:ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Sn.image,imageAtlas:un,dashPositions:Tn,glyphMap:this.returnDependencies?Ot:null,iconMap:this.returnDependencies?Mt:null,glyphPositions:this.returnDependencies?Sn.positions:null}}))}}function ne(fe,H,$){const Q=new A.H(H);for(const de of fe)de.recalculate(Q,$)}class re{constructor(H,$,Q,de,ve){this.type=H,this.properties=Q||{},this.extent=ve,this.pointsArray=$,this.id=de}loadGeometry(){return this.pointsArray.map((H=>H.map(($=>new A.P($.x,$.y)))))}}class Ee{constructor(H,$,Q){this.version=2,this._myFeatures=H,this.name=$,this.length=H.length,this.extent=Q}feature(H){return this._myFeatures[H]}}class Ae{constructor(){this.layers={}}addLayer(H){this.layers[H.name]=H}}function Pe(fe){let H=A.cU(fe);return H.byteOffset===0&&H.byteLength===H.buffer.byteLength||(H=new Uint8Array(H)),{vectorTile:fe,rawData:H.buffer}}function pe(fe,H,$){const{extent:Q}=fe,de=Math.pow(2,$.z-H.z),ve=($.x-H.x*de)*Q,Le=($.y-H.y*de)*Q,ke=[];for(let ye=0;ye<fe.length;ye++){const Oe=fe.feature(ye);let Qe=Oe.loadGeometry();for(const Et of Qe)for(const It of Et)It.x=It.x*de-ve,It.y=It.y*de-Le;const nt=128;Qe=A.cV(Qe,Oe.type,-nt,-nt,Q+nt,Q+nt),Qe.length!==0&&ke.push(new re(Oe.type,Qe,Oe.properties,Oe.id,Q))}return new Ee(ke,fe.name,Q)}class ie{constructor(H,$,Q){this.actor=H,this.layerIndex=$,this.availableImages=Q,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new A.cW(1e3)}loadVectorTile(H,$){return A._(this,void 0,void 0,(function*(){const Q=yield A.n(H.request,$);try{return{vectorTile:H.encoding!=="mlt"?new A.cX(new A.cY(Q.data)):new A.cZ(Q.data),rawData:Q.data,cacheControl:Q.cacheControl,expires:Q.expires}}catch(de){const ve=new Uint8Array(Q.data);let Le=`Unable to parse the tile at ${H.request.url}, `;throw Le+=ve[0]===31&&ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.message}`,new Error(Le)}}))}loadTile(H){return A._(this,void 0,void 0,(function*(){const{uid:$,overzoomParameters:Q}=H;Q&&(H.request=Q.overzoomRequest);const de=!!(H&&H.request&&H.request.collectResourceTiming)&&new A.c_(H.request),ve=new K(H);this.loading[$]=ve;const Le=new AbortController;ve.abort=Le;try{const ke=yield this.loadVectorTile(H,Le);if(delete this.loading[$],!ke)return null;if(Q){const Et=this._getOverzoomTile(H,ke.vectorTile);ke.rawData=Et.rawData,ke.vectorTile=Et.vectorTile}const ye=ke.rawData,Oe={};ke.expires&&(Oe.expires=ke.expires),ke.cacheControl&&(Oe.cacheControl=ke.cacheControl);const Qe={};if(de){const Et=de.finish();Et&&(Qe.resourceTiming=JSON.parse(JSON.stringify(Et)))}ve.vectorTile=ke.vectorTile;const nt=ve.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);this.loaded[$]=ve,this.fetching[$]={rawTileData:ye,cacheControl:Oe,resourceTiming:Qe};try{const Et=yield nt;return A.e({rawTileData:ye.slice(0),encoding:H.encoding},Et,Oe,Qe)}finally{delete this.fetching[$]}}catch(ke){throw delete this.loading[$],ve.status="done",this.loaded[$]=ve,ke}}))}_getOverzoomTile(H,$){const{tileID:Q,source:de,overzoomParameters:ve}=H,{maxZoomTileID:Le}=ve,ke=`${Le.key}_${Q.key}`,ye=this.overzoomedTileResultCache.get(ke);if(ye)return ye;const Oe=new Ae,Qe=this.layerIndex.familiesBySource[de];for(const Et in Qe){const It=$.layers[Et];if(!It)continue;const Kt=pe(It,Le,Q.canonical);Kt.length>0&&Oe.addLayer(Kt)}const nt=Pe(Oe);return this.overzoomedTileResultCache.set(ke,nt),nt}reloadTile(H){return A._(this,void 0,void 0,(function*(){const $=H.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Q=this.loaded[$];if(Q.showCollisionBoxes=H.showCollisionBoxes,Q.status==="parsing"){const de=yield Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);let ve;if(this.fetching[$]){const{rawTileData:Le,cacheControl:ke,resourceTiming:ye}=this.fetching[$];delete this.fetching[$],ve=A.e({rawTileData:Le.slice(0),encoding:H.encoding},de,ke,ye)}else ve=de;return ve}if(Q.status==="done"&&Q.vectorTile)return Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity)}))}abortTile(H){return A._(this,void 0,void 0,(function*(){const $=this.loading,Q=H.uid;$&&$[Q]&&$[Q].abort&&($[Q].abort.abort(),delete $[Q])}))}removeTile(H){return A._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[H.uid]&&delete this.loaded[H.uid]}))}}class Re{constructor(){this.loaded={}}loadTile(H){return A._(this,void 0,void 0,(function*(){const{uid:$,encoding:Q,rawImageData:de,redFactor:ve,greenFactor:Le,blueFactor:ke,baseShift:ye}=H,Oe=de.width+2,Qe=de.height+2,nt=A.b(de)?new A.R({width:Oe,height:Qe},yield A.c$(de,-1,-1,Oe,Qe)):de,Et=new A.d0($,nt,Q,ve,Le,ke,ye);return this.loaded=this.loaded||{},this.loaded[$]=Et,Et}))}removeTile(H){const $=this.loaded,Q=H.uid;$&&$[Q]&&delete $[Q]}}var We,it,Dt=(function(){if(it)return We;function fe($,Q){if($.length!==0){H($[0],Q);for(var de=1;de<$.length;de++)H($[de],!Q)}}function H($,Q){for(var de=0,ve=0,Le=0,ke=$.length,ye=ke-1;Le<ke;ye=Le++){var Oe=($[Le][0]-$[ye][0])*($[ye][1]+$[Le][1]),Qe=de+Oe;ve+=Math.abs(de)>=Math.abs(Oe)?de-Qe+Oe:Oe-Qe+de,de=Qe}de+ve>=0!=!!Q&&$.reverse()}return it=1,We=function $(Q,de){var ve,Le=Q&&Q.type;if(Le==="FeatureCollection")for(ve=0;ve<Q.features.length;ve++)$(Q.features[ve],de);else if(Le==="GeometryCollection")for(ve=0;ve<Q.geometries.length;ve++)$(Q.geometries[ve],de);else if(Le==="Feature")$(Q.geometry,de);else if(Le==="Polygon")fe(Q.coordinates,de);else if(Le==="MultiPolygon")for(ve=0;ve<Q.coordinates.length;ve++)fe(Q.coordinates[ve],de);return Q}})(),bt=A.d1(Dt);const rt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},at=Math.fround||(Ie=new Float32Array(1),fe=>(Ie[0]=+fe,Ie[0]));var Ie;class st{constructor(H){this.options=Object.assign(Object.create(rt),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:$,minZoom:Q,maxZoom:de}=this.options;$&&console.time("total time");const ve=`prepare ${H.length} points`;$&&console.time(ve),this.points=H;const Le=[];for(let ye=0;ye<H.length;ye++){const Oe=H[ye];if(!Oe.geometry)continue;const[Qe,nt]=Oe.geometry.coordinates,Et=at(Tt(Qe)),It=at(jt(nt));Le.push(Et,It,1/0,ye,-1,1),this.options.reduce&&Le.push(0)}let ke=this.trees[de+1]=this._createTree(Le);$&&console.timeEnd(ve);for(let ye=de;ye>=Q;ye--){const Oe=+Date.now();ke=this.trees[ye]=this._createTree(this._cluster(ke,ye)),$&&console.log("z%d: %d clusters in %dms",ye,ke.numItems,+Date.now()-Oe)}return $&&console.timeEnd("total time"),this}getClusters(H,$){let Q=((H[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,H[1]));let ve=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)Q=-180,ve=180;else if(Q>ve){const nt=this.getClusters([Q,de,180,Le],$),Et=this.getClusters([-180,de,ve,Le],$);return nt.concat(Et)}const ke=this.trees[this._limitZoom($)],ye=ke.range(Tt(Q),jt(Le),Tt(ve),jt(de)),Oe=ke.data,Qe=[];for(const nt of ye){const Et=this.stride*nt;Qe.push(Oe[Et+5]>1?tt(Oe,Et,this.clusterProps):this.points[Oe[Et+3]])}return Qe}getChildren(H){const $=this._getOriginId(H),Q=this._getOriginZoom(H),de="No cluster with the specified id.",ve=this.trees[Q];if(!ve)throw new Error(de);const Le=ve.data;if($*this.stride>=Le.length)throw new Error(de);const ke=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),ye=ve.within(Le[$*this.stride],Le[$*this.stride+1],ke),Oe=[];for(const Qe of ye){const nt=Qe*this.stride;Le[nt+4]===H&&Oe.push(Le[nt+5]>1?tt(Le,nt,this.clusterProps):this.points[Le[nt+3]])}if(Oe.length===0)throw new Error(de);return Oe}getLeaves(H,$,Q){const de=[];return this._appendLeaves(de,H,$=$||10,Q=Q||0,0),de}getTile(H,$,Q){const de=this.trees[this._limitZoom(H)],ve=Math.pow(2,H),{extent:Le,radius:ke}=this.options,ye=ke/Le,Oe=(Q-ye)/ve,Qe=(Q+1+ye)/ve,nt={features:[]};return this._addTileFeatures(de.range(($-ye)/ve,Oe,($+1+ye)/ve,Qe),de.data,$,Q,ve,nt),$===0&&this._addTileFeatures(de.range(1-ye/ve,Oe,1,Qe),de.data,ve,Q,ve,nt),$===ve-1&&this._addTileFeatures(de.range(0,Oe,ye/ve,Qe),de.data,-1,Q,ve,nt),nt.features.length?nt:null}getClusterExpansionZoom(H){let $=this._getOriginZoom(H)-1;for(;$<=this.options.maxZoom;){const Q=this.getChildren(H);if($++,Q.length!==1)break;H=Q[0].properties.cluster_id}return $}_appendLeaves(H,$,Q,de,ve){const Le=this.getChildren($);for(const ke of Le){const ye=ke.properties;if(ye&&ye.cluster?ve+ye.point_count<=de?ve+=ye.point_count:ve=this._appendLeaves(H,ye.cluster_id,Q,de,ve):ve<de?ve++:H.push(ke),H.length===Q)break}return ve}_createTree(H){const $=new A.aT(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<H.length;Q+=this.stride)$.add(H[Q],H[Q+1]);return $.finish(),$.data=H,$}_addTileFeatures(H,$,Q,de,ve,Le){for(const ke of H){const ye=ke*this.stride,Oe=$[ye+5]>1;let Qe,nt,Et;if(Oe)Qe=ct($,ye,this.clusterProps),nt=$[ye],Et=$[ye+1];else{const gn=this.points[$[ye+3]];Qe=gn.properties;const[pn,Ne]=gn.geometry.coordinates;nt=Tt(pn),Et=jt(Ne)}const It={type:1,geometry:[[Math.round(this.options.extent*(nt*ve-Q)),Math.round(this.options.extent*(Et*ve-de))]],tags:Qe};let Kt;Kt=Oe||this.options.generateId?$[ye+3]:this.points[$[ye+3]].id,Kt!==void 0&&(It.id=Kt),Le.features.push(It)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,$){const{radius:Q,extent:de,reduce:ve,minPoints:Le}=this.options,ke=Q/(de*Math.pow(2,$)),ye=H.data,Oe=[],Qe=this.stride;for(let nt=0;nt<ye.length;nt+=Qe){if(ye[nt+2]<=$)continue;ye[nt+2]=$;const Et=ye[nt],It=ye[nt+1],Kt=H.within(ye[nt],ye[nt+1],ke),gn=ye[nt+5];let pn=gn;for(const Ne of Kt){const lt=Ne*Qe;ye[lt+2]>$&&(pn+=ye[lt+5])}if(pn>gn&&pn>=Le){let Ne,lt=Et*gn,Ot=It*gn,Mt=-1;const tn=(nt/Qe<<5)+($+1)+this.points.length;for(const Tn of Kt){const Sn=Tn*Qe;if(ye[Sn+2]<=$)continue;ye[Sn+2]=$;const un=ye[Sn+5];lt+=ye[Sn]*un,Ot+=ye[Sn+1]*un,ye[Sn+4]=tn,ve&&(Ne||(Ne=this._map(ye,nt,!0),Mt=this.clusterProps.length,this.clusterProps.push(Ne)),ve(Ne,this._map(ye,Sn)))}ye[nt+4]=tn,Oe.push(lt/pn,Ot/pn,1/0,tn,-1,pn),ve&&Oe.push(Mt)}else{for(let Ne=0;Ne<Qe;Ne++)Oe.push(ye[nt+Ne]);if(pn>1)for(const Ne of Kt){const lt=Ne*Qe;if(!(ye[lt+2]<=$)){ye[lt+2]=$;for(let Ot=0;Ot<Qe;Ot++)Oe.push(ye[lt+Ot])}}}}return Oe}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,$,Q){if(H[$+5]>1){const Le=this.clusterProps[H[$+6]];return Q?Object.assign({},Le):Le}const de=this.points[H[$+3]].properties,ve=this.options.map(de);return Q&&ve===de?Object.assign({},ve):ve}}function tt(fe,H,$){return{type:"Feature",id:fe[H+3],properties:ct(fe,H,$),geometry:{type:"Point",coordinates:[(Q=fe[H],360*(Q-.5)),Gt(fe[H+1])]}};var Q}function ct(fe,H,$){const Q=fe[H+5],de=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,ve=fe[H+6],Le=ve===-1?{}:Object.assign({},$[ve]);return Object.assign(Le,{cluster:!0,cluster_id:fe[H+3],point_count:Q,point_count_abbreviated:de})}function Tt(fe){return fe/360+.5}function jt(fe){const H=Math.sin(fe*Math.PI/180),$=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return $<0?0:$>1?1:$}function Gt(fe){const H=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function ut(fe,H,$,Q){let de=Q;const ve=H+($-H>>1);let Le,ke=$-H;const ye=fe[H],Oe=fe[H+1],Qe=fe[$],nt=fe[$+1];for(let Et=H+3;Et<$;Et+=3){const It=Te(fe[Et],fe[Et+1],ye,Oe,Qe,nt);if(It>de)Le=Et,de=It;else if(It===de){const Kt=Math.abs(Et-ve);Kt<ke&&(Le=Et,ke=Kt)}}de>Q&&(Le-H>3&&ut(fe,H,Le,Q),fe[Le+2]=de,$-Le>3&&ut(fe,Le,$,Q))}function Te(fe,H,$,Q,de,ve){let Le=de-$,ke=ve-Q;if(Le!==0||ke!==0){const ye=((fe-$)*Le+(H-Q)*ke)/(Le*Le+ke*ke);ye>1?($=de,Q=ve):ye>0&&($+=Le*ye,Q+=ke*ye)}return Le=fe-$,ke=H-Q,Le*Le+ke*ke}function He(fe,H,$,Q){const de={id:fe??null,type:H,geometry:$,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")pt(de,$);else if(H==="Polygon")pt(de,$[0]);else if(H==="MultiLineString")for(const ve of $)pt(de,ve);else if(H==="MultiPolygon")for(const ve of $)pt(de,ve[0]);return de}function pt(fe,H){for(let $=0;$<H.length;$+=3)fe.minX=Math.min(fe.minX,H[$]),fe.minY=Math.min(fe.minY,H[$+1]),fe.maxX=Math.max(fe.maxX,H[$]),fe.maxY=Math.max(fe.maxY,H[$+1])}function _t(fe,H,$,Q){if(!H.geometry)return;const de=H.geometry.coordinates;if(de&&de.length===0)return;const ve=H.geometry.type,Le=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let ke=[],ye=H.id;if($.promoteId?ye=H.properties[$.promoteId]:$.generateId&&(ye=Q||0),ve==="Point")Ft(de,ke);else if(ve==="MultiPoint")for(const Oe of de)Ft(Oe,ke);else if(ve==="LineString")we(de,ke,Le,!1);else if(ve==="MultiLineString"){if($.lineMetrics){for(const Oe of de)ke=[],we(Oe,ke,Le,!1),fe.push(He(ye,"LineString",ke,H.properties));return}$e(de,ke,Le,!1)}else if(ve==="Polygon")$e(de,ke,Le,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const Oe of H.geometry.geometries)_t(fe,{id:ye,geometry:Oe,properties:H.properties},$,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Oe of de){const Qe=[];$e(Oe,Qe,Le,!0),ke.push(Qe)}}fe.push(He(ye,ve,ke,H.properties))}function Ft(fe,H){H.push(vt(fe[0]),Pt(fe[1]),0)}function we(fe,H,$,Q){let de,ve,Le=0;for(let ye=0;ye<fe.length;ye++){const Oe=vt(fe[ye][0]),Qe=Pt(fe[ye][1]);H.push(Oe,Qe,0),ye>0&&(Le+=Q?(de*Qe-Oe*ve)/2:Math.sqrt(Math.pow(Oe-de,2)+Math.pow(Qe-ve,2))),de=Oe,ve=Qe}const ke=H.length-3;H[2]=1,ut(H,0,ke,$),H[ke+2]=1,H.size=Math.abs(Le),H.start=0,H.end=H.size}function $e(fe,H,$,Q){for(let de=0;de<fe.length;de++){const ve=[];we(fe[de],ve,$,Q),H.push(ve)}}function vt(fe){return fe/360+.5}function Pt(fe){const H=Math.sin(fe*Math.PI/180),$=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return $<0?0:$>1?1:$}function Vt(fe,H,$,Q,de,ve,Le,ke){if(Q/=H,ve>=($/=H)&&Le<Q)return fe;if(Le<$||ve>=Q)return null;const ye=[];for(const Oe of fe){const Qe=Oe.geometry;let nt=Oe.type;const Et=de===0?Oe.minX:Oe.minY,It=de===0?Oe.maxX:Oe.maxY;if(Et>=$&&It<Q){ye.push(Oe);continue}if(It<$||Et>=Q)continue;let Kt=[];if(nt==="Point"||nt==="MultiPoint")Xt(Qe,Kt,$,Q,de);else if(nt==="LineString")Qt(Qe,Kt,$,Q,de,!1,ke.lineMetrics);else if(nt==="MultiLineString")Yt(Qe,Kt,$,Q,de,!1);else if(nt==="Polygon")Yt(Qe,Kt,$,Q,de,!0);else if(nt==="MultiPolygon")for(const gn of Qe){const pn=[];Yt(gn,pn,$,Q,de,!0),pn.length&&Kt.push(pn)}if(Kt.length){if(ke.lineMetrics&&nt==="LineString"){for(const gn of Kt)ye.push(He(Oe.id,nt,gn,Oe.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(Kt.length===1?(nt="LineString",Kt=Kt[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=Kt.length===3?"Point":"MultiPoint"),ye.push(He(Oe.id,nt,Kt,Oe.tags))}}return ye.length?ye:null}function Xt(fe,H,$,Q,de){for(let ve=0;ve<fe.length;ve+=3){const Le=fe[ve+de];Le>=$&&Le<=Q&&on(H,fe[ve],fe[ve+1],fe[ve+2])}}function Qt(fe,H,$,Q,de,ve,Le){let ke=rn(fe);const ye=de===0?xn:qn;let Oe,Qe,nt=fe.start;for(let pn=0;pn<fe.length-3;pn+=3){const Ne=fe[pn],lt=fe[pn+1],Ot=fe[pn+2],Mt=fe[pn+3],tn=fe[pn+4],Tn=de===0?Ne:lt,Sn=de===0?Mt:tn;let un=!1;Le&&(Oe=Math.sqrt(Math.pow(Ne-Mt,2)+Math.pow(lt-tn,2))),Tn<$?Sn>$&&(Qe=ye(ke,Ne,lt,Mt,tn,$),Le&&(ke.start=nt+Oe*Qe)):Tn>Q?Sn<Q&&(Qe=ye(ke,Ne,lt,Mt,tn,Q),Le&&(ke.start=nt+Oe*Qe)):on(ke,Ne,lt,Ot),Sn<$&&Tn>=$&&(Qe=ye(ke,Ne,lt,Mt,tn,$),un=!0),Sn>Q&&Tn<=Q&&(Qe=ye(ke,Ne,lt,Mt,tn,Q),un=!0),!ve&&un&&(Le&&(ke.end=nt+Oe*Qe),H.push(ke),ke=rn(fe)),Le&&(nt+=Oe)}let Et=fe.length-3;const It=fe[Et],Kt=fe[Et+1],gn=de===0?It:Kt;gn>=$&&gn<=Q&&on(ke,It,Kt,fe[Et+2]),Et=ke.length-3,ve&&Et>=3&&(ke[Et]!==ke[0]||ke[Et+1]!==ke[1])&&on(ke,ke[0],ke[1],ke[2]),ke.length&&H.push(ke)}function rn(fe){const H=[];return H.size=fe.size,H.start=fe.start,H.end=fe.end,H}function Yt(fe,H,$,Q,de,ve){for(const Le of fe)Qt(Le,H,$,Q,de,ve,!1)}function on(fe,H,$,Q){fe.push(H,$,Q)}function xn(fe,H,$,Q,de,ve){const Le=(ve-H)/(Q-H);return on(fe,ve,$+(de-$)*Le,1),Le}function qn(fe,H,$,Q,de,ve){const Le=(ve-$)/(de-$);return on(fe,H+(Q-H)*Le,ve,1),Le}function Ki(fe,H){const $=[];for(let Q=0;Q<fe.length;Q++){const de=fe[Q],ve=de.type;let Le;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Le=zn(de.geometry,H);else if(ve==="MultiLineString"||ve==="Polygon"){Le=[];for(const ke of de.geometry)Le.push(zn(ke,H))}else if(ve==="MultiPolygon"){Le=[];for(const ke of de.geometry){const ye=[];for(const Oe of ke)ye.push(zn(Oe,H));Le.push(ye)}}$.push(He(de.id,ve,Le,de.tags))}return $}function zn(fe,H){const $=[];$.size=fe.size,fe.start!==void 0&&($.start=fe.start,$.end=fe.end);for(let Q=0;Q<fe.length;Q+=3)$.push(fe[Q]+H,fe[Q+1],fe[Q+2]);return $}function wi(fe,H){if(fe.transformed)return fe;const $=1<<fe.z,Q=fe.x,de=fe.y;for(const ve of fe.features){const Le=ve.geometry,ke=ve.type;if(ve.geometry=[],ke===1)for(let ye=0;ye<Le.length;ye+=2)ve.geometry.push(Wi(Le[ye],Le[ye+1],H,$,Q,de));else for(let ye=0;ye<Le.length;ye++){const Oe=[];for(let Qe=0;Qe<Le[ye].length;Qe+=2)Oe.push(Wi(Le[ye][Qe],Le[ye][Qe+1],H,$,Q,de));ve.geometry.push(Oe)}}return fe.transformed=!0,fe}function Wi(fe,H,$,Q,de,ve){return[Math.round($*(fe*Q-de)),Math.round($*(H*Q-ve))]}function Yn(fe,H,$,Q,de){const ve=H===de.maxZoom?0:de.tolerance/((1<<H)*de.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:fe.length,source:null,x:$,y:Q,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ke of fe)na(Le,ke,ve,de);return Le}function na(fe,H,$,Q){const de=H.geometry,ve=H.type,Le=[];if(fe.minX=Math.min(fe.minX,H.minX),fe.minY=Math.min(fe.minY,H.minY),fe.maxX=Math.max(fe.maxX,H.maxX),fe.maxY=Math.max(fe.maxY,H.maxY),ve==="Point"||ve==="MultiPoint")for(let ke=0;ke<de.length;ke+=3)Le.push(de[ke],de[ke+1]),fe.numPoints++,fe.numSimplified++;else if(ve==="LineString")Pr(Le,de,fe,$,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let ke=0;ke<de.length;ke++)Pr(Le,de[ke],fe,$,ve==="Polygon",ke===0);else if(ve==="MultiPolygon")for(let ke=0;ke<de.length;ke++){const ye=de[ke];for(let Oe=0;Oe<ye.length;Oe++)Pr(Le,ye[Oe],fe,$,!0,Oe===0)}if(Le.length){let ke=H.tags||null;if(ve==="LineString"&&Q.lineMetrics){ke={};for(const Oe in H.tags)ke[Oe]=H.tags[Oe];ke.mapbox_clip_start=de.start/de.size,ke.mapbox_clip_end=de.end/de.size}const ye={geometry:Le,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:ke};H.id!==null&&(ye.id=H.id),fe.features.push(ye)}}function Pr(fe,H,$,Q,de,ve){const Le=Q*Q;if(Q>0&&H.size<(de?Le:Q))return void($.numPoints+=H.length/3);const ke=[];for(let ye=0;ye<H.length;ye+=3)(Q===0||H[ye+2]>Le)&&($.numSimplified++,ke.push(H[ye],H[ye+1])),$.numPoints++;de&&(function(ye,Oe){let Qe=0;for(let nt=0,Et=ye.length,It=Et-2;nt<Et;It=nt,nt+=2)Qe+=(ye[nt]-ye[It])*(ye[nt+1]+ye[It+1]);if(Qe>0===Oe)for(let nt=0,Et=ye.length;nt<Et/2;nt+=2){const It=ye[nt],Kt=ye[nt+1];ye[nt]=ye[Et-2-nt],ye[nt+1]=ye[Et-1-nt],ye[Et-2-nt]=It,ye[Et-1-nt]=Kt}})(ke,ve),fe.push(ke)}const ia={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ur{constructor(H,$){const Q=($=this.options=(function(ve,Le){for(const ke in Le)ve[ke]=Le[ke];return ve})(Object.create(ia),$)).debug;if(Q&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=(function(ve,Le){const ke=[];if(ve.type==="FeatureCollection")for(let ye=0;ye<ve.features.length;ye++)_t(ke,ve.features[ye],Le,ye);else _t(ke,ve.type==="Feature"?ve:{geometry:ve},Le);return ke})(H,$);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=(function(ve,Le){const ke=Le.buffer/Le.extent;let ye=ve;const Oe=Vt(ve,1,-1-ke,ke,0,-1,2,Le),Qe=Vt(ve,1,1-ke,2+ke,0,-1,2,Le);return(Oe||Qe)&&(ye=Vt(ve,1,-ke,1+ke,0,-1,2,Le)||[],Oe&&(ye=Ki(Oe,1).concat(ye)),Qe&&(ye=ye.concat(Ki(Qe,-1)))),ye})(de,$),de.length&&this.splitTile(de,0,0,0),Q&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,$,Q,de,ve,Le,ke){const ye=[H,$,Q,de],Oe=this.options,Qe=Oe.debug;for(;ye.length;){de=ye.pop(),Q=ye.pop(),$=ye.pop(),H=ye.pop();const nt=1<<$,Et=Ir($,Q,de);let It=this.tiles[Et];if(!It&&(Qe>1&&console.time("creation"),It=this.tiles[Et]=Yn(H,$,Q,de,Oe),this.tileCoords.push({z:$,x:Q,y:de}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,Q,de,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));const un=`z${$}`;this.stats[un]=(this.stats[un]||0)+1,this.total++}if(It.source=H,ve==null){if($===Oe.indexMaxZoom||It.numPoints<=Oe.indexMaxPoints)continue}else{if($===Oe.maxZoom||$===ve)continue;if(ve!=null){const un=ve-$;if(Q!==Le>>un||de!==ke>>un)continue}}if(It.source=null,H.length===0)continue;Qe>1&&console.time("clipping");const Kt=.5*Oe.buffer/Oe.extent,gn=.5-Kt,pn=.5+Kt,Ne=1+Kt;let lt=null,Ot=null,Mt=null,tn=null,Tn=Vt(H,nt,Q-Kt,Q+pn,0,It.minX,It.maxX,Oe),Sn=Vt(H,nt,Q+gn,Q+Ne,0,It.minX,It.maxX,Oe);H=null,Tn&&(lt=Vt(Tn,nt,de-Kt,de+pn,1,It.minY,It.maxY,Oe),Ot=Vt(Tn,nt,de+gn,de+Ne,1,It.minY,It.maxY,Oe),Tn=null),Sn&&(Mt=Vt(Sn,nt,de-Kt,de+pn,1,It.minY,It.maxY,Oe),tn=Vt(Sn,nt,de+gn,de+Ne,1,It.minY,It.maxY,Oe),Sn=null),Qe>1&&console.timeEnd("clipping"),ye.push(lt||[],$+1,2*Q,2*de),ye.push(Ot||[],$+1,2*Q,2*de+1),ye.push(Mt||[],$+1,2*Q+1,2*de),ye.push(tn||[],$+1,2*Q+1,2*de+1)}}getTile(H,$,Q){H=+H,$=+$,Q=+Q;const de=this.options,{extent:ve,debug:Le}=de;if(H<0||H>24)return null;const ke=1<<H,ye=Ir(H,$=$+ke&ke-1,Q);if(this.tiles[ye])return wi(this.tiles[ye],ve);Le>1&&console.log("drilling down to z%d-%d-%d",H,$,Q);let Oe,Qe=H,nt=$,Et=Q;for(;!Oe&&Qe>0;)Qe--,nt>>=1,Et>>=1,Oe=this.tiles[Ir(Qe,nt,Et)];return Oe&&Oe.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",Qe,nt,Et),console.time("drilling down")),this.splitTile(Oe.source,Qe,nt,Et,H,$,Q),Le>1&&console.timeEnd("drilling down"),this.tiles[ye]?wi(this.tiles[ye],ve):null):null}}function Ir(fe,H,$){return 32*((1<<fe)*$+H)+fe}class cs extends ie{constructor(H,$,Q,de=Ti){super(H,$,Q),this._dataUpdateable=new Map,this._createGeoJSONIndex=de}loadVectorTile(H,$){return A._(this,void 0,void 0,(function*(){const Q=H.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);return de?Pe(new A.d2(de.features,{version:2,extent:A.a5})):null}))}loadData(H){return A._(this,void 0,void 0,(function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();const Q=this._startPerformance(H);this._pendingRequest=new AbortController;try{(!this._pendingData||H.request||H.data||H.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest));const de=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(de,H),this.loaded={};const ve={};return H.request&&(ve.data=de),this._finishPerformance(Q,H,ve),ve}catch(de){if(delete this._pendingRequest,A.Z(de))return{abandoned:!0};throw de}}))}_startPerformance(H){var $;if(!(($=H?.request)===null||$===void 0)&&$.collectResourceTiming)return new A.c_(H.request)}_finishPerformance(H,$,Q){if(!H)return;const de=H.finish();de&&(Q.resourceTiming={},Q.resourceTiming[$.source]=JSON.parse(JSON.stringify(de)))}getData(){return A._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(H){const $=this.loaded;return $&&$[H.uid]?super.reloadTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,$){return A._(this,void 0,void 0,(function*(){let Q;if(H.request?Q=yield this.loadGeoJSONFromUrl(H.request,H.promoteId,$):H.data?Q=this._loadGeoJSONFromObject(H.data,H.promoteId):H.dataDiff&&(Q=this._loadGeoJSONFromDiff(H.dataDiff,H.promoteId,H.source)),delete this._pendingRequest,typeof Q!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);return bt(Q,!0),H.filter&&(Q=this._filterGeoJSON(Q,H.filter)),Q}))}loadGeoJSONFromUrl(H,$,Q){return A._(this,void 0,void 0,(function*(){const de=yield A.j(H,Q);return this._dataUpdateable=A.a7(de.data,$),de.data}))}_loadGeoJSONFromObject(H,$){return this._dataUpdateable=A.a7(H,$),H}_loadGeoJSONFromDiff(H,$,Q){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Q}`);A.a8(this._dataUpdateable,H,$);const de=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(de)}_filterGeoJSON(H,$){const Q=A.d3($,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map((ve=>`${ve.key}: ${ve.message}`)).join(", "));const de=H.features.filter((ve=>Q.value.evaluate({zoom:0},ve)));return this._toFeatureCollection(de)}_toFeatureCollection(H){return{type:"FeatureCollection",features:H}}removeSource(H){return A._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}function Ti(fe,H){return H.cluster?new st((function({superclusterOptions:$,clusterProperties:Q}){if(!Q||!$)return $;const de={},ve={},Le={accumulated:null,zoom:0},ke={properties:null},ye=Object.keys(Q);for(const Oe of ye){const[Qe,nt]=Q[Oe],Et=A.d3(nt),It=A.d3(typeof Qe=="string"?[Qe,["accumulated"],["get",Oe]]:Qe);de[Oe]=Et.value,ve[Oe]=It.value}return $.map=Oe=>{ke.properties=Oe;const Qe={};for(const nt of ye)Qe[nt]=de[nt].evaluate(Le,ke);return Qe},$.reduce=(Oe,Qe)=>{ke.properties=Qe;for(const nt of ye)Le.accumulated=Oe[nt],Oe[nt]=ve[nt].evaluate(Le,ke)},$})(H)).load(fe.features):(function($,Q){return new Ur($,Q)})(fe,H.geojsonVtOptions)}class Qi{constructor(H){this.self=H,this.actor=new A.L(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=($,Q)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=Q},this.self.addProtocol=A.cJ,this.self.removeProtocol=A.cK,this.self.registerRTLTextPlugin=$=>{A.d4.setMethods($)},this.actor.registerMessageHandler("LDT",(($,Q)=>this._getDEMWorkerSource($,Q.source).loadTile(Q))),this.actor.registerMessageHandler("RDT",(($,Q)=>A._(this,void 0,void 0,(function*(){this._getDEMWorkerSource($,Q.source).removeTile(Q)})))),this.actor.registerMessageHandler("GCEZ",(($,Q)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource($,Q.type,Q.source).getClusterExpansionZoom(Q)})))),this.actor.registerMessageHandler("GCC",(($,Q)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource($,Q.type,Q.source).getClusterChildren(Q)})))),this.actor.registerMessageHandler("GCL",(($,Q)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource($,Q.type,Q.source).getClusterLeaves(Q)})))),this.actor.registerMessageHandler("LD",(($,Q)=>this._getWorkerSource($,Q.type,Q.source).loadData(Q))),this.actor.registerMessageHandler("GD",(($,Q)=>this._getWorkerSource($,Q.type,Q.source).getData())),this.actor.registerMessageHandler("LT",(($,Q)=>this._getWorkerSource($,Q.type,Q.source).loadTile(Q))),this.actor.registerMessageHandler("RT",(($,Q)=>this._getWorkerSource($,Q.type,Q.source).reloadTile(Q))),this.actor.registerMessageHandler("AT",(($,Q)=>this._getWorkerSource($,Q.type,Q.source).abortTile(Q))),this.actor.registerMessageHandler("RMT",(($,Q)=>this._getWorkerSource($,Q.type,Q.source).removeTile(Q))),this.actor.registerMessageHandler("RS",(($,Q)=>A._(this,void 0,void 0,(function*(){if(!this.workerSources[$]||!this.workerSources[$][Q.type]||!this.workerSources[$][Q.type][Q.source])return;const de=this.workerSources[$][Q.type][Q.source];delete this.workerSources[$][Q.type][Q.source],de.removeSource!==void 0&&de.removeSource(Q)})))),this.actor.registerMessageHandler("RM",($=>A._(this,void 0,void 0,(function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],this.globalStates.delete($)})))),this.actor.registerMessageHandler("SR",(($,Q)=>A._(this,void 0,void 0,(function*(){this.referrer=Q})))),this.actor.registerMessageHandler("SRPS",(($,Q)=>this._syncRTLPluginState($,Q))),this.actor.registerMessageHandler("IS",(($,Q)=>A._(this,void 0,void 0,(function*(){this.self.importScripts(Q)})))),this.actor.registerMessageHandler("SI",(($,Q)=>this._setImages($,Q))),this.actor.registerMessageHandler("UL",(($,Q)=>A._(this,void 0,void 0,(function*(){this._getLayerIndex($).update(Q.layers,Q.removedIds,this._getGlobalState($))})))),this.actor.registerMessageHandler("UGS",(($,Q)=>A._(this,void 0,void 0,(function*(){const de=this._getGlobalState($);for(const ve in Q)de[ve]=Q[ve]})))),this.actor.registerMessageHandler("SL",(($,Q)=>A._(this,void 0,void 0,(function*(){this._getLayerIndex($).replace(Q,this._getGlobalState($))}))))}_getGlobalState(H){let $=this.globalStates.get(H);return $||($={},this.globalStates.set(H,$)),$}_setImages(H,$){return A._(this,void 0,void 0,(function*(){this.availableImages[H]=$;for(const Q in this.workerSources[H]){const de=this.workerSources[H][Q];for(const ve in de)de[ve].availableImages=$}}))}_syncRTLPluginState(H,$){return A._(this,void 0,void 0,(function*(){return yield A.d4.syncState($,this.self.importScripts)}))}_getAvailableImages(H){let $=this.availableImages[H];return $||($=[]),$}_getLayerIndex(H){let $=this.layerIndexes[H];return $||($=this.layerIndexes[H]=new l),$}_getWorkerSource(H,$,Q){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][$]||(this.workerSources[H][$]={}),!this.workerSources[H][$][Q]){const de={sendAsync:(ve,Le)=>(ve.targetMapId=H,this.actor.sendAsync(ve,Le))};switch($){case"vector":this.workerSources[H][$][Q]=new ie(de,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][$][Q]=new cs(de,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][$][Q]=new this.externalWorkerSourceTypes[$](de,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][$][Q]}_getDEMWorkerSource(H,$){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][$]||(this.demWorkerSources[H][$]=new Re),this.demWorkerSources[H][$]}}return A.i(self)&&(self.worker=new Qi(self)),Qi})),z("index",["exports","./shared"],(function(A,l){var N="5.15.0";function K(){var y=new l.A(4);return l.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}let ne,re,Ee;const Ae={frame(y,t,a){const c=requestAnimationFrame((v=>{f(),t(v)})),{unsubscribe:f}=l.s(y.signal,"abort",(()=>{f(),cancelAnimationFrame(c),a(new l.a(y.signal.reason))}),!1)},frameAsync(y){return new Promise(((t,a)=>{this.frame(y,t,a)}))},getImageData(y,t=0){return this.getImageCanvasContext(y).getImageData(-t,-t,y.width+2*t,y.height+2*t)},getImageCanvasContext(y){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=y.width,t.height=y.height,a.drawImage(y,0,0,y.width,y.height),a},resolveURL:y=>(ne||(ne=document.createElement("a")),ne.href=y,ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Ee!==void 0?Ee:!!matchMedia&&(re==null&&(re=matchMedia("(prefers-reduced-motion: reduce)")),re.matches)},set prefersReducedMotion(y){Ee=y}},Pe=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(y){this._frozenAt=y}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function pe(){return Pe.getCurrentTime()}class ie{static testProp(t){if(!ie.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in ie.docStyle)return t[a];return t[0]}static create(t,a,c){const f=window.document.createElement(t);return a!==void 0&&(f.className=a),c&&c.appendChild(f),f}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){ie.docStyle&&ie.selectProp&&(ie.userSelect=ie.docStyle[ie.selectProp],ie.docStyle[ie.selectProp]="none")}static enableDrag(){ie.docStyle&&ie.selectProp&&(ie.docStyle[ie.selectProp]=ie.userSelect)}static setTransform(t,a){t.style[ie.transformProp]=a}static addEventListener(t,a,c,f={}){t.addEventListener(a,c,"passive"in f?f:f.capture)}static removeEventListener(t,a,c,f={}){t.removeEventListener(a,c,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",ie.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ie.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ie.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,c){const f=a.boundingClientRect;return new l.P((c.clientX-f.left)/a.x-t.clientLeft,(c.clientY-f.top)/a.y-t.clientTop)}static mousePos(t,a){const c=ie.getScale(t);return ie.getPoint(t,c,a)}static touchPos(t,a){const c=[],f=ie.getScale(t);for(let v=0;v<a.length;v++)c.push(ie.getPoint(t,f,a[v]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(const f of c)f.remove();return ie.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const c of a)ie.removeAttributes(c),ie.clean(c)}static removeAttributes(t){for(const{name:a,value:c}of t.attributes)ie.isPossiblyDangerous(a,c)&&t.removeAttribute(a)}}ie.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ie.selectProp=ie.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ie.transformProp=ie.testProp(["transform","WebkitTransform"]);const Re={supported:!1,testSupport:function(y){!Dt&&it&&(bt?rt(y):We=y)}};let We,it,Dt=!1,bt=!1;function rt(y){const t=y.createTexture();y.bindTexture(y.TEXTURE_2D,t);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,it),y.isContextLost())return;Re.supported=!0}catch{}y.deleteTexture(t),Dt=!0}var at;typeof document<"u"&&(it=document.createElement("img"),it.onload=()=>{We&&rt(We),We=null,bt=!0},it.onerror=()=>{Dt=!0,We=null},it.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(y){let t,a,c,f;y.resetRequestQueue=()=>{t=[],a=0,c=0,f={}},y.addThrottleControl=D=>{const R=c++;return f[R]=D,R},y.removeThrottleControl=D=>{delete f[D],w()},y.getImage=(D,R,O=!0)=>new Promise(((U,j)=>{Re.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),l.e(D,{type:"image"}),t.push({abortController:R,requestParameters:D,supportImageRefresh:O,state:"queued",onError:Z=>{j(Z)},onSuccess:Z=>{U(Z)}}),w()}));const v=D=>l._(this,void 0,void 0,(function*(){D.state="running";const{requestParameters:R,supportImageRefresh:O,onError:U,onSuccess:j,abortController:Z}=D,W=O===!1&&!l.i(self)&&!l.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce(((oe,ue)=>oe&&ue==="accept"),!0));a++;const se=W?E(R,Z):l.m(R,Z);try{const oe=yield se;delete D.abortController,D.state="completed",oe.data instanceof HTMLImageElement||l.b(oe.data)?j(oe):oe.data&&j({data:yield(le=oe.data,typeof createImageBitmap=="function"?l.f(le):l.h(le)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete D.abortController,U(oe)}finally{a--,w()}var le})),w=()=>{const D=(()=>{for(const R of Object.keys(f))if(f[R]())return!0;return!1})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=a;R<D&&t.length>0;R++){const O=t.shift();O.abortController.signal.aborted?R--:v(O)}},E=(D,R)=>new Promise(((O,U)=>{const j=new Image,Z=D.url,W=D.credentials;W&&W==="include"?j.crossOrigin="use-credentials":(W&&W==="same-origin"||!l.d(Z))&&(j.crossOrigin="anonymous"),R.signal.addEventListener("abort",(()=>{j.src="",U(new l.a(R.signal.reason))})),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,O({data:j})},j.onerror=()=>{j.onerror=j.onload=null,R.signal.aborted||U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=Z}))})(at||(at={})),at.resetRequestQueue();class Ie{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function st(y){const t=[];if(typeof y=="string")t.push({id:"default",url:y});else if(y&&y.length>0){const a=[];for(const{id:c,url:f}of y){const v=`${c}${f}`;a.indexOf(v)===-1&&(a.push(v),t.push({id:c,url:f}))}}return t}function tt(y,t,a){try{const c=new URL(y);return c.pathname+=`${t}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${y}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ct(y){const{userImage:t}=y;return!!(t&&t.render&&t.render())&&(y.data.replace(new Uint8Array(t.data.buffer)),!0)}class Tt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new l.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let c=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,a){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||a<f[1])return!1;c=f[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const c=a.spriteData,f=c&&c.width||a.data.width,v=c&&c.height||a.data.height;return!(t[0]<0||f<t[0]||t[1]<0||v<t[1]||t[2]<0||f<t[2]||t[3]<0||v<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,c=!0){const f=this.getImage(t);if(c&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,c)=>{let f=!0;if(!this.isLoaded())for(const v of t)this.images[v]||(f=!1);this.isLoaded()||f?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const c of t){let f=this.getImage(c);f||(this.fire(new l.l("styleimagemissing",{id:c})),f=this.getImage(c)),f?a[c]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],c=this.getImage(t);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const f={w:c.data.width+2,h:c.data.height+2,x:0,y:0},v=new l.I(f,c);this.patterns[t]={bin:f,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:a,h:c}=l.p(t),f=this.atlasImage;f.resize({width:a||1,height:c||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],E=w.x+1,D=w.y+1,R=this.getImage(v).data,O=R.width,U=R.height;l.R.copy(R,f,{x:0,y:0},{x:E,y:D},{width:O,height:U}),l.R.copy(R,f,{x:0,y:U-1},{x:E,y:D-1},{width:O,height:1}),l.R.copy(R,f,{x:0,y:0},{x:E,y:D+U},{width:O,height:1}),l.R.copy(R,f,{x:O-1,y:0},{x:E-1,y:D},{width:1,height:U}),l.R.copy(R,f,{x:0,y:0},{x:E+O,y:D},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||l.w(`Image with ID: "${a}" was not found`),ct(c)&&this.updateImage(a,c)}}cloneImages(){const t={};for(const a in this.images){const c=this.images[a];t[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return t}}const jt=1e20;function Gt(y,t,a,c,f,v,w,E,D){for(let R=t;R<t+c;R++)ut(y,a*v+R,v,f,w,E,D);for(let R=a;R<a+f;R++)ut(y,R*v+t,1,c,w,E,D)}function ut(y,t,a,c,f,v,w){v[0]=0,w[0]=-jt,w[1]=jt,f[0]=y[t];for(let E=1,D=0,R=0;E<c;E++){f[E]=y[t+E*a];const O=E*E;do{const U=v[D];R=(f[E]-f[U]+O-U*U)/(E-U)/2}while(R<=w[D]&&--D>-1);D++,v[D]=E,w[D]=R,w[D+1]=jt}for(let E=0,D=0;E<c;E++){for(;w[D+1]<E;)D++;const R=v[D],O=E-R;y[t+E*a]=f[R]+O*O}}const Te=l.v.layout_symbol["text-font"].default.join(",");class He{constructor(t,a,c){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,(function*(){const a=[];for(const v in t)for(const w of t[v])a.push(this._getAndCacheGlyphsPromise(v,w));const c=yield Promise.all(a),f={};for(const{stack:v,id:w,glyph:E}of c)f[v]||(f[v]={}),f[v][w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return f}))}_getAndCacheGlyphsPromise(t,a){return l._(this,void 0,void 0,(function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let f=c.glyphs[a];return f!==void 0?{stack:t,id:a,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(f=c.glyphs[a]=this._drawGlyph(c,t,a),{stack:t,id:a,glyph:f}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return l._(this,void 0,void 0,(function*(){const c=this.entries[t],f=Math.floor(a/256);if(c.ranges[f])return{stack:t,id:a,glyph:null};if(!c.requests[f]){const v=He.loadGlyphRange(t,f,this.url,this.requestManager);c.requests[f]=v}try{const v=yield c.requests[f];for(const w in v)c.glyphs[+w]=v[+w];return c.ranges[f]=!0,{stack:t,id:a,glyph:v[a]||null}}catch(v){const w=c.glyphs[a]=this._drawGlyph(c,t,a);return this._warnOnMissingGlyphRange(w,f,a,v),{stack:t,id:a,glyph:w}}}))}_warnOnMissingGlyphRange(t,a,c,f){const v=256*a,w=v+255,E=c.toString(16).padStart(4,"0").toUpperCase();l.w(`Unable to load glyph range ${a}, ${v}-${w}. Rendering codepoint U+${E} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&l.q(t)}_drawGlyph(t,a,c){const f=a===Te&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),v=f?"ideographTinySDF":"tinySDF";t[v]||(t[v]=this._createTinySDF(f?this.localIdeographFontFamily:a));const w=t[v].draw(String.fromCodePoint(c));return{id:c,bitmap:new l.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const c=a.map((f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`)).join(",");return new He.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[f,v]of Object.entries(a))new RegExp(`\\b${f}\\b`,"i").test(t)&&(c=`${v}`);return c}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}He.loadGlyphRange=function(y,t,a,c){return l._(this,void 0,void 0,(function*(){const f=256*t,v=f+255,w=c.transformRequest(a.replace("{fontstack}",y).replace("{range}",`${f}-${v}`),"Glyphs"),E=yield l.n(w,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${t}, ${f}-${v}`);const D={};for(const R of l.o(E.data))D[R.id]=R;return D}))},He.TinySDF=class{constructor({fontSize:y=24,buffer:t=3,radius:a=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:v="normal",fontStyle:w="normal",lang:E=null}={}){this.buffer=t,this.cutoff=c,this.radius=a,this.lang=E;const D=this.size=y+4*t,R=this._createCanvas(D),O=this.ctx=R.getContext("2d",{willReadFrequently:!0});O.font=`${w} ${v} ${y}px ${f}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(y){const t=document.createElement("canvas");return t.width=t.height=y,t}draw(y){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:v}=this.ctx.measureText(y),w=Math.ceil(a),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-f))),D=Math.min(this.size-this.buffer,w+Math.ceil(c)),R=E+2*this.buffer,O=D+2*this.buffer,U=Math.max(R*O,0),j=new Uint8ClampedArray(U),Z={data:j,width:R,height:O,glyphWidth:E,glyphHeight:D,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(E===0||D===0)return Z;const{ctx:W,buffer:se,gridInner:le,gridOuter:oe}=this;this.lang&&(W.lang=this.lang),W.clearRect(se,se,E,D),W.fillText(y,se,se+w);const ue=W.getImageData(se,se,E,D);oe.fill(jt,0,U),le.fill(0,0,U);for(let xe=0;xe<D;xe++)for(let ce=0;ce<E;ce++){const _e=ue.data[4*(xe*E+ce)+3]/255;if(_e===0)continue;const Se=(xe+se)*R+ce+se;if(_e===1)oe[Se]=0,le[Se]=jt;else{const me=.5-_e;oe[Se]=me>0?me*me:0,le[Se]=me<0?me*me:0}}Gt(oe,0,0,R,O,R,this.f,this.v,this.z),Gt(le,se,se,E,D,R,this.f,this.v,this.z);for(let xe=0;xe<U;xe++){const ce=Math.sqrt(oe[xe])-Math.sqrt(le[xe]);j[xe]=Math.round(255-255*(ce/this.radius+this.cutoff))}return Z}};class pt{constructor(){this.specification=l.u.light.position}possiblyEvaluate(t,a){return l.F(t.expression.evaluate(a))}interpolate(t,a,c){return{x:l.G.number(t.x,a.x,c),y:l.G.number(t.y,a.y,c),z:l.G.number(t.z,a.z,c)}}}let _t;class Ft extends l.E{constructor(t){super(),_t=_t||new l.t({anchor:new l.D(l.u.light.anchor),position:new pt,color:new l.D(l.u.light.color),intensity:new l.D(l.u.light.intensity)}),this._transitionable=new l.x(_t,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(l.y,t,a))for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c){return(!c||c.validate!==!1)&&l.B(this,t.call(l.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u}))}}const we=new l.t({"sky-color":new l.D(l.u.sky["sky-color"]),"horizon-color":new l.D(l.u.sky["horizon-color"]),"fog-color":new l.D(l.u.sky["fog-color"]),"fog-ground-blend":new l.D(l.u.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.u.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.u.sky["atmosphere-blend"])});class $e extends l.E{constructor(t){super(),this._transitionable=new l.x(we,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0))}setSky(t,a={}){if(!this._validate(l.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c={}){return c?.validate!==!1&&l.B(this,t.call(l.C,l.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class vt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const c=t.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,a)),this.dashEntry[c]}getDashRanges(t,a,c){const f=[];let v=t.length%2==1?-t[t.length-1]*c:0,w=t[0]*c,E=!0;f.push({left:v,right:w,isDash:E,zeroLength:t[0]===0});let D=t[0];for(let R=1;R<t.length;R++){E=!E;const O=t[R];v=D*c,D+=O,w=D*c,f.push({left:v,right:w,isDash:E,zeroLength:O===0})}return f}addRoundDash(t,a,c){const f=a/2;for(let v=-c;v<=c;v++){const w=this.width*(this.nextRow+c+v);let E=0,D=t[E];for(let R=0;R<this.width;R++){R/D.right>1&&(D=t[++E]);const O=Math.abs(R-D.left),U=Math.abs(R-D.right),j=Math.min(O,U);let Z;const W=v/c*(f+1);if(D.isDash){const se=f-Math.abs(W);Z=Math.sqrt(j*j+se*se)}else Z=f-Math.sqrt(j*j+W*W);this.data[w+R]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const D=t[E],R=t[E+1];D.zeroLength?t.splice(E,1):R&&R.isDash===D.isDash&&(R.left=D.left,t.splice(E,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const f=this.width*this.nextRow;let v=0,w=t[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++v]);const D=Math.abs(E-w.left),R=Math.abs(E-w.right),O=Math.min(D,R);this.data[f+E]=Math.max(0,Math.min(255,(w.isDash?O:-O)+128))}}addDash(t,a){const c=a?7:0,f=2*c+1;if(this.nextRow+f>this.height)return l.w("LineAtlas out of space"),null;let v=0;for(let E=0;E<t.length;E++)v+=t[E];if(v!==0){const E=this.width/v,D=this.getDashRanges(t,this.width,E);a?this.addRoundDash(D,E,c):this.addRegularDash(D)}const w={y:this.nextRow+c,height:2*c,width:v};return this.nextRow+=f,this.dirty=!0,w}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Pt="maplibre_preloaded_worker_pool";class Vt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Vt.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}const Xt=Math.floor(Ae.hardwareConcurrency/2);let Qt,rn;function Yt(){return Qt||(Qt=new Vt),Qt}Vt.workerCount=l.K(globalThis)?Math.max(Math.min(Xt,3),1):1;class on{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let f=0;f<c.length;f++){const v=new l.L(c[f],a);v.name=`Worker ${f}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const c=[];for(const f of this.actors)c.push(f.sendAsync({type:t,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const c of this.actors)c.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function xn(){return rn||(rn=new on(Yt(),l.M),rn.registerMessageHandler("GR",((y,t,a)=>l.m(t,a)))),rn}function qn(y,t){const a=l.N();return l.O(a,a,[1,1,0]),l.Q(a,a,[.5*y.width,.5*y.height,1]),y.calculatePosMatrix?l.S(a,a,y.calculatePosMatrix(t.toUnwrapped())):a}function Ki(y,t,a,c,f,v,w){var E;const D=(function(j,Z,W){if(j)for(const se of j){const le=Z[se];if(le&&le.source===W&&le.type==="fill-extrusion")return!0}else for(const se in Z){const le=Z[se];if(le.source===W&&le.type==="fill-extrusion")return!0}return!1})((E=f?.layers)!==null&&E!==void 0?E:null,t,y.id),R=v.maxPitchScaleFactor(),O=y.tilesIn(c,R,D);O.sort(zn);const U=[];for(const j of O)U.push({wrappedTileID:j.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(t,a,y.getState(),j.queryGeometry,j.cameraQueryGeometry,j.scale,f,v,R,qn(v,j.tileID),w?(Z,W)=>w(j.tileID,Z,W):void 0)});return(function(j,Z){for(const W in j)for(const se of j[W])wi(se,Z);return j})((function(j){const Z={},W={};for(const se of j){const le=se.queryResults,oe=se.wrappedTileID,ue=W[oe]=W[oe]||{};for(const xe in le){const ce=le[xe],_e=ue[xe]=ue[xe]||{},Se=Z[xe]=Z[xe]||[];for(const me of ce)_e[me.featureIndex]||(_e[me.featureIndex]=!0,Se.push(me))}}return Z})(U),y)}function zn(y,t){const a=y.tileID,c=t.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function wi(y,t){const a=y.feature,c=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function Wi(y,t,a){return l._(this,void 0,void 0,(function*(){let c=y;if(y.url?c=(yield l.j(t.transformRequest(y.url,"Source"),a)).data:yield Ae.frameAsync(a),!c)return null;const f=l.U(l.e(c,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(f.vectorLayerIds=c.vector_layers.map((v=>v.id))),f}))}class Yn{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}extend(t){const a=this._sw,c=this._ne;let f,v;if(t instanceof l.V)f=t,v=t;else{if(!(t instanceof Yn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Yn.convert(t)):this.extend(l.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.V.convert(t)):this;if(f=t._sw,v=t._ne,!f||!v)return this}return a||c?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),c.lng=Math.max(v.lng,c.lng),c.lat=Math.max(v.lat,c.lat)):(this._sw=new l.V(f.lng,f.lat),this._ne=new l.V(v.lng,v.lat)),this}getCenter(){return new l.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.V(this.getWest(),this.getNorth())}getSouthEast(){return new l.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:c}=l.V.convert(t);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}intersects(t){if(!((t=Yn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),c=Math.abs(t.getEast()-t.getWest());if(a>=360||c>=360)return!0;const f=l.W(this.getWest(),-180,180),v=l.W(this.getEast(),-180,180),w=l.W(t.getWest(),-180,180),E=l.W(t.getEast(),-180,180),D=f>=v,R=w>=E;return!(!D||!R)||(D?E>=f||w<=v:R?v>=w||f<=E:w<=v&&E>=f)}static convert(t){return t instanceof Yn?t:t&&new Yn(t)}static fromLngLat(t,a=0){const c=360*a/40075017,f=c/Math.cos(Math.PI/180*t.lat);return new Yn(new l.V(t.lng-f,t.lat-c),new l.V(t.lng+f,t.lat+c))}adjustAntiMeridian(){const t=new l.V(this._sw.lng,this._sw.lat),a=new l.V(this._ne.lng,this._ne.lat);return new Yn(t,t.lng>a.lng?new l.V(a.lng+360,a.lat):a)}}class na{constructor(t,a,c){this.bounds=Yn.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),c=Math.floor(l.Y(this.bounds.getWest())*a),f=Math.floor(l.X(this.bounds.getNorth())*a),v=Math.ceil(l.Y(this.bounds.getEast())*a),w=Math.ceil(l.X(this.bounds.getSouth())*a);return t.x>=c&&t.x<v&&t.y>=f&&t.y<w}}class Pr extends l.E{constructor(t,a,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=l.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Wi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new na(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,l.Z(t)||this.fire(new l.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};c.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((v,w)=>{t.reloadPromise={resolve:v,reject:w}}))}else t.actor=this.dispatcher.getActor(),f="LT";t.abortController=new AbortController;try{const v=yield t.actor.sendAsync({type:f,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,v)}catch(v){if(delete t.abortController,t.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ia extends l.E{constructor(t,a,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},a),l.e(this,l.U(a,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Wi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new na(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield at.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const f=this.map.painter.context,v=f.gl,w=c.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new l.T(f,w,v.RGBA,{useMipmap:!0}),t.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Ur extends ia{constructor(t,a,c,f){super(t,a,c,f),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const f=yield at.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){const v=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const w=l.b(v)&&l.$()?v:yield this.readImageNow(v),E={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const D=yield t.actor.sendAsync({type:"LDT",data:E});t.dem=D,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}}))}readImageNow(t){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.a0()){const a=t.width+2,c=t.height+2;try{return new l.R({width:a,height:c},yield l.a1(t,-1,-1,a,c))}catch{}}return Ae.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,c=Math.pow(2,a.z),f=(a.x-1+c)%c,v=a.x===0?t.wrap-1:t.wrap,w=(a.x+1+c)%c,E=a.x+1===c?t.wrap+1:t.wrap,D={};return D[new l.a2(t.overscaledZ,v,a.z,f,a.y).key]={backfilled:!1},D[new l.a2(t.overscaledZ,E,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(D[new l.a2(t.overscaledZ,v,a.z,f,a.y-1).key]={backfilled:!1},D[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},D[new l.a2(t.overscaledZ,E,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<c&&(D[new l.a2(t.overscaledZ,v,a.z,f,a.y+1).key]={backfilled:!1},D[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},D[new l.a2(t.overscaledZ,E,a.z,w,a.y+1).key]={backfilled:!1}),D}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Ir(y){return y.type==="GeometryCollection"?y.geometries.map((t=>t.coordinates)).flat(1/0):y.coordinates.flat(1/0)}function cs(y){const t=new Yn;let a;switch(y.type){case"FeatureCollection":a=y.features.map((c=>Ir(c.geometry))).flat(1/0);break;case"Feature":a=Ir(y.geometry);break;default:a=Ir(y)}if(a.length==0)return t;for(let c=0;c<a.length-1;c+=2)t.extend([a[c],a[c+1]]);return t}class Ti extends l.E{constructor(t,a,c,f){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(f),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:l.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(l.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const c=this._updateWorkerData();return a?c:this}updateData(t,a){this._pendingWorkerUpdate.diff=l.a6(this._pendingWorkerUpdate.diff,t);const c=this._updateWorkerData();return a?c:this}getData(){return l._(this,void 0,void 0,(function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return l._(this,void 0,void 0,(function*(){return cs(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:c}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void l.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,c=l.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(c.request=this.map._requestManager.transformRequest(Ae.resolveURL(t),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=t,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));f.data&&(this._data={geojson:f.data});const v=this._applyDiffToSource(a),w=this._getShouldReloadTileOptions(v);let E=null;f.resourceTiming&&f.resourceTiming[this.id]&&(E=f.resourceTiming[this.id].slice(0));const D={dataType:"source"};this._collectResourceTiming&&E&&E.length>0&&l.e(D,{resourceTiming:E}),this.fire(new l.l("data",Object.assign(Object.assign({},D),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},D),{sourceDataType:"content",shouldReloadTileOptions:w})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const f=l.a7(this._data.geojson,a);if(!f)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:f}}if(!this._data.updateable)return;const c=l.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:c}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>cs(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:c,extent:f}=this.workerOptions.geojsonVtOptions,v=(function({x:w,y:E,z:D},R=0){const O=l.a3((w-R)/Math.pow(2,D)),U=l.a4((E+1+R)/Math.pow(2,D)),j=l.a3((w+1+R)/Math.pow(2,D)),Z=l.a4((E-R)/Math.pow(2,D));return new Yn([O,U],[j,Z])})(t.tileID.canonical,c/f);for(const w of a)if(v.intersects(w))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const f=yield this.actor.sendAsync({type:a,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(f,this.map.painter,a==="RT")}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Qi extends l.E{constructor(t,a,c,f){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}load(t){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield at.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(l.a9.fromLngLat);var c;return this.tileID=(function(f){const v=l.aa.fromPoints(f),w=v.width(),E=v.height(),D=Math.max(w,E),R=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),O=Math.pow(2,R);return new l.ac(R,Math.floor((v.minX+v.maxX)/2*O),Math.floor((v.minY+v.maxY)/2*O))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new l.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:c,maxX:f,maxY:v}=l.aa.fromPoints(t),w={};for(let E=0;E<=l.ab;E++){const D=Math.pow(2,E),R=Math.floor(a*D),O=Math.floor(c*D),U=Math.floor(f*D),j=Math.floor(v*D);w[E]={minTileX:R,minTileY:O,maxTileX:U,maxTileY:j}}return w}}class fe extends Qi{constructor(t,a,c,f){super(t,a,c,f),this.roundZoom=!0,this.type="video",this.options=a}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield l.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new l.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new l.k(new l.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class H extends Qi{constructor(t,a,c,f){super(t,a,c,f),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((v=>!Array.isArray(v)||v.length!==2||v.some((w=>typeof w!="number"))))||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.k(new l.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,c=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new l.T(a,this.canvas,c.RGBA,{premultiply:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,f=!0)}f&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const $={},Q=y=>{switch(y){case"geojson":return Ti;case"image":return Qi;case"raster":return ia;case"raster-dem":return Ur;case"vector":return Pr;case"video":return fe;case"canvas":return H}return $[y]},de="RTLPluginLoaded";class ve extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=xn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ae.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(de))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Le=null;function ke(){return Le||(Le=new ve),Le}var ye,Oe;(function(y){y[y.Base=0]="Base",y[y.Parent=1]="Parent"})(ye||(ye={})),(function(y){y[y.Departing=0]="Departing",y[y.Incoming=1]="Incoming"})(Oe||(Oe={}));class Qe{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=l.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:c,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=f}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=pe(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(f,v){const w={};if(!v)return w;for(const E of f){const D=E.layerIds.map((R=>v.getLayer(R))).filter(Boolean);if(D.length!==0){E.layers=D,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map((R=>D.filter((O=>O.id===R))[0])));for(const R of D)w[R.id]=E}}return w})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const v=this.buckets[f];if(v instanceof l.ah){if(this.hasSymbolBuckets=!0,!c)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const v=this.buckets[f];if(v instanceof l.ah&&v.hasRTLText){this.hasRTLText=!0,ke().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const v=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(v))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new l.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,c,f,v,w,E,D,R,O,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:O,transform:D,params:E,queryPadding:this.queryPadding*R,getElevation:U},t,a,c):{}}querySourceFeatures(t,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),v=a&&a.sourceLayer?a.sourceLayer:"",w=f[l.ai]||f[v];if(!w)return;const E=l.aj(a?.filter,a?.globalState),{z:D,x:R,y:O}=this.tileID.canonical,U={z:D,x:R,y:O};for(let j=0;j<w.length;j++){const Z=w.feature(j);if(E.needGeometry){const le=l.ak(Z,!0);if(!E.filter(new l.H(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!E.filter(new l.H(this.tileID.overscaledZ),Z))continue;const W=c.getId(Z,v),se=new l.al(Z,D,R,O,W);se.tile=U,t.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const c=l.am(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const v=this.expirationTime-a;v?this.expirationTime=c+Math.max(v,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const v=this.buckets[f],w=v.layers[0].sourceLayer||l.ai,E=c[w],D=t[w];if(!E||!D||Object.keys(D).length===0)continue;v.update(D,E,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const R=a&&a.style&&a.style.getLayer(f);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(v)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<pe()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=pe()+t}setDependencies(t,a){const c={};for(const f of a)c[f]=!0;this.dependencies[t]=c}hasDependency(t,a){for(const c of t){const f=this.dependencies[c];if(f){for(const v of a)if(f[v])return!0}}return!1}}class nt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,c){const f=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},l.e(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==f&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const v in this.state[t][f])c[v]||(this.deletedStates[t][f][v]=null)}else for(const v in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][v]===null&&delete this.deletedStates[t][f][v]}removeFeatureState(t,a,c){if(this.deletedStates[t]===null)return;const f=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&a!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,a){const c=String(a),f=l.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const v=this.deletedStates[t][a];if(v===null)return{};for(const w in v)delete f[w]}return f}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const v={};for(const w in this.stateChanges[f])this.state[f][w]||(this.state[f][w]={}),l.e(this.state[f][w],this.stateChanges[f][w]),v[w]=this.state[f][w];c[f]=v}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const v={};if(this.deletedStates[f]===null)for(const w in this.state[f])v[w]={},this.state[f][w]={};else for(const w in this.deletedStates[f]){if(this.deletedStates[f][w]===null)this.state[f][w]={};else for(const E of Object.keys(this.deletedStates[f][w]))delete this.state[f][w][E];v[w]=this.state[f][w]}c[f]=c[f]||{},l.e(c[f],v)}this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0&&t.setFeatureState(c,a)}}const Et=89.25;function It(y,t){const a=l.an(t.lat,-l.ao,l.ao);return new l.P(l.Y(t.lng)*y,l.X(a)*y)}function Kt(y,t){return new l.a9(t.x/y,t.y/y).toLngLat()}function gn(y){return y.cameraToCenterDistance*Math.min(.85*Math.tan(l.ap(90-y.pitch)),Math.tan(l.ap(Et-y.pitch)))}function pn(y,t){const a=y.canonical,c=t/l.aq(a.z),f=a.x+Math.pow(2,a.z)*y.wrap,v=l.ar(new Float64Array(16));return l.O(v,v,[f*c,a.y*c,0]),l.Q(v,v,[c/l.a5,c/l.a5,1]),v}function Ne(y,t,a,c,f){const v=l.a9.fromLngLat(y,t),w=f*l.as(1,y.lat),{x:E,y:D,z:R}=lt(a,c);return new l.a9(v.x+w*-E,v.y+w*-D,v.z+w*-R)}function lt(y,t){const a=l.ap(y),c=l.ap(t),f=Math.cos(-a),v=Math.sin(a);return{x:v*Math.sin(c),y:-v*Math.cos(c),z:f}}function Ot(y,t,a){const c=t.intersectsFrustum(y);if(!a||c===0)return c;const f=t.intersectsPlane(a);return f===0?0:c===2&&f===2?2:1}function Mt(y,t,a){let c=0;const f=(a-t)/10;for(let v=0;v<10;v++)c+=f*Math.pow(Math.cos(t+(v+.5)/10*(a-t)),y);return c}function tn(y,t){return function(a,c,f,v,w){const E=2*((y-1)/l.at(Math.cos(l.ap(Et-w))/Math.cos(l.ap(Et)))-1),D=Math.acos(f/v),R=2*Mt(E-1,0,l.ap(w/2)),O=Math.min(l.ap(Et),D+l.ap(w/2)),U=Mt(E-1,Math.min(O,D-l.ap(w/2)),O),j=Math.atan(c/f),Z=Math.hypot(c,f);let W=a;return W+=l.at(v/Z/Math.max(.5,Math.cos(l.ap(w/2)))),W+=E*l.at(Math.cos(j))/2,W-=l.at(Math.max(1,U/R/t))/2,W}}const Tn=tn(9.314,3);function Sn(y,t){const a=(t.roundZoom?Math.round:Math.floor)(y.zoom+l.at(y.tileSize/t.tileSize));return Math.max(0,a)}function un(y,t){const a=y.getCameraFrustum(),c=y.getClippingPlane(),f=y.screenPointToMercatorCoordinate(y.getCameraPoint()),v=l.a9.fromLngLat(y.center,y.elevation);f.z=v.z+Math.cos(y.pitchInRadians)*y.cameraToCenterDistance/y.worldSize;const w=y.getCoveringTilesDetailsProvider(),E=w.allowVariableZoom(y,t),D=Sn(y,t),R=t.minzoom||0,O=t.maxzoom!==void 0?t.maxzoom:y.maxZoom,U=Math.min(Math.max(0,D),O),j=Math.pow(2,U),Z=[j*f.x,j*f.y,0],W=[j*v.x,j*v.y,0],se=Math.hypot(v.x-f.x,v.y-f.y),le=Math.abs(v.z-f.z),oe=Math.hypot(se,le),ue=_e=>({zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),xe=[],ce=[];if(y.renderWorldCopies&&w.allowWorldCopies())for(let _e=1;_e<=3;_e++)xe.push(ue(-_e)),xe.push(ue(_e));for(xe.push(ue(0));xe.length>0;){const _e=xe.pop(),Se=_e.x,me=_e.y;let Ce=_e.fullyVisible;const qe={x:Se,y:me,z:_e.zoom},Fe=w.getTileBoundingVolume(qe,_e.wrap,y.elevation,t);if(!Ce){const St=Ot(a,Fe,c);if(St===0)continue;Ce=St===2}const Ue=w.distanceToTile2d(f.x,f.y,qe,Fe);let Ve=D;E&&(Ve=(t.calculateTileZoom||Tn)(y.zoom+l.at(y.tileSize/t.tileSize),Ue,le,oe,y.fov)),Ve=(t.roundZoom?Math.round:Math.floor)(Ve),Ve=Math.max(0,Ve);const wt=Math.min(Ve,O);if(_e.wrap=w.getWrap(v,qe,_e.wrap),_e.zoom>=wt){if(_e.zoom<R)continue;const St=U-_e.zoom,dt=Z[0]-.5-(Se<<St),Ct=Z[1]-.5-(me<<St),an=t.reparseOverscaled?Math.max(_e.zoom,Ve):_e.zoom;ce.push({tileID:new l.a2(_e.zoom===O?an:_e.zoom,_e.wrap,_e.zoom,Se,me),distanceSq:l.au([W[0]-.5-Se,W[1]-.5-me]),tileDistanceToCamera:Math.sqrt(dt*dt+Ct*Ct)})}else for(let St=0;St<4;St++)xe.push({zoom:_e.zoom+1,x:(Se<<1)+St%2,y:(me<<1)+(St>>1),wrap:_e.wrap,fullyVisible:Ce})}return ce.sort(((_e,Se)=>_e.distanceSq-Se.distanceSq)).map((_e=>_e.tileID))}const Dn=l.aa.fromPoints([new l.P(0,0),new l.P(l.a5,l.a5)]);function ai(y){return y==="raster"||y==="image"||y==="video"}function Bl(y,t,a,c,f,v,w){if(!t.hasData())return!1;const{tileID:E,fadingRole:D,fadingDirection:R,fadingParentID:O}=t;if(D===ye.Base&&R===Oe.Incoming&&O)return a[O.key]=O,!0;const U=Math.max(E.overscaledZ-f,v);for(let j=E.overscaledZ-1;j>=U;j--){const Z=E.scaledTo(j),W=y.getLoadedTile(Z);if(W)return t.setCrossFadeLogic({fadingRole:ye.Base,fadingDirection:Oe.Incoming,fadingParentID:W.tileID,fadeEndTime:c+w}),W.setCrossFadeLogic({fadingRole:ye.Parent,fadingDirection:Oe.Departing,fadeEndTime:c+w}),a[Z.key]=Z,!0}return!1}function Go(y,t,a,c,f,v){if(!t.hasData())return!1;const w=t.tileID.children(f);let E=xt(y,t,w,a,c,f,v);if(E)return!0;for(const D of w)xt(y,t,D.children(f),a,c,f,v)&&(E=!0);return E}function xt(y,t,a,c,f,v,w){if(a[0].overscaledZ>=v)return!1;let E=!1;for(const D of a){const R=y.getLoadedTile(D);if(!R)continue;const{fadingRole:O,fadingDirection:U,fadingParentID:j}=R;O===ye.Base&&U===Oe.Departing&&j||(R.setCrossFadeLogic({fadingRole:ye.Base,fadingDirection:Oe.Departing,fadingParentID:t.tileID,fadeEndTime:f+w}),t.setCrossFadeLogic({fadingRole:ye.Parent,fadingDirection:Oe.Incoming,fadeEndTime:f+w})),c[D.key]=D,E=!0}return E}function br(y,t,a,c){const f=y.tileID;return!!y.selfFading||!y.hasData()&&!!t.has(f)&&(y.setSelfFadeLogic(a+c),!0)}function wr(y,t){var a;y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let c=t.tileID.canonical.x-y.tileID.canonical.x;const f=t.tileID.canonical.y-y.tileID.canonical.y,v=Math.pow(2,y.tileID.canonical.z),w=t.tileID.key;c===0&&f===0||Math.abs(f)>1||(Math.abs(c)>1&&(Math.abs(c+v)===1?c+=v:Math.abs(c-v)===1&&(c-=v)),t.dem&&y.dem&&(y.dem.backfillBorder(t.dem,c,f),!((a=y.neighboringTiles)===null||a===void 0)&&a[w]&&(y.neighboringTiles[w].backfilled=!0)))}class Ga{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+t),a[f.tileID.key]=f}this._tiles=a}setFeatureState(t,a){for(const c in this._tiles)this._tiles[c].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(l.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var c;return(c=this.getTileById(t))===null||c===void 0?void 0:c.isRenderable(a)}getRenderableIds(t=0,a){const c=[];for(const f of this.getAllIds())this.isIdRenderable(f,a)&&c.push(this.getTileById(f));return a?c.sort(((f,v)=>{const w=f.tileID,E=v.tileID,D=new l.P(w.canonical.x,w.canonical.y)._rotate(-t),R=new l.P(E.canonical.x,E.canonical.y)._rotate(-t);return w.overscaledZ-E.overscaledZ||R.y-D.y||R.x-D.x})).map((f=>f.tileID.key)):c.map((f=>f.tileID)).sort(l.aw).map((f=>f.key))}}class ni extends l.E{constructor(t,a,c){super(),this.id=t,this.dispatcher=c,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,v,w,E)=>{const D=new(Q(v.type))(f,v,w,E);if(D.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${D.id}`);return D})(t,a,c,this),this._inViewTiles=new Ga,this._outOfViewCache=new l.ax(0,(f=>this._unloadTile(f))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new nt,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Ga}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,c){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,c)}catch(f){t.state="errored",f.status!==404?this._source.fire(new l.k(f,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const c=this.getLoadedTile(t.scaledTo(a));if(c)return this._inViewTiles.isIdRenderable(c.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const c of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(c);a&&!this._source.shouldReloadTile(f,a)||(t?this._reloadTile(c,"expired"):f.state!=="errored"&&this._reloadTile(c,"reloading"))}}}_reloadTile(t,a){return l._(this,void 0,void 0,(function*(){const c=this._inViewTiles.getTileById(t);c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,t,a))}))}_tileLoaded(t,a,c){t.timeAdded=pe(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(f,v){var w,E;const D=v.getRenderableIds();for(const R of D){if(!f.neighboringTiles||!f.neighboringTiles[R])continue;const O=v.getTileById(R);f.neighboringTiles[R].backfilled||wr(f,O),!((E=(w=O.neighboringTiles)===null||w===void 0?void 0:w[f.tileID.key])===null||E===void 0)&&E.backfilled||wr(O,f)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const c=this._getLoadedDescendents(a),f=new Set;for(const v of a){const w=c[v.key];if(!w?.length){f.add(v);continue}const E=v.overscaledZ+ni.maxOverzooming,D=w.filter((U=>U.tileID.overscaledZ<=E));if(!D.length){f.add(v);continue}const R=Math.min(...D.map((U=>U.tileID.overscaledZ))),O=D.filter((U=>U.tileID.overscaledZ===R)).map((U=>U.tileID));for(const U of O)t[U.key]=U;this._areDescendentsComplete(O,R,v.overscaledZ)||f.add(v)}return f}_getLoadedDescendents(t){var a;const c={};for(const f of this._inViewTiles.getAllTiles().filter((v=>v.hasData())))for(const v of t)f.tileID.isChildOf(v)&&(c[a=v.key]||(c[a]=[])).push(f);return c}_areDescendentsComplete(t,a,c){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-c)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._outOfViewCache.setMaxSize(v)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((D=>new l.a2(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y))):(c=un(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((D=>this._source.hasTile(D))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const f=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const v=Sn(t,this._source),w=this._updateRetainedTiles(c,v),E=ai(this._source.type);E&&this._rasterFadeDuration>0&&!a&&(function(D,R,O,U,j,Z,W){const se=pe(),le=l.av(R);for(const oe of R){const ue=D.getTileById(oe.key);ue.fadingDirection!==Oe.Departing&&ue.fadeOpacity!==0||ue.resetFadeLogic(),Bl(D,ue,O,se,U,j,W)||Go(D,ue,O,se,Z,W)||br(ue,le,se,W)||ue.resetFadeLogic()}})(this._inViewTiles,c,w,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),E?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);t[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const c of t)if(c.canonical.z>this._source.minzoom){const f=c.scaledTo(c.canonical.z-1);a.push(f);const v=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(v)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var c;const f=new Set;for(const R of t)this._addTile(R).hasData()||f.add(R);const v=t.reduce(((R,O)=>(R[O.key]=O,R)),{}),w=this._retainLoadedChildren(v,f),E={},D=Math.max(a-ni.maxUnderzooming,this._source.minzoom);for(const R of w){let O=this._inViewTiles.getTileById(R.key),U=O?.wasRequested();for(let j=R.overscaledZ-1;j>=D;--j){const Z=R.scaledTo(j);if(E[Z.key])break;if(E[Z.key]=!0,O=this.getTile(Z),!O&&U&&(O=this._addTile(Z)),O){const W=O.hasData();if((W||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||U)&&(v[Z.key]=Z),U=O.wasRequested(),W)break}}}return v}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const c=a;return a||(a=new Qe(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),c||this._source.fire(new l.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const c=a.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||c.state=="errored")&&t.some((f=>f.equals(c.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,c){const f=[],v=this.transform;if(!v)return f;const w=v.getCoveringTilesDetailsProvider().allowWorldCopies(),E=c?v.getCameraQueryGeometry(t):t,D=Z=>v.screenPointToMercatorCoordinate(Z,this.terrain),R=this.transformBbox(t,D,!w),O=this.transformBbox(E,D,!w),U=this.getIds(),j=l.aa.fromPoints(O);for(let Z=0;Z<U.length;Z++){const W=this._inViewTiles.getTileById(U[Z]);if(W.holdingForSymbolFade())continue;const se=w?[W.tileID]:[W.tileID.unwrapTo(-1),W.tileID.unwrapTo(0)],le=Math.pow(2,v.zoom-W.tileID.overscaledZ),oe=a*W.queryPadding*l.a5/W.tileSize/le;for(const ue of se){const xe=j.map((ce=>ue.getTilePoint(new l.a9(ce.x,ce.y))));if(xe.expandBy(oe),xe.intersects(Dn)){const ce=R.map((Se=>ue.getTilePoint(Se))),_e=O.map((Se=>ue.getTilePoint(Se)));f.push({tile:W,tileID:w?ue:ue.unwrapTo(0),queryGeometry:ce,cameraQueryGeometry:_e,scale:le})}}}return f}transformBbox(t,a,c){let f=t.map(a);if(c){const v=l.aa.fromPoints(t);v.shrinkBy(.001*Math.min(v.width(),v.height()));const w=v.map(a);l.aa.fromPoints(f).covers(w)||(f=f.map((E=>E.x>.5?new l.a9(E.x-1,E.y,E.z):E)))}return f}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((c=>this._inViewTiles.getTileById(c).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!ai(this._source.type)||!(function(t,a){if(a<=0)return!1;const c=pe();for(const f of t.getAllTiles())if(f.fadeEndTime>=c)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,c){this._state.updateState(t=t||l.ai,a,c)}removeFeatureState(t,a,c){this._state.removeFeatureState(t=t||l.ai,a,c)}getFeatureState(t,a){return this._state.getState(t=t||l.ai,a)}setDependencies(t,a,c){const f=this._inViewTiles.getTileById(t);f&&f.setDependencies(a,c)}reloadTilesForDependencies(t,a){for(const c of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(c).hasDependency(t,a)&&this._reloadTile(c,"reloading");this._outOfViewCache.filter((c=>!c.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}ni.maxUnderzooming=10,ni.maxOverzooming=3;class At{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.an(t,0,1);let a=1,c=this._distances[a];const f=t*this.paddedLength+this.padding;for(;c<f&&a<this._distances.length;)c=this._distances[++a];const v=a-1,w=this._distances[v],E=c-w,D=E>0?(f-w)/E:0;return this.points[v].mult(1-D).add(this.points[a].mult(D))}}function ln(y,t){let a=!0;return y==="always"||y!=="never"&&t!=="never"||(a=!1),a}class fn{constructor(t,a,c){const f=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(a/c);for(let w=0;w<this.xCellCount*this.yCellCount;w++)f.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,c,f,v){this._forEachCell(a,c,f,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v)}insertCircle(t,a,c,f){this._forEachCell(a-f,c-f,a+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,a,c,f,v,w){this.boxCells[v].push(w)}_insertCircleCell(t,a,c,f,v,w){this.circleCells[v].push(w)}_query(t,a,c,f,v,w,E){if(c<0||t>this.width||f<0||a>this.height)return[];const D=[];if(t<=0&&a<=0&&this.width<=c&&this.height<=f){if(v)return[{key:null,x1:t,y1:a,x2:c,y2:f}];for(let R=0;R<this.boxKeys.length;R++)D.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],U=this.circles[3*R+1],j=this.circles[3*R+2];D.push({key:this.circleKeys[R],x1:O-j,y1:U-j,x2:O+j,y2:U+j})}}else this._forEachCell(t,a,c,f,this._queryCell,D,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},E);return D}query(t,a,c,f){return this._query(t,a,c,f,!1,null)}hitTest(t,a,c,f,v,w){return this._query(t,a,c,f,!0,v,w).length>0}hitTestCircle(t,a,c,f,v){const w=t-c,E=t+c,D=a-c,R=a+c;if(E<0||w>this.width||R<0||D>this.height)return!1;const O=[];return this._forEachCell(w,D,E,R,this._queryCellCircle,O,{hitTest:!0,overlapMode:f,circle:{x:t,y:a,radius:c},seenUids:{box:{},circle:{}}},v),O.length>0}_queryCell(t,a,c,f,v,w,E,D){const{seenUids:R,hitTest:O,overlapMode:U}=E,j=this.boxCells[v];if(j!==null){const W=this.bboxes;for(const se of j)if(!R.box[se]){R.box[se]=!0;const le=4*se,oe=this.boxKeys[se];if(t<=W[le+2]&&a<=W[le+3]&&c>=W[le+0]&&f>=W[le+1]&&(!D||D(oe))&&(!O||!ln(U,oe.overlapMode))&&(w.push({key:oe,x1:W[le],y1:W[le+1],x2:W[le+2],y2:W[le+3]}),O))return!0}}const Z=this.circleCells[v];if(Z!==null){const W=this.circles;for(const se of Z)if(!R.circle[se]){R.circle[se]=!0;const le=3*se,oe=this.circleKeys[se];if(this._circleAndRectCollide(W[le],W[le+1],W[le+2],t,a,c,f)&&(!D||D(oe))&&(!O||!ln(U,oe.overlapMode))){const ue=W[le],xe=W[le+1],ce=W[le+2];if(w.push({key:oe,x1:ue-ce,y1:xe-ce,x2:ue+ce,y2:xe+ce}),O)return!0}}}return!1}_queryCellCircle(t,a,c,f,v,w,E,D){const{circle:R,seenUids:O,overlapMode:U}=E,j=this.boxCells[v];if(j!==null){const W=this.bboxes;for(const se of j)if(!O.box[se]){O.box[se]=!0;const le=4*se,oe=this.boxKeys[se];if(this._circleAndRectCollide(R.x,R.y,R.radius,W[le+0],W[le+1],W[le+2],W[le+3])&&(!D||D(oe))&&!ln(U,oe.overlapMode))return w.push(!0),!0}}const Z=this.circleCells[v];if(Z!==null){const W=this.circles;for(const se of Z)if(!O.circle[se]){O.circle[se]=!0;const le=3*se,oe=this.circleKeys[se];if(this._circlesCollide(W[le],W[le+1],W[le+2],R.x,R.y,R.radius)&&(!D||D(oe))&&!ln(U,oe.overlapMode))return w.push(!0),!0}}}_forEachCell(t,a,c,f,v,w,E,D){const R=this._convertToXCellCoord(t),O=this._convertToYCellCoord(a),U=this._convertToXCellCoord(c),j=this._convertToYCellCoord(f);for(let Z=R;Z<=U;Z++)for(let W=O;W<=j;W++)if(v.call(this,t,a,c,f,this.xCellCount*W+Z,w,E,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,c,f,v,w){const E=f-t,D=v-a,R=c+w;return R*R>E*E+D*D}_circleAndRectCollide(t,a,c,f,v,w,E){const D=(w-f)/2,R=Math.abs(t-(f+D));if(R>D+c)return!1;const O=(E-v)/2,U=Math.abs(a-(v+O));if(U>O+c)return!1;if(R<=D||U<=O)return!0;const j=R-D,Z=U-O;return j*j+Z*Z<=c*c}}function ra(y,t,a){const c=l.N();if(!y){const{vecSouth:U,vecEast:j}=us(t),Z=K();Z[0]=j[0],Z[1]=j[1],Z[2]=U[0],Z[3]=U[1],f=Z,(O=(w=(v=Z)[0])*(R=v[3])-(D=v[2])*(E=v[1]))&&(f[0]=R*(O=1/O),f[1]=-E*O,f[2]=-D*O,f[3]=w*O),c[0]=Z[0],c[1]=Z[1],c[4]=Z[2],c[5]=Z[3]}var f,v,w,E,D,R,O;return l.Q(c,c,[1/a,1/a,1]),c}function Uu(y,t,a,c){if(y){const f=l.N();if(!t){const{vecSouth:v,vecEast:w}=us(a);f[0]=w[0],f[1]=w[1],f[4]=v[0],f[5]=v[1]}return l.Q(f,f,[c,c,1]),f}return a.pixelsToClipSpaceMatrix}function us(y){const t=Math.cos(y.rollInRadians),a=Math.sin(y.rollInRadians),c=Math.cos(y.pitchInRadians),f=Math.cos(y.bearingInRadians),v=Math.sin(y.bearingInRadians),w=l.aC();w[0]=-f*c*a-v*t,w[1]=-v*c*a+f*t;const E=l.aD(w);E<1e-9?l.aE(w):l.aF(w,w,1/E);const D=l.aC();D[0]=f*c*t-v*a,D[1]=v*c*t+f*a;const R=l.aD(D);return R<1e-9?l.aE(D):l.aF(D,D,1/R),{vecEast:D,vecSouth:w}}function sn(y,t,a,c){let f;c?(f=[y,t,c(y,t),1],l.aH(f,f,a)):(f=[y,t,0,1],wa(f,f,a));const v=f[3];return{point:new l.P(f[0]/v,f[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function Zo(y,t){return .5+y/t*.5}function hs(y,t){return y.x>=-t[0]&&y.x<=t[0]&&y.y>=-t[1]&&y.y<=t[1]}function js(y,t,a,c,f,v,w,E,D,R,O,U,j){const Z=a?y.textSizeData:y.iconSizeData,W=l.ay(Z,t.transform.zoom),se=[256/t.width*2+1,256/t.height*2+1],le=a?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;le.clear();const oe=y.lineVertexArray,ue=a?y.text.placedSymbolArray:y.icon.placedSymbolArray,xe=t.transform.width/t.transform.height;let ce=!1;for(let _e=0;_e<ue.length;_e++){const Se=ue.get(_e);if(Se.hidden||Se.writingMode===l.az.vertical&&!ce){ps(Se.numGlyphs,le);continue}ce=!1;const me=new l.P(Se.anchorX,Se.anchorY),Ce={getElevation:j,pitchedLabelPlaneMatrix:c,lineVertexArray:oe,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:me,unwrappedTileID:D,width:R,height:O,translation:U},qe=Fl(Se.anchorX,Se.anchorY,Ce);if(!hs(qe.point,se)){ps(Se.numGlyphs,le);continue}const Fe=Zo(t.transform.cameraToCenterDistance,qe.signedDistanceFromCamera),Ue=l.aA(Z,W,Se),Ve=v?Ue*t.transform.getPitchedTextCorrection(Se.anchorX,Se.anchorY,D)/Fe:Ue*Fe,wt=Si({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:f,symbol:Se,fontSize:Ve,flip:!1,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:xe,rotateToLine:E});ce=wt.useVertical,(wt.notEnoughRoom||ce||wt.needsFlipping&&Si({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:f,symbol:Se,fontSize:Ve,flip:!0,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:xe,rotateToLine:E}).notEnoughRoom)&&ps(Se.numGlyphs,le)}a?y.text.dynamicLayoutVertexBuffer.updateData(le):y.icon.dynamicLayoutVertexBuffer.updateData(le)}function ds(y,t,a,c,f,v,w,E){const D=v.glyphStartIndex+v.numGlyphs,R=v.lineStartIndex,O=v.lineStartIndex+v.lineLength,U=t.getoffsetX(v.glyphStartIndex),j=t.getoffsetX(D-1),Z=Za(y*U,a,c,f,v.segment,R,O,E,w);if(!Z)return null;const W=Za(y*j,a,c,f,v.segment,R,O,E,w);return W?E.projectionCache.anyProjectionOccluded?null:{first:Z,last:W}:null}function fs(y,t,a,c){return y===l.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*c?{useVertical:!0}:(y===l.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Si(y){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:f,flip:v,keepUpright:w,glyphOffsetArray:E,dynamicLayoutVertexArray:D,aspectRatio:R,rotateToLine:O}=y,U=f/24,j=c.lineOffsetX*U,Z=c.lineOffsetY*U;let W;if(c.numGlyphs>1){const se=c.glyphStartIndex+c.numGlyphs,le=c.lineStartIndex,oe=c.lineStartIndex+c.lineLength,ue=ds(U,E,j,Z,v,c,O,t);if(!ue)return{notEnoughRoom:!0};const xe=Us(ue.first.point.x,ue.first.point.y,t,a),ce=Us(ue.last.point.x,ue.last.point.y,t,a);if(w&&!v){const _e=fs(c.writingMode,xe,ce,R);if(_e)return _e}W=[ue.first];for(let _e=c.glyphStartIndex+1;_e<se-1;_e++){const Se=Za(U*E.getoffsetX(_e),j,Z,v,c.segment,le,oe,t,O);if(!Se)return{notEnoughRoom:!0};W.push(Se)}W.push(ue.last)}else{if(w&&!v){const le=Mn(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,oe=c.lineStartIndex+c.segment+1,ue=new l.P(t.lineVertexArray.getx(oe),t.lineVertexArray.gety(oe)),xe=Mn(ue.x,ue.y,t),ce=xe.signedDistanceFromCamera>0?xe.point:Nl(t.tileAnchorPoint,ue,le,1,t),_e=Us(le.x,le.y,t,a),Se=Us(ce.x,ce.y,t,a),me=fs(c.writingMode,_e,Se,R);if(me)return me}const se=Za(U*E.getoffsetX(c.glyphStartIndex),j,Z,v,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,O);if(!se||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};W=[se]}for(const se of W)l.aG(D,se.point,se.angle);return{}}function Nl(y,t,a,c,f){const v=y.add(y.sub(t)._unit()),w=Mn(v.x,v.y,f).point,E=a.sub(w);return a.add(E._mult(c/E.mag()))}function Tr(y,t,a){const c=t.projectionCache;if(c.projections[y])return c.projections[y];const f=new l.P(t.lineVertexArray.getx(y),t.lineVertexArray.gety(y)),v=Mn(f.x,f.y,t);if(v.signedDistanceFromCamera>0)return c.projections[y]=v.point,c.anyProjectionOccluded=c.anyProjectionOccluded||v.isOccluded,v.point;const w=y-a.direction;return Nl(a.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(w),t.lineVertexArray.gety(w)),f,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function Mn(y,t,a){const c=y+a.translation[0],f=t+a.translation[1];let v;return a.pitchWithMap?(v=sn(c,f,a.pitchedLabelPlaneMatrix,a.getElevation),v.isOccluded=!1):(v=a.transform.projectTileCoordinates(c,f,a.unwrappedTileID,a.getElevation),v.point.x=(.5*v.point.x+.5)*a.width,v.point.y=(.5*-v.point.y+.5)*a.height),v}function Us(y,t,a,c){if(a.pitchWithMap){const f=[y,t,0,1];return l.aH(f,f,c),a.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],a.unwrappedTileID,a.getElevation).point}return{x:y/a.width*2-1,y:1-t/a.height*2}}function Fl(y,t,a){return a.transform.projectTileCoordinates(y,t,a.unwrappedTileID,a.getElevation)}function jl(y,t,a){return y._unit()._perp()._mult(t*a)}function uo(y,t,a,c,f,v,w,E,D){if(E.projectionCache.offsets[y])return E.projectionCache.offsets[y];const R=a.add(t);if(y+D.direction<c||y+D.direction>=f)return E.projectionCache.offsets[y]=R,R;const O=Tr(y+D.direction,E,D),U=jl(O.sub(a),w,D.direction),j=a.add(U),Z=O.add(U);return E.projectionCache.offsets[y]=l.aI(v,R,j,Z)||R,E.projectionCache.offsets[y]}function Za(y,t,a,c,f,v,w,E,D){const R=c?y-t:y+t;let O=R>0?1:-1,U=0;c&&(O*=-1,U=Math.PI),O<0&&(U+=Math.PI);let j,Z=O>0?v+f:v+f+1;E.projectionCache.cachedAnchorPoint?j=E.projectionCache.cachedAnchorPoint:(j=Mn(E.tileAnchorPoint.x,E.tileAnchorPoint.y,E).point,E.projectionCache.cachedAnchorPoint=j);let W,se,le=j,oe=j,ue=0,xe=0;const ce=Math.abs(R),_e=[];let Se;for(;ue+xe<=ce;){if(Z+=O,Z<v||Z>=w)return null;ue+=xe,oe=le,se=W;const qe={absOffsetX:ce,direction:O,distanceFromAnchor:ue,previousVertex:oe};if(le=Tr(Z,E,qe),a===0)_e.push(oe),Se=le.sub(oe);else{let Fe;const Ue=le.sub(oe);Fe=Ue.mag()===0?jl(Tr(Z+O,E,qe).sub(le),a,O):jl(Ue,a,O),se||(se=oe.add(Fe)),W=uo(Z,Fe,le,v,w,se,a,E,qe),_e.push(se),Se=W.sub(se)}xe=Se.mag()}const me=Se._mult((ce-ue)/xe)._add(se||oe),Ce=U+Math.atan2(le.y-oe.y,le.x-oe.x);return _e.push(me),{point:me,angle:D?Ce:0,path:_e}}const kc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ps(y,t){for(let a=0;a<y;a++){const c=t.length;t.resize(c+4),t.float32.set(kc,3*c)}}function wa(y,t,a){const c=t[0],f=t[1];return y[0]=a[0]*c+a[4]*f+a[12],y[1]=a[1]*c+a[5]*f+a[13],y[3]=a[3]*c+a[7]*f+a[15],y}const Rn=100;class Kh{constructor(t,a=new fn(t.width+200,t.height+200,25),c=new fn(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Rn,this.screenBottomBoundary=t.height+Rn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,c,f,v,w,E,D,R,O,U,j){const Z=this.projectAndGetPerspectiveRatio(t.anchorPointX+D[0],t.anchorPointY+D[1],v,O,j),W=c*Z.perspectiveRatio;let se;if(w||E)se=this._projectCollisionBox(t,W,f,v,w,E,D,Z,O,U,j);else{const Se=Z.x+(U?U.x*W:0),me=Z.y+(U?U.y*W:0);se={allPointsOccluded:!1,box:[Se+t.x1*W,me+t.y1*W,Se+t.x2*W,me+t.y2*W]}}const[le,oe,ue,xe]=se.box,ce=w?se.allPointsOccluded:Z.isOccluded;let _e=ce;return _e||(_e=Z.perspectiveRatio<this.perspectiveRatioCutoff),_e||(_e=!this.isInsideGrid(le,oe,ue,xe)),_e||a!=="always"&&this.grid.hitTest(le,oe,ue,xe,a,R)?{box:[le,oe,ue,xe],placeable:!1,offscreen:!1,occluded:ce}:{box:[le,oe,ue,xe],placeable:!0,offscreen:this.isOffscreen(le,oe,ue,xe),occluded:ce}}placeCollisionCircles(t,a,c,f,v,w,E,D,R,O,U,j,Z,W){const se=[],le=new l.P(a.anchorX,a.anchorY),oe=this.getPerspectiveRatio(le.x,le.y,w,W),ue=(R?v*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,w)/oe:v*oe)/l.aM,xe={getElevation:W,pitchedLabelPlaneMatrix:E,lineVertexArray:c,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:le,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:Z},ce=ds(ue,f,a.lineOffsetX*ue,a.lineOffsetY*ue,!1,a,!1,xe);let _e=!1,Se=!1,me=!0;if(ce){const Ce=.5*U*oe+j,qe=new l.P(-100,-100),Fe=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Ue=new At,Ve=ce.first,wt=ce.last;let St=[];for(let an=Ve.path.length-1;an>=1;an--)St.push(Ve.path[an]);for(let an=1;an<wt.path.length;an++)St.push(wt.path[an]);const dt=2.5*Ce;if(R){const an=this.projectPathToScreenSpace(St,xe);St=an.some((Fn=>Fn.signedDistanceFromCamera<=0))?[]:an.map((Fn=>Fn.point))}let Ct=[];if(St.length>0){const an=St[0].clone(),Fn=St[0].clone();for(let ii=1;ii<St.length;ii++)an.x=Math.min(an.x,St[ii].x),an.y=Math.min(an.y,St[ii].y),Fn.x=Math.max(Fn.x,St[ii].x),Fn.y=Math.max(Fn.y,St[ii].y);Ct=an.x>=qe.x&&Fn.x<=Fe.x&&an.y>=qe.y&&Fn.y<=Fe.y?[St]:Fn.x<qe.x||an.x>Fe.x||Fn.y<qe.y||an.y>Fe.y?[]:l.aJ([St],qe.x,qe.y,Fe.x,Fe.y)}for(const an of Ct){Ue.reset(an,.25*Ce);let Fn=0;Fn=Ue.length<=.5*Ce?1:Math.ceil(Ue.paddedLength/dt)+1;for(let ii=0;ii<Fn;ii++){const Qn=ii/Math.max(Fn-1,1),ci=Ue.lerp(Qn),Zn=ci.x+Rn,xi=ci.y+Rn;se.push(Zn,xi,Ce,0);const ui=Zn-Ce,sr=xi-Ce,Ci=Zn+Ce,zi=xi+Ce;if(me=me&&this.isOffscreen(ui,sr,Ci,zi),Se=Se||this.isInsideGrid(ui,sr,Ci,zi),t!=="always"&&this.grid.hitTestCircle(Zn,xi,Ce,t,O)&&(_e=!0,!D))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!D&&_e||!Se||oe<this.perspectiveRatioCutoff?[]:se,offscreen:me,collisionDetected:_e}}projectPathToScreenSpace(t,a){const c=(function(f,v){const w=l.N();return l.aB(w,v.pitchedLabelPlaneMatrix),f.map((E=>{const D=sn(E.x,E.y,w,v.getElevation),R=v.transform.projectTileCoordinates(D.point.x,D.point.y,v.unwrappedTileID,v.getElevation);return R.point.x=(.5*R.point.x+.5)*v.width,R.point.y=(.5*-R.point.y+.5)*v.height,R}))})(t,a);return(function(f){let v=0,w=0,E=0,D=0;for(let R=0;R<f.length;R++)f[R].isOccluded?(E=R+1,D=0):(D++,D>w&&(w=D,v=E));return f.slice(v,v+w)})(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],c=new l.aa;for(const U of t){const j=new l.P(U.x+Rn,U.y+Rn);c.extend(j),a.push(j)}const{minX:f,minY:v,maxX:w,maxY:E}=c,D=this.grid.query(f,v,w,E).concat(this.ignoredGrid.query(f,v,w,E)),R={},O={};for(const U of D){const j=U.key;if(R[j.bucketInstanceId]===void 0&&(R[j.bucketInstanceId]={}),R[j.bucketInstanceId][j.featureIndex])continue;const Z=[new l.P(U.x1,U.y1),new l.P(U.x2,U.y1),new l.P(U.x2,U.y2),new l.P(U.x1,U.y2)];l.aK(a,Z)&&(R[j.bucketInstanceId][j.featureIndex]=!0,O[j.bucketInstanceId]===void 0&&(O[j.bucketInstanceId]=[]),O[j.bucketInstanceId].push(j.featureIndex))}return O}insertCollisionBox(t,a,c,f,v,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:v,collisionGroupID:w,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,c,f,v,w){const E=c?this.ignoredGrid:this.grid,D={bucketInstanceId:f,featureIndex:v,collisionGroupID:w,overlapMode:a};for(let R=0;R<t.length;R+=4)E.insertCircle(D,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,a,c,f,v){if(v){let w;f?(w=[t,a,f(t,a),1],l.aH(w,w,v)):(w=[t,a,0,1],wa(w,w,v));const E=w[3];return{x:(w[0]/E+1)/2*this.transform.width+Rn,y:(-w[1]/E+1)/2*this.transform.height+Rn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E*.5,isOccluded:!1,signedDistanceFromCamera:E}}{const w=this.transform.projectTileCoordinates(t,a,c,f);return{x:(w.point.x+1)/2*this.transform.width+Rn,y:(1-w.point.y)/2*this.transform.height+Rn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,c,f){const v=this.transform.projectTileCoordinates(t,a,c,f);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(t,a,c,f){return c<Rn||t>=this.screenRightBoundary||f<Rn||a>this.screenBottomBoundary}isInsideGrid(t,a,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=l.ar([]);return l.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,c,f,v,w,E,D,R,O,U){let j=1,Z=0,W=0,se=1;const le=t.anchorPointX+E[0],oe=t.anchorPointY+E[1];if(w&&!v){const St=this.projectAndGetPerspectiveRatio(le+1,oe,f,R,U),dt=St.x-D.x,Ct=Math.atan((St.y-D.y)/dt)+(dt<0?Math.PI:0),an=Math.sin(Ct),Fn=Math.cos(Ct);j=Fn,Z=an,W=-an,se=Fn}else if(!w&&v){const St=us(this.transform);j=St.vecEast[0],Z=St.vecEast[1],W=St.vecSouth[0],se=St.vecSouth[1]}let ue=D.x,xe=D.y,ce=a;v&&(ue=le,xe=oe,ce=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),ce*=this.transform.getPitchedTextCorrection(le,oe,f),O||(ce*=l.an(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),O&&(ue+=j*O.x*ce+W*O.y*ce,xe+=Z*O.x*ce+se*O.y*ce);const _e=t.x1*ce,Se=t.x2*ce,me=(_e+Se)/2,Ce=t.y1*ce,qe=t.y2*ce,Fe=(Ce+qe)/2,Ue=[{offsetX:_e,offsetY:Ce},{offsetX:me,offsetY:Ce},{offsetX:Se,offsetY:Ce},{offsetX:Se,offsetY:Fe},{offsetX:Se,offsetY:qe},{offsetX:me,offsetY:qe},{offsetX:_e,offsetY:qe},{offsetX:_e,offsetY:Fe}];let Ve=[];for(const{offsetX:St,offsetY:dt}of Ue)Ve.push(new l.P(ue+j*St+W*dt,xe+Z*St+se*dt));let wt=!1;if(v){const St=Ve.map((dt=>this.projectAndGetPerspectiveRatio(dt.x,dt.y,f,R,U)));wt=St.some((dt=>!dt.isOccluded)),Ve=St.map((dt=>new l.P(dt.x,dt.y)))}else wt=!0;return{box:l.aL(Ve),allPointsOccluded:!wt}}}class _f{constructor(t,a,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Ho{constructor(t,a,c,f,v){this.text=new _f(t?t.text:null,a,c,v),this.icon=new _f(t?t.icon:null,a,f,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wh{constructor(t,a,c){this.text=t,this.icon=a,this.skipFade=c}}class Rc{constructor(t,a,c,f,v){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=v}}class vf{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[t]}}function kr(y,t,a,c,f){const{horizontalAlign:v,verticalAlign:w}=l.aS(y);return new l.P(-(v-.5)*t+c[0]*f,-(w-.5)*a+c[1]*f)}class Lc{constructor(t,a,c,f,v){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Kh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new vf(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(c,f)=>a.getElevation(t,c,f):null}getBucketParts(t,a,c,f){const v=c.getBucket(a),w=c.latestFeatureIndex;if(!v||!w||a.id!==v.layerIds[0])return;const E=c.collisionBoxArray,D=v.layers[0].layout,R=v.layers[0].paint,O=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),U=c.tileSize/l.a5,j=c.tileID.toUnwrapped(),Z=D.get("text-rotation-alignment")==="map",W=l.aN(c,1,this.transform.zoom),se=l.aO(this.collisionIndex.transform,c,R.get("text-translate"),R.get("text-translate-anchor")),le=l.aO(this.collisionIndex.transform,c,R.get("icon-translate"),R.get("icon-translate-anchor")),oe=ra(Z,this.transform,W);this.retainedQueryData[v.bucketInstanceId]=new Rc(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,c.tileID);const ue={bucket:v,layout:D,translationText:se,translationIcon:le,unwrappedTileID:j,pitchedLabelPlaneMatrix:oe,scale:O,textPixelRatio:U,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:l.ay(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(f)for(const xe of v.sortKeyRanges){const{sortKey:ce,symbolInstanceStart:_e,symbolInstanceEnd:Se}=xe;t.push({sortKey:ce,symbolInstanceStart:_e,symbolInstanceEnd:Se,parameters:ue})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(t,a,c,f,v,w,E,D,R,O,U,j,Z,W,se,le,oe,ue,xe,ce){const _e=l.aP[t.textAnchor],Se=[t.textOffset0,t.textOffset1],me=kr(_e,c,f,Se,v),Ce=this.collisionIndex.placeCollisionBox(a,j,D,R,O,E,w,le,U.predicate,xe,me,ce);if((!ue||this.collisionIndex.placeCollisionBox(ue,j,D,R,O,E,w,oe,U.predicate,xe,me,ce).placeable)&&Ce.placeable){let qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(qe=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:Se,width:c,height:f,anchor:_e,textBoxScale:v,prevAnchor:qe},this.markUsedJustification(W,_e,Z,se),W.allowVerticalPlacement&&(this.markUsedOrientation(W,se,Z),this.placedOrientations[Z.crossTileID]=se),{shift:me,placedGlyphBoxes:Ce}}}placeLayerBucketPart(t,a,c){const{bucket:f,layout:v,translationText:w,translationIcon:E,unwrappedTileID:D,pitchedLabelPlaneMatrix:R,textPixelRatio:O,holdingForFade:U,collisionBoxArray:j,partiallyEvaluatedTextSize:Z,collisionGroup:W}=t.parameters,se=v.get("text-optional"),le=v.get("icon-optional"),oe=l.aQ(v,"text-overlap","text-allow-overlap"),ue=oe==="always",xe=l.aQ(v,"icon-overlap","icon-allow-overlap"),ce=xe==="always",_e=v.get("text-rotation-alignment")==="map",Se=v.get("text-pitch-alignment")==="map",me=v.get("icon-text-fit")!=="none",Ce=v.get("symbol-z-order")==="viewport-y",qe=ue&&(ce||!f.hasIconData()||le),Fe=ce&&(ue||!f.hasTextData()||se);!f.collisionArrays&&j&&f.deserializeCollisionBoxes(j);const Ue=this.retainedQueryData[f.bucketInstanceId].tileID,Ve=this._getTerrainElevationFunc(Ue),wt=this.transform.getFastPathSimpleProjectionMatrix(Ue),St=(dt,Ct,an)=>{var Fn,ii;if(a[dt.crossTileID])return;if(U)return void(this.placements[dt.crossTileID]=new Wh(!1,!1,!1));let Qn=!1,ci=!1,Zn=!0,xi=null,ui={box:null,placeable:!1,offscreen:null,occluded:!1},sr={placeable:!1},Ci=null,zi=null,or=null,ks=0,Rs=0,es=0;Ct.textFeatureIndex?ks=Ct.textFeatureIndex:dt.useRuntimeCollisionCircles&&(ks=dt.featureIndex),Ct.verticalTextFeatureIndex&&(Rs=Ct.verticalTextFeatureIndex);const $r=Ct.textBox;if($r){const Xr=Un=>{let Jn=l.az.horizontal;if(f.allowVerticalPlacement&&!Un&&this.prevPlacement){const Ui=this.prevPlacement.placedOrientations[dt.crossTileID];Ui&&(this.placedOrientations[dt.crossTileID]=Ui,Jn=Ui,this.markUsedOrientation(f,Jn,dt))}return Jn},ma=(Un,Jn)=>{if(f.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Ct.verticalTextBox){for(const Ui of f.writingModes)if(Ui===l.az.vertical?(ui=Jn(),sr=ui):ui=Un(),ui&&ui.placeable)break}else ui=Un()},ka=dt.textAnchorOffsetStartIndex,Ra=dt.textAnchorOffsetEndIndex;if(Ra===ka){const Un=(Jn,Ui)=>{const $i=this.collisionIndex.placeCollisionBox(Jn,oe,O,Ue,D,Se,_e,w,W.predicate,Ve,void 0,wt);return $i&&$i.placeable&&(this.markUsedOrientation(f,Ui,dt),this.placedOrientations[dt.crossTileID]=Ui),$i};ma((()=>Un($r,l.az.horizontal)),(()=>{const Jn=Ct.verticalTextBox;return f.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Jn?Un(Jn,l.az.vertical):{box:null,offscreen:null}})),Xr(ui&&ui.placeable)}else{let Un=l.aP[(ii=(Fn=this.prevPlacement)===null||Fn===void 0?void 0:Fn.variableOffsets[dt.crossTileID])===null||ii===void 0?void 0:ii.anchor];const Jn=($i,mh,gh)=>{const Po=$i.x2-$i.x1,Bf=$i.y2-$i.y1,Io=dt.textBoxScale,yh=me&&xe==="never"?mh:null;let to=null,no=oe==="never"?1:2,ns="never";Un&&no++;for(let _h=0;_h<no;_h++){for(let yu=ka;yu<Ra;yu++){const _u=f.textAnchorOffsets.get(yu);if(Un&&_u.textAnchor!==Un)continue;const vu=this.attemptAnchorPlacement(_u,$i,Po,Bf,Io,_e,Se,O,Ue,D,W,ns,dt,f,gh,w,E,yh,Ve);if(vu&&(to=vu.placedGlyphBoxes,to&&to.placeable))return Qn=!0,xi=vu.shift,to}Un?Un=null:ns=oe}return c&&!to&&(to={box:this.collisionIndex.placeCollisionBox($r,"always",O,Ue,D,Se,_e,w,W.predicate,Ve,void 0,wt).box,offscreen:!1,placeable:!1,occluded:!1}),to};ma((()=>Jn($r,Ct.iconBox,l.az.horizontal)),(()=>{const $i=Ct.verticalTextBox;return f.allowVerticalPlacement&&(!ui||!ui.placeable)&&dt.numVerticalGlyphVertices>0&&$i?Jn($i,Ct.verticalIconBox,l.az.vertical):{box:null,occluded:!0,offscreen:null}})),ui&&(Qn=ui.placeable,Zn=ui.offscreen);const Ui=Xr(ui&&ui.placeable);if(!Qn&&this.prevPlacement){const $i=this.prevPlacement.variableOffsets[dt.crossTileID];$i&&(this.variableOffsets[dt.crossTileID]=$i,this.markUsedJustification(f,$i.anchor,dt,Ui))}}}if(Ci=ui,Qn=Ci&&Ci.placeable,Zn=Ci&&Ci.offscreen,dt.useRuntimeCollisionCircles&&dt.centerJustifiedTextSymbolIndex>=0){const Xr=f.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex),ma=l.aA(f.textSizeData,Z,Xr),ka=v.get("text-padding");zi=this.collisionIndex.placeCollisionCircles(oe,Xr,f.lineVertexArray,f.glyphOffsetArray,ma,D,R,c,Se,W.predicate,dt.collisionCircleDiameter,ka,w,Ve),zi.circles.length&&zi.collisionDetected&&!c&&l.w("Collisions detected, but collision boxes are not shown"),Qn=ue||zi.circles.length>0&&!zi.collisionDetected,Zn=Zn&&zi.offscreen}if(Ct.iconFeatureIndex&&(es=Ct.iconFeatureIndex),Ct.iconBox){const Xr=ma=>this.collisionIndex.placeCollisionBox(ma,xe,O,Ue,D,Se,_e,E,W.predicate,Ve,me&&xi?xi:void 0,wt);sr&&sr.placeable&&Ct.verticalIconBox?(or=Xr(Ct.verticalIconBox),ci=or.placeable):(or=Xr(Ct.iconBox),ci=or.placeable),Zn=Zn&&or.offscreen}const gl=se||dt.numHorizontalGlyphVertices===0&&dt.numVerticalGlyphVertices===0,cc=le||dt.numIconVertices===0;gl||cc?cc?gl||(ci=ci&&Qn):Qn=ci&&Qn:ci=Qn=ci&&Qn;const ts=ci&&or.placeable;if(Qn&&Ci.placeable&&this.collisionIndex.insertCollisionBox(Ci.box,oe,v.get("text-ignore-placement"),f.bucketInstanceId,sr&&sr.placeable&&Rs?Rs:ks,W.ID),ts&&this.collisionIndex.insertCollisionBox(or.box,xe,v.get("icon-ignore-placement"),f.bucketInstanceId,es,W.ID),zi&&Qn&&this.collisionIndex.insertCollisionCircles(zi.circles,oe,v.get("text-ignore-placement"),f.bucketInstanceId,ks,W.ID),c&&this.storeCollisionData(f.bucketInstanceId,an,Ct,Ci,or,zi),dt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[dt.crossTileID]=new Wh((Qn||qe)&&!Ci?.occluded,(ci||Fe)&&!or?.occluded,Zn||f.justReloaded),a[dt.crossTileID]=!0};if(Ce){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const dt=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ct=dt.length-1;Ct>=0;--Ct){const an=dt[Ct];St(f.symbolInstances.get(an),f.collisionArrays[an],an)}}else for(let dt=t.symbolInstanceStart;dt<t.symbolInstanceEnd;dt++)St(f.symbolInstances.get(dt),f.collisionArrays[dt],dt);f.justReloaded=!1}storeCollisionData(t,a,c,f,v,w){if(c.textBox||c.iconBox){let E,D;this.collisionBoxArrays.has(t)?E=this.collisionBoxArrays.get(t):(E=new Map,this.collisionBoxArrays.set(t,E)),E.has(a)?D=E.get(a):(D={text:null,icon:null},E.set(a,D)),c.textBox&&(D.text=f.box),c.iconBox&&(D.icon=v.box)}if(w){let E=this.collisionCircleArrays[t];E===void 0&&(E=this.collisionCircleArrays[t]=[]);for(let D=0;D<w.circles.length;D+=4)E.push(w.circles[D+0]-Rn),E.push(w.circles[D+1]-Rn),E.push(w.circles[D+2]),E.push(w.collisionDetected?1:0)}}markUsedJustification(t,a,c,f){let v;v=f===l.az.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.aR(a)];const w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const E of w)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=v>=0&&E!==v?0:c.crossTileID)}markUsedOrientation(t,a,c){const f=a===l.az.horizontal||a===l.az.horizontalOnly?a:0,v=a===l.az.vertical?a:0,w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const E of w)t.text.placedSymbolArray.get(E).placedOrientation=f;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(t):1,v=a?a.opacities:{},w=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const D in this.placements){const R=this.placements[D],O=v[D];O?(this.opacities[D]=new Ho(O,f,R.text,R.icon),c=c||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[D]=new Ho(null,f,R.text,R.icon,R.skipFade),c=c||R.text||R.icon)}for(const D in v){const R=v[D];if(!this.opacities[D]){const O=new Ho(R,f,!1,!1);O.isHidden()||(this.opacities[D]=O,c=c||R.text.placed||R.icon.placed)}}for(const D in w)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=w[D]);for(const D in E)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=E[D]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const c={};for(const f of a){const v=f.getBucket(t);v&&f.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,f.tileID,c,f.collisionBoxArray)}}updateBucketOpacities(t,a,c,f){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const v=t.layers[0],w=v.layout,E=new Ho(null,0,!1,!1,!0),D=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),O=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),U=w.get("text-rotation-alignment")==="map",j=w.get("text-pitch-alignment")==="map",Z=w.get("icon-text-fit")!=="none",W=new Ho(null,0,D&&(R||!t.hasIconData()||w.get("icon-optional")),R&&(D||!t.hasTextData()||w.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const se=(oe,ue,xe)=>{for(let ce=0;ce<ue/4;ce++)oe.opacityVertexArray.emplaceBack(xe);oe.hasVisibleVertices=oe.hasVisibleVertices||xe!==Xo},le=this.collisionBoxArrays.get(t.bucketInstanceId);for(let oe=0;oe<t.symbolInstances.length;oe++){const ue=t.symbolInstances.get(oe),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:ce,crossTileID:_e}=ue;let Se=this.opacities[_e];c[_e]?Se=E:Se||(Se=W,this.opacities[_e]=Se),c[_e]=!0;const me=ue.numIconVertices>0,Ce=this.placedOrientations[ue.crossTileID],qe=Ce===l.az.vertical,Fe=Ce===l.az.horizontal||Ce===l.az.horizontalOnly;if(xe>0||ce>0){const Ve=qu(Se.text);se(t.text,xe,qe?Xo:Ve),se(t.text,ce,Fe?Xo:Ve);const wt=Se.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach((Ct=>{Ct>=0&&(t.text.placedSymbolArray.get(Ct).hidden=wt||qe?1:0)})),ue.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=wt||Fe?1:0);const St=this.variableOffsets[ue.crossTileID];St&&this.markUsedJustification(t,St.anchor,ue,Ce);const dt=this.placedOrientations[ue.crossTileID];dt&&(this.markUsedJustification(t,"left",ue,dt),this.markUsedOrientation(t,dt,ue))}if(me){const Ve=qu(Se.icon),wt=!(Z&&ue.verticalPlacedIconSymbolIndex&&qe);ue.placedIconSymbolIndex>=0&&(se(t.icon,ue.numIconVertices,wt?Ve:Xo),t.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Se.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(se(t.icon,ue.numVerticalIconVertices,wt?Xo:Ve),t.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}const Ue=le&&le.has(oe)?le.get(oe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ve=t.collisionArrays[oe];if(Ve){let wt=new l.P(0,0);if(Ve.textBox||Ve.verticalTextBox){let St=!0;if(O){const dt=this.variableOffsets[_e];dt?(wt=kr(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textBoxScale),U&&wt._rotate(j?-this.transform.bearingInRadians:this.transform.bearingInRadians)):St=!1}if(Ve.textBox||Ve.verticalTextBox){let dt;Ve.textBox&&(dt=qe),Ve.verticalTextBox&&(dt=Fe),Vu(t.textCollisionBox.collisionVertexArray,Se.text.placed,!St||dt,Ue.text,wt.x,wt.y)}}if(Ve.iconBox||Ve.verticalIconBox){const St=!!(!Fe&&Ve.verticalIconBox);let dt;Ve.iconBox&&(dt=St),Ve.verticalIconBox&&(dt=!St),Vu(t.iconCollisionBox.collisionVertexArray,Se.icon.placed,dt,Ue.icon,Z?wt.x:0,Z?wt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function Vu(y,t,a,c,f,v){c&&c.length!==0||(c=[0,0,0,0]);const w=c[0]-Rn,E=c[1]-Rn,D=c[2]-Rn,R=c[3]-Rn;y.emplaceBack(t?1:0,a?1:0,f||0,v||0,w,E),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,D,E),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,D,R),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,w,R)}const Oc=Math.pow(2,25),ho=Math.pow(2,24),xf=Math.pow(2,17),Ul=Math.pow(2,16),Vs=Math.pow(2,9),bf=Math.pow(2,8),$o=Math.pow(2,1);function qu(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const t=y.placed?1:0,a=Math.floor(127*y.opacity);return a*Oc+t*ho+a*xf+t*Ul+a*Vs+t*bf+a*$o+t}const Xo=0;class fo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,c,f,v){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((E,D)=>E.sortKey-D.sortKey)));this._currentPartIndex<w.length;)if(a.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,v())return!0;return!1}}class Vl{constructor(t,a,c,f,v,w,E,D){this.placement=new Lc(t,a,w,E,D),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(t,a,c){const f=pe(),v=()=>!this._forceFullPlacement&&pe()-f>2;for(;this._currentPlacementIndex>=0;){const w=a[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=E)&&(!w.maxzoom||w.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new fo(w)),this._inProgressLayer.continuePlacement(c[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const dn=512/l.a5/2;class Ha{constructor(t,a,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const f=new Map;for(let v=0;v<a.length;v++){const w=a.get(v),E=w.key,D=f.get(E);D?D.push(w):f.set(E,[w])}for(const[v,w]of f){const E={positions:w.map((D=>({x:Math.floor(D.anchorX*dn),y:Math.floor(D.anchorY*dn)}))),crossTileIDs:w.map((D=>D.crossTileID))};if(E.positions.length>128){const D=new l.aT(E.positions.length,16,Uint16Array);for(const{x:R,y:O}of E.positions)D.add(R,O);D.finish(),delete E.positions,E.index=D}this._symbolsByKey[v]=E}}getScaledCoordinates(t,a){const{x:c,y:f,z:v}=this.tileID.canonical,{x:w,y:E,z:D}=a.canonical,R=dn/Math.pow(2,D-v),O=(E*l.a5+t.anchorY)*R,U=f*l.a5*dn;return{x:Math.floor((w*l.a5+t.anchorX)*R-c*l.a5*dn),y:Math.floor(O-U)}}findMatches(t,a,c){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let v=0;v<t.length;v++){const w=t.get(v);if(w.crossTileID)continue;const E=this._symbolsByKey[w.key];if(!E)continue;const D=this.getScaledCoordinates(w,a);if(E.index){const R=E.index.range(D.x-f,D.y-f,D.x+f,D.y+f).sort();for(const O of R){const U=E.crossTileIDs[O];if(!c[U]){c[U]=!0,w.crossTileID=U;break}}}else if(E.positions)for(let R=0;R<E.positions.length;R++){const O=E.positions[R],U=E.crossTileIDs[R];if(Math.abs(O.x-D.x)<=f&&Math.abs(O.y-D.y)<=f&&!c[U]){c[U]=!0,w.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Qh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const c in this.indexes){const f=this.indexes[c],v={};for(const w in f){const E=f[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),v[E.tileID.key]=E}this.indexes[c]=v}this.lng=t}addBucket(t,a,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>t.overscaledZ)for(const E in w){const D=w[E];D.tileID.isChildOf(t)&&D.findMatches(a.symbolInstances,t,f)}else{const E=w[t.scaledTo(Number(v)).key];E&&E.findMatches(a.symbolInstances,t,f)}}for(let v=0;v<a.symbolInstances.length;v++){const w=a.symbolInstances.get(v);w.crossTileID||(w.crossTileID=c.generate(),f[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ha(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const c of a.getCrossTileIDsLists())for(const f of c)delete this.usedCrossTileIDs[t][f]}removeStaleBuckets(t){let a=!1;for(const c in this.indexes){const f=this.indexes[c];for(const v in f)t[f[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[v]),delete f[v],a=!0)}return a}}class Ji{constructor(){this.layerIndexes={},this.crossTileIDs=new Qh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,c){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Bc);let v=!1;const w={};f.handleWrapJump(c);for(const E of a){const D=E.getBucket(t);D&&t.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(E.tileID,D,this.crossTileIDs)&&(v=!0),w[D.bucketInstanceId]=!0)}return f.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(t){const a={};t.forEach((c=>{a[c]=!0}));for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var Fi="void main() {fragColor=vec4(1.0);}";const hi={prelude:Jt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Jt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Jt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Jt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Jt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Jt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Jt(Fi,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Jt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Jt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Jt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Jt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Jt(Fi,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Jt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Jt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Jt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Jt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Jt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Jt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Jt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Jt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Jt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Jt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Jt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Jt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Jt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Jt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Jt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Jt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Jt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Jt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Jt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Jt(y,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),f=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(f):f,E={};return{fragmentSource:y=y.replace(a,((D,R,O,U,j)=>(E[j]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${O} ${U} ${j};
#else
uniform ${O} ${U} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${O} ${U} ${j} = u_${j};
#endif
`))),vertexSource:t=t.replace(a,((D,R,O,U,j)=>{const Z=U==="float"?"vec2":"vec4",W=j.match(/color/)?"color":Z;return E[j]?R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${O} ${Z} a_${j};
out ${O} ${U} ${j};
#else
uniform ${O} ${U} u_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${O} ${U} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${O} ${U} ${j} = u_${j};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${O} ${Z} a_${j};
#else
uniform ${O} ${U} u_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${O} ${U} ${j} = a_${j};
#else
    ${O} ${U} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${O} ${U} ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${O} ${U} ${j} = u_${j};
#endif
`})),staticAttributes:c,staticUniforms:w}}class Kn{constructor(t,a,c){this.vertexBuffer=t,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ta=l.aU([{name:"a_pos",type:"Int16",components:2}]);const Ei="#define PROJECTION_MERCATOR",Rr="mercator";class er{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Rr}get shaderDefine(){return Ei}get shaderPreludeCode(){return hi.projectionMercator}get vertexShaderPreludeCode(){return hi.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,c,f,v){if(this._cachedMesh)return this._cachedMesh;const w=new l.aW;w.emplaceBack(0,0),w.emplaceBack(l.a5,0),w.emplaceBack(0,l.a5),w.emplaceBack(l.a5,l.a5);const E=t.createVertexBuffer(w,Ta.members),D=l.aX.simpleSegment(0,0,4,2),R=new l.aY;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const O=t.createIndexBuffer(R);return this._cachedMesh=new Kn(E,O,D),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class aa{constructor(t=0,a=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=c,this.right=f}interpolate(t,a,c){return a.top!=null&&t.top!=null&&(this.top=l.G.number(t.top,a.top,c)),a.bottom!=null&&t.bottom!=null&&(this.bottom=l.G.number(t.bottom,a.bottom,c)),a.left!=null&&t.left!=null&&(this.left=l.G.number(t.left,a.left,c)),a.right!=null&&t.right!=null&&(this.right=l.G.number(t.right,a.right,c)),this}getCenter(t,a){const c=l.an((this.left+t-this.right)/2,0,t),f=l.an((this.top+a-this.bottom)/2,0,a);return new l.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new aa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ms(y,t){if(!y.renderWorldCopies||y.lngRange)return;const a=t.lng-y.center.lng;t.lng+=a>180?-360:a<-180?360:0}function di(y){return Math.max(0,Math.floor(y))}class po{constructor(t,a){var c;this.applyConstrain=(f,v)=>this._constrainOverride!==null?this._constrainOverride(f,v):this._callbacks.defaultConstrain(f,v),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=di(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new aa,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,c){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=di(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new aa(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=l.W(t,-180,180)*Math.PI/180;var c,f,v,w,E,D,R,O,U;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=K(),c=this._rotationMatrix,v=-this._bearingInRadians,w=(f=this._rotationMatrix)[0],E=f[1],D=f[2],R=f[3],O=Math.sin(v),U=Math.cos(v),c[0]=w*U+D*O,c[1]=E*U+R*O,c[2]=w*-O+D*U,c[3]=E*-O+R*U)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=l.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aZ(this._fovInRadians)}setFov(t){t=l.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=l.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=l.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,c){this._unmodified=!1,this._edgeInsets.interpolate(t,a,c),this.constrainInternal(),this._calcMatrices()}resize(t,a,c=!0){this._width=t,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Yn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-l.ao,l.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:c,minY:f,maxX:v,maxY:w}=l.aa.fromPoints(a).extend(t);return[new l.P(c,f),new l.P(v,f),new l.P(v,w),new l.P(c,w),new l.P(c,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=l.ar(new Float64Array(16));l.Q(t,t,[this._width/2,-this._height/2,1]),l.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=l.ar(new Float64Array(16)),l.Q(t,t,[1,-1,1]),l.O(t,t,[-1,-1,0]),l.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,c,f){const v=c!==void 0?c:this.bearing,w=f=f!==void 0?f:this.pitch,{distanceToCenter:E,clampedElevation:D}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,w),{x:R,y:O}=lt(w,v),U=l.a9.fromLngLat(t,a);let j,Z,W=l.a_(1,U.y),se=0;do{if(se+=1,se>10)break;Z=E/W,j=new l.a9(U.x+R*Z,U.y+O*Z),W=1/j.meterInMercatorCoordinateUnits()}while(Math.abs(E-Z*W)>1e-12);return{center:j.toLngLat(),elevation:D,zoom:l.at(this.height/2/Math.tan(this.fovInRadians/2)/Z/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,c=l.as(1,this.center.lat)*this.worldSize,f=l.a9.fromLngLat(this.center,this.elevation),v=f.x/a,w=f.y/a,E=f.z/a,D=this.pitch,R=this.bearing,{x:O,y:U,z:j}=lt(D,R),Z=this.cameraToCenterDistance,W=v+Z*-O,se=w+Z*-U,le=E+Z*j,{distanceToCenter:oe,clampedElevation:ue}=this._distanceToCenterFromAltElevationPitch(le/c,t,D),xe=oe*c,ce=new l.a9((W+O*xe)*a,(se+U*xe)*a,0).toLngLat(),_e=l.as(1,ce.lat),Se=l.at(this.height/2/Math.tan(this.fovInRadians/2)/oe/_e/this.tileSize);this._elevation=ue,this._center=ce,this.setZoom(Se)}_distanceToCenterFromAltElevationPitch(t,a,c){const f=-Math.cos(l.ap(c)),v=t-a;let w,E=a;return f*v>=0||Math.abs(f)<.1?(w=1e4,E=t+w*f):w=-v/f,{distanceToCenter:w,clampedElevation:E}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Ne(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/l.a5,1/a/l.a5]}}class sa{constructor(t,a){this.min=t,this.max=a,this.center=l.a$([],l.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],c=l.b1(this.min),f=l.b1(this.max);for(let v=0;v<a.length;v++)c[v]=a[v]?this.min[v]:this.center[v],f[v]=a[v]?this.center[v]:this.max[v];return f[2]=this.max[2],new sa(c,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let c=0;c<t.planes.length;c++){const f=this.intersectsPlane(t.planes[c]);if(f===0)return 0;f===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],c=t[3];for(let f=0;f<3;f++)t[f]>0?(a+=t[f]*this.min[f],c+=t[f]*this.max[f]):(c+=t[f]*this.min[f],a+=t[f]*this.max[f]);return a>=0?2:c<0?0:1}}class Yo{distanceToTile2d(t,a,c,f){const v=f.distanceX([t,a]),w=f.distanceY([t,a]);return Math.hypot(v,w)}getWrap(t,a,c){return c}getTileBoundingVolume(t,a,c,f){var v,w;let E=0,D=0;if(f?.terrain){const O=new l.a2(t.z,a,t.z,t.x,t.y),U=f.terrain.getMinMaxElevation(O);E=(v=U.minElevation)!==null&&v!==void 0?v:Math.min(0,c),D=(w=U.maxElevation)!==null&&w!==void 0?w:Math.max(0,c)}const R=1<<t.z;return new sa([a+t.x/R,t.y/R,E],[a+(t.x+1)/R,(t.y+1)/R,D])}allowVariableZoom(t,a){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,f=l.an(78.5-c/2,0,60);return!!a.terrain||t.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class Lr{constructor(t,a,c){this.points=t,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(t,a=1,c=0,f,v){const w=v?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],E=Math.pow(2,c),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((j=>(function(Z,W,se,le){const oe=l.aH([],Z,W),ue=1/oe[3]/se*le;return l.b6(oe,oe,[ue,ue,1/oe[3],ue])})(j,t,a,E)));f&&(function(j,Z,W,se){const le=se?4:0,oe=se?0:4;let ue=0;const xe=[],ce=[];for(let me=0;me<4;me++){const Ce=l.b2([],j[me+oe],j[me+le]),qe=l.b7(Ce);l.a$(Ce,Ce,1/qe),xe.push(qe),ce.push(Ce)}for(let me=0;me<4;me++){const Ce=l.b8(j[me+le],ce[me],W);ue=Ce!==null&&Ce>=0?Math.max(ue,Ce):Math.max(ue,xe[me])}const _e=(function(me,Ce){const qe=l.b2([],me[Ce[0]],me[Ce[1]]),Fe=l.b2([],me[Ce[2]],me[Ce[1]]),Ue=[0,0,0,0];return l.b3(Ue,l.b4([],qe,Fe)),Ue[3]=-l.b5(Ue,me[Ce[0]]),Ue})(j,Z),Se=(function(me,Ce){const qe=l.b9(me),Fe=l.ba([],me,1/qe),Ue=l.b2([],Ce,l.a$([],Fe,l.b5(Ce,Fe))),Ve=l.b9(Ue);if(Ve>0){const wt=Math.sqrt(1-Fe[3]*Fe[3]),St=l.a$([],Fe,-Fe[3]),dt=l.b0([],St,l.a$([],Ue,wt/Ve));return l.bb(Ce,dt)}return null})(W,_e);if(Se!==null){const me=Se/l.b5(ce[0],_e);ue=Math.min(ue,me)}for(let me=0;me<4;me++){const Ce=Math.min(ue,xe[me]);j[me+oe]=[j[me+le][0]+ce[me][0]*Ce,j[me+le][1]+ce[me][1]*Ce,j[me+le][2]+ce[me][2]*Ce,1]}})(D,w[0],f,v);const R=w.map((j=>{const Z=l.b2([],D[j[0]],D[j[1]]),W=l.b2([],D[j[2]],D[j[1]]),se=l.b3([],l.b4([],Z,W)),le=-l.b5(se,D[j[1]]);return se.concat(le)})),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],U=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const j of D)for(let Z=0;Z<3;Z++)O[Z]=Math.min(O[Z],j[Z]),U[Z]=Math.max(U[Z],j[Z]);return new Lr(D,R,new sa(O,U))}}class Hi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=l.an(+c,this.minZoom,this.maxZoom);const f={center:new l.V(a.lng,a.lat),zoom:c};let v=this._helper._lngRange;if(!this._helper._renderWorldCopies&&v===null){const ce=179.9999999999;v=[-ce,ce]}const w=this.tileSize*l.aq(f.zoom);let E=0,D=w,R=0,O=w,U=0,j=0;const{x:Z,y:W}=this.size;if(this._helper._latRange){const ce=this._helper._latRange;E=l.X(ce[1])*w,D=l.X(ce[0])*w,D-E<W&&(U=W/(D-E))}v&&(R=l.W(l.Y(v[0])*w,0,w),O=l.W(l.Y(v[1])*w,0,w),O<R&&(O+=w),O-R<Z&&(j=Z/(O-R)));const{x:se,y:le}=It(w,a);let oe,ue;const xe=Math.max(j||0,U||0);if(xe){const ce=new l.P(j?(O+R)/2:se,U?(D+E)/2:le);return f.center=Kt(w,ce).wrap(),f.zoom+=l.at(xe),f}if(this._helper._latRange){const ce=W/2;le-ce<E&&(ue=E+ce),le+ce>D&&(ue=D-ce)}if(v){const ce=(R+O)/2;let _e=se;this._helper._renderWorldCopies&&(_e=l.W(se,ce-w/2,ce+w/2));const Se=Z/2;_e-Se<R&&(oe=R+Se),_e+Se>O&&(oe=O-Se)}if(oe!==void 0||ue!==void 0){const ce=new l.P(oe??se,ue??le);f.center=Kt(w,ce).wrap()}return f},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new Yo}clone(){const t=new Hi;return t.apply(this),t}apply(t,a,c){this._helper.apply(t,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new l.bc(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new l.P(0,0)),f=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),v=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),E=Math.floor(Math.min(c.x,f.x,v.x,w.x)),D=Math.floor(Math.max(c.x,f.x,v.x,w.x)),R=1;for(let O=E-R;O<=D+R;O++)O!==0&&a.push(new l.bc(O,t))}return a}getCameraFrustum(){return Lr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,a){const c=l.as(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(a,c),v=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),w=l.a9.fromLngLat(t),E=new l.a9(w.x-(f.x-v.x),w.y-(f.y-v.y));this.setCenter(E?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(l.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(l.a9.fromLngLat(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const c=a||0,f=[t.x,t.y,0,1],v=[t.x,t.y,1,1];l.aH(f,f,this._pixelMatrixInverse),l.aH(v,v,this._pixelMatrixInverse);const w=f[3],E=v[3],D=f[1]/w,R=v[1]/E,O=f[2]/w,U=v[2]/E,j=O===U?0:(c-O)/(U-O);return new l.a9(l.G.number(f[0]/w,v[0]/E,j)/this.worldSize,l.G.number(D,R,j)/this.worldSize,c)}coordinatePoint(t,a=0,c=this._pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,a,1];return l.aH(f,f,c),new l.P(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this._helper._height/2-gn(this));return new Yn().extend(this.screenPointToLocation(new l.P(0,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-gn(this)}calculatePosMatrix(t,a=!1,c){var f;const v=(f=t.key)!==null&&f!==void 0?f:l.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),w=a?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(v)){const R=w.get(v);return c?R.f32:R.f64}const E=pn(t,this.worldSize);l.S(E,a?this._alignedProjMatrix:this._viewProjMatrix,E);const D={f64:E,f32:new Float32Array(E)};return w.set(v,D),c?D.f32:D.f64}calculateFogMatrix(t){const a=t.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);const f=pn(t,this.worldSize);return l.S(f,this._fogMatrix,f),c.set(a,new Float32Array(f)),c.get(a)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}_calculateNearFarZIfNeeded(t,a,c){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),v=t-f*this._helper._pixelPerMeter/Math.cos(a),w=f<0?v:t,E=Math.PI/2+this.pitchInRadians,D=l.ap(this.fov)*(Math.abs(Math.cos(l.ap(this.roll)))*this.height+Math.abs(Math.sin(l.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),R=Math.sin(D)*w/Math.sin(l.an(Math.PI-E-D,.01,Math.PI-.01)),O=gn(this),U=Math.atan(O/this._helper.cameraToCenterDistance),j=l.ap(.75),Z=U>j?2*U*(.5+c.y/(2*O)):j,W=Math.sin(Z)*w/Math.sin(l.an(Math.PI-E-Z,.01,Math.PI-.01)),se=Math.min(R,W);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*se+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=It(this.worldSize,this.center),c=a.x,f=a.y;this._helper._pixelPerMeter=l.as(1,this.center.lat)*this.worldSize;const v=l.ap(Math.min(this.pitch,Et)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(v));let E;this._calculateNearFarZIfNeeded(w,v,t),E=new Float64Array(16),l.be(E,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aB(this._invProjMatrix,E),E[8]=2*-t.x/this._helper._width,E[9]=2*t.y/this._helper._height,this._projectionMatrix=l.bf(E),l.Q(E,E,[1,-1,1]),l.O(E,E,[0,0,-this._helper.cameraToCenterDistance]),l.bg(E,E,-this.rollInRadians),l.bh(E,E,this.pitchInRadians),l.bg(E,E,-this.bearingInRadians),l.O(E,E,[-c,-f,0]),this._mercatorMatrix=l.Q([],E,[this.worldSize,this.worldSize,this.worldSize]),l.Q(E,E,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E),l.O(E,E,[0,0,-this.elevation]),this._viewProjMatrix=E,this._invViewProjMatrix=l.aB([],E);const D=[0,0,-1,1];l.aH(D,D,this._invViewProjMatrix),this._cameraPosition=[D[0]/D[3],D[1]/D[3],D[2]/D[3]],this._fogMatrix=new Float64Array(16),l.be(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,l.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.O(this._fogMatrix,this._fogMatrix,[-c,-f,0]),l.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E);const R=this._helper._width%2/2,O=this._helper._height%2/2,U=Math.cos(this.bearingInRadians),j=Math.sin(-this.bearingInRadians),Z=c-Math.round(c)+U*R+j*O,W=f-Math.round(f)+U*O+j*R,se=new Float64Array(E);if(l.O(se,se,[Z>.5?Z-1:Z,W>.5?W-1:W,0]),this._alignedProjMatrix=se,E=l.aB(new Float64Array(16),this._pixelMatrix),!E)throw new Error("failed to invert matrix");this._pixelMatrixInverse=E,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new l.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Ne(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const c=l.a9.fromLngLat(t),f=[c.x*this.worldSize,c.y*this.worldSize,a,1];return l.aH(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(t){const{overscaledTileID:a,aligned:c,applyTerrainMatrix:f}=t,v=this._helper.getMercatorTileCoordinates(a),w=a?this.calculatePosMatrix(a,c,!0):null;let E;return E=a&&a.terrainRttPosMatrix32f&&f?a.terrainRttPosMatrix32f:w||l.bi(),{mainMatrix:E,tileMercatorCoords:v,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:E}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,c){return 1}transformLightDirection(t){return l.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,c,f){const v=this.calculatePosMatrix(c);let w;f?(w=[t,a,f(t,a),1],l.aH(w,w,v)):(w=[t,a,0,1],wa(w,w,v));const E=w[3];return{point:new l.P(w[0]/E,w[1]/E),signedDistanceFromCamera:E,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const c=l.a9.fromLngLat(t,a),f=c.meterInMercatorCoordinateUnits(),v=l.bj();return l.O(v,v,[c.x,c.y,c.z]),l.bg(v,v,Math.PI),l.bh(v,v,Math.PI/2),l.Q(v,v,[-f,f,f]),v}getProjectionDataForCustomLayer(t=!0){const a=new l.a2(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),f=pn(a,this.worldSize);l.S(f,this._viewProjMatrix,f),c.tileMercatorCoords=[0,0,1,1];const v=[l.a5,l.a5,this.worldSize/this._helper.pixelsPerMeter],w=l.bk();return l.Q(w,f,v),c.fallbackMatrix=w,c.mainMatrix=w,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Or(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Nc(y){if(y.useSlerp)if(y.k<1){const t=l.bl(y.startEulerAngles.roll,y.startEulerAngles.pitch,y.startEulerAngles.bearing),a=l.bl(y.endEulerAngles.roll,y.endEulerAngles.pitch,y.endEulerAngles.bearing),c=new Float64Array(4);l.bm(c,t,a,y.k);const f=l.bn(c);y.tr.setRoll(f.roll),y.tr.setPitch(f.pitch),y.tr.setBearing(f.bearing)}else y.tr.setRoll(y.endEulerAngles.roll),y.tr.setPitch(y.endEulerAngles.pitch),y.tr.setBearing(y.endEulerAngles.bearing);else y.tr.setRoll(l.G.number(y.startEulerAngles.roll,y.endEulerAngles.roll,y.k)),y.tr.setPitch(l.G.number(y.startEulerAngles.pitch,y.endEulerAngles.pitch,y.k)),y.tr.setBearing(l.G.number(y.startEulerAngles.bearing,y.endEulerAngles.bearing,y.k))}function Ko(y,t,a,c,f){const v=f.padding,w=It(f.worldSize,a.getNorthWest()),E=It(f.worldSize,a.getNorthEast()),D=It(f.worldSize,a.getSouthEast()),R=It(f.worldSize,a.getSouthWest()),O=l.ap(-c),U=w.rotate(O),j=E.rotate(O),Z=D.rotate(O),W=R.rotate(O),se=new l.P(Math.max(U.x,j.x,W.x,Z.x),Math.max(U.y,j.y,W.y,Z.y)),le=new l.P(Math.min(U.x,j.x,W.x,Z.x),Math.min(U.y,j.y,W.y,Z.y)),oe=se.sub(le),ue=(f.width-(v.left+v.right+t.left+t.right))/oe.x,xe=(f.height-(v.top+v.bottom+t.top+t.bottom))/oe.y;if(xe<0||ue<0)return void Or();const ce=Math.min(l.at(f.scale*Math.min(ue,xe)),y.maxZoom),_e=l.P.convert(y.offset),Se=new l.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(l.ap(c)),me=_e.add(Se).mult(f.scale/l.aq(ce));return{center:Kt(f.worldSize,w.add(D).div(2).sub(me)),zoom:ce,bearing:c}}class Wo{get useGlobeControls(){return!1}handlePanInertia(t,a){const c=t.mag(),f=Math.abs(gn(a));return{easingOffset:t.mult(Math.min(.75*f/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,c){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,a,c,f,v){return Ko(t,a,c,f,v)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(l.V.convert(a.center))}handleEaseTo(t,a){const c=t.zoom,f=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},E=a.zoom!==void 0,D=!t.isPaddingEqual(a.padding);let R=!1;const O=E?+a.zoom:t.zoom;let U=t.centerPoint.add(a.offsetAsPoint);const j=t.screenPointToLocation(U),{center:Z,zoom:W}=t.applyConstrain(l.V.convert(a.center||j),O??c);ms(t,Z);const se=It(t.worldSize,j),le=It(t.worldSize,Z).sub(se),oe=l.aq(W-c);return R=W!==c,{easeFunc:ue=>{if(R&&t.setZoom(l.G.number(c,W,ue)),l.bo(v,w)||Nc({startEulerAngles:v,endEulerAngles:w,tr:t,k:ue,useSlerp:v.roll!=w.roll}),D&&(t.interpolatePadding(f,a.padding,ue),U=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const xe=l.aq(t.zoom-c),ce=W>c?Math.min(2,oe):Math.max(.5,oe),_e=Math.pow(ce,1-ue),Se=Kt(t.worldSize,se.add(le.mult(ue*_e)).mult(xe));t.setLocationAtPoint(t.renderWorldCopies?Se.wrap():Se,U)}},isZooming:R,elevationCenter:Z}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.zoom,v=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),c?+a.zoom:f),w=v.center,E=v.zoom;ms(t,w);const D=It(t.worldSize,a.locationAtOffset),R=It(t.worldSize,w).sub(D),O=R.mag(),U=l.aq(E-f);let j;if(a.minZoom!==void 0){const Z=Math.min(+a.minZoom,f,E),W=t.applyConstrain(w,Z).zoom;j=l.aq(W-f)}return{easeFunc:(Z,W,se,le)=>{t.setZoom(Z===1?E:f+l.at(W));const oe=Z===1?w:Kt(t.worldSize,D.add(R.mult(se)).mult(W));t.setLocationAtPoint(t.renderWorldCopies?oe.wrap():oe,le)},scaleOfZoom:U,targetCenter:w,scaleOfMinZoom:j,pixelPathLength:O}}}class Gn{constructor(t,a,c){this.blendFunction=t,this.blendColor=a,this.mask=c}}Gn.Replace=[1,0],Gn.disabled=new Gn(Gn.Replace,l.bp.transparent,[!1,!1,!1,!1]),Gn.unblended=new Gn(Gn.Replace,l.bp.transparent,[!0,!0,!0,!0]),Gn.alphaBlended=new Gn([1,771],l.bp.transparent,[!0,!0,!0,!0]);const mo=2305;class _n{constructor(t,a,c){this.enable=t,this.mode=a,this.frontFace=c}}_n.disabled=new _n(!1,1029,mo),_n.backCCW=new _n(!0,1029,mo),_n.frontCCW=new _n(!0,1028,mo);class cn{constructor(t,a,c){this.func=t,this.mask=a,this.range=c}}cn.ReadOnly=!1,cn.ReadWrite=!0,cn.disabled=new cn(519,cn.ReadOnly,[0,1]);const Qo=7680;class An{constructor(t,a,c,f,v,w){this.test=t,this.ref=a,this.mask=c,this.fail=f,this.depthFail=v,this.pass=w}}An.disabled=new An({func:519,mask:0},0,0,Qo,Qo,Qo);const Fc=new WeakMap;function Sa(y){var t;if(Fc.has(y))return Fc.get(y);{const a=(t=y.getParameter(y.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Fc.set(y,a),a}}class go{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const f=new l.aW;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const v=new l.aY;v.emplaceBack(0,1,2),this._fullscreenTriangle=new Kn(a.createVertexBuffer(f,Ta.members),a.createIndexBuffer(v),l.aX.simpleSegment(0,0,f.length,v.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);const w=c.createTexture();c.bindTexture(c.TEXTURE_2D,w),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),Sa(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const c=this._cachedRenderContext.context,f=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:l.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,f.TRIANGLES,cn.disabled,An.disabled,Gn.unblended,_n.disabled,((v,w)=>({u_input:v,u_output_expected:w}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Sa(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const v=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:v}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Sa(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=go._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const yo=l.a5/128;function wf(y,t){const a=y.granularity!==void 0?Math.max(y.granularity,1):1,c=a+(y.generateBorders?2:0),f=a+(y.extendToNorthPole||y.generateBorders?1:0)+(y.extendToSouthPole||y.generateBorders?1:0),v=c+1,w=f+1,E=y.generateBorders?-1:0,D=y.generateBorders||y.extendToNorthPole?-1:0,R=a+(y.generateBorders?1:0),O=a+(y.generateBorders||y.extendToSouthPole?1:0),U=v*w,j=c*f*6,Z=v*w>65536;if(Z&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const W=Z||t==="32bit",se=new Int16Array(2*U);let le=0;for(let xe=D;xe<=O;xe++)for(let ce=E;ce<=R;ce++){let _e=ce/a*l.a5;ce===-1&&(_e=-yo),ce===a+1&&(_e=l.a5+yo);let Se=xe/a*l.a5;xe===-1&&(Se=y.extendToNorthPole?l.br:-yo),xe===a+1&&(Se=y.extendToSouthPole?l.bs:l.a5+yo),se[le++]=_e,se[le++]=Se}const oe=W?new Uint32Array(j):new Uint16Array(j);let ue=0;for(let xe=0;xe<f;xe++)for(let ce=0;ce<c;ce++){const _e=ce+1+xe*v,Se=ce+(xe+1)*v,me=ce+1+(xe+1)*v;oe[ue++]=ce+xe*v,oe[ue++]=Se,oe[ue++]=_e,oe[ue++]=_e,oe[ue++]=Se,oe[ue++]=me}return{vertices:se.buffer.slice(0),indices:oe.buffer.slice(0),uses32bitIndices:W}}const jc=new l.aV({fill:new l.bt(128,2),line:new l.bt(512,0),tile:new l.bt(128,32),stencil:new l.bt(128,1),circle:3});class Jh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return hi.projectionGlobe}get vertexShaderPreludeCode(){return hi.projectionMercator.vertexSource}get subdivisionGranularity(){return jc}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new go(t));const a=l.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(a,c),v=pe();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=v);const w=Math.min(Math.max((v-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bv(w))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,c,f,v){const w=(v==="stencil"?jc.stencil:jc.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:w,generateBorders:c,extendToNorthPole:a.y===0&&f,extendToSouthPole:a.y===(1<<a.z)-1&&f})}_getMesh(t,a){const c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];const f=(function(v,w){const E=wf(w,"16bit"),D=l.aW.deserialize({arrayBuffer:E.vertices,length:E.vertices.byteLength/2/2}),R=l.aY.deserialize({arrayBuffer:E.indices,length:E.indices.byteLength/2/3});return new Kn(v.createVertexBuffer(D,Ta.members),v.createIndexBuffer(R),l.aX.simpleSegment(0,0,D.length,R.length))})(t,a);return this._tileMeshCache[c]=f,f}recalculate(t){}hasTransition(){const t=pe();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Kp=new l.t({type:new l.D(l.u.projection.type)});class ed extends l.E{constructor(t){super(),this._transitionable=new l.x(Kp,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0)),this._mercatorProjection=new er,this._verticalPerspectiveProjection=new Jh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof l.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,c,f,v){return this.currentProjection.getMeshFromTileID(t,a,c,f,v)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Br(y){const t=Jo(y.worldSize,y.center.lat);return 2*Math.PI*t}function gs(y,t,a,c,f){const v=1/(1<<f),w=t/l.a5*v+c*v,E=l.by((y/l.a5*v+a*v)*Math.PI*2+Math.PI,2*Math.PI),D=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,R=Math.cos(D),O=new Float64Array(3);return O[0]=Math.sin(E)*R,O[1]=Math.sin(D),O[2]=Math.cos(E)*R,O}function fi(y){return(function(t,a){const c=Math.cos(a),f=new Float64Array(3);return f[0]=Math.sin(t)*c,f[1]=Math.sin(a),f[2]=Math.cos(t)*c,f})(y.lng*Math.PI/180,y.lat*Math.PI/180)}function Jo(y,t){return y/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Uc(y){const t=Math.asin(y[1])/Math.PI*180,a=Math.sqrt(y[0]*y[0]+y[2]*y[2]);if(a>1e-6){const c=y[0]/a,f=Math.acos(y[2]/a),v=(c>0?f:-f)/Math.PI*180;return new l.V(l.W(v,-180,180),t)}return new l.V(0,t)}function Vc(y){return Math.cos(y*Math.PI/180)}function Mi(y,t){const a=Vc(y),c=Vc(t);return l.at(c/a)}function Tf(y,t){const a=y.rotate(t.bearingInRadians),c=t.zoom+Mi(t.center.lat,0),f=l.bu(1/Vc(t.center.lat),1/Vc(Math.min(Math.abs(t.center.lat),60)),l.bx(c,7,3,0,1)),v=360/Br({worldSize:t.worldSize,center:{lat:t.center.lat}});return new l.V(t.center.lng-a.x*v*f,l.an(t.center.lat+a.y*v,-l.ao,l.ao))}function Gu(y){const t=.5*y,a=Math.sin(t),c=Math.cos(t);return Math.log(a+c)-Math.log(c-a)}function Sf(y,t,a,c){const f=y.lat+a*c;if(Math.abs(a)>1){const v=(Math.sign(y.lat+a)!==Math.sign(y.lat)?-Math.abs(y.lat):Math.abs(y.lat))*Math.PI/180,w=Math.abs(y.lat+a)*Math.PI/180,E=Gu(v+c*(w-v)),D=Gu(v),R=Gu(w);return new l.V(y.lng+t*((E-D)/(R-D)),f)}return new l.V(y.lng+t*c,f)}class Wp{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,c,f){const v=`${t.z}_${t.x}_${t.y}_${f?.terrain?"t":""}`,w=this._cache.get(v);if(w)return w;const E=this._cachePrevious.get(v);if(E)return this._cache.set(v,E),E;const D=this._boundingVolumeFactory(t,a,c,f);return this._cache.set(v,D),this._hadAnyChanges=!0,D}}class ql{constructor(t,a,c,f){this.min=c,this.max=f,this.points=t,this.planes=a}static fromAabb(t,a){const c=[];for(let f=0;f<8;f++)c.push([1&~f?t[0]:a[0],(f>>1&1)==1?a[1]:t[1],(f>>2&1)==1?a[2]:t[2]]);return new ql(c,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,c){const f=l.bB([],c[0],c[1],c[2]),v=l.bC([],[a[0],0,0],f),w=l.bC([],[0,a[1],0],f),E=l.bC([],[0,0,a[2]],f),D=[...t],R=[...t];for(let U=0;U<8;U++)for(let j=0;j<3;j++){const Z=t[j]+v[j]*(1&~U?-1:1)+w[j]*((U>>1&1)==1?1:-1)+E[j]*((U>>2&1)==1?1:-1);D[j]=Math.min(D[j],Z),R[j]=Math.max(R[j],Z)}const O=[];for(let U=0;U<8;U++){const j=[...t];l.b0(j,j,l.a$([],v,1&~U?-1:1)),l.b0(j,j,l.a$([],w,(U>>1&1)==1?1:-1)),l.b0(j,j,l.a$([],E,(U>>2&1)==1?1:-1)),O.push(j)}return new ql(O,[[...v,-l.b5(v,O[0])],[...w,-l.b5(w,O[0])],[...E,-l.b5(E,O[0])],[-v[0],-v[1],-v[2],-l.b5(v,O[7])],[-w[0],-w[1],-w[2],-l.b5(w,O[7])],[-E[0],-E[1],-E[2],-l.b5(E,O[7])]],D,R)}intersectsFrustum(t){let a=!0;const c=this.points.length,f=this.planes.length,v=t.planes.length,w=t.points.length;for(let E=0;E<v;E++){const D=t.planes[E];let R=0;for(let O=0;O<c;O++){const U=this.points[O];D[0]*U[0]+D[1]*U[1]+D[2]*U[2]+D[3]>=0&&R++}if(R===0)return 0;R<c&&(a=!1)}if(a)return 2;for(let E=0;E<f;E++){const D=this.planes[E];let R=0;for(let O=0;O<w;O++){const U=t.points[O];D[0]*U[0]+D[1]*U[1]+D[2]*U[2]+D[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let c=0;for(let f=0;f<a;f++){const v=this.points[f];t[0]*v[0]+t[1]*v[1]+t[2]*v[2]+t[3]>=0&&c++}return c===a?2:c===0?0:1}}function Zu(y,t,a){const c=y-t;return c<0?-c:Math.max(0,c-a)}function Gl(y,t,a,c,f){const v=y-a;let w;return w=v<0?Math.min(-v,1+v-f):v>1?Math.min(Math.max(v-f,0),1-v):0,Math.max(w,Zu(t,c,f))}class td{constructor(){this._boundingVolumeCache=new Wp(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,c,f){const v=1<<c.z,w=1/v,E=c.x/v,D=c.y/v;let R=2;return R=Math.min(R,Gl(t,a,E,D,w)),R=Math.min(R,Gl(t,a,E+.5,-D-w,w)),R=Math.min(R,Gl(t,a,E+.5,2-D-w,w)),R}getWrap(t,a,c){const f=1<<a.z,v=1/f,w=a.x/f,E=Zu(t.x,w,v),D=Zu(t.x,w-1,v),R=Zu(t.x,w+1,v),O=Math.min(E,D,R);return O===R?1:O===D?-1:0}allowVariableZoom(t,a){return Sn(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,c,f){return this._boundingVolumeCache.getTileBoundingVolume(t,a,c,f)}_computeTileBoundingVolume(t,a,c,f){var v,w;let E=0,D=0;if(f?.terrain){const R=new l.a2(t.z,a,t.z,t.x,t.y),O=f.terrain.getMinMaxElevation(R);E=(v=O.minElevation)!==null&&v!==void 0?v:Math.min(0,c),D=(w=O.maxElevation)!==null&&w!==void 0?w:Math.max(0,c)}if(E/=l.bE,D/=l.bE,E+=1,D+=1,t.z<=0)return ql.fromAabb([-D,-D,-D],[D,D,D]);if(t.z===1)return ql.fromAabb([t.x===0?-D:0,t.y===0?0:-D,-D],[t.x===0?0:D,t.y===0?D:0,D]);{const R=[gs(0,0,t.x,t.y,t.z),gs(l.a5,0,t.x,t.y,t.z),gs(l.a5,l.a5,t.x,t.y,t.z),gs(0,l.a5,t.x,t.y,t.z)],O=[];for(const Ue of R)O.push(l.a$([],Ue,D));if(D!==E)for(const Ue of R)O.push(l.a$([],Ue,E));t.y===0&&O.push([0,1,0]),t.y===(1<<t.z)-1&&O.push([0,-1,0]);const U=[1,1,1],j=[-1,-1,-1];for(const Ue of O)for(let Ve=0;Ve<3;Ve++)U[Ve]=Math.min(U[Ve],Ue[Ve]),j[Ve]=Math.max(j[Ve],Ue[Ve]);const Z=gs(l.a5/2,l.a5/2,t.x,t.y,t.z),W=l.b4([],[0,1,0],Z);l.b3(W,W);const se=l.b4([],Z,W);l.b3(se,se);const le=l.b4([],R[2],R[1]);l.b3(le,le);const oe=l.b4([],R[0],R[3]);l.b3(oe,oe),O.push(l.a$([],Z,D)),t.y>=(1<<t.z)/2&&O.push(l.a$([],gs(l.a5/2,0,t.x,t.y,t.z),D)),t.y<(1<<t.z)/2&&O.push(l.a$([],gs(l.a5/2,l.a5,t.x,t.y,t.z),D));const ue=qc(Z,O),xe=qc(se,O),ce=[-Z[0],-Z[1],-Z[2],ue.max],_e=[Z[0],Z[1],Z[2],-ue.min],Se=[-se[0],-se[1],-se[2],xe.max],me=[se[0],se[1],se[2],-xe.min],Ce=[...le,0],qe=[...oe,0],Fe=[];return t.y===0?Fe.push(l.bD(qe,Ce,ce),l.bD(qe,Ce,_e)):Fe.push(l.bD(Se,Ce,ce),l.bD(Se,Ce,_e),l.bD(Se,qe,ce),l.bD(Se,qe,_e)),t.y===(1<<t.z)-1?Fe.push(l.bD(qe,Ce,ce),l.bD(qe,Ce,_e)):Fe.push(l.bD(me,Ce,ce),l.bD(me,Ce,_e),l.bD(me,qe,ce),l.bD(me,qe,_e)),new ql(Fe,[ce,_e,Se,me,Ce,qe],U,j)}}}function qc(y,t){let a=1/0,c=-1/0;for(const f of t){const v=l.b5(y,f);a=Math.min(a,v),c=Math.max(c,v)}return{min:a,max:c}}class Zl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=l.bF(),this._projectionMatrix=l.bj(),this._globeViewProjMatrix32f=l.bi(),this._globeViewProjMatrixNoCorrection=l.bj(),this._globeViewProjMatrixNoCorrectionInverted=l.bj(),this._globeProjMatrixInverted=l.bj(),this._cameraPosition=l.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{const f=l.an(a.lat,-l.ao,l.ao),v=l.an(+c,this.minZoom+Mi(0,f),this.maxZoom);return{center:new l.V(a.lng,f),zoom:v}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new td}clone(){const t=new Zl;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=l.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:c}=t,f=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,c=this.cameraToCenterDistance/t,f=Math.sin(a)*c,v=Math.cos(a)*c+1,w=1/Math.sqrt(f*f+v*v)*1;let E=-f,D=v;const R=Math.sqrt(E*E+D*D);E/=R,D/=R;const O=[0,E,D];l.bG(O,O,[0,0,0],-this.bearingInRadians),l.bH(O,O,[0,0,0],-1*this.center.lat*Math.PI/180),l.bI(O,O,[0,0,0],this.center.lng*Math.PI/180);const U=1/l.b7(O);return l.a$(O,O,U),[...O,-w*U]}isLocationOccluded(t){return!this.isSurfacePointVisible(fi(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,f=Math.cos(c),v=[Math.sin(a)*f,Math.sin(c),Math.cos(a)*f],w=[v[2],0,-v[0]],E=[0,0,0];l.b4(E,w,v),l.b3(w,w),l.b3(E,E);const D=[0,0,0];return l.b3(D,[w[0]*t[0]+E[0]*t[1]+v[0]*t[2],w[1]*t[0]+E[1]*t[1]+v[1]*t[2],w[2]*t[0]+E[2]*t[1]+v[2]*t[2]]),D}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,c){const f=(function(E,D,R){const O=1/(1<<R.z);return new l.a9(E/l.a5*O+R.x*O,D/l.a5*O+R.y*O)})(t,a,c.canonical),v=(w=f.y,[l.by(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(v[1])}projectTileCoordinates(t,a,c,f){const v=c.canonical,w=gs(t,a,v.x,v.y,v.z),E=1+(f?f(t,a):0)/l.bE,D=[w[0]*E,w[1]*E,w[2]*E,1];l.aH(D,D,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,O=R[0]*w[0]+R[1]*w[1]+R[2]*w[2]+R[3]<0;return{point:new l.P(D[0]/D[3],D[1]/D[3]),signedDistanceFromCamera:D[3],isOccluded:O}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Jo(this.worldSize,this.center.lat),a=l.bk(),c=l.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),l.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;a[8]=2*-f.x/this._helper._width,a[9]=2*f.y/this._helper._height,this._projectionMatrix=l.bf(a),this._globeProjMatrixInverted=l.bk(),l.aB(this._globeProjMatrixInverted,a),l.O(a,a,[0,0,-this.cameraToCenterDistance]),l.bg(a,a,this.rollInRadians),l.bh(a,a,-this.pitchInRadians),l.bg(a,a,this.bearingInRadians),l.O(a,a,[0,0,-t]);const v=l.bz();v[0]=t,v[1]=t,v[2]=t,l.bh(c,a,this.center.lat*Math.PI/180),l.bJ(c,c,-this.center.lng*Math.PI/180),l.Q(c,c,v),this._globeViewProjMatrixNoCorrection=c,l.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bJ(a,a,-this.center.lng*Math.PI/180),l.Q(a,a,v),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=l.bk(),l.aB(this._globeViewProjMatrixNoCorrectionInverted,c);const w=l.bz();this._cameraPosition=l.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,l.bG(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),l.bH(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),l.bG(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),l.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bH(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),l.bI(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const E=l.bf(this._globeViewProjMatrixNoCorrectionInverted);l.Q(E,E,[1,1,-1]),this._cachedFrustum=Lr.fromInvProjectionMatrix(E,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){l.w("calculateFogMatrix is not supported on globe projection.");const a=l.bk();return l.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new l.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=fi(t);l.a$(c,c,1+a/l.bE);const f=l.bF();return l.aH(f,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,c=[new l.P(0,0),new l.P(t,0),new l.P(this.width,0),new l.P(this.width,a),new l.P(this.width,this.height),new l.P(t,this.height),new l.P(0,this.height),new l.P(0,a)],f=[];for(const U of c)f.push(this.unprojectScreenPoint(U));let v=0,w=0,E=0,D=0;const R=this.center;for(const U of f){const j=l.bK(R.lng,U.lng),Z=l.bK(R.lat,U.lat);j<w&&(w=j),j>v&&(v=j),Z<D&&(D=Z),Z>E&&(E=Z)}const O=[R.lng+w,R.lat+D,R.lng+v,R.lat+E];return this.isSurfacePointOnScreen([0,1,0])&&(O[3]=90,O[0]=-180,O[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(O[1]=-90,O[0]=-180,O[2]=180),new Yn(O)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){const c=fi(this.unprojectScreenPoint(a)),f=fi(t),v=l.bz();l.bL(v);const w=l.bz();l.bI(w,c,v,-this.center.lng*Math.PI/180),l.bH(w,w,v,this.center.lat*Math.PI/180);const E=f[0]*f[0]+f[2]*f[2],D=w[0]*w[0];if(E<D)return;const R=Math.sqrt(E-D),O=-R,U=l.bM(f[0],f[2],w[0],R),j=l.bM(f[0],f[2],w[0],O),Z=l.bz();l.bI(Z,f,v,-U);const W=l.bM(Z[1],Z[2],w[1],w[2]),se=l.bz();l.bI(se,f,v,-j);const le=l.bM(se[1],se[2],w[1],w[2]),oe=.5*Math.PI,ue=W>=-oe&&W<=oe,xe=le>=-oe&&le<=oe;let ce,_e;if(ue&&xe){const qe=this.center.lng*Math.PI/180,Fe=this.center.lat*Math.PI/180;l.bN(U,qe)+l.bN(W,Fe)<l.bN(j,qe)+l.bN(le,Fe)?(ce=U,_e=W):(ce=j,_e=le)}else if(ue)ce=U,_e=W;else{if(!xe)return;ce=j,_e=le}const Se=ce/Math.PI*180,me=_e/Math.PI*180,Ce=this.center.lat;this.setCenter(new l.V(Se,l.an(me,-90,90))),this.setZoom(this.zoom+Mi(Ce,this.center.lat))}locationToScreenPoint(t,a){const c=fi(t);if(a){const f=a.getElevationForLngLatZoom(t,this._helper._tileZoom);l.a$(c,c,1+f/l.bE)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new l.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c)return c}return l.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,a){const c=this._cameraPosition,f=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,f)}getRayDirectionFromPixel(t){const a=l.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,l.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const c=l.bz();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];const f=l.bz();return l.b3(f,c),f}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const c=l.b5(t,a),f=l.bz(),v=l.bz();l.a$(v,a,c),l.b2(f,t,v);const w=1-l.b5(f,f);if(w<0)return null;const E=l.b5(t,t)-1,D=-c+(c<0?1:-1)*Math.sqrt(w),R=E/D,O=D;return{tMin:Math.min(R,O),tMax:Math.max(R,O)}}unprojectScreenPoint(t){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(t),f=this.rayPlanetIntersection(a,c);if(f){const O=l.bz();l.b0(O,a,[c[0]*f.tMin,c[1]*f.tMin,c[2]*f.tMin]);const U=l.bz();return l.b3(U,O),Uc(U)}const v=this._cachedClippingPlane,w=v[0]*c[0]+v[1]*c[1]+v[2]*c[2],E=-l.bb(v,a)/w,D=l.bz();if(E>0)l.b0(D,a,[c[0]*E,c[1]*E,c[2]*E]);else{const O=l.bz();l.b0(O,a,[2*c[0],2*c[1],2*c[2]]);const U=l.bb(this._cachedClippingPlane,O);l.b2(D,O,[this._cachedClippingPlane[0]*U,this._cachedClippingPlane[1]*U,this._cachedClippingPlane[2]*U])}const R=(function(O){const U=l.bz();return U[0]=O[0]*-O[3],U[1]=O[1]*-O[3],U[2]=O[2]*-O[3],{center:U,radius:Math.sqrt(1-O[3]*O[3])}})(v);return Uc((function(O,U,j){const Z=l.bz();l.b2(Z,j,O);const W=l.bz();return l.bA(W,O,Z,U/l.b9(Z)),W})(R.center,R.radius,D))}getMatrixForModel(t,a){const c=l.V.convert(t),f=1/l.bE,v=l.bj();return l.bJ(v,v,c.lng/180*Math.PI),l.bh(v,v,-c.lat/180*Math.PI),l.O(v,v,[0,0,1+a/l.bE]),l.bh(v,v,.5*Math.PI),l.Q(v,v,[f,f,f]),v}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new l.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class Hl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._globeness=1,this._mercatorTransform=new Hi,this._verticalPerspectiveTransform=new Zl}clone(){const t=new Hl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return l.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,c){const f=this._mercatorTransform.getPitchedTextCorrection(t,a,c),v=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,c);return l.bu(f,v,this._globeness)}projectTileCoordinates(t,a,c,f){return this.currentTransform.projectTileCoordinates(t,a,c,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class ki{get useGlobeControls(){return!0}handlePanInertia(t,a){const c=Tf(t,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const c=t.around,f=a.screenPointToLocation(c);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const v=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const w=a.zoom-v;if(w===0)return;const E=l.bK(a.center.lng,f.lng),D=E/(Math.abs(E/180)+1),R=l.bK(a.center.lat,f.lat),O=a.getRayDirectionFromPixel(c),U=a.cameraPosition,j=-1*l.b5(U,O),Z=l.bz();l.b0(Z,U,[O[0]*j,O[1]*j,O[2]*j]);const W=l.b7(Z)-1,se=Math.exp(.5*-Math.max(W-.3,0)),le=Jo(a.worldSize,a.center.lat)/Math.min(a.width,a.height),oe=l.bx(le,.9,.5,1,.25),ue=(1-l.aq(-w))*Math.min(se,oe),xe=a.center.lat,ce=a.zoom,_e=new l.V(a.center.lng+D*ue,l.an(a.center.lat+R*ue,-l.ao,l.ao));a.setLocationAtPoint(f,c);const Se=a.center,me=l.bx(Math.abs(E),45,85,0,1),Ce=l.bx(le,.75,.35,0,1),qe=Math.pow(Math.max(me,Ce),.25),Fe=l.bK(Se.lng,_e.lng),Ue=l.bK(Se.lat,_e.lat);a.setCenter(new l.V(Se.lng+Fe*qe,Se.lat+Ue*qe).wrap()),a.setZoom(ce+Mi(xe,a.center.lat))}handleMapControlsPan(t,a,c){if(!t.panDelta)return;const f=a.center.lat,v=a.zoom;a.setCenter(Tf(t.panDelta,a).wrap()),a.setZoom(v+Mi(f,a.center.lat))}cameraForBoxAndBearing(t,a,c,f,v){const w=Ko(t,a,c,f,v),E=a.left/v.width*2-1,D=(v.width-a.right)/v.width*2-1,R=a.top/v.height*-2+1,O=(v.height-a.bottom)/v.height*-2+1,U=l.bK(c.getWest(),c.getEast())<0,j=U?c.getEast():c.getWest(),Z=U?c.getWest():c.getEast(),W=Math.max(c.getNorth(),c.getSouth()),se=Math.min(c.getNorth(),c.getSouth()),le=j+.5*l.bK(j,Z),oe=W+.5*l.bK(W,se),ue=v.clone();ue.setCenter(w.center),ue.setBearing(w.bearing),ue.setPitch(0),ue.setRoll(0),ue.setZoom(w.zoom);const xe=ue.modelViewProjectionMatrix,ce=[fi(c.getNorthWest()),fi(c.getNorthEast()),fi(c.getSouthWest()),fi(c.getSouthEast()),fi(new l.V(Z,oe)),fi(new l.V(j,oe)),fi(new l.V(le,W)),fi(new l.V(le,se))],_e=fi(w.center);let Se=Number.POSITIVE_INFINITY;for(const me of ce)E<0&&(Se=ki.getLesserNonNegativeNonNull(Se,ki.solveVectorScale(me,_e,xe,"x",E))),D>0&&(Se=ki.getLesserNonNegativeNonNull(Se,ki.solveVectorScale(me,_e,xe,"x",D))),R>0&&(Se=ki.getLesserNonNegativeNonNull(Se,ki.solveVectorScale(me,_e,xe,"y",R))),O<0&&(Se=ki.getLesserNonNegativeNonNull(Se,ki.solveVectorScale(me,_e,xe,"y",O)));if(Number.isFinite(Se)&&Se!==0)return w.zoom=ue.zoom+l.at(Se),w;Or()}handleJumpToCenterZoom(t,a){const c=t.center.lat,f=t.applyConstrain(a.center?l.V.convert(a.center):t.center,t.zoom).center;t.setCenter(f.wrap());const v=a.zoom!==void 0?+a.zoom:t.zoom+Mi(c,f.lat);t.zoom!==v&&t.setZoom(v)}handleEaseTo(t,a){const c=t.zoom,f=t.center,v=t.padding,w={roll:t.roll,pitch:t.pitch,bearing:t.bearing},E={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},D=a.zoom!==void 0,R=!t.isPaddingEqual(a.padding);let O=!1;const U=a.center?l.V.convert(a.center):f,j=t.applyConstrain(U,c).center;ms(t,j);const Z=t.clone();Z.setCenter(j),Z.setZoom(D?+a.zoom:c+Mi(f.lat,U.lat)),Z.setBearing(a.bearing);const W=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));Z.setLocationAtPoint(j,W);const se=(a.offset&&a.offsetAsPoint.mag())>0?Z.center:j,le=D?+a.zoom:c+Mi(f.lat,se.lat),oe=c+Mi(f.lat,0),ue=le+Mi(se.lat,0),xe=l.bK(f.lng,se.lng),ce=l.bK(f.lat,se.lat),_e=l.aq(ue-oe);return O=le!==c,{easeFunc:Se=>{if(l.bo(w,E)||Nc({startEulerAngles:w,endEulerAngles:E,tr:t,k:Se,useSlerp:w.roll!=E.roll}),R&&t.interpolatePadding(v,a.padding,Se),a.around)l.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const me=ue>oe?Math.min(2,_e):Math.max(.5,_e),Ce=Math.pow(me,1-Se),qe=Sf(f,xe,ce,Se*Ce);t.setCenter(qe.wrap())}if(O){const me=l.G.number(oe,ue,Se)+Mi(0,t.center.lat);t.setZoom(me)}},isZooming:O,elevationCenter:se}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.center,v=t.zoom,w=t.padding,E=!t.isPaddingEqual(a.padding),D=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),v).center,R=c?+a.zoom:t.zoom+Mi(t.center.lat,D.lat),O=t.clone();O.setCenter(D),O.setZoom(R),O.setBearing(a.bearing);const U=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));O.setLocationAtPoint(D,U);const j=O.center;ms(t,j);const Z=(function(ce,_e,Se){const me=fi(_e),Ce=fi(Se),qe=l.b5(me,Ce),Fe=Math.acos(qe),Ue=Br(ce);return Fe/(2*Math.PI)*Ue})(t,f,j),W=v+Mi(f.lat,0),se=R+Mi(j.lat,0),le=l.aq(se-W);let oe;if(typeof a.minZoom=="number"){const ce=+a.minZoom+Mi(j.lat,0),_e=Math.min(ce,W,se)+Mi(0,j.lat),Se=t.applyConstrain(j,_e).zoom+Mi(j.lat,0);oe=l.aq(Se-W)}const ue=l.bK(f.lng,j.lng),xe=l.bK(f.lat,j.lat);return{easeFunc:(ce,_e,Se,me)=>{const Ce=Sf(f,ue,xe,Se);E&&t.interpolatePadding(w,a.padding,ce);const qe=ce===1?j:Ce;t.setCenter(qe.wrap());const Fe=W+l.at(_e);t.setZoom(ce===1?R:Fe+Mi(0,qe.lat))},scaleOfZoom:le,targetCenter:j,scaleOfMinZoom:oe,pixelPathLength:Z}}static solveVectorScale(t,a,c,f,v){const w=f==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],E=[c[3],c[7],c[11],c[15]],D=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],R=t[0]*E[0]+t[1]*E[1]+t[2]*E[2],O=a[0]*w[0]+a[1]*w[1]+a[2]*w[2],U=a[0]*E[0]+a[1]*E[1]+a[2]*E[2];return O+v*R===D+v*U||E[3]*(D-O)+w[3]*(U-R)+D*U==O*R?null:(O+w[3]-v*U-v*E[3])/(O-D-v*U+v*R)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class $l{constructor(t){this._globe=t,this._mercatorCameraHelper=new Wo,this._verticalPerspectiveCameraHelper=new ki}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,c){this.currentHelper.handleMapControlsPan(t,a,c)}cameraForBoxAndBearing(t,a,c,f,v){return this.currentHelper.cameraForBoxAndBearing(t,a,c,f,v)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const Xl=(y,t)=>l.B(y,t&&t.filter((a=>a.identifier!=="source.canvas"))),Yl=l.bO();class _o extends l.E{constructor(t,a={}){var c,f;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const E=this.tileManagers[w].getSource().type;E!=="vector"&&E!=="geojson"||this.tileManagers[w].reload()}},this.map=t,this.dispatcher=new on(Yt(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((w,E)=>this.getGlyphs(w,E))),this.dispatcher.registerMessageHandler("GI",((w,E)=>this.getImages(w,E))),this.dispatcher.registerMessageHandler("GDA",((w,E)=>this.getDashes(w,E))),this.imageManager=new Tt,this.imageManager.setEventedParent(this);const v=((c=t._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new He(t._requestManager,a.localIdeographFontFamily,v),this.lineAtlas=new vt(256,512),this.crossTileSymbolIndex=new Ji,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",l.bP()),ke().on(de,this._rtlPluginLoaded),this.on("data",(w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const E=this.tileManagers[w.sourceId];if(!E)return;const D=E.getSource();if(D&&D.vectorLayerIds)for(const R in this._layers){const O=this._layers[R];O.source===D.id&&this._validateLayer(O)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new l.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var c,f,v;this._checkLoaded();const w=a===null?(v=(f=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||f===void 0?void 0:f.default)!==null&&v!==void 0?v:null:a;if(l.bR(w,this._globalState[t]))return this;this._globalState[t]=w,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const c in t)!l.bR(this._globalState[c],t[c].default)&&(a.push(c),this._globalState[c]=t[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,c={};for(const f of t){c[f]=this._globalState[f];for(const v in this._layers){const w=this._layers[v],E=w.getLayoutAffectingGlobalStateRefs(),D=w.getPaintAffectingGlobalStateRefs(),R=w.getVisibilityAffectingGlobalStateRefs();if(E.has(f)&&a.add(w.source),D.has(f))for(const{name:O,value:U}of D.get(f))this._updatePaintProperty(w,O,U);R?.has(f)&&(w.recalculateVisibility(),this._updateLayer(w))}}this.dispatcher.broadcast("UGS",c);for(const f in this.tileManagers)a.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;l.j(f,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,a,c)})).catch((w=>{this._loadStyleRequest=null,w&&!v.signal.aborted&&this.fire(new l.k(w))}))}loadJSON(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ae.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(Yl,{validate:!1})}_load(t,a,c){var f,v;let w=a.transformStyle?a.transformStyle(c,t):t;if(!a.validate||!Xl(this,l.C(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const E in w.sources)this.addSource(E,w.sources[E],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Ft(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new $e(this.stylesheet.sky),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var t,a,c;const f=l.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",f),this._order=f.map((v=>v.id)),this._layers={},this._serializedLayers=null;for(const v of f){const w=l.bT(v,this._globalState);if(w.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=w,l.bU(w)&&this.tileManagers[w.source]){const E=(c=(a=v.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(E)}}}_loadSprite(t,a=!1,c=void 0){this.imageManager.setLoaded(!1);const f=new AbortController;let v;this._spriteRequest=f,(function(w,E,D,R){return l._(this,void 0,void 0,(function*(){const O=st(w),U=D>1?"@2x":"",j={},Z={};for(const{id:W,url:se}of O){const le=E.transformRequest(tt(se,U,".json"),"SpriteJSON");j[W]=l.j(le,R);const oe=E.transformRequest(tt(se,U,".png"),"SpriteImage");Z[W]=at.getImage(oe,R)}return yield Promise.all([...Object.values(j),...Object.values(Z)]),(function(W,se){return l._(this,void 0,void 0,(function*(){const le={};for(const oe in W){le[oe]={};const ue=Ae.getImageCanvasContext((yield se[oe]).data),xe=(yield W[oe]).data;for(const ce in xe){const{width:_e,height:Se,x:me,y:Ce,sdf:qe,pixelRatio:Fe,stretchX:Ue,stretchY:Ve,content:wt,textFitWidth:St,textFitHeight:dt}=xe[ce];le[oe][ce]={data:null,pixelRatio:Fe,sdf:qe,stretchX:Ue,stretchY:Ve,content:wt,textFitWidth:St,textFitHeight:dt,spriteData:{width:_e,height:Se,x:me,y:Ce,context:ue}}}}return le}))})(j,Z)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const E in w){this._spritesImagesIds[E]=[];const D=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter((R=>!(R in w))):[];for(const R of D)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in w[E]){const O=E==="default"?R:`${E}:${R}`;this._spritesImagesIds[E].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,w[E][R],!1):this.imageManager.addImage(O,w[E][R]),a&&(this._changedImages[O]=!0)}}})).catch((w=>{this._spriteRequest=null,v=w,f.signal.aborted||this.fire(new l.k(v))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),c&&c(v)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const c=t.sourceLayer;if(!c)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.k(new Error(`Source layer "${c}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?l.bV(c):c);const f=[];for(const v of t)if(c[v]){const w=a?l.bV(c[v]):c[v];f.push(w)}return f}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const f=this._layers[c];f.type!=="custom"&&(t[c]=f.serialize())}return t}hasTransitions(){var t,a,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const f=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(f.length||v.length)&&this._updateWorkerLayers(f,v);for(const w in this._updatedSources){const E=this._updatedSources[w];if(E==="reload")this._reloadSource(w);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const f in this.tileManagers){const v=this.tileManagers[f];c[f]=v.used,v.used=!1}for(const f of this._order){const v=this._layers[f];v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)&&v.source&&(this.tileManagers[v.source].used=!0)}for(const f in c){const v=this.tileManagers[f];!!c[f]!=!!v.used&&v.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var c;this._checkLoaded();const f=this.serialize();if(t=a.transformStyle?a.transformStyle(f,t):t,((c=a.validate)===null||c===void 0||c)&&Xl(this,l.C(t)))return!1;(t=l.bV(t)).layers=l.bS(t.layers);const v=l.bW(f,t),w=this._getOperationsToPerform(v);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const E of w.operations)E();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],c=[];for(const f of t)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(f.command)}return{operations:a,unimplemented:c}}addImage(t,a){if(this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,c={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.C.source,`sources.${t}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.tileManagers[t]=new ni(t,a,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:t}))),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new l.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.tileManagers[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,c={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new l.k(new Error(`Layer "${f}" already exists on this map.`)));let v;if(t.type==="custom"){if(Xl(this,l.bX(t)))return;v=l.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(f,t.source),t=l.bV(t),t=l.e(t,{source:f})),this._validate(l.C.layer,`layers.${f}`,t,{arrayIndex:-1},c))return;v=l.bT(t,this._globalState),this._validateLayer(v),v.setEventedParent(this,{layer:{id:f}})}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)this.fire(new l.k(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(w,0,f),this._layerOrderChanged=!0,this._layers[f]=v,this._removedLayers[f]&&v.source&&v.type!=="custom"){const E=this._removedLayers[f];delete this._removedLayers[f],E.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.tileManagers[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const c=this._order.indexOf(t);this._order.splice(c,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new l.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,c){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===a&&f.maxzoom===c||(a!=null&&(f.minzoom=a),c!=null&&(f.maxzoom=c),this._updateLayer(f)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,c={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!l.bR(f.filter,a))return a==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(l.C.filter,`layers.${f.id}.filter`,a,null,c)||(f.setFilter(l.bV(a)),this._updateLayer(f)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,c,f={}){this._checkLoaded();const v=this.getLayer(t);v?l.bR(v.getLayoutProperty(a),c)||(v.setLayoutProperty(a,c,f),this._updateLayer(v)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const c=this.getLayer(t);if(c)return c.getLayoutProperty(a);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,c,f={}){this._checkLoaded();const v=this.getLayer(t);v?l.bR(v.getPaintProperty(a),c)||this._updatePaintProperty(v,a,c,f):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,c,f={}){t.setPaintProperty(a,c,f)&&this._updateLayer(t),l.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const c=t.source,f=t.sourceLayer,v=this.tileManagers[c];if(v===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&f?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||f?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),v.setFeatureState(f,t.id,a)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const c=t.source,f=this.tileManagers[c];if(f===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const v=f.getSource().type,w=v==="vector"?t.sourceLayer:void 0;v!=="vector"||w?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(w,t.id,a):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,c=t.sourceLayer,f=this.tileManagers[a];if(f!==void 0)return f.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(c,t.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.bY(this.tileManagers,(v=>v.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,f=this.stylesheet;return l.bZ({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:t,layers:a,terrain:c},(v=>v!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=w=>this._layers[w].type==="fill-extrusion",c={},f=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E)){c[E]=w;for(const D of t){const R=D[E];if(R)for(const O of R)f.push(O)}}}f.sort(((w,E)=>E.intersectionZ-w.intersectionZ));const v=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E))for(let D=f.length-1;D>=0;D--){const R=f[D].feature;if(c[R.layer.id]<w)break;v.push(R),f.pop()}else for(const D of t){const R=D[E];if(R)for(const O of R)v.push(O.feature)}}return v}queryRenderedFeatures(t,a,c){a&&a.filter&&this._validate(l.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of a.layers){const O=this._layers[R];if(!O)return this.fire(new l.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];f[O.source]=!0}}const v=[];a.availableImages=this._availableImages;const w=this._serializedAllLayers(),E=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,D=Object.assign(Object.assign({},a),{layers:E,globalState:this._globalState});for(const R in this.tileManagers)a.layers&&!f[R]||v.push(Ki(this.tileManagers[R],this._layers,w,t,D,c,this.map.terrain?(O,U,j)=>this.map.terrain.getElevation(O,U,j):void 0));return this.placement&&v.push((function(R,O,U,j,Z,W,se){const le={},oe=W.queryRenderedSymbols(j),ue=[];for(const xe of Object.keys(oe).map(Number))ue.push(se[xe]);ue.sort(zn);for(const xe of ue){const ce=xe.featureIndex.lookupSymbolFeatures(oe[xe.bucketInstanceId],O,xe.bucketIndex,xe.sourceLayerIndex,{filterSpec:Z.filter,globalState:Z.globalState},Z.layers,Z.availableImages,R);for(const _e in ce){const Se=le[_e]=le[_e]||[],me=ce[_e];me.sort(((Ce,qe)=>{const Fe=xe.featureSortOrder;if(Fe){const Ue=Fe.indexOf(Ce.featureIndex);return Fe.indexOf(qe.featureIndex)-Ue}return qe.featureIndex-Ce.featureIndex}));for(const Ce of me)Se.push(Ce)}}return(function(xe,ce,_e){for(const Se in xe)for(const me of xe[Se])wi(me,_e[ce[Se].source]);return xe})(le,R,U)})(this._layers,w,this.tileManagers,t,D,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,a){a?.filter&&this._validate(l.C.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.tileManagers[t];return c?(function(f,v){const w=f.getRenderableIds().map((R=>f.getTileByID(R))),E=[],D={};for(let R=0;R<w.length;R++){const O=w[R],U=O.tileID.canonical.key;D[U]||(D[U]=!0,O.querySourceFeatures(E,v))}return E})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const c=this.light.getLight();let f=!1;for(const w in t)if(!l.bR(t[w],c[w])){f=!0;break}if(!f)return;const v={now:pe(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(v)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const c=this.getSky();let f=!1;if(!t&&!c)return;if(t&&!c)f=!0;else if(!t&&c)f=!0;else for(const w in t)if(!l.bR(t[w],c[w])){f=!0;break}if(!f)return;const v={now:pe(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(v)}_setProjectionInternal(t){const a=(function(c,f){const v={constrainOverride:f};if(Array.isArray(c)){const w=new ed({type:c});return{projection:w,transform:new Hl(v),cameraHelper:new $l(w)}}switch(c){case"mercator":return{projection:new er,transform:new Hi(v),cameraHelper:new Wo};case"globe":{const w=new ed({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new Hl(v),cameraHelper:new $l(w)}}case"vertical-perspective":return{projection:new Jh,transform:new Zl(v),cameraHelper:new ki};default:return l.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new er,transform:new Hi(v),cameraHelper:new Wo}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(t,a,c,f,v={}){return(!v||v.validate!==!1)&&Xl(this,t.call(l.C,l.e({key:a,style:this.serialize(),value:c,styleSpec:l.u},f)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ke().off(de,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,c,f,v=!1){let w=!1,E=!1;const D={};for(const R of this._order){const O=this._layers[R];if(O.type!=="symbol")continue;if(!D[O.source]){const j=this.tileManagers[O.source];D[O.source]=j.getRenderableIds(!0).map((Z=>j.getTileByID(Z))).sort(((Z,W)=>W.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(W.tileID)?-1:1)))}const U=this.crossTileSymbolIndex.addLayer(O,D[O.source],t.center.lng);w=w||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(pe(),t.zoom))&&(this.pauseablePlacement=new Vl(t,this.map.terrain,this._order,v,a,c,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(pe()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w)for(const R of this._order){const O=this._layers[R];O.type==="symbol"&&this.placement.updateLayerOpacities(O,D[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(pe())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(a.stacks),f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(l.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return l._(this,void 0,void 0,(function*(){const c={};for(const[f,v]of Object.entries(a.dashes))c[f]=this.lineAtlas.getDash(v.dasharray,v.round);return c}))}addSprite(t,a,c={},f){this._checkLoaded();const v=[{id:t,url:a}],w=[...st(this.stylesheet.sprite),...v];this._validate(l.C.sprite,"sprite",w,null,c)||(this.stylesheet.sprite=w,this._loadSprite(v,!0,f))}removeSprite(t){this._checkLoaded();const a=st(this.stylesheet.sprite);if(a.find((c=>c.id===t))){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return st(this.stylesheet.sprite)}setSprite(t,a={},c){this._checkLoaded(),t&&this._validate(l.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Ef=l.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Gc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,c,f,v,w,E,D,R){this.context=t;let O=this.boundPaintVertexBuffers.length!==f.length;for(let U=0;!O&&U<f.length;U++)this.boundPaintVertexBuffers[U]!==f[U]&&(O=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||O||this.boundIndexBuffer!==v||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==R?this.freshBind(a,c,f,v,w,E,D,R):(t.bindVertexArray.set(this.vao),E&&E.bind(),v&&v.dynamicDraw&&v.bind(),D&&D.bind(),R&&R.bind())}freshBind(t,a,c,f,v,w,E,D){const R=t.numAttributes,O=this.context,U=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=D,a.enableAttributes(U,t);for(const j of c)j.enableAttributes(U,t);w&&w.enableAttributes(U,t),E&&E.enableAttributes(U,t),D&&D.enableAttributes(U,t),a.bind(),a.setVertexAttribPointers(U,t,v);for(const j of c)j.bind(),j.setVertexAttribPointers(U,t,v);w&&(w.bind(),w.setVertexAttribPointers(U,t,v)),f&&f.bind(),E&&(E.bind(),E.setVertexAttribPointers(U,t,v)),D&&(D.bind(),D.setVertexAttribPointers(U,t,v)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Mf=(y,t,a,c,f)=>({u_texture:0,u_ele_delta:y,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):l.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):l.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),$a={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Hu(y){const t=[];for(let a=0;a<y.length;a++){if(y[a]===null)continue;const c=y[a].split(" ");t.push(c.pop())}return t}class Af{constructor(t,a,c,f,v,w,E,D,R=[]){const O=t.gl;this.program=O.createProgram();const U=Hu(a.staticAttributes),j=c?c.getBinderAttributes():[],Z=U.concat(j),W=hi.prelude.staticUniforms?Hu(hi.prelude.staticUniforms):[],se=E.staticUniforms?Hu(E.staticUniforms):[],le=a.staticUniforms?Hu(a.staticUniforms):[],oe=c?c.getBinderUniforms():[],ue=W.concat(se).concat(le).concat(oe),xe=[];for(const Fe of ue)xe.indexOf(Fe)<0&&xe.push(Fe);const ce=c?c.defines():[];Sa(O)&&ce.unshift("#version 300 es"),v&&ce.push("#define OVERDRAW_INSPECTOR;"),w&&ce.push("#define TERRAIN3D;"),D&&ce.push(D),R&&ce.push(...R);let _e=ce.concat(hi.prelude.fragmentSource,E.fragmentSource,a.fragmentSource).join(`
`),Se=ce.concat(hi.prelude.vertexSource,E.vertexSource,a.vertexSource).join(`
`);Sa(O)||(_e=(function(Fe){return Fe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(_e),Se=(function(Fe){return Fe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Se));const me=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(me,_e),O.compileShader(me),!O.getShaderParameter(me,O.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${O.getShaderInfoLog(me)}`);O.attachShader(this.program,me);const Ce=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(Ce,Se),O.compileShader(Ce),!O.getShaderParameter(Ce,O.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${O.getShaderInfoLog(Ce)}`);O.attachShader(this.program,Ce),this.attributes={};const qe={};this.numAttributes=Z.length;for(let Fe=0;Fe<this.numAttributes;Fe++)Z[Fe]&&(O.bindAttribLocation(this.program,Fe,Z[Fe]),this.attributes[Z[Fe]]=Fe);if(O.linkProgram(this.program),!O.getProgramParameter(this.program,O.LINK_STATUS))throw new Error(`Program failed to link: ${O.getProgramInfoLog(this.program)}`);O.deleteShader(Ce),O.deleteShader(me);for(let Fe=0;Fe<xe.length;Fe++){const Ue=xe[Fe];if(Ue&&!qe[Ue]){const Ve=O.getUniformLocation(this.program,Ue);Ve&&(qe[Ue]=Ve)}}this.fixedUniforms=f(t,qe),this.terrainUniforms=((Fe,Ue)=>({u_depth:new l.b_(Fe,Ue.u_depth),u_terrain:new l.b_(Fe,Ue.u_terrain),u_terrain_dim:new l.bq(Fe,Ue.u_terrain_dim),u_terrain_matrix:new l.c0(Fe,Ue.u_terrain_matrix),u_terrain_unpack:new l.c1(Fe,Ue.u_terrain_unpack),u_terrain_exaggeration:new l.bq(Fe,Ue.u_terrain_exaggeration)}))(t,qe),this.projectionUniforms=((Fe,Ue)=>({u_projection_matrix:new l.c0(Fe,Ue.u_projection_matrix),u_projection_tile_mercator_coords:new l.c1(Fe,Ue.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.c1(Fe,Ue.u_projection_clipping_plane),u_projection_transition:new l.bq(Fe,Ue.u_projection_transition),u_projection_fallback_matrix:new l.c0(Fe,Ue.u_projection_fallback_matrix)}))(t,qe),this.binderUniforms=c?c.getUniforms(t,qe):[]}draw(t,a,c,f,v,w,E,D,R,O,U,j,Z,W,se,le,oe,ue,xe){const ce=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(f),t.setColorMode(v),t.setCullFace(w),D){t.activeTexture.set(ce.TEXTURE2),ce.bindTexture(ce.TEXTURE_2D,D.depthTexture),t.activeTexture.set(ce.TEXTURE3),ce.bindTexture(ce.TEXTURE_2D,D.texture);for(const Se in this.terrainUniforms)this.terrainUniforms[Se].set(D[Se])}if(R)for(const Se in R)this.projectionUniforms[$a[Se]].set(R[Se]);if(E)for(const Se in this.fixedUniforms)this.fixedUniforms[Se].set(E[Se]);le&&le.setUniforms(t,this.binderUniforms,W,{zoom:se});let _e=0;switch(a){case ce.LINES:_e=2;break;case ce.TRIANGLES:_e=3;break;case ce.LINE_STRIP:_e=1}for(const Se of Z.get()){const me=Se.vaos||(Se.vaos={});(me[O]||(me[O]=new Gc)).bind(t,this,U,le?le.getPaintVertexBuffers():[],j,Se.vertexOffset,oe,ue,xe),ce.drawElements(a,Se.primitiveLength*_e,ce.UNSIGNED_SHORT,Se.primitiveOffset*_e*2)}}}function Cf(y,t,a){const c=1/l.aN(a,1,t.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,t.transform.tileZoom)/f,w=v*(a.tileID.canonical.x+a.tileID.wrap*f),E=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[w>>16,E>>16],u_pixel_coord_lower:[65535&w,65535&E]}}const $u=(y,t,a,c)=>{const f=y.style.light,v=f.properties.get("position"),w=[v.x,v.y,v.z],E=l.c4();f.properties.get("anchor")==="viewport"&&l.c5(E,y.transform.bearingInRadians),l.c6(w,w,E);const D=y.transform.transformLightDirection(w),R=f.properties.get("color");return{u_lightpos:w,u_lightpos_globe:D,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:c}},Xu=(y,t,a,c,f,v,w)=>l.e($u(y,t,a,c),Cf(v,y,w),{u_height_factor:-Math.pow(2,f.overscaledZ)/w.tileSize/8}),el=(y,t,a,c)=>l.e(Cf(t,y,a),{u_fill_translate:c}),Kl=(y,t)=>({u_world:y,u_fill_translate:t}),zf=(y,t,a,c,f)=>l.e(el(y,t,a,f),{u_world:c}),Zc=(y,t,a,c,f)=>{const v=y.transform;let w,E,D=0;if(a.paint.get("circle-pitch-alignment")==="map"){const R=l.aN(t,1,v.zoom);w=!0,E=[R,R],D=R/(l.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*f}else w=!1,E=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E,u_globe_extrude_scale:D,u_translate:c}},vo=y=>({u_pixel_extrude_scale:[1/y.width,1/y.height]}),nd=y=>({u_viewport_size:[y.width,y.height]}),Hc=(y,t=1)=>({u_color:y,u_overlay:0,u_overlay_scale:t}),xo=(y,t,a,c)=>{const f=l.aN(y,1,t)/(l.a5*Math.pow(2,y.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:l.aN(y,1,t),u_intensity:a,u_globe_extrude_scale:f}},id=(y,t,a,c)=>{const f=l.N();l.c7(f,0,y.width,y.height,0,0,1);const v=y.context.gl;return{u_matrix:f,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},$c=(y,t,a)=>{const c=a.paint.get("hillshade-accent-color");let f;switch(a.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const v=a.getIlluminationProperties();for(let w=0;w<v.directionRadians.length;w++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(v.directionRadians[w]+=y.transform.bearingInRadians);return{u_image:0,u_latrange:Qp(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:v.altitudeRadians,u_azimuths:v.directionRadians,u_accent:c,u_method:f,u_highlights:v.highlightColor,u_shadows:v.shadowColor}},Df=(y,t)=>{const a=t.stride,c=l.N();return l.c7(c,0,l.a5,-l.a5,0,0,1),l.O(c,c,[0,-l.a5,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:y.overscaledZ,u_unpack:t.getUnpackVector()}};function Qp(y,t){const a=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new l.a9(0,c/a).toLngLat().lat,new l.a9(0,(c+1)/a).toLngLat().lat]}const Pf=(y,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:y.paint.get("color-relief-opacity")}),Xc=(y,t,a,c)=>{const f=y.transform;return{u_translation:Yc(y,t,a),u_ratio:c/l.aN(t,1,f.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},If=(y,t,a,c,f)=>l.e(Xc(y,t,a,c),{u_image:0,u_image_height:f}),rd=(y,t,a,c,f)=>{const v=y.transform,w=Ea(t,v);return{u_translation:Yc(y,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:c/l.aN(t,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[w,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Vr=(y,t,a,c,f)=>{const v=Ea(t,y.transform);return l.e(Xc(y,t,a,c),{u_tileratio:v,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})},bo=(y,t,a,c,f,v)=>{const w=Ea(t,y.transform);return l.e(Xc(y,t,a,c),{u_image:0,u_image_height:v,u_tileratio:w,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})};function Ea(y,t){return 1/l.aN(y,1,t.tileZoom)}function Yc(y,t,a){return l.aO(y.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Yu=(y,t,a,c,f)=>{return{u_tl_parent:y,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(w=c.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=c.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ku(c.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var v,w};function Ku(y){y*=Math.PI/180;const t=Math.sin(y),a=Math.cos(y);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Kc=(y,t,a,c,f,v,w,E,D,R,O,U,j)=>{const Z=w.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:Z.width/Z.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:E,u_coord_matrix:D,u_is_text:+O,u_pitch_with_map:+c,u_is_along_line:f,u_is_variable_anchor:v,u_texsize:U,u_texture:0,u_translation:R,u_pitched_scale:j}},Wu=(y,t,a,c,f,v,w,E,D,R,O,U,j,Z)=>{const W=w.transform;return l.e(Kc(y,t,a,c,f,v,w,E,D,R,O,U,Z),{u_gamma_scale:c?Math.cos(W.pitch*Math.PI/180)*W.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},Ma=(y,t,a,c,f,v,w,E,D,R,O,U,j)=>l.e(Wu(y,t,a,c,f,v,w,E,D,R,!0,O,0,j),{u_texsize_icon:U,u_texture_icon:1}),Wc=(y,t)=>({u_opacity:y,u_color:t}),Qc=(y,t,a,c,f)=>l.e((function(v,w,E,D){const R=E.imageManager.getPattern(v.from.toString()),O=E.imageManager.getPattern(v.to.toString()),{width:U,height:j}=E.imageManager.getPixelSize(),Z=Math.pow(2,D.tileID.overscaledZ),W=D.tileSize*Math.pow(2,E.transform.tileZoom)/Z,se=W*(D.tileID.canonical.x+D.tileID.wrap*Z),le=W*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[U,j],u_mix:w.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/l.aN(D,1,E.transform.tileZoom),u_pixel_coord_upper:[se>>16,le>>16],u_pixel_coord_lower:[65535&se,65535&le]}})(a,f,t,c),{u_opacity:y}),Qu=(y,t)=>{},kf={fillExtrusion:(y,t)=>({u_lightpos:new l.c2(y,t.u_lightpos),u_lightpos_globe:new l.c2(y,t.u_lightpos_globe),u_lightintensity:new l.bq(y,t.u_lightintensity),u_lightcolor:new l.c2(y,t.u_lightcolor),u_vertical_gradient:new l.bq(y,t.u_vertical_gradient),u_opacity:new l.bq(y,t.u_opacity),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillExtrusionPattern:(y,t)=>({u_lightpos:new l.c2(y,t.u_lightpos),u_lightpos_globe:new l.c2(y,t.u_lightpos_globe),u_lightintensity:new l.bq(y,t.u_lightintensity),u_lightcolor:new l.c2(y,t.u_lightcolor),u_vertical_gradient:new l.bq(y,t.u_vertical_gradient),u_height_factor:new l.bq(y,t.u_height_factor),u_opacity:new l.bq(y,t.u_opacity),u_fill_translate:new l.c3(y,t.u_fill_translate),u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade)}),fill:(y,t)=>({u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillPattern:(y,t)=>({u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillOutline:(y,t)=>({u_world:new l.c3(y,t.u_world),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillOutlinePattern:(y,t)=>({u_world:new l.c3(y,t.u_world),u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade),u_fill_translate:new l.c3(y,t.u_fill_translate)}),circle:(y,t)=>({u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_scale_with_map:new l.b_(y,t.u_scale_with_map),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_extrude_scale:new l.c3(y,t.u_extrude_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_globe_extrude_scale:new l.bq(y,t.u_globe_extrude_scale),u_translate:new l.c3(y,t.u_translate)}),collisionBox:(y,t)=>({u_pixel_extrude_scale:new l.c3(y,t.u_pixel_extrude_scale)}),collisionCircle:(y,t)=>({u_viewport_size:new l.c3(y,t.u_viewport_size)}),debug:(y,t)=>({u_color:new l.b$(y,t.u_color),u_overlay:new l.b_(y,t.u_overlay),u_overlay_scale:new l.bq(y,t.u_overlay_scale)}),depth:Qu,clippingMask:Qu,heatmap:(y,t)=>({u_extrude_scale:new l.bq(y,t.u_extrude_scale),u_intensity:new l.bq(y,t.u_intensity),u_globe_extrude_scale:new l.bq(y,t.u_globe_extrude_scale)}),heatmapTexture:(y,t)=>({u_matrix:new l.c0(y,t.u_matrix),u_world:new l.c3(y,t.u_world),u_image:new l.b_(y,t.u_image),u_color_ramp:new l.b_(y,t.u_color_ramp),u_opacity:new l.bq(y,t.u_opacity)}),hillshade:(y,t)=>({u_image:new l.b_(y,t.u_image),u_latrange:new l.c3(y,t.u_latrange),u_exaggeration:new l.bq(y,t.u_exaggeration),u_altitudes:new l.c9(y,t.u_altitudes),u_azimuths:new l.c9(y,t.u_azimuths),u_accent:new l.b$(y,t.u_accent),u_method:new l.b_(y,t.u_method),u_shadows:new l.c8(y,t.u_shadows),u_highlights:new l.c8(y,t.u_highlights)}),hillshadePrepare:(y,t)=>({u_matrix:new l.c0(y,t.u_matrix),u_image:new l.b_(y,t.u_image),u_dimension:new l.c3(y,t.u_dimension),u_zoom:new l.bq(y,t.u_zoom),u_unpack:new l.c1(y,t.u_unpack)}),colorRelief:(y,t)=>({u_image:new l.b_(y,t.u_image),u_unpack:new l.c1(y,t.u_unpack),u_dimension:new l.c3(y,t.u_dimension),u_elevation_stops:new l.b_(y,t.u_elevation_stops),u_color_stops:new l.b_(y,t.u_color_stops),u_color_ramp_size:new l.b_(y,t.u_color_ramp_size),u_opacity:new l.bq(y,t.u_opacity)}),line:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels)}),lineGradient:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_image_height:new l.bq(y,t.u_image_height)}),linePattern:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_texsize:new l.c3(y,t.u_texsize),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_image:new l.b_(y,t.u_image),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade)}),lineSDF:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_mix:new l.bq(y,t.u_mix),u_tileratio:new l.bq(y,t.u_tileratio),u_crossfade_from:new l.bq(y,t.u_crossfade_from),u_crossfade_to:new l.bq(y,t.u_crossfade_to),u_lineatlas_width:new l.bq(y,t.u_lineatlas_width),u_lineatlas_height:new l.bq(y,t.u_lineatlas_height)}),lineGradientSDF:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_image_height:new l.bq(y,t.u_image_height),u_tileratio:new l.bq(y,t.u_tileratio),u_crossfade_from:new l.bq(y,t.u_crossfade_from),u_crossfade_to:new l.bq(y,t.u_crossfade_to),u_image_dash:new l.b_(y,t.u_image_dash),u_mix:new l.bq(y,t.u_mix),u_lineatlas_width:new l.bq(y,t.u_lineatlas_width),u_lineatlas_height:new l.bq(y,t.u_lineatlas_height)}),raster:(y,t)=>({u_tl_parent:new l.c3(y,t.u_tl_parent),u_scale_parent:new l.bq(y,t.u_scale_parent),u_buffer_scale:new l.bq(y,t.u_buffer_scale),u_fade_t:new l.bq(y,t.u_fade_t),u_opacity:new l.bq(y,t.u_opacity),u_image0:new l.b_(y,t.u_image0),u_image1:new l.b_(y,t.u_image1),u_brightness_low:new l.bq(y,t.u_brightness_low),u_brightness_high:new l.bq(y,t.u_brightness_high),u_saturation_factor:new l.bq(y,t.u_saturation_factor),u_contrast_factor:new l.bq(y,t.u_contrast_factor),u_spin_weights:new l.c2(y,t.u_spin_weights),u_coords_top:new l.c1(y,t.u_coords_top),u_coords_bottom:new l.c1(y,t.u_coords_bottom)}),symbolIcon:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texture:new l.b_(y,t.u_texture),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),symbolSDF:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texture:new l.b_(y,t.u_texture),u_gamma_scale:new l.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_is_halo:new l.b_(y,t.u_is_halo),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),symbolTextAndIcon:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texsize_icon:new l.c3(y,t.u_texsize_icon),u_texture:new l.b_(y,t.u_texture),u_texture_icon:new l.b_(y,t.u_texture_icon),u_gamma_scale:new l.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_is_halo:new l.b_(y,t.u_is_halo),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),background:(y,t)=>({u_opacity:new l.bq(y,t.u_opacity),u_color:new l.b$(y,t.u_color)}),backgroundPattern:(y,t)=>({u_opacity:new l.bq(y,t.u_opacity),u_image:new l.b_(y,t.u_image),u_pattern_tl_a:new l.c3(y,t.u_pattern_tl_a),u_pattern_br_a:new l.c3(y,t.u_pattern_br_a),u_pattern_tl_b:new l.c3(y,t.u_pattern_tl_b),u_pattern_br_b:new l.c3(y,t.u_pattern_br_b),u_texsize:new l.c3(y,t.u_texsize),u_mix:new l.bq(y,t.u_mix),u_pattern_size_a:new l.c3(y,t.u_pattern_size_a),u_pattern_size_b:new l.c3(y,t.u_pattern_size_b),u_scale_a:new l.bq(y,t.u_scale_a),u_scale_b:new l.bq(y,t.u_scale_b),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bq(y,t.u_tile_units_to_pixels)}),terrain:(y,t)=>({u_texture:new l.b_(y,t.u_texture),u_ele_delta:new l.bq(y,t.u_ele_delta),u_fog_matrix:new l.c0(y,t.u_fog_matrix),u_fog_color:new l.b$(y,t.u_fog_color),u_fog_ground_blend:new l.bq(y,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bq(y,t.u_fog_ground_blend_opacity),u_horizon_color:new l.b$(y,t.u_horizon_color),u_horizon_fog_blend:new l.bq(y,t.u_horizon_fog_blend),u_is_globe_mode:new l.bq(y,t.u_is_globe_mode)}),terrainDepth:(y,t)=>({u_ele_delta:new l.bq(y,t.u_ele_delta)}),terrainCoords:(y,t)=>({u_texture:new l.b_(y,t.u_texture),u_terrain_coords_id:new l.bq(y,t.u_terrain_coords_id),u_ele_delta:new l.bq(y,t.u_ele_delta)}),projectionErrorMeasurement:(y,t)=>({u_input:new l.bq(y,t.u_input),u_output_expected:new l.bq(y,t.u_output_expected)}),atmosphere:(y,t)=>({u_sun_pos:new l.c2(y,t.u_sun_pos),u_atmosphere_blend:new l.bq(y,t.u_atmosphere_blend),u_globe_position:new l.c2(y,t.u_globe_position),u_globe_radius:new l.bq(y,t.u_globe_radius),u_inv_proj_matrix:new l.c0(y,t.u_inv_proj_matrix)}),sky:(y,t)=>({u_sky_color:new l.b$(y,t.u_sky_color),u_horizon_color:new l.b$(y,t.u_horizon_color),u_horizon:new l.c3(y,t.u_horizon),u_horizon_normal:new l.c3(y,t.u_horizon_normal),u_sky_horizon_blend:new l.bq(y,t.u_sky_horizon_blend),u_sky_blend:new l.bq(y,t.u_sky_blend)})};class tl{constructor(t,a,c){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const nl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ad{constructor(t,a,c,f){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let c=0;c<this.attributes.length;c++){const f=a.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,a,c){for(let f=0;f<this.attributes.length;f++){const v=this.attributes[f],w=a.attributes[v.name];w!==void 0&&t.vertexAttribPointer(w,v.components,t[nl[v.type]],!1,this.itemSize,v.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ln{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ys extends Ln{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Jc extends Ln{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class eu extends Ln{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ju extends Ln{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class il extends Ln{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class tu extends Ln{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Wl extends Ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class oa extends Ln{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class sd extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class eh extends Ln{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class la extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class _s extends Ln{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Nr extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class qs extends Ln{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class rl extends Ln{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class al extends Ln{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class nu extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class wo extends Ln{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Aa extends Ln{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class od extends Ln{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ql extends Ln{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class hn extends Ln{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class th extends Ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ca extends Ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class nh extends Ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ua extends Ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rf extends Ln{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ih extends Ln{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const c=this.gl;Sa(c)?c.bindVertexArray(t):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class To extends Ln{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ld extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class rh extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class So extends Ln{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Jl extends So{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Fr extends So{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Eo extends So{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Mo="Framebuffer is not complete";class sl{constructor(t,a,c,f,v){this.context=t,this.width=a,this.height=c;const w=t.gl,E=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Jl(t,E),f)this.depthAttachment=v?new Eo(t,E):new Fr(t,E);else if(v)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(Mo)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Ao{constructor(t){var a,c;if(this.gl=t,this.clearColor=new ys(this),this.clearDepth=new Jc(this),this.clearStencil=new eu(this),this.colorMask=new Ju(this),this.depthMask=new il(this),this.stencilMask=new tu(this),this.stencilFunc=new Wl(this),this.stencilOp=new oa(this),this.stencilTest=new sd(this),this.depthRange=new eh(this),this.depthTest=new la(this),this.depthFunc=new _s(this),this.blend=new Nr(this),this.blendFunc=new qs(this),this.blendColor=new rl(this),this.blendEquation=new al(this),this.cullFace=new nu(this),this.cullFaceSide=new wo(this),this.frontFace=new Aa(this),this.program=new od(this),this.activeTexture=new Ql(this),this.viewport=new hn(this),this.bindFramebuffer=new th(this),this.bindRenderbuffer=new ca(this),this.bindTexture=new nh(this),this.bindVertexBuffer=new ua(this),this.bindElementBuffer=new Rf(this),this.bindVertexArray=new ih(this),this.pixelStoreUnpack=new To(this),this.pixelStoreUnpackPremultiplyAlpha=new ld(this),this.pixelStoreUnpackFlipY=new rh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Sa(t)){this.HALF_FLOAT=t.HALF_FLOAT;const f=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:f?.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:f?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const f=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new tl(this,t,a)}createVertexBuffer(t,a,c){return new ad(this,t,a,c)}createRenderbuffer(t,a,c){const f=this.gl,v=f.createRenderbuffer();return this.bindRenderbuffer.set(v),f.renderbufferStorage(f.RENDERBUFFER,t,a,c),this.bindRenderbuffer.set(null),v}createFramebuffer(t,a,c,f){return new sl(this,t,a,c,f)}clear({color:t,depth:a,stencil:c}){const f=this.gl;let v=0;t&&(v|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(v|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(v|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),f.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.bR(t.blendFunction,Gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Sa(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Sa(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let tr;function rr(y,t,a,c,f){const v=y.context,w=y.transform,E=v.gl,D=y.useProgram("collisionBox"),R=[];let O=0,U=0;for(let oe=0;oe<c.length;oe++){const ue=c[oe],xe=t.getTile(ue).getBucket(a);if(!xe)continue;const ce=f?xe.textCollisionBox:xe.iconCollisionBox,_e=xe.collisionCircleArray;_e.length>0&&(R.push({circleArray:_e,circleOffset:U,coord:ue}),O+=_e.length/4,U=O),ce&&D.draw(v,E.LINES,cn.disabled,An.disabled,y.colorModeForRenderPass(),_n.disabled,vo(y.transform),y.style.map.terrain&&y.style.map.terrain.getTerrainData(ue),w.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,null,y.transform.zoom,null,null,ce.collisionVertexBuffer)}if(!f||!R.length)return;const j=y.useProgram("collisionCircle"),Z=new l.ca;Z.resize(4*O),Z._trim();let W=0;for(const oe of R)for(let ue=0;ue<oe.circleArray.length/4;ue++){const xe=4*ue,ce=oe.circleArray[xe+0],_e=oe.circleArray[xe+1],Se=oe.circleArray[xe+2],me=oe.circleArray[xe+3];Z.emplace(W++,ce,_e,Se,me,0),Z.emplace(W++,ce,_e,Se,me,1),Z.emplace(W++,ce,_e,Se,me,2),Z.emplace(W++,ce,_e,Se,me,3)}(!tr||tr.length<2*O)&&(tr=(function(oe){const ue=2*oe,xe=new l.cc;xe.resize(ue),xe._trim();for(let ce=0;ce<ue;ce++){const _e=6*ce;xe.uint16[_e+0]=4*ce+0,xe.uint16[_e+1]=4*ce+1,xe.uint16[_e+2]=4*ce+2,xe.uint16[_e+3]=4*ce+2,xe.uint16[_e+4]=4*ce+3,xe.uint16[_e+5]=4*ce+0}return xe})(O));const se=v.createIndexBuffer(tr,!0),le=v.createVertexBuffer(Z,l.cb.members,!0);for(const oe of R){const ue=nd(y.transform);j.draw(v,E.TRIANGLES,cn.disabled,An.disabled,y.colorModeForRenderPass(),_n.disabled,ue,y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe.coord),null,a.id,le,se,l.aX.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,y.transform.zoom,null,null,null)}le.destroy(),se.destroy()}const vs=l.ar(new Float32Array(16));function xs(y,t,a,c,f,v){const{horizontalAlign:w,verticalAlign:E}=l.aS(y);return new l.P((-(w-.5)*t/f+c[0])*v,(-(E-.5)*a/f+c[1])*v)}function qr(y,t,a,c,f,v){const w=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let E=c.mult(v);a||(E=E.rotate(-f));const D=w.add(E);return sn(D.x,D.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const E=Mn(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(y),D=Math.atan(E.y/E.x)+(E.x<0?Math.PI:0);return y.add(c.rotate(D))}return y.add(c)}function Gs(y,t,a,c,f,v,w,E,D,R,O,U){const j=y.text.placedSymbolArray,Z=y.text.dynamicLayoutVertexArray,W=y.icon.dynamicLayoutVertexArray,se={};Z.clear();for(let le=0;le<j.length;le++){const oe=j.get(le),ue=oe.hidden||!oe.crossTileID||y.allowVerticalPlacement&&!oe.placedOrientation?null:c[oe.crossTileID];if(ue){const xe=new l.P(oe.anchorX,oe.anchorY),ce={getElevation:U,width:f.width,height:f.height,pitchedLabelPlaneMatrix:v,pitchWithMap:a,transform:f,tileAnchorPoint:xe,translation:R,unwrappedTileID:O},_e=a?Fl(xe.x,xe.y,ce):Mn(xe.x,xe.y,ce),Se=Zo(f.cameraToCenterDistance,_e.signedDistanceFromCamera);let me=l.aA(y.textSizeData,E,oe)*Se/l.aM;a&&(me*=y.tilePixelRatio/w);const{width:Ce,height:qe,anchor:Fe,textOffset:Ue,textBoxScale:Ve}=ue,wt=xs(Fe,Ce,qe,Ue,Ve,me),St=f.getPitchedTextCorrection(xe.x+R[0],xe.y+R[1],O),dt=qr(_e.point,ce,t,wt,-f.bearingInRadians,St),Ct=y.allowVerticalPlacement&&oe.placedOrientation===l.az.vertical?Math.PI/2:0;for(let an=0;an<oe.numGlyphs;an++)l.aG(Z,dt,Ct);D&&oe.associatedIconIndex>=0&&(se[oe.associatedIconIndex]={shiftedAnchor:dt,angle:Ct})}else ps(oe.numGlyphs,Z)}if(D){W.clear();const le=y.icon.placedSymbolArray;for(let oe=0;oe<le.length;oe++){const ue=le.get(oe);if(ue.hidden)ps(ue.numGlyphs,W);else{const xe=se[oe];if(xe)for(let ce=0;ce<ue.numGlyphs;ce++)l.aG(W,xe.shiftedAnchor,xe.angle);else ps(ue.numGlyphs,W)}}y.icon.dynamicLayoutVertexBuffer.updateData(W)}y.text.dynamicLayoutVertexBuffer.updateData(Z)}function cd(y,t,a){return a.iconsInText&&t?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function ol(y,t,a,c,f,v,w,E,D,R,O,U,j){const Z=y.context,W=Z.gl,se=y.transform,le=E==="map",oe=D==="map",ue=E!=="viewport"&&a.layout.get("symbol-placement")!=="point",xe=le&&!oe&&!ue,ce=!a.layout.get("symbol-sort-key").isConstant();let _e=!1;const Se=y.getDepthModeForSublayer(0,cn.ReadOnly),me=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ce=[],qe=se.getCircleRadiusCorrection();for(const Fe of c){const Ue=t.getTile(Fe),Ve=Ue.getBucket(a);if(!Ve)continue;const wt=f?Ve.text:Ve.icon;if(!wt||!wt.segments.get().length||!wt.hasVisibleVertices)continue;const St=wt.programConfigurations.get(a.id),dt=f||Ve.sdfIcons,Ct=f?Ve.textSizeData:Ve.iconSizeData,an=oe||se.pitch!==0,Fn=y.useProgram(cd(dt,f,Ve),St),ii=l.ay(Ct,se.zoom),Qn=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Fe);let ci,Zn,xi,ui,sr=[0,0],Ci=null;if(f)Zn=Ue.glyphAtlasTexture,xi=W.LINEAR,ci=Ue.glyphAtlasTexture.size,Ve.iconsInText&&(sr=Ue.imageAtlasTexture.size,Ci=Ue.imageAtlasTexture,ui=an||y.options.rotating||y.options.zooming||Ct.kind==="composite"||Ct.kind==="camera"?W.LINEAR:W.NEAREST);else{const Un=a.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;Zn=Ue.imageAtlasTexture,xi=dt||y.options.rotating||y.options.zooming||Un||an?W.LINEAR:W.NEAREST,ci=Ue.imageAtlasTexture.size}const zi=l.aN(Ue,1,y.transform.zoom),or=ra(le,y.transform,zi),ks=l.N();l.aB(ks,or);const Rs=Uu(oe,le,y.transform,zi),es=l.aO(se,Ue,v,w),$r=se.getProjectionData({overscaledTileID:Fe,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),gl=me&&Ve.hasTextData(),cc=a.layout.get("icon-text-fit")!=="none"&&gl&&Ve.hasIconData();if(ue){const Un=y.style.map.terrain?(Ui,$i)=>y.style.map.terrain.getElevation(Fe,Ui,$i):null,Jn=a.layout.get("text-rotation-alignment")==="map";js(Ve,y,f,or,ks,oe,R,Jn,Fe.toUnwrapped(),se.width,se.height,es,Un)}const ts=f&&me||cc,Xr=ue||ts?vs:oe?or:y.transform.clipSpaceToPixelsMatrix,ma=dt&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ka;ka=dt?Ve.iconsInText?Ma(Ct.kind,ii,xe,oe,ue,ts,y,Xr,Rs,es,ci,sr,qe):Wu(Ct.kind,ii,xe,oe,ue,ts,y,Xr,Rs,es,f,ci,0,qe):Kc(Ct.kind,ii,xe,oe,ue,ts,y,Xr,Rs,es,f,ci,qe);const Ra={program:Fn,buffers:wt,uniformValues:ka,projectionData:$r,atlasTexture:Zn,atlasTextureIcon:Ci,atlasInterpolation:xi,atlasInterpolationIcon:ui,isSDF:dt,hasHalo:ma};if(ce&&Ve.canOverlap){_e=!0;const Un=wt.segments.get();for(const Jn of Un)Ce.push({segments:new l.aX([Jn]),sortKey:Jn.sortKey,state:Ra,terrainData:Qn})}else Ce.push({segments:wt.segments,sortKey:0,state:Ra,terrainData:Qn})}_e&&Ce.sort(((Fe,Ue)=>Fe.sortKey-Ue.sortKey));for(const Fe of Ce){const Ue=Fe.state;if(Z.activeTexture.set(W.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,W.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(Z.activeTexture.set(W.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Ue.isSDF){const Ve=Ue.uniformValues;Ue.hasHalo&&(Ve.u_is_halo=1,ec(Ue.buffers,Fe.segments,a,y,Ue.program,Se,O,U,Ve,Ue.projectionData,Fe.terrainData)),Ve.u_is_halo=0}ec(Ue.buffers,Fe.segments,a,y,Ue.program,Se,O,U,Ue.uniformValues,Ue.projectionData,Fe.terrainData)}}function ec(y,t,a,c,f,v,w,E,D,R,O){const U=c.context;f.draw(U,U.gl.TRIANGLES,v,w,E,_n.backCCW,D,O,R,a.id,y.layoutVertexBuffer,y.indexBuffer,t,a.paint,c.transform.zoom,y.programConfigurations.get(a.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function ud(y,t,a,c,f){const v=y.context,w=v.gl,E=An.disabled,D=new Gn([w.ONE,w.ONE],l.bp.transparent,[!0,!0,!0,!0]),R=t.getBucket(a);if(!R)return;const O=c.key;let U=a.heatmapFbos.get(O);U||(U=Wn(v,t.tileSize,t.tileSize),a.heatmapFbos.set(O,U)),v.bindFramebuffer.set(U.framebuffer),v.viewport.set([0,0,t.tileSize,t.tileSize]),v.clear({color:l.bp.transparent});const j=R.programConfigurations.get(a.id),Z=y.useProgram("heatmap",j,!f),W=y.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=y.style.map.terrain.getTerrainData(c);Z.draw(v,w.TRIANGLES,cn.disabled,E,D,_n.disabled,xo(t,y.transform.zoom,a.paint.get("heatmap-intensity"),1),se,W,a.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,a.paint,y.transform.zoom,j)}function ar(y,t,a,c,f){const v=y.context,w=v.gl,E=y.transform;v.setColorMode(y.colorModeForRenderPass());const D=En(v,t),R=a.key,O=t.heatmapFbos.get(R);if(!O)return;v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,O.colorAttachment.get()),v.activeTexture.set(w.TEXTURE1),D.bind(w.LINEAR,w.CLAMP_TO_EDGE);const U=E.getProjectionData({overscaledTileID:a,applyTerrainMatrix:f,applyGlobeMatrix:!c});y.useProgram("heatmapTexture").draw(v,w.TRIANGLES,cn.disabled,An.disabled,y.colorModeForRenderPass(),_n.disabled,id(y,t,0,1),null,U,t.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,t.paint,E.zoom),O.destroy(),t.heatmapFbos.delete(R)}function Wn(y,t,a){var c,f;const v=y.gl,w=v.createTexture();v.bindTexture(v.TEXTURE_2D,w),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const E=(c=y.HALF_FLOAT)!==null&&c!==void 0?c:v.UNSIGNED_BYTE,D=(f=y.RGBA16F)!==null&&f!==void 0?f:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,D,t,a,0,v.RGBA,E,null);const R=y.createFramebuffer(t,a,!1,!1);return R.colorAttachment.set(w),R}function En(y,t){return t.colorRampTexture||(t.colorRampTexture=new l.T(y,t.colorRamp,y.gl.RGBA)),t.colorRampTexture}function Zs(y,t,a,c,f,v,w,E){let D=256;if(f.stepInterpolant){const R=t.getSource().maxzoom,O=w.canonical.z===R?Math.ceil(1<<y.transform.maxZoom-w.canonical.z):1;D=l.an(l.ce(v.maxLineLength/l.a5*1024*O),256,a.maxTextureSize)}return E.gradient=l.cf({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:D,image:E.gradient||void 0,clips:v.lineClipsArray}),E.texture?E.texture.update(E.gradient):E.texture=new l.T(a,E.gradient,c.RGBA),E.version=f.gradientVersion,E.texture}function ha(y,t,a,c,f){y.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),c.updatePaintBuffers(f)}function _i(y,t,a,c,f,v){(f||y.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),y.lineAtlas.bind(t)),c.updatePaintBuffers(v)}function Gr(y,t,a,c,f,v,w){const E=v.gradients[f.id];let D=E.texture;f.gradientVersion!==E.version&&(D=Zs(y,t,a,c,f,v,w,E)),a.activeTexture.set(c.TEXTURE0),D.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function Zr(y,t,a,c,f,v,w,E,D){const R=v.gradients[f.id];let O=R.texture;f.gradientVersion!==R.version&&(O=Zs(y,t,a,c,f,v,w,R)),a.activeTexture.set(c.TEXTURE0),O.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),y.lineAtlas.bind(a),E.updatePaintBuffers(D)}function iu(y,t,a,c,f){if(!a||!c||!c.imageAtlas)return;const v=c.imageAtlas.patternPositions;let w=v[a.to.toString()],E=v[a.from.toString()];if(!w&&E&&(w=E),!E&&w&&(E=w),!w||!E){const D=f.getPaintProperty(t);w=v[D],E=v[D]}w&&E&&y.setConstantPatternPositions(w,E)}function bs(y,t,a,c,f,v,w,E){const D=y.context.gl,R="fill-pattern",O=a.paint.get(R),U=O&&O.constantOr(1),j=a.getCrossfadeParameters();let Z,W,se,le,oe;const ue=y.transform,xe=a.paint.get("fill-translate"),ce=a.paint.get("fill-translate-anchor");w?(W=U&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=D.LINES):(W=U?"fillPattern":"fill",Z=D.TRIANGLES);const _e=O.constantOr(null);for(const Se of c){const me=t.getTile(Se);if(U&&!me.patternsLoaded())continue;const Ce=me.getBucket(a);if(!Ce)continue;const qe=Ce.programConfigurations.get(a.id),Fe=y.useProgram(W,qe),Ue=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Se);U&&(y.context.activeTexture.set(D.TEXTURE0),me.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),qe.updatePaintBuffers(j)),iu(qe,R,_e,me,a);const Ve=ue.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),wt=l.aO(ue,me,xe,ce);if(w){le=Ce.indexBuffer2,oe=Ce.segments2;const dt=[D.drawingBufferWidth,D.drawingBufferHeight];se=W==="fillOutlinePattern"&&U?zf(y,j,me,dt,wt):Kl(dt,wt)}else le=Ce.indexBuffer,oe=Ce.segments,se=U?el(y,j,me,wt):{u_fill_translate:wt};const St=y.stencilModeForClipping(Se);Fe.draw(y.context,Z,f,St,v,_n.backCCW,se,Ue,Ve,a.id,Ce.layoutVertexBuffer,le,oe,a.paint,y.transform.zoom,qe)}}function ws(y,t,a,c,f,v,w,E){const D=y.context,R=D.gl,O="fill-extrusion-pattern",U=a.paint.get(O),j=U.constantOr(1),Z=a.getCrossfadeParameters(),W=a.paint.get("fill-extrusion-opacity"),se=U.constantOr(null),le=y.transform;for(const oe of c){const ue=t.getTile(oe),xe=ue.getBucket(a);if(!xe)continue;const ce=y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe),_e=xe.programConfigurations.get(a.id),Se=y.useProgram(j?"fillExtrusionPattern":"fillExtrusion",_e);j&&(y.context.activeTexture.set(R.TEXTURE0),ue.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),_e.updatePaintBuffers(Z));const me=le.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!E,applyTerrainMatrix:!0});iu(_e,O,se,ue,a);const Ce=l.aO(le,ue,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),qe=a.paint.get("fill-extrusion-vertical-gradient"),Fe=j?Xu(y,qe,W,Ce,oe,Z,ue):$u(y,qe,W,Ce);Se.draw(D,D.gl.TRIANGLES,f,v,w,_n.backCCW,Fe,ce,me,a.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,a.paint,y.transform.zoom,_e,y.style.map.terrain&&xe.centroidVertexBuffer)}}function Ts(y,t,a,c,f,v,w,E,D){var R;const O=y.style.projection,U=y.context,j=y.transform,Z=U.gl,W=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],se=y.useProgram("hillshade",null,!1,W),le=!y.options.moving;for(const oe of c){const ue=t.getTile(oe),xe=ue.fbo;if(!xe)continue;const ce=O.getMeshFromTileID(U,oe.canonical,E,!0,"raster"),_e=(R=y.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(oe);U.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,xe.colorAttachment.get());const Se=j.getProjectionData({overscaledTileID:oe,aligned:le,applyGlobeMatrix:!D,applyTerrainMatrix:!0});se.draw(U,Z.TRIANGLES,v,f[oe.overscaledZ],w,_n.backCCW,$c(y,ue,a),_e,Se,a.id,ce.vertexBuffer,ce.indexBuffer,ce.segments)}}function Hs(y,t,a,c,f,v,w,E,D){var R;const O=y.style.projection,U=y.context,j=y.transform,Z=U.gl,W=y.useProgram("colorRelief"),se=!y.options.moving;let le=!0,oe=0;for(const ue of c){const xe=t.getTile(ue),ce=xe.dem;if(le){const Fe=Z.getParameter(Z.MAX_TEXTURE_SIZE),{elevationTexture:Ue,colorTexture:Ve}=a.getColorRampTextures(U,Fe,ce.getUnpackVector());U.activeTexture.set(Z.TEXTURE1),Ue.bind(Z.NEAREST,Z.CLAMP_TO_EDGE),U.activeTexture.set(Z.TEXTURE4),Ve.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),le=!1,oe=Ue.size[0]}if(!ce||!ce.data)continue;const _e=ce.stride,Se=ce.getPixels();if(U.activeTexture.set(Z.TEXTURE0),U.pixelStoreUnpackPremultiplyAlpha.set(!1),xe.demTexture=xe.demTexture||y.getTileTexture(_e),xe.demTexture){const Fe=xe.demTexture;Fe.update(Se,{premultiply:!1}),Fe.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}else xe.demTexture=new l.T(U,Se,Z.RGBA,{premultiply:!1}),xe.demTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const me=O.getMeshFromTileID(U,ue.canonical,E,!0,"raster"),Ce=(R=y.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ue),qe=j.getProjectionData({overscaledTileID:ue,aligned:se,applyGlobeMatrix:!D,applyTerrainMatrix:!0});W.draw(U,Z.TRIANGLES,v,f[ue.overscaledZ],w,_n.backCCW,Pf(a,xe.dem,oe),Ce,qe,a.id,me.vertexBuffer,me.indexBuffer,me.segments)}}const $s=[new l.P(0,0),new l.P(l.a5,0),new l.P(l.a5,l.a5),new l.P(0,l.a5)];function Ca(y,t,a,c,f,v,w,E,D=!1,R=!1){const O=c[c.length-1].overscaledZ,U=y.context,j=U.gl,Z=y.useProgram("raster"),W=y.transform,se=y.style.projection,le=y.colorModeForRenderPass(),oe=!y.options.moving,ue=a.paint.get("raster-opacity"),xe=a.paint.get("raster-resampling"),ce=a.paint.get("raster-fade-duration"),_e=!!y.style.map.terrain;for(const Se of c){const me=y.getDepthModeForSublayer(Se.overscaledZ-O,ue===1?cn.ReadWrite:cn.ReadOnly,j.LESS),Ce=t.getTile(Se),qe=xe==="nearest"?j.NEAREST:j.LINEAR;U.activeTexture.set(j.TEXTURE0),Ce.texture.bind(qe,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),U.activeTexture.set(j.TEXTURE1);const{parentTile:Fe,parentScaleBy:Ue,parentTopLeft:Ve,fadeValues:wt}=Ss(Ce,t,ce,_e);Ce.fadeOpacity=wt.tileOpacity,Fe?(Fe.fadeOpacity=wt.parentTileOpacity,Fe.texture.bind(qe,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST)):Ce.texture.bind(qe,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),Ce.texture.useMipmap&&U.extTextureFilterAnisotropic&&y.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const St=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Se),dt=W.getProjectionData({overscaledTileID:Se,aligned:oe,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ct=Yu(Ve,Ue,wt.fadeMix,a,E),an=se.getMeshFromTileID(U,Se.canonical,v,w,"raster");Z.draw(U,j.TRIANGLES,me,f?f[Se.overscaledZ]:An.disabled,le,D?_n.frontCCW:_n.backCCW,Ct,St,dt,a.id,an.vertexBuffer,an.indexBuffer,an.segments)}}function Ss(y,t,a,c){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return f;if(y.fadingParentID){const v=t.getLoadedTile(y.fadingParentID);if(!v)return f;const w=Math.pow(2,v.tileID.overscaledZ-y.tileID.overscaledZ),E=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1],D=(function(R,O,U){const j=pe(),Z=(j-O.timeAdded)/U,W=R.fadingDirection===Oe.Incoming,se=l.an((j-R.timeAdded)/U,0,1),le=l.an(1-Z,0,1),oe=W?se:le;return{tileOpacity:oe,parentTileOpacity:W?le:se,fadeMix:{opacity:1,mix:1-oe}}})(y,v,a);return{parentTile:v,parentScaleBy:w,parentTopLeft:E,fadeValues:D}}if(y.selfFading){const v=(function(w,E){const D=(pe()-w.timeAdded)/E,R=l.an(D,0,1);return{tileOpacity:R,fadeMix:{opacity:R,mix:0}}})(y,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:v}}return f}const Xs=new l.bp(1,0,0,1),Es=new l.bp(0,1,0,1),ah=new l.bp(0,0,1,1),sh=new l.bp(1,0,1,1),da=new l.bp(0,1,1,1);function tc(y,t,a,c){ji(y,0,t+a/2,y.transform.width,a,c)}function Ys(y,t,a,c){ji(y,t-a/2,0,a,y.transform.height,c)}function ji(y,t,a,c,f,v){const w=y.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*y.pixelRatio,a*y.pixelRatio,c*y.pixelRatio,f*y.pixelRatio),w.clear({color:v}),E.disable(E.SCISSOR_TEST)}function ru(y,t,a){const c=y.context,f=c.gl,v=y.useProgram("debug"),w=cn.disabled,E=An.disabled,D=y.colorModeForRenderPass(),R="$debug",O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);c.activeTexture.set(f.TEXTURE0);const U=t.getTileByID(a.key).latestRawTileData,j=Math.floor((U&&U.byteLength||0)/1024),Z=t.getTile(a).tileSize,W=512/Math.min(Z,512)*(a.overscaledZ/y.transform.zoom)*.5;let se=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(se+=` => ${a.overscaledZ}`),(function(oe,ue){oe.initDebugOverlayCanvas();const xe=oe.debugOverlayCanvas,ce=oe.context.gl,_e=oe.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,xe.width,xe.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(ue,5,5),_e.strokeText(ue,5,5),oe.debugOverlayTexture.update(xe),oe.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)})(y,`${se} ${j}kB`);const le=y.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(c,f.TRIANGLES,w,E,Gn.alphaBlended,_n.disabled,Hc(l.bp.transparent,W),null,le,R,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),v.draw(c,f.LINE_STRIP,w,E,D,_n.disabled,Hc(l.bp.red),O,le,R,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function oh(y,t,a,c){const{isRenderingGlobe:f}=c,v=y.context,w=v.gl,E=y.transform,D=y.colorModeForRenderPass(),R=y.getDepthModeFor3D(),O=y.useProgram("terrain");v.bindFramebuffer.set(null),v.viewport.set([0,0,y.width,y.height]);for(const U of a){const j=t.getTerrainMesh(U.tileID),Z=y.renderToTexture.getTexture(U),W=t.getTerrainData(U.tileID);v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,Z.texture);const se=t.getMeshFrameDelta(E.zoom),le=E.calculateFogMatrix(U.tileID.toUnwrapped()),oe=Mf(se,le,y.style.sky,E.pitch,f),ue=E.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(v,w.TRIANGLES,R,An.disabled,D,_n.backCCW,oe,W,ue,"terrain",j.vertexBuffer,j.indexBuffer,j.segments)}}function hd(y,t){if(!t.mesh){const a=new l.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const c=new l.aY;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new Kn(y.createVertexBuffer(a,Ta.members),y.createIndexBuffer(c),l.aX.simpleSegment(0,0,a.length,c.length))}return t.mesh}class Lf{constructor(t,a){this.context=new Ao(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ni.maxOverzooming+ni.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ji}resize(t,a,c){if(this.width=Math.floor(t*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,a=new l.aW;a.emplaceBack(0,0),a.emplaceBack(l.a5,0),a.emplaceBack(0,l.a5),a.emplaceBack(l.a5,l.a5),this.tileExtentBuffer=t.createVertexBuffer(a,Ta.members),this.tileExtentSegments=l.aX.simpleSegment(0,0,4,2);const c=new l.aW;c.emplaceBack(0,0),c.emplaceBack(l.a5,0),c.emplaceBack(0,l.a5),c.emplaceBack(l.a5,l.a5),this.debugBuffer=t.createVertexBuffer(c,Ta.members),this.debugSegments=l.aX.simpleSegment(0,0,4,5);const f=new l.ch;f.emplaceBack(0,0,0,0),f.emplaceBack(l.a5,0,l.a5,0),f.emplaceBack(0,l.a5,0,l.a5),f.emplaceBack(l.a5,l.a5,l.a5,l.a5),this.rasterBoundsBuffer=t.createVertexBuffer(f,Ef.members),this.rasterBoundsSegments=l.aX.simpleSegment(0,0,4,2);const v=new l.aW;v.emplaceBack(0,0),v.emplaceBack(l.a5,0),v.emplaceBack(0,l.a5),v.emplaceBack(l.a5,l.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(v,Ta.members),this.rasterBoundsSegmentsPosOnly=l.aX.simpleSegment(0,0,4,5);const w=new l.aW;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,Ta.members),this.viewportSegments=l.aX.simpleSegment(0,0,4,2);const E=new l.ci;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(E);const D=new l.aY;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D);const R=this.context.gl;this.stencilClearMode=new An({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new Kn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=l.N();l.c7(c,0,this.width,this.height,0,0,1),l.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const f={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,cn.disabled,this.stencilClearMode,Gn.disabled,_n.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const f=this.context;f.setColorMode(Gn.disabled),f.setDepthMode(cn.disabled);const v={};for(const w of a)v[w.key]=this.nextStencilID++;this._renderTileMasks(v,a,c,!0),this._renderTileMasks(v,a,c,!1),this._tileClippingMaskIDs=v}_renderTileMasks(t,a,c,f){const v=this.context,w=v.gl,E=this.style.projection,D=this.transform,R=this.useProgram("clippingMask");for(const O of a){const U=t[O.key],j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),Z=E.getMeshFromTileID(this.context,O.canonical,f,!0,"stencil"),W=D.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!c,applyTerrainMatrix:!0});R.draw(v,w.TRIANGLES,cn.disabled,new An({func:w.ALWAYS,mask:0},U,255,w.KEEP,w.KEEP,w.REPLACE),Gn.disabled,c?_n.disabled:_n.backCCW,null,j,W,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,c=this.style.projection,f=this.transform,v=this.useProgram("depth"),w=this.getDepthModeFor3D(),E=un(f,{tileSize:f.tileSize});for(const D of E){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),O=c.getMeshFromTileID(this.context,D.canonical,!0,!0,"raster"),U=f.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(t,a.TRIANGLES,w,An.disabled,Gn.disabled,_n.backCCW,null,R,U,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new An({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new An({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,c=t.sort(((w,E)=>E.overscaledZ-w.overscaledZ)),f=c[c.length-1].overscaledZ,v=c[0].overscaledZ-f+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let E=0;E<v;E++)w[E+f]=new An({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[w,c]}return[{[f]:An.disabled},c]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,c=t.sort(((w,E)=>E.overscaledZ-w.overscaledZ)),f=c[c.length-1].overscaledZ,v=c[0].overscaledZ-f+1;if(this.clearStencil(),v>1){const w={},E={};for(let D=0;D<v;D++)w[D+f]=new An({func:a.GREATER,mask:255},v+1+D,255,a.KEEP,a.KEEP,a.REPLACE),E[D+f]=new An({func:a.GREATER,mask:255},1+D,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*v+1,[w,E,c]}return this.nextStencilID=3,[{[f]:new An({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[f]:new An({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Gn([t.CONSTANT_COLOR,t.ONE],new l.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gn.unblended:Gn.alphaBlended}getDepthModeForSublayer(t,a,c){if(!this.opaquePassEnabledForLayer())return cn.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new cn(c||this.context.gl.LEQUAL,a,[f,f])}getDepthModeFor3D(){return new cn(this.context.gl.LEQUAL,cn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var c,f;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(pe()),this.imageManager.beginFrame();const v=this.style._order,w=this.style.tileManagers,E={},D={},R={},O={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const j in w){const Z=w[j];Z.used&&Z.prepare(this.context),E[j]=Z.getVisibleCoordinates(!1),D[j]=E[j].slice().reverse(),R[j]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<v.length;j++)if(this.style._layers[v[j]].is3D()){this.opaquePassCutoff=j;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const j of v){const Z=this.style._layers[j];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const W=D[Z.source];(Z.type==="custom"||W.length)&&this.renderLayer(this,w[Z.source],Z,W,O)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:j=>this.useProgram(j)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?l.bp.black:l.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(j,Z){const W=j.context,se=W.gl,le=((Se,me,Ce)=>{const qe=Math.cos(me.rollInRadians),Fe=Math.sin(me.rollInRadians),Ue=gn(me),Ve=me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Se.properties.get("sky-color"),u_horizon_color:Se.properties.get("horizon-color"),u_horizon:[(me.width/2-Ue*Fe)*Ce,(me.height/2+Ue*qe)*Ce],u_horizon_normal:[-Fe,qe],u_sky_horizon_blend:Se.properties.get("sky-horizon-blend")*me.height/2*Ce,u_sky_blend:Ve}})(Z,j.style.map.transform,j.pixelRatio),oe=new cn(se.LEQUAL,cn.ReadWrite,[0,1]),ue=An.disabled,xe=j.colorModeForRenderPass(),ce=j.useProgram("sky"),_e=hd(W,Z);ce.draw(W,se.TRIANGLES,oe,ue,xe,_n.disabled,le,null,void 0,"sky",_e.vertexBuffer,_e.indexBuffer,_e.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[v[this.currentLayer]],Z=w[j.source],W=E[j.source];this._renderTileClippingMasks(j,W,!1),this.renderLayer(this,Z,j,W,O)}this.renderPass="translucent";let U=!1;for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const j=this.style._layers[v[this.currentLayer]],Z=w[j.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(j,O))continue;this.opaquePassEnabledForLayer()||U||(U=!0,O.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const W=(j.type==="symbol"?R:D)[j.source];this._renderTileClippingMasks(j,E[j.source],!!this.renderToTexture),this.renderLayer(this,Z,j,W,O)}if(O.isRenderingGlobe&&(function(j,Z,W){const se=j.context,le=se.gl,oe=j.useProgram("atmosphere"),ue=new cn(le.LEQUAL,cn.ReadOnly,[0,1]),xe=j.transform,ce=(function(Ve,wt){const St=Ve.properties.get("position"),dt=[-St.x,-St.y,-St.z],Ct=l.ar(new Float64Array(16));return Ve.properties.get("anchor")==="map"&&(l.bg(Ct,Ct,wt.rollInRadians),l.bh(Ct,Ct,-wt.pitchInRadians),l.bg(Ct,Ct,wt.bearingInRadians),l.bh(Ct,Ct,wt.center.lat*Math.PI/180),l.bJ(Ct,Ct,-wt.center.lng*Math.PI/180)),l.cg(dt,dt,Ct),dt})(W,j.transform),_e=xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Se=Z.properties.get("atmosphere-blend")*_e.projectionTransition;if(Se===0)return;const me=Jo(xe.worldSize,xe.center.lat),Ce=xe.inverseProjectionMatrix,qe=new Float64Array(4);qe[3]=1,l.aH(qe,qe,xe.modelViewProjectionMatrix),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1,l.aH(qe,qe,Ce),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1;const Fe=((Ve,wt,St,dt,Ct)=>({u_sun_pos:Ve,u_atmosphere_blend:wt,u_globe_position:St,u_globe_radius:dt,u_inv_proj_matrix:Ct}))(ce,Se,[qe[0],qe[1],qe[2]],me,Ce),Ue=hd(se,Z);oe.draw(se,le.TRIANGLES,ue,An.disabled,Gn.alphaBlended,_n.disabled,Fe,null,null,"atmosphere",Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const j=(function(Z,W){let se=null;const le=Object.values(Z._layers).flatMap((ce=>ce.source&&!ce.isHidden(W)?[Z.tileManagers[ce.source]]:[])),oe=le.filter((ce=>ce.getSource().type==="vector")),ue=le.filter((ce=>ce.getSource().type!=="vector")),xe=ce=>{(!se||se.getSource().maxzoom<ce.getSource().maxzoom)&&(se=ce)};return oe.forEach((ce=>xe(ce))),se||ue.forEach((ce=>xe(ce))),se})(this.style,this.transform.zoom);j&&(function(Z,W,se){for(let le=0;le<se.length;le++)ru(Z,W,se[le])})(this,j,j.getVisibleCoordinates())}this.options.showPadding&&(function(j){const Z=j.transform.padding;tc(j,j.transform.height-(Z.top||0),3,Xs),tc(j,Z.bottom||0,3,Es),Ys(j,Z.left||0,3,ah),Ys(j,j.transform.width-(Z.right||0),3,sh);const W=j.transform.centerPoint;(function(se,le,oe,ue){ji(se,le-1,oe-10,2,20,ue),ji(se,le-10,oe-1,20,2,ue)})(j,W.x,j.transform.height-W.y,da)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=t?!l.cj(a,c):!l.ck(a,c)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(l.cl(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(v,w){const E=v.context,D=E.gl,R=v.transform,O=Gn.unblended,U=new cn(D.LEQUAL,cn.ReadWrite,[0,1]),j=w.tileManager.getRenderableTiles(),Z=v.useProgram("terrainDepth");E.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),E.clear({color:l.bp.transparent,depth:1});for(const W of j){const se=w.getTerrainMesh(W.tileID),le=w.getTerrainData(W.tileID),oe=R.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ue={u_ele_delta:w.getMeshFrameDelta(R.zoom)};Z.draw(E,D.TRIANGLES,U,An.disabled,O,_n.backCCW,ue,le,oe,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain),(function(v,w){const E=v.context,D=E.gl,R=v.transform,O=Gn.unblended,U=new cn(D.LEQUAL,cn.ReadWrite,[0,1]),j=w.getCoordsTexture(),Z=w.tileManager.getRenderableTiles(),W=v.useProgram("terrainCoords");E.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),E.clear({color:l.bp.transparent,depth:1}),w.coordsIndex=[];for(const se of Z){const le=w.getTerrainMesh(se.tileID),oe=w.getTerrainData(se.tileID);E.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,j.texture);const ue={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(R.zoom)},xe=R.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(E,D.TRIANGLES,U,An.disabled,O,_n.backCCW,ue,oe,xe,"terrain",le.vertexBuffer,le.indexBuffer,le.segments),w.coordsIndex.push(se.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain))}renderLayer(t,a,c,f,v){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(f||[]).length)&&(this.id=c.id,l.cm(c)?(function(w,E,D,R,O,U){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:j}=U,Z=An.disabled,W=w.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(se,le,oe,ue,xe,ce,_e,Se,me){const Ce=le.transform,qe=le.style.map.terrain,Fe=xe==="map",Ue=ce==="map";for(const Ve of se){const wt=ue.getTile(Ve),St=wt.getBucket(oe);if(!St||!St.text||!St.text.segments.get().length)continue;const dt=l.ay(St.textSizeData,Ce.zoom),Ct=l.aN(wt,1,le.transform.zoom),an=ra(Fe,le.transform,Ct),Fn=oe.layout.get("icon-text-fit")!=="none"&&St.hasIconData();if(dt){const ii=Math.pow(2,Ce.zoom-wt.tileID.overscaledZ),Qn=qe?(ci,Zn)=>qe.getElevation(Ve,ci,Zn):null;Gs(St,Fe,Ue,me,Ce,an,ii,dt,Fn,l.aO(Ce,wt,_e,Se),Ve.toUnwrapped(),Qn)}}})(R,w,D,E,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),O),D.paint.get("icon-opacity").constantOr(1)!==0&&ol(w,E,D,R,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),Z,W,j),D.paint.get("text-opacity").constantOr(1)!==0&&ol(w,E,D,R,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),Z,W,j),E.map.showCollisionBoxes&&(rr(w,E,D,R,!0),rr(w,E,D,R,!1))})(t,a,c,f,this.style.placement.variableOffsets,v):l.cn(c)?(function(w,E,D,R,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,j=D.paint.get("circle-opacity"),Z=D.paint.get("circle-stroke-width"),W=D.paint.get("circle-stroke-opacity"),se=!D.layout.get("circle-sort-key").isConstant();if(j.constantOr(1)===0&&(Z.constantOr(1)===0||W.constantOr(1)===0))return;const le=w.context,oe=le.gl,ue=w.transform,xe=w.getDepthModeForSublayer(0,cn.ReadOnly),ce=An.disabled,_e=w.colorModeForRenderPass(),Se=[],me=ue.getCircleRadiusCorrection();for(let Ce=0;Ce<R.length;Ce++){const qe=R[Ce],Fe=E.getTile(qe),Ue=Fe.getBucket(D);if(!Ue)continue;const Ve=D.paint.get("circle-translate"),wt=D.paint.get("circle-translate-anchor"),St=l.aO(ue,Fe,Ve,wt),dt=Ue.programConfigurations.get(D.id),Ct=w.useProgram("circle",dt),an=Ue.layoutVertexBuffer,Fn=Ue.indexBuffer,ii=w.style.map.terrain&&w.style.map.terrain.getTerrainData(qe),Qn={programConfiguration:dt,program:Ct,layoutVertexBuffer:an,indexBuffer:Fn,uniformValues:Zc(w,Fe,D,St,me),terrainData:ii,projectionData:ue.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!U,applyTerrainMatrix:!0})};if(se){const ci=Ue.segments.get();for(const Zn of ci)Se.push({segments:new l.aX([Zn]),sortKey:Zn.sortKey,state:Qn})}else Se.push({segments:Ue.segments,sortKey:0,state:Qn})}se&&Se.sort(((Ce,qe)=>Ce.sortKey-qe.sortKey));for(const Ce of Se){const{programConfiguration:qe,program:Fe,layoutVertexBuffer:Ue,indexBuffer:Ve,uniformValues:wt,terrainData:St,projectionData:dt}=Ce.state;Fe.draw(le,oe.TRIANGLES,xe,ce,_e,_n.backCCW,wt,St,dt,D.id,Ue,Ve,Ce.segments,D.paint,w.transform.zoom,qe)}})(t,a,c,f,v):l.co(c)?(function(w,E,D,R,O){if(D.paint.get("heatmap-opacity")===0)return;const U=w.context,{isRenderingToTexture:j,isRenderingGlobe:Z}=O;if(w.style.map.terrain){for(const W of R){const se=E.getTile(W);E.hasRenderableParent(W)||(w.renderPass==="offscreen"?ud(w,se,D,W,Z):w.renderPass==="translucent"&&ar(w,D,W,j,Z))}U.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?(function(W,se,le,oe){const ue=W.context,xe=ue.gl,ce=W.transform,_e=An.disabled,Se=new Gn([xe.ONE,xe.ONE],l.bp.transparent,[!0,!0,!0,!0]);(function(me,Ce,qe){const Fe=me.gl;me.activeTexture.set(Fe.TEXTURE1),me.viewport.set([0,0,Ce.width/4,Ce.height/4]);let Ue=qe.heatmapFbos.get(l.cd);Ue?(Fe.bindTexture(Fe.TEXTURE_2D,Ue.colorAttachment.get()),me.bindFramebuffer.set(Ue.framebuffer)):(Ue=Wn(me,Ce.width/4,Ce.height/4),qe.heatmapFbos.set(l.cd,Ue))})(ue,W,le),ue.clear({color:l.bp.transparent});for(let me=0;me<oe.length;me++){const Ce=oe[me];if(se.hasRenderableParent(Ce))continue;const qe=se.getTile(Ce),Fe=qe.getBucket(le);if(!Fe)continue;const Ue=Fe.programConfigurations.get(le.id),Ve=W.useProgram("heatmap",Ue),wt=ce.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),St=ce.getCircleRadiusCorrection();Ve.draw(ue,xe.TRIANGLES,cn.disabled,_e,Se,_n.backCCW,xo(qe,ce.zoom,le.paint.get("heatmap-intensity"),St),null,wt,le.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,le.paint,ce.zoom,Ue)}ue.viewport.set([0,0,W.width,W.height])})(w,E,D,R):w.renderPass==="translucent"&&(function(W,se){const le=W.context,oe=le.gl;le.setColorMode(W.colorModeForRenderPass());const ue=se.heatmapFbos.get(l.cd);ue&&(le.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,ue.colorAttachment.get()),le.activeTexture.set(oe.TEXTURE1),En(le,se).bind(oe.LINEAR,oe.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(le,oe.TRIANGLES,cn.disabled,An.disabled,W.colorModeForRenderPass(),_n.disabled,id(W,se,0,1),null,null,se.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,se.paint,W.transform.zoom))})(w,D)})(t,a,c,f,v):l.cp(c)?(function(w,E,D,R,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,j=D.paint.get("line-opacity"),Z=D.paint.get("line-width");if(j.constantOr(1)===0||Z.constantOr(1)===0)return;const W=w.getDepthModeForSublayer(0,cn.ReadOnly),se=w.colorModeForRenderPass(),le=D.paint.get("line-dasharray"),oe=le.constantOr(1),ue=D.paint.get("line-pattern"),xe=ue.constantOr(1),ce=D.paint.get("line-gradient"),_e=D.getCrossfadeParameters();let Se;Se=xe?"linePattern":oe&&ce?"lineGradientSDF":oe?"lineSDF":ce?"lineGradient":"line";const me=w.context,Ce=me.gl,qe=w.transform;let Fe=!0;for(const Ue of R){const Ve=E.getTile(Ue);if(xe&&!Ve.patternsLoaded())continue;const wt=Ve.getBucket(D);if(!wt)continue;const St=wt.programConfigurations.get(D.id),dt=w.context.program.get(),Ct=w.useProgram(Se,St),an=Fe||Ct.program!==dt,Fn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ue),ii=ue.constantOr(null),Qn=le&&le.constantOr(null);if(ii&&Ve.imageAtlas){const sr=Ve.imageAtlas,Ci=sr.patternPositions[ii.to.toString()],zi=sr.patternPositions[ii.from.toString()];Ci&&zi&&St.setConstantPatternPositions(Ci,zi)}else if(Qn){const sr=D.layout.get("line-cap")==="round",Ci=w.lineAtlas.getDash(Qn.to,sr),zi=w.lineAtlas.getDash(Qn.from,sr);St.setConstantDashPositions(Ci,zi)}const ci=qe.getProjectionData({overscaledTileID:Ue,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),Zn=qe.getPixelScale();let xi;xe?(xi=rd(w,Ve,D,Zn,_e),ha(me,Ce,Ve,St,_e)):oe&&ce?(xi=bo(w,Ve,D,Zn,_e,wt.lineClipsArray.length),Zr(w,E,me,Ce,D,wt,Ue,St,_e)):oe?(xi=Vr(w,Ve,D,Zn,_e),_i(w,me,Ce,St,an,_e)):ce?(xi=If(w,Ve,D,Zn,wt.lineClipsArray.length),Gr(w,E,me,Ce,D,wt,Ue)):xi=Xc(w,Ve,D,Zn);const ui=w.stencilModeForClipping(Ue);Ct.draw(me,Ce.TRIANGLES,W,ui,se,_n.disabled,xi,Fn,ci,D.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,D.paint,w.transform.zoom,St,wt.layoutVertexBuffer2),Fe=!1}})(t,a,c,f,v):l.cq(c)?(function(w,E,D,R,O){const U=D.paint.get("fill-color"),j=D.paint.get("fill-opacity");if(j.constantOr(1)===0)return;const{isRenderingToTexture:Z}=O,W=w.colorModeForRenderPass(),se=D.paint.get("fill-pattern"),le=w.opaquePassEnabledForLayer()&&!se.constantOr(1)&&U.constantOr(l.bp.transparent).a===1&&j.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===le){const oe=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?cn.ReadWrite:cn.ReadOnly);bs(w,E,D,R,oe,W,!1,Z)}if(w.renderPass==="translucent"&&D.paint.get("fill-antialias")){const oe=w.getDepthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,cn.ReadOnly);bs(w,E,D,R,oe,W,!0,Z)}})(t,a,c,f,v):l.cr(c)?(function(w,E,D,R,O){const U=D.paint.get("fill-extrusion-opacity");if(U===0)return;const{isRenderingToTexture:j}=O;if(w.renderPass==="translucent"){const Z=new cn(w.context.gl.LEQUAL,cn.ReadWrite,w.depthRangeFor3D);if(U!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))ws(w,E,D,R,Z,An.disabled,Gn.disabled,j),ws(w,E,D,R,Z,w.stencilModeFor3D(),w.colorModeForRenderPass(),j);else{const W=w.colorModeForRenderPass();ws(w,E,D,R,Z,An.disabled,W,j)}}})(t,a,c,f,v):l.cs(c)?(function(w,E,D,R,O){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,j=w.context,Z=w.style.projection.useSubdivision,W=w.getDepthModeForSublayer(0,cn.ReadOnly),se=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(le,oe,ue,xe,ce,_e,Se){const me=le.context,Ce=me.gl;for(const qe of ue){const Fe=oe.getTile(qe),Ue=Fe.dem;if(!Ue||!Ue.data||!Fe.needsHillshadePrepare)continue;const Ve=Ue.dim,wt=Ue.stride,St=Ue.getPixels();if(me.activeTexture.set(Ce.TEXTURE1),me.pixelStoreUnpackPremultiplyAlpha.set(!1),Fe.demTexture=Fe.demTexture||le.getTileTexture(wt),Fe.demTexture){const Ct=Fe.demTexture;Ct.update(St,{premultiply:!1}),Ct.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE)}else Fe.demTexture=new l.T(me,St,Ce.RGBA,{premultiply:!1}),Fe.demTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);me.activeTexture.set(Ce.TEXTURE0);let dt=Fe.fbo;if(!dt){const Ct=new l.T(me,{width:Ve,height:Ve,data:null},Ce.RGBA);Ct.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),dt=Fe.fbo=me.createFramebuffer(Ve,Ve,!0,!1),dt.colorAttachment.set(Ct.texture)}me.bindFramebuffer.set(dt.framebuffer),me.viewport.set([0,0,Ve,Ve]),le.useProgram("hillshadePrepare").draw(me,Ce.TRIANGLES,ce,_e,Se,_n.disabled,Df(Fe.tileID,Ue),null,null,xe.id,le.rasterBoundsBuffer,le.quadTriangleIndexBuffer,le.rasterBoundsSegments),Fe.needsHillshadePrepare=!1}})(w,E,R,D,W,An.disabled,se),j.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(Z){const[le,oe,ue]=w.stencilConfigForOverlapTwoPass(R);Ts(w,E,D,ue,le,W,se,!1,U),Ts(w,E,D,ue,oe,W,se,!0,U)}else{const[le,oe]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Ts(w,E,D,oe,le,W,se,!1,U)}})(t,a,c,f,v):l.ct(c)?(function(w,E,D,R,O){if(w.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:U}=O,j=w.style.projection.useSubdivision,Z=w.getDepthModeForSublayer(0,cn.ReadOnly),W=w.colorModeForRenderPass();if(j){const[se,le,oe]=w.stencilConfigForOverlapTwoPass(R);Hs(w,E,D,oe,se,Z,W,!1,U),Hs(w,E,D,oe,le,Z,W,!0,U)}else{const[se,le]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Hs(w,E,D,le,se,Z,W,!1,U)}})(t,a,c,f,v):l.bU(c)?(function(w,E,D,R,O){if(w.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:U}=O,j=E.getSource(),Z=w.style.projection.useSubdivision;if(j instanceof Qi)Ca(w,E,D,R,null,!1,!1,j.tileCoords,j.flippedWindingOrder,U);else if(Z){const[W,se,le]=w.stencilConfigForOverlapTwoPass(R);Ca(w,E,D,le,W,!1,!0,$s,!1,U),Ca(w,E,D,le,se,!0,!0,$s,!1,U)}else{const[W,se]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Ca(w,E,D,se,W,!1,!0,$s,!1,U)}})(t,a,c,f,v):l.cu(c)?(function(w,E,D,R,O){const U=D.paint.get("background-color"),j=D.paint.get("background-opacity");if(j===0)return;const{isRenderingToTexture:Z}=O,W=w.context,se=W.gl,le=w.style.projection,oe=w.transform,ue=oe.tileSize,xe=D.paint.get("background-pattern");if(w.isPatternMissing(xe))return;const ce=!xe&&U.a===1&&j===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==ce)return;const _e=An.disabled,Se=w.getDepthModeForSublayer(0,ce==="opaque"?cn.ReadWrite:cn.ReadOnly),me=w.colorModeForRenderPass(),Ce=w.useProgram(xe?"backgroundPattern":"background"),qe=R||un(oe,{tileSize:ue,terrain:w.style.map.terrain});xe&&(W.activeTexture.set(se.TEXTURE0),w.imageManager.bind(w.context));const Fe=D.getCrossfadeParameters();for(const Ue of qe){const Ve=oe.getProjectionData({overscaledTileID:Ue,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),wt=xe?Qc(j,w,xe,{tileID:Ue,tileSize:ue},Fe):Wc(j,U),St=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ue),dt=le.getMeshFromTileID(W,Ue.canonical,!1,!0,"raster");Ce.draw(W,se.TRIANGLES,Se,_e,me,_n.backCCW,wt,St,Ve,D.id,dt.vertexBuffer,dt.indexBuffer,dt.segments)}})(t,0,c,f,v):l.cv(c)&&(function(w,E,D,R){const{isRenderingGlobe:O}=R,U=w.context,j=D.implementation,Z=w.style.projection,W=w.transform,se=W.getProjectionDataForCustomLayer(O),le={farZ:W.farZ,nearZ:W.nearZ,fov:W.fov*Math.PI/180,modelViewProjectionMatrix:W.modelViewProjectionMatrix,projectionMatrix:W.projectionMatrix,shaderData:{variantName:Z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Z.shaderPreludeCode.vertexSource}`,define:Z.shaderDefine},defaultProjectionData:se},oe=j.renderingMode?j.renderingMode:"2d";if(w.renderPass==="offscreen"){const ue=j.prerender;ue&&(w.setCustomLayerDefaults(),U.setColorMode(w.colorModeForRenderPass()),ue.call(j,U.gl,le),U.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),U.setColorMode(w.colorModeForRenderPass()),U.setStencilMode(An.disabled);const ue=oe==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,cn.ReadOnly);U.setDepthMode(ue),j.render(U.gl,le),U.setDirty(),w.setBaseState(),U.bindFramebuffer.set(null)}})(t,0,c,v))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!a||!c}useProgram(t,a,c=!1,f=[]){this.cache=this.cache||{};const v=!!this.style.map.terrain,w=this.style.projection,E=c?hi.projectionMercator:w.shaderPreludeCode,D=c?Ei:w.shaderDefine,R=t+(a?a.cacheKey:"")+`/${c?Rr:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[R]||(this.cache[R]=new Af(this.context,hi[t],a,kf[t],this._showOverdrawInspector,v,E,D,f)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const c in this._tileTextures){const f=this._tileTextures[c];if(f)for(const v of f)v.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const f=this.cache[c];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function dd(y,t){let a,c=!1,f=null,v=null;const w=()=>{f=null,c&&(y.apply(v,a),f=setTimeout(w,t),c=!1)};return(...E)=>(c=!0,v=this,a=E,f||w(),f)}class Ri{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(c=f)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const c=a.join("/");let f=c;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${c}`);let v=window.location.hash.replace(f,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let w=window.location.href.replace(/(#.+)?$/,v);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=dd(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,f),w=Math.round(a.lng*v)/v,E=Math.round(a.lat*v)/v,D=this._map.getBearing(),R=this._map.getPitch();let O="";if(O+=t?`/${w}/${E}/${c}`:`${c}/${E}/${w}`,(D||R)&&(O+="/"+Math.round(10*D)/10),R&&(O+=`/${Math.round(R)}`),this._hashName){const U=this._hashName;let j=!1;const Z=window.location.hash.slice(1).split("&").map((W=>{const se=W.split("=")[0];return se===U?(j=!0,`${se}=${O}`):W})).filter((W=>W));return j||Z.push(`${U}=${O}`),`#${Z.join("&")}`}return`#${O}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new l.V(+t[2],+t[1])}catch{return!1}const a=+t[0],c=+(t[3]||0),f=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const Ms={linearity:.3,easing:l.cw(0,0,.3,1)},nc=l.e({deceleration:2500,maxSpeed:1400},Ms),Sr=l.e({deceleration:20,maxSpeed:1400},Ms),fa=l.e({deceleration:1e3,maxSpeed:360},Ms),ll=l.e({deceleration:1e3,maxSpeed:90},Ms),Er=l.e({deceleration:1e3,maxSpeed:360},Ms);class Jp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:pe(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=pe();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,a.roll+=v.rollDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const v=au(a.pan.mag(),c,l.e({},nc,t||{})),w=a.pan.mult(v.amount/a.pan.mag()),E=this._map.cameraHelper.handlePanInertia(w,this._map.transform);f.center=E.easingCenter,f.offset=E.easingOffset,ic(f,v)}if(a.zoom){const v=au(a.zoom,c,Sr);f.zoom=this._map.transform.zoom+v.amount,ic(f,v)}if(a.bearing){const v=au(a.bearing,c,fa);f.bearing=this._map.transform.bearing+l.an(v.amount,-179,179),ic(f,v)}if(a.pitch){const v=au(a.pitch,c,ll);f.pitch=this._map.transform.pitch+v.amount,ic(f,v)}if(a.roll){const v=au(a.roll,c,Er);f.roll=this._map.transform.roll+l.an(v.amount,-179,179),ic(f,v)}if(f.zoom||f.bearing){const v=a.pinchAround===void 0?a.around:a.pinchAround;f.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),l.e(f,{noMoveStart:!0})}}function ic(y,t){(!y.duration||y.duration<t.duration)&&(y.duration=t.duration,y.easing=t.easing)}function au(y,t,a){const{maxSpeed:c,linearity:f,deceleration:v}=a,w=l.an(y*f/(t/1e3),-c,c),E=Math.abs(w)/(v*f);return{easing:a.easing,duration:1e3*E,amount:w*(E/2)}}class nr extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c,f={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const v=ie.mousePos(a.getCanvas(),c),w=a.unproject(v);super(t,l.e({point:v,lngLat:w,originalEvent:c},f)),this._defaultPrevented=!1,this.target=a}}class Xa extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){const f=t==="touchend"?c.changedTouches:c.touches,v=ie.touchPos(a.getCanvasContainer(),f),w=v.map((D=>a.unproject(D))),E=v.reduce(((D,R,O,U)=>D.add(R.div(U.length))),new l.P(0,0));super(t,{points:v,point:E,lngLats:w,lngLat:a.unproject(E),originalEvent:c}),this._defaultPrevented=!1}}class lh extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class ch{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new lh(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new nr(t.type,this._map,t))}mouseup(t){this._map.fire(new nr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new nr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new nr(t.type,this._map,t))}mouseover(t){this._map.fire(new nr(t.type,this._map,t))}mouseout(t){this._map.fire(new nr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Xa(t.type,this._map,t))}touchmove(t){this._map.fire(new Xa(t.type,this._map,t))}touchend(t){this._map.fire(new Xa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Xa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Of{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new nr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new nr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ya{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(l.P.convert(t),this._map.terrain)}}class Co{constructor(t,a){this._map=t,this._tr=new Ya(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(ie.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=c,this._box||(this._box=ie.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(f.x,c.x),w=Math.max(f.x,c.x),E=Math.min(f.y,c.y),D=Math.max(f.y,c.y);ie.setTransform(this._box,`translate(${v}px,${E}px)`),this._box.style.width=w-v+"px",this._box.style.height=D-E+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const c=this._startPos,f=a;if(this.reset(),ie.suppressClick(),c.x!==f.x||c.y!==f.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(c,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ie.remove(this._box),this._box=null),ie.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new l.l(t,{originalEvent:a}))}}function Hr(y,t){if(y.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${t.length}`);const a={};for(let c=0;c<y.length;c++)a[y[c].identifier]=t[c];return a}class Rt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){const v=new l.P(0,0);for(const w of f)v._add(w);return v.div(f.length)})(a),this.touches=Hr(c,a)))}touchmove(t,a,c){if(this.aborted||!this.centroid)return;const f=Hr(c,a);for(const v in this.touches){const w=f[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,a,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class su{constructor(t){this.singleTap=new Rt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,c){this.singleTap.touchstart(t,a,c)}touchmove(t,a,c){this.singleTap.touchmove(t,a,c)}touchend(t,a,c){const f=this.singleTap.touchend(t,a,c);if(f){const v=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(f)<30;if(v&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class uh{constructor(t){this._tr=new Ya(t),this._zoomIn=new su({numTouches:1,numTaps:2}),this._zoomOut=new su({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,c){this._zoomIn.touchstart(t,a,c),this._zoomOut.touchstart(t,a,c)}touchmove(t,a,c){this._zoomIn.touchmove(t,a,c),this._zoomOut.touchmove(t,a,c)}touchend(t,a,c){const f=this._zoomIn.touchend(t,a,c),v=this._zoomOut.touchend(t,a,c),w=this._tr;return f?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(f)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class za{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const f=Array.isArray(a)?a[0]:a;return!this._moved&&f.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(c,f))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&ie.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ka=0,rc=2,hh={[Ka]:1,[rc]:2};class As{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=ie.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,c){const f=hh[c];return a.buttons===void 0||(a.buttons&f)!==f})(t,this._eventButton)}isValidEndEvent(t){return ie.mouseButton(t)===this._eventButton}}class cl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class ou{constructor(t=new As({checkCorrectEvent:()=>!0}),a=new cl){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,c){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Cs=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=t=>{t.preventDefault()}};class dh{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,c){return this._calculateTransform(t,a,c)}touchmove(t,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,c){this._calculateTransform(t,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,c){c.length>0&&(this._active=!0);const f=Hr(c,a),v=new l.P(0,0),w=new l.P(0,0);let E=0;for(const R in f){const O=f[R],U=this._touches[R];U&&(v._add(O),w._add(O.sub(U)),E++,f[R]=O)}if(this._touches=f,this._shouldBePrevented(E)||!w.mag())return;const D=w.div(E);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,c){if(!this._firstTwoTouches)return;t.preventDefault();const[f,v]=this._firstTwoTouches,w=zs(c,a,f),E=zs(c,a,v);if(!w||!E)return;const D=this._aroundCenter?null:w.add(E).div(2);return this._move([w,E],D,t)}touchend(t,a,c){if(!this._firstTwoTouches)return;const[f,v]=this._firstTwoTouches,w=zs(c,a,f),E=zs(c,a,v);w&&E||(this._active&&ie.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function zs(y,t,a){for(let c=0;c<y.length;c++)if(y[c].identifier===a)return t[c]}function fd(y,t){return Math.log(y/t)/Math.LN2}class Ds extends lu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(fd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fd(this._distance,c),pinchAround:a}}}function fh(y,t){return 180*y.angleWith(t)/Math.PI}class cu extends lu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,c){const f=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fh(this._vector,f),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,c=fh(t,this._startVector);return Math.abs(c)<a}}function Ps(y){return Math.abs(y.y)>Math.abs(y.x)}class Ks extends lu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,c){super.touchstart(t,a,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Ps(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),v=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,v,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,v=a.mag()>=2;if(!f&&!v)return;if(!f||!v)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return Ps(t)&&Ps(a)&&w}}const Da={panStep:100,bearingStep:15,pitchStep:10};class jn{constructor(t){this._tr=new Ya(t);const a=Da;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,c=0,f=0,v=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:E=>{const D=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:pd,zoom:a?Math.round(D.zoom)+a*(t.shiftKey?2:1):D.zoom,bearing:D.bearing+c*this._bearingStep,pitch:D.pitch+f*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:D.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function pd(y){return y*(2-y)}const Ws=4.000244140625,zo=1/450;class uu{constructor(t,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new Ya(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=zo}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=pe(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%Ws==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ie.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(l.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const E=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=E),typeof this._targetZoom=="number"&&(this._targetZoom+=E)}if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Ws?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&D!==0&&(D=1/D);const R=typeof this._targetZoom!="number"?t.scale:l.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),l.at(R*D)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,f=this._easing;let v,w=!1;if(this._type==="wheel"&&c&&f){const E=pe()-this._lastWheelEventTime,D=Math.min((E+5)/200,1),R=f(D);v=l.G.number(c,a,R),D<1?this._frameId||(this._frameId=!0):w=!0}else v=a,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=v,{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=l.cy;if(this._prevEase){const c=this._prevEase,f=(pe()-c.start)/c.duration,v=c.easing(f+.01)-c.easing(f),w=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-w*w);a=l.cw(w,E,.25,1)}return this._prevEase={start:pe(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ph{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ul{constructor(t){this._tr=new Ya(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hu{constructor(){this._tap=new su({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,c){if(!this._swipePoint)if(this._tapTime){const f=a[0],v=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(f)<30;v&&w?c.length>0&&(this._swipePoint=f,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,a,c)}touchmove(t,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=a[0],v=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,a,c)}touchend(t,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const f=this._tap.touchend(t,a,c);f&&(this._tapTime=t.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class md{constructor(t,a,c){this._el=t,this._mousePan=a,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pa{constructor(t,a,c,f){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class hl{constructor(t,a,c,f){this._el=t,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Bt{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=ie.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=a,this._container.appendChild(f);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=c,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ie.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const qt=y=>y.zoom||y.drag||y.roll||y.pitch||y.rotate;class Pa extends l.l{}function ac(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta||y.rollDelta}class du{constructor(t,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,v)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=f.type==="renderFrame"?void 0:f,E={needsRenderFrame:!1},D={},R={};for(const{handlerName:j,handler:Z,allowed:W}of this._handlers){if(!Z.isEnabled())continue;let se;if(this._blockedByActive(R,W,j))Z.reset();else if(Z[v||f.type]){if(l.cz(f,v||f.type)){const le=ie.mousePos(this._map.getCanvas(),f);se=Z[v||f.type](f,le)}else if(l.cA(f,v||f.type)){const le=this._getMapTouches(f.touches),oe=ie.touchPos(this._map.getCanvas(),le);se=Z[v||f.type](f,oe,le)}else l.cB(v||f.type)||(se=Z[v||f.type](f));this.mergeHandlerResult(E,D,se,j,w),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||Z.isActive())&&(R[j]=Z)}const O={};for(const j in this._previousActiveHandlers)R[j]||(O[j]=w);this._previousActiveHandlers=R,(Object.keys(O).length||ac(E))&&(this._changes.push([E,D,O]),this._triggerRenderFrame()),(Object.keys(R).length||ac(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=E;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Jp(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,v,w]of this._listeners)ie.addEventListener(f,v,f===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,a,c]of this._listeners)ie.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new ch(a,t));const f=a.boxZoom=new Co(a,t);this._add("boxZoom",f),t.interactive&&t.boxZoom&&f.enable();const v=a.cooperativeGestures=new Bt(a,t.cooperativeGestures);this._add("cooperativeGestures",v),t.cooperativeGestures&&v.enable();const w=new uh(a),E=new ul(a);a.doubleClickZoom=new ph(E,w),this._add("tapZoom",w),this._add("clickZoom",E),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const D=new hu;this._add("tapDragZoom",D);const R=a.touchPitch=new Ks(a);this._add("touchPitch",R),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const O=()=>a.project(a.getCenter()),U=(function({enable:ce,clickTolerance:_e,aroundCenter:Se=!0,minPixelCenterThreshold:me=100,rotateDegreesPerPixelMoved:Ce=.8},qe){const Fe=new As({checkCorrectEvent:Ue=>ie.mouseButton(Ue)===0&&Ue.ctrlKey||ie.mouseButton(Ue)===2&&!Ue.ctrlKey});return new za({clickTolerance:_e,move:(Ue,Ve)=>{const wt=qe();if(Se&&Math.abs(wt.y-Ue.y)>me)return{bearingDelta:l.cx(new l.P(Ue.x,Ve.y),Ve,wt)};let St=(Ve.x-Ue.x)*Ce;return Se&&Ve.y<wt.y&&(St=-St),{bearingDelta:St}},moveStateManager:Fe,enable:ce,assignEvents:Cs})})(t,O),j=(function({enable:ce,clickTolerance:_e,pitchDegreesPerPixelMoved:Se=-.5}){const me=new As({checkCorrectEvent:Ce=>ie.mouseButton(Ce)===0&&Ce.ctrlKey||ie.mouseButton(Ce)===2});return new za({clickTolerance:_e,move:(Ce,qe)=>({pitchDelta:(qe.y-Ce.y)*Se}),moveStateManager:me,enable:ce,assignEvents:Cs})})(t),Z=(function({enable:ce,clickTolerance:_e,rollDegreesPerPixelMoved:Se=.3},me){const Ce=new As({checkCorrectEvent:qe=>ie.mouseButton(qe)===2&&qe.ctrlKey});return new za({clickTolerance:_e,move:(qe,Fe)=>{const Ue=me();let Ve=(Fe.x-qe.x)*Se;return Fe.y<Ue.y&&(Ve=-Ve),{rollDelta:Ve}},moveStateManager:Ce,enable:ce,assignEvents:Cs})})(t,O);a.dragRotate=new pa(t,U,j,Z),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",j,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Z,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const W=(function({enable:ce,clickTolerance:_e}){const Se=new As({checkCorrectEvent:me=>ie.mouseButton(me)===0&&!me.ctrlKey});return new za({clickTolerance:_e,move:(me,Ce)=>({around:Ce,panDelta:Ce.sub(me)}),activateOnStart:!0,moveStateManager:Se,enable:ce,assignEvents:Cs})})(t),se=new dh(t,a);a.dragPan=new md(c,W,se),this._add("mousePan",W),this._add("touchPan",se,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const le=new cu,oe=new Ds;a.touchZoomRotate=new hl(c,oe,le,D),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Of(a));const ue=a.scrollZoom=new uu(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ue,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const xe=a.keyboard=new jn(a);this._add("keyboard",xe),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,c){this._handlers.push({handlerName:t,handler:a,allowed:c}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,c){for(const f in t)if(f!==c&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const c of t)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(t,a,c,f,v){if(!c)return;l.e(t,c);const w={handlerName:f,originalEvent:c.originalEvent||v};c.zoomDelta!==void 0&&(a.zoom=w),c.panDelta!==void 0&&(a.drag=w),c.rollDelta!==void 0&&(a.roll=w),c.pitchDelta!==void 0&&(a.pitch=w),c.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},c={};for(const[f,v,w]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(t.rollDelta=(t.rollDelta||0)+f.rollDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),l.e(a,v),l.e(c,w);this._updateMapTransform(t,a,c),this._changes=[]}_updateMapTransform(t,a,c){const f=this._map,v=f._getTransformForUpdate(),w=f.terrain;if(!(ac(t)||w&&this._terrainMovement))return this._fireEvents(a,c,!0);f._stop(!0);let{panDelta:E,zoomDelta:D,bearingDelta:R,pitchDelta:O,rollDelta:U,around:j,pinchAround:Z}=t;Z!==void 0&&(j=Z),j=j||f.transform.centerPoint,w&&!v.isPointOnMapSurface(j)&&(j=v.centerPoint);const W={panDelta:E,zoomDelta:D,rollDelta:U,pitchDelta:O,bearingDelta:R,around:j};this._map.cameraHelper.useGlobeControls&&!v.isPointOnMapSurface(j)&&(j=v.centerPoint);const se=j.distSqr(v.centerPoint)<.01?v.center:v.screenPointToLocation(E?j.sub(E):j);this._handleMapControls({terrain:w,tr:v,deltasForHelper:W,preZoomAroundLoc:se,combinedEventsInProgress:a,panDelta:E}),f._applyUpdatedTransform(v),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,c,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:c,preZoomAroundLoc:f,combinedEventsInProgress:v,panDelta:w}){const E=this._map.cameraHelper;if(E.handleMapControlsRollPitchBearingZoom(c,a),t)return E.useGlobeControls?(this._terrainMovement||!v.drag&&!v.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void E.handleMapControlsPan(c,a,f)):this._terrainMovement||!v.drag&&!v.zoom?void(v.drag&&this._terrainMovement&&w?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(w))):E.handleMapControlsPan(c,a,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void E.handleMapControlsPan(c,a,f));E.handleMapControlsPan(c,a,f)}_fireEvents(t,a,c){const f=qt(this._eventsInProgress),v=qt(t),w={};for(const U in t){const{originalEvent:j}=t[U];this._eventsInProgress[U]||(w[`${U}start`]=j),this._eventsInProgress[U]=t[U]}!f&&v&&this._fireEvent("movestart",v.originalEvent);for(const U in w)this._fireEvent(U,w[U]);v&&this._fireEvent("move",v.originalEvent);for(const U in t){const{originalEvent:j}=t[U];this._fireEvent(U,j)}const E={};let D;for(const U in this._eventsInProgress){const{handlerName:j,originalEvent:Z}=this._eventsInProgress[U];this._handlersById[j].isActive()||(delete this._eventsInProgress[U],D=a[j]||Z,E[`${U}end`]=D)}for(const U in E)this._fireEvent(U,E[U]);const R=qt(this._eventsInProgress),O=(f||v)&&!R;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const U=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&U.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(U)}if(c&&O){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!U||!U.essential&&Ae.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:D})),j(this._map.getBearing())&&this._map.resetNorth()):(j(U.bearing||this._map.getBearing())&&(U.bearing=0),U.freezeElevation=!0,this._map.easeTo(U,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new l.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Pa("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Li extends l.E{constructor(t,a,c){super(),this._renderFrameCallback=()=>{const f=Math.min((pe()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new l.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,c){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},a),c)}panTo(t,a,c){return this.easeTo(l.e({center:t},a),c)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,c){return this.easeTo(l.e({zoom:t},a),c)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)).fire(new l.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,c){return this.easeTo(l.e({bearing:t},a),c)}resetNorth(t,a){return this.rotateTo(0,l.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=Yn.convert(t).adjustAntiMeridian();const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,a)}_cameraForBoxAndBearing(t,a,c,f){const v={top:0,bottom:0,right:0,left:0};if(typeof(f=l.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const R=f.padding;f.padding={top:R,bottom:R,right:R,left:R}}const w=l.e(v,f.padding);f.padding=w;const E=this.transform,D=new Yn(t,a);return this.cameraHelper.cameraForBoxAndBearing(f,w,D,c,E)}fitBounds(t,a,c){return this._fitInternal(this.cameraForBounds(t,a),a,c)}fitScreenCoordinates(t,a,c,f,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(t)),this.transform.screenPointToLocation(l.P.convert(a)),c,f),f,v)}_fitInternal(t,a,c){return t?(delete(a=l.e(t,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(t,a){this.stop();const c=this._getTransformForUpdate();let f=!1,v=!1,w=!1;const E=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const D=c.zoom!==E;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(f=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(v=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(w=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)),D&&this.fire(new l.l("zoomstart",a)).fire(new l.l("zoom",a)).fire(new l.l("zoomend",a)),f&&this.fire(new l.l("rotatestart",a)).fire(new l.l("rotate",a)).fire(new l.l("rotateend",a)),v&&this.fire(new l.l("pitchstart",a)).fire(new l.l("pitch",a)).fire(new l.l("pitchend",a)),w&&this.fire(new l.l("rollstart",a)).fire(new l.l("roll",a)).fire(new l.l("rollend",a)),this.fire(new l.l("moveend",a))}calculateCameraOptionsFromTo(t,a,c,f=0){const v=l.a9.fromLngLat(t,a),w=l.a9.fromLngLat(c,f),E=w.x-v.x,D=w.y-v.y,R=w.z-v.z,O=Math.hypot(E,D,R);if(O===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(E,D),j=l.at(this.transform.cameraToCenterDistance/O/this.transform.tileSize),Z=180*Math.atan2(E,-D)/Math.PI;let W=180*Math.acos(U/O)/Math.PI;return W=R<0?90-W:90+W,{center:w.toLngLat(),elevation:f,zoom:j,pitch:W,bearing:Z}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,c,f,v){const w=this.transform.calculateCenterFromCameraLngLatAlt(t,a,c,f);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:c,pitch:f,roll:v}}easeTo(t,a){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.cy},t)).animate===!1||!t.essential&&Ae.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getBearing(),v=c.pitch,w=c.roll,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,D="pitch"in t?+t.pitch:v,R="roll"in t?this._normalizeBearing(t.roll,w):w,O="padding"in t?t.padding:c.padding,U=l.P.convert(t.offset);let j,Z;t.around&&(j=l.V.convert(t.around),Z=c.locationToScreenPoint(j));const W={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(c,{bearing:E,pitch:D,roll:R,padding:O,around:j,aroundPoint:Z,offsetAsPoint:U,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||f!==E,this._pitching=this._pitching||D!==v,this._rolling=this._rolling||R!==w,this._padding=!c.isPaddingEqual(O),this._zooming=this._zooming||se.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,W),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease((le=>{se.easeFunc(le),this.terrain&&!t.freezeElevation&&this._updateElevation(le),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(le=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,le)}),t),this}_prepareEase(t,a,c={}){this._moving=!0,a||c.moving||this.fire(new l.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new l.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new l.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new l.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new l.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(a-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(l.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),c=t.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(c<f){const v=this.calculateCameraOptionsFromTo(a,f,t.center,t.elevation);return{pitch:v.pitch,zoom:v.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&a.push((f=>this.transformCameraUpdate(f))),!a.length)return;const c=t.clone();for(const f of a){const v=c.clone(),{center:w,zoom:E,roll:D,pitch:R,bearing:O,elevation:U}=f(v);w&&v.setCenter(w),U!==void 0&&v.setElevation(U),E!==void 0&&v.setZoom(E),D!==void 0&&v.setRoll(D),R!==void 0&&v.setPitch(R),O!==void 0&&v.setBearing(O),c.apply(v)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new l.l("move",t)),this._zooming&&this.fire(new l.l("zoom",t)),this._rotating&&this.fire(new l.l("rotate",t)),this._pitching&&this.fire(new l.l("pitch",t)),this._rolling&&this.fire(new l.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,f=this._rotating,v=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new l.l("zoomend",t)),f&&this.fire(new l.l("rotateend",t)),v&&this.fire(new l.l("pitchend",t)),w&&this.fire(new l.l("rollend",t)),this.fire(new l.l("moveend",t))}flyTo(t,a){if(!t.essential&&Ae.prefersReducedMotion){const Ve=l.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ve,a)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cy},t);const c=this._getTransformForUpdate(),f=c.bearing,v=c.pitch,w=c.roll,E=c.padding,D="bearing"in t?this._normalizeBearing(t.bearing,f):f,R="pitch"in t?+t.pitch:v,O="roll"in t?this._normalizeBearing(t.roll,w):w,U="padding"in t?t.padding:c.padding,j=l.P.convert(t.offset);let Z=c.centerPoint.add(j);const W=c.screenPointToLocation(Z),se=this.cameraHelper.handleFlyTo(c,{bearing:D,pitch:R,roll:O,padding:U,locationAtOffset:W,offsetAsPoint:j,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let le=t.curve;const oe=Math.max(c.width,c.height),ue=oe/se.scaleOfZoom,xe=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(le=Math.sqrt(oe/se.scaleOfMinZoom/xe*2));const ce=le*le;function _e(Ve){const wt=(ue*ue-oe*oe+(Ve?-1:1)*ce*ce*xe*xe)/(2*(Ve?ue:oe)*ce*xe);return Math.log(Math.sqrt(wt*wt+1)-wt)}function Se(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function me(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Ce=_e(!1);let qe=function(Ve){return me(Ce)/me(Ce+le*Ve)},Fe=function(Ve){return oe*((me(Ce)*(Se(wt=Ce+le*Ve)/me(wt))-Se(Ce))/ce)/xe;var wt},Ue=(_e(!0)-Ce)/le;if(Math.abs(xe)<2e-6||!isFinite(Ue)){if(Math.abs(oe-ue)<1e-6)return this.easeTo(t,a);const Ve=ue<oe?-1:1;Ue=Math.abs(Math.log(ue/oe))/le,Fe=()=>0,qe=wt=>Math.exp(Ve*le*wt)}return t.duration="duration"in t?+t.duration:1e3*Ue/("screenSpeed"in t?+t.screenSpeed/le:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==D,this._pitching=R!==v,this._rolling=O!==w,this._padding=!c.isPaddingEqual(U),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease((Ve=>{const wt=Ve*Ue,St=1/qe(wt),dt=Fe(wt);this._rotating&&c.setBearing(l.G.number(f,D,Ve)),this._pitching&&c.setPitch(l.G.number(v,R,Ve)),this._rolling&&c.setRoll(l.G.number(w,O,Ve)),this._padding&&(c.interpolatePadding(E,U,Ve),Z=c.centerPoint.add(j)),se.easeFunc(Ve,St,dt,Z),this.terrain&&!t.freezeElevation&&this._updateElevation(Ve),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,a)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,a,c){c.animate===!1||c.duration===0?(t(1),a()):(this._easeStart=pe(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=l.W(t,-180,180);const c=Math.abs(t-a);return Math.abs(t-360-a)<c&&(t-=360),Math.abs(t+360-a)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(l.V.convert(t),this.transform):null}}const vi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ai{constructor(t=vi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=ie.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ie.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ie.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ie.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const c=this._map._getUIString(`AttributionControl.${a}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.tileManagers;for(const f in a){const v=a[f];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter((f=>String(f).trim())),t.sort(((f,v)=>f.length-v.length)),t=t.filter(((f,v)=>{for(let w=v+1;w<t.length;w++)if(t[w].indexOf(f)>=0)return!1;return!0}));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=ie.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class fu{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=ie.create("div","maplibregl-ctrl");const a=ie.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ie.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var yn=l.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Nn extends l.E{constructor(t){super(),this._lastTilesetChange=pe(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const c={};for(const f of un(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),l.c7(f.terrainRttPosMatrix32f,0,l.a5,l.a5,0,0,1),this._tiles[f.key]=new Qe(f,this.tileSize),this._lastTilesetChange=pe());for(const f in this._tiles)c[f]||delete this._tiles[f]}freeRtt(t){for(const a in this._tiles){const c=this._tiles[a];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const c of this._renderableTilesKeys){const f=this._tiles[c].tileID,v=t.clone(),w=l.bk();if(f.canonical.equals(t.canonical))l.c7(w,0,l.a5,l.a5,0,0,1);else if(f.canonical.isChildOf(t.canonical)){const E=f.canonical.z-t.canonical.z,D=f.canonical.x-(f.canonical.x>>E<<E),R=f.canonical.y-(f.canonical.y>>E<<E),O=l.a5>>E;l.c7(w,0,O,O,0,0,1),l.O(w,w,[-D*O,-R*O,0])}else{if(!t.canonical.isChildOf(f.canonical))continue;{const E=t.canonical.z-f.canonical.z,D=t.canonical.x-(t.canonical.x>>E<<E),R=t.canonical.y-(t.canonical.y>>E<<E),O=l.a5>>E;l.c7(w,0,l.a5,l.a5,0,0,1),l.O(w,w,[D*O,R*O,0]),l.Q(w,w,[1/2**E,1/2**E,0])}}v.terrainRttPosMatrix32f=new Float32Array(w),a[c]=v}return a}_getTerrainCoordsForTileRanges(t,a){const c={};for(const f of this._renderableTilesKeys){const v=this._tiles[f].tileID;if(!this._isWithinTileRanges(v,a))continue;const w=t.clone(),E=l.bk();if(v.canonical.z===t.canonical.z){const D=t.canonical.x-v.canonical.x,R=t.canonical.y-v.canonical.y;l.c7(E,0,l.a5,l.a5,0,0,1),l.O(E,E,[D*l.a5,R*l.a5,0])}else if(v.canonical.z>t.canonical.z){const D=v.canonical.z-t.canonical.z,R=v.canonical.x-(v.canonical.x>>D<<D),O=v.canonical.y-(v.canonical.y>>D<<D),U=t.canonical.x-(v.canonical.x>>D),j=t.canonical.y-(v.canonical.y>>D),Z=l.a5>>D;l.c7(E,0,Z,Z,0,0,1),l.O(E,E,[-R*Z+U*l.a5,-O*Z+j*l.a5,0])}else{const D=t.canonical.z-v.canonical.z,R=t.canonical.x-(t.canonical.x>>D<<D),O=t.canonical.y-(t.canonical.y>>D<<D),U=(t.canonical.x>>D)-v.canonical.x,j=(t.canonical.y>>D)-v.canonical.y,Z=l.a5<<D;l.c7(E,0,Z,Z,0,0,1),l.O(E,E,[R*l.a5+U*Z,O*l.a5+j*Z,0])}w.terrainRttPosMatrix32f=new Float32Array(E),c[f]=w}return c}getSourceTile(t,a){const c=this.tileManager._source;let f=t.overscaledZ-this.deltaZoom;if(f>c.maxzoom&&(f=c.maxzoom),f<c.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let v=this.findTileInCaches(this._sourceTileCache[t.key]);if(!v?.dem&&a)for(;f>=c.minzoom&&!v?.dem;)v=this.findTileInCaches(t.scaledTo(f--).key);return v}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class mn{constructor(t,a,c){this._meshCache={},this.painter=t,this.tileManager=new Nn(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,c,f=l.a5){var v;if(!(a>=0&&a<f&&c>=0&&c<f))return 0;const w=this.getTerrainData(t),E=(v=w.tile)===null||v===void 0?void 0:v.dem;if(!E)return 0;const D=l.cC([],[a/f*l.a5,c/f*l.a5],w.u_terrain_matrix),R=[D[0]*E.dim,D[1]*E.dim],O=Math.floor(R[0]),U=Math.floor(R[1]),j=R[0]-O,Z=R[1]-U;return E.get(O,U)*(1-j)*(1-Z)+E.get(O+1,U)*j*(1-Z)+E.get(O,U+1)*(1-j)*Z+E.get(O+1,U+1)*j*Z}getElevationForLngLatZoom(t,a){if(!l.cD(a,t.wrap()))return 0;const{tileID:c,mercatorX:f,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(c,f%l.a5,v%l.a5,l.a5)}getElevationForLngLat(t,a){const c=un(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let f=0;for(const v of c)v.canonical.z>f&&(f=Math.min(v.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,f)}getElevation(t,a,c,f=l.a5){return this.getDEMElevation(t,a,c,f)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.painter.context,v=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(f,v,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(f,new l.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new l.T(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a.toString()+a.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const f=this.tileManager.getSource().maxzoom;let v=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?v=t.canonical.z-f:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>v<<v),E=t.canonical.y-(t.canonical.y>>v<<v),D=l.cE(new Float64Array(16),[1/(l.a5<<v),1/(l.a5<<v),0]);l.O(D,D,[w*l.a5,E*l.a5,0]),this._demMatrixCache[t.key]={matrix:D,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,c=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let E=0;E<this._coordsTextureSize;E++,w+=4)a[w+0]=255&E,a[w+1]=255&v,a[w+2]=E>>8<<4|v>>8,a[w+3]=0;const c=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new l.T(t,c,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),c=this.painter.context,f=c.gl,v=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(v,E-w-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const D=a[0]+(a[2]>>4<<8),R=a[1]+((15&a[2])<<8),O=this.coordsIndex[255-a[3]],U=O&&this.tileManager.getTileByID(O);if(!U)return null;const j=this._coordsTextureSize,Z=(1<<U.tileID.canonical.z)*j;return new l.a9((U.tileID.canonical.x*j+D)/Z+U.tileID.wrap,(U.tileID.canonical.y*j+R)/Z,this.getElevation(U.tileID,D,R,j))}depthAtPoint(t){const a=new Uint8Array(4),c=this.painter.context,f=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,f=c&&t.canonical.y===0,v=c&&t.canonical.y===(1<<t.canonical.z)-1,w=`m_${f?"n":""}_${v?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const E=this.painter.context,D=new l.cF,R=new l.aY,O=this.meshSize,U=l.a5/O,j=O*O;for(let me=0;me<=O;me++)for(let Ce=0;Ce<=O;Ce++)D.emplaceBack(Ce*U,me*U,0);for(let me=0;me<j;me+=O+1)for(let Ce=0;Ce<O;Ce++)R.emplaceBack(Ce+me,O+Ce+me+1,O+Ce+me+2),R.emplaceBack(Ce+me,O+Ce+me+2,Ce+me+1);const Z=D.length,W=Z+(O+1),se=(O+1)*O,le=f?l.br:0,oe=f?0:1,ue=v?l.bs:l.a5,xe=v?0:1;for(let me=0;me<=O;me++)D.emplaceBack(me*U,le,oe);for(let me=0;me<=O;me++)D.emplaceBack(me*U,ue,xe);for(let me=0;me<O;me++)R.emplaceBack(se+me,W+me,W+me+1),R.emplaceBack(se+me,W+me+1,se+me+1),R.emplaceBack(0+me,Z+me+1,Z+me),R.emplaceBack(0+me,0+me+1,Z+me+1);const ce=D.length,_e=ce+2*(O+1);for(const me of[0,1])for(let Ce=0;Ce<=O;Ce++)for(const qe of[0,1])D.emplaceBack(me*l.a5,Ce*U,qe);for(let me=0;me<2*O;me+=2)R.emplaceBack(ce+me,ce+me+1,ce+me+3),R.emplaceBack(ce+me,ce+me+3,ce+me+2),R.emplaceBack(_e+me,_e+me+3,_e+me+1),R.emplaceBack(_e+me,_e+me+2,_e+me+3);const Se=new Kn(E.createVertexBuffer(D,yn.members),E.createIndexBuffer(R),l.aX.simpleSegment(0,0,D.length,R.length));return this._meshCache[w]=Se,Se}getMeshFrameDelta(t){return 2*Math.PI*l.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var c;if(!l.cD(a,t.wrap()))return 0;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(c=this.getMinMaxElevation(f).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,a){const c=l.a9.fromLngLat(t.wrap()),f=(1<<a)*l.a5,v=c.x*f,w=c.y*f,E=Math.floor(v/l.a5),D=Math.floor(w/l.a5);return{tileID:new l.a2(a,0,a,E,D),mercatorX:v,mercatorY:w}}}class pi{constructor(t,a,c){this._context=t,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:t,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Ia={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Wa{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new pi(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((c=>!t._layers[c].isHidden(a))),this._coordsAscending={};for(const c in t.tileManagers){this._coordsAscending[c]={};const f=t.tileManagers[c].getVisibleCoordinates(),v=t.tileManagers[c].getSource(),w=v instanceof Qi?v.terrainTileRanges:null;for(const E of f){const D=this.terrain.tileManager.getTerrainCoords(E,w);for(const R in D)this._coordsAscending[c][R]||(this._coordsAscending[c][R]=[]),this._coordsAscending[c][R].push(D[R])}}this._coordsAscendingStr={};for(const c of t._order){const f=t._layers[c],v=f.source;if(Ia[f.type]&&!this._coordsAscendingStr[v]){this._coordsAscendingStr[v]={};for(const w in this._coordsAscending[v])this._coordsAscendingStr[v][w]=this._coordsAscending[v][w].map((E=>E.key)).sort().join()}}for(const c of this._renderableTiles)for(const f in this._coordsAscendingStr){const v=this._coordsAscendingStr[f][c.tileID.key];v&&v!==c.rttCoords[f]&&(c.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),f=t.type,v=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ia[f]&&(this._prevType&&Ia[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(t.id),!w))return!0;if(Ia[this._prevType]||Ia[f]&&w){this._prevType=f;const E=this._stacks.length-1,D=this._stacks[E]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(oh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[E]){const U=this.pool.getObjectForId(R.rtt[E].id);if(U.stamp===R.rtt[E].stamp){this.pool.useObject(U);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),R.rtt[E]={id:O.id,stamp:O.stamp},v.context.bindFramebuffer.set(O.fbo.framebuffer),v.context.clear({color:l.bp.transparent,stencil:0}),v.currentStencilSource=void 0;for(let U=0;U<D.length;U++){const j=v.style._layers[D[U]],Z=j.source?this._coordsAscending[j.source][R.tileID.key]:[R.tileID];v.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),v._renderTileClippingMasks(j,Z,!0),v.renderLayer(v,v.style.tileManagers[j.source],j,Z,c),j.source&&(R.rttCoords[j.source]=this._coordsAscendingStr[j.source][R.tileID.key])}}return oh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),Ia[f]}return!1}}const dl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},fl=N,Js={hash:!1,interactive:!0,bearingSnap:7,attributionControl:vi,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},gd={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class li{constructor(t,a,c=!1){this.mousedown=v=>{this.startMove(v,ie.mousePos(this.element,v)),ie.addEventListener(window,"mousemove",this.mousemove),ie.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.move(v,ie.mousePos(this.element,v))},this.mouseup=v=>{this._rotatePitchHandler.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ie.touchPos(this.element,v.targetTouches)[0],this.startMove(v,this._startPos),ie.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=ie.touchPos(this.element,v.targetTouches)[0],this.move(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const f=new ou;this._rotatePitchHandler=new za({clickTolerance:3,move:(v,w)=>{const E=a.getBoundingClientRect(),D=new l.P((E.bottom-E.top)/2,(E.right-E.left)/2);return{bearingDelta:l.cx(new l.P(v.x,w.y),w,D),pitchDelta:c?-.5*(w.y-v.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=t,ie.addEventListener(a,"mousedown",this.mousedown),ie.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),ie.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),ie.disableDrag()}move(t,a){const c=this.map,{bearingDelta:f,pitchDelta:v}=this._rotatePitchHandler.dragMove(t,a)||{};f&&c.setBearing(c.getBearing()+f),v&&c.setPitch(c.getPitch()+v)}off(){const t=this.element;ie.removeEventListener(t,"mousedown",this.mousedown),ie.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.removeEventListener(window,"touchend",this.touchend),ie.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ie.enableDrag(),ie.removeEventListener(window,"mousemove",this.mousemove),ie.removeEventListener(window,"mouseup",this.mouseup),ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.removeEventListener(window,"touchend",this.touchend)}}let Qa;function sc(y,t,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return y?.wrap();const f=new l.V(y.lng,y.lat);if(y=new l.V(y.lng,y.lat),t){const v=new l.V(y.lng-360,y.lat),w=new l.V(y.lng+360,y.lat),E=a.locationToScreenPoint(y).distSqr(t);a.locationToScreenPoint(v).distSqr(t)<E?y=v:a.locationToScreenPoint(w).distSqr(t)<E&&(y=w)}for(;Math.abs(y.lng-a.center.lng)>180;){const v=a.locationToScreenPoint(y);if(v.x>=0&&v.y>=0&&v.x<=a.width&&v.y<=a.height)break;y.lng>a.center.lng?y.lng-=360:y.lng+=360}return y.lng!==f.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(y))?y:f}const oc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pu(y,t,a){const c=y.classList;for(const f in oc)c.remove(`maplibregl-${a}-anchor-${f}`);c.add(`maplibregl-${a}-anchor-${t}`)}class mu extends l.E{constructor(t){if(super(),this._onKeyPress=a=>{const c=a.code,f=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=sc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),ie.setTransform(this._element,`${oc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${f}`),Ae.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie.create("div");const a=ie.createNS("http://www.w3.org/2000/svg","svg"),c=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${c}`);const v=ie.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const w=ie.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const E=ie.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of D){const ue=ie.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",oe.rx),ue.setAttributeNS(null,"ry",oe.ry),E.appendChild(ue)}const R=ie.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const O=ie.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(O);const U=ie.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const j=ie.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(j);const Z=ie.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const W=ie.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=ie.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const le=ie.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),W.appendChild(se),W.appendChild(le),w.appendChild(E),w.appendChild(R),w.appendChild(U),w.appendChild(Z),w.appendChild(W),a.appendChild(w),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),pu(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ie.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,c;const f=(a=this._map)===null||a===void 0?void 0:a.terrain,v=this._map.transform.isLocationOccluded(this._lngLat);if(!f||v){const Z=v?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const w=this._map,E=w.terrain.depthAtPoint(this._pos),D=w.terrain.getElevationForLngLat(this._lngLat,w.transform);if(w.transform.lngLatToCameraDepth(this._lngLat,D)-E<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/w.transform.pixelsPerMeter,O=Math.sin(w.getPitch()*Math.PI/180)*R,U=w.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),j=w.transform.lngLatToCameraDepth(this._lngLat,D+O)-U>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&j&&this._popup.remove(),this._element.style.opacity=j?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const gu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Do=0,eo=!1;const gr={maxWidth:100,unit:"metric"};function mi(y,t,a){const c=a&&a.maxWidth||100,f=y._container.clientHeight/2,v=y._container.clientWidth/2,w=y.unproject([v-c/2,f]),E=y.unproject([v+c/2,f]),D=Math.round(y.project(E).x-y.project(w).x),R=Math.min(c,D,y._container.clientWidth),O=w.distanceTo(E);if(a&&a.unit==="imperial"){const U=3.2808*O;U>5280?Is(t,R,U/5280,y._getUIString("ScaleControl.Miles")):Is(t,R,U,y._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Is(t,R,O/1852,y._getUIString("ScaleControl.NauticalMiles")):O>=1e3?Is(t,R,O/1e3,y._getUIString("ScaleControl.Kilometers")):Is(t,R,O,y._getUIString("ScaleControl.Meters"))}function Is(y,t,a,c){const f=(function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let E=v/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(D){const R=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*R)/R})(E),w*E})(a);y.style.width=t*(f/a)+"px",y.innerHTML=`${f}&nbsp;${c}`}const pl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ml=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lc(y){if(y){if(typeof y=="number"){const t=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,y),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-y),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(y,0),right:new l.P(-y,0)}}if(y instanceof l.P||Array.isArray(y)){const t=l.P.convert(y);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(y.center||[0,0]),top:l.P.convert(y.top||[0,0]),"top-left":l.P.convert(y["top-left"]||[0,0]),"top-right":l.P.convert(y["top-right"]||[0,0]),bottom:l.P.convert(y.bottom||[0,0]),"bottom-left":l.P.convert(y["bottom-left"]||[0,0]),"bottom-right":l.P.convert(y["bottom-right"]||[0,0]),left:l.P.convert(y.left||[0,0]),right:l.P.convert(y.right||[0,0])}}return lc(new l.P(0,0))}const Ja=N;A.AJAXError=l.cI,A.Event=l.l,A.Evented=l.E,A.LngLat=l.V,A.MercatorCoordinate=l.a9,A.Point=l.P,A.addProtocol=l.cJ,A.config=l.c,A.removeProtocol=l.cK,A.AttributionControl=Ai,A.BoxZoomHandler=Co,A.CanvasSource=H,A.CooperativeGesturesHandler=Bt,A.DoubleClickZoomHandler=ph,A.DragPanHandler=md,A.DragRotateHandler=pa,A.EdgeInsets=aa,A.FullscreenControl=class extends l.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ie.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=ie.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ie.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},A.GeoJSONSource=Ti,A.GeolocateControl=class extends l.E{constructor(y){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new l.V(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,f=this._map.getBearing(),v=l.e({bearing:f},this.options.fitBoundsOptions),w=Yn.fromLngLat(a,c);this._map.fitBounds(w,v,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new l.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&eo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=ie.create("button","maplibregl-ctrl-geolocate",this._container),ie.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new mu({element:this._dotElement}),this._circleElement=ie.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new mu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},gu,y)}onAdd(y){return this._map=y,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(t=!1){if(Qa!==void 0&&!t)return Qa;if(window.navigator.permissions===void 0)return Qa=!!window.navigator.geolocation,Qa;try{Qa=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Qa=!!window.navigator.geolocation}return Qa}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ie.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Do=0,eo=!1}_isOutOfMapMaxBounds(y){const t=this._map.getMaxBounds(),a=y.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const y=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&y))return;const t=this._map.project(y),a=this._map.unproject([t.x+100,t.y]),c=y.distanceTo(a)/100,f=2*this._accuracy/c;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Do--,eo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Do++,Do>1?(y={maximumAge:6e5,timeout:0},eo=!0):(y=this.options.positionOptions,eo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},A.GlobeControl=class{constructor(){this._toggleProjection=()=>{var y;const t=(y=this._map.getProjection())===null||y===void 0?void 0:y.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var y;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((y=this._map.getProjection())===null||y===void 0?void 0:y.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(y){return this._map=y,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ie.create("button","maplibregl-ctrl-globe",this._container),ie.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ie.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},A.Hash=Ri,A.ImageSource=Qi,A.KeyboardHandler=jn,A.LngLatBounds=Yn,A.LogoControl=fu,A.Map=class extends Li{constructor(y){var t,a;l.cG.mark(l.cH.create);const c=Object.assign(Object.assign(Object.assign({},Js),y),{canvasContextAttributes:Object.assign(Object.assign({},Js.canvasContextAttributes),y.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new Hi,v=new Wo;if(c.minZoom!==void 0&&f.setMinZoom(c.minZoom),c.maxZoom!==void 0&&f.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&f.setMinPitch(c.minPitch),c.maxPitch!==void 0&&f.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&f.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&f.setConstrainOverride(c.transformConstrain),super(f,v,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Qs,this._controls=[],this._mapId=l.af(),this._lostContextStyle={style:null,images:null},this._contextLost=E=>{E.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const D of Object.values(this.style._layers))if(D.type==="custom"&&console.warn(`Custom layer with id '${D.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),D._listeners)for(const[R]of Object.entries(D._listeners))console.warn(`Custom layer with id '${D.id}' had event listeners for event '${R}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new l.l("webglcontextlost",{originalEvent:E}))},this._contextRestored=E=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:E}))},this._onMapScroll=E=>{if(E.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},dl),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(Ae.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=at.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ie(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let E=!1;const D=dd((R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())}),50);this._resizeObserver=new ResizeObserver((R=>{E?D(R):E=!0})),this._resizeObserver.observe(this._container)}this.handlers=new du(this,c),this._hash=c.hash&&new Ri(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,l.e({},c.fitBoundsOptions,{duration:0}))));const w=typeof c.style=="string"||((a=(t=c.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Ai(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new fu,c.logoPosition),this.on("style.load",(()=>{if(w||this._resizeTransform(),this.transform.unmodified){const E=l.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(E)}})),this.on("data",(E=>{this._update(E.dataType==="style"),this.fire(new l.l(`${E.dataType}data`,E))})),this.on("dataloading",(E=>{this.fire(new l.l(`${E.dataType}dataloading`,E))})),this.on("dataabort",(E=>{this.fire(new l.l("sourcedataabort",E))}))}_getMapId(){return this._mapId}setGlobalStateProperty(y,t){return this.style.setGlobalStateProperty(y,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(y,t){if(t===void 0&&(t=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=y.onAdd(this);this._controls.push(y);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(y);return t>-1&&this._controls.splice(t,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}coveringTiles(y){return un(this.transform,y)}calculateCameraOptionsFromTo(y,t,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(y,t,a,c)}resize(y,t=!0){const[a,c]=this._containerDimensions(),f=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,f),this.painter.resize(a,c,f),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const E=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,E),this.painter.resize(a,c,E)}this._resizeTransform(t);const v=!this._moving;return v&&(this.stop(),this.fire(new l.l("movestart",y)).fire(new l.l("move",y))),this.fire(new l.l("resize",y)),v&&this.fire(new l.l("moveend",y)),this}_resizeTransform(y=!0){var t;const[a,c]=this._containerDimensions();this.transform.resize(a,c,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c,y)}_getClampedPixelRatio(y,t){const{0:a,1:c}=this._maxCanvasSize,f=this.getPixelRatio(),v=y*f,w=t*f;return Math.min(v>a?a/v:1,w>c?c/w:1)*f}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Yn.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.setMinPitch(y),this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(y>=this.transform.minPitch)return this.transform.setMaxPitch(y),this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.setRenderWorldCopies(y),this._update()}setTransformConstrain(y){return this.transform.setConstrainOverride(y),this._update()}project(y){return this.transform.locationToScreenPoint(l.V.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.screenPointToLocation(l.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,t,a){if(y==="mouseenter"||y==="mouseover"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:v=>{const w=t.filter((D=>this.getLayer(D))),E=w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[];E.length?c||(c=!0,a.call(this,new nr(y,this,v.originalEvent,{features:E}))):c=!1},mouseout:()=>{c=!1}}}}if(y==="mouseleave"||y==="mouseout"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:w=>{const E=t.filter((D=>this.getLayer(D)));(E.length!==0?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?c=!0:c&&(c=!1,a.call(this,new nr(y,this,w.originalEvent)))},mouseout:w=>{c&&(c=!1,a.call(this,new nr(y,this,w.originalEvent)))}}}}{const c=f=>{const v=t.filter((E=>this.getLayer(E))),w=v.length!==0?this.queryRenderedFeatures(f.point,{layers:v}):[];w.length&&(f.features=w,a.call(this,f),delete f.features)};return{layers:t,listener:a,delegates:{[y]:c}}}}_saveDelegatedListener(y,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(t)}_removeDelegatedListener(y,t,a){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const c=this._delegatedListeners[y];for(let f=0;f<c.length;f++){const v=c[f];if(v.listener===a&&v.layers.length===t.length&&v.layers.every((w=>t.includes(w)))){for(const w in v.delegates)this.off(w,v.delegates[w]);return void c.splice(f,1)}}}on(y,t,a){if(a===void 0)return super.on(y,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(y,c,a);this._saveDelegatedListener(y,f);for(const v in f.delegates)this.on(v,f.delegates[v]);return{unsubscribe:()=>{this._removeDelegatedListener(y,c,a)}}}once(y,t,a){if(a===void 0)return super.once(y,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(y,c,a);for(const v in f.delegates){const w=f.delegates[v];f.delegates[v]=(...E)=>{this._removeDelegatedListener(y,c,a),w(...E)}}this._saveDelegatedListener(y,f);for(const v in f.delegates)this.once(v,f.delegates[v]);return this}off(y,t,a){return a===void 0?super.off(y,t):(this._removeDelegatedListener(y,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(y,t){if(!this.style)return[];let a;const c=y instanceof l.P||Array.isArray(y),f=c?y:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:y)||{},f instanceof l.P||typeof f[0]=="number")a=[l.P.convert(f)];else{const v=l.P.convert(f[0]),w=l.P.convert(f[1]);a=[v,new l.P(w.x,v.y),w,new l.P(v.x,w.y),v]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(y,t){return this.style.querySourceFeatures(y,t)}setStyle(y,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(y,t))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const t=this._locale[y];if(t==null)throw new Error(`Missing UI string '${y}'`);return t}_updateStyle(y,t){var a,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(y,t)));const f=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new _o(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,t,f):this.style.loadJSON(y,t,f),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new _o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,t){if(typeof y=="string"){const a=this._requestManager.transformRequest(y,"Style");l.j(a,new AbortController).then((c=>{this._updateDiff(c.data,t)})).catch((c=>{c&&this.fire(new l.k(c))}))}else typeof y=="object"&&this._updateDiff(y,t)}_updateDiff(y,t){try{this.style.setState(y,t)&&this._update(!0)}catch(a){l.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(y,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(y,t){return this._lazyInitEmptyStyle(),this.style.addSource(y,t),this._update(!0)}isSourceLoaded(y){const t=this.style&&this.style.tileManagers[y];if(t!==void 0)return t.loaded();this.fire(new l.k(new Error(`There is no tile manager with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const t=this.style.tileManagers[y.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===y.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===y.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new mn(this.painter,t,y),this.painter.renderToTexture=new Wa(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==y.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:y})),this}getTerrain(){var y,t;return(t=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const y=this.style&&this.style.tileManagers;for(const t of Object.values(y))if(!t.areTilesLoaded())return!1;return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}setSourceTileLodParams(y,t,a){if(a){const c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=tn(Math.max(1,y),Math.max(1,t))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=tn(Math.max(1,y),Math.max(1,t));return this._update(!0),this}refreshTiles(y,t){const a=this.style.tileManagers[y];if(!a)throw new Error(`There is no tile manager with ID "${y}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((c=>new l.ac(c.z,c.x,c.y))))}addImage(y,t,a={}){const{pixelRatio:c=1,sdf:f=!1,stretchX:v,stretchY:w,content:E,textFitWidth:D,textFitHeight:R}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:U,data:j}=t,Z=t;return this.style.addImage(y,{data:new l.R({width:O,height:U},new Uint8Array(j)),pixelRatio:c,stretchX:v,stretchY:w,content:E,textFitWidth:D,textFitHeight:R,sdf:f,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,y),this}}{const{width:O,height:U,data:j}=Ae.getImageData(t);this.style.addImage(y,{data:new l.R({width:O,height:U},j),pixelRatio:c,stretchX:v,stretchY:w,content:E,textFitWidth:D,textFitHeight:R,sdf:f,version:0})}}updateImage(y,t){const a=this.style.getImage(y);if(!a)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||l.b(t)?Ae.getImageData(t):t,{width:f,height:v,data:w}=c;if(f===void 0||v===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||v!==a.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||l.b(t));return a.data.replace(w,E),this.style.updateImage(y,a),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return at.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,t){return this._lazyInitEmptyStyle(),this.style.addLayer(y,t),this._update(!0)}moveLayer(y,t){return this.style.moveLayer(y,t),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,t,a){return this.style.setLayerZoomRange(y,t,a),this._update(!0)}setFilter(y,t,a={}){return this.style.setFilter(y,t,a),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,t,a,c={}){return this.style.setPaintProperty(y,t,a,c),this._update(!0)}getPaintProperty(y,t){return this.style.getPaintProperty(y,t)}setLayoutProperty(y,t,a,c={}){return this.style.setLayoutProperty(y,t,a,c),this._update(!0)}getLayoutProperty(y,t){return this.style.getLayoutProperty(y,t)}setGlyphs(y,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,t,a,(c=>{c||this._update(!0)})),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,t,(a=>{a||this._update(!0)})),this}setLight(y,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(y,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,t){return this.style.setFeatureState(y,t),this._update()}removeFeatureState(y,t){return this.style.removeFeatureState(y,t),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,t=0;return this._container&&(y=this._container.clientWidth||400,t=this._container.clientHeight||300),[y,t]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const t=this._canvasContainer=ie.create("div","maplibregl-canvas-container",y);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=ie.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const f=this._controlContainer=ie.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{v[w]=ie.create("div",`maplibregl-ctrl-${w} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,t,a){this._canvas.width=Math.floor(a*y),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const y=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{t={requestedAttributes:y},c&&(t.statusMessage=c.statusMessage,t.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,y):this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y),!a){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new Lf(a,this.transform),Re.testSupport(a)}migrateProjection(y,t){super.migrateProjection(y,t),this.painter.transform=y,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){var t,a,c,f,v;const w=this._idleTriggered?this._fadeDuration:0,E=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,j=pe();this.style.zoomHistory.update(U,j);const Z=new l.H(U,{now:j,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),W=Z.crossFadingFactor();W===1&&W===this._crossFadingFactor||(D=!0,this._crossFadingFactor=W),this.style.update(Z)}const R=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==E;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(v=this.style.projection)===null||v===void 0?void 0:v.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cG.mark(l.cH.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const O=this._sourcesDirty||this._styleDirty||this._placementDirty;return O||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,l.cG.mark(l.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),at.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ie.remove(this._canvasContainer),ie.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cG.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ae.frame(this._frameRequest,(y=>{l.cG.frame(y),this._frameRequest=null;try{this._render(y)}catch(t){if(!l.Z(t)&&!(function(a){return a.message===Mo})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return fl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(y){return this._lazyInitEmptyStyle(),this.style.setProjection(y),this._update(!0)}},A.MapMouseEvent=nr,A.MapTouchEvent=Xa,A.MapWheelEvent=lh,A.Marker=mu,A.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);t.title=c,t.setAttribute("aria-label",c)},this.options=l.e({},gd,y),this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),ie.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),ie.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=ie.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new li(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ie.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,t){const a=ie.create("button",y,this._container);return a.type="button",a.addEventListener("click",t),a}},A.Popup=class extends l.E{constructor(y){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ie.remove(this._content),this._container&&(ie.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ie.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ie.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=sc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const f=lc(this.options.offset);if(!c){const w=this._container.offsetWidth,E=this._container.offsetHeight;let D;D=a.y+f.bottom.y<E?["top"]:a.y>this._map.transform.height-E?["bottom"]:[],a.x<w/2?D.push("left"):a.x>this._map.transform.width-w/2&&D.push("right"),c=D.length===0?"bottom":D.join("-")}let v=a.add(f[c]);this.options.subpixelPositioning||(v=v.round()),ie.setTransform(this._container,`${oc[c]} translate(${v.x}px,${v.y}px)`),pu(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(pl),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.V.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const t=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=y;c=a.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ie.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=ie.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(ml);y&&y.focus()}},A.RasterDEMTileSource=Ur,A.RasterTileSource=ia,A.ScaleControl=class{constructor(y){this._onMove=()=>{mi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,mi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},gr),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ie.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},A.ScrollZoomHandler=uu,A.Style=_o,A.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ie.create("button","maplibregl-ctrl-terrain",this._container),ie.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ie.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},A.TwoFingersTouchPitchHandler=Ks,A.TwoFingersTouchRotateHandler=cu,A.TwoFingersTouchZoomHandler=Ds,A.TwoFingersTouchZoomRotateHandler=hl,A.VectorTileSource=Pr,A.VideoSource=fe,A.addSourceType=(y,t)=>l._(void 0,void 0,void 0,(function*(){if(Q(y))throw new Error(`A source type called "${y}" already exists.`);((a,c)=>{$[a]=c})(y,t)})),A.clearPrewarmedResources=function(){const y=Qt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Pt),Qt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},A.createTileMesh=wf,A.getMaxParallelImageRequests=function(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS},A.getRTLTextPluginStatus=function(){return ke().getRTLTextPluginStatus()},A.getVersion=function(){return Ja},A.getWorkerCount=function(){return Vt.workerCount},A.getWorkerUrl=function(){return l.c.WORKER_URL},A.importScriptInWorkers=function(y){return xn().broadcast("IS",y)},A.isTimeFrozen=function(){return Pe.isFrozen()},A.now=pe,A.prewarm=function(){Yt().acquire(Pt)},A.restoreNow=function(){Pe.restoreNow()},A.setMaxParallelImageRequests=function(y){l.c.MAX_PARALLEL_IMAGE_REQUESTS=y},A.setNow=function(y){Pe.setNow(y)},A.setRTLTextPlugin=function(y,t){return ke().setRTLTextPlugin(y,t)},A.setWorkerCount=function(y){Vt.workerCount=y},A.setWorkerUrl=function(y){l.c.WORKER_URL=y}}));var k=b;return k}))})(vy)),vy.exports}var Kb=cA();const Wb=Iy(Kb),uA=A1({__proto__:null,default:Wb},[Kb]),Ll={PARKING_LOG:31417,OPEN_SPOT_BROADCAST:31714,ROUTE_LOG:34171},Vo=["wss://relay.damus.io","wss://nos.lol","wss://relay.primal.net","wss://relay.snort.social"];var I_={},Uv;function hA(){if(Uv)return I_;Uv=1;var h=function(){},m="+",b=8,S="0",z="23456789CFGHJMPQRVWX",k=z.length,A=90,l=180,N=10,K=[20,1,.05,.0025,125e-6],ne=4,re=5,Ee=125e-6,Ae=6;h.prototype.isValid=function(Ie){if(!Ie||Ie.indexOf(m)==-1||Ie.indexOf(m)!=Ie.lastIndexOf(m)||Ie.length==1||Ie.indexOf(m)>b||Ie.indexOf(m)%2==1)return!1;if(Ie.indexOf(S)>-1){if(Ie.indexOf(S)==0)return!1;var st=Ie.match(new RegExp("("+S+"+)","g"));if(st.length>1||st[0].length%2==1||st[0].length>b-2||Ie.charAt(Ie.length-1)!=m)return!1}if(Ie.length-Ie.indexOf(m)-1==1)return!1;Ie=Ie.replace(new RegExp("\\"+m+"+"),"").replace(new RegExp(S+"+"),"");for(var tt=0,ct=Ie.length;tt<ct;tt++){var Tt=Ie.charAt(tt).toUpperCase();if(Tt!=m&&z.indexOf(Tt)==-1)return!1}return!0},h.prototype.isShort=function(Ie){return this.isValid(Ie)?Ie.indexOf(m)>=0&&Ie.indexOf(m)<b:!1},h.prototype.isFull=function(Ie){if(!this.isValid(Ie)||this.isShort(Ie))return!1;var st=z.indexOf(Ie.charAt(0).toUpperCase())*k;if(st>=A*2)return!1;if(Ie.length>1){var tt=z.indexOf(Ie.charAt(1).toUpperCase())*k;if(tt>=l*2)return!1}return!0},h.prototype.encode=function(Ie,st,tt){if(typeof tt>"u"&&(tt=N),tt<2||tt<b&&tt%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";Ie=Pe(Ie),st=ie(st),Ie==90&&(Ie=Ie-pe(tt));var ct=Re(Ie,st,Math.min(tt,N));return tt>N&&(ct+=We(Ie,st,tt-N)),ct},h.prototype.decode=function(Ie){if(!this.isFull(Ie))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+Ie;Ie=Ie.replace(m,""),Ie=Ie.replace(new RegExp(S+"+"),""),Ie=Ie.toUpperCase();var st=it(Ie.substring(0,N));if(Ie.length<=N)return st;var tt=bt(Ie.substring(N));return rt(st.latitudeLo+tt.latitudeLo,st.longitudeLo+tt.longitudeLo,st.latitudeLo+tt.latitudeHi,st.longitudeLo+tt.longitudeHi,st.codeLength+tt.codeLength)},h.prototype.recoverNearest=function(Ie,st,tt){if(!this.isShort(Ie)){if(this.isFull(Ie))return Ie;throw"ValueError: Passed short code is not valid: "+Ie}st=Pe(st),tt=ie(tt),Ie=Ie.toUpperCase();var ct=b-Ie.indexOf(m),Tt=Math.pow(20,2-ct/2),jt=Tt/2,Gt=Math.floor(st/Tt)*Tt,ut=Math.floor(tt/Tt)*Tt,Te=this.decode(this.encode(Gt,ut).substr(0,ct)+Ie),He=Te.latitudeCenter-st;return He>jt?Te.latitudeCenter-=Tt:He<-jt&&(Te.latitudeCenter+=Tt),He=Te.longitudeCenter-tt,He>jt?Te.longitudeCenter-=Tt:He<-jt&&(Te.longitudeCenter+=Tt),this.encode(Te.latitudeCenter,Te.longitudeCenter,Te.codeLength)},h.prototype.shorten=function(ct,st,tt){if(!this.isFull(ct))throw"ValueError: Passed code is not valid and full: "+ct;if(ct.indexOf(S)!=-1)throw"ValueError: Cannot shorten padded codes: "+ct;var ct=ct.toUpperCase(),Tt=this.decode(ct);if(Tt.codeLength<Ae)throw"ValueError: Code length must be at least "+Ae;st=Pe(st),tt=ie(tt);for(var jt=Math.max(Math.abs(Tt.latitudeCenter-st),Math.abs(Tt.longitudeCenter-tt)),Gt=K.length-2;Gt>=1;Gt--)if(jt<K[Gt]*.3)return ct.substring((Gt+1)*2);return ct};var Pe=function(Ie){return Math.min(90,Math.max(-90,Ie))},pe=function(Ie){return Ie<=10?Math.pow(20,Math.floor(Ie/-2+2)):Math.pow(20,-3)/Math.pow(re,Ie-10)},ie=function(Ie){for(;Ie<-180;)Ie=Ie+360;for(;Ie>=180;)Ie=Ie-360;return Ie},Re=function(Ie,st,tt){for(var ct="",Tt=Ie+A,jt=st+l,Gt=0;Gt<tt;){var ut=K[Math.floor(Gt/2)],Te=Math.floor(Tt/ut);Tt-=Te*ut,ct+=z.charAt(Te),Gt+=1,Te=Math.floor(jt/ut),jt-=Te*ut,ct+=z.charAt(Te),Gt+=1,Gt==b&&Gt<tt&&(ct+=m)}return ct.length<b&&(ct=ct+Array(b-ct.length+1).join(S)),ct.length==b&&(ct=ct+m),ct},We=function(Ie,st,tt){for(var ct="",Tt=Ee,jt=Ee,Gt=(Ie+A)%Tt,ut=(st+l)%jt,Te=0;Te<tt;Te++){var He=Math.floor(Gt/(Tt/re)),pt=Math.floor(ut/(jt/ne));Tt/=re,jt/=ne,Gt-=He*Tt,ut-=pt*jt,ct+=z.charAt(He*ne+pt)}return ct},it=function(Ie){var st=Dt(Ie,0),tt=Dt(Ie,1);return new rt(st[0]-A,tt[0]-l,st[1]-A,tt[1]-l,Ie.length)},Dt=function(Ie,st){for(var tt=0,ct=0;tt*2+st<Ie.length;)ct+=z.indexOf(Ie.charAt(tt*2+st))*K[tt],tt+=1;return[ct,ct+K[tt-1]]},bt=function(Ie){for(var st=0,tt=0,ct=Ee,Tt=Ee,jt=0;jt<Ie.length;){var Gt=z.indexOf(Ie.charAt(jt)),ut=Math.floor(Gt/ne),Te=Gt%ne;ct/=re,Tt/=ne,st+=ut*ct,tt+=Te*Tt,jt+=1}return rt(st,tt,st+ct,tt+Tt,Ie.length)},rt=h.prototype.CodeArea=function(Ie,st,tt,ct,Tt){return new at.init(Ie,st,tt,ct,Tt)},at={init:function(Ie,st,tt,ct,Tt){this.latitudeLo=Ie,this.longitudeLo=st,this.latitudeHi=tt,this.longitudeHi=ct,this.codeLength=Tt,this.latitudeCenter=Math.min(Ie+(tt-Ie)/2,A),this.longitudeCenter=Math.min(st+(ct-st)/2,l)}};return I_.OpenLocationCode=h,I_}var dA=hA();const fA=Iy(dA);function zy(h,m,b=10){const S=[16,8,4,2,1],z="0123456789bcdefghjkmnpqrstuvwxyz";let k=!0,A=-90,l=90,N=-180,K=180,ne="",re=0,Ee=0;for(;ne.length<b;){if(k){const Ae=(N+K)/2;m>Ae?(Ee|=S[re],N=Ae):K=Ae}else{const Ae=(A+l)/2;h>Ae?(Ee|=S[re],A=Ae):l=Ae}k=!k,re<4?re++:(ne+=z[Ee],re=0,Ee=0)}return ne}function pA(h,m){return`${h.toFixed(6)}, ${m.toFixed(6)}`}function mA(h,m,b=5){const S=zy(h,m,b),z=b===5?.02:b===6?.005:.001,k=b===5?.04:b===6?.01:.002,A=new Set;A.add(S);const l=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[N,K]of l){const ne=h+N*z,re=m+K*k;A.add(zy(ne,re,b))}return Array.from(A)}const Vv=fA,Cc=Vv.default||Vv;function qv(h){const m=h.trim();if(m.replace(//g,"").replace(/,/g," ").split(/\s+/).filter(z=>z.length>0).length>=2){let z=null,k=null;const A=m.match(/^(-?\d+(\.\d+)?)[,\s]+(-?\d+(\.\d+)?)$/);if(A)z=parseFloat(A[1]),k=parseFloat(A[3]);else{const l=m.matchAll(/([0-9.-]+)\s*?\s*([NSEWnsew])?/g),N=Array.from(l);if(N.length===2){const K=parseFloat(N[0][1]),ne=N[0][2]?.toUpperCase(),re=parseFloat(N[1][1]),Ee=N[1][2]?.toUpperCase(),Ae=(ie,Re)=>{let We=ie;return(Re==="S"||Re==="W")&&(We=-ie),Re==="N"||Re==="S"?{type:"lat",val:We}:Re==="E"||Re==="W"?{type:"lon",val:We}:{type:"unknown",val:We}},Pe=Ae(K,ne),pe=Ae(re,Ee);Pe.type==="lat"&&pe.type==="lon"?(z=Pe.val,k=pe.val):Pe.type==="lon"&&pe.type==="lat"?(k=Pe.val,z=pe.val):Pe.type==="unknown"&&pe.type==="unknown"&&(z=Pe.val,k=pe.val)}}if(z!==null&&k!==null&&!isNaN(z)&&!isNaN(k)&&z>=-90&&z<=90&&k>=-180&&k<=180)return{lat:z,lon:k,type:"coordinate"}}try{if(Cc&&Cc.isValid&&Cc.isValid(m)&&Cc.isFull(m)){const k=Cc.decode(m);return{lat:k.latitudeCenter,lon:k.longitudeCenter,type:"plus_code"}}const z=m.toUpperCase().replace(/\s+/g,"+");if(z!==m&&Cc&&Cc.isValid&&Cc.isValid(z)&&Cc.isFull(z)){const k=Cc.decode(z);return{lat:k.latitudeCenter,lon:k.longitudeCenter,type:"plus_code"}}}catch{}return null}async function Qb(h,m,b){const S=JSON.stringify(h);if(b){const z=cg.getConversationKey(b,m);return cg.encrypt(S,z)}else if(window.nostr?.nip44?.encrypt)return await window.nostr.nip44.encrypt(m,S);throw new Error("No encryption method available")}async function Jb(h,m,b){let S;if(b){const z=cg.getConversationKey(b,m);S=cg.decrypt(h,z)}else if(window.nostr?.nip44?.decrypt)S=await window.nostr.nip44.decrypt(m,h);else throw new Error("No decryption method available");return JSON.parse(S)}const Dy={IN:"INR",US:"USD",GB:"GBP",DE:"EUR",FR:"EUR",ES:"EUR",IT:"EUR",NL:"EUR",BE:"EUR",AT:"EUR",PT:"EUR",IE:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CN:"CNY",AE:"AED",SG:"SGD",HK:"HKD",CH:"CHF",SE:"SEK",NO:"NOK",DK:"DKK",NZ:"NZD",MX:"MXN",BR:"BRL",ZA:"ZAR",KR:"KRW",TH:"THB",MY:"MYR",PH:"PHP",ID:"IDR",VN:"VND",RU:"RUB",PL:"PLN",TR:"TRY",SA:"SAR",EG:"EGP"};async function gA(h,m){try{const b=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${h}&lon=${m}&zoom=3`,{headers:{"User-Agent":"Parlens-PWA/1.0"}});if(!b.ok)throw new Error("Geocoding failed");const z=(await b.json()).address?.country_code?.toUpperCase();return z&&Dy[z]?Dy[z]:"USD"}catch(b){return console.warn("Currency detection failed, using locale fallback:",b),e1()}}function e1(){try{const m=window.navigator.language.split("-")[1]?.toUpperCase();return m&&Dy[m]?Dy[m]:"USD"}catch{return"USD"}}function ug(h){try{return 0 .toLocaleString(window.navigator.language,{style:"currency",currency:h,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}catch{return{INR:"",USD:"$",GBP:"",EUR:"",JPY:"",CAD:"C$",AUD:"A$",CNY:"",AED:".",SGD:"S$"}[h]||"$"}}const yA={INR:"IN",USD:"US",GBP:"GB",EUR:"EU",JPY:"JP",CAD:"CA",AUD:"AU",CNY:"CN",AED:"AE",SGD:"SG",HKD:"HK",CHF:"CH",SEK:"SE",NOK:"NO",DKK:"DK",NZD:"NZ",MXN:"MX",BRL:"BR",ZAR:"ZA",KRW:"KR",THB:"TH",MYR:"MY",PHP:"PH",IDR:"ID",VND:"VN",RUB:"RU",PLN:"PL",TRY:"TR",SAR:"SA",EGP:"EG"};function _A(h){return(yA[h]||"US").toUpperCase().replace(/./g,b=>String.fromCodePoint(b.charCodeAt(0)+127397))}var cf=Symbol("verified"),vA=h=>h instanceof Object;function t1(h){if(!vA(h)||typeof h.kind!="number"||typeof h.content!="string"||typeof h.created_at!="number"||typeof h.pubkey!="string"||!h.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(h.tags))return!1;for(let m=0;m<h.tags.length;m++){let b=h.tags[m];if(!Array.isArray(b))return!1;for(let S=0;S<b.length;S++)if(typeof b[S]!="string")return!1}return!0}new TextDecoder("utf-8");var xA=new TextEncoder,bA=class{generateSecretKey(){return zc.utils.randomPrivateKey()}getPublicKey(h){return Dr(zc.getPublicKey(h))}finalizeEvent(h,m){const b=h;return b.pubkey=Dr(zc.getPublicKey(m)),b.id=xy(b),b.sig=Dr(zc.sign(xy(b),m)),b[cf]=!0,b}verifyEvent(h){if(typeof h[cf]=="boolean")return h[cf];const m=xy(h);if(m!==h.id)return h[cf]=!1,!1;try{const b=zc.verify(h.sig,m,h.pubkey);return h[cf]=b,b}catch{return h[cf]=!1,!1}}};function n1(h){if(!t1(h))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content])}function xy(h){let m=Xh(xA.encode(n1(h)));return Dr(m)}var $y=new bA,i1=$y.generateSecretKey,wA=$y.getPublicKey,r1=$y.finalizeEvent;$y.verifyEvent;const TA=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent:r1,generateSecretKey:i1,getEventHash:xy,getPublicKey:wA,serializeEvent:n1,validateEvent:t1,verifiedSymbol:cf},Symbol.toStringTag,{value:"Module"})),SA=({status:h,setStatus:m,searchLocation:b,vehicleType:S,setOpenSpots:z,parkLocation:k,setParkLocation:A,sessionStart:l,setSessionStart:N})=>{const{pubkey:K,pool:ne,signEvent:re}=Xp(),[Ee,Ae]=De.useState(!1),[Pe,pe]=De.useState("0"),[ie,Re]=De.useState("USD"),[We,it]=De.useState("$"),[Dt,bt]=De.useState("00:00:00");De.useEffect(()=>{if(h==="parked"&&l){const Ie=()=>{const ct=Math.floor(Date.now()/1e3)-l,Tt=Math.floor(ct/3600),jt=Math.floor(ct%3600/60),Gt=ct%60;bt(`${Tt.toString().padStart(2,"0")}:${jt.toString().padStart(2,"0")}:${Gt.toString().padStart(2,"0")}`)},st=setInterval(Ie,1e3);return Ie(),()=>clearInterval(st)}},[h,l]),De.useEffect(()=>{if(h==="search"&&b){const Ie=mA(b[0],b[1],5);console.log("[Parlens] Starting spot search with polling in geohashes:",Ie);const st=async()=>{try{const Tt=Math.floor(Date.now()/1e3),jt=await ne.querySync(Vo,{kinds:[Ll.OPEN_SPOT_BROADCAST],"#g":Ie,since:Tt-600}),Gt=Math.floor(Date.now()/1e3),ut=[];for(const Te of jt){const He=Te.tags.find(pt=>pt[0]==="expiration");if(!(He&&parseInt(He[1])<Gt))try{const pt=Te.tags,_t=pt.find(vt=>vt[0]==="location"),Ft=pt.find(vt=>vt[0]==="hourly_rate"),we=pt.find(vt=>vt[0]==="currency"),$e=pt.find(vt=>vt[0]==="type");if(_t){const[vt,Pt]=_t[1].split(",").map(Number),Vt=$e?$e[1]:"car";ut.push({id:Te.id,lat:vt,lon:Pt,price:Ft?parseFloat(Ft[1]):0,currency:we?we[1]:"USD",type:Vt})}}catch(pt){console.warn("[Parlens] Error parsing spot:",pt)}}console.log("[Parlens] Found",ut.length,"valid spots"),z(ut)}catch(Tt){console.error("[Parlens] Spot query error:",Tt)}};st();const tt=setInterval(st,1e4),ct=()=>{console.log("[Parlens] Visibility refresh triggered, searching spots..."),st()};return window.addEventListener("visibility-refresh",ct),()=>{console.log("[Parlens] Stopping spot search"),clearInterval(tt),window.removeEventListener("visibility-refresh",ct)}}else z([])},[h,S,ne,b]),De.useEffect(()=>{(async()=>{const st=e1();if(Re(st),it(ug(st)),b)try{const tt=await gA(b[0],b[1]);Re(tt),it(ug(tt))}catch{console.warn("GPS currency detection failed")}})()},[b]);const rt=async()=>{h==="idle"?m("search"):h==="search"?(N(Math.floor(Date.now()/1e3)),A(b?[b[0],b[1]]:null),m("parked")):h==="parked"&&(pe("0"),Ae(!0))},at=async()=>{m("idle"),Ae(!1);const Ie=k?k[0]:b?b[0]:0,st=k?k[1]:b?b[1]:0,tt=zy(Ie,st,5),ct=Math.floor(Date.now()/1e3),Tt=l||ct;try{const jt={status:"vacated",lat:Ie,lon:st,geohash:tt,fee:Pe,currency:ie,type:S,started_at:Tt,finished_at:ct},Gt=localStorage.getItem("parlens_privkey"),ut=Gt?new Uint8Array(Gt.match(/.{1,2}/g).map(Yt=>parseInt(Yt,16))):void 0,Te=await Qb(jt,K,ut),He={kind:Ll.PARKING_LOG,content:Te,tags:[["d",`session_${Tt}`],["client","parlens"]],created_at:ct,pubkey:K},pt=await re(He);console.log("Publishing log:",pt.id,"to",Vo);const _t=await Promise.allSettled(ne.publish(Vo,pt)),Ft=_t.filter(Yt=>Yt.status==="fulfilled").length,we=_t.filter(Yt=>Yt.status==="rejected").length;console.log(`[Parlens] Publish results: ${Ft}/${_t.length} succeeded, ${we} failed`),_t.forEach((Yt,on)=>{Yt.status==="rejected"&&console.warn(`[Parlens] Relay ${Vo[on]} failed:`,Yt.reason)}),Ft===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),console.log("Log published"),await new Promise(Yt=>setTimeout(Yt,300)),window.dispatchEvent(new Event("parking-log-updated"));const $e=i1(),vt=ct-Tt,Pt=Math.max(Math.ceil(vt/3600),1),Vt=String(Math.round(parseFloat(Pe)/Pt)),Xt=ct+300,Qt={kind:Ll.OPEN_SPOT_BROADCAST,content:"",tags:[["d",`spot_${tt}_${ct}`],["g",tt],["location",`${Ie},${st}`],["hourly_rate",Vt],["currency",ie],["type",S],["expiration",String(Xt)],["client","parlens"]],created_at:ct},rn=r1(Qt,$e);console.log("[Parlens] *** BROADCASTING OPEN SPOT ***"),console.log("[Parlens] Geohash:",tt),console.log("[Parlens] Location:",`${Ie},${st}`),console.log("[Parlens] Event ID:",rn.id),console.log("[Parlens] Pubkey:",rn.pubkey.substring(0,20)+"..."),ne.publish(Vo,rn),N(null),A(null)}catch(jt){console.error("Persistence error:",jt),alert("Could not save to Nostr. Check relay connections.")}};return Y.jsxs("div",{className:"relative flex flex-col items-end gap-4",children:[Y.jsxs("div",{className:"flex items-center gap-4",children:[h==="search"&&Y.jsx("button",{onClick:()=>m("idle"),className:"h-14 px-8 rounded-full bg-red-500/90 text-white font-bold text-xs tracking-widest shadow-2xl backdrop-blur-md animate-in slide-in-from-left-8",children:"CANCEL"}),h==="parked"&&Y.jsx("div",{className:"h-14 px-6 rounded-full bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-2xl flex items-center justify-center animate-in slide-in-from-left-8 pointer-events-none",children:Y.jsx("span",{className:"font-mono text-xl font-bold tabular-nums text-zinc-900 dark:text-white",children:Dt})}),Y.jsxs("button",{onClick:rt,className:`h-20 w-20 flex items-center justify-center rounded-[2.5rem] shadow-2xl transition-all active:scale-90 ${h==="idle"?"bg-[#007AFF] text-white shadow-blue-500/20":h==="search"?"bg-[#FF9500] text-white shadow-orange-500/20":"bg-[#34C759] text-white shadow-green-500/20"}`,children:[h==="idle"&&Y.jsx(CM,{size:32,strokeWidth:2.5}),h==="search"&&Y.jsx($h,{size:32,strokeWidth:2.5,className:"animate-pulse"}),h==="parked"&&(S==="bicycle"?Y.jsx("span",{className:"text-3xl",children:""}):S==="motorcycle"?Y.jsx("span",{className:"text-3xl",children:""}):Y.jsx("span",{className:"text-3xl",children:""}))]})]}),Ee&&Y.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:Y.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[Y.jsxs("div",{className:"text-center space-y-1",children:[Y.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),Y.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee, 0 if free parking"})]}),Y.jsxs("div",{className:"flex items-center gap-4",children:[Y.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[Y.jsx("span",{className:"text-2xl font-bold text-blue-500",children:We}),Y.jsx("input",{type:"number",value:Pe,onChange:Ie=>pe(Ie.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),Y.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:ie})]}),Y.jsxs("div",{className:"flex flex-col gap-1.5",children:[Y.jsx("button",{onClick:()=>pe(String(Math.max(0,parseFloat(Pe||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:Y.jsx(R0,{size:22,className:"text-zinc-600 dark:text-white/70"})}),Y.jsx("button",{onClick:()=>pe(String(Math.max(0,parseFloat(Pe||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:Y.jsx(gf,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),Y.jsxs("div",{className:"w-full space-y-3",children:[Y.jsxs("button",{onClick:at,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",Y.jsx(YE,{size:20})]}),Y.jsx("button",{onClick:()=>Ae(!1),className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})};function EA(){const{pool:h,pubkey:m}=Xp(),[b,S]=De.useState([]),[z,k]=De.useState(!0),A=De.useRef(new Set),l=De.useCallback(async()=>{if(!(!m||!h)){k(!0),console.log("[useParkingLogs] Fetching logs for",m);try{const K=await h.querySync(Vo,{kinds:[Ll.PARKING_LOG,5],authors:[m],limit:100});console.log("[useParkingLogs] Fetched",K.length,"events");const ne=new Set,re=K.filter(pe=>pe.kind===5);for(const pe of re)for(const ie of pe.tags)ie[0]==="a"&&ne.add(ie[1]);const Ae=K.filter(pe=>pe.kind===Ll.PARKING_LOG).filter(pe=>{const ie=pe.tags?.find(We=>We[0]==="d")?.[1];if(!ie)return!0;if(A.current.has(ie))return!1;const Re=`${pe.kind}:${pe.pubkey}:${ie}`;return!ne.has(Re)});console.log("[useParkingLogs] Valid logs after filtering:",Ae.length);const Pe=Ae.sort((pe,ie)=>ie.created_at-pe.created_at);S(Pe)}catch(K){console.error("[useParkingLogs] Fetch error:",K)}finally{k(!1)}}},[h,m]),N=De.useCallback(K=>{console.log("[useParkingLogs] Marking deleted:",K),A.current.add(K)},[]);return De.useEffect(()=>{m&&l()},[m,l]),De.useEffect(()=>{const K=()=>{console.log("[useParkingLogs] Received update event, refetching..."),l()};return window.addEventListener("parking-log-updated",K),window.addEventListener("visibility-refresh",K),()=>{window.removeEventListener("parking-log-updated",K),window.removeEventListener("visibility-refresh",K)}},[l]),{logs:b,loading:z,refetch:l,markDeleted:N}}const MA=({setHistorySpots:h,onOpenChange:m})=>{const{pubkey:b,logout:S,pool:z,signEvent:k}=Xp(),{logs:A,refetch:l,markDeleted:N}=EA(),[K,ne]=De.useState(!1),[re,Ee]=De.useState(!1);De.useEffect(()=>{m?.(K)},[K,m]);const[Ae,Pe]=De.useState(null),[pe,ie]=De.useState([]),[Re,We]=De.useState(!1),it=async bt=>{if(!(!b||!confirm("Are you sure you want to delete this parking entry? This action cannot be undone."))){Ee(!0);try{const rt=bt.tags?.find(st=>st[0]==="d")?.[1];if(!rt)throw new Error("Missing d tag on event");const at={kind:5,content:"Deleted by user",tags:[["a",`${Ll.PARKING_LOG}:${b}:${rt}`],["k",String(Ll.PARKING_LOG)]],created_at:Math.floor(Date.now()/1e3),pubkey:b},Ie=await k(at);await Promise.allSettled(z.publish(Vo,Ie)),N(rt),ie(st=>st.filter(tt=>tt.id!==bt.id))}catch(rt){console.error("Failed to delete parking log:",rt),alert("Failed to delete. Please try again.")}finally{Ee(!1)}}};De.useEffect(()=>{b&&(async()=>{const rt=await z.get(Vo,{kinds:[0],authors:[b]});if(rt)try{const at=JSON.parse(rt.content);Pe({name:at.name||at.display_name||"Nostr User",npub:ff.npubEncode(b),picture:at.picture})}catch(at){console.error("Error parsing profile:",at)}else Pe({name:"Nostr User",npub:ff.npubEncode(b),picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${b}`})})()},[b,z]),De.useEffect(()=>{(async()=>{if(!b||!A.length)return;const rt=localStorage.getItem("parlens_privkey"),at=rt?new Uint8Array(rt.match(/.{1,2}/g).map(st=>parseInt(st,16))):void 0,Ie=await Promise.all(A.map(async st=>{try{const tt=await Jb(st.content,b,at);return{...st,decryptedContent:tt}}catch{return{...st,decryptedContent:null}}}));ie(Ie.filter(st=>st.decryptedContent))})()},[A,b]),De.useEffect(()=>{h&&h(Re?pe:[])},[Re,pe,h]);const Dt=()=>{const bt=localStorage.getItem("parlens_privkey");if(bt){const rt=ff.nsecEncode(new Uint8Array(bt.match(/.{1,2}/g).map(at=>parseInt(at,16))));navigator.clipboard.writeText(rt),alert("Copied to clipboard")}};return Y.jsxs(Y.Fragment,{children:[Y.jsx("button",{onClick:()=>{l(),ne(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Activity Log",children:Y.jsx(RM,{size:20})}),K&&Y.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[Y.jsx("button",{onClick:()=>ne(!1),className:"absolute inset-0 z-0 cursor-default"}),re&&Y.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:Y.jsxs("div",{className:"flex flex-col items-center gap-3",children:[Y.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),Y.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),Y.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[Y.jsxs("div",{className:"flex items-center justify-between",children:[Y.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent",children:Ae?.name||"Nostr User"}),Y.jsx("button",{onClick:()=>ne(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:Y.jsx(L0,{size:20,className:"text-black/60 dark:text-white/60"})})]}),Y.jsxs("div",{className:"space-y-4",children:[Y.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Keys"}),Y.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[Y.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer",onClick:()=>{navigator.clipboard.writeText(Ae?.npub),alert("Copied to clipboard")},children:[Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400",children:Y.jsx(H_,{size:20})}),Y.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),Y.jsx(Ay,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),localStorage.getItem("parlens_privkey")&&Y.jsxs(Y.Fragment,{children:[Y.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),Y.jsxs("div",{onClick:Dt,className:"flex items-center justify-between p-4 cursor-pointer transition-colors active:bg-black/10 dark:active:bg-white/10",children:[Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-500",children:Y.jsx(Hb,{size:20})}),Y.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),Y.jsx(Ay,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]})]}),Y.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:" Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost."})]}),Y.jsxs("div",{className:"space-y-4",children:[Y.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking History"}),h&&Y.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5 mb-4",children:[Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("div",{className:"p-2.5 rounded-xl bg-purple-500/10 dark:bg-purple-500/20 text-purple-500 dark:text-purple-400",children:Y.jsx($h,{size:20})}),Y.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show logs on map"})]}),Y.jsx("button",{onClick:()=>We(!Re),className:`w-12 h-7 rounded-full transition-colors relative ${Re?"bg-blue-500":"bg-zinc-200 dark:bg-white/20"}`,children:Y.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${Re?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),Y.jsx("div",{className:"space-y-2",children:pe.length>0?pe.map(bt=>{const rt=bt.decryptedContent,at=ug(rt.currency||"USD"),Ie=rt.started_at?new Date(rt.started_at*1e3):null,st=rt.finished_at?new Date(rt.finished_at*1e3):new Date(bt.created_at*1e3),tt=rt.lat&&rt.lon?`${rt.lat.toFixed(5)}, ${rt.lon.toFixed(5)}`:null,ct=rt.type||"car",Tt=ct==="bicycle"?"":ct==="motorcycle"?"":"";return Y.jsxs("div",{className:"p-5 rounded-[2rem] bg-zinc-50 dark:bg-white/[0.03] space-y-3 border border-black/5 dark:border-white/5 text-zinc-900 dark:text-white",children:[Y.jsxs("div",{className:"flex items-center justify-between",children:[Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("span",{className:"text-2xl",children:Tt}),Y.jsx("p",{className:"font-bold text-xl",children:`${at}${rt.fee||"0"}`})]}),Y.jsxs("div",{className:"flex items-center gap-2",children:[Y.jsx("span",{className:"text-2xl",children:_A(rt.currency||"USD")}),Y.jsx("button",{onClick:()=>it(bt),className:"p-1.5 text-zinc-400 dark:text-white/30 transition-colors",title:"Delete entry",children:Y.jsx($_,{size:16})})]})]}),tt&&Y.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[Y.jsx($h,{size:12,className:"text-blue-500 dark:text-blue-400"}),Y.jsx("span",{className:"font-mono",children:tt})]}),Y.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/30",children:[Y.jsx(Zb,{size:12,className:"text-green-500 dark:text-green-400"}),Y.jsxs("div",{className:"space-x-1",children:[Ie&&Y.jsxs("span",{children:["Start: ",Ie.toLocaleDateString(void 0,{month:"short",day:"numeric"})," ",Ie.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),Y.jsx("span",{className:"text-black/10 dark:text-white/10",children:""}),Y.jsxs("span",{children:["End: ",st.toLocaleDateString(void 0,{month:"short",day:"numeric"})," ",st.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]},bt.id)}):Y.jsx("div",{className:"p-10 rounded-[2.5rem] border-2 border-dashed border-black/5 dark:border-white/5 text-center",children:Y.jsx("p",{className:"text-sm font-medium text-zinc-400 dark:text-white/10",children:"No recent activity"})})})]}),Y.jsx("button",{onClick:()=>{S(),ne(!1)},className:"w-full py-5 rounded-[2rem] bg-zinc-100 dark:bg-zinc-800 text-red-500 font-bold tracking-wide border border-black/5 dark:border-white/5 transition-all active:scale-95 text-center mt-4",children:"Logout"})]})]})]})},AA=({query:h,onSelect:m,countryCode:b,currentLocation:S})=>{const[z,k]=De.useState(null),[A,l]=De.useState(!1);return De.useEffect(()=>{const K=setTimeout(async()=>{if(!(!h||h.length<4)){l(!0);try{let ne=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(h)}&format=json&limit=1`;if(b&&(ne+=`&countrycodes=${b}`),S){const[Ae,Pe]=S,pe=`${Pe-1},${Ae+1},${Pe+1},${Ae-1}`;ne+=`&viewbox=${pe}`}const Ee=await(await fetch(ne)).json();Ee&&Ee.length>0?k(Ee[0]):k(null)}catch(ne){console.error(ne),k(null)}finally{l(!1)}}},2e3);return()=>clearTimeout(K)},[h,b,S]),A?Y.jsxs("div",{className:"mb-2 p-3 text-xs text-zinc-400 dark:text-white/40 italic flex items-center gap-2",children:[Y.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-zinc-300 border-t-zinc-600 animate-spin"}),"Searching..."]}):z?Y.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-purple-50 dark:bg-purple-500/10 border border-purple-500/20",children:[Y.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-purple-700 dark:text-purple-400 bg-purple-100/50 dark:bg-purple-500/5",children:" Global Search Result"}),Y.jsxs("button",{onClick:()=>m(z),className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[Y.jsx($h,{size:16,className:"text-purple-600 dark:text-purple-400 shrink-0"}),Y.jsxs("div",{className:"flex-1 truncate",children:[Y.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white truncate",children:z.display_name.split(",")[0]}),Y.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:z.display_name})]})]})]}):null},CA=({vehicleType:h,onRouteChange:m,currentLocation:b,onDropPinModeChange:S,pendingDropPin:z,onDropPinConsumed:k,onOpenChange:A})=>{const{pool:l,pubkey:N,signEvent:K}=Xp(),[ne,re]=De.useState(!1);De.useEffect(()=>{A?.(ne)},[ne,A]);const[Ee,Ae]=De.useState([]),[Pe,pe]=De.useState(""),[ie,Re]=De.useState(!1),[We,it]=De.useState(null),[Dt,bt]=De.useState(null),[rt,at]=De.useState(!1),Ie=De.useRef(null),[st,tt]=De.useState([]),[ct,Tt]=De.useState(""),[jt,Gt]=De.useState(!1),[ut,Te]=De.useState(!1),[He,pt]=De.useState(!1),[_t,Ft]=De.useState(!1),[we,$e]=De.useState(null),[vt,Pt]=De.useState(""),[Vt,Xt]=De.useState(!1),[Qt,rn]=De.useState(null),[Yt,on]=De.useState({}),xn=De.useRef(new Set);De.useEffect(()=>{(async()=>{if(!(!b||Qt))try{const $=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${b[0]}&lon=${b[1]}&format=json`)).json();$&&$.address&&$.address.country_code&&(console.log("[Parlens] Detected Country:",$.address.country_code),rn($.address.country_code))}catch(H){console.error("[Parlens] Failed to detect country:",H)}})()},[b,Qt]);const qn=t0.useMemo(()=>{if(!Pe||Pe.length<2)return[];const fe=Pe.toLowerCase(),H=[];for(const $ of st)for(const Q of $.decryptedContent.waypoints)Q.name.toLowerCase().includes(fe)&&(H.find(de=>de.name.toLowerCase()===Q.name.toLowerCase())||H.push({name:Q.name,lat:Q.lat,lon:Q.lon}));return H.slice(0,5)},[Pe,st]),Ki=fe=>{Ae(H=>H.filter($=>$.id!==fe)),it(null),bt(null),Re(!1),m(null,null,null,!1)},zn=()=>{Ae([]),it(null),bt(null),Re(!1),m(null,null,null,!1)},wi=(fe,H)=>{if(fe+H<0||fe+H>=Ee.length)return;const $=[...Ee];[$[fe],$[fe+H]]=[$[fe+H],$[fe]],Ae($),it(null),bt(null),Re(!1),m(null,null,null,!1)},Wi=()=>{Ae(fe=>[...fe].reverse()),it(null),bt(null),Re(!1),m(null,null,null,!1)},Yn=async()=>{if(Ee.length<2){alert("Add at least 2 waypoints to create a route");return}at(!0);try{const H={bicycle:"bike",motorcycle:"driving",car:"driving"}[h],$=[],Q=[],de={};for(let ye=0;ye<Ee.length-1;ye++){const Oe=Ee[ye],Qe=Ee[ye+1],nt=`${Oe.lon},${Oe.lat};${Qe.lon},${Qe.lat}`;console.log(`[Parlens] Fetching segment ${ye+1}: ${Oe.name}  ${Qe.name}`);const Et=await fetch(`https://router.project-osrm.org/route/v1/${H}/${nt}?overview=full&geometries=geojson&alternatives=true`);if(!Et.ok)throw new Error(`OSRM error: ${Et.status}`);const It=await Et.json();if(It.code==="Ok"&&It.routes&&It.routes[0]){if(It.waypoints&&It.waypoints.length>=2){const gn=It.waypoints[0].location,pn=It.waypoints[1].location;de[ye]||(de[ye]={lat:gn[1],lon:gn[0]}),de[ye+1]={lat:pn[1],lon:pn[0]}}const Kt=It.routes[0].geometry.coordinates.map(gn=>[gn[1],gn[0]]);if($.push(Kt),It.routes.length>1){const gn=It.routes[1].geometry.coordinates.map(pn=>[pn[1],pn[0]]);Q.push(gn),console.log(`[Parlens] Segment ${ye+1} has alternate route`)}else Q.push(Kt),console.log(`[Parlens] Segment ${ye+1} has no alternate, using primary`)}else throw new Error(`No route found for segment ${ye+1}`)}const ve=[],Le=[];for(let ye=0;ye<$.length;ye++){const Oe=ye===0?0:1;ve.push(...$[ye].slice(Oe)),Le.push(...Q[ye].slice(Oe))}console.log("[Parlens] Combined primary route:",ve.length,"points"),console.log("[Parlens] Combined alternate route:",Le.length,"points"),it(ve),bt(Le),on(de),Re(!0);const ke=Object.keys(de).length===Ee.length?Ee.map((ye,Oe)=>({...ye,...de[Oe]})):Ee;m(ve,Le,ke.map(ye=>({lat:ye.lat,lon:ye.lon})),!0),re(!1)}catch(fe){console.error("Route creation error:",fe);const H=Ee.map($=>[$.lat,$.lon]);it(H),bt(null),on({}),Re(!0),m(H,null,Ee.map($=>({lat:$.lat,lon:$.lon})),!0),re(!1)}finally{at(!1)}},na=()=>{const fe=!ie;Re(fe);const H=Object.keys(Yt).length===Ee.length?Ee.map(($,Q)=>({...$,...Yt[Q]})):Ee;m(We,Dt,H.map($=>({lat:$.lat,lon:$.lon})),fe)},Pr=De.useCallback(async()=>{if(!(!l||!N)){Te(!0);try{const fe=await l.querySync(Vo,{kinds:[Ll.ROUTE_LOG],authors:[N]});console.log("[Parlens] Fetched route events:",fe.length);const H=localStorage.getItem("parlens_privkey"),$=H?new Uint8Array(H.match(/.{1,2}/g).map(de=>parseInt(de,16))):void 0,Q=[];for(const de of fe){if(de.tags.find(Le=>Le[0]==="deleted"))continue;const ve=de.tags.find(Le=>Le[0]==="d")?.[1]||"";if(!(ve&&xn.current.has(ve))&&de.content)try{const Le=await Jb(de.content,N,$);if(Le){const ke=de.tags.find(ye=>ye[0]==="d")?.[1]||"";Q.push({id:de.id,dTag:ke,decryptedContent:Le,created_at:de.created_at})}}catch(Le){console.warn("[Parlens] Failed to decrypt route:",Le)}}Q.sort((de,ve)=>ve.created_at-de.created_at);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Q))}catch(de){console.warn("[Parlens] Failed to cache routes:",de)}tt(Q)}catch(fe){console.error("Error fetching saved routes:",fe)}finally{Te(!1)}}},[l,N]);De.useEffect(()=>{if(ne&&N){try{const fe=localStorage.getItem("parlens_route_cache_v1");if(fe){const H=JSON.parse(fe);tt(H)}}catch(fe){console.warn("[Parlens] Failed to load cached routes:",fe)}Pr()}},[ne,N,Pr]);const ia=()=>{const fe=!_t;Ft(fe),S?.(fe),fe&&re(!1)};De.useEffect(()=>{if(z){const fe={id:crypto.randomUUID(),name:`Pin ${Ee.length+1}`,lat:z.lat,lon:z.lon};Ae(H=>[...H,fe]),it(null),bt(null),Re(!1),m(null,null,null,!1),k?.(),on({}),re(!0),Ft(!1),S?.(!1)}},[z,Ee,k,S]);const Ur=async()=>{if(!l||!N||!K||!We||Ee.length<2){alert("Please create a route first");return}const fe=ct.trim()||`Route ${new Date().toLocaleDateString()}`;Gt(!0);try{const H=Object.keys(Yt).length===Ee.length?Ee.map((Et,It)=>({name:Et.name,lat:Yt[It].lat,lon:Yt[It].lon})):Ee.map(Et=>({name:Et.name,lat:Et.lat,lon:Et.lon})),$={name:fe,waypoints:H,routeCoords:We,alternateRouteCoords:Dt||void 0,vehicleType:h,created_at:Math.floor(Date.now()/1e3)},Q=localStorage.getItem("parlens_privkey"),de=Q?new Uint8Array(Q.match(/.{1,2}/g).map(Et=>parseInt(Et,16))):void 0,ve=await Qb($,N,de),Le=`route_${Date.now()}`,ke={kind:Ll.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Le],["client","parlens"]],content:ve},ye=await K(ke);console.log("[Parlens] Signed route event:",ye);const Oe=await Promise.allSettled(l.publish(Vo,ye)),Qe=Oe.filter(Et=>Et.status==="fulfilled").length;console.log("[Parlens] Route published:",Qe,"of",Oe.length,"relays"),Qe===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)");const nt={id:ye.id,dTag:Le,decryptedContent:$,created_at:ye.created_at};tt(Et=>{const It=[nt,...Et];try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(It))}catch(Kt){console.warn("Cache update failed",Kt)}return It}),Tt("")}catch(H){console.error("[Parlens] Error saving route:",H),alert("Failed to save route, try again later")}finally{Gt(!1)}},Ir=(fe,H)=>{Ae($=>$.map(Q=>Q.id===fe?{...Q,name:H}:Q)),$e(null),Pt("")},cs=fe=>{$e(fe.id),Pt(fe.name)},Ti=async fe=>{const H=fe.decryptedContent,$=H.waypoints.map(Q=>({id:crypto.randomUUID(),name:Q.name,lat:Q.lat,lon:Q.lon}));Ae($),it(H.routeCoords),bt(H.alternateRouteCoords||null),on({}),Re(!0),pt(!1),m(H.routeCoords,H.alternateRouteCoords||null,H.waypoints.map(Q=>({lat:Q.lat,lon:Q.lon})),!0),re(!1)},Qi=async fe=>{if(!(!l||!N||!K)&&confirm("Are you sure you want to delete this route? This action cannot be undone.")){Xt(!0);try{const H={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",fe.id],["a",`${Ll.ROUTE_LOG}:${N}:${fe.dTag}`]],content:"Deleted by user"},$=await K(H);await Promise.allSettled(l.publish(Vo,$));const Q={kind:Ll.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",fe.dTag],["deleted","true"]],content:""},de=await K(Q);await Promise.allSettled(l.publish(Vo,de)),xn.current.add(fe.dTag),tt(ve=>{const Le=ve.filter(ke=>ke.id!==fe.id);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Le))}catch(ke){console.warn("Cache update failed",ke)}return Le})}catch(H){console.error("Error deleting route:",H),alert("Failed to delete route")}finally{Xt(!1)}}};return Y.jsxs(Y.Fragment,{children:[Y.jsx("button",{onClick:()=>re(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:Y.jsx(SM,{size:20})}),ne&&Y.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[Y.jsx("button",{onClick:()=>re(!1),className:"absolute inset-0 z-0 cursor-default"}),Vt&&Y.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:Y.jsxs("div",{className:"flex flex-col items-center gap-3",children:[Y.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),Y.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),jt&&Y.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:Y.jsxs("div",{className:"flex flex-col items-center gap-3",children:[Y.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),Y.jsx("p",{className:"text-sm font-medium text-white",children:"Saving..."})]})}),Y.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[Y.jsxs("div",{className:"flex items-center justify-between",children:[Y.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent",children:"Create Route"}),Y.jsx("button",{onClick:()=>re(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:Y.jsx(L0,{size:20,className:"text-black/60 dark:text-white/60"})})]}),Y.jsxs("div",{className:"space-y-2",children:[Y.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30 ml-2",children:"Add Waypoint"}),Y.jsx("div",{className:"relative",children:Y.jsx("input",{ref:Ie,type:"text",placeholder:"Search waypoint or coordinate",value:Pe,onChange:fe=>pe(fe.target.value),className:"w-full h-14 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(()=>{const fe=qv(Pe);return fe?Y.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-blue-50 dark:bg-blue-500/10 border border-blue-500/20",children:[Y.jsxs("div",{className:"px-3 py-1.5 text-xs font-medium text-blue-700 dark:text-blue-400 bg-blue-100/50 dark:bg-blue-500/5",children:[" ",fe.type==="plus_code"?"Plus Code Location":"Coordinate"]}),Y.jsxs("button",{onClick:()=>{const H={id:crypto.randomUUID(),name:fe.type==="plus_code"?`Plus Code: ${Pe}`:`Loc: ${pA(fe.lat,fe.lon)}`,lat:fe.lat,lon:fe.lon};Ae($=>[...$,H]),pe(""),it(null),bt(null),Re(!1),m(null,null,null,!1),on({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[Y.jsx($h,{size:16,className:"text-blue-600 dark:text-blue-400 shrink-0"}),Y.jsxs("div",{className:"flex-1 truncate",children:[Y.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Add Location"}),Y.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/60",children:[fe.lat.toFixed(6),", ",fe.lon.toFixed(6)]})]})]})]}):null})(),Pe.length>3&&!qv(Pe)&&qn.length===0&&Y.jsx(AA,{query:Pe,countryCode:Qt,currentLocation:b,onSelect:fe=>{const H={id:crypto.randomUUID(),name:fe.display_name.split(",")[0],lat:parseFloat(fe.lat),lon:parseFloat(fe.lon)};Ae($=>[...$,H]),pe(""),it(null),bt(null),Re(!1),m(null,null,null,!1),on({})}}),qn.length>0&&Y.jsxs("div",{className:"rounded-2xl overflow-hidden bg-green-50 dark:bg-green-500/10 border border-green-500/20",children:[Y.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100/50 dark:bg-green-500/5",children:" From your saved routes"}),qn.map((fe,H)=>Y.jsxs("button",{onClick:()=>{const $={id:crypto.randomUUID(),name:fe.name,lat:fe.lat,lon:fe.lon};Ae(Q=>[...Q,$]),pe(""),it(null),bt(null),Re(!1),m(null,null,null,!1),on({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left border-b border-green-500/10 last:border-0",children:[Y.jsx($h,{size:16,className:"text-green-600 dark:text-green-400 shrink-0"}),Y.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white/80 truncate",children:fe.name})]},`saved-${H}`))]}),b&&Y.jsxs("button",{onClick:()=>{const fe={id:crypto.randomUUID(),name:"Current Location",lat:b[0],lon:b[1]};Ae(H=>[...H,fe]),it(null),bt(null),Re(!1),m(null,null,null,!1),on({})},className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors",children:[Y.jsx(xM,{size:16,className:"text-blue-500"}),Y.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Current Location"})]}),Y.jsxs("button",{onClick:ia,className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-orange-500/10 dark:bg-orange-500/20 border border-orange-500/20 transition-colors",children:[Y.jsx(_M,{size:16,className:"text-orange-500"}),Y.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Drop Pin on Map"})]})]}),Y.jsxs("div",{className:"space-y-2 flex-1",children:[Y.jsxs("div",{className:"flex items-center justify-between ml-2 mr-2",children:[Y.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30",children:["Waypoints (",Ee.length,")"]}),Ee.length>1&&Y.jsx("button",{onClick:Wi,className:"p-1 rounded-md transition-colors",title:"Reverse Order",children:Y.jsx(WE,{size:14,className:"text-zinc-400 dark:text-white/30"})})]}),Ee.length===0?Y.jsx("div",{className:"p-8 text-center text-zinc-400 dark:text-white/30 text-sm",children:"No waypoints added yet."}):Y.jsx("div",{className:"space-y-2",children:Ee.map((fe,H)=>Y.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[Y.jsxs("div",{className:"flex flex-col gap-0.5 -ml-1 mr-1",children:[Y.jsx("button",{onClick:()=>wi(H,-1),disabled:H===0,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:Y.jsx(R0,{size:12})}),Y.jsx("button",{onClick:()=>wi(H,1),disabled:H===Ee.length-1,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:Y.jsx(gf,{size:12})})]}),Y.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 text-white text-xs font-bold flex items-center justify-center shrink-0",children:H+1}),we===fe.id?Y.jsxs(Y.Fragment,{children:[Y.jsx("input",{type:"text",value:vt,onChange:$=>Pt($.target.value),className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-blue-500",autoFocus:!0,onFocus:$=>$.currentTarget.select(),onKeyDown:$=>{$.key==="Enter"&&Ir(fe.id,vt),$.key==="Escape"&&$e(null)}}),Y.jsx("button",{onClick:()=>Ir(fe.id,vt),className:"p-2 rounded-xl text-green-500 hover:bg-green-500/10 transition-colors",children:Y.jsx(tM,{size:16})})]}):Y.jsxs(Y.Fragment,{children:[Y.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white font-medium truncate",children:fe.name}),Y.jsx("button",{onClick:()=>cs(fe),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:Y.jsx(wM,{size:14})})]}),Y.jsx("button",{onClick:()=>Ki(fe.id),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:Y.jsx($_,{size:16})})]},fe.id))})]}),We&&Y.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[Y.jsxs("div",{className:"flex items-center gap-3",children:[ie?Y.jsx(uM,{size:20,className:"text-blue-500"}):Y.jsx(lM,{size:20,className:"text-zinc-400"}),Y.jsx("span",{className:"font-medium text-zinc-700 dark:text-white",children:"Show on Map"})]}),Y.jsx("button",{onClick:na,className:`w-14 h-8 rounded-full transition-colors ${ie?"bg-blue-500":"bg-zinc-300 dark:bg-white/20"}`,children:Y.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${ie?"translate-x-7":"translate-x-1"}`})})]}),We&&N&&Y.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-green-500/5 dark:bg-green-500/10 border border-green-500/20",children:[Y.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2",children:[Y.jsx(MM,{size:14}),"Save Route"]}),Y.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[Y.jsx("input",{type:"text",value:ct,onChange:fe=>Tt(fe.target.value),placeholder:"Route name (optional)",className:"w-full sm:flex-1 p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10 text-zinc-700 dark:text-white placeholder-zinc-400 dark:placeholder-white/40 text-sm"}),Y.jsx("button",{onClick:Ur,disabled:jt,className:"w-full sm:w-auto px-6 rounded-xl bg-green-500 text-white font-bold disabled:opacity-50 transition-all active:scale-95 py-3 sm:py-0",children:jt?"...":"Save"})]})]}),Y.jsxs("div",{className:"flex gap-3",children:[Y.jsx("button",{onClick:zn,disabled:Ee.length===0,className:"flex-1 h-14 rounded-2xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:"Clear Route"}),Y.jsx("button",{onClick:Yn,disabled:Ee.length<2||rt,className:"flex-1 h-14 rounded-2xl bg-blue-500 text-white font-bold shadow-lg shadow-blue-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:rt?"Creating...":"Create Route"})]}),!We&&Ee.length>=2&&N&&Y.jsx("p",{className:"text-xs text-center text-zinc-400 dark:text-white/40",children:" Save option will appear after you create the route"}),N&&Y.jsxs("div",{className:"space-y-3 border-t border-black/5 dark:border-white/10 pt-4",children:[Y.jsxs("button",{onClick:()=>pt(!He),className:"w-full flex items-center justify-between",children:[Y.jsxs("div",{className:"flex items-center gap-2",children:[Y.jsx(dM,{size:18,className:"text-zinc-500 dark:text-white/50"}),Y.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30",children:["Saved Routes (",st.length,")"]})]}),Y.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:He?"Hide":"Show"})]}),He&&Y.jsx("div",{className:"space-y-2",children:ut?Y.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):st.length===0?Y.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"No saved routes yet"}):st.map(fe=>Y.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[Y.jsxs("button",{onClick:()=>Ti(fe),className:"flex-1 text-left",children:[Y.jsx("div",{className:"font-medium text-sm text-zinc-700 dark:text-white truncate",children:fe.decryptedContent.name}),Y.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[Y.jsxs("span",{children:[fe.decryptedContent.waypoints.length," stops"]}),Y.jsx("span",{children:""}),Y.jsx(Zb,{size:12}),Y.jsx("span",{children:new Date(fe.created_at*1e3).toLocaleDateString()})]})]}),Y.jsx("button",{onClick:()=>Qi(fe),className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:Y.jsx($_,{size:16})})]},fe.id))})]}),Y.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20",children:Y.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[Y.jsx("strong",{children:"Tip:"})," Use ",Y.jsx("strong",{children:"Drop Pin on Map"})," and",Y.jsx("strong",{children:" edit waypoint names"})," to label locations. When you ",Y.jsx("strong",{children:"save routes"}),", waypoint names become searchable  building your personal offline map over time! "]})})]})]})]})};function zA(h){return h>=17?8:h>=15?7:h>=13?6:h>=11?5:h>=9?4:3}function Gv(h,m,b=!0){if(!b||h.length<2)return h;const S=zA(m),z=new Map;for(const A of h){const l=m>=15?`${A.lat.toFixed(4)},${A.lon.toFixed(4)}`:zy(A.lat,A.lon,S);if(z.has(l)){const N=z.get(l);N.spots.push(A),N.count++,N.minPrice=Math.min(N.minPrice,A.price),N.maxPrice=Math.max(N.maxPrice,A.price),N.lat=N.spots.reduce((K,ne)=>K+ne.lat,0)/N.count,N.lon=N.spots.reduce((K,ne)=>K+ne.lon,0)/N.count}else z.set(l,{id:`cluster-${l}`,lat:A.lat,lon:A.lon,spots:[A],minPrice:A.price,maxPrice:A.price,currency:A.currency,count:1})}const k=[];for(const A of z.values())A.count===1?k.push(A.spots[0]):k.push(A);return k}function Zv(h){return"count"in h&&h.count>1}class k_{q;r;x;p;k;initialized=!1;constructor(m=1e-5,b=.001){this.q=m,this.r=b,this.x=0,this.p=1,this.k=0}filter(m){return this.initialized?(this.p=this.p+this.q,this.k=this.p/(this.p+this.r),this.x=this.x+this.k*(m-this.x),this.p=(1-this.k)*this.p,this.x):(this.x=m,this.initialized=!0,m)}reset(){this.initialized=!1,this.x=0,this.p=1}}class DA{latFilter;lonFilter;bearingFilter;hasLastBearing=!1;constructor(){this.latFilter=new k_(1e-5,.005),this.lonFilter=new k_(1e-5,.005),this.bearingFilter=new k_(.005,.8)}cumulativeBearing=0;lastInputBearing=0;smoothLocation(m,b){return[this.latFilter.filter(m),this.lonFilter.filter(b)]}smoothBearing(m,b,S=!1){if(!S&&b<2)return null;const z=(m%360+360)%360;if(!this.hasLastBearing)return this.lastInputBearing=z,this.cumulativeBearing=z,this.hasLastBearing=!0,this.bearingFilter.reset(),this.bearingFilter.filter(z),z;let k=z-this.lastInputBearing;return k>180?k-=360:k<-180&&(k+=360),this.cumulativeBearing+=k,this.lastInputBearing=z,(this.bearingFilter.filter(this.cumulativeBearing)%360+360)%360}reset(){this.latFilter.reset(),this.lonFilter.reset(),this.bearingFilter.reset(),this.cumulativeBearing=0,this.lastInputBearing=0,this.hasLastBearing=!1}}class PA{currentRotation=0;lastRawBearing=0;initialized=!1;setBearing(m){const b=(m%360+360)%360;if(!this.initialized)return this.currentRotation=b,this.lastRawBearing=b,this.initialized=!0,this.currentRotation;let S=b-this.lastRawBearing;return S>180?S-=360:S<-180&&(S+=360),this.currentRotation+=S,this.lastRawBearing=b,this.currentRotation}getCurrentRotation(){return this.currentRotation}reset(m=0){this.currentRotation=m,this.lastRawBearing=(m%360+360)%360,this.initialized=!0}}class IA{startLat=0;startLon=0;targetLat=0;targetLon=0;currentLat=0;currentLon=0;startTime=0;duration=300;animationId=null;onUpdate=null;setUpdateCallback(m){this.onUpdate=m}animateTo(m,b,S=300){if(this.animationId!==null&&cancelAnimationFrame(this.animationId),this.targetLat===0&&this.targetLon===0){this.targetLat=m,this.targetLon=b,this.currentLat=m,this.currentLon=b,this.onUpdate&&this.onUpdate(m,b);return}this.startLat=this.currentLat||this.targetLat,this.startLon=this.currentLon||this.targetLon,this.targetLat=m,this.targetLon=b,this.startTime=performance.now(),this.duration=S,this.animate()}animate=()=>{const b=performance.now()-this.startTime,S=Math.min(b/this.duration,1),z=1-Math.pow(1-S,3),k=this.startLat+(this.targetLat-this.startLat)*z,A=this.startLon+(this.targetLon-this.startLon)*z;this.currentLat=k,this.currentLon=A,this.onUpdate&&this.onUpdate(k,A),S<1?this.animationId=requestAnimationFrame(this.animate):this.animationId=null};stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class kA{anchorLat=0;anchorLon=0;displayLat=0;displayLon=0;lastRawLat=0;lastRawLon=0;lastUpdateTime=0;speedHistory=[];currentSpeedClass="stationary";predictedBearing=0;directionChangeBuffer=[];initialized=!1;bufferZones={stationary:20,walking:12,vehicle:6,fast_vehicle:4};pollIntervals={stationary:15e3,walking:5e3,vehicle:2e3,fast_vehicle:1e3};animationDurations={stationary:1200,walking:800,vehicle:400,fast_vehicle:200};haversineDistance(m,b,S,z){const A=(S-m)*Math.PI/180,l=(z-b)*Math.PI/180,N=Math.sin(A/2)*Math.sin(A/2)+Math.cos(m*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))}calculateBearing(m,b,S,z){const k=(z-b)*Math.PI/180,A=Math.sin(k)*Math.cos(S*Math.PI/180),l=Math.cos(m*Math.PI/180)*Math.sin(S*Math.PI/180)-Math.sin(m*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.cos(k);return(Math.atan2(A,l)*180/Math.PI+360)%360}updateLocation(m,b){const S=Date.now();if(!this.initialized)return this.anchorLat=m,this.anchorLon=b,this.displayLat=m,this.displayLon=b,this.lastRawLat=m,this.lastRawLon=b,this.lastUpdateTime=S,this.initialized=!0,{displayLat:m,displayLon:b,speed:0,speedClass:"stationary",shouldUpdate:!0,animationDuration:0,bearing:null};const z=this.haversineDistance(this.anchorLat,this.anchorLon,m,b),k=(S-this.lastUpdateTime)/1e3,A=this.haversineDistance(this.lastRawLat,this.lastRawLon,m,b),l=k>0?A/k:0;this.speedHistory.push(l),this.speedHistory.length>5&&this.speedHistory.shift();const N=this.speedHistory.reduce((Pe,pe)=>Pe+pe,0)/this.speedHistory.length;let K;N<.5?K="stationary":N<2?K="walking":N<10?K="vehicle":K="fast_vehicle",this.currentSpeedClass=K;const ne=this.bufferZones[K];if(A>1){const Pe=this.calculateBearing(this.lastRawLat,this.lastRawLon,m,b);this.directionChangeBuffer.push(Pe),this.directionChangeBuffer.length>3&&this.directionChangeBuffer.shift(),this.predictedBearing=this.directionChangeBuffer.reduce((pe,ie)=>pe+ie,0)/this.directionChangeBuffer.length}this.lastRawLat=m,this.lastRawLon=b,this.lastUpdateTime=S;let re=!1,Ee=this.displayLat,Ae=this.displayLon;return z>ne?(this.anchorLat=m,this.anchorLon=b,Ee=m,Ae=b,re=!0):(Ee=this.anchorLat,Ae=this.anchorLon,re=!1),re&&(this.displayLat=Ee,this.displayLon=Ae),{displayLat:this.displayLat,displayLon:this.displayLon,speed:N,speedClass:K,shouldUpdate:re,animationDuration:this.animationDurations[K],bearing:this.predictedBearing}}getPollingInterval(){return this.pollIntervals[this.currentSpeedClass]}getSpeedClass(){return this.currentSpeedClass}getPredictedBearing(){return this.predictedBearing}getSpeedHistoryAverage(){return this.speedHistory.length===0?0:this.speedHistory.reduce((m,b)=>m+b,0)/this.speedHistory.length}reset(){this.initialized=!1,this.anchorLat=0,this.anchorLon=0,this.displayLat=0,this.displayLon=0,this.speedHistory=[],this.currentSpeedClass="stationary",this.directionChangeBuffer=[]}}const RA=()=>{const h=De.useRef(null),[m,b]=De.useState(!1),S=De.useCallback(async()=>{if("wakeLock"in navigator)try{const k=await navigator.wakeLock.request("screen");h.current=k,b(!0),k.addEventListener("release",()=>{b(!1),h.current=null}),console.log("[Parlens] Screen Wake Lock acquired")}catch(k){console.warn("[Parlens] Failed to acquire Wake Lock:",k),b(!1)}else console.warn("[Parlens] Wake Lock API not supported")},[]),z=De.useCallback(async()=>{if(h.current)try{await h.current.release(),h.current=null,b(!1),console.log("[Parlens] Screen Wake Lock released")}catch(k){console.warn("[Parlens] Failed to release Wake Lock:",k)}},[]);return De.useEffect(()=>{const k=async()=>{document.visibilityState==="visible"&&m&&await S()};return document.addEventListener("visibilitychange",k),()=>{document.removeEventListener("visibilitychange",k)}},[m,S]),{requestLock:S,releaseLock:z,isLocked:m}},Hv={light:"https://tiles.openfreemap.org/styles/positron",dark:"https://tiles.openfreemap.org/styles/dark"},$v=De.memo(({price:h,emoji:m,currency:b,isHistory:S=!1})=>{const z=ug(b);return Y.jsxs("div",{className:"flex flex-col items-center justify-center cursor-pointer transition-transform active:scale-95",children:[Y.jsx("div",{className:"text-[32px] leading-none drop-shadow-md z-10 filter",children:m}),Y.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap
                    ${S?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[z,Math.round(h),"/hr"]})]})}),X_=De.memo(({bearing:h,mapBearing:m,isNavigationMode:b})=>{const S=h-m,z=De.useRef(0),k=De.useRef(0),A=S-k.current;Math.abs(A)>180&&(A>0?z.current-=360:z.current+=360),k.current=S;const l=S+z.current;return Y.jsx("div",{style:{transform:`rotate(${l}deg) scale(1)`,transition:"transform 0.2s ease-out",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:Y.jsx("div",{style:{width:28,height:28,background:"#007AFF",border:"3px solid white",borderRadius:"50%",boxShadow:`0 0 0 ${b?3:2}px rgba(0,122,255,${b?.5:.4}), 0 4px 12px rgba(0,0,0,0.4)`,display:"flex",alignItems:"center",justifyContent:"center"},children:Y.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",style:{transform:"translateY(-1px)"},children:Y.jsx("path",{d:"M7 0L14 14L7 12L0 14L7 0Z",fill:"white"})})})})});X_.displayName="UserLocationMarker";const Y_=De.memo(({count:h,minPrice:m,maxPrice:b,currency:S,type:z})=>{const k=z==="open"?"":"",A=z==="history",l=ug(S),N=m===b?`${l}${m}`:`${l}${m}-${b}`;return Y.jsxs("div",{className:"flex flex-col items-center justify-center cursor-pointer transition-transform active:scale-95 pointer-events-none",children:[Y.jsxs("div",{className:"relative text-[32px] leading-none drop-shadow-md z-10 filter",children:[k,Y.jsx("div",{className:`
                    absolute -top-1 -right-1 flex items-center justify-center min-w-[18px] h-[18px] px-1
                    text-[10px] font-bold text-white rounded-full border-2 border-white shadow-sm
                    ${A?"bg-zinc-500":"bg-[#34C759]"}
                `,children:h})]}),Y.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap
                    ${A?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[N,"/hr"]})]})});Y_.displayName="ClusterMarkerContent";const a1=De.memo(({vehicleType:h})=>{const m=h==="bicycle"?"":h==="motorcycle"?"":"";return Y.jsx("div",{style:{fontSize:36,filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.4))",pointerEvents:"none"},children:m})});a1.displayName="ActiveSessionMarkerContent";const s1=De.memo(({vehicleType:h,onVehicleChange:m,disabled:b})=>{const[S,z]=De.useState(!1),k=["bicycle","motorcycle","car"],A={bicycle:"",motorcycle:"",car:""};return Y.jsx("div",{className:"flex flex-col rounded-[2rem] bg-white/80 dark:bg-white/10 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg mb-2 overflow-hidden transition-all duration-300",children:S?Y.jsxs("div",{className:"flex flex-col gap-1 p-1",children:[k.map(l=>Y.jsx("button",{onClick:()=>{b?b&&alert("Please end your current session before changing vehicle type."):(m(l),z(!1))},className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${h===l?"bg-blue-500/20 shadow-inner":"transition-colors"}`,children:Y.jsx("span",{className:`text-lg ${h===l?"":"opacity-50"}`,children:A[l]})},l)),Y.jsx("button",{onClick:()=>z(!1),className:"w-10 h-6 flex items-center justify-center text-zinc-400 dark:text-white/40 transition-colors",children:Y.jsx(R0,{size:16})})]}):Y.jsxs("button",{onClick:()=>z(!0),className:"flex flex-col items-center p-1 transition-all",children:[Y.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-500/20",children:Y.jsx("span",{className:"text-lg",children:A[h]})}),Y.jsx(gf,{size:14,className:"text-zinc-400 dark:text-white/40 mt-0.5"})]})})});s1.displayName="VehicleToggle";const LA=()=>{const h=De.useRef(null),[m,b]=De.useState(null),S=De.useRef(new DA),z=De.useRef(new PA),k=De.useRef(new IA),[A,l]=De.useState(null),[N,K]=De.useState("idle"),[ne,re]=De.useState("fixed"),[Ee,Ae]=De.useState(!1),[Pe,pe]=De.useState(!1),[ie,Re]=De.useState(()=>{const lt=localStorage.getItem("parlens_vehicle_type");return lt==="bicycle"||lt==="motorcycle"||lt==="car"?lt:"car"}),[We,it]=De.useState([]),[Dt,bt]=De.useState([]),[rt,at]=De.useState(null),[Ie,st]=De.useState(!1),[tt,ct]=De.useState(17),[Tt,jt]=De.useState(null),[Gt,ut]=De.useState(null),[Te,He]=De.useState(null),[pt,_t]=De.useState(!1),[Ft,we]=De.useState(!1),[$e,vt]=De.useState(null),[Pt,Vt]=De.useState(null),[Xt,Qt]=De.useState(!1),[rn,Yt]=De.useState({longitude:77.5946,latitude:12.9716,zoom:17,bearing:0,pitch:0}),on=De.useRef(!1),xn=De.useRef(!1),qn=window.matchMedia("(prefers-color-scheme: dark)").matches,[Ki,zn]=De.useState(!1),[wi,Wi]=De.useState(0),[Yn,na]=De.useState(0),{requestLock:Pr,releaseLock:ia}=RA(),Ur=De.useRef(new kA),[Ir,cs]=De.useState(0),Ti=De.useRef(!1),Qi=De.useRef(0),fe=De.useRef(0);De.useEffect(()=>{N==="parked"&&(re("fixed"),Yt(lt=>({...lt,bearing:0,pitch:0})),h.current?.rotateTo(0,{duration:800}))},[N]),De.useEffect(()=>{if(!navigator.geolocation){l("Geolocation is not supported by your browser");return}const lt=navigator.geolocation.watchPosition(Ot=>{const{latitude:Mt,longitude:tn}=Ot.coords,[Tn,Sn]=S.current.smoothLocation(Mt,tn),un=Ur.current.updateLocation(Tn,Sn);un.shouldUpdate&&k.current.animateTo(un.displayLat,un.displayLon,un.animationDuration),cs(un.speed),Qi.current=un.speed,Ti.current||(Ti.current=!0,b([un.displayLat,un.displayLon]),Yt(Dn=>({...Dn,latitude:un.displayLat,longitude:un.displayLon})))},Ot=>{let Mt="Unable to get your location";Ot.code===1?Mt="Location access denied. Please enable location services.":Ot.code===2?Mt="Location unavailable. Check your GPS settings.":Ot.code===3&&(Mt="Location request timed out."),l(Mt)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return k.current.setUpdateCallback((Ot,Mt)=>{b([Ot,Mt]),re(tn=>{if((tn==="auto"||tn==="recentre")&&!on.current){if(Qi.current<.3&&tn!=="recentre")return tn;Yt(Tn=>{const Sn=h.current?.getZoom()??Tn.zoom,un=.1,Dn=Tn.latitude+(Ot-Tn.latitude)*un,ai=Tn.longitude+(Mt-Tn.longitude)*un;return{...Tn,latitude:Dn,longitude:ai,zoom:Sn}})}return tn})}),()=>{navigator.geolocation.clearWatch(lt),k.current.stop()}},[]),De.useEffect(()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&zn(!0);const lt=Ot=>{if(on.current)return;let Mt=null;if(Ot.webkitCompassHeading?Mt=Ot.webkitCompassHeading:Ot.alpha!==null&&(Mt=360-Ot.alpha),Mt!==null){const tn=window.screen.orientation?.angle??window.orientation??0;Mt=(Mt+tn)%360}if(Mt!==null){fe.current=Mt,na(Tn=>{let un=Mt-Tn;return un>180&&(un-=360),un<-180&&(un+=360),Math.abs(un)<2?Tn:Tn+un*.1});const tn=S.current.smoothBearing(Mt,0,!0);if(tn!==null){const Tn=z.current.setBearing(tn);Wi(Tn)}}};return window.addEventListener("deviceorientation",lt,!0),()=>{window.removeEventListener("deviceorientation",lt,!0)}},[]);const H=async()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&await DeviceOrientationEvent.requestPermission()==="granted"&&zn(!1)};De.useEffect(()=>{!on.current&&!xn.current&&m&&(ne==="auto"||ne==="recentre")&&Yt(lt=>{const Ot=h.current?.getZoom()??lt.zoom,Mt={...lt,longitude:m[1],latitude:m[0],zoom:Ot,pitch:0};return ne==="auto"&&(Mt.bearing=wi,Mt.transitionDuration=100),Mt})},[m,wi,ne,pt]),De.useEffect(()=>(Pr(),()=>{ia()}),[Pr,ia]),De.useEffect(()=>{const lt=localStorage.getItem("parlens_session");if(lt)try{const Ot=JSON.parse(lt);Ot.status==="parked"&&Ot.parkLocation&&Ot.sessionStart?(console.log("[Parlens] Restoring parked session:",Ot),Vt(Ot.sessionStart),at(Ot.parkLocation),K("parked")):Ot.status==="search"&&(console.log("[Parlens] Restoring search session"),K("search"))}catch(Ot){console.warn("[Parlens] Failed to restore session:",Ot),localStorage.removeItem("parlens_session")}},[]),De.useEffect(()=>{N==="parked"&&Pt&&rt?localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:Pt,parkLocation:rt})):N==="search"?localStorage.setItem("parlens_session",JSON.stringify({status:"search"})):N==="idle"&&(localStorage.removeItem("parlens_session"),Vt(null))},[N,Pt,rt]);const $=De.useCallback(lt=>{Yt(lt.viewState);let Ot=!1;if(h.current&&(ve.current&&(Ot=!0),h.current.isZooming()&&(Ot=!0),lt&&lt.originalEvent&&lt.originalEvent.touches&&lt.originalEvent.touches.length>1&&(Ot=!0)),on.current&&(ne==="auto"||ne==="recentre")&&!Ot){let Mt=1;m&&(Mt=Math.sqrt(Math.pow(lt.viewState.longitude-m[1],2)+Math.pow(lt.viewState.latitude-m[0],2))),Mt>1e-4&&re("fixed")}},[m,ne,Ie]),Q=De.useCallback(lt=>{lt.originalEvent&&(on.current=!0,k.current.stop(),xn.current&&(h.current?.stop(),xn.current=!1))},[]),de=De.useCallback(()=>{setTimeout(()=>{on.current=!1},1e3),ct(rn.zoom)},[rn.zoom]),ve=De.useRef(!1),Le=De.useCallback(()=>{ve.current=!0,on.current=!0,k.current.stop(),xn.current&&(h.current?.stop(),xn.current=!1)},[]),ke=De.useCallback(()=>{ve.current=!1,setTimeout(()=>{ve.current||(on.current=!1)},1e3)},[]),ye=De.useCallback(lt=>{Ft&&vt({lat:lt.lngLat.lat,lon:lt.lngLat.lng})},[Ft]),Oe=lt=>{if(N!=="idle"){alert("Please end your current session before changing vehicle type.");return}Re(lt),localStorage.setItem("parlens_vehicle_type",lt)},Qe=De.useCallback((lt,Ot,Mt,tn)=>{if(jt(lt),ut(Ot),He(Mt),_t(tn),lt&&lt.length>1&&h.current&&tn){const Tn=[...lt];Ot&&Ot.length>0&&Tn.push(...Ot);const Sn=Tn.map(ai=>ai[1]),un=Tn.map(ai=>ai[0]),Dn=new Wb.LngLatBounds([Math.min(...Sn),Math.min(...un)],[Math.max(...Sn),Math.max(...un)]);xn.current=!0,h.current.fitBounds(Dn,{padding:50,duration:1e3}),re("fixed"),setTimeout(()=>{xn.current=!1,typeof DeviceOrientationEvent.requestPermission=="function"&&zn(!0)},1200)}},[]),nt=De.useMemo(()=>Dt.filter(Ot=>(Ot.decryptedContent?.type||"car")===ie).map(Ot=>{const Mt=Ot.decryptedContent;return Mt&&Mt.lat&&Mt.lon?{id:Ot.id,lat:Mt.lat,lon:Mt.lon,price:parseFloat(Mt.fee)||0,currency:Mt.currency||"USD",original:Ot}:null}).filter(Boolean),[Dt,ie]),Et=De.useMemo(()=>Gv(nt,tt),[nt,tt]),It=De.useMemo(()=>N!=="search"?[]:We.filter(lt=>(lt.type||"car")===ie).map(lt=>({id:lt.id,lat:lt.lat,lon:lt.lon,price:lt.price,currency:lt.currency,original:lt})),[We,ie,N]),Kt=De.useMemo(()=>Gv(It,tt),[It,tt]),gn=qn?Hv.dark:Hv.light,pn={id:"route",type:"line",paint:{"line-color":"#007AFF","line-width":5,"line-opacity":.9}},Ne={id:"alternate-route",type:"line",paint:{"line-color":"#007AFF","line-width":3,"line-opacity":.4,"line-dasharray":[2,2]}};return Y.jsxs("div",{className:"fixed inset-0 overflow-hidden bg-gray-50 dark:bg-black transition-colors duration-300",children:[(!m&&!A||!Xt)&&Y.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:Y.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:A?Y.jsxs(Y.Fragment,{children:[Y.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center",children:Y.jsx("span",{className:"text-2xl",children:""})}),Y.jsx("p",{className:"text-sm font-medium text-red-500 dark:text-red-400",children:A}),Y.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-6 py-2 rounded-full bg-blue-500 text-white text-sm font-medium active:scale-95 transition-transform",children:"Try Again"})]}):Y.jsxs(Y.Fragment,{children:[Y.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"}),Y.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Locating..."})]})})}),Ft&&Y.jsx("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-orange-500 text-white py-3 px-4 text-center font-medium shadow-lg animate-pulse",children:" Tap anywhere on the map to drop a pin"}),N==="parked"&&Y.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[1000] h-12 px-6 bg-[#34C759] rounded-full shadow-lg flex items-center gap-3 animate-in slide-in-from-top-4 pointer-events-none",children:[Y.jsx("div",{className:"text-xl",children:ie==="bicycle"?"":ie==="motorcycle"?"":""}),Y.jsx("span",{className:"font-bold text-white whitespace-nowrap",children:"Session Active"})]}),N==="search"&&Y.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[1000] h-12 px-6 bg-white dark:bg-zinc-800 rounded-full shadow-lg flex items-center gap-3 animate-in slide-in-from-top-4 pointer-events-none",children:[Y.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#FF9500] animate-pulse"}),Y.jsx("span",{className:"font-bold text-zinc-900 dark:text-white whitespace-nowrap",children:"Searching for spots"})]}),ne==="auto"&&m&&Y.jsx("div",{className:"absolute top-1/2 left-1/2 z-[900] pointer-events-none flex items-center justify-center",style:{transform:"translate(-50%, -50%)",width:"40px",height:"40px"},children:Y.jsx(X_,{bearing:Yn,mapBearing:rn.bearing,isNavigationMode:!0})}),Y.jsx("div",{className:"absolute inset-0",onPointerDownCapture:()=>{on.current=!0,k.current.stop(),xn.current&&(h.current?.stop(),xn.current=!1)},onTouchStartCapture:()=>{on.current=!0,k.current.stop(),xn.current&&(h.current?.stop(),xn.current=!1)},onWheelCapture:()=>{on.current=!0,xn.current&&(h.current?.stop(),xn.current=!1),window.wheelDebounce&&clearTimeout(window.wheelDebounce),window.wheelDebounce=setTimeout(()=>{on.current=!1},1e3)},style:{touchAction:"none"},children:Y.jsxs($M,{ref:h,...rn,onLoad:lt=>{Qt(!0);const Ot=lt.target;Ot&&Ot.getStyle().layers?.forEach(tn=>{(tn.id.includes("oneway")||tn.id.includes("arrow")||tn.id.includes("direction"))&&Ot.setLayoutProperty(tn.id,"visibility","none")})},onMove:$,onMoveStart:Q,onMoveEnd:de,onZoomStart:Le,onZoomEnd:ke,onRotateStart:()=>{on.current=!0,k.current.stop()},onRotateEnd:de,onPitchStart:()=>{on.current=!0,k.current.stop()},onPitchEnd:de,onClick:lt=>{ye(lt)},style:{width:"100%",height:"100%"},mapStyle:gn,attributionControl:!1,dragPan:!xn.current,minZoom:3,maxZoom:20,renderWorldCopies:!1,children:[pt&&Gt&&Gt.length>1&&Y.jsx(Nv,{id:"alternate-route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Gt.map(lt=>[lt[1],lt[0]])}},children:Y.jsx(Fv,{...Ne})}),pt&&Tt&&Tt.length>1&&Y.jsx(Nv,{id:"route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Tt.map(lt=>[lt[1],lt[0]])}},children:Y.jsx(Fv,{...pn})}),N==="search"&&Kt.map(lt=>{const Ot=Zv(lt);return Y.jsx(ag,{longitude:lt.lon,latitude:lt.lat,anchor:"center",style:{willChange:"transform"},onClick:Mt=>{Mt.originalEvent.stopPropagation(),Ot?h.current?.flyTo({center:[lt.lon,lt.lat],zoom:rn.zoom+2}):ye({lngLat:{lng:lt.lon,lat:lt.lat}})},children:Ot?Y.jsx(Y_,{count:lt.count,minPrice:lt.minPrice,maxPrice:lt.maxPrice,currency:lt.currency,type:"open"}):Y.jsx($v,{price:lt.price,currency:lt.currency,emoji:""})},`open-${lt.id}`)}),Et.map(lt=>{const Ot=Zv(lt);return Y.jsx(ag,{longitude:lt.lon,latitude:lt.lat,anchor:"center",style:{willChange:"transform"},onClick:Mt=>{Mt.originalEvent.stopPropagation(),Ot&&h.current?.flyTo({center:[lt.lon,lt.lat],zoom:rn.zoom+2})},children:Ot?Y.jsx(Y_,{count:lt.count,minPrice:lt.minPrice,maxPrice:lt.maxPrice,currency:lt.currency,type:"history"}):Y.jsx($v,{price:lt.price,currency:lt.currency,emoji:"",isHistory:!0})},`history-${lt.id}`)}),pt&&Te?.map((lt,Ot)=>Y.jsx(ag,{longitude:lt.lon,latitude:lt.lat,anchor:"center",children:Y.jsx("div",{style:{width:20,height:20,background:"#007AFF",border:"2px solid white",borderRadius:"50%",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:10,fontWeight:"bold"},children:Ot+1})},`waypoint-${Ot}`)),N==="parked"&&rt&&Y.jsx(ag,{longitude:rt[1],latitude:rt[0],anchor:"center",children:Y.jsx(a1,{vehicleType:ie})}),m&&ne!=="auto"&&Y.jsx(ag,{longitude:m[1],latitude:m[0],anchor:"center",style:{zIndex:1e3},children:Y.jsx(X_,{bearing:Yn,mapBearing:rn.bearing,isNavigationMode:!1})})]})}),Y.jsxs("div",{className:"absolute z-[1000] flex flex-col items-start gap-3 animate-in slide-in-from-left-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",left:"max(1rem, env(safe-area-inset-left))"},children:[Y.jsx(s1,{vehicleType:ie,onVehicleChange:Oe,disabled:N!=="idle"}),Y.jsx("button",{onClick:()=>pe(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95",children:Y.jsx(zv,{size:20})})]}),Y.jsxs("div",{className:"absolute z-[1000] flex flex-col items-end gap-3 animate-in slide-in-from-right-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",right:"max(1rem, env(safe-area-inset-right))"},children:[Math.abs(rn.bearing)>5&&ne!=="auto"&&Y.jsx("button",{onClick:()=>{h.current?.rotateTo(0,{duration:400}),Yt(lt=>({...lt,bearing:0,pitch:0}))},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10",title:"Reset to true north",children:Y.jsxs("div",{className:"flex flex-col items-center justify-center",style:{transform:`rotate(${-rn.bearing}deg)`},children:[Y.jsx("div",{style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"10px solid rgb(239 68 68)"}}),Y.jsx("span",{className:"text-sm font-bold text-zinc-600 dark:text-white/70",style:{marginTop:"-2px"},children:"N"})]})}),Y.jsx("button",{onClick:async()=>{if(Ki){await H();return}h.current?.stop(),xn.current=!1;const lt=rn.zoom,Ot=17;if(Ie){if(m){const Mt=lt<Ot?Ot:lt;xn.current=!0,h.current?.flyTo({center:[m[1],m[0]],zoom:Mt,duration:800,essential:!0}),h.current?.once("moveend",()=>{xn.current=!1})}re("recentre"),st(!1);return}if((ne==="fixed"||ne==="recentre")&&m&&(xn.current=!0,h.current?.flyTo({center:[m[1],m[0]],zoom:lt<Ot?Ot:lt,bearing:0,duration:800,essential:!0}),h.current?.once("moveend",()=>{xn.current=!1,ne==="fixed"&&re("recentre")})),ne==="recentre"){if(N==="parked"){xn.current=!0,h.current?.flyTo({bearing:0,pitch:0,zoom:16.5,duration:800,essential:!0}),h.current?.once("moveend",()=>{xn.current=!1}),re("fixed");return}const Mt=Yn||0;xn.current=!0,Ae(!0),h.current?.rotateTo(Mt,{duration:800}),h.current?.once("moveend",()=>{xn.current=!1,Ae(!1),z.current.reset(Mt),re("auto")});return}re(Mt=>Mt==="auto"?(xn.current=!0,h.current?.flyTo({bearing:0,pitch:0,zoom:16.5,duration:800,essential:!0}),h.current?.once("moveend",()=>{xn.current=!1}),Ae(!1),"fixed"):"recentre")},className:`h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg ${Ki?"bg-orange-500/20 border-orange-500/50 text-orange-500 animate-pulse":"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70"}`,children:Ki?Y.jsx($h,{size:20}):ne==="auto"||Ee?Y.jsx(JE,{size:20,className:"text-blue-500"}):ne==="recentre"?Y.jsx(mM,{size:20,fill:"currentColor",className:"text-green-500"}):Y.jsx($h,{size:20})}),Y.jsx(CA,{vehicleType:ie,onRouteChange:Qe,currentLocation:m,onDropPinModeChange:we,pendingDropPin:$e,onDropPinConsumed:()=>vt(null)}),Y.jsx("div",{className:"relative z-[1010]",children:Y.jsx(MA,{setHistorySpots:bt})}),Y.jsx(SA,{status:N,setStatus:K,searchLocation:m,vehicleType:ie,setOpenSpots:it,parkLocation:rt,setParkLocation:at,sessionStart:Pt,setSessionStart:Vt})]}),Pe&&Y.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl pt-2 px-4 pb-4 animate-in fade-in",children:[Y.jsx("button",{onClick:()=>pe(!1),className:"absolute inset-0 z-0 cursor-default"}),Y.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] border border-black/5 dark:border-white/5 shadow-2xl p-6 space-y-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar transition-colors",style:{overscrollBehaviorY:"contain"},children:[Y.jsx("button",{onClick:()=>pe(!1),className:"absolute top-6 right-6 p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:Y.jsx(L0,{size:20,className:"text-black/60 dark:text-white/60"})}),Y.jsxs("div",{className:"text-center space-y-2 pt-4",children:[Y.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4",children:Y.jsx(zv,{size:32})}),Y.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"How to use Parlens"}),Y.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Decentralized Route & Parking Management"})]}),Y.jsxs("div",{className:"space-y-3",children:[Y.jsx("h3",{className:"text-center font-bold text-zinc-600 dark:text-white/90",children:"Add to your homescreen"}),Y.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[Y.jsxs("button",{onClick:()=>{document.getElementById("android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[Y.jsx("span",{children:"Using Browser Menu (Android)"}),Y.jsx(gf,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),Y.jsxs("div",{id:"android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:[Y.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white",children:"Chrome & Brave:"}),Y.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[Y.jsx("li",{children:"Tap menu button (three dots)"}),Y.jsxs("li",{children:["Tap ",Y.jsx("strong",{children:"Add to Home screen"})]}),Y.jsxs("li",{children:["Tap ",Y.jsx("strong",{children:"Add"})," to confirm"]})]}),Y.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white mt-3",children:"Firefox:"}),Y.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[Y.jsx("li",{children:"Tap menu button (three dots)"}),Y.jsxs("li",{children:["Tap ",Y.jsx("strong",{children:"Install"})]})]})]})]}),Y.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[Y.jsxs("button",{onClick:()=>{document.getElementById("ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[Y.jsx("span",{children:"Using Share Button (iOS)"}),Y.jsx(gf,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),Y.jsx("div",{id:"ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:Y.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[Y.jsxs("li",{children:["Tap the ",Y.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),Y.jsxs("li",{children:["Scroll down and tap ",Y.jsx("strong",{children:"Add to Home Screen"}),"."]}),Y.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),Y.jsxs("div",{className:"space-y-6 text-sm text-zinc-600 dark:text-white/80 leading-relaxed pt-4 border-t border-black/5 dark:border-white/10",children:[Y.jsxs("p",{children:[Y.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),Y.jsxs("p",{children:[Y.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Plan your route (optional)"}),"Tap the route button to add waypoints and create a route. If the system generated route(s) between your start and end points are not to your liking, add additional waypoints in locations you would prefer travelling through. Click the location button to re-centre and turn on follow-me or navigation mode for route tracking."]}),Y.jsxs("p",{children:[Y.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Find and log parking"}),"Click the main button once to see open spots reported by others live or within the last 5 minutes. Click again to mark your location. When leaving, click once more to end the session and report the fee. Use the profile button to see your parking history."]}),Y.jsxs("p",{children:[Y.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Create your own mirror (optional)"}),Y.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 dark:text-blue-400 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the bandwidth load while sharing with your friends."]}),Y.jsxs("p",{children:[Y.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. User privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys and only accessible by you. Open spot broadcasts are ephemeral and not linked to any personal identifiers."]}),Y.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20 mt-6",children:Y.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[Y.jsx("span",{className:"font-bold",children:"Tip: "}),"Use Parlens over your cellular internet connection to prevent personal IP address(es) from being associated with your data."]})})]})]})]})]})},OA=()=>{const{login:h}=Xp(),[m,b]=De.useState(""),[S,z]=De.useState(""),[k,A]=De.useState(!1),[l,N]=De.useState("landing"),[K,ne]=De.useState(""),[re,Ee]=De.useState(null),Ae=async Re=>{A(!0),z("");try{await h(Re,Re==="nsec"?m:void 0)}catch(We){z(We.message)}finally{A(!1)}},Pe=()=>{N("setup")},pe=async()=>{if(!K.trim()){z("Please enter a username");return}A(!0);try{const{generateSecretKey:Re,getPublicKey:We}=await ix(async()=>{const{generateSecretKey:Ie,getPublicKey:st}=await Promise.resolve().then(()=>TA);return{generateSecretKey:Ie,getPublicKey:st}},void 0),it=Ie=>Array.from(Ie).map(st=>st.toString(16).padStart(2,"0")).join(""),Dt=Re(),bt=We(Dt);localStorage.setItem("parlens_privkey",it(Dt)),localStorage.setItem("parlens_pubkey",bt),localStorage.setItem("parlens_pending_username",K);const rt=ff.npubEncode(bt),at=ff.nsecEncode(Dt);Ee({npub:rt,nsec:at}),N("backup")}catch(Re){z(Re.message)}finally{A(!1)}},ie=async()=>{A(!0);try{const Re=localStorage.getItem("parlens_pending_username");await h("create",void 0,Re||K),localStorage.removeItem("parlens_pending_username")}catch(Re){z(Re.message)}finally{A(!1)}};return Y.jsx("div",{className:"min-h-screen bg-black p-6 text-white text-center overflow-y-auto no-scrollbar flex flex-col items-center justify-center",style:{paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:Y.jsxs("div",{className:"w-full max-w-sm space-y-12 animate-in fade-in zoom-in-95 duration-700",children:[Y.jsxs("div",{className:"space-y-4",children:[Y.jsx("img",{src:"/parlens-pwa/pwa-512x512.png",alt:"Parlens",className:"mx-auto h-24 w-24 rounded-[22%] shadow-2xl shadow-[#007AFF]/20"}),Y.jsx("h1",{className:"text-5xl font-extrabold tracking-tighter",children:"Parlens"}),Y.jsx("p",{className:"text-sm font-medium text-white/40 tracking-tight",children:"Decentralized Route & Parking Management"})]}),Y.jsxs("div",{className:"space-y-4",children:[l==="landing"?Y.jsxs(Y.Fragment,{children:[Y.jsx("button",{onClick:Pe,disabled:k,className:"w-full h-16 rounded-3xl bg-white text-black font-bold text-lg shadow-xl active:scale-95 transition-all flex items-center justify-center gap-3",children:k?"Creating...":Y.jsxs(Y.Fragment,{children:[Y.jsx(IM,{size:20,strokeWidth:3}),"Create a New Account"]})}),Y.jsxs("button",{onClick:()=>N("nsec"),disabled:k,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold text-lg shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[Y.jsx(H_,{size:18}),"Login with Secret Key"]})]}):l==="setup"?Y.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-right-4",children:[Y.jsxs("div",{className:"text-center pb-2",children:[Y.jsx("h3",{className:"text-xl font-bold",children:"Pick a Username"}),Y.jsx("p",{className:"text-white/40 text-sm",children:"This will be your identity on Nostr"})]}),Y.jsx("input",{type:"text",placeholder:"Username",value:K,onChange:Re=>ne(Re.target.value),className:"w-full h-16 rounded-3xl bg-zinc-900 border border-white/10 px-6 text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-white/20",autoFocus:!0}),Y.jsxs("div",{className:"flex gap-3",children:[Y.jsx("button",{onClick:()=>N("landing"),className:"h-16 px-6 rounded-3xl bg-zinc-900 text-white font-bold",children:"Back"}),Y.jsx("button",{onClick:pe,disabled:k||!K,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:k?"Creating...":"Continue"})]})]}):l==="backup"?Y.jsxs("div",{className:"space-y-6 pt-4 animate-in slide-in-from-right-4 text-left",children:[Y.jsxs("div",{className:"text-center pb-2",children:[Y.jsx("h3",{className:"text-xl font-bold",children:" Account Created!"}),Y.jsx("p",{className:"text-white/40 text-sm mt-1",children:"Back up your keys before continuing"})]}),Y.jsxs("div",{className:"space-y-4",children:[Y.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-white/30 ml-2",children:"Your Keys"}),Y.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-white/[0.03] border border-white/10",children:[Y.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-white/10",onClick:()=>{re&&(navigator.clipboard.writeText(re.npub),alert("Public Key copied to clipboard"))},children:[Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/20 text-blue-400",children:Y.jsx(H_,{size:20})}),Y.jsx("span",{className:"font-semibold text-sm text-white",children:"Copy Public Key (Npub)"})]}),Y.jsx(Ay,{size:18,className:"text-white/20"})]}),Y.jsx("div",{className:"h-[1px] bg-white/5 mx-4"}),Y.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-white/10",onClick:()=>{re&&(navigator.clipboard.writeText(re.nsec),alert("Secret Key copied to clipboard - keep this safe!"))},children:[Y.jsxs("div",{className:"flex items-center gap-3",children:[Y.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/20 text-red-500",children:Y.jsx(Hb,{size:20})}),Y.jsx("span",{className:"font-semibold text-sm text-white",children:"Copy Secret Key (Nsec)"})]}),Y.jsx(Ay,{size:18,className:"text-white/20"})]})]}),Y.jsx("p",{className:"text-xs text-white/30 mt-2 ml-2 leading-relaxed text-center",children:" Store these keys securely. They cannot be recovered if lost."})]}),Y.jsx("button",{onClick:ie,disabled:k,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:k?"Starting...":"Start Using Parlens"})]}):Y.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-bottom-4",children:[Y.jsx("input",{type:"password",placeholder:"Paste your nsec...",value:m,onChange:Re=>b(Re.target.value),className:"w-full h-16 rounded-3xl bg-zinc-900 border border-white/10 px-6 text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-white/20",autoFocus:!0}),Y.jsxs("div",{className:"flex gap-3",children:[Y.jsx("button",{onClick:()=>N("landing"),className:"h-16 px-6 rounded-3xl bg-zinc-900 text-white font-bold",children:"Back"}),Y.jsx("button",{onClick:()=>Ae("nsec"),disabled:k||!m,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:k?"Decrypting...":"Login with Key"})]})]}),S&&Y.jsx("div",{className:"p-4 rounded-3xl bg-red-500/10 border border-red-500/20 text-red-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-2",children:S}),Y.jsxs("div",{className:"space-y-3 pt-6 border-t border-white/10",children:[Y.jsx("h3",{className:"text-center font-bold text-white/70 text-sm",children:"Add to your homescreen for fullscreen experience"}),Y.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[Y.jsxs("button",{onClick:()=>{document.getElementById("login-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[Y.jsx("span",{children:"Using Browser Menu (Android)"}),Y.jsx(gf,{size:16,className:"text-white/50"})]}),Y.jsxs("div",{id:"login-android-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2 text-left",children:[Y.jsx("p",{className:"font-semibold text-white/80",children:"Chrome & Brave:"}),Y.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[Y.jsx("li",{children:"Tap menu button (three dots)"}),Y.jsxs("li",{children:["Tap ",Y.jsx("strong",{children:"Add to Home screen"})]}),Y.jsxs("li",{children:["Tap ",Y.jsx("strong",{children:"Add"})," to confirm"]})]}),Y.jsx("p",{className:"font-semibold text-white/80 mt-3",children:"Firefox:"}),Y.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[Y.jsx("li",{children:"Tap menu button (three dots)"}),Y.jsxs("li",{children:["Tap ",Y.jsx("strong",{children:"Install"})]})]})]})]}),Y.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[Y.jsxs("button",{onClick:()=>{document.getElementById("login-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[Y.jsx("span",{children:"Using Share Button (iOS)"}),Y.jsx(gf,{size:16,className:"text-white/50"})]}),Y.jsx("div",{id:"login-ios-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2 text-left",children:Y.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[Y.jsxs("li",{children:["Tap the ",Y.jsx("strong",{className:"text-white/80",children:"Share"})," button in Safari menu bar."]}),Y.jsxs("li",{children:["Scroll down and tap ",Y.jsx("strong",{className:"text-white/80",children:"Add to Home Screen"}),"."]}),Y.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]})]})]})})},BA=()=>{const{pubkey:h}=Xp();return t0.useEffect(()=>{let m=0;const b=()=>{if(document.visibilityState==="hidden")m=Date.now(),console.log("[App] Backgrounded at",new Date().toISOString());else if(document.visibilityState==="visible"&&m>0){const z=Date.now()-m;console.log("[App] Foregrounded after",z,"ms"),z>5e3&&(console.log("[App] Dispatching visibility-refresh event"),window.dispatchEvent(new Event("visibility-refresh")))}},S=z=>{z.persisted&&(console.log("[App] Page restored from bfcache, triggering refresh"),window.dispatchEvent(new Event("visibility-refresh")))};return document.addEventListener("visibilitychange",b),window.addEventListener("pageshow",S),()=>{document.removeEventListener("visibilitychange",b),window.removeEventListener("pageshow",S)}},[]),h?Y.jsx(LA,{}):Y.jsx(OA,{})};var Xy=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(h){return this.listeners.add(h),this.onSubscribe(),()=>{this.listeners.delete(h),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},NA={setTimeout:(h,m)=>setTimeout(h,m),clearTimeout:h=>clearTimeout(h),setInterval:(h,m)=>setInterval(h,m),clearInterval:h=>clearInterval(h)},FA=class{#e=NA;#t=!1;setTimeoutProvider(h){this.#e=h}setTimeout(h,m){return this.#e.setTimeout(h,m)}clearTimeout(h){this.#e.clearTimeout(h)}setInterval(h,m){return this.#e.setInterval(h,m)}clearInterval(h){this.#e.clearInterval(h)}},K_=new FA;function jA(h){setTimeout(h,0)}var Yy=typeof window>"u"||"Deno"in globalThis;function Rl(){}function UA(h,m){return typeof h=="function"?h(m):h}function VA(h){return typeof h=="number"&&h>=0&&h!==1/0}function qA(h,m){return Math.max(h+(m||0)-Date.now(),0)}function W_(h,m){return typeof h=="function"?h(m):h}function GA(h,m){return typeof h=="function"?h(m):h}function Xv(h,m){const{type:b="all",exact:S,fetchStatus:z,predicate:k,queryKey:A,stale:l}=h;if(A){if(S){if(m.queryHash!==O0(A,m.options))return!1}else if(!dg(m.queryKey,A))return!1}if(b!=="all"){const N=m.isActive();if(b==="active"&&!N||b==="inactive"&&N)return!1}return!(typeof l=="boolean"&&m.isStale()!==l||z&&z!==m.state.fetchStatus||k&&!k(m))}function Yv(h,m){const{exact:b,status:S,predicate:z,mutationKey:k}=h;if(k){if(!m.options.mutationKey)return!1;if(b){if(hg(m.options.mutationKey)!==hg(k))return!1}else if(!dg(m.options.mutationKey,k))return!1}return!(S&&m.state.status!==S||z&&!z(m))}function O0(h,m){return(m?.queryKeyHashFn||hg)(h)}function hg(h){return JSON.stringify(h,(m,b)=>Q_(b)?Object.keys(b).sort().reduce((S,z)=>(S[z]=b[z],S),{}):b)}function dg(h,m){return h===m?!0:typeof h!=typeof m?!1:h&&m&&typeof h=="object"&&typeof m=="object"?Object.keys(m).every(b=>dg(h[b],m[b])):!1}var ZA=Object.prototype.hasOwnProperty;function o1(h,m){if(h===m)return h;const b=Kv(h)&&Kv(m);if(!b&&!(Q_(h)&&Q_(m)))return m;const z=(b?h:Object.keys(h)).length,k=b?m:Object.keys(m),A=k.length,l=b?new Array(A):{};let N=0;for(let K=0;K<A;K++){const ne=b?K:k[K],re=h[ne],Ee=m[ne];if(re===Ee){l[ne]=re,(b?K<z:ZA.call(h,ne))&&N++;continue}if(re===null||Ee===null||typeof re!="object"||typeof Ee!="object"){l[ne]=Ee;continue}const Ae=o1(re,Ee);l[ne]=Ae,Ae===re&&N++}return z===A&&N===z?h:l}function Kv(h){return Array.isArray(h)&&h.length===Object.keys(h).length}function Q_(h){if(!Wv(h))return!1;const m=h.constructor;if(m===void 0)return!0;const b=m.prototype;return!(!Wv(b)||!b.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(h)!==Object.prototype)}function Wv(h){return Object.prototype.toString.call(h)==="[object Object]"}function HA(h){return new Promise(m=>{K_.setTimeout(m,h)})}function $A(h,m,b){return typeof b.structuralSharing=="function"?b.structuralSharing(h,m):b.structuralSharing!==!1?o1(h,m):m}function XA(h,m,b=0){const S=[...h,m];return b&&S.length>b?S.slice(1):S}function YA(h,m,b=0){const S=[m,...h];return b&&S.length>b?S.slice(0,-1):S}var B0=Symbol();function l1(h,m){return!h.queryFn&&m?.initialPromise?()=>m.initialPromise:!h.queryFn||h.queryFn===B0?()=>Promise.reject(new Error(`Missing queryFn: '${h.queryHash}'`)):h.queryFn}var KA=class extends Xy{#e;#t;#n;constructor(){super(),this.#n=h=>{if(!Yy&&window.addEventListener){const m=()=>h();return window.addEventListener("visibilitychange",m,!1),()=>{window.removeEventListener("visibilitychange",m)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(h){this.#n=h,this.#t?.(),this.#t=h(m=>{typeof m=="boolean"?this.setFocused(m):this.onFocus()})}setFocused(h){this.#e!==h&&(this.#e=h,this.onFocus())}onFocus(){const h=this.isFocused();this.listeners.forEach(m=>{m(h)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},c1=new KA;function WA(){let h,m;const b=new Promise((z,k)=>{h=z,m=k});b.status="pending",b.catch(()=>{});function S(z){Object.assign(b,z),delete b.resolve,delete b.reject}return b.resolve=z=>{S({status:"fulfilled",value:z}),h(z)},b.reject=z=>{S({status:"rejected",reason:z}),m(z)},b}var QA=jA;function JA(){let h=[],m=0,b=l=>{l()},S=l=>{l()},z=QA;const k=l=>{m?h.push(l):z(()=>{b(l)})},A=()=>{const l=h;h=[],l.length&&z(()=>{S(()=>{l.forEach(N=>{b(N)})})})};return{batch:l=>{let N;m++;try{N=l()}finally{m--,m||A()}return N},batchCalls:l=>(...N)=>{k(()=>{l(...N)})},schedule:k,setNotifyFunction:l=>{b=l},setBatchNotifyFunction:l=>{S=l},setScheduler:l=>{z=l}}}var ls=JA(),eC=class extends Xy{#e=!0;#t;#n;constructor(){super(),this.#n=h=>{if(!Yy&&window.addEventListener){const m=()=>h(!0),b=()=>h(!1);return window.addEventListener("online",m,!1),window.addEventListener("offline",b,!1),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",b)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(h){this.#n=h,this.#t?.(),this.#t=h(this.setOnline.bind(this))}setOnline(h){this.#e!==h&&(this.#e=h,this.listeners.forEach(b=>{b(h)}))}isOnline(){return this.#e}},Py=new eC;function tC(h){return Math.min(1e3*2**h,3e4)}function u1(h){return(h??"online")==="online"?Py.isOnline():!0}var J_=class extends Error{constructor(h){super("CancelledError"),this.revert=h?.revert,this.silent=h?.silent}};function h1(h){let m=!1,b=0,S;const z=WA(),k=()=>z.status!=="pending",A=pe=>{if(!k()){const ie=new J_(pe);Ee(ie),h.onCancel?.(ie)}},l=()=>{m=!0},N=()=>{m=!1},K=()=>c1.isFocused()&&(h.networkMode==="always"||Py.isOnline())&&h.canRun(),ne=()=>u1(h.networkMode)&&h.canRun(),re=pe=>{k()||(S?.(),z.resolve(pe))},Ee=pe=>{k()||(S?.(),z.reject(pe))},Ae=()=>new Promise(pe=>{S=ie=>{(k()||K())&&pe(ie)},h.onPause?.()}).then(()=>{S=void 0,k()||h.onContinue?.()}),Pe=()=>{if(k())return;let pe;const ie=b===0?h.initialPromise:void 0;try{pe=ie??h.fn()}catch(Re){pe=Promise.reject(Re)}Promise.resolve(pe).then(re).catch(Re=>{if(k())return;const We=h.retry??(Yy?0:3),it=h.retryDelay??tC,Dt=typeof it=="function"?it(b,Re):it,bt=We===!0||typeof We=="number"&&b<We||typeof We=="function"&&We(b,Re);if(m||!bt){Ee(Re);return}b++,h.onFail?.(b,Re),HA(Dt).then(()=>K()?void 0:Ae()).then(()=>{m?Ee(Re):Pe()})})};return{promise:z,status:()=>z.status,cancel:A,continue:()=>(S?.(),z),cancelRetry:l,continueRetry:N,canStart:ne,start:()=>(ne()?Pe():Ae().then(Pe),z)}}var d1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),VA(this.gcTime)&&(this.#e=K_.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(h){this.gcTime=Math.max(this.gcTime||0,h??(Yy?1/0:300*1e3))}clearGcTimeout(){this.#e&&(K_.clearTimeout(this.#e),this.#e=void 0)}},nC=class extends d1{#e;#t;#n;#r;#i;#s;#o;constructor(h){super(),this.#o=!1,this.#s=h.defaultOptions,this.setOptions(h.options),this.observers=[],this.#r=h.client,this.#n=this.#r.getQueryCache(),this.queryKey=h.queryKey,this.queryHash=h.queryHash,this.#e=Jv(this.options),this.state=h.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(h){if(this.options={...this.#s,...h},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const m=Jv(this.options);m.data!==void 0&&(this.setState(Qv(m.data,m.dataUpdatedAt)),this.#e=m)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(h,m){const b=$A(this.state.data,h,this.options);return this.#a({data:b,type:"success",dataUpdatedAt:m?.updatedAt,manual:m?.manual}),b}setState(h,m){this.#a({type:"setState",state:h,setStateOptions:m})}cancel(h){const m=this.#i?.promise;return this.#i?.cancel(h),m?m.then(Rl).catch(Rl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(h=>GA(h.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===B0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(h=>W_(h.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(h=>h.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(h=0){return this.state.data===void 0?!0:h==="static"?!1:this.state.isInvalidated?!0:!qA(this.state.dataUpdatedAt,h)}onFocus(){this.observers.find(m=>m.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(m=>m.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(h){this.observers.includes(h)||(this.observers.push(h),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:h}))}removeObserver(h){this.observers.includes(h)&&(this.observers=this.observers.filter(m=>m!==h),this.observers.length||(this.#i&&(this.#o?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:h}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(h,m){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&m?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(h&&this.setOptions(h),!this.options.queryFn){const l=this.observers.find(N=>N.options.queryFn);l&&this.setOptions(l.options)}const b=new AbortController,S=l=>{Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(this.#o=!0,b.signal)})},z=()=>{const l=l1(this.options,m),K=(()=>{const ne={client:this.#r,queryKey:this.queryKey,meta:this.meta};return S(ne),ne})();return this.#o=!1,this.options.persister?this.options.persister(l,K,this):l(K)},A=(()=>{const l={fetchOptions:m,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:z};return S(l),l})();this.options.behavior?.onFetch(A,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==A.fetchOptions?.meta)&&this.#a({type:"fetch",meta:A.fetchOptions?.meta}),this.#i=h1({initialPromise:m?.initialPromise,fn:A.fetchFn,onCancel:l=>{l instanceof J_&&l.revert&&this.setState({...this.#t,fetchStatus:"idle"}),b.abort()},onFail:(l,N)=>{this.#a({type:"failed",failureCount:l,error:N})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:A.options.retry,retryDelay:A.options.retryDelay,networkMode:A.options.networkMode,canRun:()=>!0});try{const l=await this.#i.start();if(l===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(l),this.#n.config.onSuccess?.(l,this),this.#n.config.onSettled?.(l,this.state.error,this),l}catch(l){if(l instanceof J_){if(l.silent)return this.#i.promise;if(l.revert){if(this.state.data===void 0)throw l;return this.state.data}}throw this.#a({type:"error",error:l}),this.#n.config.onError?.(l,this),this.#n.config.onSettled?.(this.state.data,l,this),l}finally{this.scheduleGc()}}#a(h){const m=b=>{switch(h.type){case"failed":return{...b,fetchFailureCount:h.failureCount,fetchFailureReason:h.error};case"pause":return{...b,fetchStatus:"paused"};case"continue":return{...b,fetchStatus:"fetching"};case"fetch":return{...b,...iC(b.data,this.options),fetchMeta:h.meta??null};case"success":const S={...b,...Qv(h.data,h.dataUpdatedAt),dataUpdateCount:b.dataUpdateCount+1,...!h.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=h.manual?S:void 0,S;case"error":const z=h.error;return{...b,error:z,errorUpdateCount:b.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:b.fetchFailureCount+1,fetchFailureReason:z,fetchStatus:"idle",status:"error"};case"invalidate":return{...b,isInvalidated:!0};case"setState":return{...b,...h.state}}};this.state=m(this.state),ls.batch(()=>{this.observers.forEach(b=>{b.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:h})})}};function iC(h,m){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:u1(m.networkMode)?"fetching":"paused",...h===void 0&&{error:null,status:"pending"}}}function Qv(h,m){return{data:h,dataUpdatedAt:m??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Jv(h){const m=typeof h.initialData=="function"?h.initialData():h.initialData,b=m!==void 0,S=b?typeof h.initialDataUpdatedAt=="function"?h.initialDataUpdatedAt():h.initialDataUpdatedAt:0;return{data:m,dataUpdateCount:0,dataUpdatedAt:b?S??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:b?"success":"pending",fetchStatus:"idle"}}function ex(h){return{onFetch:(m,b)=>{const S=m.options,z=m.fetchOptions?.meta?.fetchMore?.direction,k=m.state.data?.pages||[],A=m.state.data?.pageParams||[];let l={pages:[],pageParams:[]},N=0;const K=async()=>{let ne=!1;const re=Pe=>{Object.defineProperty(Pe,"signal",{enumerable:!0,get:()=>(m.signal.aborted?ne=!0:m.signal.addEventListener("abort",()=>{ne=!0}),m.signal)})},Ee=l1(m.options,m.fetchOptions),Ae=async(Pe,pe,ie)=>{if(ne)return Promise.reject();if(pe==null&&Pe.pages.length)return Promise.resolve(Pe);const We=(()=>{const rt={client:m.client,queryKey:m.queryKey,pageParam:pe,direction:ie?"backward":"forward",meta:m.options.meta};return re(rt),rt})(),it=await Ee(We),{maxPages:Dt}=m.options,bt=ie?YA:XA;return{pages:bt(Pe.pages,it,Dt),pageParams:bt(Pe.pageParams,pe,Dt)}};if(z&&k.length){const Pe=z==="backward",pe=Pe?rC:tx,ie={pages:k,pageParams:A},Re=pe(S,ie);l=await Ae(ie,Re,Pe)}else{const Pe=h??k.length;do{const pe=N===0?A[0]??S.initialPageParam:tx(S,l);if(N>0&&pe==null)break;l=await Ae(l,pe),N++}while(N<Pe)}return l};m.options.persister?m.fetchFn=()=>m.options.persister?.(K,{client:m.client,queryKey:m.queryKey,meta:m.options.meta,signal:m.signal},b):m.fetchFn=K}}}function tx(h,{pages:m,pageParams:b}){const S=m.length-1;return m.length>0?h.getNextPageParam(m[S],m,b[S],b):void 0}function rC(h,{pages:m,pageParams:b}){return m.length>0?h.getPreviousPageParam?.(m[0],m,b[0],b):void 0}var aC=class extends d1{#e;#t;#n;#r;constructor(h){super(),this.#e=h.client,this.mutationId=h.mutationId,this.#n=h.mutationCache,this.#t=[],this.state=h.state||sC(),this.setOptions(h.options),this.scheduleGc()}setOptions(h){this.options=h,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(h){this.#t.includes(h)||(this.#t.push(h),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:h}))}removeObserver(h){this.#t=this.#t.filter(m=>m!==h),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:h})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(h){const m=()=>{this.#i({type:"continue"})},b={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=h1({fn:()=>this.options.mutationFn?this.options.mutationFn(h,b):Promise.reject(new Error("No mutationFn found")),onFail:(k,A)=>{this.#i({type:"failed",failureCount:k,error:A})},onPause:()=>{this.#i({type:"pause"})},onContinue:m,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const S=this.state.status==="pending",z=!this.#r.canStart();try{if(S)m();else{this.#i({type:"pending",variables:h,isPaused:z}),await this.#n.config.onMutate?.(h,this,b);const A=await this.options.onMutate?.(h,b);A!==this.state.context&&this.#i({type:"pending",context:A,variables:h,isPaused:z})}const k=await this.#r.start();return await this.#n.config.onSuccess?.(k,h,this.state.context,this,b),await this.options.onSuccess?.(k,h,this.state.context,b),await this.#n.config.onSettled?.(k,null,this.state.variables,this.state.context,this,b),await this.options.onSettled?.(k,null,h,this.state.context,b),this.#i({type:"success",data:k}),k}catch(k){try{throw await this.#n.config.onError?.(k,h,this.state.context,this,b),await this.options.onError?.(k,h,this.state.context,b),await this.#n.config.onSettled?.(void 0,k,this.state.variables,this.state.context,this,b),await this.options.onSettled?.(void 0,k,h,this.state.context,b),k}finally{this.#i({type:"error",error:k})}}finally{this.#n.runNext(this)}}#i(h){const m=b=>{switch(h.type){case"failed":return{...b,failureCount:h.failureCount,failureReason:h.error};case"pause":return{...b,isPaused:!0};case"continue":return{...b,isPaused:!1};case"pending":return{...b,context:h.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:h.isPaused,status:"pending",variables:h.variables,submittedAt:Date.now()};case"success":return{...b,data:h.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...b,data:void 0,error:h.error,failureCount:b.failureCount+1,failureReason:h.error,isPaused:!1,status:"error"}}};this.state=m(this.state),ls.batch(()=>{this.#t.forEach(b=>{b.onMutationUpdate(h)}),this.#n.notify({mutation:this,type:"updated",action:h})})}};function sC(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var oC=class extends Xy{constructor(h={}){super(),this.config=h,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(h,m,b){const S=new aC({client:h,mutationCache:this,mutationId:++this.#n,options:h.defaultMutationOptions(m),state:b});return this.add(S),S}add(h){this.#e.add(h);const m=gy(h);if(typeof m=="string"){const b=this.#t.get(m);b?b.push(h):this.#t.set(m,[h])}this.notify({type:"added",mutation:h})}remove(h){if(this.#e.delete(h)){const m=gy(h);if(typeof m=="string"){const b=this.#t.get(m);if(b)if(b.length>1){const S=b.indexOf(h);S!==-1&&b.splice(S,1)}else b[0]===h&&this.#t.delete(m)}}this.notify({type:"removed",mutation:h})}canRun(h){const m=gy(h);if(typeof m=="string"){const S=this.#t.get(m)?.find(z=>z.state.status==="pending");return!S||S===h}else return!0}runNext(h){const m=gy(h);return typeof m=="string"?this.#t.get(m)?.find(S=>S!==h&&S.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ls.batch(()=>{this.#e.forEach(h=>{this.notify({type:"removed",mutation:h})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(h){const m={exact:!0,...h};return this.getAll().find(b=>Yv(m,b))}findAll(h={}){return this.getAll().filter(m=>Yv(h,m))}notify(h){ls.batch(()=>{this.listeners.forEach(m=>{m(h)})})}resumePausedMutations(){const h=this.getAll().filter(m=>m.state.isPaused);return ls.batch(()=>Promise.all(h.map(m=>m.continue().catch(Rl))))}};function gy(h){return h.options.scope?.id}var lC=class extends Xy{constructor(h={}){super(),this.config=h,this.#e=new Map}#e;build(h,m,b){const S=m.queryKey,z=m.queryHash??O0(S,m);let k=this.get(z);return k||(k=new nC({client:h,queryKey:S,queryHash:z,options:h.defaultQueryOptions(m),state:b,defaultOptions:h.getQueryDefaults(S)}),this.add(k)),k}add(h){this.#e.has(h.queryHash)||(this.#e.set(h.queryHash,h),this.notify({type:"added",query:h}))}remove(h){const m=this.#e.get(h.queryHash);m&&(h.destroy(),m===h&&this.#e.delete(h.queryHash),this.notify({type:"removed",query:h}))}clear(){ls.batch(()=>{this.getAll().forEach(h=>{this.remove(h)})})}get(h){return this.#e.get(h)}getAll(){return[...this.#e.values()]}find(h){const m={exact:!0,...h};return this.getAll().find(b=>Xv(m,b))}findAll(h={}){const m=this.getAll();return Object.keys(h).length>0?m.filter(b=>Xv(h,b)):m}notify(h){ls.batch(()=>{this.listeners.forEach(m=>{m(h)})})}onFocus(){ls.batch(()=>{this.getAll().forEach(h=>{h.onFocus()})})}onOnline(){ls.batch(()=>{this.getAll().forEach(h=>{h.onOnline()})})}},cC=class{#e;#t;#n;#r;#i;#s;#o;#a;constructor(h={}){this.#e=h.queryCache||new lC,this.#t=h.mutationCache||new oC,this.#n=h.defaultOptions||{},this.#r=new Map,this.#i=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#o=c1.subscribe(async h=>{h&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=Py.subscribe(async h=>{h&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(h){return this.#e.findAll({...h,fetchStatus:"fetching"}).length}isMutating(h){return this.#t.findAll({...h,status:"pending"}).length}getQueryData(h){const m=this.defaultQueryOptions({queryKey:h});return this.#e.get(m.queryHash)?.state.data}ensureQueryData(h){const m=this.defaultQueryOptions(h),b=this.#e.build(this,m),S=b.state.data;return S===void 0?this.fetchQuery(h):(h.revalidateIfStale&&b.isStaleByTime(W_(m.staleTime,b))&&this.prefetchQuery(m),Promise.resolve(S))}getQueriesData(h){return this.#e.findAll(h).map(({queryKey:m,state:b})=>{const S=b.data;return[m,S]})}setQueryData(h,m,b){const S=this.defaultQueryOptions({queryKey:h}),k=this.#e.get(S.queryHash)?.state.data,A=UA(m,k);if(A!==void 0)return this.#e.build(this,S).setData(A,{...b,manual:!0})}setQueriesData(h,m,b){return ls.batch(()=>this.#e.findAll(h).map(({queryKey:S})=>[S,this.setQueryData(S,m,b)]))}getQueryState(h){const m=this.defaultQueryOptions({queryKey:h});return this.#e.get(m.queryHash)?.state}removeQueries(h){const m=this.#e;ls.batch(()=>{m.findAll(h).forEach(b=>{m.remove(b)})})}resetQueries(h,m){const b=this.#e;return ls.batch(()=>(b.findAll(h).forEach(S=>{S.reset()}),this.refetchQueries({type:"active",...h},m)))}cancelQueries(h,m={}){const b={revert:!0,...m},S=ls.batch(()=>this.#e.findAll(h).map(z=>z.cancel(b)));return Promise.all(S).then(Rl).catch(Rl)}invalidateQueries(h,m={}){return ls.batch(()=>(this.#e.findAll(h).forEach(b=>{b.invalidate()}),h?.refetchType==="none"?Promise.resolve():this.refetchQueries({...h,type:h?.refetchType??h?.type??"active"},m)))}refetchQueries(h,m={}){const b={...m,cancelRefetch:m.cancelRefetch??!0},S=ls.batch(()=>this.#e.findAll(h).filter(z=>!z.isDisabled()&&!z.isStatic()).map(z=>{let k=z.fetch(void 0,b);return b.throwOnError||(k=k.catch(Rl)),z.state.fetchStatus==="paused"?Promise.resolve():k}));return Promise.all(S).then(Rl)}fetchQuery(h){const m=this.defaultQueryOptions(h);m.retry===void 0&&(m.retry=!1);const b=this.#e.build(this,m);return b.isStaleByTime(W_(m.staleTime,b))?b.fetch(m):Promise.resolve(b.state.data)}prefetchQuery(h){return this.fetchQuery(h).then(Rl).catch(Rl)}fetchInfiniteQuery(h){return h.behavior=ex(h.pages),this.fetchQuery(h)}prefetchInfiniteQuery(h){return this.fetchInfiniteQuery(h).then(Rl).catch(Rl)}ensureInfiniteQueryData(h){return h.behavior=ex(h.pages),this.ensureQueryData(h)}resumePausedMutations(){return Py.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(h){this.#n=h}setQueryDefaults(h,m){this.#r.set(hg(h),{queryKey:h,defaultOptions:m})}getQueryDefaults(h){const m=[...this.#r.values()],b={};return m.forEach(S=>{dg(h,S.queryKey)&&Object.assign(b,S.defaultOptions)}),b}setMutationDefaults(h,m){this.#i.set(hg(h),{mutationKey:h,defaultOptions:m})}getMutationDefaults(h){const m=[...this.#i.values()],b={};return m.forEach(S=>{dg(h,S.mutationKey)&&Object.assign(b,S.defaultOptions)}),b}defaultQueryOptions(h){if(h._defaulted)return h;const m={...this.#n.queries,...this.getQueryDefaults(h.queryKey),...h,_defaulted:!0};return m.queryHash||(m.queryHash=O0(m.queryKey,m)),m.refetchOnReconnect===void 0&&(m.refetchOnReconnect=m.networkMode!=="always"),m.throwOnError===void 0&&(m.throwOnError=!!m.suspense),!m.networkMode&&m.persister&&(m.networkMode="offlineFirst"),m.queryFn===B0&&(m.enabled=!1),m}defaultMutationOptions(h){return h?._defaulted?h:{...this.#n.mutations,...h?.mutationKey&&this.getMutationDefaults(h.mutationKey),...h,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},uC=De.createContext(void 0),hC=({client:h,children:m})=>(De.useEffect(()=>(h.mount(),()=>{h.unmount()}),[h]),Y.jsx(uC.Provider,{value:h,children:m}));const dC=new cC;B1.createRoot(document.getElementById("root")).render(Y.jsx(t0.StrictMode,{children:Y.jsx(hC,{client:dC,children:Y.jsx(VE,{children:Y.jsx(BA,{})})})}));
