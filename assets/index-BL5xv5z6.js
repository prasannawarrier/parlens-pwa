function D1(h,m){for(var b=0;b<m.length;b++){const S=m[b];if(typeof S!="string"&&!Array.isArray(S)){for(const z in S)if(z!=="default"&&!(z in h)){const k=Object.getOwnPropertyDescriptor(S,z);k&&Object.defineProperty(h,z,k.get?k:{enumerable:!0,get:()=>S[z]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const z of document.querySelectorAll('link[rel="modulepreload"]'))S(z);new MutationObserver(z=>{for(const k of z)if(k.type==="childList")for(const A of k.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&S(A)}).observe(document,{childList:!0,subtree:!0});function b(z){const k={};return z.integrity&&(k.integrity=z.integrity),z.referrerPolicy&&(k.referrerPolicy=z.referrerPolicy),z.crossOrigin==="use-credentials"?k.credentials="include":z.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function S(z){if(z.ep)return;z.ep=!0;const k=b(z);fetch(z.href,k)}})();function Ly(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var g_={exports:{}},rg={};var J0;function I1(){if(J0)return rg;J0=1;var h=Symbol.for("react.transitional.element"),m=Symbol.for("react.fragment");function b(S,z,k){var A=null;if(k!==void 0&&(A=""+k),z.key!==void 0&&(A=""+z.key),"key"in z){k={};for(var l in z)l!=="key"&&(k[l]=z[l])}else k=z;return z=k.ref,{$$typeof:h,type:S,key:A,ref:z!==void 0?z:null,props:k}}return rg.Fragment=m,rg.jsx=b,rg.jsxs=b,rg}var ev;function k1(){return ev||(ev=1,g_.exports=I1()),g_.exports}var U=k1(),y_={exports:{}},gn={};var tv;function R1(){if(tv)return gn;tv=1;var h=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),A=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),W=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),re=Symbol.for("react.activity"),Me=Symbol.iterator;function be(xe){return xe===null||typeof xe!="object"?null:(xe=Me&&xe[Me]||xe["@@iterator"],typeof xe=="function"?xe:null)}var Ie={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},fe=Object.assign,ie={};function Le(xe,Ye,wt){this.props=xe,this.context=Ye,this.refs=ie,this.updater=wt||Ie}Le.prototype.isReactComponent={},Le.prototype.setState=function(xe,Ye){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,Ye,"setState")},Le.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function Ke(){}Ke.prototype=Le.prototype;function ht(xe,Ye,wt){this.props=xe,this.context=Ye,this.refs=ie,this.updater=wt||Ie}var Ct=ht.prototype=new Ke;Ct.constructor=ht,fe(Ct,Le.prototype),Ct.isPureReactComponent=!0;var zt=Array.isArray;function tt(){}var st={H:null,A:null,T:null,S:null},ke=Object.prototype.hasOwnProperty;function ct(xe,Ye,wt){var Mt=wt.ref;return{$$typeof:h,type:xe,key:Ye,ref:Mt!==void 0?Mt:null,props:wt}}function it(xe,Ye){return ct(xe.type,Ye,xe.props)}function lt(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===h}function Et(xe){var Ye={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(wt){return Ye[wt]})}var qt=/\/+/g;function $t(xe,Ye){return typeof xe=="object"&&xe!==null&&xe.key!=null?Et(""+xe.key):Ye.toString(36)}function ut(xe){switch(xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason;default:switch(typeof xe.status=="string"?xe.then(tt,tt):(xe.status="pending",xe.then(function(Ye){xe.status==="pending"&&(xe.status="fulfilled",xe.value=Ye)},function(Ye){xe.status==="pending"&&(xe.status="rejected",xe.reason=Ye)})),xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason}}throw xe}function we(xe,Ye,wt,Mt,Ft){var Zt=typeof xe;(Zt==="undefined"||Zt==="boolean")&&(xe=null);var Vt=!1;if(xe===null)Vt=!0;else switch(Zt){case"bigint":case"string":case"number":Vt=!0;break;case"object":switch(xe.$$typeof){case h:case m:Vt=!0;break;case ne:return Vt=xe._init,we(Vt(xe._payload),Ye,wt,Mt,Ft)}}if(Vt)return Ft=Ft(xe),Vt=Mt===""?"."+$t(xe,0):Mt,zt(Ft)?(wt="",Vt!=null&&(wt=Vt.replace(qt,"$&/")+"/"),we(Ft,Ye,wt,"",function(Dn){return Dn})):Ft!=null&&(lt(Ft)&&(Ft=it(Ft,wt+(Ft.key==null||xe&&xe.key===Ft.key?"":(""+Ft.key).replace(qt,"$&/")+"/")+Vt)),Ye.push(Ft)),1;Vt=0;var ln=Mt===""?".":Mt+":";if(zt(xe))for(var Qt=0;Qt<xe.length;Qt++)Mt=xe[Qt],Zt=ln+$t(Mt,Qt),Vt+=we(Mt,Ye,wt,Zt,Ft);else if(Qt=be(xe),typeof Qt=="function")for(xe=Qt.call(xe),Qt=0;!(Mt=xe.next()).done;)Mt=Mt.value,Zt=ln+$t(Mt,Qt++),Vt+=we(Mt,Ye,wt,Zt,Ft);else if(Zt==="object"){if(typeof xe.then=="function")return we(ut(xe),Ye,wt,Mt,Ft);throw Ye=String(xe),Error("Objects are not valid as a React child (found: "+(Ye==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":Ye)+"). If you meant to render a collection of children, use an array instead.")}return Vt}function $e(xe,Ye,wt){if(xe==null)return xe;var Mt=[],Ft=0;return we(xe,Mt,"","",function(Zt){return Ye.call(wt,Zt,Ft++)}),Mt}function mt(xe){if(xe._status===-1){var Ye=xe._result;Ye=Ye(),Ye.then(function(wt){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=wt)},function(wt){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=wt)}),xe._status===-1&&(xe._status=0,xe._result=Ye)}if(xe._status===1)return xe._result.default;throw xe._result}var vt=typeof reportError=="function"?reportError:function(xe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ye=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof xe=="object"&&xe!==null&&typeof xe.message=="string"?String(xe.message):String(xe),error:xe});if(!window.dispatchEvent(Ye))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",xe);return}console.error(xe)},Ut={map:$e,forEach:function(xe,Ye,wt){$e(xe,function(){Ye.apply(this,arguments)},wt)},count:function(xe){var Ye=0;return $e(xe,function(){Ye++}),Ye},toArray:function(xe){return $e(xe,function(Ye){return Ye})||[]},only:function(xe){if(!lt(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}};return gn.Activity=re,gn.Children=Ut,gn.Component=Le,gn.Fragment=b,gn.Profiler=z,gn.PureComponent=ht,gn.StrictMode=S,gn.Suspense=N,gn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=st,gn.__COMPILER_RUNTIME={__proto__:null,c:function(xe){return st.H.useMemoCache(xe)}},gn.cache=function(xe){return function(){return xe.apply(null,arguments)}},gn.cacheSignal=function(){return null},gn.cloneElement=function(xe,Ye,wt){if(xe==null)throw Error("The argument must be a React element, but you passed "+xe+".");var Mt=fe({},xe.props),Ft=xe.key;if(Ye!=null)for(Zt in Ye.key!==void 0&&(Ft=""+Ye.key),Ye)!ke.call(Ye,Zt)||Zt==="key"||Zt==="__self"||Zt==="__source"||Zt==="ref"&&Ye.ref===void 0||(Mt[Zt]=Ye[Zt]);var Zt=arguments.length-2;if(Zt===1)Mt.children=wt;else if(1<Zt){for(var Vt=Array(Zt),ln=0;ln<Zt;ln++)Vt[ln]=arguments[ln+2];Mt.children=Vt}return ct(xe.type,Ft,Mt)},gn.createContext=function(xe){return xe={$$typeof:A,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null},xe.Provider=xe,xe.Consumer={$$typeof:k,_context:xe},xe},gn.createElement=function(xe,Ye,wt){var Mt,Ft={},Zt=null;if(Ye!=null)for(Mt in Ye.key!==void 0&&(Zt=""+Ye.key),Ye)ke.call(Ye,Mt)&&Mt!=="key"&&Mt!=="__self"&&Mt!=="__source"&&(Ft[Mt]=Ye[Mt]);var Vt=arguments.length-2;if(Vt===1)Ft.children=wt;else if(1<Vt){for(var ln=Array(Vt),Qt=0;Qt<Vt;Qt++)ln[Qt]=arguments[Qt+2];Ft.children=ln}if(xe&&xe.defaultProps)for(Mt in Vt=xe.defaultProps,Vt)Ft[Mt]===void 0&&(Ft[Mt]=Vt[Mt]);return ct(xe,Zt,Ft)},gn.createRef=function(){return{current:null}},gn.forwardRef=function(xe){return{$$typeof:l,render:xe}},gn.isValidElement=lt,gn.lazy=function(xe){return{$$typeof:ne,_payload:{_status:-1,_result:xe},_init:mt}},gn.memo=function(xe,Ye){return{$$typeof:W,type:xe,compare:Ye===void 0?null:Ye}},gn.startTransition=function(xe){var Ye=st.T,wt={};st.T=wt;try{var Mt=xe(),Ft=st.S;Ft!==null&&Ft(wt,Mt),typeof Mt=="object"&&Mt!==null&&typeof Mt.then=="function"&&Mt.then(tt,vt)}catch(Zt){vt(Zt)}finally{Ye!==null&&wt.types!==null&&(Ye.types=wt.types),st.T=Ye}},gn.unstable_useCacheRefresh=function(){return st.H.useCacheRefresh()},gn.use=function(xe){return st.H.use(xe)},gn.useActionState=function(xe,Ye,wt){return st.H.useActionState(xe,Ye,wt)},gn.useCallback=function(xe,Ye){return st.H.useCallback(xe,Ye)},gn.useContext=function(xe){return st.H.useContext(xe)},gn.useDebugValue=function(){},gn.useDeferredValue=function(xe,Ye){return st.H.useDeferredValue(xe,Ye)},gn.useEffect=function(xe,Ye){return st.H.useEffect(xe,Ye)},gn.useEffectEvent=function(xe){return st.H.useEffectEvent(xe)},gn.useId=function(){return st.H.useId()},gn.useImperativeHandle=function(xe,Ye,wt){return st.H.useImperativeHandle(xe,Ye,wt)},gn.useInsertionEffect=function(xe,Ye){return st.H.useInsertionEffect(xe,Ye)},gn.useLayoutEffect=function(xe,Ye){return st.H.useLayoutEffect(xe,Ye)},gn.useMemo=function(xe,Ye){return st.H.useMemo(xe,Ye)},gn.useOptimistic=function(xe,Ye){return st.H.useOptimistic(xe,Ye)},gn.useReducer=function(xe,Ye,wt){return st.H.useReducer(xe,Ye,wt)},gn.useRef=function(xe){return st.H.useRef(xe)},gn.useState=function(xe){return st.H.useState(xe)},gn.useSyncExternalStore=function(xe,Ye,wt){return st.H.useSyncExternalStore(xe,Ye,wt)},gn.useTransition=function(){return st.H.useTransition()},gn.version="19.2.3",gn}var nv;function r0(){return nv||(nv=1,y_.exports=R1()),y_.exports}var Ae=r0();const a0=Ly(Ae);var __={exports:{}},ag={},v_={exports:{}},x_={};var iv;function L1(){return iv||(iv=1,(function(h){function m(we,$e){var mt=we.length;we.push($e);e:for(;0<mt;){var vt=mt-1>>>1,Ut=we[vt];if(0<z(Ut,$e))we[vt]=$e,we[mt]=Ut,mt=vt;else break e}}function b(we){return we.length===0?null:we[0]}function S(we){if(we.length===0)return null;var $e=we[0],mt=we.pop();if(mt!==$e){we[0]=mt;e:for(var vt=0,Ut=we.length,xe=Ut>>>1;vt<xe;){var Ye=2*(vt+1)-1,wt=we[Ye],Mt=Ye+1,Ft=we[Mt];if(0>z(wt,mt))Mt<Ut&&0>z(Ft,wt)?(we[vt]=Ft,we[Mt]=mt,vt=Mt):(we[vt]=wt,we[Ye]=mt,vt=Ye);else if(Mt<Ut&&0>z(Ft,mt))we[vt]=Ft,we[Mt]=mt,vt=Mt;else break e}}return $e}function z(we,$e){var mt=we.sortIndex-$e.sortIndex;return mt!==0?mt:we.id-$e.id}if(h.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var k=performance;h.unstable_now=function(){return k.now()}}else{var A=Date,l=A.now();h.unstable_now=function(){return A.now()-l}}var N=[],W=[],ne=1,re=null,Me=3,be=!1,Ie=!1,fe=!1,ie=!1,Le=typeof setTimeout=="function"?setTimeout:null,Ke=typeof clearTimeout=="function"?clearTimeout:null,ht=typeof setImmediate<"u"?setImmediate:null;function Ct(we){for(var $e=b(W);$e!==null;){if($e.callback===null)S(W);else if($e.startTime<=we)S(W),$e.sortIndex=$e.expirationTime,m(N,$e);else break;$e=b(W)}}function zt(we){if(fe=!1,Ct(we),!Ie)if(b(N)!==null)Ie=!0,tt||(tt=!0,Et());else{var $e=b(W);$e!==null&&ut(zt,$e.startTime-we)}}var tt=!1,st=-1,ke=5,ct=-1;function it(){return ie?!0:!(h.unstable_now()-ct<ke)}function lt(){if(ie=!1,tt){var we=h.unstable_now();ct=we;var $e=!0;try{e:{Ie=!1,fe&&(fe=!1,Ke(st),st=-1),be=!0;var mt=Me;try{t:{for(Ct(we),re=b(N);re!==null&&!(re.expirationTime>we&&it());){var vt=re.callback;if(typeof vt=="function"){re.callback=null,Me=re.priorityLevel;var Ut=vt(re.expirationTime<=we);if(we=h.unstable_now(),typeof Ut=="function"){re.callback=Ut,Ct(we),$e=!0;break t}re===b(N)&&S(N),Ct(we)}else S(N);re=b(N)}if(re!==null)$e=!0;else{var xe=b(W);xe!==null&&ut(zt,xe.startTime-we),$e=!1}}break e}finally{re=null,Me=mt,be=!1}$e=void 0}}finally{$e?Et():tt=!1}}}var Et;if(typeof ht=="function")Et=function(){ht(lt)};else if(typeof MessageChannel<"u"){var qt=new MessageChannel,$t=qt.port2;qt.port1.onmessage=lt,Et=function(){$t.postMessage(null)}}else Et=function(){Le(lt,0)};function ut(we,$e){st=Le(function(){we(h.unstable_now())},$e)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(we){we.callback=null},h.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ke=0<we?Math.floor(1e3/we):5},h.unstable_getCurrentPriorityLevel=function(){return Me},h.unstable_next=function(we){switch(Me){case 1:case 2:case 3:var $e=3;break;default:$e=Me}var mt=Me;Me=$e;try{return we()}finally{Me=mt}},h.unstable_requestPaint=function(){ie=!0},h.unstable_runWithPriority=function(we,$e){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var mt=Me;Me=we;try{return $e()}finally{Me=mt}},h.unstable_scheduleCallback=function(we,$e,mt){var vt=h.unstable_now();switch(typeof mt=="object"&&mt!==null?(mt=mt.delay,mt=typeof mt=="number"&&0<mt?vt+mt:vt):mt=vt,we){case 1:var Ut=-1;break;case 2:Ut=250;break;case 5:Ut=1073741823;break;case 4:Ut=1e4;break;default:Ut=5e3}return Ut=mt+Ut,we={id:ne++,callback:$e,priorityLevel:we,startTime:mt,expirationTime:Ut,sortIndex:-1},mt>vt?(we.sortIndex=mt,m(W,we),b(N)===null&&we===b(W)&&(fe?(Ke(st),st=-1):fe=!0,ut(zt,mt-vt))):(we.sortIndex=Ut,m(N,we),Ie||be||(Ie=!0,tt||(tt=!0,Et()))),we},h.unstable_shouldYield=it,h.unstable_wrapCallback=function(we){var $e=Me;return function(){var mt=Me;Me=$e;try{return we.apply(this,arguments)}finally{Me=mt}}}})(x_)),x_}var rv;function O1(){return rv||(rv=1,v_.exports=L1()),v_.exports}var b_={exports:{}},Za={};var av;function B1(){if(av)return Za;av=1;var h=r0();function m(N){var W="https://react.dev/errors/"+N;if(1<arguments.length){W+="?args[]="+encodeURIComponent(arguments[1]);for(var ne=2;ne<arguments.length;ne++)W+="&args[]="+encodeURIComponent(arguments[ne])}return"Minified React error #"+N+"; visit "+W+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function b(){}var S={d:{f:b,r:function(){throw Error(m(522))},D:b,C:b,L:b,m:b,X:b,S:b,M:b},p:0,findDOMNode:null},z=Symbol.for("react.portal");function k(N,W,ne){var re=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:z,key:re==null?null:""+re,children:N,containerInfo:W,implementation:ne}}var A=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(N,W){if(N==="font")return"";if(typeof W=="string")return W==="use-credentials"?W:""}return Za.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,Za.createPortal=function(N,W){var ne=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!W||W.nodeType!==1&&W.nodeType!==9&&W.nodeType!==11)throw Error(m(299));return k(N,W,null,ne)},Za.flushSync=function(N){var W=A.T,ne=S.p;try{if(A.T=null,S.p=2,N)return N()}finally{A.T=W,S.p=ne,S.d.f()}},Za.preconnect=function(N,W){typeof N=="string"&&(W?(W=W.crossOrigin,W=typeof W=="string"?W==="use-credentials"?W:"":void 0):W=null,S.d.C(N,W))},Za.prefetchDNS=function(N){typeof N=="string"&&S.d.D(N)},Za.preinit=function(N,W){if(typeof N=="string"&&W&&typeof W.as=="string"){var ne=W.as,re=l(ne,W.crossOrigin),Me=typeof W.integrity=="string"?W.integrity:void 0,be=typeof W.fetchPriority=="string"?W.fetchPriority:void 0;ne==="style"?S.d.S(N,typeof W.precedence=="string"?W.precedence:void 0,{crossOrigin:re,integrity:Me,fetchPriority:be}):ne==="script"&&S.d.X(N,{crossOrigin:re,integrity:Me,fetchPriority:be,nonce:typeof W.nonce=="string"?W.nonce:void 0})}},Za.preinitModule=function(N,W){if(typeof N=="string")if(typeof W=="object"&&W!==null){if(W.as==null||W.as==="script"){var ne=l(W.as,W.crossOrigin);S.d.M(N,{crossOrigin:ne,integrity:typeof W.integrity=="string"?W.integrity:void 0,nonce:typeof W.nonce=="string"?W.nonce:void 0})}}else W==null&&S.d.M(N)},Za.preload=function(N,W){if(typeof N=="string"&&typeof W=="object"&&W!==null&&typeof W.as=="string"){var ne=W.as,re=l(ne,W.crossOrigin);S.d.L(N,ne,{crossOrigin:re,integrity:typeof W.integrity=="string"?W.integrity:void 0,nonce:typeof W.nonce=="string"?W.nonce:void 0,type:typeof W.type=="string"?W.type:void 0,fetchPriority:typeof W.fetchPriority=="string"?W.fetchPriority:void 0,referrerPolicy:typeof W.referrerPolicy=="string"?W.referrerPolicy:void 0,imageSrcSet:typeof W.imageSrcSet=="string"?W.imageSrcSet:void 0,imageSizes:typeof W.imageSizes=="string"?W.imageSizes:void 0,media:typeof W.media=="string"?W.media:void 0})}},Za.preloadModule=function(N,W){if(typeof N=="string")if(W){var ne=l(W.as,W.crossOrigin);S.d.m(N,{as:typeof W.as=="string"&&W.as!=="script"?W.as:void 0,crossOrigin:ne,integrity:typeof W.integrity=="string"?W.integrity:void 0})}else S.d.m(N)},Za.requestFormReset=function(N){S.d.r(N)},Za.unstable_batchedUpdates=function(N,W){return N(W)},Za.useFormState=function(N,W,ne){return A.H.useFormState(N,W,ne)},Za.useFormStatus=function(){return A.H.useHostTransitionStatus()},Za.version="19.2.3",Za}var sv;function sx(){if(sv)return b_.exports;sv=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(m){console.error(m)}}return h(),b_.exports=B1(),b_.exports}var ov;function N1(){if(ov)return ag;ov=1;var h=O1(),m=r0(),b=sx();function S(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function z(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function k(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function A(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function l(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function N(r){if(k(r)!==r)throw Error(S(188))}function W(r){var s=r.alternate;if(!s){if(s=k(r),s===null)throw Error(S(188));return s!==r?null:r}for(var d=r,_=s;;){var M=d.return;if(M===null)break;var D=M.alternate;if(D===null){if(_=M.return,_!==null){d=_;continue}break}if(M.child===D.child){for(D=M.child;D;){if(D===d)return N(M),r;if(D===_)return N(M),s;D=D.sibling}throw Error(S(188))}if(d.return!==_.return)d=M,_=D;else{for(var q=!1,te=M.child;te;){if(te===d){q=!0,d=M,_=D;break}if(te===_){q=!0,_=M,d=D;break}te=te.sibling}if(!q){for(te=D.child;te;){if(te===d){q=!0,d=D,_=M;break}if(te===_){q=!0,_=D,d=M;break}te=te.sibling}if(!q)throw Error(S(189))}}if(d.alternate!==_)throw Error(S(190))}if(d.tag!==3)throw Error(S(188));return d.stateNode.current===d?r:s}function ne(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=ne(r),s!==null)return s;r=r.sibling}return null}var re=Object.assign,Me=Symbol.for("react.element"),be=Symbol.for("react.transitional.element"),Ie=Symbol.for("react.portal"),fe=Symbol.for("react.fragment"),ie=Symbol.for("react.strict_mode"),Le=Symbol.for("react.profiler"),Ke=Symbol.for("react.consumer"),ht=Symbol.for("react.context"),Ct=Symbol.for("react.forward_ref"),zt=Symbol.for("react.suspense"),tt=Symbol.for("react.suspense_list"),st=Symbol.for("react.memo"),ke=Symbol.for("react.lazy"),ct=Symbol.for("react.activity"),it=Symbol.for("react.memo_cache_sentinel"),lt=Symbol.iterator;function Et(r){return r===null||typeof r!="object"?null:(r=lt&&r[lt]||r["@@iterator"],typeof r=="function"?r:null)}var qt=Symbol.for("react.client.reference");function $t(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===qt?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case fe:return"Fragment";case Le:return"Profiler";case ie:return"StrictMode";case zt:return"Suspense";case tt:return"SuspenseList";case ct:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Ie:return"Portal";case ht:return r.displayName||"Context";case Ke:return(r._context.displayName||"Context")+".Consumer";case Ct:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case st:return s=r.displayName||null,s!==null?s:$t(r.type)||"Memo";case ke:s=r._payload,r=r._init;try{return $t(r(s))}catch{}}return null}var ut=Array.isArray,we=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$e=b.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,mt={pending:!1,data:null,method:null,action:null},vt=[],Ut=-1;function xe(r){return{current:r}}function Ye(r){0>Ut||(r.current=vt[Ut],vt[Ut]=null,Ut--)}function wt(r,s){Ut++,vt[Ut]=r.current,r.current=s}var Mt=xe(null),Ft=xe(null),Zt=xe(null),Vt=xe(null);function ln(r,s){switch(wt(Zt,s),wt(Ft,r),wt(Mt,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?yc(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=yc(s),r=Rm(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Ye(Mt),wt(Mt,r)}function Qt(){Ye(Mt),Ye(Ft),Ye(Zt)}function Dn(r){r.memoizedState!==null&&wt(Vt,r);var s=Mt.current,d=Rm(s,r.type);s!==d&&(wt(Ft,r),wt(Mt,d))}function ai(r){Ft.current===r&&(Ye(Mt),Ye(Ft)),Vt.current===r&&(Ye(Vt),Bh._currentValue=mt)}var Rn,lr;function Mn(r){if(Rn===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);Rn=s&&s[1]||"",lr=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Rn+r+lr}var ci=!1;function Ri(r,s){if(!r||ci)return"";ci=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(s){var xt=function(){throw Error()};if(Object.defineProperty(xt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xt,[])}catch(nt){var We=nt}Reflect.construct(r,[],xt)}else{try{xt.call()}catch(nt){We=nt}r.call(xt.prototype)}}else{try{throw Error()}catch(nt){We=nt}(xt=r())&&typeof xt.catch=="function"&&xt.catch(function(){})}}catch(nt){if(nt&&We&&typeof nt.stack=="string")return[nt.stack,We.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var M=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");M&&M.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var D=_.DetermineComponentFrameRoot(),q=D[0],te=D[1];if(q&&te){var Ee=q.split(`
`),Xe=te.split(`
`);for(M=_=0;_<Ee.length&&!Ee[_].includes("DetermineComponentFrameRoot");)_++;for(;M<Xe.length&&!Xe[M].includes("DetermineComponentFrameRoot");)M++;if(_===Ee.length||M===Xe.length)for(_=Ee.length-1,M=Xe.length-1;1<=_&&0<=M&&Ee[_]!==Xe[M];)M--;for(;1<=_&&0<=M;_--,M--)if(Ee[_]!==Xe[M]){if(_!==1||M!==1)do if(_--,M--,0>M||Ee[_]!==Xe[M]){var dt=`
`+Ee[_].replace(" at new "," at ");return r.displayName&&dt.includes("<anonymous>")&&(dt=dt.replace("<anonymous>",r.displayName)),dt}while(1<=_&&0<=M);break}}}finally{ci=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?Mn(d):""}function Jn(r,s){switch(r.tag){case 26:case 27:case 5:return Mn(r.type);case 16:return Mn("Lazy");case 13:return r.child!==s&&s!==null?Mn("Suspense Fallback"):Mn("Suspense");case 19:return Mn("SuspenseList");case 0:case 15:return Ri(r.type,!1);case 11:return Ri(r.type.render,!1);case 1:return Ri(r.type,!0);case 31:return Mn("Activity");default:return""}}function Wi(r){try{var s="",d=null;do s+=Jn(r,d),d=r,r=r.return;while(r);return s}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}var cr=Object.prototype.hasOwnProperty,ur=h.unstable_scheduleCallback,Hr=h.unstable_cancelCallback,Ki=h.unstable_shouldYield,$r=h.unstable_requestPaint,Li=h.unstable_now,nr=h.unstable_getCurrentPriorityLevel,Be=h.unstable_ImmediatePriority,Z=h.unstable_UserBlockingPriority,$=h.unstable_NormalPriority,K=h.unstable_LowPriority,ue=h.unstable_IdlePriority,ge=h.log,Re=h.unstable_setDisableYieldValue,ze=null,Se=null;function De(r){if(typeof ge=="function"&&Re(r),Se&&typeof Se.setStrictMode=="function")try{Se.setStrictMode(ze,r)}catch{}}var Je=Math.clz32?Math.clz32:It,at=Math.log,Rt=Math.LN2;function It(r){return r>>>=0,r===0?32:31-(at(r)/Rt|0)|0}var Ht=256,yn=262144,un=4194304;function Oe(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function In(r,s,d){var _=r.pendingLanes;if(_===0)return 0;var M=0,D=r.suspendedLanes,q=r.pingedLanes;r=r.warmLanes;var te=_&134217727;return te!==0?(_=te&~D,_!==0?M=Oe(_):(q&=te,q!==0?M=Oe(q):d||(d=te&~r,d!==0&&(M=Oe(d))))):(te=_&~D,te!==0?M=Oe(te):q!==0?M=Oe(q):d||(d=_&~r,d!==0&&(M=Oe(d)))),M===0?0:s!==0&&s!==M&&(s&D)===0&&(D=M&-M,d=s&-s,D>=d||D===32&&(d&4194048)!==0)?s:M}function ui(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function nn(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kn(){var r=un;return un<<=1,(un&62914560)===0&&(un=4194304),r}function Ui(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function Ln(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function hi(r,s,d,_,M,D){var q=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var te=r.entanglements,Ee=r.expirationTimes,Xe=r.hiddenUpdates;for(d=q&~d;0<d;){var dt=31-Je(d),xt=1<<dt;te[dt]=0,Ee[dt]=-1;var We=Xe[dt];if(We!==null)for(Xe[dt]=null,dt=0;dt<We.length;dt++){var nt=We[dt];nt!==null&&(nt.lane&=-536870913)}d&=~xt}_!==0&&On(r,_,0),D!==0&&M===0&&r.tag!==0&&(r.suspendedLanes|=D&~(q&~s))}function On(r,s,d){r.pendingLanes|=s,r.suspendedLanes&=~s;var _=31-Je(s);r.entangledLanes|=s,r.entanglements[_]=r.entanglements[_]|1073741824|d&261930}function Ti(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var _=31-Je(d),M=1<<_;M&s|r[_]&s&&(r[_]|=s),d&=~M}}function Us(r,s){var d=s&-s;return d=(d&42)!==0?1:Vs(d),(d&(r.suspendedLanes|s))!==0?0:d}function Vs(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function bt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function hr(){var r=$e.p;return r!==0?r:(r=window.event,r===void 0?32:zu(r.type))}function dr(r,s){var d=$e.p;try{return $e.p=r,s()}finally{$e.p=d}}var Qe=Math.random().toString(36).slice(2),_t="__reactFiber$"+Qe,Fe="__reactProps$"+Qe,Tt="__reactContainer$"+Qe,kt="__reactEvents$"+Qe,ni="__reactListeners$"+Qe,Vi="__reactHandles$"+Qe,Xr="__reactResources$"+Qe,en="__reactMarker$"+Qe;function $o(r){delete r[_t],delete r[Fe],delete r[kt],delete r[ni],delete r[Vi]}function ds(r){var s=r[_t];if(s)return s;for(var d=r.parentNode;d;){if(s=d[Tt]||d[_t]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=Vd(r);r!==null;){if(d=r[_t])return d;r=Vd(r)}return s}r=d,d=r.parentNode}return null}function qs(r){if(r=r[_t]||r[Tt]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function fs(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(S(33))}function ps(r){var s=r[Xr];return s||(s=r[Xr]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Si(r){r[en]=!0}var Fl=new Set,Pr={};function xn(r,s){Gs(r,s),Gs(r+"Capture",s)}function Gs(r,s){for(Pr[r]=s,r=0;r<s.length;r++)Fl.add(s[r])}var jl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ul={},po={};function Xa(r){return cr.call(po,r)?!0:cr.call(Ul,r)?!1:jl.test(r)?po[r]=!0:(Ul[r]=!0,!1)}function Rc(r,s,d){if(Xa(s))if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var _=s.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+d)}}function ms(r,s,d){if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+d)}}function Ma(r,s,d,_){if(_===null)r.removeAttribute(d);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(s,d,""+_)}}function An(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Wh(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function _f(r,s,d){var _=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var M=_.get,D=_.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return M.call(this)},set:function(q){d=""+q,D.call(this,q)}}),Object.defineProperty(r,s,{enumerable:_.enumerable}),{getValue:function(){return d},setValue:function(q){d=""+q},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function Xo(r){if(!r._valueTracker){var s=Wh(r)?"checked":"value";r._valueTracker=_f(r,s,""+r[s])}}function Kh(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),_="";return r&&(_=Wh(r)?r.checked?"true":"false":r.value),r=_,r!==d?(s.setValue(r),!0):!1}function Lc(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var vf=/[\n"\\]/g;function Nr(r){return r.replace(vf,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Oc(r,s,d,_,M,D,q,te){r.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?r.type=q:r.removeAttribute("type"),s!=null?q==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+An(s)):r.value!==""+An(s)&&(r.value=""+An(s)):q!=="submit"&&q!=="reset"||r.removeAttribute("value"),s!=null?Bc(r,q,An(s)):d!=null?Bc(r,q,An(d)):_!=null&&r.removeAttribute("value"),M==null&&D!=null&&(r.defaultChecked=!!D),M!=null&&(r.checked=M&&typeof M!="function"&&typeof M!="symbol"),te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"?r.name=""+An(te):r.removeAttribute("name")}function qu(r,s,d,_,M,D,q,te){if(D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(r.type=D),s!=null||d!=null){if(!(D!=="submit"&&D!=="reset"||s!=null)){Xo(r);return}d=d!=null?""+An(d):"",s=s!=null?""+An(s):d,te||s===r.value||(r.value=s),r.defaultValue=s}_=_??M,_=typeof _!="function"&&typeof _!="symbol"&&!!_,r.checked=te?r.checked:!!_,r.defaultChecked=!!_,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(r.name=q),Xo(r)}function Bc(r,s,d){s==="number"&&Lc(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function mo(r,s,d,_){if(r=r.options,s){s={};for(var M=0;M<d.length;M++)s["$"+d[M]]=!0;for(d=0;d<r.length;d++)M=s.hasOwnProperty("$"+r[d].value),r[d].selected!==M&&(r[d].selected=M),M&&_&&(r[d].defaultSelected=!0)}else{for(d=""+An(d),s=null,M=0;M<r.length;M++){if(r[M].value===d){r[M].selected=!0,_&&(r[M].defaultSelected=!0);return}s!==null||r[M].disabled||(s=r[M])}s!==null&&(s.selected=!0)}}function xf(r,s,d){if(s!=null&&(s=""+An(s),s!==r.value&&(r.value=s),d==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=d!=null?""+An(d):""}function Vl(r,s,d,_){if(s==null){if(_!=null){if(d!=null)throw Error(S(92));if(ut(_)){if(1<_.length)throw Error(S(93));_=_[0]}d=_}d==null&&(d=""),s=d}d=An(s),r.defaultValue=d,_=r.textContent,_===d&&_!==""&&_!==null&&(r.value=_),Xo(r)}function Zs(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var bf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Yo(r,s,d){var _=s.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?_?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":_?r.setProperty(s,d):typeof d!="number"||d===0||bf.has(s)?s==="float"?r.cssFloat=d:r[s]=(""+d).trim():r[s]=d+"px"}function Gu(r,s,d){if(s!=null&&typeof s!="object")throw Error(S(62));if(r=r.style,d!=null){for(var _ in d)!d.hasOwnProperty(_)||s!=null&&s.hasOwnProperty(_)||(_.indexOf("--")===0?r.setProperty(_,""):_==="float"?r.cssFloat="":r[_]="");for(var M in s)_=s[M],s.hasOwnProperty(M)&&d[M]!==_&&Yo(r,M,_)}else for(var D in s)s.hasOwnProperty(D)&&Yo(r,D,s[D])}function Wo(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var go=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ql=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function hn(r){return ql.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Ya(){}var Qh=null;function Nc(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ir=null,qi=null;function di(r){var s=qs(r);if(s&&(r=s.stateNode)){var d=r[Fe]||null;e:switch(r=s.stateNode,s.type){case"input":if(Oc(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Nr(""+s)+'"][type="radio"]'),s=0;s<d.length;s++){var _=d[s];if(_!==r&&_.form===r.form){var M=_[Fe]||null;if(!M)throw Error(S(90));Oc(_,M.value,M.defaultValue,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name)}}for(s=0;s<d.length;s++)_=d[s],_.form===r.form&&Kh(_)}break e;case"textarea":xf(r,d.value,d.defaultValue);break e;case"select":s=d.value,s!=null&&mo(r,!!d.multiple,s,!1)}}}var tn=!1;function $n(r,s,d){if(tn)return r(s,d);tn=!0;try{var _=r(s);return _}finally{if(tn=!1,(ir!==null||qi!==null)&&(Rd(),ir&&(s=ir,r=qi,qi=ir=null,di(s),r)))for(s=0;s<r.length;s++)di(r[s])}}function Aa(r,s){var d=r.stateNode;if(d===null)return null;var _=d[Fe]||null;if(_===null)return null;d=_[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(r=r.type,_=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!_;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(S(231,s,typeof d));return d}var Ei=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fr=!1;if(Ei)try{var rr={};Object.defineProperty(rr,"passive",{get:function(){Fr=!0}}),window.addEventListener("test",rr,rr),window.removeEventListener("test",rr,rr)}catch{Fr=!1}var ca=null,gs=null,fi=null;function yo(){if(fi)return fi;var r,s=gs,d=s.length,_,M="value"in ca?ca.value:ca.textContent,D=M.length;for(r=0;r<d&&s[r]===M[r];r++);var q=d-r;for(_=1;_<=q&&s[d-_]===M[D-_];_++);return fi=M.slice(r,1<_?1-_:void 0)}function ua(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Ko(){return!0}function jr(){return!1}function Qi(r){function s(d,_,M,D,q){this._reactName=d,this._targetInst=M,this.type=_,this.nativeEvent=D,this.target=q,this.currentTarget=null;for(var te in r)r.hasOwnProperty(te)&&(d=r[te],this[te]=d?d(D):D[te]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?Ko:jr,this.isPropagationStopped=jr,this}return re(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Ko)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Ko)},persist:function(){},isPersistent:Ko}),s}var Ur={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fc=Qi(Ur),Qo=re({},Ur,{view:0,detail:0}),Jo=Qi(Qo),Vn,_o,pn,on=re({},Qo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vc,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==pn&&(pn&&r.type==="mousemove"?(Vn=r.screenX-pn.screenX,_o=r.screenY-pn.screenY):_o=Vn=0,pn=r),Vn)},movementY:function(r){return"movementY"in r?r.movementY:_o}}),el=Qi(on),bn=re({},on,{dataTransfer:0}),jc=Qi(bn),Ca=re({},Qo,{relatedTarget:0}),vo=Qi(Ca),xo=re({},Ur,{animationName:0,elapsedTime:0,pseudoElement:0}),wf=Qi(xo),Uc=re({},Ur,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Jh=Qi(Uc),Qp=re({},Ur,{data:0}),ed=Qi(Qp),Vr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ys={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tl(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=pi[r])?!!s[r]:!1}function Vc(){return tl}var qc=re({},Qo,{key:function(r){if(r.key){var s=Vr[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=ua(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?ys[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vc,charCode:function(r){return r.type==="keypress"?ua(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ua(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Mi=Qi(qc),Tf=re({},on,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zu=Qi(Tf),Sf=re({},Qo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vc}),Jp=Qi(Sf),Gl=re({},Ur,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hu=Qi(Gl),Zl=re({},on,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),td=Qi(Zl),Gc=re({},Ur,{newState:0,oldState:0}),Hl=Qi(Gc),$l=[9,13,27,32],Oi=Ei&&"CompositionEvent"in window,Xl=null;Ei&&"documentMode"in document&&(Xl=document.documentMode);var Yl=Ei&&"TextEvent"in window&&!Xl,Wl=Ei&&(!Oi||Xl&&8<Xl&&11>=Xl),bo=" ",Ef=!1;function Zc(r,s){switch(r){case"keyup":return $l.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mf(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Wa=!1;function $u(r,s){switch(r){case"compositionend":return Mf(s);case"keypress":return s.which!==32?null:(Ef=!0,bo);case"textInput":return r=s.data,r===bo&&Ef?null:r;default:return null}}function Af(r,s){if(Wa)return r==="compositionend"||!Oi&&Zc(r,s)?(r=yo(),fi=gs=ca=null,Wa=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Wl&&s.locale!=="ko"?null:s.data;default:return null}}var Cf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xu(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Cf[r.type]:s==="textarea"}function Yu(r,s,d,_){ir?qi?qi.push(_):qi=[_]:ir=_,s=Nd(s,"onChange"),0<s.length&&(d=new Fc("onChange","change",null,d,_),r.push({event:d,listeners:s}))}var nl=null,Kl=null;function zf(r){$g(r,0)}function Hc(r){var s=fs(r);if(Kh(s))return r}function wo(r,s){if(r==="change")return s}var nd=!1;if(Ei){var $c;if(Ei){var To="oninput"in document;if(!To){var id=document.createElement("div");id.setAttribute("oninput","return;"),To=typeof id.oninput=="function"}$c=To}else $c=!1;nd=$c&&(!document.documentMode||9<document.documentMode)}function Xc(){nl&&(nl.detachEvent("onpropertychange",Pf),Kl=nl=null)}function Pf(r){if(r.propertyName==="value"&&Hc(Kl)){var s=[];Yu(s,Kl,r,Nc(r)),$n(zf,s)}}function em(r,s,d){r==="focusin"?(Xc(),nl=s,Kl=d,nl.attachEvent("onpropertychange",Pf)):r==="focusout"&&Xc()}function Df(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Hc(Kl)}function Yc(r,s){if(r==="click")return Hc(s)}function If(r,s){if(r==="input"||r==="change")return Hc(s)}function rd(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Yr=typeof Object.is=="function"?Object.is:rd;function So(r,s){if(Yr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),_=Object.keys(s);if(d.length!==_.length)return!1;for(_=0;_<d.length;_++){var M=d[_];if(!cr.call(s,M)||!Yr(r[M],s[M]))return!1}return!0}function za(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Wc(r,s){var d=za(r);r=0;for(var _;d;){if(d.nodeType===3){if(_=r+d.textContent.length,r<=s&&_>=s)return{node:d,offset:s-r};r=_}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=za(d)}}function Wu(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?Wu(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function Ku(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Lc(r.document);s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=Lc(r.document)}return s}function Kc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var Qu=Ei&&"documentMode"in document&&11>=document.documentMode,Pa=null,Qc=null,Jc=null,Ju=!1;function kf(r,s,d){var _=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Ju||Pa==null||Pa!==Lc(_)||(_=Pa,"selectionStart"in _&&Kc(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Jc&&So(Jc,_)||(Jc=_,_=Nd(Qc,"onSelect"),0<_.length&&(s=new Fc("onSelect","select",null,s,d),r.push({event:s,listeners:_}),s.target=Pa)))}function il(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var rl={animationend:il("Animation","AnimationEnd"),animationiteration:il("Animation","AnimationIteration"),animationstart:il("Animation","AnimationStart"),transitionrun:il("Transition","TransitionRun"),transitionstart:il("Transition","TransitionStart"),transitioncancel:il("Transition","TransitionCancel"),transitionend:il("Transition","TransitionEnd")},ad={},Cn={};Ei&&(Cn=document.createElement("div").style,"AnimationEvent"in window||(delete rl.animationend.animation,delete rl.animationiteration.animation,delete rl.animationstart.animation),"TransitionEvent"in window||delete rl.transitionend.transition);function _s(r){if(ad[r])return ad[r];if(!rl[r])return r;var s=rl[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in Cn)return ad[r]=s[d];return r}var eu=_s("animationend"),tu=_s("animationiteration"),eh=_s("animationstart"),al=_s("transitionrun"),nu=_s("transitionstart"),Ql=_s("transitioncancel"),ha=_s("transitionend"),sd=new Map,th="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");th.push("scrollEnd");function da(r,s){sd.set(r,s),xn(s,[r])}var vs=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},qr=[],Hs=0,sl=0;function ol(){for(var r=Hs,s=sl=Hs=0;s<r;){var d=qr[s];qr[s++]=null;var _=qr[s];qr[s++]=null;var M=qr[s];qr[s++]=null;var D=qr[s];if(qr[s++]=null,_!==null&&M!==null){var q=_.pending;q===null?M.next=M:(M.next=q.next,q.next=M),_.pending=M}D!==0&&od(d,M,D)}}function iu(r,s,d,_){qr[Hs++]=r,qr[Hs++]=s,qr[Hs++]=d,qr[Hs++]=_,sl|=_,r.lanes|=_,r=r.alternate,r!==null&&(r.lanes|=_)}function Eo(r,s,d,_){return iu(r,s,d,_),Jl(r)}function Da(r,s){return iu(r,null,null,s),Jl(r)}function od(r,s,d){r.lanes|=d;var _=r.alternate;_!==null&&(_.lanes|=d);for(var M=!1,D=r.return;D!==null;)D.childLanes|=d,_=D.alternate,_!==null&&(_.childLanes|=d),D.tag===22&&(r=D.stateNode,r===null||r._visibility&1||(M=!0)),r=D,D=D.return;return r.tag===3?(D=r.stateNode,M&&s!==null&&(M=31-Je(d),r=D.hiddenUpdates,_=r[M],_===null?r[M]=[s]:_.push(s),s.lane=d|536870912),D):null}function Jl(r){if(50<kd)throw kd=0,_m=null,Error(S(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var cn={};function nh(r,s,d,_){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fa(r,s,d,_){return new nh(r,s,d,_)}function ih(r){return r=r.prototype,!(!r||!r.isReactComponent)}function pa(r,s){var d=r.alternate;return d===null?(d=fa(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function Rf(r,s){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,s=d.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function rh(r,s,d,_,M,D){var q=0;if(_=r,typeof r=="function")ih(r)&&(q=1);else if(typeof r=="string")q=Ap(r,d,Mt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case ct:return r=fa(31,d,s,M),r.elementType=ct,r.lanes=D,r;case fe:return Mo(d.children,M,D,s);case ie:q=8,M|=24;break;case Le:return r=fa(12,d,s,M|2),r.elementType=Le,r.lanes=D,r;case zt:return r=fa(13,d,s,M),r.elementType=zt,r.lanes=D,r;case tt:return r=fa(19,d,s,M),r.elementType=tt,r.lanes=D,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case ht:q=10;break e;case Ke:q=9;break e;case Ct:q=11;break e;case st:q=14;break e;case ke:q=16,_=null;break e}q=29,d=Error(S(130,r===null?"null":typeof r,"")),_=null}return s=fa(q,d,s,M),s.elementType=r,s.type=_,s.lanes=D,s}function Mo(r,s,d,_){return r=fa(7,r,_,s),r.lanes=d,r}function ld(r,s,d){return r=fa(6,r,null,s),r.lanes=d,r}function ah(r){var s=fa(18,null,null,0);return s.stateNode=r,s}function Ao(r,s,d){return s=fa(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var ec=new WeakMap;function Gr(r,s){if(typeof r=="object"&&r!==null){var d=ec.get(r);return d!==void 0?d:(s={value:r,source:s,stack:Wi(s)},ec.set(r,s),s)}return{value:r,source:s,stack:Wi(s)}}var Co=[],zo=0,ll=null,Po=0,ar=[],fr=0,xs=null,bs=1,Wr="";function $s(r,s){Co[zo++]=Po,Co[zo++]=ll,ll=r,Po=s}function cd(r,s,d){ar[fr++]=bs,ar[fr++]=Wr,ar[fr++]=xs,xs=r;var _=bs;r=Wr;var M=32-Je(_)-1;_&=~(1<<M),d+=1;var D=32-Je(s)+M;if(30<D){var q=M-M%5;D=(_&(1<<q)-1).toString(32),_>>=q,M-=q,bs=1<<32-Je(s)+M|d<<M|_,Wr=D+r}else bs=1<<D|d<<M|_,Wr=r}function cl(r){r.return!==null&&($s(r,1),cd(r,1,0))}function tc(r){for(;r===ll;)ll=Co[--zo],Co[zo]=null,Po=Co[--zo],Co[zo]=null;for(;r===xs;)xs=ar[--fr],ar[fr]=null,Wr=ar[--fr],ar[fr]=null,bs=ar[--fr],ar[fr]=null}function ud(r,s){ar[fr++]=bs,ar[fr++]=Wr,ar[fr++]=xs,bs=s.id,Wr=s.overflow,xs=r}var pr=null,Xn=null,vn=!1,Xs=null,ma=!1,vi=Error(S(519));function Kr(r){var s=Error(S(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ys(Gr(s,r)),vi}function Qr(r){var s=r.stateNode,d=r.type,_=r.memoizedProps;switch(s[_t]=r,s[Fe]=_,d){case"dialog":En("cancel",s),En("close",s);break;case"iframe":case"object":case"embed":En("load",s);break;case"video":case"audio":for(d=0;d<gc.length;d++)En(gc[d],s);break;case"source":En("error",s);break;case"img":case"image":case"link":En("error",s),En("load",s);break;case"details":En("toggle",s);break;case"input":En("invalid",s),qu(s,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0);break;case"select":En("invalid",s);break;case"textarea":En("invalid",s),Vl(s,_.value,_.defaultValue,_.children)}d=_.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||s.textContent===""+d||_.suppressHydrationWarning===!0||Im(s.textContent,d)?(_.popover!=null&&(En("beforetoggle",s),En("toggle",s)),_.onScroll!=null&&En("scroll",s),_.onScrollEnd!=null&&En("scrollend",s),_.onClick!=null&&(s.onclick=Ya),s=!0):s=!1,s||Kr(r,!0)}function ru(r){for(pr=r.return;pr;)switch(pr.tag){case 5:case 31:case 13:ma=!1;return;case 27:case 3:ma=!0;return;default:pr=pr.return}}function ws(r){if(r!==pr)return!1;if(!vn)return ru(r),vn=!0,!1;var s=r.tag,d;if((d=s!==3&&s!==27)&&((d=s===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||xp(r.type,r.memoizedProps)),d=!d),d&&Xn&&Kr(r),ru(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));Xn=wr(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));Xn=wr(r)}else s===27?(s=Xn,vc(r.type)?(r=Ta,Ta=null,Xn=r):Xn=s):Xn=pr?ls(r.stateNode.nextSibling):null;return!0}function Ts(){Xn=pr=null,vn=!1}function Ss(){var r=Xs;return r!==null&&(Ua===null?Ua=r:Ua.push.apply(Ua,r),Xs=null),r}function Ys(r){Xs===null?Xs=[r]:Xs.push(r)}var Ws=xe(null),Ia=null,Es=null;function Ks(r,s,d){wt(Ws,s._currentValue),s._currentValue=d}function Ms(r){r._currentValue=Ws.current,Ye(Ws)}function sh(r,s,d){for(;r!==null;){var _=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,_!==null&&(_.childLanes|=s)):_!==null&&(_.childLanes&s)!==s&&(_.childLanes|=s),r===d)break;r=r.return}}function oh(r,s,d,_){var M=r.child;for(M!==null&&(M.return=r);M!==null;){var D=M.dependencies;if(D!==null){var q=M.child;D=D.firstContext;e:for(;D!==null;){var te=D;D=M;for(var Ee=0;Ee<s.length;Ee++)if(te.context===s[Ee]){D.lanes|=d,te=D.alternate,te!==null&&(te.lanes|=d),sh(D.return,d,r),_||(q=null);break e}D=te.next}}else if(M.tag===18){if(q=M.return,q===null)throw Error(S(341));q.lanes|=d,D=q.alternate,D!==null&&(D.lanes|=d),sh(q,d,r),q=null}else q=M.child;if(q!==null)q.return=M;else for(q=M;q!==null;){if(q===r){q=null;break}if(M=q.sibling,M!==null){M.return=q.return,q=M;break}q=q.return}M=q}}function ga(r,s,d,_){r=null;for(var M=s,D=!1;M!==null;){if(!D){if((M.flags&524288)!==0)D=!0;else if((M.flags&262144)!==0)break}if(M.tag===10){var q=M.alternate;if(q===null)throw Error(S(387));if(q=q.memoizedProps,q!==null){var te=M.type;Yr(M.pendingProps.value,q.value)||(r!==null?r.push(te):r=[te])}}else if(M===Vt.current){if(q=M.alternate,q===null)throw Error(S(387));q.memoizedState.memoizedState!==M.memoizedState.memoizedState&&(r!==null?r.push(Bh):r=[Bh])}M=M.return}r!==null&&oh(s,r,d,_),s.flags|=262144}function nc(r){for(r=r.firstContext;r!==null;){if(!Yr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Qs(r){Ia=r,Es=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Gi(r){return lh(Ia,r)}function au(r,s){return Ia===null&&Qs(r),lh(r,s)}function lh(r,s){var d=s._currentValue;if(s={context:s,memoizedValue:d,next:null},Es===null){if(r===null)throw Error(S(308));Es=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Es=Es.next=s;return d}var hd=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(d,_){r.push(_)}};this.abort=function(){s.aborted=!0,r.forEach(function(d){return d()})}},Lf=h.unstable_scheduleCallback,dd=h.unstable_NormalPriority,Bi={$$typeof:ht,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function As(){return{controller:new hd,data:new Map,refCount:0}}function ic(r){r.refCount--,r.refCount===0&&Lf(dd,function(){r.controller.abort()})}var Dr=null,ya=0,ul=0,Ir=null;function tm(r,s){if(Dr===null){var d=Dr=[];ya=0,ul=Am(),Ir={status:"pending",value:void 0,then:function(_){d.push(_)}}}return ya++,s.then(rc,rc),s}function rc(){if(--ya===0&&Dr!==null){Ir!==null&&(Ir.status="fulfilled");var r=Dr;Dr=null,ul=0,Ir=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function su(r,s){var d=[],_={status:"pending",value:null,reason:null,then:function(M){d.push(M)}};return r.then(function(){_.status="fulfilled",_.value=s;for(var M=0;M<d.length;M++)(0,d[M])(s)},function(M){for(_.status="rejected",_.reason=M,M=0;M<d.length;M++)(0,d[M])(void 0)}),_}var sr=we.S;we.S=function(r,s){Pg=Li(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&tm(r,s),sr!==null&&sr(r,s)};var Ka=xe(null);function ch(){var r=Ka.current;return r!==null?r:yi.pooledCache}function uh(r,s){s===null?wt(Ka,Ka.current):wt(Ka,s.pool)}function Of(){var r=ch();return r===null?null:{parent:Bi._currentValue,pool:r}}var Qa=Error(S(460)),Do=Error(S(474)),Jr=Error(S(542)),Ot={then:function(){}};function ou(r){return r=r.status,r==="fulfilled"||r==="rejected"}function hh(r,s,d){switch(d=r[d],d===void 0?r.push(s):d!==s&&(s.then(Ya,Ya),s=d),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,dh(r),r;default:if(typeof s.status=="string")s.then(Ya,Ya);else{if(r=yi,r!==null&&100<r.shellSuspendCounter)throw Error(S(482));r=s,r.status="pending",r.then(function(_){if(s.status==="pending"){var M=s;M.status="fulfilled",M.value=_}},function(_){if(s.status==="pending"){var M=s;M.status="rejected",M.reason=_}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,dh(r),r}throw Ja=s,Qa}}function ka(r){try{var s=r._init;return s(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(Ja=d,Qa):d}}var Ja=null;function ac(){if(Ja===null)throw Error(S(459));var r=Ja;return Ja=null,r}function dh(r){if(r===Qa||r===Jr)throw Error(S(483))}var Cs=null,hl=0;function lu(r){var s=hl;return hl+=1,Cs===null&&(Cs=[]),hh(Cs,r,s)}function zs(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function fh(r,s){throw s.$$typeof===Me?Error(S(525)):(r=Object.prototype.toString.call(s),Error(S(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function cu(r){function s(Ne,Pe){if(r){var Ze=Ne.deletions;Ze===null?(Ne.deletions=[Pe],Ne.flags|=16):Ze.push(Pe)}}function d(Ne,Pe){if(!r)return null;for(;Pe!==null;)s(Ne,Pe),Pe=Pe.sibling;return null}function _(Ne){for(var Pe=new Map;Ne!==null;)Ne.key!==null?Pe.set(Ne.key,Ne):Pe.set(Ne.index,Ne),Ne=Ne.sibling;return Pe}function M(Ne,Pe){return Ne=pa(Ne,Pe),Ne.index=0,Ne.sibling=null,Ne}function D(Ne,Pe,Ze){return Ne.index=Ze,r?(Ze=Ne.alternate,Ze!==null?(Ze=Ze.index,Ze<Pe?(Ne.flags|=67108866,Pe):Ze):(Ne.flags|=67108866,Pe)):(Ne.flags|=1048576,Pe)}function q(Ne){return r&&Ne.alternate===null&&(Ne.flags|=67108866),Ne}function te(Ne,Pe,Ze,gt){return Pe===null||Pe.tag!==6?(Pe=ld(Ze,Ne.mode,gt),Pe.return=Ne,Pe):(Pe=M(Pe,Ze),Pe.return=Ne,Pe)}function Ee(Ne,Pe,Ze,gt){var rn=Ze.type;return rn===fe?dt(Ne,Pe,Ze.props.children,gt,Ze.key):Pe!==null&&(Pe.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===ke&&ka(rn)===Pe.type)?(Pe=M(Pe,Ze.props),zs(Pe,Ze),Pe.return=Ne,Pe):(Pe=rh(Ze.type,Ze.key,Ze.props,null,Ne.mode,gt),zs(Pe,Ze),Pe.return=Ne,Pe)}function Xe(Ne,Pe,Ze,gt){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==Ze.containerInfo||Pe.stateNode.implementation!==Ze.implementation?(Pe=Ao(Ze,Ne.mode,gt),Pe.return=Ne,Pe):(Pe=M(Pe,Ze.children||[]),Pe.return=Ne,Pe)}function dt(Ne,Pe,Ze,gt,rn){return Pe===null||Pe.tag!==7?(Pe=Mo(Ze,Ne.mode,gt,rn),Pe.return=Ne,Pe):(Pe=M(Pe,Ze),Pe.return=Ne,Pe)}function xt(Ne,Pe,Ze){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number"||typeof Pe=="bigint")return Pe=ld(""+Pe,Ne.mode,Ze),Pe.return=Ne,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case be:return Ze=rh(Pe.type,Pe.key,Pe.props,null,Ne.mode,Ze),zs(Ze,Pe),Ze.return=Ne,Ze;case Ie:return Pe=Ao(Pe,Ne.mode,Ze),Pe.return=Ne,Pe;case ke:return Pe=ka(Pe),xt(Ne,Pe,Ze)}if(ut(Pe)||Et(Pe))return Pe=Mo(Pe,Ne.mode,Ze,null),Pe.return=Ne,Pe;if(typeof Pe.then=="function")return xt(Ne,lu(Pe),Ze);if(Pe.$$typeof===ht)return xt(Ne,au(Ne,Pe),Ze);fh(Ne,Pe)}return null}function We(Ne,Pe,Ze,gt){var rn=Pe!==null?Pe.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return rn!==null?null:te(Ne,Pe,""+Ze,gt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case be:return Ze.key===rn?Ee(Ne,Pe,Ze,gt):null;case Ie:return Ze.key===rn?Xe(Ne,Pe,Ze,gt):null;case ke:return Ze=ka(Ze),We(Ne,Pe,Ze,gt)}if(ut(Ze)||Et(Ze))return rn!==null?null:dt(Ne,Pe,Ze,gt,null);if(typeof Ze.then=="function")return We(Ne,Pe,lu(Ze),gt);if(Ze.$$typeof===ht)return We(Ne,Pe,au(Ne,Ze),gt);fh(Ne,Ze)}return null}function nt(Ne,Pe,Ze,gt,rn){if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return Ne=Ne.get(Ze)||null,te(Pe,Ne,""+gt,rn);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case be:return Ne=Ne.get(gt.key===null?Ze:gt.key)||null,Ee(Pe,Ne,gt,rn);case Ie:return Ne=Ne.get(gt.key===null?Ze:gt.key)||null,Xe(Pe,Ne,gt,rn);case ke:return gt=ka(gt),nt(Ne,Pe,Ze,gt,rn)}if(ut(gt)||Et(gt))return Ne=Ne.get(Ze)||null,dt(Pe,Ne,gt,rn,null);if(typeof gt.then=="function")return nt(Ne,Pe,Ze,lu(gt),rn);if(gt.$$typeof===ht)return nt(Ne,Pe,Ze,au(Pe,gt),rn);fh(Pe,gt)}return null}function Yt(Ne,Pe,Ze,gt){for(var rn=null,Zn=null,Wt=Pe,Jt=Pe=0,wn=null;Wt!==null&&Jt<Ze.length;Jt++){Wt.index>Jt?(wn=Wt,Wt=null):wn=Wt.sibling;var Un=We(Ne,Wt,Ze[Jt],gt);if(Un===null){Wt===null&&(Wt=wn);break}r&&Wt&&Un.alternate===null&&s(Ne,Wt),Pe=D(Un,Pe,Jt),Zn===null?rn=Un:Zn.sibling=Un,Zn=Un,Wt=wn}if(Jt===Ze.length)return d(Ne,Wt),vn&&$s(Ne,Jt),rn;if(Wt===null){for(;Jt<Ze.length;Jt++)Wt=xt(Ne,Ze[Jt],gt),Wt!==null&&(Pe=D(Wt,Pe,Jt),Zn===null?rn=Wt:Zn.sibling=Wt,Zn=Wt);return vn&&$s(Ne,Jt),rn}for(Wt=_(Wt);Jt<Ze.length;Jt++)wn=nt(Wt,Ne,Jt,Ze[Jt],gt),wn!==null&&(r&&wn.alternate!==null&&Wt.delete(wn.key===null?Jt:wn.key),Pe=D(wn,Pe,Jt),Zn===null?rn=wn:Zn.sibling=wn,Zn=wn);return r&&Wt.forEach(function(Il){return s(Ne,Il)}),vn&&$s(Ne,Jt),rn}function an(Ne,Pe,Ze,gt){if(Ze==null)throw Error(S(151));for(var rn=null,Zn=null,Wt=Pe,Jt=Pe=0,wn=null,Un=Ze.next();Wt!==null&&!Un.done;Jt++,Un=Ze.next()){Wt.index>Jt?(wn=Wt,Wt=null):wn=Wt.sibling;var Il=We(Ne,Wt,Un.value,gt);if(Il===null){Wt===null&&(Wt=wn);break}r&&Wt&&Il.alternate===null&&s(Ne,Wt),Pe=D(Il,Pe,Jt),Zn===null?rn=Il:Zn.sibling=Il,Zn=Il,Wt=wn}if(Un.done)return d(Ne,Wt),vn&&$s(Ne,Jt),rn;if(Wt===null){for(;!Un.done;Jt++,Un=Ze.next())Un=xt(Ne,Un.value,gt),Un!==null&&(Pe=D(Un,Pe,Jt),Zn===null?rn=Un:Zn.sibling=Un,Zn=Un);return vn&&$s(Ne,Jt),rn}for(Wt=_(Wt);!Un.done;Jt++,Un=Ze.next())Un=nt(Wt,Ne,Jt,Un.value,gt),Un!==null&&(r&&Un.alternate!==null&&Wt.delete(Un.key===null?Jt:Un.key),Pe=D(Un,Pe,Jt),Zn===null?rn=Un:Zn.sibling=Un,Zn=Un);return r&&Wt.forEach(function(eg){return s(Ne,eg)}),vn&&$s(Ne,Jt),rn}function ri(Ne,Pe,Ze,gt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===fe&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case be:e:{for(var rn=Ze.key;Pe!==null;){if(Pe.key===rn){if(rn=Ze.type,rn===fe){if(Pe.tag===7){d(Ne,Pe.sibling),gt=M(Pe,Ze.props.children),gt.return=Ne,Ne=gt;break e}}else if(Pe.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===ke&&ka(rn)===Pe.type){d(Ne,Pe.sibling),gt=M(Pe,Ze.props),zs(gt,Ze),gt.return=Ne,Ne=gt;break e}d(Ne,Pe);break}else s(Ne,Pe);Pe=Pe.sibling}Ze.type===fe?(gt=Mo(Ze.props.children,Ne.mode,gt,Ze.key),gt.return=Ne,Ne=gt):(gt=rh(Ze.type,Ze.key,Ze.props,null,Ne.mode,gt),zs(gt,Ze),gt.return=Ne,Ne=gt)}return q(Ne);case Ie:e:{for(rn=Ze.key;Pe!==null;){if(Pe.key===rn)if(Pe.tag===4&&Pe.stateNode.containerInfo===Ze.containerInfo&&Pe.stateNode.implementation===Ze.implementation){d(Ne,Pe.sibling),gt=M(Pe,Ze.children||[]),gt.return=Ne,Ne=gt;break e}else{d(Ne,Pe);break}else s(Ne,Pe);Pe=Pe.sibling}gt=Ao(Ze,Ne.mode,gt),gt.return=Ne,Ne=gt}return q(Ne);case ke:return Ze=ka(Ze),ri(Ne,Pe,Ze,gt)}if(ut(Ze))return Yt(Ne,Pe,Ze,gt);if(Et(Ze)){if(rn=Et(Ze),typeof rn!="function")throw Error(S(150));return Ze=rn.call(Ze),an(Ne,Pe,Ze,gt)}if(typeof Ze.then=="function")return ri(Ne,Pe,lu(Ze),gt);if(Ze.$$typeof===ht)return ri(Ne,Pe,au(Ne,Ze),gt);fh(Ne,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint"?(Ze=""+Ze,Pe!==null&&Pe.tag===6?(d(Ne,Pe.sibling),gt=M(Pe,Ze),gt.return=Ne,Ne=gt):(d(Ne,Pe),gt=ld(Ze,Ne.mode,gt),gt.return=Ne,Ne=gt),q(Ne)):d(Ne,Pe)}return function(Ne,Pe,Ze,gt){try{hl=0;var rn=ri(Ne,Pe,Ze,gt);return Cs=null,rn}catch(Wt){if(Wt===Qa||Wt===Jr)throw Wt;var Zn=fa(29,Wt,null,Ne.mode);return Zn.lanes=gt,Zn.return=Ne,Zn}}}var Ps=cu(!0),fd=cu(!1),Ds=!1;function ph(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function uu(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Is(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Js(r,s,d){var _=r.updateQueue;if(_===null)return null;if(_=_.shared,(Kn&2)!==0){var M=_.pending;return M===null?s.next=s:(s.next=M.next,M.next=s),_.pending=s,s=Jl(r),od(r,null,d),s}return iu(r,_,s,d),Jl(r)}function Ra(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194048)!==0)){var _=s.lanes;_&=r.pendingLanes,d|=_,s.lanes=d,Ti(r,d)}}function Fn(r,s){var d=r.updateQueue,_=r.alternate;if(_!==null&&(_=_.updateQueue,d===_)){var M=null,D=null;if(d=d.firstBaseUpdate,d!==null){do{var q={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};D===null?M=D=q:D=D.next=q,d=d.next}while(d!==null);D===null?M=D=s:D=D.next=s}else M=D=s;d={baseState:_.baseState,firstBaseUpdate:M,lastBaseUpdate:D,shared:_.shared,callbacks:_.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}var pd=!1;function eo(){if(pd){var r=Ir;if(r!==null)throw r}}function Io(r,s,d,_){pd=!1;var M=r.updateQueue;Ds=!1;var D=M.firstBaseUpdate,q=M.lastBaseUpdate,te=M.shared.pending;if(te!==null){M.shared.pending=null;var Ee=te,Xe=Ee.next;Ee.next=null,q===null?D=Xe:q.next=Xe,q=Ee;var dt=r.alternate;dt!==null&&(dt=dt.updateQueue,te=dt.lastBaseUpdate,te!==q&&(te===null?dt.firstBaseUpdate=Xe:te.next=Xe,dt.lastBaseUpdate=Ee))}if(D!==null){var xt=M.baseState;q=0,dt=Xe=Ee=null,te=D;do{var We=te.lane&-536870913,nt=We!==te.lane;if(nt?(Sn&We)===We:(_&We)===We){We!==0&&We===ul&&(pd=!0),dt!==null&&(dt=dt.next={lane:0,tag:te.tag,payload:te.payload,callback:null,next:null});e:{var Yt=r,an=te;We=s;var ri=d;switch(an.tag){case 1:if(Yt=an.payload,typeof Yt=="function"){xt=Yt.call(ri,xt,We);break e}xt=Yt;break e;case 3:Yt.flags=Yt.flags&-65537|128;case 0:if(Yt=an.payload,We=typeof Yt=="function"?Yt.call(ri,xt,We):Yt,We==null)break e;xt=re({},xt,We);break e;case 2:Ds=!0}}We=te.callback,We!==null&&(r.flags|=64,nt&&(r.flags|=8192),nt=M.callbacks,nt===null?M.callbacks=[We]:nt.push(We))}else nt={lane:We,tag:te.tag,payload:te.payload,callback:te.callback,next:null},dt===null?(Xe=dt=nt,Ee=xt):dt=dt.next=nt,q|=We;if(te=te.next,te===null){if(te=M.shared.pending,te===null)break;nt=te,te=nt.next,nt.next=null,M.lastBaseUpdate=nt,M.shared.pending=null}}while(!0);dt===null&&(Ee=xt),M.baseState=Ee,M.firstBaseUpdate=Xe,M.lastBaseUpdate=dt,D===null&&(M.shared.lanes=0),El|=q,r.lanes=q,r.memoizedState=xt}}function hu(r,s){if(typeof r!="function")throw Error(S(191,r));r.call(s)}function mh(r,s){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)hu(d[r],s)}var dl=xe(null),du=xe(0);function md(r,s){r=Sl,wt(du,r),wt(dl,s),Sl=r|s.baseLanes}function _a(){wt(du,Sl),wt(dl,dl.current)}function fl(){Sl=du.current,Ye(dl),Ye(du)}var Nt=xe(null),Xt=null;function La(r){var s=r.alternate;wt(Ai,Ai.current&1),wt(Nt,r),Xt===null&&(s===null||dl.current!==null||s.memoizedState!==null)&&(Xt=r)}function sc(r){wt(Ai,Ai.current),wt(Nt,r),Xt===null&&(Xt=r)}function fu(r){r.tag===22?(wt(Ai,Ai.current),wt(Nt,r),Xt===null&&(Xt=r)):Ni()}function Ni(){wt(Ai,Ai.current),wt(Nt,Nt.current)}function xi(r){Ye(Nt),Xt===r&&(Xt=null),Ye(Ai)}var Ai=xe(0);function pu(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||ia(d)||er(d)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var to=0,fn=null,Bn=null,dn=null,mi=!1,Oa=!1,es=!1,pl=0,ml=0,no=null,gd=0;function si(){throw Error(S(321))}function ts(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!Yr(r[d],s[d]))return!1;return!0}function oc(r,s,d,_,M,D){return to=D,fn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,we.H=r===null||r.memoizedState===null?Wn:Zi,es=!1,D=d(_,M),es=!1,Oa&&(D=mu(s,d,_,M)),lc(r),D}function lc(r){we.H=jn;var s=Bn!==null&&Bn.next!==null;if(to=0,dn=Bn=fn=null,mi=!1,ml=0,no=null,s)throw Error(S(300));r===null||yr||(r=r.dependencies,r!==null&&nc(r)&&(yr=!0))}function mu(r,s,d,_){fn=r;var M=0;do{if(Oa&&(no=null),ml=0,Oa=!1,25<=M)throw Error(S(301));if(M+=1,dn=Bn=null,r.updateQueue!=null){var D=r.updateQueue;D.lastEffect=null,D.events=null,D.stores=null,D.memoCache!=null&&(D.memoCache.index=0)}we.H=Ji,D=s(d,_)}while(Oa);return D}function gu(){var r=we.H,s=r.useState()[0];return s=typeof s.then=="function"?gl(s):s,r=r.useState()[0],(Bn!==null?Bn.memoizedState:null)!==r&&(fn.flags|=1024),s}function yu(){var r=pl!==0;return pl=0,r}function ko(r,s,d){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~d}function io(r){if(mi){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}mi=!1}to=0,dn=Bn=fn=null,Oa=!1,ml=pl=0,no=null}function Er(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dn===null?fn.memoizedState=dn=r:dn=dn.next=r,dn}function gi(){if(Bn===null){var r=fn.alternate;r=r!==null?r.memoizedState:null}else r=Bn.next;var s=dn===null?fn.memoizedState:dn.next;if(s!==null)dn=s,Bn=r;else{if(r===null)throw fn.alternate===null?Error(S(467)):Error(S(310));Bn=r,r={memoizedState:Bn.memoizedState,baseState:Bn.baseState,baseQueue:Bn.baseQueue,queue:Bn.queue,next:null},dn===null?fn.memoizedState=dn=r:dn=dn.next=r}return dn}function ks(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function gl(r){var s=ml;return ml+=1,no===null&&(no=[]),r=hh(no,r,s),s=fn,(dn===null?s.memoizedState:dn.next)===null&&(s=s.alternate,we.H=s===null||s.memoizedState===null?Wn:Zi),r}function yl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return gl(r);if(r.$$typeof===ht)return Gi(r)}throw Error(S(438,String(r)))}function cc(r){var s=null,d=fn.updateQueue;if(d!==null&&(s=d.memoCache),s==null){var _=fn.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(s={data:_.data.map(function(M){return M.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),d===null&&(d=ks(),fn.updateQueue=d),d.memoCache=s,d=s.data[s.index],d===void 0)for(d=s.data[s.index]=Array(r),_=0;_<r;_++)d[_]=it;return s.index++,d}function ns(r,s){return typeof s=="function"?s(r):s}function y(r){var s=gi();return t(s,Bn,r)}function t(r,s,d){var _=r.queue;if(_===null)throw Error(S(311));_.lastRenderedReducer=d;var M=r.baseQueue,D=_.pending;if(D!==null){if(M!==null){var q=M.next;M.next=D.next,D.next=q}s.baseQueue=M=D,_.pending=null}if(D=r.baseState,M===null)r.memoizedState=D;else{s=M.next;var te=q=null,Ee=null,Xe=s,dt=!1;do{var xt=Xe.lane&-536870913;if(xt!==Xe.lane?(Sn&xt)===xt:(to&xt)===xt){var We=Xe.revertLane;if(We===0)Ee!==null&&(Ee=Ee.next={lane:0,revertLane:0,gesture:null,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null}),xt===ul&&(dt=!0);else if((to&We)===We){Xe=Xe.next,We===ul&&(dt=!0);continue}else xt={lane:0,revertLane:Xe.revertLane,gesture:null,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null},Ee===null?(te=Ee=xt,q=D):Ee=Ee.next=xt,fn.lanes|=We,El|=We;xt=Xe.action,es&&d(D,xt),D=Xe.hasEagerState?Xe.eagerState:d(D,xt)}else We={lane:xt,revertLane:Xe.revertLane,gesture:Xe.gesture,action:Xe.action,hasEagerState:Xe.hasEagerState,eagerState:Xe.eagerState,next:null},Ee===null?(te=Ee=We,q=D):Ee=Ee.next=We,fn.lanes|=xt,El|=xt;Xe=Xe.next}while(Xe!==null&&Xe!==s);if(Ee===null?q=D:Ee.next=te,!Yr(D,r.memoizedState)&&(yr=!0,dt&&(d=Ir,d!==null)))throw d;r.memoizedState=D,r.baseState=q,r.baseQueue=Ee,_.lastRenderedState=D}return M===null&&(_.lanes=0),[r.memoizedState,_.dispatch]}function a(r){var s=gi(),d=s.queue;if(d===null)throw Error(S(311));d.lastRenderedReducer=r;var _=d.dispatch,M=d.pending,D=s.memoizedState;if(M!==null){d.pending=null;var q=M=M.next;do D=r(D,q.action),q=q.next;while(q!==M);Yr(D,s.memoizedState)||(yr=!0),s.memoizedState=D,s.baseQueue===null&&(s.baseState=D),d.lastRenderedState=D}return[D,_]}function c(r,s,d){var _=fn,M=gi(),D=vn;if(D){if(d===void 0)throw Error(S(407));d=d()}else d=s();var q=!Yr((Bn||M).memoizedState,d);if(q&&(M.memoizedState=d,yr=!0),M=M.queue,qe(w.bind(null,_,M,r),[r]),M.getSnapshot!==s||q||dn!==null&&dn.memoizedState.tag&1){if(_.flags|=2048,pe(9,{destroy:void 0},v.bind(null,_,M,d,s),null),yi===null)throw Error(S(349));D||(to&127)!==0||f(_,s,d)}return d}function f(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=fn.updateQueue,s===null?(s=ks(),fn.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function v(r,s,d,_){s.value=d,s.getSnapshot=_,E(s)&&P(r)}function w(r,s,d){return d(function(){E(s)&&P(r)})}function E(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!Yr(r,d)}catch{return!0}}function P(r){var s=Da(r,2);s!==null&&qa(s,r,2)}function R(r){var s=Er();if(typeof r=="function"){var d=r;if(r=d(),es){De(!0);try{d()}finally{De(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:r},s}function O(r,s,d,_){return r.baseState=d,t(r,Bn,typeof _=="function"?_:ns)}function V(r,s,d,_,M){if(va(r))throw Error(S(485));if(r=s.action,r!==null){var D={payload:M,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){D.listeners.push(q)}};we.T!==null?d(!0):D.isTransition=!1,_(D),d=s.pending,d===null?(D.next=s.pending=D,j(s,D)):(D.next=d.next,s.pending=d.next=D)}}function j(r,s){var d=s.action,_=s.payload,M=r.state;if(s.isTransition){var D=we.T,q={};we.T=q;try{var te=d(M,_),Ee=we.S;Ee!==null&&Ee(q,te),X(r,s,te)}catch(Xe){se(r,s,Xe)}finally{D!==null&&q.types!==null&&(D.types=q.types),we.T=D}}else try{D=d(M,_),X(r,s,D)}catch(Xe){se(r,s,Xe)}}function X(r,s,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(_){Q(r,s,_)},function(_){return se(r,s,_)}):Q(r,s,d)}function Q(r,s,d){s.status="fulfilled",s.value=d,le(s),r.state=d,s=r.pending,s!==null&&(d=s.next,d===s?r.pending=null:(d=d.next,s.next=d,j(r,d)))}function se(r,s,d){var _=r.pending;if(r.pending=null,_!==null){_=_.next;do s.status="rejected",s.reason=d,le(s),s=s.next;while(s!==_)}r.action=null}function le(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function oe(r,s){return s}function he(r,s){if(vn){var d=yi.formState;if(d!==null){e:{var _=fn;if(vn){if(Xn){t:{for(var M=Xn,D=ma;M.nodeType!==8;){if(!D){M=null;break t}if(M=ls(M.nextSibling),M===null){M=null;break t}}D=M.data,M=D==="F!"||D==="F"?M:null}if(M){Xn=ls(M.nextSibling),_=M.data==="F!";break e}}Kr(_)}_=!1}_&&(s=d[0])}}return d=Er(),d.memoizedState=d.baseState=s,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oe,lastRenderedState:s},d.queue=_,d=uc.bind(null,fn,_),_.dispatch=d,_=R(!1),D=ta.bind(null,fn,!1,_.queue),_=Er(),M={state:s,dispatch:null,action:r,pending:null},_.queue=M,d=V.bind(null,fn,M,D,d),M.dispatch=d,_.memoizedState=r,[s,d,!1]}function _e(r){var s=gi();return ce(s,Bn,r)}function ce(r,s,d){if(s=t(r,s,oe)[0],r=y(ns)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var _=gl(s)}catch(q){throw q===Qa?Jr:q}else _=s;s=gi();var M=s.queue,D=M.dispatch;return d!==s.memoizedState&&(fn.flags|=2048,pe(9,{destroy:void 0},ye.bind(null,M,d),null)),[_,D,r]}function ye(r,s){r.action=s}function Te(r){var s=gi(),d=Bn;if(d!==null)return ce(s,d,r);gi(),s=s.memoizedState,d=gi();var _=d.queue.dispatch;return d.memoizedState=r,[s,_,!1]}function pe(r,s,d,_){return r={tag:r,create:d,deps:_,inst:s,next:null},s=fn.updateQueue,s===null&&(s=ks(),fn.updateQueue=s),d=s.lastEffect,d===null?s.lastEffect=r.next=r:(_=d.next,d.next=r,r.next=_,s.lastEffect=r),r}function Ce(){return gi().memoizedState}function Ge(r,s,d,_){var M=Er();fn.flags|=r,M.memoizedState=pe(1|s,{destroy:void 0},d,_===void 0?null:_)}function je(r,s,d,_){var M=gi();_=_===void 0?null:_;var D=M.memoizedState.inst;Bn!==null&&_!==null&&ts(_,Bn.memoizedState.deps)?M.memoizedState=pe(s,D,d,_):(fn.flags|=r,M.memoizedState=pe(1|s,D,d,_))}function Ve(r,s){Ge(8390656,8,r,s)}function qe(r,s){je(2048,8,r,s)}function St(r){fn.flags|=4;var s=fn.updateQueue;if(s===null)s=ks(),fn.updateQueue=s,s.events=[r];else{var d=s.events;d===null?s.events=[r]:d.push(r)}}function At(r){var s=gi().memoizedState;return St({ref:s,nextImpl:r}),function(){if((Kn&2)!==0)throw Error(S(440));return s.impl.apply(void 0,arguments)}}function ft(r,s){return je(4,2,r,s)}function Pt(r,s){return je(4,4,r,s)}function sn(r,s){if(typeof s=="function"){r=r();var d=s(r);return function(){typeof d=="function"?d():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function Nn(r,s,d){d=d!=null?d.concat([r]):null,je(4,4,sn.bind(null,s,r),d)}function ei(){}function Yn(r,s){var d=gi();s=s===void 0?null:s;var _=d.memoizedState;return s!==null&&ts(s,_[1])?_[0]:(d.memoizedState=[r,s],r)}function oi(r,s){var d=gi();s=s===void 0?null:s;var _=d.memoizedState;if(s!==null&&ts(s,_[1]))return _[0];if(_=r(),es){De(!0);try{r()}finally{De(!1)}}return d.memoizedState=[_,s],_}function qn(r,s,d){return d===void 0||(to&1073741824)!==0&&(Sn&261930)===0?r.memoizedState=s:(r.memoizedState=d,r=Ig(),fn.lanes|=r,El|=r,d)}function bi(r,s,d,_){return Yr(d,s)?d:dl.current!==null?(r=qn(r,d,_),Yr(r,s)||(yr=!0),r):(to&42)===0||(to&1073741824)!==0&&(Sn&261930)===0?(yr=!0,r.memoizedState=d):(r=Ig(),fn.lanes|=r,El|=r,s)}function li(r,s,d,_,M){var D=$e.p;$e.p=D!==0&&8>D?D:8;var q=we.T,te={};we.T=te,ta(r,!1,s,d);try{var Ee=M(),Xe=we.S;if(Xe!==null&&Xe(te,Ee),Ee!==null&&typeof Ee=="object"&&typeof Ee.then=="function"){var dt=su(Ee,_);rs(r,s,dt,Va(r))}else rs(r,s,_,Va(r))}catch(xt){rs(r,s,{then:function(){},status:"rejected",reason:xt},Va())}finally{$e.p=D,q!==null&&te.types!==null&&(q.types=te.types),we.T=q}}function mr(){}function Ci(r,s,d,_){if(r.tag!==5)throw Error(S(476));var M=zi(r).queue;li(r,M,s,mt,d===null?mr:function(){return gr(r),d(_)})}function zi(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:mt,baseState:mt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:mt},next:null};var d={};return s.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:d},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function gr(r){var s=zi(r);s.next===null&&(s=r.alternate.memoizedState),rs(r,s.next.queue,{},Va())}function Rs(){return Gi(Bh)}function Ls(){return gi().memoizedState}function is(){return gi().memoizedState}function ea(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var d=Va();r=Is(d);var _=Js(s,r,d);_!==null&&(qa(_,s,d),Ra(_,s,d)),s={cache:As()},r.payload=s;return}s=s.return}}function _l(r,s,d){var _=Va();d={lane:_,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},va(r)?Ba(s,d):(d=Eo(r,s,d,_),d!==null&&(qa(d,r,_),Na(d,s,_)))}function uc(r,s,d){var _=Va();rs(r,s,d,_)}function rs(r,s,d,_){var M={lane:_,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(va(r))Ba(s,M);else{var D=r.alternate;if(r.lanes===0&&(D===null||D.lanes===0)&&(D=s.lastRenderedReducer,D!==null))try{var q=s.lastRenderedState,te=D(q,d);if(M.hasEagerState=!0,M.eagerState=te,Yr(te,q))return iu(r,s,M,0),yi===null&&ol(),!1}catch{}if(d=Eo(r,s,M,_),d!==null)return qa(d,r,_),Na(d,s,_),!0}return!1}function ta(r,s,d,_){if(_={lane:2,revertLane:Am(),gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},va(r)){if(s)throw Error(S(479))}else s=Eo(r,d,_,2),s!==null&&qa(s,r,2)}function va(r){var s=r.alternate;return r===fn||s!==null&&s===fn}function Ba(r,s){Oa=mi=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function Na(r,s,d){if((d&4194048)!==0){var _=s.lanes;_&=r.pendingLanes,d|=_,s.lanes=d,Ti(r,d)}}var jn={readContext:Gi,use:yl,useCallback:si,useContext:si,useEffect:si,useImperativeHandle:si,useLayoutEffect:si,useInsertionEffect:si,useMemo:si,useReducer:si,useRef:si,useState:si,useDebugValue:si,useDeferredValue:si,useTransition:si,useSyncExternalStore:si,useId:si,useHostTransitionStatus:si,useFormState:si,useActionState:si,useOptimistic:si,useMemoCache:si,useCacheRefresh:si};jn.useEffectEvent=si;var Wn={readContext:Gi,use:yl,useCallback:function(r,s){return Er().memoizedState=[r,s===void 0?null:s],r},useContext:Gi,useEffect:Ve,useImperativeHandle:function(r,s,d){d=d!=null?d.concat([r]):null,Ge(4194308,4,sn.bind(null,s,r),d)},useLayoutEffect:function(r,s){return Ge(4194308,4,r,s)},useInsertionEffect:function(r,s){Ge(4,2,r,s)},useMemo:function(r,s){var d=Er();s=s===void 0?null:s;var _=r();if(es){De(!0);try{r()}finally{De(!1)}}return d.memoizedState=[_,s],_},useReducer:function(r,s,d){var _=Er();if(d!==void 0){var M=d(s);if(es){De(!0);try{d(s)}finally{De(!1)}}}else M=s;return _.memoizedState=_.baseState=M,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:M},_.queue=r,r=r.dispatch=_l.bind(null,fn,r),[_.memoizedState,r]},useRef:function(r){var s=Er();return r={current:r},s.memoizedState=r},useState:function(r){r=R(r);var s=r.queue,d=uc.bind(null,fn,s);return s.dispatch=d,[r.memoizedState,d]},useDebugValue:ei,useDeferredValue:function(r,s){var d=Er();return qn(d,r,s)},useTransition:function(){var r=R(!1);return r=li.bind(null,fn,r.queue,!0,!1),Er().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,d){var _=fn,M=Er();if(vn){if(d===void 0)throw Error(S(407));d=d()}else{if(d=s(),yi===null)throw Error(S(349));(Sn&127)!==0||f(_,s,d)}M.memoizedState=d;var D={value:d,getSnapshot:s};return M.queue=D,Ve(w.bind(null,_,D,r),[r]),_.flags|=2048,pe(9,{destroy:void 0},v.bind(null,_,D,d,s),null),d},useId:function(){var r=Er(),s=yi.identifierPrefix;if(vn){var d=Wr,_=bs;d=(_&~(1<<32-Je(_)-1)).toString(32)+d,s="_"+s+"R_"+d,d=pl++,0<d&&(s+="H"+d.toString(32)),s+="_"}else d=gd++,s="_"+s+"r_"+d.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:Rs,useFormState:he,useActionState:he,useOptimistic:function(r){var s=Er();s.memoizedState=s.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=d,s=ta.bind(null,fn,!0,d),d.dispatch=s,[r,s]},useMemoCache:cc,useCacheRefresh:function(){return Er().memoizedState=ea.bind(null,fn)},useEffectEvent:function(r){var s=Er(),d={impl:r};return s.memoizedState=d,function(){if((Kn&2)!==0)throw Error(S(440));return d.impl.apply(void 0,arguments)}}},Zi={readContext:Gi,use:yl,useCallback:Yn,useContext:Gi,useEffect:qe,useImperativeHandle:Nn,useInsertionEffect:ft,useLayoutEffect:Pt,useMemo:oi,useReducer:y,useRef:Ce,useState:function(){return y(ns)},useDebugValue:ei,useDeferredValue:function(r,s){var d=gi();return bi(d,Bn.memoizedState,r,s)},useTransition:function(){var r=y(ns)[0],s=gi().memoizedState;return[typeof r=="boolean"?r:gl(r),s]},useSyncExternalStore:c,useId:Ls,useHostTransitionStatus:Rs,useFormState:_e,useActionState:_e,useOptimistic:function(r,s){var d=gi();return O(d,Bn,r,s)},useMemoCache:cc,useCacheRefresh:is};Zi.useEffectEvent=At;var Ji={readContext:Gi,use:yl,useCallback:Yn,useContext:Gi,useEffect:qe,useImperativeHandle:Nn,useInsertionEffect:ft,useLayoutEffect:Pt,useMemo:oi,useReducer:a,useRef:Ce,useState:function(){return a(ns)},useDebugValue:ei,useDeferredValue:function(r,s){var d=gi();return Bn===null?qn(d,r,s):bi(d,Bn.memoizedState,r,s)},useTransition:function(){var r=a(ns)[0],s=gi().memoizedState;return[typeof r=="boolean"?r:gl(r),s]},useSyncExternalStore:c,useId:Ls,useHostTransitionStatus:Rs,useFormState:Te,useActionState:Te,useOptimistic:function(r,s){var d=gi();return Bn!==null?O(d,Bn,r,s):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:cc,useCacheRefresh:is};Ji.useEffectEvent=At;function gh(r,s,d,_){s=r.memoizedState,d=d(_,s),d=d==null?s:re({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var yh={enqueueSetState:function(r,s,d){r=r._reactInternals;var _=Va(),M=Is(_);M.payload=s,d!=null&&(M.callback=d),s=Js(r,M,_),s!==null&&(qa(s,r,_),Ra(s,r,_))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var _=Va(),M=Is(_);M.tag=1,M.payload=s,d!=null&&(M.callback=d),s=Js(r,M,_),s!==null&&(qa(s,r,_),Ra(s,r,_))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=Va(),_=Is(d);_.tag=2,s!=null&&(_.callback=s),s=Js(r,_,d),s!==null&&(qa(s,r,d),Ra(s,r,d))}};function Ro(r,s,d,_,M,D,q){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(_,D,q):s.prototype&&s.prototype.isPureReactComponent?!So(d,_)||!So(M,D):!0}function Bf(r,s,d,_){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,_),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,_),s.state!==r&&yh.enqueueReplaceState(s,s.state,null)}function Lo(r,s){var d=s;if("ref"in s){d={};for(var _ in s)_!=="ref"&&(d[_]=s[_])}if(r=r.defaultProps){d===s&&(d=re({},d));for(var M in r)d[M]===void 0&&(d[M]=r[M])}return d}function _h(r){vs(r)}function ro(r){console.error(r)}function ao(r){vs(r)}function as(r,s){try{var d=r.onUncaughtError;d(s.value,{componentStack:s.stack})}catch(_){setTimeout(function(){throw _})}}function vh(r,s,d){try{var _=r.onCaughtError;_(d.value,{componentStack:d.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(M){setTimeout(function(){throw M})}}function _u(r,s,d){return d=Is(d),d.tag=3,d.payload={element:null},d.callback=function(){as(r,s)},d}function vu(r){return r=Is(r),r.tag=3,r}function xu(r,s,d,_){var M=d.type.getDerivedStateFromError;if(typeof M=="function"){var D=_.value;r.payload=function(){return M(D)},r.callback=function(){vh(s,d,_)}}var q=d.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(r.callback=function(){vh(s,d,_),typeof M!="function"&&(Ml===null?Ml=new Set([this]):Ml.add(this));var te=_.stack;this.componentDidCatch(_.value,{componentStack:te!==null?te:""})})}function Nf(r,s,d,_,M){if(d.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(s=d.alternate,s!==null&&ga(s,d,M,!0),d=Nt.current,d!==null){switch(d.tag){case 31:case 13:return Xt===null?Ld():d.alternate===null&&Hi===0&&(Hi=3),d.flags&=-257,d.flags|=65536,d.lanes=M,_===Ot?d.flags|=16384:(s=d.updateQueue,s===null?d.updateQueue=new Set([_]):s.add(_),cp(r,_,M)),!1;case 22:return d.flags|=65536,_===Ot?d.flags|=16384:(s=d.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([_])},d.updateQueue=s):(d=s.retryQueue,d===null?s.retryQueue=new Set([_]):d.add(_)),cp(r,_,M)),!1}throw Error(S(435,d.tag))}return cp(r,_,M),Ld(),!1}if(vn)return s=Nt.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=M,_!==vi&&(r=Error(S(422),{cause:_}),Ys(Gr(r,d)))):(_!==vi&&(s=Error(S(423),{cause:_}),Ys(Gr(s,d))),r=r.current.alternate,r.flags|=65536,M&=-M,r.lanes|=M,_=Gr(_,d),M=_u(r.stateNode,_,M),Fn(r,M),Hi!==4&&(Hi=2)),!1;var D=Error(S(520),{cause:_});if(D=Gr(D,d),Dd===null?Dd=[D]:Dd.push(D),Hi!==4&&(Hi=2),s===null)return!0;_=Gr(_,d),d=s;do{switch(d.tag){case 3:return d.flags|=65536,r=M&-M,d.lanes|=r,r=_u(d.stateNode,_,r),Fn(d,r),!1;case 1:if(s=d.type,D=d.stateNode,(d.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(Ml===null||!Ml.has(D))))return d.flags|=65536,M&=-M,d.lanes|=M,M=vu(M),xu(M,r,d,_),Fn(d,M),!1}d=d.return}while(d!==null);return!1}var Ff=Error(S(461)),yr=!1;function Mr(r,s,d,_){s.child=r===null?fd(s,null,d,_):Ps(s,r.child,d,_)}function mg(r,s,d,_,M){d=d.render;var D=s.ref;if("ref"in _){var q={};for(var te in _)te!=="ref"&&(q[te]=_[te])}else q=_;return Qs(s),_=oc(r,s,d,q,D,M),te=yu(),r!==null&&!yr?(ko(r,s,M),Bo(r,s,M)):(vn&&te&&cl(s),s.flags|=1,Mr(r,s,_,M),s.child)}function jf(r,s,d,_,M){if(r===null){var D=d.type;return typeof D=="function"&&!ih(D)&&D.defaultProps===void 0&&d.compare===null?(s.tag=15,s.type=D,nm(r,s,D,_,M)):(r=rh(d.type,null,_,s,s.mode,M),r.ref=s.ref,r.return=s,s.child=r)}if(D=r.child,!vd(r,M)){var q=D.memoizedProps;if(d=d.compare,d=d!==null?d:So,d(q,_)&&r.ref===s.ref)return Bo(r,s,M)}return s.flags|=1,r=pa(D,_),r.ref=s.ref,r.return=s,s.child=r}function nm(r,s,d,_,M){if(r!==null){var D=r.memoizedProps;if(So(D,_)&&r.ref===s.ref)if(yr=!1,s.pendingProps=_=D,vd(r,M))(r.flags&131072)!==0&&(yr=!0);else return s.lanes=r.lanes,Bo(r,s,M)}return rm(r,s,d,_,M)}function im(r,s,d,_){var M=_.children,D=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.mode==="hidden"){if((s.flags&128)!==0){if(D=D!==null?D.baseLanes|d:d,r!==null){for(_=s.child=r.child,M=0;_!==null;)M=M|_.lanes|_.childLanes,_=_.sibling;_=M&~D}else _=0,s.child=null;return gg(r,s,D,d,_)}if((d&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&uh(s,D!==null?D.cachePool:null),D!==null?md(s,D):_a(),fu(s);else return _=s.lanes=536870912,gg(r,s,D!==null?D.baseLanes|d:d,d,_)}else D!==null?(uh(s,D.cachePool),md(s,D),Ni(),s.memoizedState=null):(r!==null&&uh(s,null),_a(),Ni());return Mr(r,s,M,d),s.child}function Oo(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function gg(r,s,d,_,M){var D=ch();return D=D===null?null:{parent:Bi._currentValue,pool:D},s.memoizedState={baseLanes:d,cachePool:D},r!==null&&uh(s,null),_a(),fu(s),r!==null&&ga(r,s,_,!0),s.childLanes=M,null}function vl(r,s){return s=Zf({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function yd(r,s,d){return Ps(s,r.child,null,d),r=vl(s,s.pendingProps),r.flags|=2,xi(s),s.memoizedState=null,r}function Uf(r,s,d){var _=s.pendingProps,M=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(vn){if(_.mode==="hidden")return r=vl(s,_),s.lanes=536870912,Oo(null,r);if(sc(s),(r=Xn)?(r=xc(r,ma),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:xs!==null?{id:bs,overflow:Wr}:null,retryLane:536870912,hydrationErrors:null},d=ah(r),d.return=s,s.child=d,pr=s,Xn=null)):r=null,r===null)throw Kr(s);return s.lanes=536870912,null}return vl(s,_)}var D=r.memoizedState;if(D!==null){var q=D.dehydrated;if(sc(s),M)if(s.flags&256)s.flags&=-257,s=yd(r,s,d);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(S(558));else if(yr||ga(r,s,d,!1),M=(d&r.childLanes)!==0,yr||M){if(_=yi,_!==null&&(q=Us(_,d),q!==0&&q!==D.retryLane))throw D.retryLane=q,Da(r,q),qa(_,r,q),Ff;Ld(),s=yd(r,s,d)}else r=D.treeContext,Xn=ls(q.nextSibling),pr=s,vn=!0,Xs=null,ma=!1,r!==null&&ud(s,r),s=vl(s,_),s.flags|=4096;return s}return r=pa(r.child,{mode:_.mode,children:_.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Vf(r,s){var d=s.ref;if(d===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(S(284));(r===null||r.ref!==d)&&(s.flags|=4194816)}}function rm(r,s,d,_,M){return Qs(s),d=oc(r,s,d,_,void 0,M),_=yu(),r!==null&&!yr?(ko(r,s,M),Bo(r,s,M)):(vn&&_&&cl(s),s.flags|=1,Mr(r,s,d,M),s.child)}function yg(r,s,d,_,M,D){return Qs(s),s.updateQueue=null,d=mu(s,_,d,M),lc(r),_=yu(),r!==null&&!yr?(ko(r,s,D),Bo(r,s,D)):(vn&&_&&cl(s),s.flags|=1,Mr(r,s,d,D),s.child)}function _g(r,s,d,_,M){if(Qs(s),s.stateNode===null){var D=cn,q=d.contextType;typeof q=="object"&&q!==null&&(D=Gi(q)),D=new d(_,D),s.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,D.updater=yh,s.stateNode=D,D._reactInternals=s,D=s.stateNode,D.props=_,D.state=s.memoizedState,D.refs={},ph(s),q=d.contextType,D.context=typeof q=="object"&&q!==null?Gi(q):cn,D.state=s.memoizedState,q=d.getDerivedStateFromProps,typeof q=="function"&&(gh(s,d,q,_),D.state=s.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(q=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),q!==D.state&&yh.enqueueReplaceState(D,D.state,null),Io(s,_,D,M),eo(),D.state=s.memoizedState),typeof D.componentDidMount=="function"&&(s.flags|=4194308),_=!0}else if(r===null){D=s.stateNode;var te=s.memoizedProps,Ee=Lo(d,te);D.props=Ee;var Xe=D.context,dt=d.contextType;q=cn,typeof dt=="object"&&dt!==null&&(q=Gi(dt));var xt=d.getDerivedStateFromProps;dt=typeof xt=="function"||typeof D.getSnapshotBeforeUpdate=="function",te=s.pendingProps!==te,dt||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(te||Xe!==q)&&Bf(s,D,_,q),Ds=!1;var We=s.memoizedState;D.state=We,Io(s,_,D,M),eo(),Xe=s.memoizedState,te||We!==Xe||Ds?(typeof xt=="function"&&(gh(s,d,xt,_),Xe=s.memoizedState),(Ee=Ds||Ro(s,d,Ee,_,We,Xe,q))?(dt||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(s.flags|=4194308)):(typeof D.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=_,s.memoizedState=Xe),D.props=_,D.state=Xe,D.context=q,_=Ee):(typeof D.componentDidMount=="function"&&(s.flags|=4194308),_=!1)}else{D=s.stateNode,uu(r,s),q=s.memoizedProps,dt=Lo(d,q),D.props=dt,xt=s.pendingProps,We=D.context,Xe=d.contextType,Ee=cn,typeof Xe=="object"&&Xe!==null&&(Ee=Gi(Xe)),te=d.getDerivedStateFromProps,(Xe=typeof te=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(q!==xt||We!==Ee)&&Bf(s,D,_,Ee),Ds=!1,We=s.memoizedState,D.state=We,Io(s,_,D,M),eo();var nt=s.memoizedState;q!==xt||We!==nt||Ds||r!==null&&r.dependencies!==null&&nc(r.dependencies)?(typeof te=="function"&&(gh(s,d,te,_),nt=s.memoizedState),(dt=Ds||Ro(s,d,dt,_,We,nt,Ee)||r!==null&&r.dependencies!==null&&nc(r.dependencies))?(Xe||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(_,nt,Ee),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(_,nt,Ee)),typeof D.componentDidUpdate=="function"&&(s.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof D.componentDidUpdate!="function"||q===r.memoizedProps&&We===r.memoizedState||(s.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===r.memoizedProps&&We===r.memoizedState||(s.flags|=1024),s.memoizedProps=_,s.memoizedState=nt),D.props=_,D.state=nt,D.context=Ee,_=dt):(typeof D.componentDidUpdate!="function"||q===r.memoizedProps&&We===r.memoizedState||(s.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===r.memoizedProps&&We===r.memoizedState||(s.flags|=1024),_=!1)}return D=_,Vf(r,s),_=(s.flags&128)!==0,D||_?(D=s.stateNode,d=_&&typeof d.getDerivedStateFromError!="function"?null:D.render(),s.flags|=1,r!==null&&_?(s.child=Ps(s,r.child,null,M),s.child=Ps(s,null,d,M)):Mr(r,s,d,M),s.memoizedState=D.state,r=s.child):r=Bo(r,s,M),r}function vg(r,s,d,_){return Ts(),s.flags|=256,Mr(r,s,d,_),s.child}var qf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _d(r){return{baseLanes:r,cachePool:Of()}}function Gf(r,s,d){return r=r!==null?r.childLanes&~d:0,s&&(r|=Zr),r}function am(r,s,d){var _=s.pendingProps,M=!1,D=(s.flags&128)!==0,q;if((q=D)||(q=r!==null&&r.memoizedState===null?!1:(Ai.current&2)!==0),q&&(M=!0,s.flags&=-129),q=(s.flags&32)!==0,s.flags&=-33,r===null){if(vn){if(M?La(s):Ni(),(r=Xn)?(r=xc(r,ma),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:xs!==null?{id:bs,overflow:Wr}:null,retryLane:536870912,hydrationErrors:null},d=ah(r),d.return=s,s.child=d,pr=s,Xn=null)):r=null,r===null)throw Kr(s);return er(r)?s.lanes=32:s.lanes=536870912,null}var te=_.children;return _=_.fallback,M?(Ni(),M=s.mode,te=Zf({mode:"hidden",children:te},M),_=Mo(_,M,d,null),te.return=s,_.return=s,te.sibling=_,s.child=te,_=s.child,_.memoizedState=_d(d),_.childLanes=Gf(r,q,d),s.memoizedState=qf,Oo(null,_)):(La(s),sm(s,te))}var Ee=r.memoizedState;if(Ee!==null&&(te=Ee.dehydrated,te!==null)){if(D)s.flags&256?(La(s),s.flags&=-257,s=Hf(r,s,d)):s.memoizedState!==null?(Ni(),s.child=r.child,s.flags|=128,s=null):(Ni(),te=_.fallback,M=s.mode,_=Zf({mode:"visible",children:_.children},M),te=Mo(te,M,d,null),te.flags|=2,_.return=s,te.return=s,_.sibling=te,s.child=_,Ps(s,r.child,null,d),_=s.child,_.memoizedState=_d(d),_.childLanes=Gf(r,q,d),s.memoizedState=qf,s=Oo(null,_));else if(La(s),er(te)){if(q=te.nextSibling&&te.nextSibling.dataset,q)var Xe=q.dgst;q=Xe,_=Error(S(419)),_.stack="",_.digest=q,Ys({value:_,source:null,stack:null}),s=Hf(r,s,d)}else if(yr||ga(r,s,d,!1),q=(d&r.childLanes)!==0,yr||q){if(q=yi,q!==null&&(_=Us(q,d),_!==0&&_!==Ee.retryLane))throw Ee.retryLane=_,Da(r,_),qa(q,r,_),Ff;ia(te)||Ld(),s=Hf(r,s,d)}else ia(te)?(s.flags|=192,s.child=r.child,s=null):(r=Ee.treeContext,Xn=ls(te.nextSibling),pr=s,vn=!0,Xs=null,ma=!1,r!==null&&ud(s,r),s=sm(s,_.children),s.flags|=4096);return s}return M?(Ni(),te=_.fallback,M=s.mode,Ee=r.child,Xe=Ee.sibling,_=pa(Ee,{mode:"hidden",children:_.children}),_.subtreeFlags=Ee.subtreeFlags&65011712,Xe!==null?te=pa(Xe,te):(te=Mo(te,M,d,null),te.flags|=2),te.return=s,_.return=s,_.sibling=te,s.child=_,Oo(null,_),_=s.child,te=r.child.memoizedState,te===null?te=_d(d):(M=te.cachePool,M!==null?(Ee=Bi._currentValue,M=M.parent!==Ee?{parent:Ee,pool:Ee}:M):M=Of(),te={baseLanes:te.baseLanes|d,cachePool:M}),_.memoizedState=te,_.childLanes=Gf(r,q,d),s.memoizedState=qf,Oo(r.child,_)):(La(s),d=r.child,r=d.sibling,d=pa(d,{mode:"visible",children:_.children}),d.return=s,d.sibling=null,r!==null&&(q=s.deletions,q===null?(s.deletions=[r],s.flags|=16):q.push(r)),s.child=d,s.memoizedState=null,d)}function sm(r,s){return s=Zf({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Zf(r,s){return r=fa(22,r,null,s),r.lanes=0,r}function Hf(r,s,d){return Ps(s,r.child,null,d),r=sm(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function om(r,s,d){r.lanes|=s;var _=r.alternate;_!==null&&(_.lanes|=s),sh(r.return,s,d)}function lm(r,s,d,_,M,D){var q=r.memoizedState;q===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:_,tail:d,tailMode:M,treeForkCount:D}:(q.isBackwards=s,q.rendering=null,q.renderingStartTime=0,q.last=_,q.tail=d,q.tailMode=M,q.treeForkCount=D)}function $f(r,s,d){var _=s.pendingProps,M=_.revealOrder,D=_.tail;_=_.children;var q=Ai.current,te=(q&2)!==0;if(te?(q=q&1|2,s.flags|=128):q&=1,wt(Ai,q),Mr(r,s,_,d),_=vn?Po:0,!te&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&om(r,d,s);else if(r.tag===19)om(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(M){case"forwards":for(d=s.child,M=null;d!==null;)r=d.alternate,r!==null&&pu(r)===null&&(M=d),d=d.sibling;d=M,d===null?(M=s.child,s.child=null):(M=d.sibling,d.sibling=null),lm(s,!1,M,d,D,_);break;case"backwards":case"unstable_legacy-backwards":for(d=null,M=s.child,s.child=null;M!==null;){if(r=M.alternate,r!==null&&pu(r)===null){s.child=M;break}r=M.sibling,M.sibling=d,d=M,M=r}lm(s,!0,d,null,D,_);break;case"together":lm(s,!1,null,null,void 0,_);break;default:s.memoizedState=null}return s.child}function Bo(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),El|=s.lanes,(d&s.childLanes)===0)if(r!==null){if(ga(r,s,d,!1),(d&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(S(153));if(s.child!==null){for(r=s.child,d=pa(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=pa(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function vd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&nc(r)))}function xd(r,s,d){switch(s.tag){case 3:ln(s,s.stateNode.containerInfo),Ks(s,Bi,r.memoizedState.cache),Ts();break;case 27:case 5:Dn(s);break;case 4:ln(s,s.stateNode.containerInfo);break;case 10:Ks(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,sc(s),null;break;case 13:var _=s.memoizedState;if(_!==null)return _.dehydrated!==null?(La(s),s.flags|=128,null):(d&s.child.childLanes)!==0?am(r,s,d):(La(s),r=Bo(r,s,d),r!==null?r.sibling:null);La(s);break;case 19:var M=(r.flags&128)!==0;if(_=(d&s.childLanes)!==0,_||(ga(r,s,d,!1),_=(d&s.childLanes)!==0),M){if(_)return $f(r,s,d);s.flags|=128}if(M=s.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),wt(Ai,Ai.current),_)break;return null;case 22:return s.lanes=0,im(r,s,d,s.pendingProps);case 24:Ks(s,Bi,r.memoizedState.cache)}return Bo(r,s,d)}function na(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps)yr=!0;else{if(!vd(r,d)&&(s.flags&128)===0)return yr=!1,xd(r,s,d);yr=(r.flags&131072)!==0}else yr=!1,vn&&(s.flags&1048576)!==0&&cd(s,Po,s.index);switch(s.lanes=0,s.tag){case 16:e:{var _=s.pendingProps;if(r=ka(s.elementType),s.type=r,typeof r=="function")ih(r)?(_=Lo(r,_),s.tag=1,s=_g(null,s,r,_,d)):(s.tag=0,s=rm(null,s,r,_,d));else{if(r!=null){var M=r.$$typeof;if(M===Ct){s.tag=11,s=mg(null,s,r,_,d);break e}else if(M===st){s.tag=14,s=jf(null,s,r,_,d);break e}}throw s=$t(r)||r,Error(S(306,s,""))}}return s;case 0:return rm(r,s,s.type,s.pendingProps,d);case 1:return _=s.type,M=Lo(_,s.pendingProps),_g(r,s,_,M,d);case 3:e:{if(ln(s,s.stateNode.containerInfo),r===null)throw Error(S(387));_=s.pendingProps;var D=s.memoizedState;M=D.element,uu(r,s),Io(s,_,null,d);var q=s.memoizedState;if(_=q.cache,Ks(s,Bi,_),_!==D.cache&&oh(s,[Bi],d,!0),eo(),_=q.element,D.isDehydrated)if(D={element:_,isDehydrated:!1,cache:q.cache},s.updateQueue.baseState=D,s.memoizedState=D,s.flags&256){s=vg(r,s,_,d);break e}else if(_!==M){M=Gr(Error(S(424)),s),Ys(M),s=vg(r,s,_,d);break e}else for(r=s.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Xn=ls(r.firstChild),pr=s,vn=!0,Xs=null,ma=!0,d=fd(s,null,_,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ts(),_===M){s=Bo(r,s,d);break e}Mr(r,s,_,d)}s=s.child}return s;case 26:return Vf(r,s),r===null?(d=Vm(s.type,null,s.pendingProps,null))?s.memoizedState=d:vn||(d=s.type,r=s.pendingProps,_=Ud(Zt.current).createElement(d),_[_t]=s,_[Fe]=r,Cr(_,d,r),Si(_),s.stateNode=_):s.memoizedState=Vm(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return Dn(s),r===null&&vn&&(_=s.stateNode=Jg(s.type,s.pendingProps,Zt.current),pr=s,ma=!0,M=Xn,vc(s.type)?(Ta=M,Xn=ls(_.firstChild)):Xn=M),Mr(r,s,s.pendingProps.children,d),Vf(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&vn&&((M=_=Xn)&&(_=kr(_,s.type,s.pendingProps,ma),_!==null?(s.stateNode=_,pr=s,Xn=ls(_.firstChild),ma=!1,M=!0):M=!1),M||Kr(s)),Dn(s),M=s.type,D=s.pendingProps,q=r!==null?r.memoizedProps:null,_=D.children,xp(M,D)?_=null:q!==null&&xp(M,q)&&(s.flags|=32),s.memoizedState!==null&&(M=oc(r,s,gu,null,null,d),Bh._currentValue=M),Vf(r,s),Mr(r,s,_,d),s.child;case 6:return r===null&&vn&&((r=d=Xn)&&(d=uo(d,s.pendingProps,ma),d!==null?(s.stateNode=d,pr=s,Xn=null,r=!0):r=!1),r||Kr(s)),null;case 13:return am(r,s,d);case 4:return ln(s,s.stateNode.containerInfo),_=s.pendingProps,r===null?s.child=Ps(s,null,_,d):Mr(r,s,_,d),s.child;case 11:return mg(r,s,s.type,s.pendingProps,d);case 7:return Mr(r,s,s.pendingProps,d),s.child;case 8:return Mr(r,s,s.pendingProps.children,d),s.child;case 12:return Mr(r,s,s.pendingProps.children,d),s.child;case 10:return _=s.pendingProps,Ks(s,s.type,_.value),Mr(r,s,_.children,d),s.child;case 9:return M=s.type._context,_=s.pendingProps.children,Qs(s),M=Gi(M),_=_(M),s.flags|=1,Mr(r,s,_,d),s.child;case 14:return jf(r,s,s.type,s.pendingProps,d);case 15:return nm(r,s,s.type,s.pendingProps,d);case 19:return $f(r,s,d);case 31:return Uf(r,s,d);case 22:return im(r,s,d,s.pendingProps);case 24:return Qs(s),_=Gi(Bi),r===null?(M=ch(),M===null&&(M=yi,D=As(),M.pooledCache=D,D.refCount++,D!==null&&(M.pooledCacheLanes|=d),M=D),s.memoizedState={parent:_,cache:M},ph(s),Ks(s,Bi,M)):((r.lanes&d)!==0&&(uu(r,s),Io(s,null,null,d),eo()),M=r.memoizedState,D=s.memoizedState,M.parent!==_?(M={parent:_,cache:_},s.memoizedState=M,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=M),Ks(s,Bi,_)):(_=D.cache,Ks(s,Bi,_),_!==M.cache&&oh(s,[Bi],d,!0))),Mr(r,s,s.pendingProps.children,d),s.child;case 29:throw s.pendingProps}throw Error(S(156,s.tag))}function No(r){r.flags|=4}function bd(r,s,d,_,M){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(M&335544128)===M)if(r.stateNode.complete)r.flags|=8192;else if(xm())r.flags|=8192;else throw Ja=Ot,Do}else r.flags&=-16777217}function xg(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Zd(s))if(xm())r.flags|=8192;else throw Ja=Ot,Do}function wd(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?kn():536870912,r.lanes|=s,Eu|=s)}function Td(r,s){if(!vn)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:_.sibling=null}}function Pi(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,_=0;if(s)for(var M=r.child;M!==null;)d|=M.lanes|M.childLanes,_|=M.subtreeFlags&65011712,_|=M.flags&65011712,M.return=r,M=M.sibling;else for(M=r.child;M!==null;)d|=M.lanes|M.childLanes,_|=M.subtreeFlags,_|=M.flags,M.return=r,M=M.sibling;return r.subtreeFlags|=_,r.childLanes=d,s}function bg(r,s,d){var _=s.pendingProps;switch(tc(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pi(s),null;case 1:return Pi(s),null;case 3:return d=s.stateNode,_=null,r!==null&&(_=r.memoizedState.cache),s.memoizedState.cache!==_&&(s.flags|=2048),Ms(Bi),Qt(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(ws(s)?No(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Ss())),Pi(s),null;case 26:var M=s.type,D=s.memoizedState;return r===null?(No(s),D!==null?(Pi(s),xg(s,D)):(Pi(s),bd(s,M,null,_,d))):D?D!==r.memoizedState?(No(s),Pi(s),xg(s,D)):(Pi(s),s.flags&=-16777217):(r=r.memoizedProps,r!==_&&No(s),Pi(s),bd(s,M,r,_,d)),null;case 27:if(ai(s),d=Zt.current,M=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&No(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return Pi(s),null}r=Mt.current,ws(s)?Qr(s):(r=Jg(M,_,d),s.stateNode=r,No(s))}return Pi(s),null;case 5:if(ai(s),M=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&No(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return Pi(s),null}if(D=Mt.current,ws(s))Qr(s);else{var q=Ud(Zt.current);switch(D){case 1:D=q.createElementNS("http://www.w3.org/2000/svg",M);break;case 2:D=q.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;default:switch(M){case"svg":D=q.createElementNS("http://www.w3.org/2000/svg",M);break;case"math":D=q.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;case"script":D=q.createElement("div"),D.innerHTML="<script><\/script>",D=D.removeChild(D.firstChild);break;case"select":D=typeof _.is=="string"?q.createElement("select",{is:_.is}):q.createElement("select"),_.multiple?D.multiple=!0:_.size&&(D.size=_.size);break;default:D=typeof _.is=="string"?q.createElement(M,{is:_.is}):q.createElement(M)}}D[_t]=s,D[Fe]=_;e:for(q=s.child;q!==null;){if(q.tag===5||q.tag===6)D.appendChild(q.stateNode);else if(q.tag!==4&&q.tag!==27&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===s)break e;for(;q.sibling===null;){if(q.return===null||q.return===s)break e;q=q.return}q.sibling.return=q.return,q=q.sibling}s.stateNode=D;e:switch(Cr(D,M,_),M){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}_&&No(s)}}return Pi(s),bd(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,d),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==_&&No(s);else{if(typeof _!="string"&&s.stateNode===null)throw Error(S(166));if(r=Zt.current,ws(s)){if(r=s.stateNode,d=s.memoizedProps,_=null,M=pr,M!==null)switch(M.tag){case 27:case 5:_=M.memoizedProps}r[_t]=s,r=!!(r.nodeValue===d||_!==null&&_.suppressHydrationWarning===!0||Im(r.nodeValue,d)),r||Kr(s,!0)}else r=Ud(r).createTextNode(_),r[_t]=s,s.stateNode=r}return Pi(s),null;case 31:if(d=s.memoizedState,r===null||r.memoizedState!==null){if(_=ws(s),d!==null){if(r===null){if(!_)throw Error(S(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(557));r[_t]=s}else Ts(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Pi(s),r=!1}else d=Ss(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return s.flags&256?(xi(s),s):(xi(s),null);if((s.flags&128)!==0)throw Error(S(558))}return Pi(s),null;case 13:if(_=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(M=ws(s),_!==null&&_.dehydrated!==null){if(r===null){if(!M)throw Error(S(318));if(M=s.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(S(317));M[_t]=s}else Ts(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Pi(s),M=!1}else M=Ss(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=M),M=!0;if(!M)return s.flags&256?(xi(s),s):(xi(s),null)}return xi(s),(s.flags&128)!==0?(s.lanes=d,s):(d=_!==null,r=r!==null&&r.memoizedState!==null,d&&(_=s.child,M=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(M=_.alternate.memoizedState.cachePool.pool),D=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(D=_.memoizedState.cachePool.pool),D!==M&&(_.flags|=2048)),d!==r&&d&&(s.child.flags|=8192),wd(s,s.updateQueue),Pi(s),null);case 4:return Qt(),r===null&&Pm(s.stateNode.containerInfo),Pi(s),null;case 10:return Ms(s.type),Pi(s),null;case 19:if(Ye(Ai),_=s.memoizedState,_===null)return Pi(s),null;if(M=(s.flags&128)!==0,D=_.rendering,D===null)if(M)Td(_,!1);else{if(Hi!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(D=pu(r),D!==null){for(s.flags|=128,Td(_,!1),r=D.updateQueue,s.updateQueue=r,wd(s,r),s.subtreeFlags=0,r=d,d=s.child;d!==null;)Rf(d,r),d=d.sibling;return wt(Ai,Ai.current&1|2),vn&&$s(s,_.treeForkCount),s.child}r=r.sibling}_.tail!==null&&Li()>Id&&(s.flags|=128,M=!0,Td(_,!1),s.lanes=4194304)}else{if(!M)if(r=pu(D),r!==null){if(s.flags|=128,M=!0,r=r.updateQueue,s.updateQueue=r,wd(s,r),Td(_,!0),_.tail===null&&_.tailMode==="hidden"&&!D.alternate&&!vn)return Pi(s),null}else 2*Li()-_.renderingStartTime>Id&&d!==536870912&&(s.flags|=128,M=!0,Td(_,!1),s.lanes=4194304);_.isBackwards?(D.sibling=s.child,s.child=D):(r=_.last,r!==null?r.sibling=D:s.child=D,_.last=D)}return _.tail!==null?(r=_.tail,_.rendering=r,_.tail=r.sibling,_.renderingStartTime=Li(),r.sibling=null,d=Ai.current,wt(Ai,M?d&1|2:d&1),vn&&$s(s,_.treeForkCount),r):(Pi(s),null);case 22:case 23:return xi(s),fl(),_=s.memoizedState!==null,r!==null?r.memoizedState!==null!==_&&(s.flags|=8192):_&&(s.flags|=8192),_?(d&536870912)!==0&&(s.flags&128)===0&&(Pi(s),s.subtreeFlags&6&&(s.flags|=8192)):Pi(s),d=s.updateQueue,d!==null&&wd(s,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),_=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),_!==d&&(s.flags|=2048),r!==null&&Ye(Ka),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Ms(Bi),Pi(s),null;case 25:return null;case 30:return null}throw Error(S(156,s.tag))}function Jy(r,s){switch(tc(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Ms(Bi),Qt(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return ai(s),null;case 31:if(s.memoizedState!==null){if(xi(s),s.alternate===null)throw Error(S(340));Ts()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(xi(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(S(340));Ts()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Ye(Ai),null;case 4:return Qt(),null;case 10:return Ms(s.type),null;case 22:case 23:return xi(s),fl(),r!==null&&Ye(Ka),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Ms(Bi),null;case 25:return null;default:return null}}function Xf(r,s){switch(tc(s),s.tag){case 3:Ms(Bi),Qt();break;case 26:case 27:case 5:ai(s);break;case 4:Qt();break;case 31:s.memoizedState!==null&&xi(s);break;case 13:xi(s);break;case 19:Ye(Ai);break;case 10:Ms(s.type);break;case 22:case 23:xi(s),fl(),r!==null&&Ye(Ka);break;case 24:Ms(Bi)}}function xh(r,s){try{var d=s.updateQueue,_=d!==null?d.lastEffect:null;if(_!==null){var M=_.next;d=M;do{if((d.tag&r)===r){_=void 0;var D=d.create,q=d.inst;_=D(),q.destroy=_}d=d.next}while(d!==M)}}catch(te){Qn(s,s.return,te)}}function xl(r,s,d){try{var _=s.updateQueue,M=_!==null?_.lastEffect:null;if(M!==null){var D=M.next;_=D;do{if((_.tag&r)===r){var q=_.inst,te=q.destroy;if(te!==void 0){q.destroy=void 0,M=s;var Ee=d,Xe=te;try{Xe()}catch(dt){Qn(M,Ee,dt)}}}_=_.next}while(_!==D)}}catch(dt){Qn(s,s.return,dt)}}function wg(r){var s=r.updateQueue;if(s!==null){var d=r.stateNode;try{mh(s,d)}catch(_){Qn(r,r.return,_)}}}function Tg(r,s,d){d.props=Lo(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(_){Qn(r,s,_)}}function Sd(r,s){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var _=r.stateNode;break;case 30:_=r.stateNode;break;default:_=r.stateNode}typeof d=="function"?r.refCleanup=d(_):d.current=_}}catch(M){Qn(r,s,M)}}function ss(r,s){var d=r.ref,_=r.refCleanup;if(d!==null)if(typeof _=="function")try{_()}catch(M){Qn(r,s,M)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(M){Qn(r,s,M)}else d.current=null}function Yf(r){var s=r.type,d=r.memoizedProps,_=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":d.autoFocus&&_.focus();break e;case"img":d.src?_.src=d.src:d.srcSet&&(_.srcset=d.srcSet)}}catch(M){Qn(r,r.return,M)}}function Wf(r,s,d){try{var _=r.stateNode;Kg(_,r.type,d,s),_[Fe]=s}catch(M){Qn(r,r.return,M)}}function hc(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&vc(r.type)||r.tag===4}function bu(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||hc(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&vc(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function cm(r,s,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,s):(s=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,s.appendChild(r),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=Ya));else if(_!==4&&(_===27&&vc(r.type)&&(d=r.stateNode,s=null),r=r.child,r!==null))for(cm(r,s,d),r=r.sibling;r!==null;)cm(r,s,d),r=r.sibling}function Kf(r,s,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(_!==4&&(_===27&&vc(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(Kf(r,s,d),r=r.sibling;r!==null;)Kf(r,s,d),r=r.sibling}function Sg(r){var s=r.stateNode,d=r.memoizedProps;try{for(var _=r.type,M=s.attributes;M.length;)s.removeAttributeNode(M[0]);Cr(s,_,d),s[_t]=r,s[Fe]=d}catch(D){Qn(r,r.return,D)}}var bl=!1,_r=!1,um=!1,Eg=typeof WeakSet=="function"?WeakSet:Set,vr=null;function e_(r,s){if(r=r.containerInfo,jd=Wd,r=Ku(r),Kc(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var _=d.getSelection&&d.getSelection();if(_&&_.rangeCount!==0){d=_.anchorNode;var M=_.anchorOffset,D=_.focusNode;_=_.focusOffset;try{d.nodeType,D.nodeType}catch{d=null;break e}var q=0,te=-1,Ee=-1,Xe=0,dt=0,xt=r,We=null;t:for(;;){for(var nt;xt!==d||M!==0&&xt.nodeType!==3||(te=q+M),xt!==D||_!==0&&xt.nodeType!==3||(Ee=q+_),xt.nodeType===3&&(q+=xt.nodeValue.length),(nt=xt.firstChild)!==null;)We=xt,xt=nt;for(;;){if(xt===r)break t;if(We===d&&++Xe===M&&(te=q),We===D&&++dt===_&&(Ee=q),(nt=xt.nextSibling)!==null)break;xt=We,We=xt.parentNode}xt=nt}d=te===-1||Ee===-1?null:{start:te,end:Ee}}else d=null}d=d||{start:0,end:0}}else d=null;for(km={focusedElem:r,selectionRange:d},Wd=!1,vr=s;vr!==null;)if(s=vr,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,vr=r;else for(;vr!==null;){switch(s=vr,D=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)M=r[d],M.ref.impl=M.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&D!==null){r=void 0,d=s,M=D.memoizedProps,D=D.memoizedState,_=d.stateNode;try{var Yt=Lo(d.type,M);r=_.getSnapshotBeforeUpdate(Yt,D),_.__reactInternalSnapshotBeforeUpdate=r}catch(an){Qn(d,d.return,an)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,d=r.nodeType,d===9)co(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":co(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(S(163))}if(r=s.sibling,r!==null){r.return=s.return,vr=r;break}vr=s.return}}function hm(r,s,d){var _=d.flags;switch(d.tag){case 0:case 11:case 15:ja(r,d),_&4&&xh(5,d);break;case 1:if(ja(r,d),_&4)if(r=d.stateNode,s===null)try{r.componentDidMount()}catch(q){Qn(d,d.return,q)}else{var M=Lo(d.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(M,s,r.__reactInternalSnapshotBeforeUpdate)}catch(q){Qn(d,d.return,q)}}_&64&&wg(d),_&512&&Sd(d,d.return);break;case 3:if(ja(r,d),_&64&&(r=d.updateQueue,r!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{mh(r,s)}catch(q){Qn(d,d.return,q)}}break;case 27:s===null&&_&4&&Sg(d);case 26:case 5:ja(r,d),s===null&&_&4&&Yf(d),_&512&&Sd(d,d.return);break;case 12:ja(r,d);break;case 31:ja(r,d),_&4&&Ed(r,d);break;case 13:ja(r,d),_&4&&Md(r,d),_&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=wm.bind(null,d),br(r,d))));break;case 22:if(_=d.memoizedState!==null||bl,!_){s=s!==null&&s.memoizedState!==null||_r,M=bl;var D=_r;bl=_,(_r=s)&&!D?wl(r,d,(d.subtreeFlags&8772)!==0):ja(r,d),bl=M,_r=D}break;case 30:break;default:ja(r,d)}}function bh(r){var s=r.alternate;s!==null&&(r.alternate=null,bh(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&$o(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Fi=null,zn=!1;function Fa(r,s,d){for(d=d.child;d!==null;)dm(r,s,d),d=d.sibling}function dm(r,s,d){if(Se&&typeof Se.onCommitFiberUnmount=="function")try{Se.onCommitFiberUnmount(ze,d)}catch{}switch(d.tag){case 26:_r||ss(d,s),Fa(r,s,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:_r||ss(d,s);var _=Fi,M=zn;vc(d.type)&&(Fi=d.stateNode,zn=!1),Fa(r,s,d),Rh(d.stateNode),Fi=_,zn=M;break;case 5:_r||ss(d,s);case 6:if(_=Fi,M=zn,Fi=null,Fa(r,s,d),Fi=_,zn=M,Fi!==null)if(zn)try{(Fi.nodeType===9?Fi.body:Fi.nodeName==="HTML"?Fi.ownerDocument.body:Fi).removeChild(d.stateNode)}catch(D){Qn(d,s,D)}else try{Fi.removeChild(d.stateNode)}catch(D){Qn(d,s,D)}break;case 18:Fi!==null&&(zn?(r=Fi,Qg(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),Ec(r)):Qg(Fi,d.stateNode));break;case 4:_=Fi,M=zn,Fi=d.stateNode.containerInfo,zn=!0,Fa(r,s,d),Fi=_,zn=M;break;case 0:case 11:case 14:case 15:xl(2,d,s),_r||xl(4,d,s),Fa(r,s,d);break;case 1:_r||(ss(d,s),_=d.stateNode,typeof _.componentWillUnmount=="function"&&Tg(d,s,_)),Fa(r,s,d);break;case 21:Fa(r,s,d);break;case 22:_r=(_=_r)||d.memoizedState!==null,Fa(r,s,d),_r=_;break;default:Fa(r,s,d)}}function Ed(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Ec(r)}catch(d){Qn(s,s.return,d)}}}function Md(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Ec(r)}catch(d){Qn(s,s.return,d)}}function Ad(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Eg),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Eg),s;default:throw Error(S(435,r.tag))}}function Cd(r,s){var d=Ad(r);s.forEach(function(_){if(!d.has(_)){d.add(_);var M=i_.bind(null,r,_);_.then(M,M)}})}function xa(r,s){var d=s.deletions;if(d!==null)for(var _=0;_<d.length;_++){var M=d[_],D=r,q=s,te=q;e:for(;te!==null;){switch(te.tag){case 27:if(vc(te.type)){Fi=te.stateNode,zn=!1;break e}break;case 5:Fi=te.stateNode,zn=!1;break e;case 3:case 4:Fi=te.stateNode.containerInfo,zn=!0;break e}te=te.return}if(Fi===null)throw Error(S(160));dm(D,q,M),Fi=null,zn=!1,D=M.alternate,D!==null&&(D.return=null),M.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Qf(s,r),s=s.sibling}var ba=null;function Qf(r,s){var d=r.alternate,_=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:xa(s,r),Ar(r),_&4&&(xl(3,r,r.return),xh(3,r),xl(5,r,r.return));break;case 1:xa(s,r),Ar(r),_&512&&(_r||d===null||ss(d,d.return)),_&64&&bl&&(r=r.updateQueue,r!==null&&(_=r.callbacks,_!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?_:d.concat(_))));break;case 26:var M=ba;if(xa(s,r),Ar(r),_&512&&(_r||d===null||ss(d,d.return)),_&4){var D=d!==null?d.memoizedState:null;if(_=r.memoizedState,d===null)if(_===null)if(r.stateNode===null){e:{_=r.type,d=r.memoizedProps,M=M.ownerDocument||M;t:switch(_){case"title":D=M.getElementsByTagName("title")[0],(!D||D[en]||D[_t]||D.namespaceURI==="http://www.w3.org/2000/svg"||D.hasAttribute("itemprop"))&&(D=M.createElement(_),M.head.insertBefore(D,M.querySelector("head > title"))),Cr(D,_,d),D[_t]=r,Si(D),_=D;break e;case"link":var q=Hm("link","href",M).get(_+(d.href||""));if(q){for(var te=0;te<q.length;te++)if(D=q[te],D.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&D.getAttribute("rel")===(d.rel==null?null:d.rel)&&D.getAttribute("title")===(d.title==null?null:d.title)&&D.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){q.splice(te,1);break t}}D=M.createElement(_),Cr(D,_,d),M.head.appendChild(D);break;case"meta":if(q=Hm("meta","content",M).get(_+(d.content||""))){for(te=0;te<q.length;te++)if(D=q[te],D.getAttribute("content")===(d.content==null?null:""+d.content)&&D.getAttribute("name")===(d.name==null?null:d.name)&&D.getAttribute("property")===(d.property==null?null:d.property)&&D.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&D.getAttribute("charset")===(d.charSet==null?null:d.charSet)){q.splice(te,1);break t}}D=M.createElement(_),Cr(D,_,d),M.head.appendChild(D);break;default:throw Error(S(468,_))}D[_t]=r,Si(D),_=D}r.stateNode=_}else Gd(M,r.type,r.stateNode);else r.stateNode=Zm(M,_,r.memoizedProps);else D!==_?(D===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):D.count--,_===null?Gd(M,r.type,r.stateNode):Zm(M,_,r.memoizedProps)):_===null&&r.stateNode!==null&&Wf(r,r.memoizedProps,d.memoizedProps)}break;case 27:xa(s,r),Ar(r),_&512&&(_r||d===null||ss(d,d.return)),d!==null&&_&4&&Wf(r,r.memoizedProps,d.memoizedProps);break;case 5:if(xa(s,r),Ar(r),_&512&&(_r||d===null||ss(d,d.return)),r.flags&32){M=r.stateNode;try{Zs(M,"")}catch(Yt){Qn(r,r.return,Yt)}}_&4&&r.stateNode!=null&&(M=r.memoizedProps,Wf(r,M,d!==null?d.memoizedProps:M)),_&1024&&(um=!0);break;case 6:if(xa(s,r),Ar(r),_&4){if(r.stateNode===null)throw Error(S(162));_=r.memoizedProps,d=r.stateNode;try{d.nodeValue=_}catch(Yt){Qn(r,r.return,Yt)}}break;case 3:if(Mp=null,M=ba,ba=Tp(s.containerInfo),xa(s,r),ba=M,Ar(r),_&4&&d!==null&&d.memoizedState.isDehydrated)try{Ec(s.containerInfo)}catch(Yt){Qn(r,r.return,Yt)}um&&(um=!1,zd(r));break;case 4:_=ba,ba=Tp(r.stateNode.containerInfo),xa(s,r),Ar(r),ba=_;break;case 12:xa(s,r),Ar(r);break;case 31:xa(s,r),Ar(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 13:xa(s,r),Ar(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(tp=Li()),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 22:M=r.memoizedState!==null;var Ee=d!==null&&d.memoizedState!==null,Xe=bl,dt=_r;if(bl=Xe||M,_r=dt||Ee,xa(s,r),_r=dt,bl=Xe,Ar(r),_&8192)e:for(s=r.stateNode,s._visibility=M?s._visibility&-2:s._visibility|1,M&&(d===null||Ee||bl||_r||so(r)),d=null,s=r;;){if(s.tag===5||s.tag===26){if(d===null){Ee=d=s;try{if(D=Ee.stateNode,M)q=D.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{te=Ee.stateNode;var xt=Ee.memoizedProps.style,We=xt!=null&&xt.hasOwnProperty("display")?xt.display:null;te.style.display=We==null||typeof We=="boolean"?"":(""+We).trim()}}catch(Yt){Qn(Ee,Ee.return,Yt)}}}else if(s.tag===6){if(d===null){Ee=s;try{Ee.stateNode.nodeValue=M?"":Ee.memoizedProps}catch(Yt){Qn(Ee,Ee.return,Yt)}}}else if(s.tag===18){if(d===null){Ee=s;try{var nt=Ee.stateNode;M?mn(nt,!0):mn(Ee.stateNode,!1)}catch(Yt){Qn(Ee,Ee.return,Yt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;d===s&&(d=null),s=s.return}d===s&&(d=null),s.sibling.return=s.return,s=s.sibling}_&4&&(_=r.updateQueue,_!==null&&(d=_.retryQueue,d!==null&&(_.retryQueue=null,Cd(r,d))));break;case 19:xa(s,r),Ar(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 30:break;case 21:break;default:xa(s,r),Ar(r)}}function Ar(r){var s=r.flags;if(s&2){try{for(var d,_=r.return;_!==null;){if(hc(_)){d=_;break}_=_.return}if(d==null)throw Error(S(160));switch(d.tag){case 27:var M=d.stateNode,D=bu(r);Kf(r,D,M);break;case 5:var q=d.stateNode;d.flags&32&&(Zs(q,""),d.flags&=-33);var te=bu(r);Kf(r,te,q);break;case 3:case 4:var Ee=d.stateNode.containerInfo,Xe=bu(r);cm(r,Xe,Ee);break;default:throw Error(S(161))}}catch(dt){Qn(r,r.return,dt)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function zd(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;zd(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function ja(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)hm(r,s.alternate,s),s=s.sibling}function so(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:xl(4,s,s.return),so(s);break;case 1:ss(s,s.return);var d=s.stateNode;typeof d.componentWillUnmount=="function"&&Tg(s,s.return,d),so(s);break;case 27:Rh(s.stateNode);case 26:case 5:ss(s,s.return),so(s);break;case 22:s.memoizedState===null&&so(s);break;case 30:so(s);break;default:so(s)}r=r.sibling}}function wl(r,s,d){for(d=d&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var _=s.alternate,M=r,D=s,q=D.flags;switch(D.tag){case 0:case 11:case 15:wl(M,D,d),xh(4,D);break;case 1:if(wl(M,D,d),_=D,M=_.stateNode,typeof M.componentDidMount=="function")try{M.componentDidMount()}catch(Xe){Qn(_,_.return,Xe)}if(_=D,M=_.updateQueue,M!==null){var te=_.stateNode;try{var Ee=M.shared.hiddenCallbacks;if(Ee!==null)for(M.shared.hiddenCallbacks=null,M=0;M<Ee.length;M++)hu(Ee[M],te)}catch(Xe){Qn(_,_.return,Xe)}}d&&q&64&&wg(D),Sd(D,D.return);break;case 27:Sg(D);case 26:case 5:wl(M,D,d),d&&_===null&&q&4&&Yf(D),Sd(D,D.return);break;case 12:wl(M,D,d);break;case 31:wl(M,D,d),d&&q&4&&Ed(M,D);break;case 13:wl(M,D,d),d&&q&4&&Md(M,D);break;case 22:D.memoizedState===null&&wl(M,D,d),Sd(D,D.return);break;case 30:break;default:wl(M,D,d)}s=s.sibling}}function Jf(r,s){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&ic(d))}function Tl(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&ic(r))}function oo(r,s,d,_){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)fm(r,s,d,_),s=s.sibling}function fm(r,s,d,_){var M=s.flags;switch(s.tag){case 0:case 11:case 15:oo(r,s,d,_),M&2048&&xh(9,s);break;case 1:oo(r,s,d,_);break;case 3:oo(r,s,d,_),M&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&ic(r)));break;case 12:if(M&2048){oo(r,s,d,_),r=s.stateNode;try{var D=s.memoizedProps,q=D.id,te=D.onPostCommit;typeof te=="function"&&te(q,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(Ee){Qn(s,s.return,Ee)}}else oo(r,s,d,_);break;case 31:oo(r,s,d,_);break;case 13:oo(r,s,d,_);break;case 23:break;case 22:D=s.stateNode,q=s.alternate,s.memoizedState!==null?D._visibility&2?oo(r,s,d,_):wu(r,s):D._visibility&2?oo(r,s,d,_):(D._visibility|=2,Fo(r,s,d,_,(s.subtreeFlags&10256)!==0||!1)),M&2048&&Jf(q,s);break;case 24:oo(r,s,d,_),M&2048&&Tl(s.alternate,s);break;default:oo(r,s,d,_)}}function Fo(r,s,d,_,M){for(M=M&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var D=r,q=s,te=d,Ee=_,Xe=q.flags;switch(q.tag){case 0:case 11:case 15:Fo(D,q,te,Ee,M),xh(8,q);break;case 23:break;case 22:var dt=q.stateNode;q.memoizedState!==null?dt._visibility&2?Fo(D,q,te,Ee,M):wu(D,q):(dt._visibility|=2,Fo(D,q,te,Ee,M)),M&&Xe&2048&&Jf(q.alternate,q);break;case 24:Fo(D,q,te,Ee,M),M&&Xe&2048&&Tl(q.alternate,q);break;default:Fo(D,q,te,Ee,M)}s=s.sibling}}function wu(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var d=r,_=s,M=_.flags;switch(_.tag){case 22:wu(d,_),M&2048&&Jf(_.alternate,_);break;case 24:wu(d,_),M&2048&&Tl(_.alternate,_);break;default:wu(d,_)}s=s.sibling}}var wh=8192;function Tu(r,s,d){if(r.subtreeFlags&wh)for(r=r.child;r!==null;)Mg(r,s,d),r=r.sibling}function Mg(r,s,d){switch(r.tag){case 26:Tu(r,s,d),r.flags&wh&&r.memoizedState!==null&&$m(d,ba,r.memoizedState,r.memoizedProps);break;case 5:Tu(r,s,d);break;case 3:case 4:var _=ba;ba=Tp(r.stateNode.containerInfo),Tu(r,s,d),ba=_;break;case 22:r.memoizedState===null&&(_=r.alternate,_!==null&&_.memoizedState!==null?(_=wh,wh=16777216,Tu(r,s,d),wh=_):Tu(r,s,d));break;default:Tu(r,s,d)}}function Ag(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function Pd(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var _=s[d];vr=_,Th(_,r)}Ag(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Cg(r),r=r.sibling}function Cg(r){switch(r.tag){case 0:case 11:case 15:Pd(r),r.flags&2048&&xl(9,r,r.return);break;case 3:Pd(r);break;case 12:Pd(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,ep(r)):Pd(r);break;default:Pd(r)}}function ep(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var _=s[d];vr=_,Th(_,r)}Ag(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:xl(8,s,s.return),ep(s);break;case 22:d=s.stateNode,d._visibility&2&&(d._visibility&=-3,ep(s));break;default:ep(s)}r=r.sibling}}function Th(r,s){for(;vr!==null;){var d=vr;switch(d.tag){case 0:case 11:case 15:xl(8,d,s);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var _=d.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:ic(d.memoizedState.cache)}if(_=d.child,_!==null)_.return=d,vr=_;else e:for(d=r;vr!==null;){_=vr;var M=_.sibling,D=_.return;if(bh(_),_===d){vr=null;break e}if(M!==null){M.return=D,vr=M;break e}vr=D}}}var t_={getCacheForType:function(r){var s=Gi(Bi),d=s.data.get(r);return d===void 0&&(d=r(),s.data.set(r,d)),d},cacheSignal:function(){return Gi(Bi).controller.signal}},zg=typeof WeakMap=="function"?WeakMap:Map,Kn=0,yi=null,Tn=null,Sn=0,ii=0,wa=null,Os=!1,dc=!1,pm=!1,Sl=0,Hi=0,El=0,Su=0,mm=0,Zr=0,Eu=0,Dd=null,Ua=null,gm=!1,tp=0,Pg=0,Id=1/0,Sh=null,Ml=null,xr=0,Al=null,Eh=null,Bs=0,ym=0,np=null,Dg=null,kd=0,_m=null;function Va(){return(Kn&2)!==0&&Sn!==0?Sn&-Sn:we.T!==null?Am():hr()}function Ig(){if(Zr===0)if((Sn&536870912)===0||vn){var r=yn;yn<<=1,(yn&3932160)===0&&(yn=262144),Zr=r}else Zr=536870912;return r=Nt.current,r!==null&&(r.flags|=32),Zr}function qa(r,s,d){(r===yi&&(ii===2||ii===9)||r.cancelPendingCommit!==null)&&(Ah(r,0),fc(r,Sn,Zr,!1)),Ln(r,d),((Kn&2)===0||r!==yi)&&(r===yi&&((Kn&2)===0&&(Su|=d),Hi===4&&fc(r,Sn,Zr,!1)),lo(r))}function or(r,s,d){if((Kn&6)!==0)throw Error(S(327));var _=!d&&(s&127)===0&&(s&r.expiredLanes)===0||ui(r,s),M=_?Ch(r,s):ap(r,s,!0),D=_;do{if(M===0){dc&&!_&&fc(r,s,0,!1);break}else{if(d=r.current.alternate,D&&!n_(d)){M=ap(r,s,!1),D=!1;continue}if(M===2){if(D=s,r.errorRecoveryDisabledLanes&D)var q=0;else q=r.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){s=q;e:{var te=r;M=Dd;var Ee=te.current.memoizedState.isDehydrated;if(Ee&&(Ah(te,q).flags|=256),q=ap(te,q,!1),q!==2){if(pm&&!Ee){te.errorRecoveryDisabledLanes|=D,Su|=D,M=4;break e}D=Ua,Ua=M,D!==null&&(Ua===null?Ua=D:Ua.push.apply(Ua,D))}M=q}if(D=!1,M!==2)continue}}if(M===1){Ah(r,0),fc(r,s,0,!0);break}e:{switch(_=r,D=M,D){case 0:case 1:throw Error(S(345));case 4:if((s&4194048)!==s)break;case 6:fc(_,s,Zr,!Os);break e;case 2:Ua=null;break;case 3:case 5:break;default:throw Error(S(329))}if((s&62914560)===s&&(M=tp+300-Li(),10<M)){if(fc(_,s,Zr,!Os),In(_,0,!0)!==0)break e;Bs=s,_.timeoutHandle=wp(Mh.bind(null,_,d,Ua,Sh,gm,s,Zr,Su,Eu,Os,D,"Throttled",-0,0),M);break e}Mh(_,d,Ua,Sh,gm,s,Zr,Su,Eu,Os,D,null,-0,0)}}break}while(!0);lo(r)}function Mh(r,s,d,_,M,D,q,te,Ee,Xe,dt,xt,We,nt){if(r.timeoutHandle=-1,xt=s.subtreeFlags,xt&8192||(xt&16785408)===16785408){xt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ya},Mg(s,D,xt);var Yt=(D&62914560)===D?tp-Li():(D&4194048)===D?Pg-Li():0;if(Yt=Xm(xt,Yt),Yt!==null){Bs=D,r.cancelPendingCommit=Yt(Bg.bind(null,r,s,D,d,_,M,q,te,Ee,dt,xt,null,We,nt)),fc(r,D,q,!Xe);return}}Bg(r,s,D,d,_,M,q,te,Ee)}function n_(r){for(var s=r;;){var d=s.tag;if((d===0||d===11||d===15)&&s.flags&16384&&(d=s.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var _=0;_<d.length;_++){var M=d[_],D=M.getSnapshot;M=M.value;try{if(!Yr(D(),M))return!1}catch{return!1}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function fc(r,s,d,_){s&=~mm,s&=~Su,r.suspendedLanes|=s,r.pingedLanes&=~s,_&&(r.warmLanes|=s),_=r.expirationTimes;for(var M=s;0<M;){var D=31-Je(M),q=1<<D;_[D]=-1,M&=~q}d!==0&&On(r,d,s)}function Rd(){return(Kn&6)===0?(os(0),!1):!0}function ip(){if(Tn!==null){if(ii===0)var r=Tn.return;else r=Tn,Es=Ia=null,io(r),Cs=null,hl=0,r=Tn;for(;r!==null;)Xf(r.alternate,r),r=r.return;Tn=null}}function Ah(r,s){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,Lm(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),Bs=0,ip(),yi=r,Tn=d=pa(r.current,null),Sn=s,ii=0,wa=null,Os=!1,dc=ui(r,s),pm=!1,Eu=Zr=mm=Su=El=Hi=0,Ua=Dd=null,gm=!1,(s&8)!==0&&(s|=s&32);var _=r.entangledLanes;if(_!==0)for(r=r.entanglements,_&=s;0<_;){var M=31-Je(_),D=1<<M;s|=r[M],_&=~D}return Sl=s,ol(),d}function vm(r,s){fn=null,we.H=jn,s===Qa||s===Jr?(s=ac(),ii=3):s===Do?(s=ac(),ii=4):ii=s===Ff?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,wa=s,Tn===null&&(Hi=1,as(r,Gr(s,r.current)))}function xm(){var r=Nt.current;return r===null?!0:(Sn&4194048)===Sn?Xt===null:(Sn&62914560)===Sn||(Sn&536870912)!==0?r===Xt:!1}function Mu(){var r=we.H;return we.H=jn,r===null?jn:r}function rp(){var r=we.A;return we.A=t_,r}function Ld(){Hi=4,Os||(Sn&4194048)!==Sn&&Nt.current!==null||(dc=!0),(El&134217727)===0&&(Su&134217727)===0||yi===null||fc(yi,Sn,Zr,!1)}function ap(r,s,d){var _=Kn;Kn|=2;var M=Mu(),D=rp();(yi!==r||Sn!==s)&&(Sh=null,Ah(r,s)),s=!1;var q=Hi;e:do try{if(ii!==0&&Tn!==null){var te=Tn,Ee=wa;switch(ii){case 8:ip(),q=6;break e;case 3:case 2:case 9:case 6:Nt.current===null&&(s=!0);var Xe=ii;if(ii=0,wa=null,zh(r,te,Ee,Xe),d&&dc){q=0;break e}break;default:Xe=ii,ii=0,wa=null,zh(r,te,Ee,Xe)}}sp(),q=Hi;break}catch(dt){vm(r,dt)}while(!0);return s&&r.shellSuspendCounter++,Es=Ia=null,Kn=_,we.H=M,we.A=D,Tn===null&&(yi=null,Sn=0,ol()),q}function sp(){for(;Tn!==null;)Rg(Tn)}function Ch(r,s){var d=Kn;Kn|=2;var _=Mu(),M=rp();yi!==r||Sn!==s?(Sh=null,Id=Li()+500,Ah(r,s)):dc=ui(r,s);e:do try{if(ii!==0&&Tn!==null){s=Tn;var D=wa;t:switch(ii){case 1:ii=0,wa=null,zh(r,s,D,1);break;case 2:case 9:if(ou(D)){ii=0,wa=null,Lg(s);break}s=function(){ii!==2&&ii!==9||yi!==r||(ii=7),lo(r)},D.then(s,s);break e;case 3:ii=7;break e;case 4:ii=5;break e;case 7:ou(D)?(ii=0,wa=null,Lg(s)):(ii=0,wa=null,zh(r,s,D,7));break;case 5:var q=null;switch(Tn.tag){case 26:q=Tn.memoizedState;case 5:case 27:var te=Tn;if(q?Zd(q):te.stateNode.complete){ii=0,wa=null;var Ee=te.sibling;if(Ee!==null)Tn=Ee;else{var Xe=te.return;Xe!==null?(Tn=Xe,op(Xe)):Tn=null}break t}}ii=0,wa=null,zh(r,s,D,5);break;case 6:ii=0,wa=null,zh(r,s,D,6);break;case 8:ip(),Hi=6;break e;default:throw Error(S(462))}}kg();break}catch(dt){vm(r,dt)}while(!0);return Es=Ia=null,we.H=_,we.A=M,Kn=d,Tn!==null?0:(yi=null,Sn=0,ol(),Hi)}function kg(){for(;Tn!==null&&!Ki();)Rg(Tn)}function Rg(r){var s=na(r.alternate,r,Sl);r.memoizedProps=r.pendingProps,s===null?op(r):Tn=s}function Lg(r){var s=r,d=s.alternate;switch(s.tag){case 15:case 0:s=yg(d,s,s.pendingProps,s.type,void 0,Sn);break;case 11:s=yg(d,s,s.pendingProps,s.type.render,s.ref,Sn);break;case 5:io(s);default:Xf(d,s),s=Tn=Rf(s,Sl),s=na(d,s,Sl)}r.memoizedProps=r.pendingProps,s===null?op(r):Tn=s}function zh(r,s,d,_){Es=Ia=null,io(s),Cs=null,hl=0;var M=s.return;try{if(Nf(r,M,s,d,Sn)){Hi=1,as(r,Gr(d,r.current)),Tn=null;return}}catch(D){if(M!==null)throw Tn=M,D;Hi=1,as(r,Gr(d,r.current)),Tn=null;return}s.flags&32768?(vn||_===1?r=!0:dc||(Sn&536870912)!==0?r=!1:(Os=r=!0,(_===2||_===9||_===3||_===6)&&(_=Nt.current,_!==null&&_.tag===13&&(_.flags|=16384))),Og(s,r)):op(s)}function op(r){var s=r;do{if((s.flags&32768)!==0){Og(s,Os);return}r=s.return;var d=bg(s.alternate,s,Sl);if(d!==null){Tn=d;return}if(s=s.sibling,s!==null){Tn=s;return}Tn=s=r}while(s!==null);Hi===0&&(Hi=5)}function Og(r,s){do{var d=Jy(r.alternate,r);if(d!==null){d.flags&=32767,Tn=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!s&&(r=r.sibling,r!==null)){Tn=r;return}Tn=r=d}while(r!==null);Hi=6,Tn=null}function Bg(r,s,d,_,M,D,q,te,Ee){r.cancelPendingCommit=null;do lp();while(xr!==0);if((Kn&6)!==0)throw Error(S(327));if(s!==null){if(s===r.current)throw Error(S(177));if(D=s.lanes|s.childLanes,D|=sl,hi(r,d,D,q,te,Ee),r===yi&&(Tn=yi=null,Sn=0),Eh=s,Al=r,Bs=d,ym=D,np=M,Dg=_,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,qg($,function(){return Vg(),null})):(r.callbackNode=null,r.callbackPriority=0),_=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||_){_=we.T,we.T=null,M=$e.p,$e.p=2,q=Kn,Kn|=4;try{e_(r,s,d)}finally{Kn=q,$e.p=M,we.T=_}}xr=1,Ng(),Fg(),jg()}}function Ng(){if(xr===1){xr=0;var r=Al,s=Eh,d=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||d){d=we.T,we.T=null;var _=$e.p;$e.p=2;var M=Kn;Kn|=4;try{Qf(s,r);var D=km,q=Ku(r.containerInfo),te=D.focusedElem,Ee=D.selectionRange;if(q!==te&&te&&te.ownerDocument&&Wu(te.ownerDocument.documentElement,te)){if(Ee!==null&&Kc(te)){var Xe=Ee.start,dt=Ee.end;if(dt===void 0&&(dt=Xe),"selectionStart"in te)te.selectionStart=Xe,te.selectionEnd=Math.min(dt,te.value.length);else{var xt=te.ownerDocument||document,We=xt&&xt.defaultView||window;if(We.getSelection){var nt=We.getSelection(),Yt=te.textContent.length,an=Math.min(Ee.start,Yt),ri=Ee.end===void 0?an:Math.min(Ee.end,Yt);!nt.extend&&an>ri&&(q=ri,ri=an,an=q);var Ne=Wc(te,an),Pe=Wc(te,ri);if(Ne&&Pe&&(nt.rangeCount!==1||nt.anchorNode!==Ne.node||nt.anchorOffset!==Ne.offset||nt.focusNode!==Pe.node||nt.focusOffset!==Pe.offset)){var Ze=xt.createRange();Ze.setStart(Ne.node,Ne.offset),nt.removeAllRanges(),an>ri?(nt.addRange(Ze),nt.extend(Pe.node,Pe.offset)):(Ze.setEnd(Pe.node,Pe.offset),nt.addRange(Ze))}}}}for(xt=[],nt=te;nt=nt.parentNode;)nt.nodeType===1&&xt.push({element:nt,left:nt.scrollLeft,top:nt.scrollTop});for(typeof te.focus=="function"&&te.focus(),te=0;te<xt.length;te++){var gt=xt[te];gt.element.scrollLeft=gt.left,gt.element.scrollTop=gt.top}}Wd=!!jd,km=jd=null}finally{Kn=M,$e.p=_,we.T=d}}r.current=s,xr=2}}function Fg(){if(xr===2){xr=0;var r=Al,s=Eh,d=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||d){d=we.T,we.T=null;var _=$e.p;$e.p=2;var M=Kn;Kn|=4;try{hm(r,s.alternate,s)}finally{Kn=M,$e.p=_,we.T=d}}xr=3}}function jg(){if(xr===4||xr===3){xr=0,$r();var r=Al,s=Eh,d=Bs,_=Dg;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?xr=5:(xr=0,Eh=Al=null,Ug(r,r.pendingLanes));var M=r.pendingLanes;if(M===0&&(Ml=null),bt(d),s=s.stateNode,Se&&typeof Se.onCommitFiberRoot=="function")try{Se.onCommitFiberRoot(ze,s,void 0,(s.current.flags&128)===128)}catch{}if(_!==null){s=we.T,M=$e.p,$e.p=2,we.T=null;try{for(var D=r.onRecoverableError,q=0;q<_.length;q++){var te=_[q];D(te.value,{componentStack:te.stack})}}finally{we.T=s,$e.p=M}}(Bs&3)!==0&&lp(),lo(r),M=r.pendingLanes,(d&261930)!==0&&(M&42)!==0?r===_m?kd++:(kd=0,_m=r):kd=0,os(0)}}function Ug(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,ic(s)))}function lp(){return Ng(),Fg(),jg(),Vg()}function Vg(){if(xr!==5)return!1;var r=Al,s=ym;ym=0;var d=bt(Bs),_=we.T,M=$e.p;try{$e.p=32>d?32:d,we.T=null,d=np,np=null;var D=Al,q=Bs;if(xr=0,Eh=Al=null,Bs=0,(Kn&6)!==0)throw Error(S(331));var te=Kn;if(Kn|=4,Cg(D.current),fm(D,D.current,q,d),Kn=te,os(0,!1),Se&&typeof Se.onPostCommitFiberRoot=="function")try{Se.onPostCommitFiberRoot(ze,D)}catch{}return!0}finally{$e.p=M,we.T=_,Ug(r,s)}}function bm(r,s,d){s=Gr(d,s),s=_u(r.stateNode,s,2),r=Js(r,s,2),r!==null&&(Ln(r,2),lo(r))}function Qn(r,s,d){if(r.tag===3)bm(r,r,d);else for(;s!==null;){if(s.tag===3){bm(s,r,d);break}else if(s.tag===1){var _=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Ml===null||!Ml.has(_))){r=Gr(d,r),d=vu(2),_=Js(s,d,2),_!==null&&(xu(d,_,s,r),Ln(_,2),lo(_));break}}s=s.return}}function cp(r,s,d){var _=r.pingCache;if(_===null){_=r.pingCache=new zg;var M=new Set;_.set(s,M)}else M=_.get(s),M===void 0&&(M=new Set,_.set(s,M));M.has(d)||(pm=!0,M.add(d),r=pc.bind(null,r,s,d),s.then(r,r))}function pc(r,s,d){var _=r.pingCache;_!==null&&_.delete(s),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,yi===r&&(Sn&d)===d&&(Hi===4||Hi===3&&(Sn&62914560)===Sn&&300>Li()-tp?(Kn&2)===0&&Ah(r,0):mm|=d,Eu===Sn&&(Eu=0)),lo(r)}function Od(r,s){s===0&&(s=kn()),r=Da(r,s),r!==null&&(Ln(r,s),lo(r))}function wm(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),Od(r,d)}function i_(r,s){var d=0;switch(r.tag){case 31:case 13:var _=r.stateNode,M=r.memoizedState;M!==null&&(d=M.retryLane);break;case 19:_=r.stateNode;break;case 22:_=r.stateNode._retryCache;break;default:throw Error(S(314))}_!==null&&_.delete(s),Od(r,d)}function qg(r,s){return ur(r,s)}var up=null,Ph=null,Tm=!1,hp=!1,Sm=!1,Cl=0;function lo(r){r!==Ph&&r.next===null&&(Ph===null?up=Ph=r:Ph=Ph.next=r),hp=!0,Tm||(Tm=!0,Mm())}function os(r,s){if(!Sm&&hp){Sm=!0;do for(var d=!1,_=up;_!==null;){if(r!==0){var M=_.pendingLanes;if(M===0)var D=0;else{var q=_.suspendedLanes,te=_.pingedLanes;D=(1<<31-Je(42|r)+1)-1,D&=M&~(q&~te),D=D&201326741?D&201326741|1:D?D|2:0}D!==0&&(d=!0,Bd(_,D))}else D=Sn,D=In(_,_===yi?D:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(D&3)===0||ui(_,D)||(d=!0,Bd(_,D));_=_.next}while(d);Sm=!1}}function mc(){Em()}function Em(){hp=Tm=!1;var r=0;Cl!==0&&bp()&&(r=Cl);for(var s=Li(),d=null,_=up;_!==null;){var M=_.next,D=dp(_,s);D===0?(_.next=null,d===null?up=M:d.next=M,M===null&&(Ph=d)):(d=_,(r!==0||(D&3)!==0)&&(hp=!0)),_=M}xr!==0&&xr!==5||os(r),Cl!==0&&(Cl=0)}function dp(r,s){for(var d=r.suspendedLanes,_=r.pingedLanes,M=r.expirationTimes,D=r.pendingLanes&-62914561;0<D;){var q=31-Je(D),te=1<<q,Ee=M[q];Ee===-1?((te&d)===0||(te&_)!==0)&&(M[q]=nn(te,s)):Ee<=s&&(r.expiredLanes|=te),D&=~te}if(s=yi,d=Sn,d=In(r,r===s?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_=r.callbackNode,d===0||r===s&&(ii===2||ii===9)||r.cancelPendingCommit!==null)return _!==null&&_!==null&&Hr(_),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||ui(r,d)){if(s=d&-d,s===r.callbackPriority)return s;switch(_!==null&&Hr(_),bt(d)){case 2:case 8:d=Z;break;case 32:d=$;break;case 268435456:d=ue;break;default:d=$}return _=Gg.bind(null,r),d=ur(d,_),r.callbackPriority=s,r.callbackNode=d,s}return _!==null&&_!==null&&Hr(_),r.callbackPriority=2,r.callbackNode=null,2}function Gg(r,s){if(xr!==0&&xr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(lp()&&r.callbackNode!==d)return null;var _=Sn;return _=In(r,r===yi?_:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_===0?null:(or(r,_,s),dp(r,Li()),r.callbackNode!=null&&r.callbackNode===d?Gg.bind(null,r):null)}function Bd(r,s){if(lp())return null;or(r,s,!0)}function Mm(){Bm(function(){(Kn&6)!==0?ur(Be,mc):Em()})}function Am(){if(Cl===0){var r=ul;r===0&&(r=Ht,Ht<<=1,(Ht&261888)===0&&(Ht=256)),Cl=r}return Cl}function fp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:hn(""+r)}function pp(r,s){var d=s.ownerDocument.createElement("input");return d.name=s.name,d.value=s.value,r.id&&d.setAttribute("form",r.id),s.parentNode.insertBefore(d,s),r=new FormData(r),d.parentNode.removeChild(d),r}function Dh(r,s,d,_,M){if(s==="submit"&&d&&d.stateNode===M){var D=fp((M[Fe]||null).action),q=_.submitter;q&&(s=(s=q[Fe]||null)?fp(s.formAction):q.getAttribute("formAction"),s!==null&&(D=s,q=null));var te=new Fc("action","action",null,_,M);r.push({event:te,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if(Cl!==0){var Ee=q?pp(M,q):new FormData(M);Ci(d,{pending:!0,data:Ee,method:M.method,action:D},null,Ee)}}else typeof D=="function"&&(te.preventDefault(),Ee=q?pp(M,q):new FormData(M),Ci(d,{pending:!0,data:Ee,method:M.method,action:D},D,Ee))},currentTarget:M}]})}}for(var mp=0;mp<th.length;mp++){var gp=th[mp],Cm=gp.toLowerCase(),Zg=gp[0].toUpperCase()+gp.slice(1);da(Cm,"on"+Zg)}da(eu,"onAnimationEnd"),da(tu,"onAnimationIteration"),da(eh,"onAnimationStart"),da("dblclick","onDoubleClick"),da("focusin","onFocus"),da("focusout","onBlur"),da(al,"onTransitionRun"),da(nu,"onTransitionStart"),da(Ql,"onTransitionCancel"),da(ha,"onTransitionEnd"),Gs("onMouseEnter",["mouseout","mouseover"]),Gs("onMouseLeave",["mouseout","mouseover"]),Gs("onPointerEnter",["pointerout","pointerover"]),Gs("onPointerLeave",["pointerout","pointerover"]),xn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),xn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),xn("onBeforeInput",["compositionend","keypress","textInput","paste"]),xn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),xn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),xn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(gc));function $g(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var _=r[d],M=_.event;_=_.listeners;e:{var D=void 0;if(s)for(var q=_.length-1;0<=q;q--){var te=_[q],Ee=te.instance,Xe=te.currentTarget;if(te=te.listener,Ee!==D&&M.isPropagationStopped())break e;D=te,M.currentTarget=Xe;try{D(M)}catch(dt){vs(dt)}M.currentTarget=null,D=Ee}else for(q=0;q<_.length;q++){if(te=_[q],Ee=te.instance,Xe=te.currentTarget,te=te.listener,Ee!==D&&M.isPropagationStopped())break e;D=te,M.currentTarget=Xe;try{D(M)}catch(dt){vs(dt)}M.currentTarget=null,D=Ee}}}}function En(r,s){var d=s[kt];d===void 0&&(d=s[kt]=new Set);var _=r+"__bubble";d.has(_)||(_p(s,r,2,!1),d.add(_))}function zm(r,s,d){var _=0;s&&(_|=4),_p(d,r,_,s)}var yp="_reactListening"+Math.random().toString(36).slice(2);function Pm(r){if(!r[yp]){r[yp]=!0,Fl.forEach(function(d){d!=="selectionchange"&&(Hg.has(d)||zm(d,!1,r),zm(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[yp]||(s[yp]=!0,zm("selectionchange",!1,s))}}function _p(r,s,d,_){switch(zu(s)){case 2:var M=Kd;break;case 8:M=oy;break;default:M=Wm}d=M.bind(null,s,d,r),M=void 0,!Fr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(M=!0),_?M!==void 0?r.addEventListener(s,d,{capture:!0,passive:M}):r.addEventListener(s,d,!0):M!==void 0?r.addEventListener(s,d,{passive:M}):r.addEventListener(s,d,!1)}function jo(r,s,d,_,M){var D=_;if((s&1)===0&&(s&2)===0&&_!==null)e:for(;;){if(_===null)return;var q=_.tag;if(q===3||q===4){var te=_.stateNode.containerInfo;if(te===M)break;if(q===4)for(q=_.return;q!==null;){var Ee=q.tag;if((Ee===3||Ee===4)&&q.stateNode.containerInfo===M)return;q=q.return}for(;te!==null;){if(q=ds(te),q===null)return;if(Ee=q.tag,Ee===5||Ee===6||Ee===26||Ee===27){_=D=q;continue e}te=te.parentNode}}_=_.return}$n(function(){var Xe=D,dt=Nc(d),xt=[];e:{var We=sd.get(r);if(We!==void 0){var nt=Fc,Yt=r;switch(r){case"keypress":if(ua(d)===0)break e;case"keydown":case"keyup":nt=Mi;break;case"focusin":Yt="focus",nt=vo;break;case"focusout":Yt="blur",nt=vo;break;case"beforeblur":case"afterblur":nt=vo;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":nt=el;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":nt=jc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":nt=Jp;break;case eu:case tu:case eh:nt=wf;break;case ha:nt=Hu;break;case"scroll":case"scrollend":nt=Jo;break;case"wheel":nt=td;break;case"copy":case"cut":case"paste":nt=Jh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":nt=Zu;break;case"toggle":case"beforetoggle":nt=Hl}var an=(s&4)!==0,ri=!an&&(r==="scroll"||r==="scrollend"),Ne=an?We!==null?We+"Capture":null:We;an=[];for(var Pe=Xe,Ze;Pe!==null;){var gt=Pe;if(Ze=gt.stateNode,gt=gt.tag,gt!==5&&gt!==26&&gt!==27||Ze===null||Ne===null||(gt=Aa(Pe,Ne),gt!=null&&an.push(Ih(Pe,gt,Ze))),ri)break;Pe=Pe.return}0<an.length&&(We=new nt(We,Yt,null,d,dt),xt.push({event:We,listeners:an}))}}if((s&7)===0){e:{if(We=r==="mouseover"||r==="pointerover",nt=r==="mouseout"||r==="pointerout",We&&d!==Qh&&(Yt=d.relatedTarget||d.fromElement)&&(ds(Yt)||Yt[Tt]))break e;if((nt||We)&&(We=dt.window===dt?dt:(We=dt.ownerDocument)?We.defaultView||We.parentWindow:window,nt?(Yt=d.relatedTarget||d.toElement,nt=Xe,Yt=Yt?ds(Yt):null,Yt!==null&&(ri=k(Yt),an=Yt.tag,Yt!==ri||an!==5&&an!==27&&an!==6)&&(Yt=null)):(nt=null,Yt=Xe),nt!==Yt)){if(an=el,gt="onMouseLeave",Ne="onMouseEnter",Pe="mouse",(r==="pointerout"||r==="pointerover")&&(an=Zu,gt="onPointerLeave",Ne="onPointerEnter",Pe="pointer"),ri=nt==null?We:fs(nt),Ze=Yt==null?We:fs(Yt),We=new an(gt,Pe+"leave",nt,d,dt),We.target=ri,We.relatedTarget=Ze,gt=null,ds(dt)===Xe&&(an=new an(Ne,Pe+"enter",Yt,d,dt),an.target=Ze,an.relatedTarget=ri,gt=an),ri=gt,nt&&Yt)t:{for(an=Xg,Ne=nt,Pe=Yt,Ze=0,gt=Ne;gt;gt=an(gt))Ze++;gt=0;for(var rn=Pe;rn;rn=an(rn))gt++;for(;0<Ze-gt;)Ne=an(Ne),Ze--;for(;0<gt-Ze;)Pe=an(Pe),gt--;for(;Ze--;){if(Ne===Pe||Pe!==null&&Ne===Pe.alternate){an=Ne;break t}Ne=an(Ne),Pe=an(Pe)}an=null}else an=null;nt!==null&&Dm(xt,We,nt,an,!1),Yt!==null&&ri!==null&&Dm(xt,ri,Yt,an,!0)}}e:{if(We=Xe?fs(Xe):window,nt=We.nodeName&&We.nodeName.toLowerCase(),nt==="select"||nt==="input"&&We.type==="file")var Zn=wo;else if(Xu(We))if(nd)Zn=If;else{Zn=Df;var Wt=em}else nt=We.nodeName,!nt||nt.toLowerCase()!=="input"||We.type!=="checkbox"&&We.type!=="radio"?Xe&&Wo(Xe.elementType)&&(Zn=wo):Zn=Yc;if(Zn&&(Zn=Zn(r,Xe))){Yu(xt,Zn,d,dt);break e}Wt&&Wt(r,We,Xe),r==="focusout"&&Xe&&We.type==="number"&&Xe.memoizedProps.value!=null&&Bc(We,"number",We.value)}switch(Wt=Xe?fs(Xe):window,r){case"focusin":(Xu(Wt)||Wt.contentEditable==="true")&&(Pa=Wt,Qc=Xe,Jc=null);break;case"focusout":Jc=Qc=Pa=null;break;case"mousedown":Ju=!0;break;case"contextmenu":case"mouseup":case"dragend":Ju=!1,kf(xt,d,dt);break;case"selectionchange":if(Qu)break;case"keydown":case"keyup":kf(xt,d,dt)}var Jt;if(Oi)e:{switch(r){case"compositionstart":var wn="onCompositionStart";break e;case"compositionend":wn="onCompositionEnd";break e;case"compositionupdate":wn="onCompositionUpdate";break e}wn=void 0}else Wa?Zc(r,d)&&(wn="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(wn="onCompositionStart");wn&&(Wl&&d.locale!=="ko"&&(Wa||wn!=="onCompositionStart"?wn==="onCompositionEnd"&&Wa&&(Jt=yo()):(ca=dt,gs="value"in ca?ca.value:ca.textContent,Wa=!0)),Wt=Nd(Xe,wn),0<Wt.length&&(wn=new ed(wn,r,null,d,dt),xt.push({event:wn,listeners:Wt}),Jt?wn.data=Jt:(Jt=Mf(d),Jt!==null&&(wn.data=Jt)))),(Jt=Yl?$u(r,d):Af(r,d))&&(wn=Nd(Xe,"onBeforeInput"),0<wn.length&&(Wt=new ed("onBeforeInput","beforeinput",null,d,dt),xt.push({event:Wt,listeners:wn}),Wt.data=Jt)),Dh(xt,r,Xe,d,dt)}$g(xt,s)})}function Ih(r,s,d){return{instance:r,listener:s,currentTarget:d}}function Nd(r,s){for(var d=s+"Capture",_=[];r!==null;){var M=r,D=M.stateNode;if(M=M.tag,M!==5&&M!==26&&M!==27||D===null||(M=Aa(r,d),M!=null&&_.unshift(Ih(r,M,D)),M=Aa(r,s),M!=null&&_.push(Ih(r,M,D))),r.tag===3)return _;r=r.return}return[]}function Xg(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Dm(r,s,d,_,M){for(var D=s._reactName,q=[];d!==null&&d!==_;){var te=d,Ee=te.alternate,Xe=te.stateNode;if(te=te.tag,Ee!==null&&Ee===_)break;te!==5&&te!==26&&te!==27||Xe===null||(Ee=Xe,M?(Xe=Aa(d,D),Xe!=null&&q.unshift(Ih(d,Xe,Ee))):M||(Xe=Aa(d,D),Xe!=null&&q.push(Ih(d,Xe,Ee)))),d=d.return}q.length!==0&&r.push({event:s,listeners:q})}var Yg=/\r\n?/g,Wg=/\u0000|\uFFFD/g;function Fd(r){return(typeof r=="string"?r:""+r).replace(Yg,`
`).replace(Wg,"")}function Im(r,s){return s=Fd(s),Fd(r)===s}function Gn(r,s,d,_,M,D){switch(d){case"children":typeof _=="string"?s==="body"||s==="textarea"&&_===""||Zs(r,_):(typeof _=="number"||typeof _=="bigint")&&s!=="body"&&Zs(r,""+_);break;case"className":ms(r,"class",_);break;case"tabIndex":ms(r,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":ms(r,d,_);break;case"style":Gu(r,_,D);break;case"data":if(s!=="object"){ms(r,"data",_);break}case"src":case"href":if(_===""&&(s!=="a"||d!=="href")){r.removeAttribute(d);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(d);break}_=hn(""+_),r.setAttribute(d,_);break;case"action":case"formAction":if(typeof _=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof D=="function"&&(d==="formAction"?(s!=="input"&&Gn(r,s,"name",M.name,M,null),Gn(r,s,"formEncType",M.formEncType,M,null),Gn(r,s,"formMethod",M.formMethod,M,null),Gn(r,s,"formTarget",M.formTarget,M,null)):(Gn(r,s,"encType",M.encType,M,null),Gn(r,s,"method",M.method,M,null),Gn(r,s,"target",M.target,M,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(d);break}_=hn(""+_),r.setAttribute(d,_);break;case"onClick":_!=null&&(r.onclick=Ya);break;case"onScroll":_!=null&&En("scroll",r);break;case"onScrollEnd":_!=null&&En("scrollend",r);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(d=_.__html,d!=null){if(M.children!=null)throw Error(S(60));r.innerHTML=d}}break;case"multiple":r.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":r.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){r.removeAttribute("xlink:href");break}d=hn(""+_),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,""+_):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":_===!0?r.setAttribute(d,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,_):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?r.setAttribute(d,_):r.removeAttribute(d);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?r.removeAttribute(d):r.setAttribute(d,_);break;case"popover":En("beforetoggle",r),En("toggle",r),Rc(r,"popover",_);break;case"xlinkActuate":Ma(r,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":Ma(r,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":Ma(r,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":Ma(r,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":Ma(r,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":Ma(r,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":Ma(r,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":Ma(r,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":Ma(r,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":Rc(r,"is",_);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=go.get(d)||d,Rc(r,d,_))}}function vp(r,s,d,_,M,D){switch(d){case"style":Gu(r,_,D);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(d=_.__html,d!=null){if(M.children!=null)throw Error(S(60));r.innerHTML=d}}break;case"children":typeof _=="string"?Zs(r,_):(typeof _=="number"||typeof _=="bigint")&&Zs(r,""+_);break;case"onScroll":_!=null&&En("scroll",r);break;case"onScrollEnd":_!=null&&En("scrollend",r);break;case"onClick":_!=null&&(r.onclick=Ya);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pr.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(M=d.endsWith("Capture"),s=d.slice(2,M?d.length-7:void 0),D=r[Fe]||null,D=D!=null?D[d]:null,typeof D=="function"&&r.removeEventListener(s,D,M),typeof _=="function")){typeof D!="function"&&D!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(s,_,M);break e}d in r?r[d]=_:_===!0?r.setAttribute(d,""):Rc(r,d,_)}}}function Cr(r,s,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":En("error",r),En("load",r);var _=!1,M=!1,D;for(D in d)if(d.hasOwnProperty(D)){var q=d[D];if(q!=null)switch(D){case"src":_=!0;break;case"srcSet":M=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:Gn(r,s,D,q,d,null)}}M&&Gn(r,s,"srcSet",d.srcSet,d,null),_&&Gn(r,s,"src",d.src,d,null);return;case"input":En("invalid",r);var te=D=q=M=null,Ee=null,Xe=null;for(_ in d)if(d.hasOwnProperty(_)){var dt=d[_];if(dt!=null)switch(_){case"name":M=dt;break;case"type":q=dt;break;case"checked":Ee=dt;break;case"defaultChecked":Xe=dt;break;case"value":D=dt;break;case"defaultValue":te=dt;break;case"children":case"dangerouslySetInnerHTML":if(dt!=null)throw Error(S(137,s));break;default:Gn(r,s,_,dt,d,null)}}qu(r,D,te,Ee,Xe,q,M,!1);return;case"select":En("invalid",r),_=q=D=null;for(M in d)if(d.hasOwnProperty(M)&&(te=d[M],te!=null))switch(M){case"value":D=te;break;case"defaultValue":q=te;break;case"multiple":_=te;default:Gn(r,s,M,te,d,null)}s=D,d=q,r.multiple=!!_,s!=null?mo(r,!!_,s,!1):d!=null&&mo(r,!!_,d,!0);return;case"textarea":En("invalid",r),D=M=_=null;for(q in d)if(d.hasOwnProperty(q)&&(te=d[q],te!=null))switch(q){case"value":_=te;break;case"defaultValue":M=te;break;case"children":D=te;break;case"dangerouslySetInnerHTML":if(te!=null)throw Error(S(91));break;default:Gn(r,s,q,te,d,null)}Vl(r,_,M,D);return;case"option":for(Ee in d)d.hasOwnProperty(Ee)&&(_=d[Ee],_!=null)&&(Ee==="selected"?r.selected=_&&typeof _!="function"&&typeof _!="symbol":Gn(r,s,Ee,_,d,null));return;case"dialog":En("beforetoggle",r),En("toggle",r),En("cancel",r),En("close",r);break;case"iframe":case"object":En("load",r);break;case"video":case"audio":for(_=0;_<gc.length;_++)En(gc[_],r);break;case"image":En("error",r),En("load",r);break;case"details":En("toggle",r);break;case"embed":case"source":case"link":En("error",r),En("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Xe in d)if(d.hasOwnProperty(Xe)&&(_=d[Xe],_!=null))switch(Xe){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:Gn(r,s,Xe,_,d,null)}return;default:if(Wo(s)){for(dt in d)d.hasOwnProperty(dt)&&(_=d[dt],_!==void 0&&vp(r,s,dt,_,d,void 0));return}}for(te in d)d.hasOwnProperty(te)&&(_=d[te],_!=null&&Gn(r,s,te,_,d,null))}function Kg(r,s,d,_){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var M=null,D=null,q=null,te=null,Ee=null,Xe=null,dt=null;for(nt in d){var xt=d[nt];if(d.hasOwnProperty(nt)&&xt!=null)switch(nt){case"checked":break;case"value":break;case"defaultValue":Ee=xt;default:_.hasOwnProperty(nt)||Gn(r,s,nt,null,_,xt)}}for(var We in _){var nt=_[We];if(xt=d[We],_.hasOwnProperty(We)&&(nt!=null||xt!=null))switch(We){case"type":D=nt;break;case"name":M=nt;break;case"checked":Xe=nt;break;case"defaultChecked":dt=nt;break;case"value":q=nt;break;case"defaultValue":te=nt;break;case"children":case"dangerouslySetInnerHTML":if(nt!=null)throw Error(S(137,s));break;default:nt!==xt&&Gn(r,s,We,nt,_,xt)}}Oc(r,q,te,Ee,Xe,dt,D,M);return;case"select":nt=q=te=We=null;for(D in d)if(Ee=d[D],d.hasOwnProperty(D)&&Ee!=null)switch(D){case"value":break;case"multiple":nt=Ee;default:_.hasOwnProperty(D)||Gn(r,s,D,null,_,Ee)}for(M in _)if(D=_[M],Ee=d[M],_.hasOwnProperty(M)&&(D!=null||Ee!=null))switch(M){case"value":We=D;break;case"defaultValue":te=D;break;case"multiple":q=D;default:D!==Ee&&Gn(r,s,M,D,_,Ee)}s=te,d=q,_=nt,We!=null?mo(r,!!d,We,!1):!!_!=!!d&&(s!=null?mo(r,!!d,s,!0):mo(r,!!d,d?[]:"",!1));return;case"textarea":nt=We=null;for(te in d)if(M=d[te],d.hasOwnProperty(te)&&M!=null&&!_.hasOwnProperty(te))switch(te){case"value":break;case"children":break;default:Gn(r,s,te,null,_,M)}for(q in _)if(M=_[q],D=d[q],_.hasOwnProperty(q)&&(M!=null||D!=null))switch(q){case"value":We=M;break;case"defaultValue":nt=M;break;case"children":break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(S(91));break;default:M!==D&&Gn(r,s,q,M,_,D)}xf(r,We,nt);return;case"option":for(var Yt in d)We=d[Yt],d.hasOwnProperty(Yt)&&We!=null&&!_.hasOwnProperty(Yt)&&(Yt==="selected"?r.selected=!1:Gn(r,s,Yt,null,_,We));for(Ee in _)We=_[Ee],nt=d[Ee],_.hasOwnProperty(Ee)&&We!==nt&&(We!=null||nt!=null)&&(Ee==="selected"?r.selected=We&&typeof We!="function"&&typeof We!="symbol":Gn(r,s,Ee,We,_,nt));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var an in d)We=d[an],d.hasOwnProperty(an)&&We!=null&&!_.hasOwnProperty(an)&&Gn(r,s,an,null,_,We);for(Xe in _)if(We=_[Xe],nt=d[Xe],_.hasOwnProperty(Xe)&&We!==nt&&(We!=null||nt!=null))switch(Xe){case"children":case"dangerouslySetInnerHTML":if(We!=null)throw Error(S(137,s));break;default:Gn(r,s,Xe,We,_,nt)}return;default:if(Wo(s)){for(var ri in d)We=d[ri],d.hasOwnProperty(ri)&&We!==void 0&&!_.hasOwnProperty(ri)&&vp(r,s,ri,void 0,_,We);for(dt in _)We=_[dt],nt=d[dt],!_.hasOwnProperty(dt)||We===nt||We===void 0&&nt===void 0||vp(r,s,dt,We,_,nt);return}}for(var Ne in d)We=d[Ne],d.hasOwnProperty(Ne)&&We!=null&&!_.hasOwnProperty(Ne)&&Gn(r,s,Ne,null,_,We);for(xt in _)We=_[xt],nt=d[xt],!_.hasOwnProperty(xt)||We===nt||We==null&&nt==null||Gn(r,s,xt,We,_,nt)}function Ga(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function kh(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,d=performance.getEntriesByType("resource"),_=0;_<d.length;_++){var M=d[_],D=M.transferSize,q=M.initiatorType,te=M.duration;if(D&&te&&Ga(q)){for(q=0,te=M.responseEnd,_+=1;_<d.length;_++){var Ee=d[_],Xe=Ee.startTime;if(Xe>te)break;var dt=Ee.transferSize,xt=Ee.initiatorType;dt&&Ga(xt)&&(Ee=Ee.responseEnd,q+=dt*(Ee<te?1:(te-Xe)/(Ee-Xe)))}if(--_,s+=8*(D+q)/(M.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var jd=null,km=null;function Ud(r){return r.nodeType===9?r:r.ownerDocument}function yc(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Rm(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function xp(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var _c=null;function bp(){var r=window.event;return r&&r.type==="popstate"?r===_c?!1:(_c=r,!0):(_c=null,!1)}var wp=typeof setTimeout=="function"?setTimeout:void 0,Lm=typeof clearTimeout=="function"?clearTimeout:void 0,Om=typeof Promise=="function"?Promise:void 0,Bm=typeof queueMicrotask=="function"?queueMicrotask:typeof Om<"u"?function(r){return Om.resolve(null).then(r).catch(Nm)}:wp;function Nm(r){setTimeout(function(){throw r})}function vc(r){return r==="head"}function Qg(r,s){var d=s,_=0;do{var M=d.nextSibling;if(r.removeChild(d),M&&M.nodeType===8)if(d=M.data,d==="/$"||d==="/&"){if(_===0){r.removeChild(M),Ec(s);return}_--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")_++;else if(d==="html")Rh(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,Rh(d);for(var D=d.firstChild;D;){var q=D.nextSibling,te=D.nodeName;D[en]||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&D.rel.toLowerCase()==="stylesheet"||d.removeChild(D),D=q}}else d==="body"&&Rh(r.ownerDocument.body);d=M}while(d);Ec(s)}function mn(r,s){var d=r;r=0;do{var _=d.nextSibling;if(d.nodeType===1?s?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(s?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),_&&_.nodeType===8)if(d=_.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=_}while(d)}function co(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var d=s;switch(s=s.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":co(d),$o(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function kr(r,s,d,_){for(;r.nodeType===1;){var M=d;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!_&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(_){if(!r[en])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(D=r.getAttribute("rel"),D==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(D!==M.rel||r.getAttribute("href")!==(M.href==null||M.href===""?null:M.href)||r.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin)||r.getAttribute("title")!==(M.title==null?null:M.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(D=r.getAttribute("src"),(D!==(M.src==null?null:M.src)||r.getAttribute("type")!==(M.type==null?null:M.type)||r.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin))&&D&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var D=M.name==null?null:""+M.name;if(M.type==="hidden"&&r.getAttribute("name")===D)return r}else return r;if(r=ls(r.nextSibling),r===null)break}return null}function uo(r,s,d){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=ls(r.nextSibling),r===null))return null;return r}function xc(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=ls(r.nextSibling),r===null))return null;return r}function ia(r){return r.data==="$?"||r.data==="$~"}function er(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function br(r,s){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||d.readyState!=="loading")s();else{var _=function(){s(),d.removeEventListener("DOMContentLoaded",_)};d.addEventListener("DOMContentLoaded",_),r._reactRetry=_}}function ls(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var Ta=null;function wr(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(s===0)return ls(r.nextSibling);s--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||s++}r=r.nextSibling}return null}function Vd(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(s===0)return r;s--}else d!=="/$"&&d!=="/&"||s++}r=r.previousSibling}return null}function Jg(r,s,d){switch(s=Ud(d),r){case"html":if(r=s.documentElement,!r)throw Error(S(452));return r;case"head":if(r=s.head,!r)throw Error(S(453));return r;case"body":if(r=s.body,!r)throw Error(S(454));return r;default:throw Error(S(451))}}function Rh(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);$o(r)}var Rr=new Map,Au=new Set;function Tp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Uo=$e.d;$e.d={f:ey,r:ty,D:jm,C:ra,L:ho,m:aa,X:Sp,S:wc,M:Um};function ey(){var r=Uo.f(),s=Rd();return r||s}function ty(r){var s=qs(r);s!==null&&s.tag===5&&s.type==="form"?gr(s):Uo.r(r)}var bc=typeof document>"u"?null:document;function Fm(r,s,d){var _=bc;if(_&&typeof s=="string"&&s){var M=Nr(s);M='link[rel="'+r+'"][href="'+M+'"]',typeof d=="string"&&(M+='[crossorigin="'+d+'"]'),Au.has(M)||(Au.add(M),r={rel:r,crossOrigin:d,href:s},_.querySelector(M)===null&&(s=_.createElement("link"),Cr(s,"link",r),Si(s),_.head.appendChild(s)))}}function jm(r){Uo.D(r),Fm("dns-prefetch",r,null)}function ra(r,s){Uo.C(r,s),Fm("preconnect",r,s)}function ho(r,s,d){Uo.L(r,s,d);var _=bc;if(_&&r&&s){var M='link[rel="preload"][as="'+Nr(s)+'"]';s==="image"&&d&&d.imageSrcSet?(M+='[imagesrcset="'+Nr(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(M+='[imagesizes="'+Nr(d.imageSizes)+'"]')):M+='[href="'+Nr(r)+'"]';var D=M;switch(s){case"style":D=Cu(r);break;case"script":D=zl(r)}Rr.has(D)||(r=re({rel:"preload",href:s==="image"&&d&&d.imageSrcSet?void 0:r,as:s},d),Rr.set(D,r),_.querySelector(M)!==null||s==="style"&&_.querySelector(Lh(D))||s==="script"&&_.querySelector(Oh(D))||(s=_.createElement("link"),Cr(s,"link",r),Si(s),_.head.appendChild(s)))}}function aa(r,s){Uo.m(r,s);var d=bc;if(d&&r){var _=s&&typeof s.as=="string"?s.as:"script",M='link[rel="modulepreload"][as="'+Nr(_)+'"][href="'+Nr(r)+'"]',D=M;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":D=zl(r)}if(!Rr.has(D)&&(r=re({rel:"modulepreload",href:r},s),Rr.set(D,r),d.querySelector(M)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Oh(D)))return}_=d.createElement("link"),Cr(_,"link",r),Si(_),d.head.appendChild(_)}}}function wc(r,s,d){Uo.S(r,s,d);var _=bc;if(_&&r){var M=ps(_).hoistableStyles,D=Cu(r);s=s||"default";var q=M.get(D);if(!q){var te={loading:0,preload:null};if(q=_.querySelector(Lh(D)))te.loading=5;else{r=re({rel:"stylesheet",href:r,"data-precedence":s},d),(d=Rr.get(D))&&qd(r,d);var Ee=q=_.createElement("link");Si(Ee),Cr(Ee,"link",r),Ee._p=new Promise(function(Xe,dt){Ee.onload=Xe,Ee.onerror=dt}),Ee.addEventListener("load",function(){te.loading|=1}),Ee.addEventListener("error",function(){te.loading|=2}),te.loading|=4,Pl(q,s,_)}q={type:"stylesheet",instance:q,count:1,state:te},M.set(D,q)}}}function Sp(r,s){Uo.X(r,s);var d=bc;if(d&&r){var _=ps(d).hoistableScripts,M=zl(r),D=_.get(M);D||(D=d.querySelector(Oh(M)),D||(r=re({src:r,async:!0},s),(s=Rr.get(M))&&Ep(r,s),D=d.createElement("script"),Si(D),Cr(D,"link",r),d.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},_.set(M,D))}}function Um(r,s){Uo.M(r,s);var d=bc;if(d&&r){var _=ps(d).hoistableScripts,M=zl(r),D=_.get(M);D||(D=d.querySelector(Oh(M)),D||(r=re({src:r,async:!0,type:"module"},s),(s=Rr.get(M))&&Ep(r,s),D=d.createElement("script"),Si(D),Cr(D,"link",r),d.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},_.set(M,D))}}function Vm(r,s,d,_){var M=(M=Zt.current)?Tp(M):null;if(!M)throw Error(S(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(s=Cu(d.href),d=ps(M).hoistableStyles,_=d.get(s),_||(_={type:"style",instance:null,count:0,state:null},d.set(s,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=Cu(d.href);var D=ps(M).hoistableStyles,q=D.get(r);if(q||(M=M.ownerDocument||M,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},D.set(r,q),(D=M.querySelector(Lh(r)))&&!D._p&&(q.instance=D,q.state.loading=5),Rr.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Rr.set(r,d),D||Gm(M,r,d,q.state))),s&&_===null)throw Error(S(528,""));return q}if(s&&_!==null)throw Error(S(529,""));return null;case"script":return s=d.async,d=d.src,typeof d=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=zl(d),d=ps(M).hoistableScripts,_=d.get(s),_||(_={type:"script",instance:null,count:0,state:null},d.set(s,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,r))}}function Cu(r){return'href="'+Nr(r)+'"'}function Lh(r){return'link[rel="stylesheet"]['+r+"]"}function qm(r){return re({},r,{"data-precedence":r.precedence,precedence:null})}function Gm(r,s,d,_){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?_.loading=1:(s=r.createElement("link"),_.preload=s,s.addEventListener("load",function(){return _.loading|=1}),s.addEventListener("error",function(){return _.loading|=2}),Cr(s,"link",d),Si(s),r.head.appendChild(s))}function zl(r){return'[src="'+Nr(r)+'"]'}function Oh(r){return"script[async]"+r}function Zm(r,s,d){if(s.count++,s.instance===null)switch(s.type){case"style":var _=r.querySelector('style[data-href~="'+Nr(d.href)+'"]');if(_)return s.instance=_,Si(_),_;var M=re({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return _=(r.ownerDocument||r).createElement("style"),Si(_),Cr(_,"style",M),Pl(_,d.precedence,r),s.instance=_;case"stylesheet":M=Cu(d.href);var D=r.querySelector(Lh(M));if(D)return s.state.loading|=4,s.instance=D,Si(D),D;_=qm(d),(M=Rr.get(M))&&qd(_,M),D=(r.ownerDocument||r).createElement("link"),Si(D);var q=D;return q._p=new Promise(function(te,Ee){q.onload=te,q.onerror=Ee}),Cr(D,"link",_),s.state.loading|=4,Pl(D,d.precedence,r),s.instance=D;case"script":return D=zl(d.src),(M=r.querySelector(Oh(D)))?(s.instance=M,Si(M),M):(_=d,(M=Rr.get(D))&&(_=re({},d),Ep(_,M)),r=r.ownerDocument||r,M=r.createElement("script"),Si(M),Cr(M,"link",_),r.head.appendChild(M),s.instance=M);case"void":return null;default:throw Error(S(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(_=s.instance,s.state.loading|=4,Pl(_,d.precedence,r));return s.instance}function Pl(r,s,d){for(var _=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),M=_.length?_[_.length-1]:null,D=M,q=0;q<_.length;q++){var te=_[q];if(te.dataset.precedence===s)D=te;else if(D!==M)break}D?D.parentNode.insertBefore(r,D.nextSibling):(s=d.nodeType===9?d.head:d,s.insertBefore(r,s.firstChild))}function qd(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function Ep(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Mp=null;function Hm(r,s,d){if(Mp===null){var _=new Map,M=Mp=new Map;M.set(d,_)}else M=Mp,_=M.get(d),_||(_=new Map,M.set(d,_));if(_.has(r))return _;for(_.set(r,null),d=d.getElementsByTagName(r),M=0;M<d.length;M++){var D=d[M];if(!(D[en]||D[_t]||r==="link"&&D.getAttribute("rel")==="stylesheet")&&D.namespaceURI!=="http://www.w3.org/2000/svg"){var q=D.getAttribute(s)||"";q=r+q;var te=_.get(q);te?te.push(D):_.set(q,[D])}}return _}function Gd(r,s,d){r=r.ownerDocument||r,r.head.insertBefore(d,s==="title"?r.querySelector("head > title"):null)}function Ap(r,s,d){if(d===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(r=s.disabled,typeof s.precedence=="string"&&r==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Zd(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function $m(r,s,d,_){if(d.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var M=Cu(_.href),D=s.querySelector(Lh(M));if(D){s=D._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=$d.bind(r),s.then(r,r)),d.state.loading|=4,d.instance=D,Si(D);return}D=s.ownerDocument||s,_=qm(_),(M=Rr.get(M))&&qd(_,M),D=D.createElement("link"),Si(D);var q=D;q._p=new Promise(function(te,Ee){q.onload=te,q.onerror=Ee}),Cr(D,"link",_),d.instance=D}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,s),(s=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=$d.bind(r),s.addEventListener("load",d),s.addEventListener("error",d))}}var Hd=0;function Xm(r,s){return r.stylesheets&&r.count===0&&Yd(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var _=setTimeout(function(){if(r.stylesheets&&Yd(r,r.stylesheets),r.unsuspend){var D=r.unsuspend;r.unsuspend=null,D()}},6e4+s);0<r.imgBytes&&Hd===0&&(Hd=62500*kh());var M=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Yd(r,r.stylesheets),r.unsuspend)){var D=r.unsuspend;r.unsuspend=null,D()}},(r.imgBytes>Hd?50:800)+s);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(_),clearTimeout(M)}}:null}function $d(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Yd(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Xd=null;function Yd(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Xd=new Map,s.forEach(ny,r),Xd=null,$d.call(r))}function ny(r,s){if(!(s.state.loading&4)){var d=Xd.get(r);if(d)var _=d.get(null);else{d=new Map,Xd.set(r,d);for(var M=r.querySelectorAll("link[data-precedence],style[data-precedence]"),D=0;D<M.length;D++){var q=M[D];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(d.set(q.dataset.precedence,q),_=q)}_&&d.set(null,_)}M=s.instance,q=M.getAttribute("data-precedence"),D=d.get(q)||_,D===_&&d.set(null,M),d.set(q,M),this.count++,_=$d.bind(this),M.addEventListener("load",_),M.addEventListener("error",_),D?D.parentNode.insertBefore(M,D.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(M,r.firstChild)),s.state.loading|=4}}var Bh={$$typeof:ht,Provider:null,Consumer:null,_currentValue:mt,_currentValue2:mt,_threadCount:0};function r_(r,s,d,_,M,D,q,te,Ee){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ui(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ui(0),this.hiddenUpdates=Ui(null),this.identifierPrefix=_,this.onUncaughtError=M,this.onCaughtError=D,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ee,this.incompleteTransitions=new Map}function Ym(r,s,d,_,M,D,q,te,Ee,Xe,dt,xt){return r=new r_(r,s,d,q,Ee,Xe,dt,xt,te),s=1,D===!0&&(s|=24),D=fa(3,null,null,s),r.current=D,D.stateNode=r,s=As(),s.refCount++,r.pooledCache=s,s.refCount++,D.memoizedState={element:_,isDehydrated:d,cache:s},ph(D),r}function iy(r){return r?(r=cn,r):cn}function ry(r,s,d,_,M,D){M=iy(M),_.context===null?_.context=M:_.pendingContext=M,_=Is(s),_.payload={element:d},D=D===void 0?null:D,D!==null&&(_.callback=D),d=Js(r,_,s),d!==null&&(qa(d,r,s),Ra(d,r,s))}function Cp(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function zp(r,s){Cp(r,s),(r=r.alternate)&&Cp(r,s)}function ay(r){if(r.tag===13||r.tag===31){var s=Da(r,67108864);s!==null&&qa(s,r,67108864),zp(r,67108864)}}function sy(r){if(r.tag===13||r.tag===31){var s=Va();s=Vs(s);var d=Da(r,s);d!==null&&qa(d,r,s),zp(r,s)}}var Wd=!0;function Kd(r,s,d,_){var M=we.T;we.T=null;var D=$e.p;try{$e.p=2,Wm(r,s,d,_)}finally{$e.p=D,we.T=M}}function oy(r,s,d,_){var M=we.T;we.T=null;var D=$e.p;try{$e.p=8,Wm(r,s,d,_)}finally{$e.p=D,we.T=M}}function Wm(r,s,d,_){if(Wd){var M=Qd(_);if(M===null)jo(r,s,_,Nh,d),ly(r,_);else if(s_(M,r,s,d,_))_.stopPropagation();else if(ly(r,_),s&4&&-1<a_.indexOf(r)){for(;M!==null;){var D=qs(M);if(D!==null)switch(D.tag){case 3:if(D=D.stateNode,D.current.memoizedState.isDehydrated){var q=Oe(D.pendingLanes);if(q!==0){var te=D;for(te.pendingLanes|=2,te.entangledLanes|=2;q;){var Ee=1<<31-Je(q);te.entanglements[1]|=Ee,q&=~Ee}lo(D),(Kn&6)===0&&(Id=Li()+500,os(0))}}break;case 31:case 13:te=Da(D,2),te!==null&&qa(te,D,2),Rd(),zp(D,2)}if(D=Qd(_),D===null&&jo(r,s,_,Nh,d),D===M)break;M=D}M!==null&&_.stopPropagation()}else jo(r,s,_,null,d)}}function Qd(r){return r=Nc(r),Pp(r)}var Nh=null;function Pp(r){if(Nh=null,r=ds(r),r!==null){var s=k(r);if(s===null)r=null;else{var d=s.tag;if(d===13){if(r=A(s),r!==null)return r;r=null}else if(d===31){if(r=l(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Nh=r,null}function zu(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(nr()){case Be:return 2;case Z:return 8;case $:case K:return 32;case ue:return 268435456;default:return 32}default:return 32}}var Dp=!1,Tc=null,Ns=null,Sc=null,Jd=new Map,Fh=new Map,Dl=[],a_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ly(r,s){switch(r){case"focusin":case"focusout":Tc=null;break;case"dragenter":case"dragleave":Ns=null;break;case"mouseover":case"mouseout":Sc=null;break;case"pointerover":case"pointerout":Jd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fh.delete(s.pointerId)}}function ef(r,s,d,_,M,D){return r===null||r.nativeEvent!==D?(r={blockedOn:s,domEventName:d,eventSystemFlags:_,nativeEvent:D,targetContainers:[M]},s!==null&&(s=qs(s),s!==null&&ay(s)),r):(r.eventSystemFlags|=_,s=r.targetContainers,M!==null&&s.indexOf(M)===-1&&s.push(M),r)}function s_(r,s,d,_,M){switch(s){case"focusin":return Tc=ef(Tc,r,s,d,_,M),!0;case"dragenter":return Ns=ef(Ns,r,s,d,_,M),!0;case"mouseover":return Sc=ef(Sc,r,s,d,_,M),!0;case"pointerover":var D=M.pointerId;return Jd.set(D,ef(Jd.get(D)||null,r,s,d,_,M)),!0;case"gotpointercapture":return D=M.pointerId,Fh.set(D,ef(Fh.get(D)||null,r,s,d,_,M)),!0}return!1}function cy(r){var s=ds(r.target);if(s!==null){var d=k(s);if(d!==null){if(s=d.tag,s===13){if(s=A(d),s!==null){r.blockedOn=s,dr(r.priority,function(){sy(d)});return}}else if(s===31){if(s=l(d),s!==null){r.blockedOn=s,dr(r.priority,function(){sy(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function tf(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=Qd(r.nativeEvent);if(d===null){d=r.nativeEvent;var _=new d.constructor(d.type,d);Qh=_,d.target.dispatchEvent(_),Qh=null}else return s=qs(d),s!==null&&ay(s),r.blockedOn=d,!1;s.shift()}return!0}function uy(r,s,d){tf(r)&&d.delete(s)}function nf(){Dp=!1,Tc!==null&&tf(Tc)&&(Tc=null),Ns!==null&&tf(Ns)&&(Ns=null),Sc!==null&&tf(Sc)&&(Sc=null),Jd.forEach(uy),Fh.forEach(uy)}function Ip(r,s){r.blockedOn===s&&(r.blockedOn=null,Dp||(Dp=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,nf)))}var kp=null;function hy(r){kp!==r&&(kp=r,h.unstable_scheduleCallback(h.unstable_NormalPriority,function(){kp===r&&(kp=null);for(var s=0;s<r.length;s+=3){var d=r[s],_=r[s+1],M=r[s+2];if(typeof _!="function"){if(Pp(_||d)===null)continue;break}var D=qs(d);D!==null&&(r.splice(s,3),s-=3,Ci(D,{pending:!0,data:M,method:d.method,action:_},_,M))}}))}function Ec(r){function s(Ee){return Ip(Ee,r)}Tc!==null&&Ip(Tc,r),Ns!==null&&Ip(Ns,r),Sc!==null&&Ip(Sc,r),Jd.forEach(s),Fh.forEach(s);for(var d=0;d<Dl.length;d++){var _=Dl[d];_.blockedOn===r&&(_.blockedOn=null)}for(;0<Dl.length&&(d=Dl[0],d.blockedOn===null);)cy(d),d.blockedOn===null&&Dl.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(_=0;_<d.length;_+=3){var M=d[_],D=d[_+1],q=M[Fe]||null;if(typeof D=="function")q||hy(d);else if(q){var te=null;if(D&&D.hasAttribute("formAction")){if(M=D,q=D[Fe]||null)te=q.formAction;else if(Pp(M)!==null)continue}else te=q.action;typeof te=="function"?d[_+1]=te:(d.splice(_,3),_-=3),hy(d)}}}function Km(){function r(D){D.canIntercept&&D.info==="react-transition"&&D.intercept({handler:function(){return new Promise(function(q){return M=q})},focusReset:"manual",scroll:"manual"})}function s(){M!==null&&(M(),M=null),_||setTimeout(d,20)}function d(){if(!_&&!navigation.transition){var D=navigation.currentEntry;D&&D.url!=null&&navigation.navigate(D.url,{state:D.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var _=!1,M=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(d,100),function(){_=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),M!==null&&(M(),M=null)}}}function Qm(r){this._internalRoot=r}Rp.prototype.render=Qm.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(S(409));var d=s.current,_=Va();ry(d,_,r,s,null,null)},Rp.prototype.unmount=Qm.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;ry(r.current,2,null,r,null,null),Rd(),s[Tt]=null}};function Rp(r){this._internalRoot=r}Rp.prototype.unstable_scheduleHydration=function(r){if(r){var s=hr();r={blockedOn:null,target:r,priority:s};for(var d=0;d<Dl.length&&s!==0&&s<Dl[d].priority;d++);Dl.splice(d,0,r),d===0&&cy(r)}};var Jm=m.version;if(Jm!=="19.2.3")throw Error(S(527,Jm,"19.2.3"));$e.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(S(188)):(r=Object.keys(r).join(","),Error(S(268,r)));return r=W(s),r=r!==null?ne(r):null,r=r===null?null:r.stateNode,r};var dy={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:we,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lp.isDisabled&&Lp.supportsFiber)try{ze=Lp.inject(dy),Se=Lp}catch{}}return ag.createRoot=function(r,s){if(!z(r))throw Error(S(299));var d=!1,_="",M=_h,D=ro,q=ao;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(_=s.identifierPrefix),s.onUncaughtError!==void 0&&(M=s.onUncaughtError),s.onCaughtError!==void 0&&(D=s.onCaughtError),s.onRecoverableError!==void 0&&(q=s.onRecoverableError)),s=Ym(r,1,!1,null,null,d,_,null,M,D,q,Km),r[Tt]=s.current,Pm(r),new Qm(s)},ag.hydrateRoot=function(r,s,d){if(!z(r))throw Error(S(299));var _=!1,M="",D=_h,q=ro,te=ao,Ee=null;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(M=d.identifierPrefix),d.onUncaughtError!==void 0&&(D=d.onUncaughtError),d.onCaughtError!==void 0&&(q=d.onCaughtError),d.onRecoverableError!==void 0&&(te=d.onRecoverableError),d.formState!==void 0&&(Ee=d.formState)),s=Ym(r,1,!0,s,d??null,_,M,Ee,D,q,te,Km),s.context=iy(null),d=s.current,_=Va(),_=Vs(_),M=Is(_),M.callback=null,Js(d,M,_),d=_,s.current.lanes=d,Ln(s,d),lo(s),r[Tt]=s.current,Pm(r),new Rp(s)},ag.version="19.2.3",ag}var lv;function F1(){if(lv)return __.exports;lv=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(m){console.error(m)}}return h(),__.exports=N1(),__.exports}var j1=F1();const U1=Ly(j1),V1="modulepreload",q1=function(h){return"/parlens-pwa/"+h},cv={},ox=function(m,b,S){let z=Promise.resolve();if(b&&b.length>0){let W=function(ne){return Promise.all(ne.map(re=>Promise.resolve(re).then(Me=>({status:"fulfilled",value:Me}),Me=>({status:"rejected",reason:Me}))))};var A=W;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),N=l?.nonce||l?.getAttribute("nonce");z=W(b.map(ne=>{if(ne=q1(ne),ne in cv)return;cv[ne]=!0;const re=ne.endsWith(".css"),Me=re?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${ne}"]${Me}`))return;const be=document.createElement("link");if(be.rel=re?"stylesheet":V1,re||(be.as="script"),be.crossOrigin="",be.href=ne,N&&be.setAttribute("nonce",N),document.head.appendChild(be),re)return new Promise((Ie,fe)=>{be.addEventListener("load",Ie),be.addEventListener("error",()=>fe(new Error(`Unable to preload CSS for ${ne}`)))})}))}function k(l){const N=new Event("vite:preloadError",{cancelable:!0});if(N.payload=l,window.dispatchEvent(N),!N.defaultPrevented)throw l}return z.then(l=>{for(const N of l||[])N.status==="rejected"&&k(N.reason);return m().catch(k)})};function uv(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`Wrong positive integer: ${h}`)}function lx(h,...m){if(!(h instanceof Uint8Array))throw new Error("Expected Uint8Array");if(m.length>0&&!m.includes(h.length))throw new Error(`Expected Uint8Array of length ${m}, not of length=${h.length}`)}function G1(h){if(typeof h!="function"||typeof h.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");uv(h.outputLen),uv(h.blockLen)}function Sy(h,m=!0){if(h.destroyed)throw new Error("Hash instance has been destroyed");if(m&&h.finished)throw new Error("Hash#digest() has already been called")}function Z1(h,m){lx(h);const b=m.outputLen;if(h.length<b)throw new Error(`digestInto() expects output buffer of length at least ${b}`)}const w_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const cx=h=>h instanceof Uint8Array,T_=h=>new DataView(h.buffer,h.byteOffset,h.byteLength),Ac=(h,m)=>h<<32-m|h>>>m,H1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!H1)throw new Error("Non little-endian hardware is not supported");function $1(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function s0(h){if(typeof h=="string"&&(h=$1(h)),!cx(h))throw new Error(`expected Uint8Array, got ${typeof h}`);return h}function X1(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!cx(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}let ux=class{clone(){return this._cloneInto()}};function Y1(h){const m=S=>h().update(s0(S)).digest(),b=h();return m.outputLen=b.outputLen,m.blockLen=b.blockLen,m.create=()=>h(),m}function hx(h=32){if(w_&&typeof w_.getRandomValues=="function")return w_.getRandomValues(new Uint8Array(h));throw new Error("crypto.getRandomValues must be defined")}function W1(h,m,b,S){if(typeof h.setBigUint64=="function")return h.setBigUint64(m,b,S);const z=BigInt(32),k=BigInt(4294967295),A=Number(b>>z&k),l=Number(b&k),N=S?4:0,W=S?0:4;h.setUint32(m+N,A,S),h.setUint32(m+W,l,S)}let K1=class extends ux{constructor(m,b,S,z){super(),this.blockLen=m,this.outputLen=b,this.padOffset=S,this.isLE=z,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=T_(this.buffer)}update(m){Sy(this);const{view:b,buffer:S,blockLen:z}=this;m=s0(m);const k=m.length;for(let A=0;A<k;){const l=Math.min(z-this.pos,k-A);if(l===z){const N=T_(m);for(;z<=k-A;A+=z)this.process(N,A);continue}S.set(m.subarray(A,A+l),this.pos),this.pos+=l,A+=l,this.pos===z&&(this.process(b,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){Sy(this),Z1(m,this),this.finished=!0;const{buffer:b,view:S,blockLen:z,isLE:k}=this;let{pos:A}=this;b[A++]=128,this.buffer.subarray(A).fill(0),this.padOffset>z-A&&(this.process(S,0),A=0);for(let re=A;re<z;re++)b[re]=0;W1(S,z-8,BigInt(this.length*8),k),this.process(S,0);const l=T_(m),N=this.outputLen;if(N%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const W=N/4,ne=this.get();if(W>ne.length)throw new Error("_sha2: outputLen bigger than state");for(let re=0;re<W;re++)l.setUint32(4*re,ne[re],k)}digest(){const{buffer:m,outputLen:b}=this;this.digestInto(m);const S=m.slice(0,b);return this.destroy(),S}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:b,buffer:S,length:z,finished:k,destroyed:A,pos:l}=this;return m.length=z,m.pos=l,m.finished=k,m.destroyed=A,z%b&&m.buffer.set(S),m}};const Q1=(h,m,b)=>h&m^~h&b,J1=(h,m,b)=>h&m^h&b^m&b,ew=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Uh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vh=new Uint32Array(64);let tw=class extends K1{constructor(){super(64,32,8,!1),this.A=Uh[0]|0,this.B=Uh[1]|0,this.C=Uh[2]|0,this.D=Uh[3]|0,this.E=Uh[4]|0,this.F=Uh[5]|0,this.G=Uh[6]|0,this.H=Uh[7]|0}get(){const{A:m,B:b,C:S,D:z,E:k,F:A,G:l,H:N}=this;return[m,b,S,z,k,A,l,N]}set(m,b,S,z,k,A,l,N){this.A=m|0,this.B=b|0,this.C=S|0,this.D=z|0,this.E=k|0,this.F=A|0,this.G=l|0,this.H=N|0}process(m,b){for(let re=0;re<16;re++,b+=4)Vh[re]=m.getUint32(b,!1);for(let re=16;re<64;re++){const Me=Vh[re-15],be=Vh[re-2],Ie=Ac(Me,7)^Ac(Me,18)^Me>>>3,fe=Ac(be,17)^Ac(be,19)^be>>>10;Vh[re]=fe+Vh[re-7]+Ie+Vh[re-16]|0}let{A:S,B:z,C:k,D:A,E:l,F:N,G:W,H:ne}=this;for(let re=0;re<64;re++){const Me=Ac(l,6)^Ac(l,11)^Ac(l,25),be=ne+Me+Q1(l,N,W)+ew[re]+Vh[re]|0,fe=(Ac(S,2)^Ac(S,13)^Ac(S,22))+J1(S,z,k)|0;ne=W,W=N,N=l,l=A+be|0,A=k,k=z,z=S,S=be+fe|0}S=S+this.A|0,z=z+this.B|0,k=k+this.C|0,A=A+this.D|0,l=l+this.E|0,N=N+this.F|0,W=W+this.G|0,ne=ne+this.H|0,this.set(S,z,k,A,l,N,W,ne)}roundClean(){Vh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const B_=Y1(()=>new tw);const dx=BigInt(0),Oy=BigInt(1),nw=BigInt(2),By=h=>h instanceof Uint8Array,iw=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function Gp(h){if(!By(h))throw new Error("Uint8Array expected");let m="";for(let b=0;b<h.length;b++)m+=iw[h[b]];return m}function fx(h){const m=h.toString(16);return m.length&1?`0${m}`:m}function o0(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);return BigInt(h===""?"0":`0x${h}`)}function Zp(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const b=new Uint8Array(m/2);for(let S=0;S<b.length;S++){const z=S*2,k=h.slice(z,z+2),A=Number.parseInt(k,16);if(Number.isNaN(A)||A<0)throw new Error("Invalid byte sequence");b[S]=A}return b}function js(h){return o0(Gp(h))}function l0(h){if(!By(h))throw new Error("Uint8Array expected");return o0(Gp(Uint8Array.from(h).reverse()))}function $h(h,m){return Zp(h.toString(16).padStart(m*2,"0"))}function c0(h,m){return $h(h,m).reverse()}function rw(h){return Zp(fx(h))}function Ha(h,m,b){let S;if(typeof m=="string")try{S=Zp(m)}catch(k){throw new Error(`${h} must be valid hex string, got "${m}". Cause: ${k}`)}else if(By(m))S=Uint8Array.from(m);else throw new Error(`${h} must be hex string or Uint8Array`);const z=S.length;if(typeof b=="number"&&z!==b)throw new Error(`${h} expected ${b} bytes, got ${z}`);return S}function pf(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!By(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}function aw(h,m){if(h.length!==m.length)return!1;for(let b=0;b<h.length;b++)if(h[b]!==m[b])return!1;return!0}function sw(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function ow(h){let m;for(m=0;h>dx;h>>=Oy,m+=1);return m}function lw(h,m){return h>>BigInt(m)&Oy}const cw=(h,m,b)=>h|(b?Oy:dx)<<BigInt(m),u0=h=>(nw<<BigInt(h-1))-Oy,S_=h=>new Uint8Array(h),hv=h=>Uint8Array.from(h);function px(h,m,b){if(typeof h!="number"||h<2)throw new Error("hashLen must be a number");if(typeof m!="number"||m<2)throw new Error("qByteLen must be a number");if(typeof b!="function")throw new Error("hmacFn must be a function");let S=S_(h),z=S_(h),k=0;const A=()=>{S.fill(1),z.fill(0),k=0},l=(...re)=>b(z,S,...re),N=(re=S_())=>{z=l(hv([0]),re),S=l(),re.length!==0&&(z=l(hv([1]),re),S=l())},W=()=>{if(k++>=1e3)throw new Error("drbg: tried 1000 values");let re=0;const Me=[];for(;re<m;){S=l();const be=S.slice();Me.push(be),re+=S.length}return pf(...Me)};return(re,Me)=>{A(),N(re);let be;for(;!(be=Me(W()));)N();return A(),be}}const uw={bigint:h=>typeof h=="bigint",function:h=>typeof h=="function",boolean:h=>typeof h=="boolean",string:h=>typeof h=="string",stringOrUint8Array:h=>typeof h=="string"||h instanceof Uint8Array,isSafeInteger:h=>Number.isSafeInteger(h),array:h=>Array.isArray(h),field:(h,m)=>m.Fp.isValid(h),hash:h=>typeof h=="function"&&Number.isSafeInteger(h.outputLen)};function pg(h,m,b={}){const S=(z,k,A)=>{const l=uw[k];if(typeof l!="function")throw new Error(`Invalid validator "${k}", expected function`);const N=h[z];if(!(A&&N===void 0)&&!l(N,h))throw new Error(`Invalid param ${String(z)}=${N} (${typeof N}), expected ${k}`)};for(const[z,k]of Object.entries(m))S(z,k,!1);for(const[z,k]of Object.entries(b))S(z,k,!0);return h}const hw=Object.freeze(Object.defineProperty({__proto__:null,bitGet:lw,bitLen:ow,bitMask:u0,bitSet:cw,bytesToHex:Gp,bytesToNumberBE:js,bytesToNumberLE:l0,concatBytes:pf,createHmacDrbg:px,ensureBytes:Ha,equalBytes:aw,hexToBytes:Zp,hexToNumber:o0,numberToBytesBE:$h,numberToBytesLE:c0,numberToHexUnpadded:fx,numberToVarBytesBE:rw,utf8ToBytes:sw,validateObject:pg},Symbol.toStringTag,{value:"Module"}));const la=BigInt(0),zr=BigInt(1),uf=BigInt(2),dw=BigInt(3),N_=BigInt(4),dv=BigInt(5),fv=BigInt(8);BigInt(9);BigInt(16);function Ea(h,m){const b=h%m;return b>=la?b:m+b}function fw(h,m,b){if(b<=la||m<la)throw new Error("Expected power/modulo > 0");if(b===zr)return la;let S=zr;for(;m>la;)m&zr&&(S=S*h%b),h=h*h%b,m>>=zr;return S}function qo(h,m,b){let S=h;for(;m-- >la;)S*=S,S%=b;return S}function F_(h,m){if(h===la||m<=la)throw new Error(`invert: expected positive integers, got n=${h} mod=${m}`);let b=Ea(h,m),S=m,z=la,k=zr;for(;b!==la;){const l=S/b,N=S%b,W=z-k*l;S=b,b=N,z=k,k=W}if(S!==zr)throw new Error("invert: does not exist");return Ea(z,m)}function pw(h){const m=(h-zr)/uf;let b,S,z;for(b=h-zr,S=0;b%uf===la;b/=uf,S++);for(z=uf;z<h&&fw(z,m,h)!==h-zr;z++);if(S===1){const A=(h+zr)/N_;return function(N,W){const ne=N.pow(W,A);if(!N.eql(N.sqr(ne),W))throw new Error("Cannot find square root");return ne}}const k=(b+zr)/uf;return function(l,N){if(l.pow(N,m)===l.neg(l.ONE))throw new Error("Cannot find square root");let W=S,ne=l.pow(l.mul(l.ONE,z),b),re=l.pow(N,k),Me=l.pow(N,b);for(;!l.eql(Me,l.ONE);){if(l.eql(Me,l.ZERO))return l.ZERO;let be=1;for(let fe=l.sqr(Me);be<W&&!l.eql(fe,l.ONE);be++)fe=l.sqr(fe);const Ie=l.pow(ne,zr<<BigInt(W-be-1));ne=l.sqr(Ie),re=l.mul(re,Ie),Me=l.mul(Me,ne),W=be}return re}}function mw(h){if(h%N_===dw){const m=(h+zr)/N_;return function(S,z){const k=S.pow(z,m);if(!S.eql(S.sqr(k),z))throw new Error("Cannot find square root");return k}}if(h%fv===dv){const m=(h-dv)/fv;return function(S,z){const k=S.mul(z,uf),A=S.pow(k,m),l=S.mul(z,A),N=S.mul(S.mul(l,uf),A),W=S.mul(l,S.sub(N,S.ONE));if(!S.eql(S.sqr(W),z))throw new Error("Cannot find square root");return W}}return pw(h)}const gw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function yw(h){const m={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},b=gw.reduce((S,z)=>(S[z]="function",S),m);return pg(h,b)}function _w(h,m,b){if(b<la)throw new Error("Expected power > 0");if(b===la)return h.ONE;if(b===zr)return m;let S=h.ONE,z=m;for(;b>la;)b&zr&&(S=h.mul(S,z)),z=h.sqr(z),b>>=zr;return S}function vw(h,m){const b=new Array(m.length),S=m.reduce((k,A,l)=>h.is0(A)?k:(b[l]=k,h.mul(k,A)),h.ONE),z=h.inv(S);return m.reduceRight((k,A,l)=>h.is0(A)?k:(b[l]=h.mul(k,b[l]),h.mul(k,A)),z),b}function mx(h,m){const b=m!==void 0?m:h.toString(2).length,S=Math.ceil(b/8);return{nBitLength:b,nByteLength:S}}function xw(h,m,b=!1,S={}){if(h<=la)throw new Error(`Expected Field ORDER > 0, got ${h}`);const{nBitLength:z,nByteLength:k}=mx(h,m);if(k>2048)throw new Error("Field lengths over 2048 bytes are not supported");const A=mw(h),l=Object.freeze({ORDER:h,BITS:z,BYTES:k,MASK:u0(z),ZERO:la,ONE:zr,create:N=>Ea(N,h),isValid:N=>{if(typeof N!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof N}`);return la<=N&&N<h},is0:N=>N===la,isOdd:N=>(N&zr)===zr,neg:N=>Ea(-N,h),eql:(N,W)=>N===W,sqr:N=>Ea(N*N,h),add:(N,W)=>Ea(N+W,h),sub:(N,W)=>Ea(N-W,h),mul:(N,W)=>Ea(N*W,h),pow:(N,W)=>_w(l,N,W),div:(N,W)=>Ea(N*F_(W,h),h),sqrN:N=>N*N,addN:(N,W)=>N+W,subN:(N,W)=>N-W,mulN:(N,W)=>N*W,inv:N=>F_(N,h),sqrt:S.sqrt||(N=>A(l,N)),invertBatch:N=>vw(l,N),cmov:(N,W,ne)=>ne?W:N,toBytes:N=>b?c0(N,k):$h(N,k),fromBytes:N=>{if(N.length!==k)throw new Error(`Fp.fromBytes: expected ${k}, got ${N.length}`);return b?l0(N):js(N)}});return Object.freeze(l)}function gx(h){if(typeof h!="bigint")throw new Error("field order must be bigint");const m=h.toString(2).length;return Math.ceil(m/8)}function yx(h){const m=gx(h);return m+Math.ceil(m/2)}function bw(h,m,b=!1){const S=h.length,z=gx(m),k=yx(m);if(S<16||S<k||S>1024)throw new Error(`expected ${k}-1024 bytes of input, got ${S}`);const A=b?js(h):l0(h),l=Ea(A,m-zr)+zr;return b?c0(l,z):$h(l,z)}const ww=BigInt(0),E_=BigInt(1);function Tw(h,m){const b=(z,k)=>{const A=k.negate();return z?A:k},S=z=>{const k=Math.ceil(m/z)+1,A=2**(z-1);return{windows:k,windowSize:A}};return{constTimeNegate:b,unsafeLadder(z,k){let A=h.ZERO,l=z;for(;k>ww;)k&E_&&(A=A.add(l)),l=l.double(),k>>=E_;return A},precomputeWindow(z,k){const{windows:A,windowSize:l}=S(k),N=[];let W=z,ne=W;for(let re=0;re<A;re++){ne=W,N.push(ne);for(let Me=1;Me<l;Me++)ne=ne.add(W),N.push(ne);W=ne.double()}return N},wNAF(z,k,A){const{windows:l,windowSize:N}=S(z);let W=h.ZERO,ne=h.BASE;const re=BigInt(2**z-1),Me=2**z,be=BigInt(z);for(let Ie=0;Ie<l;Ie++){const fe=Ie*N;let ie=Number(A&re);A>>=be,ie>N&&(ie-=Me,A+=E_);const Le=fe,Ke=fe+Math.abs(ie)-1,ht=Ie%2!==0,Ct=ie<0;ie===0?ne=ne.add(b(ht,k[Le])):W=W.add(b(Ct,k[Ke]))}return{p:W,f:ne}},wNAFCached(z,k,A,l){const N=z._WINDOW_SIZE||1;let W=k.get(z);return W||(W=this.precomputeWindow(z,N),N!==1&&k.set(z,l(W))),this.wNAF(N,W,A)}}}function _x(h){return yw(h.Fp),pg(h,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...mx(h.n,h.nBitLength),...h,p:h.Fp.ORDER})}function Sw(h){const m=_x(h);pg(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:b,Fp:S,a:z}=m;if(b){if(!S.eql(z,S.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof b!="object"||typeof b.beta!="bigint"||typeof b.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})}const{bytesToNumberBE:Ew,hexToBytes:Mw}=hw,df={Err:class extends Error{constructor(m=""){super(m)}},_parseInt(h){const{Err:m}=df;if(h.length<2||h[0]!==2)throw new m("Invalid signature integer tag");const b=h[1],S=h.subarray(2,b+2);if(!b||S.length!==b)throw new m("Invalid signature integer: wrong length");if(S[0]&128)throw new m("Invalid signature integer: negative");if(S[0]===0&&!(S[1]&128))throw new m("Invalid signature integer: unnecessary leading zero");return{d:Ew(S),l:h.subarray(b+2)}},toSig(h){const{Err:m}=df,b=typeof h=="string"?Mw(h):h;if(!(b instanceof Uint8Array))throw new Error("ui8a expected");let S=b.length;if(S<2||b[0]!=48)throw new m("Invalid signature tag");if(b[1]!==S-2)throw new m("Invalid signature: incorrect length");const{d:z,l:k}=df._parseInt(b.subarray(2)),{d:A,l}=df._parseInt(k);if(l.length)throw new m("Invalid signature: left bytes after parsing");return{r:z,s:A}},hexFromSig(h){const m=W=>Number.parseInt(W[0],16)&8?"00"+W:W,b=W=>{const ne=W.toString(16);return ne.length&1?`0${ne}`:ne},S=m(b(h.s)),z=m(b(h.r)),k=S.length/2,A=z.length/2,l=b(k),N=b(A);return`30${b(A+k+4)}02${N}${z}02${l}${S}`}},Ru=BigInt(0),Go=BigInt(1);BigInt(2);const pv=BigInt(3);BigInt(4);function Aw(h){const m=Sw(h),{Fp:b}=m,S=m.toBytes||((Ie,fe,ie)=>{const Le=fe.toAffine();return pf(Uint8Array.from([4]),b.toBytes(Le.x),b.toBytes(Le.y))}),z=m.fromBytes||(Ie=>{const fe=Ie.subarray(1),ie=b.fromBytes(fe.subarray(0,b.BYTES)),Le=b.fromBytes(fe.subarray(b.BYTES,2*b.BYTES));return{x:ie,y:Le}});function k(Ie){const{a:fe,b:ie}=m,Le=b.sqr(Ie),Ke=b.mul(Le,Ie);return b.add(b.add(Ke,b.mul(Ie,fe)),ie)}if(!b.eql(b.sqr(m.Gy),k(m.Gx)))throw new Error("bad generator point: equation left != right");function A(Ie){return typeof Ie=="bigint"&&Ru<Ie&&Ie<m.n}function l(Ie){if(!A(Ie))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function N(Ie){const{allowedPrivateKeyLengths:fe,nByteLength:ie,wrapPrivateKey:Le,n:Ke}=m;if(fe&&typeof Ie!="bigint"){if(Ie instanceof Uint8Array&&(Ie=Gp(Ie)),typeof Ie!="string"||!fe.includes(Ie.length))throw new Error("Invalid key");Ie=Ie.padStart(ie*2,"0")}let ht;try{ht=typeof Ie=="bigint"?Ie:js(Ha("private key",Ie,ie))}catch{throw new Error(`private key must be ${ie} bytes, hex or bigint, not ${typeof Ie}`)}return Le&&(ht=Ea(ht,Ke)),l(ht),ht}const W=new Map;function ne(Ie){if(!(Ie instanceof re))throw new Error("ProjectivePoint expected")}class re{constructor(fe,ie,Le){if(this.px=fe,this.py=ie,this.pz=Le,fe==null||!b.isValid(fe))throw new Error("x required");if(ie==null||!b.isValid(ie))throw new Error("y required");if(Le==null||!b.isValid(Le))throw new Error("z required")}static fromAffine(fe){const{x:ie,y:Le}=fe||{};if(!fe||!b.isValid(ie)||!b.isValid(Le))throw new Error("invalid affine point");if(fe instanceof re)throw new Error("projective point not allowed");const Ke=ht=>b.eql(ht,b.ZERO);return Ke(ie)&&Ke(Le)?re.ZERO:new re(ie,Le,b.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(fe){const ie=b.invertBatch(fe.map(Le=>Le.pz));return fe.map((Le,Ke)=>Le.toAffine(ie[Ke])).map(re.fromAffine)}static fromHex(fe){const ie=re.fromAffine(z(Ha("pointHex",fe)));return ie.assertValidity(),ie}static fromPrivateKey(fe){return re.BASE.multiply(N(fe))}_setWindowSize(fe){this._WINDOW_SIZE=fe,W.delete(this)}assertValidity(){if(this.is0()){if(m.allowInfinityPoint&&!b.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:fe,y:ie}=this.toAffine();if(!b.isValid(fe)||!b.isValid(ie))throw new Error("bad point: x or y not FE");const Le=b.sqr(ie),Ke=k(fe);if(!b.eql(Le,Ke))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:fe}=this.toAffine();if(b.isOdd)return!b.isOdd(fe);throw new Error("Field doesn't support isOdd")}equals(fe){ne(fe);const{px:ie,py:Le,pz:Ke}=this,{px:ht,py:Ct,pz:zt}=fe,tt=b.eql(b.mul(ie,zt),b.mul(ht,Ke)),st=b.eql(b.mul(Le,zt),b.mul(Ct,Ke));return tt&&st}negate(){return new re(this.px,b.neg(this.py),this.pz)}double(){const{a:fe,b:ie}=m,Le=b.mul(ie,pv),{px:Ke,py:ht,pz:Ct}=this;let zt=b.ZERO,tt=b.ZERO,st=b.ZERO,ke=b.mul(Ke,Ke),ct=b.mul(ht,ht),it=b.mul(Ct,Ct),lt=b.mul(Ke,ht);return lt=b.add(lt,lt),st=b.mul(Ke,Ct),st=b.add(st,st),zt=b.mul(fe,st),tt=b.mul(Le,it),tt=b.add(zt,tt),zt=b.sub(ct,tt),tt=b.add(ct,tt),tt=b.mul(zt,tt),zt=b.mul(lt,zt),st=b.mul(Le,st),it=b.mul(fe,it),lt=b.sub(ke,it),lt=b.mul(fe,lt),lt=b.add(lt,st),st=b.add(ke,ke),ke=b.add(st,ke),ke=b.add(ke,it),ke=b.mul(ke,lt),tt=b.add(tt,ke),it=b.mul(ht,Ct),it=b.add(it,it),ke=b.mul(it,lt),zt=b.sub(zt,ke),st=b.mul(it,ct),st=b.add(st,st),st=b.add(st,st),new re(zt,tt,st)}add(fe){ne(fe);const{px:ie,py:Le,pz:Ke}=this,{px:ht,py:Ct,pz:zt}=fe;let tt=b.ZERO,st=b.ZERO,ke=b.ZERO;const ct=m.a,it=b.mul(m.b,pv);let lt=b.mul(ie,ht),Et=b.mul(Le,Ct),qt=b.mul(Ke,zt),$t=b.add(ie,Le),ut=b.add(ht,Ct);$t=b.mul($t,ut),ut=b.add(lt,Et),$t=b.sub($t,ut),ut=b.add(ie,Ke);let we=b.add(ht,zt);return ut=b.mul(ut,we),we=b.add(lt,qt),ut=b.sub(ut,we),we=b.add(Le,Ke),tt=b.add(Ct,zt),we=b.mul(we,tt),tt=b.add(Et,qt),we=b.sub(we,tt),ke=b.mul(ct,ut),tt=b.mul(it,qt),ke=b.add(tt,ke),tt=b.sub(Et,ke),ke=b.add(Et,ke),st=b.mul(tt,ke),Et=b.add(lt,lt),Et=b.add(Et,lt),qt=b.mul(ct,qt),ut=b.mul(it,ut),Et=b.add(Et,qt),qt=b.sub(lt,qt),qt=b.mul(ct,qt),ut=b.add(ut,qt),lt=b.mul(Et,ut),st=b.add(st,lt),lt=b.mul(we,ut),tt=b.mul($t,tt),tt=b.sub(tt,lt),lt=b.mul($t,Et),ke=b.mul(we,ke),ke=b.add(ke,lt),new re(tt,st,ke)}subtract(fe){return this.add(fe.negate())}is0(){return this.equals(re.ZERO)}wNAF(fe){return be.wNAFCached(this,W,fe,ie=>{const Le=b.invertBatch(ie.map(Ke=>Ke.pz));return ie.map((Ke,ht)=>Ke.toAffine(Le[ht])).map(re.fromAffine)})}multiplyUnsafe(fe){const ie=re.ZERO;if(fe===Ru)return ie;if(l(fe),fe===Go)return this;const{endo:Le}=m;if(!Le)return be.unsafeLadder(this,fe);let{k1neg:Ke,k1:ht,k2neg:Ct,k2:zt}=Le.splitScalar(fe),tt=ie,st=ie,ke=this;for(;ht>Ru||zt>Ru;)ht&Go&&(tt=tt.add(ke)),zt&Go&&(st=st.add(ke)),ke=ke.double(),ht>>=Go,zt>>=Go;return Ke&&(tt=tt.negate()),Ct&&(st=st.negate()),st=new re(b.mul(st.px,Le.beta),st.py,st.pz),tt.add(st)}multiply(fe){l(fe);let ie=fe,Le,Ke;const{endo:ht}=m;if(ht){const{k1neg:Ct,k1:zt,k2neg:tt,k2:st}=ht.splitScalar(ie);let{p:ke,f:ct}=this.wNAF(zt),{p:it,f:lt}=this.wNAF(st);ke=be.constTimeNegate(Ct,ke),it=be.constTimeNegate(tt,it),it=new re(b.mul(it.px,ht.beta),it.py,it.pz),Le=ke.add(it),Ke=ct.add(lt)}else{const{p:Ct,f:zt}=this.wNAF(ie);Le=Ct,Ke=zt}return re.normalizeZ([Le,Ke])[0]}multiplyAndAddUnsafe(fe,ie,Le){const Ke=re.BASE,ht=(zt,tt)=>tt===Ru||tt===Go||!zt.equals(Ke)?zt.multiplyUnsafe(tt):zt.multiply(tt),Ct=ht(this,ie).add(ht(fe,Le));return Ct.is0()?void 0:Ct}toAffine(fe){const{px:ie,py:Le,pz:Ke}=this,ht=this.is0();fe==null&&(fe=ht?b.ONE:b.inv(Ke));const Ct=b.mul(ie,fe),zt=b.mul(Le,fe),tt=b.mul(Ke,fe);if(ht)return{x:b.ZERO,y:b.ZERO};if(!b.eql(tt,b.ONE))throw new Error("invZ was invalid");return{x:Ct,y:zt}}isTorsionFree(){const{h:fe,isTorsionFree:ie}=m;if(fe===Go)return!0;if(ie)return ie(re,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:fe,clearCofactor:ie}=m;return fe===Go?this:ie?ie(re,this):this.multiplyUnsafe(m.h)}toRawBytes(fe=!0){return this.assertValidity(),S(re,this,fe)}toHex(fe=!0){return Gp(this.toRawBytes(fe))}}re.BASE=new re(m.Gx,m.Gy,b.ONE),re.ZERO=new re(b.ZERO,b.ONE,b.ZERO);const Me=m.nBitLength,be=Tw(re,m.endo?Math.ceil(Me/2):Me);return{CURVE:m,ProjectivePoint:re,normPrivateKeyToScalar:N,weierstrassEquation:k,isWithinCurveOrder:A}}function Cw(h){const m=_x(h);return pg(m,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...m})}function zw(h){const m=Cw(h),{Fp:b,n:S}=m,z=b.BYTES+1,k=2*b.BYTES+1;function A(ut){return Ru<ut&&ut<b.ORDER}function l(ut){return Ea(ut,S)}function N(ut){return F_(ut,S)}const{ProjectivePoint:W,normPrivateKeyToScalar:ne,weierstrassEquation:re,isWithinCurveOrder:Me}=Aw({...m,toBytes(ut,we,$e){const mt=we.toAffine(),vt=b.toBytes(mt.x),Ut=pf;return $e?Ut(Uint8Array.from([we.hasEvenY()?2:3]),vt):Ut(Uint8Array.from([4]),vt,b.toBytes(mt.y))},fromBytes(ut){const we=ut.length,$e=ut[0],mt=ut.subarray(1);if(we===z&&($e===2||$e===3)){const vt=js(mt);if(!A(vt))throw new Error("Point is not on curve");const Ut=re(vt);let xe=b.sqrt(Ut);const Ye=(xe&Go)===Go;return($e&1)===1!==Ye&&(xe=b.neg(xe)),{x:vt,y:xe}}else if(we===k&&$e===4){const vt=b.fromBytes(mt.subarray(0,b.BYTES)),Ut=b.fromBytes(mt.subarray(b.BYTES,2*b.BYTES));return{x:vt,y:Ut}}else throw new Error(`Point of length ${we} was invalid. Expected ${z} compressed bytes or ${k} uncompressed bytes`)}}),be=ut=>Gp($h(ut,m.nByteLength));function Ie(ut){const we=S>>Go;return ut>we}function fe(ut){return Ie(ut)?l(-ut):ut}const ie=(ut,we,$e)=>js(ut.slice(we,$e));class Le{constructor(we,$e,mt){this.r=we,this.s=$e,this.recovery=mt,this.assertValidity()}static fromCompact(we){const $e=m.nByteLength;return we=Ha("compactSignature",we,$e*2),new Le(ie(we,0,$e),ie(we,$e,2*$e))}static fromDER(we){const{r:$e,s:mt}=df.toSig(Ha("DER",we));return new Le($e,mt)}assertValidity(){if(!Me(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!Me(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(we){return new Le(this.r,this.s,we)}recoverPublicKey(we){const{r:$e,s:mt,recovery:vt}=this,Ut=st(Ha("msgHash",we));if(vt==null||![0,1,2,3].includes(vt))throw new Error("recovery id invalid");const xe=vt===2||vt===3?$e+m.n:$e;if(xe>=b.ORDER)throw new Error("recovery id 2 or 3 invalid");const Ye=(vt&1)===0?"02":"03",wt=W.fromHex(Ye+be(xe)),Mt=N(xe),Ft=l(-Ut*Mt),Zt=l(mt*Mt),Vt=W.BASE.multiplyAndAddUnsafe(wt,Ft,Zt);if(!Vt)throw new Error("point at infinify");return Vt.assertValidity(),Vt}hasHighS(){return Ie(this.s)}normalizeS(){return this.hasHighS()?new Le(this.r,l(-this.s),this.recovery):this}toDERRawBytes(){return Zp(this.toDERHex())}toDERHex(){return df.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Zp(this.toCompactHex())}toCompactHex(){return be(this.r)+be(this.s)}}const Ke={isValidPrivateKey(ut){try{return ne(ut),!0}catch{return!1}},normPrivateKeyToScalar:ne,randomPrivateKey:()=>{const ut=yx(m.n);return bw(m.randomBytes(ut),m.n)},precompute(ut=8,we=W.BASE){return we._setWindowSize(ut),we.multiply(BigInt(3)),we}};function ht(ut,we=!0){return W.fromPrivateKey(ut).toRawBytes(we)}function Ct(ut){const we=ut instanceof Uint8Array,$e=typeof ut=="string",mt=(we||$e)&&ut.length;return we?mt===z||mt===k:$e?mt===2*z||mt===2*k:ut instanceof W}function zt(ut,we,$e=!0){if(Ct(ut))throw new Error("first arg must be private key");if(!Ct(we))throw new Error("second arg must be public key");return W.fromHex(we).multiply(ne(ut)).toRawBytes($e)}const tt=m.bits2int||function(ut){const we=js(ut),$e=ut.length*8-m.nBitLength;return $e>0?we>>BigInt($e):we},st=m.bits2int_modN||function(ut){return l(tt(ut))},ke=u0(m.nBitLength);function ct(ut){if(typeof ut!="bigint")throw new Error("bigint expected");if(!(Ru<=ut&&ut<ke))throw new Error(`bigint expected < 2^${m.nBitLength}`);return $h(ut,m.nByteLength)}function it(ut,we,$e=lt){if(["recovered","canonical"].some(Qt=>Qt in $e))throw new Error("sign() legacy options not supported");const{hash:mt,randomBytes:vt}=m;let{lowS:Ut,prehash:xe,extraEntropy:Ye}=$e;Ut==null&&(Ut=!0),ut=Ha("msgHash",ut),xe&&(ut=Ha("prehashed msgHash",mt(ut)));const wt=st(ut),Mt=ne(we),Ft=[ct(Mt),ct(wt)];if(Ye!=null){const Qt=Ye===!0?vt(b.BYTES):Ye;Ft.push(Ha("extraEntropy",Qt))}const Zt=pf(...Ft),Vt=wt;function ln(Qt){const Dn=tt(Qt);if(!Me(Dn))return;const ai=N(Dn),Rn=W.BASE.multiply(Dn).toAffine(),lr=l(Rn.x);if(lr===Ru)return;const Mn=l(ai*l(Vt+lr*Mt));if(Mn===Ru)return;let ci=(Rn.x===lr?0:2)|Number(Rn.y&Go),Ri=Mn;return Ut&&Ie(Mn)&&(Ri=fe(Mn),ci^=1),new Le(lr,Ri,ci)}return{seed:Zt,k2sig:ln}}const lt={lowS:m.lowS,prehash:!1},Et={lowS:m.lowS,prehash:!1};function qt(ut,we,$e=lt){const{seed:mt,k2sig:vt}=it(ut,we,$e),Ut=m;return px(Ut.hash.outputLen,Ut.nByteLength,Ut.hmac)(mt,vt)}W.BASE._setWindowSize(8);function $t(ut,we,$e,mt=Et){const vt=ut;if(we=Ha("msgHash",we),$e=Ha("publicKey",$e),"strict"in mt)throw new Error("options.strict was renamed to lowS");const{lowS:Ut,prehash:xe}=mt;let Ye,wt;try{if(typeof vt=="string"||vt instanceof Uint8Array)try{Ye=Le.fromDER(vt)}catch(Rn){if(!(Rn instanceof df.Err))throw Rn;Ye=Le.fromCompact(vt)}else if(typeof vt=="object"&&typeof vt.r=="bigint"&&typeof vt.s=="bigint"){const{r:Rn,s:lr}=vt;Ye=new Le(Rn,lr)}else throw new Error("PARSE");wt=W.fromHex($e)}catch(Rn){if(Rn.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Ut&&Ye.hasHighS())return!1;xe&&(we=m.hash(we));const{r:Mt,s:Ft}=Ye,Zt=st(we),Vt=N(Ft),ln=l(Zt*Vt),Qt=l(Mt*Vt),Dn=W.BASE.multiplyAndAddUnsafe(wt,ln,Qt)?.toAffine();return Dn?l(Dn.x)===Mt:!1}return{CURVE:m,getPublicKey:ht,getSharedSecret:zt,sign:qt,verify:$t,ProjectivePoint:W,Signature:Le,utils:Ke}}let vx=class extends ux{constructor(m,b){super(),this.finished=!1,this.destroyed=!1,G1(m);const S=s0(b);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const z=this.blockLen,k=new Uint8Array(z);k.set(S.length>z?m.create().update(S).digest():S);for(let A=0;A<k.length;A++)k[A]^=54;this.iHash.update(k),this.oHash=m.create();for(let A=0;A<k.length;A++)k[A]^=106;this.oHash.update(k),k.fill(0)}update(m){return Sy(this),this.iHash.update(m),this}digestInto(m){Sy(this),lx(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:b,iHash:S,finished:z,destroyed:k,blockLen:A,outputLen:l}=this;return m=m,m.finished=z,m.destroyed=k,m.blockLen=A,m.outputLen=l,m.oHash=b._cloneInto(m.oHash),m.iHash=S._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const xx=(h,m,b)=>new vx(h,m).update(b).digest();xx.create=(h,m)=>new vx(h,m);function Pw(h){return{hash:h,hmac:(m,...b)=>xx(h,m,X1(...b)),randomBytes:hx}}function Dw(h,m){const b=S=>zw({...h,...Pw(S)});return Object.freeze({...b(m),create:b})}const Ny=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ey=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),bx=BigInt(1),My=BigInt(2),mv=(h,m)=>(h+m/My)/m;function wx(h){const m=Ny,b=BigInt(3),S=BigInt(6),z=BigInt(11),k=BigInt(22),A=BigInt(23),l=BigInt(44),N=BigInt(88),W=h*h*h%m,ne=W*W*h%m,re=qo(ne,b,m)*ne%m,Me=qo(re,b,m)*ne%m,be=qo(Me,My,m)*W%m,Ie=qo(be,z,m)*be%m,fe=qo(Ie,k,m)*Ie%m,ie=qo(fe,l,m)*fe%m,Le=qo(ie,N,m)*ie%m,Ke=qo(Le,l,m)*fe%m,ht=qo(Ke,b,m)*ne%m,Ct=qo(ht,A,m)*Ie%m,zt=qo(Ct,S,m)*W%m,tt=qo(zt,My,m);if(!j_.eql(j_.sqr(tt),h))throw new Error("Cannot find square root");return tt}const j_=xw(Ny,void 0,void 0,{sqrt:wx}),Xp=Dw({a:BigInt(0),b:BigInt(7),Fp:j_,n:Ey,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:h=>{const m=Ey,b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),S=-bx*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),z=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),k=b,A=BigInt("0x100000000000000000000000000000000"),l=mv(k*h,m),N=mv(-S*h,m);let W=Ea(h-l*b-N*z,m),ne=Ea(-l*S-N*k,m);const re=W>A,Me=ne>A;if(re&&(W=m-W),Me&&(ne=m-ne),W>A||ne>A)throw new Error("splitScalar: Endomorphism failed, k="+h);return{k1neg:re,k1:W,k2neg:Me,k2:ne}}}},B_),Fy=BigInt(0),Tx=h=>typeof h=="bigint"&&Fy<h&&h<Ny,Iw=h=>typeof h=="bigint"&&Fy<h&&h<Ey,gv={};function Ay(h,...m){let b=gv[h];if(b===void 0){const S=B_(Uint8Array.from(h,z=>z.charCodeAt(0)));b=pf(S,S),gv[h]=b}return B_(pf(b,...m))}const h0=h=>h.toRawBytes(!0).slice(1),U_=h=>$h(h,32),M_=h=>Ea(h,Ny),og=h=>Ea(h,Ey),d0=Xp.ProjectivePoint,kw=(h,m,b)=>d0.BASE.multiplyAndAddUnsafe(h,m,b);function V_(h){let m=Xp.utils.normPrivateKeyToScalar(h),b=d0.fromPrivateKey(m);return{scalar:b.hasEvenY()?m:og(-m),bytes:h0(b)}}function Sx(h){if(!Tx(h))throw new Error("bad x: need 0 < x < p");const m=M_(h*h),b=M_(m*h+BigInt(7));let S=wx(b);S%My!==Fy&&(S=M_(-S));const z=new d0(h,S,bx);return z.assertValidity(),z}function Ex(...h){return og(js(Ay("BIP0340/challenge",...h)))}function Rw(h){return V_(h).bytes}function Lw(h,m,b=hx(32)){const S=Ha("message",h),{bytes:z,scalar:k}=V_(m),A=Ha("auxRand",b,32),l=U_(k^js(Ay("BIP0340/aux",A))),N=Ay("BIP0340/nonce",l,z,S),W=og(js(N));if(W===Fy)throw new Error("sign failed: k is zero");const{bytes:ne,scalar:re}=V_(W),Me=Ex(ne,z,S),be=new Uint8Array(64);if(be.set(ne,0),be.set(U_(og(re+Me*k)),32),!Mx(be,S,z))throw new Error("sign: Invalid signature produced");return be}function Mx(h,m,b){const S=Ha("signature",h,64),z=Ha("message",m),k=Ha("publicKey",b,32);try{const A=Sx(js(k)),l=js(S.subarray(0,32));if(!Tx(l))return!1;const N=js(S.subarray(32,64));if(!Iw(N))return!1;const W=Ex(U_(l),h0(A),z),ne=kw(A,N,og(-W));return!(!ne||!ne.hasEvenY()||ne.toAffine().x!==l)}catch{return!1}}const Pc={getPublicKey:Rw,sign:Lw,verify:Mx,utils:{randomPrivateKey:Xp.utils.randomPrivateKey,lift_x:Sx,pointToBytes:h0,numberToBytesBE:$h,bytesToNumberBE:js,taggedHash:Ay,mod:Ea}},A_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const f0=h=>h instanceof Uint8Array,C_=h=>new DataView(h.buffer,h.byteOffset,h.byteLength),Cc=(h,m)=>h<<32-m|h>>>m,Ow=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ow)throw new Error("Non little-endian hardware is not supported");const Bw=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function Br(h){if(!f0(h))throw new Error("Uint8Array expected");let m="";for(let b=0;b<h.length;b++)m+=Bw[h[b]];return m}function mf(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const b=new Uint8Array(m/2);for(let S=0;S<b.length;S++){const z=S*2,k=h.slice(z,z+2),A=Number.parseInt(k,16);if(Number.isNaN(A)||A<0)throw new Error("Invalid byte sequence");b[S]=A}return b}function Nw(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function lg(h){if(typeof h=="string"&&(h=Nw(h)),!f0(h))throw new Error(`expected Uint8Array, got ${typeof h}`);return h}function jy(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!f0(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}class Ax{clone(){return this._cloneInto()}}function Cx(h){const m=S=>h().update(lg(S)).digest(),b=h();return m.outputLen=b.outputLen,m.blockLen=b.blockLen,m.create=()=>h(),m}function zx(h=32){if(A_&&typeof A_.getRandomValues=="function")return A_.getRandomValues(new Uint8Array(h));throw new Error("crypto.getRandomValues must be defined")}function q_(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`Wrong positive integer: ${h}`)}function Fw(h){if(typeof h!="boolean")throw new Error(`Expected boolean, not ${h}`)}function Px(h,...m){if(!(h instanceof Uint8Array))throw new Error("Expected Uint8Array");if(m.length>0&&!m.includes(h.length))throw new Error(`Expected Uint8Array of length ${m}, not of length=${h.length}`)}function jw(h){if(typeof h!="function"||typeof h.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");q_(h.outputLen),q_(h.blockLen)}function Uw(h,m=!0){if(h.destroyed)throw new Error("Hash instance has been destroyed");if(m&&h.finished)throw new Error("Hash#digest() has already been called")}function Vw(h,m){Px(h);const b=m.outputLen;if(h.length<b)throw new Error(`digestInto() expects output buffer of length at least ${b}`)}const Dc={number:q_,bool:Fw,bytes:Px,hash:jw,exists:Uw,output:Vw};function qw(h,m,b,S){if(typeof h.setBigUint64=="function")return h.setBigUint64(m,b,S);const z=BigInt(32),k=BigInt(4294967295),A=Number(b>>z&k),l=Number(b&k),N=S?4:0,W=S?0:4;h.setUint32(m+N,A,S),h.setUint32(m+W,l,S)}class Gw extends Ax{constructor(m,b,S,z){super(),this.blockLen=m,this.outputLen=b,this.padOffset=S,this.isLE=z,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=C_(this.buffer)}update(m){Dc.exists(this);const{view:b,buffer:S,blockLen:z}=this;m=lg(m);const k=m.length;for(let A=0;A<k;){const l=Math.min(z-this.pos,k-A);if(l===z){const N=C_(m);for(;z<=k-A;A+=z)this.process(N,A);continue}S.set(m.subarray(A,A+l),this.pos),this.pos+=l,A+=l,this.pos===z&&(this.process(b,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){Dc.exists(this),Dc.output(m,this),this.finished=!0;const{buffer:b,view:S,blockLen:z,isLE:k}=this;let{pos:A}=this;b[A++]=128,this.buffer.subarray(A).fill(0),this.padOffset>z-A&&(this.process(S,0),A=0);for(let re=A;re<z;re++)b[re]=0;qw(S,z-8,BigInt(this.length*8),k),this.process(S,0);const l=C_(m),N=this.outputLen;if(N%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const W=N/4,ne=this.get();if(W>ne.length)throw new Error("_sha2: outputLen bigger than state");for(let re=0;re<W;re++)l.setUint32(4*re,ne[re],k)}digest(){const{buffer:m,outputLen:b}=this;this.digestInto(m);const S=m.slice(0,b);return this.destroy(),S}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:b,buffer:S,length:z,finished:k,destroyed:A,pos:l}=this;return m.length=z,m.pos=l,m.finished=k,m.destroyed=A,z%b&&m.buffer.set(S),m}}const Zw=(h,m,b)=>h&m^~h&b,Hw=(h,m,b)=>h&m^h&b^m&b,$w=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),qh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Gh=new Uint32Array(64);class Dx extends Gw{constructor(){super(64,32,8,!1),this.A=qh[0]|0,this.B=qh[1]|0,this.C=qh[2]|0,this.D=qh[3]|0,this.E=qh[4]|0,this.F=qh[5]|0,this.G=qh[6]|0,this.H=qh[7]|0}get(){const{A:m,B:b,C:S,D:z,E:k,F:A,G:l,H:N}=this;return[m,b,S,z,k,A,l,N]}set(m,b,S,z,k,A,l,N){this.A=m|0,this.B=b|0,this.C=S|0,this.D=z|0,this.E=k|0,this.F=A|0,this.G=l|0,this.H=N|0}process(m,b){for(let re=0;re<16;re++,b+=4)Gh[re]=m.getUint32(b,!1);for(let re=16;re<64;re++){const Me=Gh[re-15],be=Gh[re-2],Ie=Cc(Me,7)^Cc(Me,18)^Me>>>3,fe=Cc(be,17)^Cc(be,19)^be>>>10;Gh[re]=fe+Gh[re-7]+Ie+Gh[re-16]|0}let{A:S,B:z,C:k,D:A,E:l,F:N,G:W,H:ne}=this;for(let re=0;re<64;re++){const Me=Cc(l,6)^Cc(l,11)^Cc(l,25),be=ne+Me+Zw(l,N,W)+$w[re]+Gh[re]|0,fe=(Cc(S,2)^Cc(S,13)^Cc(S,22))+Hw(S,z,k)|0;ne=W,W=N,N=l,l=A+be|0,A=k,k=z,z=S,S=be+fe|0}S=S+this.A|0,z=z+this.B|0,k=k+this.C|0,A=A+this.D|0,l=l+this.E|0,N=N+this.F|0,W=W+this.G|0,ne=ne+this.H|0,this.set(S,z,k,A,l,N,W,ne)}roundClean(){Gh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Xw extends Dx{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Xh=Cx(()=>new Dx);Cx(()=>new Xw);function Yp(h){if(!Number.isSafeInteger(h))throw new Error(`Wrong integer: ${h}`)}function Fu(...h){const m=(z,k)=>A=>z(k(A)),b=Array.from(h).reverse().reduce((z,k)=>z?m(z,k.encode):k.encode,void 0),S=h.reduce((z,k)=>z?m(z,k.decode):k.decode,void 0);return{encode:b,decode:S}}function ju(h){return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return m.map(b=>{if(Yp(b),b<0||b>=h.length)throw new Error(`Digit index outside alphabet: ${b} (alphabet: ${h.length})`);return h[b]})},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("alphabet.decode input should be array of strings");return m.map(b=>{if(typeof b!="string")throw new Error(`alphabet.decode: not string element=${b}`);const S=h.indexOf(b);if(S===-1)throw new Error(`Unknown letter: "${b}". Allowed: ${h}`);return S})}}}function Uu(h=""){if(typeof h!="string")throw new Error("join separator should be string");return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("join.encode input should be array of strings");for(let b of m)if(typeof b!="string")throw new Error(`join.encode: non-string input=${b}`);return m.join(h)},decode:m=>{if(typeof m!="string")throw new Error("join.decode input should be string");return m.split(h)}}}function Uy(h,m="="){if(Yp(h),typeof m!="string")throw new Error("padding chr should be string");return{encode(b){if(!Array.isArray(b)||b.length&&typeof b[0]!="string")throw new Error("padding.encode input should be array of strings");for(let S of b)if(typeof S!="string")throw new Error(`padding.encode: non-string input=${S}`);for(;b.length*h%8;)b.push(m);return b},decode(b){if(!Array.isArray(b)||b.length&&typeof b[0]!="string")throw new Error("padding.encode input should be array of strings");for(let z of b)if(typeof z!="string")throw new Error(`padding.decode: non-string input=${z}`);let S=b.length;if(S*h%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;S>0&&b[S-1]===m;S--)if(!((S-1)*h%8))throw new Error("Invalid padding: string has too much padding");return b.slice(0,S)}}}function Ix(h){if(typeof h!="function")throw new Error("normalize fn should be function");return{encode:m=>m,decode:m=>h(m)}}function yv(h,m,b){if(m<2)throw new Error(`convertRadix: wrong from=${m}, base cannot be less than 2`);if(b<2)throw new Error(`convertRadix: wrong to=${b}, base cannot be less than 2`);if(!Array.isArray(h))throw new Error("convertRadix: data should be array");if(!h.length)return[];let S=0;const z=[],k=Array.from(h);for(k.forEach(A=>{if(Yp(A),A<0||A>=m)throw new Error(`Wrong integer: ${A}`)});;){let A=0,l=!0;for(let N=S;N<k.length;N++){const W=k[N],ne=m*A+W;if(!Number.isSafeInteger(ne)||m*A/m!==A||ne-W!==m*A)throw new Error("convertRadix: carry overflow");if(A=ne%b,k[N]=Math.floor(ne/b),!Number.isSafeInteger(k[N])||k[N]*b+A!==ne)throw new Error("convertRadix: carry overflow");if(l)k[N]?l=!1:S=N;else continue}if(z.push(A),l)break}for(let A=0;A<h.length-1&&h[A]===0;A++)z.push(0);return z.reverse()}const kx=(h,m)=>m?kx(m,h%m):h,Cy=(h,m)=>h+(m-kx(h,m));function G_(h,m,b,S){if(!Array.isArray(h))throw new Error("convertRadix2: data should be array");if(m<=0||m>32)throw new Error(`convertRadix2: wrong from=${m}`);if(b<=0||b>32)throw new Error(`convertRadix2: wrong to=${b}`);if(Cy(m,b)>32)throw new Error(`convertRadix2: carry overflow from=${m} to=${b} carryBits=${Cy(m,b)}`);let z=0,k=0;const A=2**b-1,l=[];for(const N of h){if(Yp(N),N>=2**m)throw new Error(`convertRadix2: invalid data word=${N} from=${m}`);if(z=z<<m|N,k+m>32)throw new Error(`convertRadix2: carry overflow pos=${k} from=${m}`);for(k+=m;k>=b;k-=b)l.push((z>>k-b&A)>>>0);z&=2**k-1}if(z=z<<b-k&A,!S&&k>=m)throw new Error("Excess padding");if(!S&&z)throw new Error(`Non-zero padding: ${z}`);return S&&k>0&&l.push(z>>>0),l}function Yw(h){return Yp(h),{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return yv(Array.from(m),2**8,h)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(yv(m,h,2**8))}}}function Yh(h,m=!1){if(Yp(h),h<=0||h>32)throw new Error("radix2: bits should be in (0..32]");if(Cy(8,h)>32||Cy(h,8)>32)throw new Error("radix2: carry overflow");return{encode:b=>{if(!(b instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return G_(Array.from(b),8,h,!m)},decode:b=>{if(!Array.isArray(b)||b.length&&typeof b[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(G_(b,h,8,m))}}}function _v(h){if(typeof h!="function")throw new Error("unsafeWrapper fn should be function");return function(...m){try{return h.apply(null,m)}catch{}}}const Ww=Fu(Yh(4),ju("0123456789ABCDEF"),Uu("")),Kw=Fu(Yh(5),ju("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Uy(5),Uu(""));Fu(Yh(5),ju("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Uy(5),Uu(""));Fu(Yh(5),ju("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Uu(""),Ix(h=>h.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Nu=Fu(Yh(6),ju("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Uy(6),Uu("")),Qw=Fu(Yh(6),ju("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Uy(6),Uu("")),p0=h=>Fu(Yw(58),ju(h),Uu("")),Z_=p0("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");p0("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");p0("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const vv=[0,2,3,5,6,7,9,10,11],Jw={encode(h){let m="";for(let b=0;b<h.length;b+=8){const S=h.subarray(b,b+8);m+=Z_.encode(S).padStart(vv[S.length],"1")}return m},decode(h){let m=[];for(let b=0;b<h.length;b+=11){const S=h.slice(b,b+11),z=vv.indexOf(S.length),k=Z_.decode(S);for(let A=0;A<k.length-z;A++)if(k[A]!==0)throw new Error("base58xmr: wrong padding");m=m.concat(Array.from(k.slice(k.length-z)))}return Uint8Array.from(m)}},H_=Fu(ju("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Uu("")),xv=[996825010,642813549,513874426,1027748829,705979059];function sg(h){const m=h>>25;let b=(h&33554431)<<5;for(let S=0;S<xv.length;S++)(m>>S&1)===1&&(b^=xv[S]);return b}function bv(h,m,b=1){const S=h.length;let z=1;for(let k=0;k<S;k++){const A=h.charCodeAt(k);if(A<33||A>126)throw new Error(`Invalid prefix (${h})`);z=sg(z)^A>>5}z=sg(z);for(let k=0;k<S;k++)z=sg(z)^h.charCodeAt(k)&31;for(let k of m)z=sg(z)^k;for(let k=0;k<6;k++)z=sg(z);return z^=b,H_.encode(G_([z%2**30],30,5,!1))}function Rx(h){const m=h==="bech32"?1:734539939,b=Yh(5),S=b.decode,z=b.encode,k=_v(S);function A(ne,re,Me=90){if(typeof ne!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof ne}`);if(!Array.isArray(re)||re.length&&typeof re[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof re}`);const be=ne.length+7+re.length;if(Me!==!1&&be>Me)throw new TypeError(`Length ${be} exceeds limit ${Me}`);return ne=ne.toLowerCase(),`${ne}1${H_.encode(re)}${bv(ne,re,m)}`}function l(ne,re=90){if(typeof ne!="string")throw new Error(`bech32.decode input should be string, not ${typeof ne}`);if(ne.length<8||re!==!1&&ne.length>re)throw new TypeError(`Wrong string length: ${ne.length} (${ne}). Expected (8..${re})`);const Me=ne.toLowerCase();if(ne!==Me&&ne!==ne.toUpperCase())throw new Error("String must be lowercase or uppercase");ne=Me;const be=ne.lastIndexOf("1");if(be===0||be===-1)throw new Error('Letter "1" must be present between prefix and data only');const Ie=ne.slice(0,be),fe=ne.slice(be+1);if(fe.length<6)throw new Error("Data must be at least 6 characters long");const ie=H_.decode(fe).slice(0,-6),Le=bv(Ie,ie,m);if(!fe.endsWith(Le))throw new Error(`Invalid checksum in ${ne}: expected "${Le}"`);return{prefix:Ie,words:ie}}const N=_v(l);function W(ne){const{prefix:re,words:Me}=l(ne,!1);return{prefix:re,words:Me,bytes:S(Me)}}return{encode:A,decode:l,decodeToBytes:W,decodeUnsafe:N,fromWords:S,fromWordsUnsafe:k,toWords:z}}const Hp=Rx("bech32");Rx("bech32m");const e2={encode:h=>new TextDecoder().decode(h),decode:h=>new TextEncoder().encode(h)},t2=Fu(Yh(4),ju("0123456789abcdef"),Uu(""),Ix(h=>{if(typeof h!="string"||h.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof h} with length ${h.length}`);return h.toLowerCase()})),n2={utf8:e2,hex:t2,base16:Ww,base32:Kw,base64:Nu,base64url:Qw,base58:Z_,base58xmr:Jw};`${Object.keys(n2).join(", ")}`;function z_(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`positive integer expected, not ${h}`)}function wv(h){if(typeof h!="boolean")throw new Error(`boolean expected, not ${h}`)}function i2(h){return h instanceof Uint8Array||h!=null&&typeof h=="object"&&h.constructor.name==="Uint8Array"}function Ic(h,...m){if(!i2(h))throw new Error("Uint8Array expected");if(m.length>0&&!m.includes(h.length))throw new Error(`Uint8Array expected of length ${m}, not of length=${h.length}`)}const $a=h=>new Uint32Array(h.buffer,h.byteOffset,Math.floor(h.byteLength/4)),r2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!r2)throw new Error("Non little-endian hardware is not supported");const a2=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function Fp(h){Ic(h);let m="";for(let b=0;b<h.length;b++)m+=a2[h[b]];return m}const Iu={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Tv(h){if(h>=Iu._0&&h<=Iu._9)return h-Iu._0;if(h>=Iu._A&&h<=Iu._F)return h-(Iu._A-10);if(h>=Iu._a&&h<=Iu._f)return h-(Iu._a-10)}function Lx(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length,b=m/2;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const S=new Uint8Array(b);for(let z=0,k=0;z<b;z++,k+=2){const A=Tv(h.charCodeAt(k)),l=Tv(h.charCodeAt(k+1));if(A===void 0||l===void 0){const N=h[k]+h[k+1];throw new Error('hex string expected, got non-hex character "'+N+'" at index '+k)}S[z]=A*16+l}return S}function s2(h,m){if(m==null||typeof m!="object")throw new Error("options must be defined");return Object.assign(h,m)}function o2(h,m){if(h.length!==m.length)return!1;let b=0;for(let S=0;S<h.length;S++)b|=h[S]^m[S];return b===0}const l2=(h,m)=>(Object.assign(m,h),m),Hh=16,c2=283;function m0(h){return h<<1^c2&-(h>>7)}function Up(h,m){let b=0;for(;m>0;m>>=1)b^=h&-(m&1),h=m0(h);return b}const $_=(()=>{let h=new Uint8Array(256);for(let b=0,S=1;b<256;b++,S^=m0(S))h[b]=S;const m=new Uint8Array(256);m[0]=99;for(let b=0;b<255;b++){let S=h[255-b];S|=S<<8,m[h[b]]=(S^S>>4^S>>5^S>>6^S>>7^99)&255}return m})(),u2=$_.map((h,m)=>$_.indexOf(m)),h2=h=>h<<24|h>>>8,P_=h=>h<<8|h>>>24;function Ox(h,m){if(h.length!==256)throw new Error("Wrong sbox length");const b=new Uint32Array(256).map((W,ne)=>m(h[ne])),S=b.map(P_),z=S.map(P_),k=z.map(P_),A=new Uint32Array(256*256),l=new Uint32Array(256*256),N=new Uint16Array(256*256);for(let W=0;W<256;W++)for(let ne=0;ne<256;ne++){const re=W*256+ne;A[re]=b[W]^S[ne],l[re]=z[W]^k[ne],N[re]=h[W]<<8|h[ne]}return{sbox:h,sbox2:N,T0:b,T1:S,T2:z,T3:k,T01:A,T23:l}}const g0=Ox($_,h=>Up(h,3)<<24|h<<16|h<<8|Up(h,2)),Bx=Ox(u2,h=>Up(h,11)<<24|Up(h,13)<<16|Up(h,9)<<8|Up(h,14)),d2=(()=>{const h=new Uint8Array(16);for(let m=0,b=1;m<16;m++,b=m0(b))h[m]=b;return h})();function Nx(h){Ic(h);const m=h.length;if(![16,24,32].includes(m))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${m}`);const{sbox2:b}=g0,S=$a(h),z=S.length,k=l=>kc(b,l,l,l,l),A=new Uint32Array(m+28);A.set(S);for(let l=z;l<A.length;l++){let N=A[l-1];l%z===0?N=k(h2(N))^d2[l/z-1]:z>6&&l%z===4&&(N=k(N)),A[l]=A[l-z]^N}return A}function f2(h){const m=Nx(h),b=m.slice(),S=m.length,{sbox2:z}=g0,{T0:k,T1:A,T2:l,T3:N}=Bx;for(let W=0;W<S;W+=4)for(let ne=0;ne<4;ne++)b[W+ne]=m[S-W-4+ne];m.fill(0);for(let W=4;W<S-4;W++){const ne=b[W],re=kc(z,ne,ne,ne,ne);b[W]=k[re&255]^A[re>>>8&255]^l[re>>>16&255]^N[re>>>24]}return b}function Zh(h,m,b,S,z,k){return h[b<<8&65280|S>>>8&255]^m[z>>>8&65280|k>>>24&255]}function kc(h,m,b,S,z){return h[m&255|b&65280]|h[S>>>16&255|z>>>16&65280]<<16}function Sv(h,m,b,S,z){const{sbox2:k,T01:A,T23:l}=g0;let N=0;m^=h[N++],b^=h[N++],S^=h[N++],z^=h[N++];const W=h.length/4-2;for(let Ie=0;Ie<W;Ie++){const fe=h[N++]^Zh(A,l,m,b,S,z),ie=h[N++]^Zh(A,l,b,S,z,m),Le=h[N++]^Zh(A,l,S,z,m,b),Ke=h[N++]^Zh(A,l,z,m,b,S);m=fe,b=ie,S=Le,z=Ke}const ne=h[N++]^kc(k,m,b,S,z),re=h[N++]^kc(k,b,S,z,m),Me=h[N++]^kc(k,S,z,m,b),be=h[N++]^kc(k,z,m,b,S);return{s0:ne,s1:re,s2:Me,s3:be}}function p2(h,m,b,S,z){const{sbox2:k,T01:A,T23:l}=Bx;let N=0;m^=h[N++],b^=h[N++],S^=h[N++],z^=h[N++];const W=h.length/4-2;for(let Ie=0;Ie<W;Ie++){const fe=h[N++]^Zh(A,l,m,z,S,b),ie=h[N++]^Zh(A,l,b,m,z,S),Le=h[N++]^Zh(A,l,S,b,m,z),Ke=h[N++]^Zh(A,l,z,S,b,m);m=fe,b=ie,S=Le,z=Ke}const ne=h[N++]^kc(k,m,z,S,b),re=h[N++]^kc(k,b,m,z,S),Me=h[N++]^kc(k,S,b,m,z),be=h[N++]^kc(k,z,S,b,m);return{s0:ne,s1:re,s2:Me,s3:be}}function Fx(h,m){if(!m)return new Uint8Array(h);if(Ic(m),m.length<h)throw new Error(`aes: wrong destination length, expected at least ${h}, got: ${m.length}`);return m}function m2(h){if(Ic(h),h.length%Hh!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Hh}`)}function g2(h,m,b){let S=h.length;const z=S%Hh;if(!m&&z!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const k=$a(h);if(m){let N=Hh-z;N||(N=Hh),S=S+N}const A=Fx(S,b),l=$a(A);return{b:k,o:l,out:A}}function y2(h,m){if(!m)return h;const b=h.length;if(!b)throw new Error("aes/pcks5: empty ciphertext not allowed");const S=h[b-1];if(S<=0||S>16)throw new Error(`aes/pcks5: wrong padding byte: ${S}`);const z=h.subarray(0,-S);for(let k=0;k<S;k++)if(h[b-k-1]!==S)throw new Error("aes/pcks5: wrong padding");return z}function _2(h){const m=new Uint8Array(16),b=$a(m);m.set(h);const S=Hh-h.length;for(let z=Hh-S;z<Hh;z++)m[z]=S;return b}const jx=l2({blockSize:16,nonceLength:16},function(m,b,S={}){Ic(m),Ic(b,16);const z=!S.disablePadding;return{encrypt:(k,A)=>{const l=Nx(m),{b:N,o:W,out:ne}=g2(k,z,A),re=$a(b);let Me=re[0],be=re[1],Ie=re[2],fe=re[3],ie=0;for(;ie+4<=N.length;)Me^=N[ie+0],be^=N[ie+1],Ie^=N[ie+2],fe^=N[ie+3],{s0:Me,s1:be,s2:Ie,s3:fe}=Sv(l,Me,be,Ie,fe),W[ie++]=Me,W[ie++]=be,W[ie++]=Ie,W[ie++]=fe;if(z){const Le=_2(k.subarray(ie*4));Me^=Le[0],be^=Le[1],Ie^=Le[2],fe^=Le[3],{s0:Me,s1:be,s2:Ie,s3:fe}=Sv(l,Me,be,Ie,fe),W[ie++]=Me,W[ie++]=be,W[ie++]=Ie,W[ie++]=fe}return l.fill(0),ne},decrypt:(k,A)=>{m2(k);const l=f2(m),N=$a(b),W=Fx(k.length,A),ne=$a(k),re=$a(W);let Me=N[0],be=N[1],Ie=N[2],fe=N[3];for(let ie=0;ie+4<=ne.length;){const Le=Me,Ke=be,ht=Ie,Ct=fe;Me=ne[ie+0],be=ne[ie+1],Ie=ne[ie+2],fe=ne[ie+3];const{s0:zt,s1:tt,s2:st,s3:ke}=p2(l,Me,be,Ie,fe);re[ie++]=zt^Le,re[ie++]=tt^Ke,re[ie++]=st^ht,re[ie++]=ke^Ct}return l.fill(0),y2(W,z)}}}),Ux=h=>Uint8Array.from(h.split("").map(m=>m.charCodeAt(0))),v2=Ux("expand 16-byte k"),x2=Ux("expand 32-byte k"),b2=$a(v2),Vx=$a(x2);Vx.slice();function ti(h,m){return h<<m|h>>>32-m}function X_(h){return h.byteOffset%4===0}const my=64,w2=16,qx=2**32-1,Ev=new Uint32Array;function T2(h,m,b,S,z,k,A,l){const N=z.length,W=new Uint8Array(my),ne=$a(W),re=X_(z)&&X_(k),Me=re?$a(z):Ev,be=re?$a(k):Ev;for(let Ie=0;Ie<N;A++){if(h(m,b,S,ne,A,l),A>=qx)throw new Error("arx: counter overflow");const fe=Math.min(my,N-Ie);if(re&&fe===my){const ie=Ie/4;if(Ie%4!==0)throw new Error("arx: invalid block position");for(let Le=0,Ke;Le<w2;Le++)Ke=ie+Le,be[Ke]=Me[Ke]^ne[Le];Ie+=my;continue}for(let ie=0,Le;ie<fe;ie++)Le=Ie+ie,k[Le]=z[Le]^W[ie];Ie+=fe}}function S2(h,m){const{allowShortKeys:b,extendNonceFn:S,counterLength:z,counterRight:k,rounds:A}=s2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},m);if(typeof h!="function")throw new Error("core must be a function");return z_(z),z_(A),wv(k),wv(b),(l,N,W,ne,re=0)=>{Ic(l),Ic(N),Ic(W);const Me=W.length;if(ne||(ne=new Uint8Array(Me)),Ic(ne),z_(re),re<0||re>=qx)throw new Error("arx: counter overflow");if(ne.length<Me)throw new Error(`arx: output (${ne.length}) is shorter than data (${Me})`);const be=[];let Ie=l.length,fe,ie;if(Ie===32)fe=l.slice(),be.push(fe),ie=Vx;else if(Ie===16&&b)fe=new Uint8Array(32),fe.set(l),fe.set(l,16),ie=b2,be.push(fe);else throw new Error(`arx: invalid 32-byte key, got length=${Ie}`);X_(N)||(N=N.slice(),be.push(N));const Le=$a(fe);if(S){if(N.length!==24)throw new Error("arx: extended nonce must be 24 bytes");S(ie,Le,$a(N.subarray(0,16)),Le),N=N.subarray(16)}const Ke=16-z;if(Ke!==N.length)throw new Error(`arx: nonce must be ${Ke} or 16 bytes`);if(Ke!==12){const Ct=new Uint8Array(12);Ct.set(N,k?0:12-N.length),N=Ct,be.push(N)}const ht=$a(N);for(T2(h,ie,Le,ht,W,ne,re,A);be.length>0;)be.pop().fill(0);return ne}}function E2(h,m,b,S,z,k=20){let A=h[0],l=h[1],N=h[2],W=h[3],ne=m[0],re=m[1],Me=m[2],be=m[3],Ie=m[4],fe=m[5],ie=m[6],Le=m[7],Ke=z,ht=b[0],Ct=b[1],zt=b[2],tt=A,st=l,ke=N,ct=W,it=ne,lt=re,Et=Me,qt=be,$t=Ie,ut=fe,we=ie,$e=Le,mt=Ke,vt=ht,Ut=Ct,xe=zt;for(let wt=0;wt<k;wt+=2)tt=tt+it|0,mt=ti(mt^tt,16),$t=$t+mt|0,it=ti(it^$t,12),tt=tt+it|0,mt=ti(mt^tt,8),$t=$t+mt|0,it=ti(it^$t,7),st=st+lt|0,vt=ti(vt^st,16),ut=ut+vt|0,lt=ti(lt^ut,12),st=st+lt|0,vt=ti(vt^st,8),ut=ut+vt|0,lt=ti(lt^ut,7),ke=ke+Et|0,Ut=ti(Ut^ke,16),we=we+Ut|0,Et=ti(Et^we,12),ke=ke+Et|0,Ut=ti(Ut^ke,8),we=we+Ut|0,Et=ti(Et^we,7),ct=ct+qt|0,xe=ti(xe^ct,16),$e=$e+xe|0,qt=ti(qt^$e,12),ct=ct+qt|0,xe=ti(xe^ct,8),$e=$e+xe|0,qt=ti(qt^$e,7),tt=tt+lt|0,xe=ti(xe^tt,16),we=we+xe|0,lt=ti(lt^we,12),tt=tt+lt|0,xe=ti(xe^tt,8),we=we+xe|0,lt=ti(lt^we,7),st=st+Et|0,mt=ti(mt^st,16),$e=$e+mt|0,Et=ti(Et^$e,12),st=st+Et|0,mt=ti(mt^st,8),$e=$e+mt|0,Et=ti(Et^$e,7),ke=ke+qt|0,vt=ti(vt^ke,16),$t=$t+vt|0,qt=ti(qt^$t,12),ke=ke+qt|0,vt=ti(vt^ke,8),$t=$t+vt|0,qt=ti(qt^$t,7),ct=ct+it|0,Ut=ti(Ut^ct,16),ut=ut+Ut|0,it=ti(it^ut,12),ct=ct+it|0,Ut=ti(Ut^ct,8),ut=ut+Ut|0,it=ti(it^ut,7);let Ye=0;S[Ye++]=A+tt|0,S[Ye++]=l+st|0,S[Ye++]=N+ke|0,S[Ye++]=W+ct|0,S[Ye++]=ne+it|0,S[Ye++]=re+lt|0,S[Ye++]=Me+Et|0,S[Ye++]=be+qt|0,S[Ye++]=Ie+$t|0,S[Ye++]=fe+ut|0,S[Ye++]=ie+we|0,S[Ye++]=Le+$e|0,S[Ye++]=Ke+mt|0,S[Ye++]=ht+vt|0,S[Ye++]=Ct+Ut|0,S[Ye++]=zt+xe|0}const Gx=S2(E2,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Zx extends Ax{constructor(m,b){super(),this.finished=!1,this.destroyed=!1,Dc.hash(m);const S=lg(b);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const z=this.blockLen,k=new Uint8Array(z);k.set(S.length>z?m.create().update(S).digest():S);for(let A=0;A<k.length;A++)k[A]^=54;this.iHash.update(k),this.oHash=m.create();for(let A=0;A<k.length;A++)k[A]^=106;this.oHash.update(k),k.fill(0)}update(m){return Dc.exists(this),this.iHash.update(m),this}digestInto(m){Dc.exists(this),Dc.bytes(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:b,iHash:S,finished:z,destroyed:k,blockLen:A,outputLen:l}=this;return m=m,m.finished=z,m.destroyed=k,m.blockLen=A,m.outputLen=l,m.oHash=b._cloneInto(m.oHash),m.iHash=S._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Vy=(h,m,b)=>new Zx(h,m).update(b).digest();Vy.create=(h,m)=>new Zx(h,m);function M2(h,m,b){return Dc.hash(h),Vy(h,lg(b),lg(m))}const D_=new Uint8Array([0]),Mv=new Uint8Array;function A2(h,m,b,S=32){if(Dc.hash(h),Dc.number(S),S>255*h.outputLen)throw new Error("Length should be <= 255*HashLen");const z=Math.ceil(S/h.outputLen);b===void 0&&(b=Mv);const k=new Uint8Array(z*h.outputLen),A=Vy.create(h,m),l=A._cloneInto(),N=new Uint8Array(A.outputLen);for(let W=0;W<z;W++)D_[0]=W+1,l.update(W===0?Mv:N).update(b).update(D_).digestInto(N),k.set(N,h.outputLen*W),A._cloneInto(l);return A.destroy(),l.destroy(),N.fill(0),D_.fill(0),k.slice(0,S)}var C2=Object.defineProperty,Yi=(h,m)=>{for(var b in m)C2(h,b,{get:m[b],enumerable:!0})},lf=Symbol("verified"),z2=h=>h instanceof Object;function y0(h){if(!z2(h)||typeof h.kind!="number"||typeof h.content!="string"||typeof h.created_at!="number"||typeof h.pubkey!="string"||!h.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(h.tags))return!1;for(let m=0;m<h.tags.length;m++){let b=h.tags[m];if(!Array.isArray(b))return!1;for(let S=0;S<b.length;S++)if(typeof b[S]!="string")return!1}return!0}var P2={};Yi(P2,{Queue:()=>$x,QueueNode:()=>Hx,binarySearch:()=>_0,bytesToHex:()=>Br,hexToBytes:()=>mf,insertEventIntoAscendingList:()=>I2,insertEventIntoDescendingList:()=>D2,normalizeURL:()=>hf,utf8Decoder:()=>Ou,utf8Encoder:()=>Nl});var Ou=new TextDecoder("utf-8"),Nl=new TextEncoder;function hf(h){try{h.indexOf("://")===-1&&(h="wss://"+h);let m=new URL(h);return m.protocol==="http:"?m.protocol="ws:":m.protocol==="https:"&&(m.protocol="wss:"),m.pathname=m.pathname.replace(/\/+/g,"/"),m.pathname.endsWith("/")&&(m.pathname=m.pathname.slice(0,-1)),(m.port==="80"&&m.protocol==="ws:"||m.port==="443"&&m.protocol==="wss:")&&(m.port=""),m.searchParams.sort(),m.hash="",m.toString()}catch{throw new Error(`Invalid URL: ${h}`)}}function D2(h,m){const[b,S]=_0(h,z=>m.id===z.id?0:m.created_at===z.created_at?-1:z.created_at-m.created_at);return S||h.splice(b,0,m),h}function I2(h,m){const[b,S]=_0(h,z=>m.id===z.id?0:m.created_at===z.created_at?-1:m.created_at-z.created_at);return S||h.splice(b,0,m),h}function _0(h,m){let b=0,S=h.length-1;for(;b<=S;){const z=Math.floor((b+S)/2),k=m(h[z]);if(k===0)return[z,!0];k<0?S=z-1:b=z+1}return[b,!1]}var Hx=class{value;next=null;prev=null;constructor(h){this.value=h}},$x=class{first;last;constructor(){this.first=null,this.last=null}enqueue(h){const m=new Hx(h);return this.last?this.last===this.first?(this.last=m,this.last.prev=this.first,this.first.next=m):(m.prev=this.last,this.last.next=m,this.last=m):(this.first=m,this.last=m),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const m=this.first;return this.first=null,this.last=null,m.value}const h=this.first;return this.first=h.next,this.first&&(this.first.prev=null),h.value}},k2=class{generateSecretKey(){return Pc.utils.randomPrivateKey()}getPublicKey(m){return Br(Pc.getPublicKey(m))}finalizeEvent(m,b){const S=m;return S.pubkey=Br(Pc.getPublicKey(b)),S.id=vy(S),S.sig=Br(Pc.sign(vy(S),b)),S[lf]=!0,S}verifyEvent(m){if(typeof m[lf]=="boolean")return m[lf];const b=vy(m);if(b!==m.id)return m[lf]=!1,!1;try{const S=Pc.verify(m.sig,b,m.pubkey);return m[lf]=S,S}catch{return m[lf]=!1,!1}}};function R2(h){if(!y0(h))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content])}function vy(h){let m=Xh(Nl.encode(R2(h)));return Br(m)}var qy=new k2,Xx=qy.generateSecretKey,cg=qy.getPublicKey,Ho=qy.finalizeEvent,Gy=qy.verifyEvent,L2={};Yi(L2,{Application:()=>$T,BadgeAward:()=>q2,BadgeDefinition:()=>jT,BlockedRelaysList:()=>wT,BlossomServerList:()=>zT,BookmarkList:()=>vT,Bookmarksets:()=>BT,Calendar:()=>eS,CalendarEventRSVP:()=>tS,ChannelCreation:()=>eb,ChannelHideMessage:()=>ib,ChannelMessage:()=>nb,ChannelMetadata:()=>tb,ChannelMuteUser:()=>rb,ChatMessage:()=>G2,ClassifiedListing:()=>WT,ClientAuth:()=>sb,Comment:()=>J2,CommunitiesList:()=>xT,CommunityDefinition:()=>aS,CommunityPostApproval:()=>oT,Contacts:()=>j2,CreateOrUpdateProduct:()=>qT,CreateOrUpdateStall:()=>VT,Curationsets:()=>NT,Date:()=>QT,DirectMessageRelaysList:()=>AT,DraftClassifiedListing:()=>KT,DraftLong:()=>ZT,Emojisets:()=>HT,EncryptedDirectMessage:()=>U2,EventDeletion:()=>V2,FavoriteRelays:()=>ST,FileMessage:()=>H2,FileMetadata:()=>Q2,FileServerPreference:()=>CT,Followsets:()=>RT,ForumThread:()=>Z2,GenericRepost:()=>T0,Genericlists:()=>LT,GiftWrap:()=>ab,GroupMetadata:()=>sS,HTTPAuth:()=>S0,Handlerinformation:()=>rS,Handlerrecommendation:()=>iS,Highlights:()=>pT,InterestsList:()=>ET,Interestsets:()=>UT,JobFeedback:()=>uT,JobRequest:()=>lT,JobResult:()=>cT,Label:()=>sT,LightningPubRPC:()=>DT,LiveChatMessage:()=>eT,LiveEvent:()=>XT,LongFormArticle:()=>GT,Metadata:()=>N2,Mutelist:()=>gT,NWCWalletInfo:()=>PT,NWCWalletRequest:()=>ob,NWCWalletResponse:()=>IT,NormalVideo:()=>X2,NostrConnect:()=>kT,OpenTimestamps:()=>W2,Photo:()=>$2,Pinlist:()=>yT,Poll:()=>K2,PollResponse:()=>mT,PrivateDirectMessage:()=>Jx,ProblemTracker:()=>iT,ProfileBadges:()=>FT,PublicChatsList:()=>bT,Reaction:()=>w0,RecommendRelay:()=>F2,RelayList:()=>_T,RelayReview:()=>nS,Relaysets:()=>OT,Report:()=>rT,Reporting:()=>aT,Repost:()=>b0,Seal:()=>Qx,SearchRelaysList:()=>TT,ShortTextNote:()=>Kx,ShortVideo:()=>Y2,Time:()=>JT,UserEmojiList:()=>MT,UserStatuses:()=>YT,Voice:()=>tT,VoiceComment:()=>nT,Zap:()=>fT,ZapGoal:()=>hT,ZapRequest:()=>dT,classifyKind:()=>O2,isAddressableKind:()=>x0,isEphemeralKind:()=>Wx,isKind:()=>B2,isRegularKind:()=>Yx,isReplaceableKind:()=>v0});function Yx(h){return h<1e4&&h!==0&&h!==3}function v0(h){return h===0||h===3||1e4<=h&&h<2e4}function Wx(h){return 2e4<=h&&h<3e4}function x0(h){return 3e4<=h&&h<4e4}function O2(h){return Yx(h)?"regular":v0(h)?"replaceable":Wx(h)?"ephemeral":x0(h)?"parameterized":"unknown"}function B2(h,m){const b=m instanceof Array?m:[m];return y0(h)&&b.includes(h.kind)||!1}var N2=0,Kx=1,F2=2,j2=3,U2=4,V2=5,b0=6,w0=7,q2=8,G2=9,Z2=11,Qx=13,Jx=14,H2=15,T0=16,$2=20,X2=21,Y2=22,eb=40,tb=41,nb=42,ib=43,rb=44,W2=1040,ab=1059,K2=1068,Q2=1063,J2=1111,eT=1311,tT=1222,nT=1244,iT=1971,rT=1984,aT=1984,sT=1985,oT=4550,lT=5999,cT=6999,uT=7e3,hT=9041,dT=9734,fT=9735,pT=9802,mT=1018,gT=1e4,yT=10001,_T=10002,vT=10003,xT=10004,bT=10005,wT=10006,TT=10007,ST=10012,ET=10015,MT=10030,AT=10050,CT=10096,zT=10063,PT=13194,DT=21e3,sb=22242,ob=23194,IT=23195,kT=24133,S0=27235,RT=3e4,LT=30001,OT=30002,BT=30003,NT=30004,FT=30008,jT=30009,UT=30015,VT=30017,qT=30018,GT=30023,ZT=30024,HT=30030,$T=30078,XT=30311,YT=30315,WT=30402,KT=30403,QT=31922,JT=31923,eS=31924,tS=31925,nS=31987,iS=31989,rS=31990,aS=34550,sS=39e3;function oS(h,m){if(h.ids&&h.ids.indexOf(m.id)===-1||h.kinds&&h.kinds.indexOf(m.kind)===-1||h.authors&&h.authors.indexOf(m.pubkey)===-1)return!1;for(let b in h)if(b[0]==="#"){let S=b.slice(1),z=h[`#${S}`];if(z&&!m.tags.find(([k,A])=>k===b.slice(1)&&z.indexOf(A)!==-1))return!1}return!(h.since&&m.created_at<h.since||h.until&&m.created_at>h.until)}function lS(h,m){for(let b=0;b<h.length;b++)if(oS(h[b],m))return!0;return!1}var cS={};Yi(cS,{getHex64:()=>Zy,getInt:()=>lb,getSubscriptionId:()=>cb,matchEventId:()=>uS,matchEventKind:()=>dS,matchEventPubkey:()=>hS});function Zy(h,m){let b=m.length+3,S=h.indexOf(`"${m}":`)+b,z=h.slice(S).indexOf('"')+S+1;return h.slice(z,z+64)}function lb(h,m){let b=m.length,S=h.indexOf(`"${m}":`)+b+3,z=h.slice(S),k=Math.min(z.indexOf(","),z.indexOf("}"));return parseInt(z.slice(0,k),10)}function cb(h){let m=h.slice(0,22).indexOf('"EVENT"');if(m===-1)return null;let b=h.slice(m+7+1).indexOf('"');if(b===-1)return null;let S=m+7+1+b,z=h.slice(S+1,80).indexOf('"');if(z===-1)return null;let k=S+1+z;return h.slice(S+1,k)}function uS(h,m){return m===Zy(h,"id")}function hS(h,m){return m===Zy(h,"pubkey")}function dS(h,m){return m===lb(h,"kind")}var fS={};Yi(fS,{makeAuthEvent:()=>ub});function ub(h,m){return{kind:sb,created_at:Math.floor(Date.now()/1e3),tags:[["relay",h],["challenge",m]],content:""}}async function pS(){return new Promise((h,m)=>{try{if(typeof MessageChannel<"u"){const b=new MessageChannel,S=()=>{b.port1.removeEventListener("message",S),h()};b.port1.addEventListener("message",S),b.port2.postMessage(0),b.port1.start()}else typeof setImmediate<"u"?setImmediate(h):typeof setTimeout<"u"?setTimeout(h,0):h()}catch(b){console.error("during yield: ",b),m(b)}})}var mS=h=>(h[lf]=!0,!0),hb=class extends Error{constructor(h,m){super(`Tried to send message '${h} on a closed connection to ${m}.`),this.name="SendingOnClosedConnection"}},db=class{url;_connected=!1;onclose=null;onnotice=h=>console.debug(`NOTICE from ${this.url}: ${h}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new $x;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(h,m){this.url=hf(h),this.verifyEvent=m.verifyEvent,this._WebSocket=m.websocketImplementation||WebSocket,this.enablePing=m.enablePing,this.enableReconnect=m.enableReconnect||!1}static async connect(h,m){const b=new db(h,m);return await b.connect(),b}closeAllSubscriptions(h){for(let[m,b]of this.openSubs)b.close(h);this.openSubs.clear();for(let[m,b]of this.openEventPublishes)b.reject(new Error(h));this.openEventPublishes.clear();for(let[m,b]of this.openCountRequests)b.reject(new Error(h));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const h=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},h)}handleHardClose(h){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const m=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!m?this.reconnect():this.closeAllSubscriptions(h)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((h,m)=>{this.connectionTimeoutHandle=setTimeout(()=>{m("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(b){clearTimeout(this.connectionTimeoutHandle),m(b);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const b=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const S of this.openSubs.values()){if(S.eosed=!1,b)for(let z=0;z<S.filters.length;z++)S.lastEmitted&&(S.filters[z].since=S.lastEmitted+1);S.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),h()},this.ws.onerror=b=>{clearTimeout(this.connectionTimeoutHandle),m(b.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=b=>{clearTimeout(this.connectionTimeoutHandle),m(b.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(h=>{this.ws.once("pong",()=>h(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((h,m)=>{if(!this.connectionPromise)return m(new Error(`no connection to ${this.url}, can't ping`));try{const b=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{h(!0),b.close()},onclose(){h(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(b){m(b)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(m=>setTimeout(()=>m(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await pS();this.queueRunning=!1}handleNext(){const h=this.incomingMessageQueue.dequeue();if(!h)return!1;const m=cb(h);if(m){const b=this.openSubs.get(m);if(!b)return;const S=Zy(h,"id"),z=b.alreadyHaveEvent?.(S);if(b.receivedEvent?.(this,S),z)return}try{let b=JSON.parse(h);switch(b[0]){case"EVENT":{const S=this.openSubs.get(b[1]),z=b[2];this.verifyEvent(z)&&lS(S.filters,z)&&S.onevent(z),(!S.lastEmitted||S.lastEmitted<z.created_at)&&(S.lastEmitted=z.created_at);return}case"COUNT":{const S=b[1],z=b[2],k=this.openCountRequests.get(S);k&&(k.resolve(z.count),this.openCountRequests.delete(S));return}case"EOSE":{const S=this.openSubs.get(b[1]);if(!S)return;S.receivedEose();return}case"OK":{const S=b[1],z=b[2],k=b[3],A=this.openEventPublishes.get(S);A&&(clearTimeout(A.timeout),z?A.resolve(k):A.reject(new Error(k)),this.openEventPublishes.delete(S));return}case"CLOSED":{const S=b[1],z=this.openSubs.get(S);if(!z)return;z.closed=!0,z.close(b[2]);return}case"NOTICE":{this.onnotice(b[1]);return}case"AUTH":{this.challenge=b[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(b[1])?.oncustom?.(b);return}}}catch{return}}async send(h){if(!this.connectionPromise)throw new hb(h,this.url);this.connectionPromise.then(()=>{this.ws?.send(h)})}async auth(h){const m=this.challenge;if(!m)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(b,S)=>{try{let z=await h(ub(this.url,m)),k=setTimeout(()=>{let A=this.openEventPublishes.get(z.id);A&&(A.reject(new Error("auth timed out")),this.openEventPublishes.delete(z.id))},this.publishTimeout);this.openEventPublishes.set(z.id,{resolve:b,reject:S,timeout:k}),this.send('["AUTH",'+JSON.stringify(z)+"]")}catch(z){console.warn("subscribe auth function failed:",z)}}),this.authPromise)}async publish(h){const m=new Promise((b,S)=>{const z=setTimeout(()=>{const k=this.openEventPublishes.get(h.id);k&&(k.reject(new Error("publish timed out")),this.openEventPublishes.delete(h.id))},this.publishTimeout);this.openEventPublishes.set(h.id,{resolve:b,reject:S,timeout:z})});return this.send('["EVENT",'+JSON.stringify(h)+"]"),m}async count(h,m){this.serial++;const b=m?.id||"count:"+this.serial,S=new Promise((z,k)=>{this.openCountRequests.set(b,{resolve:z,reject:k})});return this.send('["COUNT","'+b+'",'+JSON.stringify(h).substring(1)),S}subscribe(h,m){const b=this.prepareSubscription(h,m);return b.fire(),b}prepareSubscription(h,m){this.serial++;const b=m.id||(m.label?m.label+":":"sub:")+this.serial,S=new gS(this,b,h,m);return this.openSubs.set(b,S),S}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(h){this.incomingMessageQueue.enqueue(h.data),this.queueRunning||this.runQueue()}},gS=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(h,m,b,S){if(b.length===0)throw new Error("subscription can't be created with zero filters");this.relay=h,this.filters=b,this.id=m,this.alreadyHaveEvent=S.alreadyHaveEvent,this.receivedEvent=S.receivedEvent,this.eoseTimeout=S.eoseTimeout||h.baseEoseTimeout,this.oneose=S.oneose,this.onclose=S.onclose,this.onevent=S.onevent||(z=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,z)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(h="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(m){if(!(m instanceof hb))throw m}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(h)}},yS;try{yS=WebSocket}catch{}var _S=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(h){this.verifyEvent=h.verifyEvent,this._WebSocket=h.websocketImplementation,this.enablePing=h.enablePing,this.enableReconnect=h.enableReconnect||!1,this.automaticallyAuth=h.automaticallyAuth}async ensureRelay(h,m){h=hf(h);let b=this.relays.get(h);if(b||(b=new db(h,{verifyEvent:this.trustedRelayURLs.has(h)?mS:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),b.onclose=()=>{b&&!b.enableReconnect&&this.relays.delete(h)},m?.connectionTimeout&&(b.connectionTimeout=m.connectionTimeout),this.relays.set(h,b)),this.automaticallyAuth){const S=this.automaticallyAuth(h);S&&(b.onauth=S)}return await b.connect(),b}close(h){h.map(hf).forEach(m=>{this.relays.get(m)?.close(),this.relays.delete(m)})}subscribe(h,m,b){const S=[];for(let z=0;z<h.length;z++){const k=hf(h[z]);S.find(A=>A.url===k)||S.push({url:k,filter:m})}return this.subscribeMap(S,b)}subscribeMany(h,m,b){const S=[],z=[];for(let k=0;k<h.length;k++){const A=hf(h[k]);z.indexOf(A)===-1&&(z.push(A),S.push({url:A,filter:m}))}return this.subscribeMap(S,b)}subscribeMap(h,m){const b=new Map;for(const Me of h){const{url:be,filter:Ie}=Me;b.has(be)||b.set(be,[]),b.get(be).push(Ie)}const S=Array.from(b.entries()).map(([Me,be])=>({url:Me,filters:be}));this.trackRelays&&(m.receivedEvent=(Me,be)=>{let Ie=this.seenOn.get(be);Ie||(Ie=new Set,this.seenOn.set(be,Ie)),Ie.add(Me)});const z=new Set,k=[],A=[];let l=Me=>{A[Me]||(A[Me]=!0,A.filter(be=>be).length===S.length&&(m.oneose?.(),l=()=>{}))};const N=[];let W=(Me,be)=>{N[Me]||(l(Me),N[Me]=be,N.filter(Ie=>Ie).length===S.length&&(m.onclose?.(N),W=()=>{}))};const ne=Me=>{if(m.alreadyHaveEvent?.(Me))return!0;const be=z.has(Me);return z.add(Me),be},re=Promise.all(S.map(async({url:Me,filters:be},Ie)=>{let fe;try{fe=await this.ensureRelay(Me,{connectionTimeout:m.maxWait?Math.max(m.maxWait*.8,m.maxWait-1e3):void 0})}catch(Le){W(Ie,Le?.message||String(Le));return}let ie=fe.subscribe(be,{...m,oneose:()=>l(Ie),onclose:Le=>{Le.startsWith("auth-required: ")&&m.onauth?fe.auth(m.onauth).then(()=>{fe.subscribe(be,{...m,oneose:()=>l(Ie),onclose:Ke=>{W(Ie,Ke)},alreadyHaveEvent:ne,eoseTimeout:m.maxWait})}).catch(Ke=>{W(Ie,`auth was required and attempted, but failed with: ${Ke}`)}):W(Ie,Le)},alreadyHaveEvent:ne,eoseTimeout:m.maxWait});k.push(ie)}));return{async close(Me){await re,k.forEach(be=>{be.close(Me)})}}}subscribeEose(h,m,b){const S=this.subscribe(h,m,{...b,oneose(){S.close("closed automatically on eose")}});return S}subscribeManyEose(h,m,b){const S=this.subscribeMany(h,m,{...b,oneose(){S.close("closed automatically on eose")}});return S}async querySync(h,m,b){return new Promise(async S=>{const z=[];this.subscribeEose(h,m,{...b,onevent(k){z.push(k)},onclose(k){S(z)}})})}async get(h,m,b){m.limit=1;const S=await this.querySync(h,m,b);return S.sort((z,k)=>k.created_at-z.created_at),S[0]||null}publish(h,m,b){return h.map(hf).map(async(S,z,k)=>{if(k.indexOf(S)!==z)return Promise.reject("duplicate url");let A=await this.ensureRelay(S);return A.publish(m).catch(async l=>{if(l instanceof Error&&l.message.startsWith("auth-required: ")&&b?.onauth)return await A.auth(b.onauth),A.publish(m);throw l}).then(l=>{if(this.trackRelays){let N=this.seenOn.get(m.id);N||(N=new Set,this.seenOn.set(m.id,N)),N.add(A)}return l})})}listConnectionStatus(){const h=new Map;return this.relays.forEach((m,b)=>h.set(b,m.connected)),h}destroy(){this.relays.forEach(h=>h.close()),this.relays=new Map}},fb;try{fb=WebSocket}catch{}var vS=class extends _S{constructor(h){super({verifyEvent:Gy,websocketImplementation:fb,...h})}},ff={};Yi(ff,{BECH32_REGEX:()=>pb,Bech32MaxSize:()=>E0,NostrTypeGuard:()=>xS,decode:()=>Hy,decodeNostrURI:()=>wS,encodeBytes:()=>Xy,naddrEncode:()=>CS,neventEncode:()=>AS,noteEncode:()=>ES,nprofileEncode:()=>MS,npubEncode:()=>SS,nsecEncode:()=>TS});var xS={isNProfile:h=>/^nprofile1[a-z\d]+$/.test(h||""),isNEvent:h=>/^nevent1[a-z\d]+$/.test(h||""),isNAddr:h=>/^naddr1[a-z\d]+$/.test(h||""),isNSec:h=>/^nsec1[a-z\d]{58}$/.test(h||""),isNPub:h=>/^npub1[a-z\d]{58}$/.test(h||""),isNote:h=>/^note1[a-z\d]+$/.test(h||""),isNcryptsec:h=>/^ncryptsec1[a-z\d]+$/.test(h||"")},E0=5e3,pb=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function bS(h){const m=new Uint8Array(4);return m[0]=h>>24&255,m[1]=h>>16&255,m[2]=h>>8&255,m[3]=h&255,m}function wS(h){try{return h.startsWith("nostr:")&&(h=h.substring(6)),Hy(h)}catch{return{type:"invalid",data:null}}}function Hy(h){let{prefix:m,words:b}=Hp.decode(h,E0),S=new Uint8Array(Hp.fromWords(b));switch(m){case"nprofile":{let z=I_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(z[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Br(z[0][0]),relays:z[1]?z[1].map(k=>Ou.decode(k)):[]}}}case"nevent":{let z=I_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for nevent");if(z[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(z[2]&&z[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(z[3]&&z[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Br(z[0][0]),relays:z[1]?z[1].map(k=>Ou.decode(k)):[],author:z[2]?.[0]?Br(z[2][0]):void 0,kind:z[3]?.[0]?parseInt(Br(z[3][0]),16):void 0}}}case"naddr":{let z=I_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!z[2]?.[0])throw new Error("missing TLV 2 for naddr");if(z[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!z[3]?.[0])throw new Error("missing TLV 3 for naddr");if(z[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ou.decode(z[0][0]),pubkey:Br(z[2][0]),kind:parseInt(Br(z[3][0]),16),relays:z[1]?z[1].map(k=>Ou.decode(k)):[]}}}case"nsec":return{type:m,data:S};case"npub":case"note":return{type:m,data:Br(S)};default:throw new Error(`unknown prefix ${m}`)}}function I_(h){let m={},b=h;for(;b.length>0;){let S=b[0],z=b[1],k=b.slice(2,2+z);if(b=b.slice(2+z),k.length<z)throw new Error(`not enough data to read on TLV ${S}`);m[S]=m[S]||[],m[S].push(k)}return m}function TS(h){return Xy("nsec",h)}function SS(h){return Xy("npub",mf(h))}function ES(h){return Xy("note",mf(h))}function $y(h,m){let b=Hp.toWords(m);return Hp.encode(h,b,E0)}function Xy(h,m){return $y(h,m)}function MS(h){let m=M0({0:[mf(h.pubkey)],1:(h.relays||[]).map(b=>Nl.encode(b))});return $y("nprofile",m)}function AS(h){let m;h.kind!==void 0&&(m=bS(h.kind));let b=M0({0:[mf(h.id)],1:(h.relays||[]).map(S=>Nl.encode(S)),2:h.author?[mf(h.author)]:[],3:m?[new Uint8Array(m)]:[]});return $y("nevent",b)}function CS(h){let m=new ArrayBuffer(4);new DataView(m).setUint32(0,h.kind,!1);let b=M0({0:[Nl.encode(h.identifier)],1:(h.relays||[]).map(S=>Nl.encode(S)),2:[mf(h.pubkey)],3:[new Uint8Array(m)]});return $y("naddr",b)}function M0(h){let m=[];return Object.entries(h).reverse().forEach(([b,S])=>{S.forEach(z=>{let k=new Uint8Array(z.length+2);k.set([parseInt(b)],0),k.set([z.length],1),k.set(z,2),m.push(k)})}),jy(...m)}var zS={};Yi(zS,{decrypt:()=>PS,encrypt:()=>mb});function mb(h,m,b){const S=h instanceof Uint8Array?Br(h):h,z=Xp.getSharedSecret(S,"02"+m),k=gb(z);let A=Uint8Array.from(zx(16)),l=Nl.encode(b),N=jx(k,A).encrypt(l),W=Nu.encode(new Uint8Array(N)),ne=Nu.encode(new Uint8Array(A.buffer));return`${W}?iv=${ne}`}function PS(h,m,b){const S=h instanceof Uint8Array?Br(h):h;let[z,k]=b.split("?iv="),A=Xp.getSharedSecret(S,"02"+m),l=gb(A),N=Nu.decode(k),W=Nu.decode(z),ne=jx(l,N).decrypt(W);return Ou.decode(ne)}function gb(h){return h.slice(1,33)}var DS={};Yi(DS,{NIP05_REGEX:()=>A0,isNip05:()=>IS,isValid:()=>LS,queryProfile:()=>yb,searchDomain:()=>RS,useFetchImplementation:()=>kS});var A0=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,IS=h=>A0.test(h||""),Yy;try{Yy=fetch}catch{}function kS(h){Yy=h}async function RS(h,m=""){try{const b=`https://${h}/.well-known/nostr.json?name=${m}`,S=await Yy(b,{redirect:"manual"});if(S.status!==200)throw Error("Wrong response code");return(await S.json()).names}catch{return{}}}async function yb(h){const m=h.match(A0);if(!m)return null;const[,b="_",S]=m;try{const z=`https://${S}/.well-known/nostr.json?name=${b}`,k=await Yy(z,{redirect:"manual"});if(k.status!==200)throw Error("Wrong response code");const A=await k.json(),l=A.names[b];return l?{pubkey:l,relays:A.relays?.[l]}:null}catch{return null}}async function LS(h,m){const b=await yb(m);return b?b.pubkey===h:!1}var OS={};Yi(OS,{parse:()=>BS});function BS(h){const m={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let b,S;for(let z=h.tags.length-1;z>=0;z--){const k=h.tags[z];if(k[0]==="e"&&k[1]){const[A,l,N,W,ne]=k,re={id:l,relays:N?[N]:[],author:ne};if(W==="root"){m.root=re;continue}if(W==="reply"){m.reply=re;continue}if(W==="mention"){m.mentions.push(re);continue}b?S=re:b=re,m.mentions.push(re);continue}if(k[0]==="q"&&k[1]){const[A,l,N]=k;m.quotes.push({id:l,relays:N?[N]:[]})}if(k[0]==="p"&&k[1]){m.profiles.push({pubkey:k[1],relays:k[2]?[k[2]]:[]});continue}}return m.root||(m.root=S||b||m.reply),m.reply||(m.reply=b||m.root),[m.reply,m.root].forEach(z=>{if(!z)return;let k=m.mentions.indexOf(z);if(k!==-1&&m.mentions.splice(k,1),z.author){let A=m.profiles.find(l=>l.pubkey===z.author);A&&A.relays&&(z.relays||(z.relays=[]),A.relays.forEach(l=>{z.relays?.indexOf(l)===-1&&z.relays.push(l)}),A.relays=z.relays)}}),m.mentions.forEach(z=>{if(z.author){let k=m.profiles.find(A=>A.pubkey===z.author);k&&k.relays&&(z.relays||(z.relays=[]),k.relays.forEach(A=>{z.relays.indexOf(A)===-1&&z.relays.push(A)}),k.relays=z.relays)}}),m}var NS={};Yi(NS,{fetchRelayInformation:()=>jS,useFetchImplementation:()=>FS});var _b;try{_b=fetch}catch{}function FS(h){_b=h}async function jS(h){return await(await fetch(h.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var US={};Yi(US,{fastEventHash:()=>xb,getPow:()=>vb,minePow:()=>VS});function vb(h){let m=0;for(let b=0;b<64;b+=8){const S=parseInt(h.substring(b,b+8),16);if(S===0)m+=32;else{m+=Math.clz32(S);break}}return m}function VS(h,m){let b=0;const S=h,z=["nonce",b.toString(),m.toString()];for(S.tags.push(z);;){const k=Math.floor(new Date().getTime()/1e3);if(k!==S.created_at&&(b=0,S.created_at=k),z[1]=(++b).toString(),S.id=xb(S),vb(S.id)>=m)break}return S}function xb(h){return Br(Xh(Nl.encode(JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content]))))}var qS={};Yi(qS,{unwrapEvent:()=>eE,unwrapManyEvents:()=>tE,wrapEvent:()=>kb,wrapManyEvents:()=>JS});var GS={};Yi(GS,{createRumor:()=>zb,createSeal:()=>Pb,createWrap:()=>Db,unwrapEvent:()=>I0,unwrapManyEvents:()=>Ib,wrapEvent:()=>zy,wrapManyEvents:()=>KS});var ug={};Yi(ug,{decrypt:()=>D0,encrypt:()=>P0,getConversationKey:()=>C0,v2:()=>YS});var bb=1,wb=65535;function C0(h,m){const b=Xp.getSharedSecret(h,"02"+m).subarray(1,33);return M2(Xh,b,"nip44-v2")}function Tb(h,m){const b=A2(Xh,h,m,76);return{chacha_key:b.subarray(0,32),chacha_nonce:b.subarray(32,44),hmac_key:b.subarray(44,76)}}function z0(h){if(!Number.isSafeInteger(h)||h<1)throw new Error("expected positive integer");if(h<=32)return 32;const m=1<<Math.floor(Math.log2(h-1))+1,b=m<=256?32:m/8;return b*(Math.floor((h-1)/b)+1)}function ZS(h){if(!Number.isSafeInteger(h)||h<bb||h>wb)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const m=new Uint8Array(2);return new DataView(m.buffer).setUint16(0,h,!1),m}function HS(h){const m=Nl.encode(h),b=m.length,S=ZS(b),z=new Uint8Array(z0(b)-b);return jy(S,m,z)}function $S(h){const m=new DataView(h.buffer).getUint16(0),b=h.subarray(2,2+m);if(m<bb||m>wb||b.length!==m||h.length!==2+z0(m))throw new Error("invalid padding");return Ou.decode(b)}function Sb(h,m,b){if(b.length!==32)throw new Error("AAD associated data must be 32 bytes");const S=jy(b,m);return Vy(Xh,h,S)}function XS(h){if(typeof h!="string")throw new Error("payload must be a valid string");const m=h.length;if(m<132||m>87472)throw new Error("invalid payload length: "+m);if(h[0]==="#")throw new Error("unknown encryption version");let b;try{b=Nu.decode(h)}catch(k){throw new Error("invalid base64: "+k.message)}const S=b.length;if(S<99||S>65603)throw new Error("invalid data length: "+S);const z=b[0];if(z!==2)throw new Error("unknown encryption version "+z);return{nonce:b.subarray(1,33),ciphertext:b.subarray(33,-32),mac:b.subarray(-32)}}function P0(h,m,b=zx(32)){const{chacha_key:S,chacha_nonce:z,hmac_key:k}=Tb(m,b),A=HS(h),l=Gx(S,z,A),N=Sb(k,l,b);return Nu.encode(jy(new Uint8Array([2]),b,l,N))}function D0(h,m){const{nonce:b,ciphertext:S,mac:z}=XS(h),{chacha_key:k,chacha_nonce:A,hmac_key:l}=Tb(m,b),N=Sb(l,S,b);if(!o2(N,z))throw new Error("invalid MAC");const W=Gx(k,A,S);return $S(W)}var YS={utils:{getConversationKey:C0,calcPaddedLen:z0},encrypt:P0,decrypt:D0},WS=2880*60,Eb=()=>Math.round(Date.now()/1e3),Mb=()=>Math.round(Eb()-Math.random()*WS),Ab=(h,m)=>C0(h,m),Cb=(h,m,b)=>P0(JSON.stringify(h),Ab(m,b)),Av=(h,m)=>JSON.parse(D0(h.content,Ab(m,h.pubkey)));function zb(h,m){const b={created_at:Eb(),content:"",tags:[],...h,pubkey:cg(m)};return b.id=vy(b),b}function Pb(h,m,b){return Ho({kind:Qx,content:Cb(h,m,b),created_at:Mb(),tags:[]},m)}function Db(h,m){const b=Xx();return Ho({kind:ab,content:Cb(h,b,m),created_at:Mb(),tags:[["p",m]]},b)}function zy(h,m,b){const S=zb(h,m),z=Pb(S,m,b);return Db(z,b)}function KS(h,m,b){if(!b||b.length===0)throw new Error("At least one recipient is required.");const S=cg(m),z=[zy(h,m,S)];return b.forEach(k=>{z.push(zy(h,m,k))}),z}function I0(h,m){const b=Av(h,m);return Av(b,m)}function Ib(h,m){let b=[];return h.forEach(S=>{b.push(I0(S,m))}),b.sort((S,z)=>S.created_at-z.created_at),b}function QS(h,m,b,S){const z={created_at:Math.ceil(Date.now()/1e3),kind:Jx,tags:[],content:m};return(Array.isArray(h)?h:[h]).forEach(({publicKey:A,relayUrl:l})=>{z.tags.push(l?["p",A,l]:["p",A])}),S&&z.tags.push(["e",S.eventId,S.relayUrl||"","reply"]),b&&z.tags.push(["subject",b]),z}function kb(h,m,b,S,z){const k=QS(m,b,S,z);return zy(k,h,m.publicKey)}function JS(h,m,b,S,z){if(!m||m.length===0)throw new Error("At least one recipient is required.");return[{publicKey:cg(h)},...m].map(A=>kb(h,A,b,S,z))}var eE=I0,tE=Ib,nE={};Yi(nE,{finishRepostEvent:()=>iE,getRepostedEvent:()=>rE,getRepostedEventPointer:()=>Rb});function iE(h,m,b,S){let z;const k=[...h.tags??[],["e",m.id,b],["p",m.pubkey]];return m.kind===Kx?z=b0:(z=T0,k.push(["k",String(m.kind)])),Ho({kind:z,tags:k,content:h.content===""||m.tags?.find(A=>A[0]==="-")?"":JSON.stringify(m),created_at:h.created_at},S)}function Rb(h){if(![b0,T0].includes(h.kind))return;let m,b;for(let S=h.tags.length-1;S>=0&&(m===void 0||b===void 0);S--){const z=h.tags[S];z.length>=2&&(z[0]==="e"&&m===void 0?m=z:z[0]==="p"&&b===void 0&&(b=z))}if(m!==void 0)return{id:m[1],relays:[m[2],b?.[2]].filter(S=>typeof S=="string"),author:b?.[1]}}function rE(h,{skipVerification:m}={}){const b=Rb(h);if(b===void 0||h.content==="")return;let S;try{S=JSON.parse(h.content)}catch{return}if(S.id===b.id&&!(!m&&!Gy(S)))return S}var aE={};Yi(aE,{NOSTR_URI_REGEX:()=>k0,parse:()=>oE,test:()=>sE});var k0=new RegExp(`nostr:(${pb.source})`);function sE(h){return typeof h=="string"&&new RegExp(`^${k0.source}$`).test(h)}function oE(h){const m=h.match(new RegExp(`^${k0.source}$`));if(!m)throw new Error(`Invalid Nostr URI: ${h}`);return{uri:m[0],value:m[1],decoded:Hy(m[1])}}var lE={};Yi(lE,{finishReactionEvent:()=>cE,getReactedEventPointer:()=>uE});function cE(h,m,b){const S=m.tags.filter(z=>z.length>=2&&(z[0]==="e"||z[0]==="p"));return Ho({...h,kind:w0,tags:[...h.tags??[],...S,["e",m.id],["p",m.pubkey]],content:h.content??"+"},b)}function uE(h){if(h.kind!==w0)return;let m,b;for(let S=h.tags.length-1;S>=0&&(m===void 0||b===void 0);S--){const z=h.tags[S];z.length>=2&&(z[0]==="e"&&m===void 0?m=z:z[0]==="p"&&b===void 0&&(b=z))}if(!(m===void 0||b===void 0))return{id:m[1],relays:[m[2],b[2]].filter(S=>S!==void 0),author:b[1]}}var hE={};Yi(hE,{parse:()=>fE});var Cv=/\W/m,zv=/[^\w\/] |[^\w\/]$|$|,| /m,dE=42;function*fE(h){let m=[];if(typeof h!="string"){for(let k=0;k<h.tags.length;k++){const A=h.tags[k];A[0]==="emoji"&&A.length>=3&&m.push({type:"emoji",shortcode:A[1],url:A[2]})}h=h.content}const b=h.length;let S=0,z=0;e:for(;z<b;){const k=h.indexOf(":",z),A=h.indexOf("#",z);if(k===-1&&A===-1)break e;if(k===-1||A>=0&&A<k){if(A===0||h[A-1]===" "){const l=h.slice(A+1,A+dE).match(Cv),N=l?A+1+l.index:b;yield{type:"text",text:h.slice(S,A)},yield{type:"hashtag",value:h.slice(A+1,N)},z=N,S=z;continue e}z=A+1;continue e}if(h.slice(k-5,k)==="nostr"){const l=h.slice(k+60).match(Cv),N=l?k+60+l.index:b;try{let W,{data:ne,type:re}=Hy(h.slice(k+1,N));switch(re){case"npub":W={pubkey:ne};break;case"note":W={id:ne};break;case"nsec":z=N+1;continue;default:W=ne}S!==k-5&&(yield{type:"text",text:h.slice(S,k-5)}),yield{type:"reference",pointer:W},z=N,S=z;continue e}catch{z=k+1;continue e}}else if(h.slice(k-5,k)==="https"||h.slice(k-4,k)==="http"){const l=h.slice(k+4).match(zv),N=l?k+4+l.index:b,W=h[k-1]==="s"?5:4;try{let ne=new URL(h.slice(k-W,N));if(ne.hostname.indexOf(".")===-1)throw new Error("invalid url");if(S!==k-W&&(yield{type:"text",text:h.slice(S,k-W)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(ne.pathname)){yield{type:"image",url:ne.toString()},z=N,S=z;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(ne.pathname)){yield{type:"video",url:ne.toString()},z=N,S=z;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(ne.pathname)){yield{type:"audio",url:ne.toString()},z=N,S=z;continue e}yield{type:"url",url:ne.toString()},z=N,S=z;continue e}catch{z=N+1;continue e}}else if(h.slice(k-3,k)==="wss"||h.slice(k-2,k)==="ws"){const l=h.slice(k+4).match(zv),N=l?k+4+l.index:b,W=h[k-1]==="s"?3:2;try{let ne=new URL(h.slice(k-W,N));if(ne.hostname.indexOf(".")===-1)throw new Error("invalid ws url");S!==k-W&&(yield{type:"text",text:h.slice(S,k-W)}),yield{type:"relay",url:ne.toString()},z=N,S=z;continue e}catch{z=N+1;continue e}}else{for(let l=0;l<m.length;l++){const N=m[l];if(h[k+N.shortcode.length+1]===":"&&h.slice(k+1,k+N.shortcode.length+1)===N.shortcode){S!==k&&(yield{type:"text",text:h.slice(S,k)}),yield N,z=k+N.shortcode.length+2,S=z;continue e}}z=k+1;continue e}}S!==b&&(yield{type:"text",text:h.slice(S)})}var pE={};Yi(pE,{channelCreateEvent:()=>mE,channelHideMessageEvent:()=>_E,channelMessageEvent:()=>yE,channelMetadataEvent:()=>gE,channelMuteUserEvent:()=>vE});var mE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return Ho({kind:eb,tags:[...h.tags??[]],content:b,created_at:h.created_at},m)},gE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return Ho({kind:tb,tags:[["e",h.channel_create_event_id],...h.tags??[]],content:b,created_at:h.created_at},m)},yE=(h,m)=>{const b=[["e",h.channel_create_event_id,h.relay_url,"root"]];return h.reply_to_channel_message_event_id&&b.push(["e",h.reply_to_channel_message_event_id,h.relay_url,"reply"]),Ho({kind:nb,tags:[...b,...h.tags??[]],content:h.content,created_at:h.created_at},m)},_E=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return Ho({kind:ib,tags:[["e",h.channel_message_event_id],...h.tags??[]],content:b,created_at:h.created_at},m)},vE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return Ho({kind:rb,tags:[["p",h.pubkey_to_mute],...h.tags??[]],content:b,created_at:h.created_at},m)},xE={};Yi(xE,{EMOJI_SHORTCODE_REGEX:()=>Lb,matchAll:()=>bE,regex:()=>R0,replaceAll:()=>wE});var Lb=/:(\w+):/,R0=()=>new RegExp(`\\B${Lb.source}\\B`,"g");function*bE(h){const m=h.matchAll(R0());for(const b of m)try{const[S,z]=b;yield{shortcode:S,name:z,start:b.index,end:b.index+S.length}}catch{}}function wE(h,m){return h.replaceAll(R0(),(b,S)=>m({shortcode:b,name:S}))}var TE={};Yi(TE,{useFetchImplementation:()=>SE,validateGithub:()=>EE});var L0;try{L0=fetch}catch{}function SE(h){L0=h}async function EE(h,m,b){try{return await(await L0(`https://gist.github.com/${m}/${b}/raw`)).text()===`Verifying that I control the following Nostr public key: ${h}`}catch{return!1}}var ME={};Yi(ME,{makeNwcRequestEvent:()=>CE,parseConnectionString:()=>AE});function AE(h){const{host:m,pathname:b,searchParams:S}=new URL(h),z=b||m,k=S.get("relay"),A=S.get("secret");if(!z||!k||!A)throw new Error("invalid connection string");return{pubkey:z,relay:k,secret:A}}async function CE(h,m,b){const z=mb(m,h,JSON.stringify({method:"pay_invoice",params:{invoice:b}})),k={kind:ob,created_at:Math.round(Date.now()/1e3),content:z,tags:[["p",h]]};return Ho(k,m)}var zE={};Yi(zE,{normalizeIdentifier:()=>PE});function PE(h){return h=h.trim().toLowerCase(),h=h.normalize("NFKC"),Array.from(h).map(m=>new RegExp("\\p{Letter}","u").test(m)||new RegExp("\\p{Number}","u").test(m)?m:"-").join("")}var DE={};Yi(DE,{getSatoshisAmountFromBolt11:()=>BE,getZapEndpoint:()=>kE,makeZapReceipt:()=>OE,makeZapRequest:()=>RE,useFetchImplementation:()=>IE,validateZapRequest:()=>LE});var O0;try{O0=fetch}catch{}function IE(h){O0=h}async function kE(h){try{let m="",{lud06:b,lud16:S}=JSON.parse(h.content);if(S){let[A,l]=S.split("@");m=new URL(`/.well-known/lnurlp/${A}`,`https://${l}`).toString()}else if(b){let{words:A}=Hp.decode(b,1e3),l=Hp.fromWords(A);m=Ou.decode(l)}else return null;let k=await(await O0(m)).json();if(k.allowsNostr&&k.nostrPubkey)return k.callback}catch{}return null}function RE(h){let m={kind:9734,created_at:Math.round(Date.now()/1e3),content:h.comment||"",tags:[["p","pubkey"in h?h.pubkey:h.event.pubkey],["amount",h.amount.toString()],["relays",...h.relays]]};if("event"in h){if(m.tags.push(["e",h.event.id]),v0(h.event.kind)){const b=["a",`${h.event.kind}:${h.event.pubkey}:`];m.tags.push(b)}else if(x0(h.event.kind)){let b=h.event.tags.find(([z,k])=>z==="d"&&k);if(!b)throw new Error("d tag not found or is empty");const S=["a",`${h.event.kind}:${h.event.pubkey}:${b[1]}`];m.tags.push(S)}m.tags.push(["k",h.event.kind.toString()])}return m}function LE(h){let m;try{m=JSON.parse(h)}catch{return"Invalid zap request JSON."}if(!y0(m))return"Zap request is not a valid Nostr event.";if(!Gy(m))return"Invalid signature on zap request.";let b=m.tags.find(([k,A])=>k==="p"&&A);if(!b)return"Zap request doesn't have a 'p' tag.";if(!b[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let S=m.tags.find(([k,A])=>k==="e"&&A);return S&&!S[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":m.tags.find(([k,A])=>k==="relays"&&A)?null:"Zap request doesn't have a 'relays' tag."}function OE({zapRequest:h,preimage:m,bolt11:b,paidAt:S}){let z=JSON.parse(h),k=z.tags.filter(([l])=>l==="e"||l==="p"||l==="a"),A={kind:9735,created_at:Math.round(S.getTime()/1e3),content:"",tags:[...k,["P",z.pubkey],["bolt11",b],["description",h]]};return m&&A.tags.push(["preimage",m]),A}function BE(h){if(h.length<50)return 0;h=h.substring(0,50);const m=h.lastIndexOf("1");if(m===-1)return 0;const b=h.substring(0,m);if(!b.startsWith("lnbc"))return 0;const S=b.substring(4);if(S.length<1)return 0;const z=S[S.length-1],k=z.charCodeAt(0)-48,A=k>=0&&k<=9;let l=S.length-1;if(A&&l++,l<1)return 0;const N=parseInt(S.substring(0,l));switch(z){case"m":return N*1e5;case"u":return N*100;case"n":return N/10;case"p":return N/1e4;default:return N*1e8}}var NE={};Yi(NE,{Negentropy:()=>Bb,NegentropyStorageVector:()=>UE,NegentropySync:()=>VE});var k_=97,Vp=32,Ob=16,of={Skip:0,Fingerprint:1,IdList:2},Lu=class{_raw;length;constructor(h){typeof h=="number"?(this._raw=new Uint8Array(h),this.length=0):h instanceof Uint8Array?(this._raw=new Uint8Array(h),this.length=h.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(h){if(h instanceof Lu&&(h=h.unwrap()),typeof h.length!="number")throw Error("bad length");const m=h.length+this.length;if(this.capacity<m){const b=this._raw,S=Math.max(this.capacity*2,m);this._raw=new Uint8Array(S),this._raw.set(b)}this._raw.set(h,this.length),this.length+=h.length}shift(){const h=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,h}shiftN(h=1){const m=this._raw.subarray(0,h);return this._raw=this._raw.subarray(h),this.length-=h,m}};function gy(h){let m=0;for(;;){if(h.length===0)throw Error("parse ends prematurely");let b=h.shift();if(m=m<<7|b&127,(b&128)===0)break}return m}function ku(h){if(h===0)return new Lu(new Uint8Array([0]));let m=[];for(;h!==0;)m.push(h&127),h>>>=7;m.reverse();for(let b=0;b<m.length-1;b++)m[b]|=128;return new Lu(new Uint8Array(m))}function FE(h){return xy(h,1)[0]}function xy(h,m){if(h.length<m)throw Error("parse ends prematurely");return h.shiftN(m)}var jE=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(Vp)}add(h){let m=0,b=0,S=new DataView(this.buf.buffer),z=new DataView(h.buffer);for(let k=0;k<8;k++){let A=k*4,l=S.getUint32(A,!0),N=z.getUint32(A,!0),W=l;W+=m,W+=N,W>4294967295&&(b=1),S.setUint32(A,W&4294967295,!0),m=b,b=0}}negate(){let h=new DataView(this.buf.buffer);for(let b=0;b<8;b++){let S=b*4;h.setUint32(S,~h.getUint32(S,!0))}let m=new Uint8Array(Vp);m[0]=1,this.add(m)}getFingerprint(h){let m=new Lu;return m.extend(this.buf),m.extend(ku(h)),Xh(m.unwrap()).subarray(0,Ob)}},UE=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(h,m){if(this.sealed)throw Error("already sealed");const b=Lx(m);if(b.byteLength!==Vp)throw Error("bad id size for added item");this.items.push({timestamp:h,id:b})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(R_);for(let h=1;h<this.items.length;h++)if(R_(this.items[h-1],this.items[h])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(h){if(this._checkSealed(),h>=this.items.length)throw Error("out of range");return this.items[h]}iterate(h,m,b){this._checkSealed(),this._checkBounds(h,m);for(let S=h;S<m&&b(this.items[S],S);++S);}findLowerBound(h,m,b){return this._checkSealed(),this._checkBounds(h,m),this._binarySearch(this.items,h,m,S=>R_(S,b)<0)}fingerprint(h,m){let b=new jE;return b.setToZero(),this.iterate(h,m,S=>(b.add(S.id),!0)),b.getFingerprint(m-h)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(h,m){if(h>m||m>this.items.length)throw Error("bad range")}_binarySearch(h,m,b,S){let z=b-m;for(;z>0;){let k=m,A=Math.floor(z/2);k+=A,S(h[k])?(m=++k,z-=A+1):z=A}return m}},Bb=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(h,m=6e4){if(m<4096)throw Error("frameSizeLimit too small");this.storage=h,this.frameSizeLimit=m,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(h,m){return{timestamp:h,id:m||new Uint8Array(0)}}initiate(){let h=new Lu;return h.extend(new Uint8Array([k_])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),h),Fp(h.unwrap())}reconcile(h,m,b){const S=new Lu(Lx(h));this.lastTimestampIn=this.lastTimestampOut=0;let z=new Lu;z.extend(new Uint8Array([k_]));let k=FE(S);if(k<96||k>111)throw Error("invalid negentropy protocol version byte");if(k!==k_)throw Error("unsupported negentropy protocol version requested: "+(k-96));let A=this.storage.size(),l=this._bound(0),N=0,W=!1;for(;S.length!==0;){let ne=new Lu,re=()=>{W&&(W=!1,ne.extend(this.encodeBound(l)),ne.extend(ku(of.Skip)))},Me=this.decodeBound(S),be=gy(S),Ie=N,fe=this.storage.findLowerBound(N,A,Me);if(be===of.Skip)W=!0;else if(be===of.Fingerprint){let ie=xy(S,Ob),Le=this.storage.fingerprint(Ie,fe);Nb(ie,Le)!==0?(re(),this.splitRange(Ie,fe,Me,ne)):W=!0}else if(be===of.IdList){let ie=gy(S),Le={};for(let Ke=0;Ke<ie;Ke++){let ht=xy(S,Vp);Le[Fp(ht)]=ht}if(W=!0,this.storage.iterate(Ie,fe,Ke=>{let ht=Ke.id;const Ct=Fp(ht);return Le[Ct]?delete Le[Fp(ht)]:m?.(Ct),!0}),b)for(let Ke of Object.values(Le))b(Fp(Ke))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(z.length+ne.length)){let ie=this.storage.fingerprint(fe,A);z.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),z.extend(ku(of.Fingerprint)),z.extend(ie);break}else z.extend(ne);N=fe,l=Me}return z.length===1?null:Fp(z.unwrap())}splitRange(h,m,b,S){let z=m-h,k=16;if(z<k*2)S.extend(this.encodeBound(b)),S.extend(ku(of.IdList)),S.extend(ku(z)),this.storage.iterate(h,m,A=>(S.extend(A.id),!0));else{let A=Math.floor(z/k),l=z%k,N=h;for(let W=0;W<k;W++){let ne=A+(W<l?1:0),re=this.storage.fingerprint(N,N+ne);N+=ne;let Me;if(N===m)Me=b;else{let be,Ie;this.storage.iterate(N-1,N+1,(fe,ie)=>(ie===N-1?be=fe:Ie=fe,!0)),Me=this.getMinimalBound(be,Ie)}S.extend(this.encodeBound(Me)),S.extend(ku(of.Fingerprint)),S.extend(re)}}}exceededFrameSizeLimit(h){return h>this.frameSizeLimit-200}decodeTimestampIn(h){let m=gy(h);return m=m===0?Number.MAX_VALUE:m-1,this.lastTimestampIn===Number.MAX_VALUE||m===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(m+=this.lastTimestampIn,this.lastTimestampIn=m,m)}decodeBound(h){let m=this.decodeTimestampIn(h),b=gy(h);if(b>Vp)throw Error("bound key too long");let S=xy(h,b);return{timestamp:m,id:S}}encodeTimestampOut(h){if(h===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,ku(0);let m=h;return h-=this.lastTimestampOut,this.lastTimestampOut=m,ku(h+1)}encodeBound(h){let m=new Lu;return m.extend(this.encodeTimestampOut(h.timestamp)),m.extend(ku(h.id.length)),m.extend(h.id),m}getMinimalBound(h,m){if(m.timestamp!==h.timestamp)return this._bound(m.timestamp);{let b=0,S=m.id,z=h.id;for(let k=0;k<Vp&&S[k]===z[k];k++)b++;return this._bound(m.timestamp,m.id.subarray(0,b+1))}}};function Nb(h,m){for(let b=0;b<h.byteLength;b++){if(h[b]<m[b])return-1;if(h[b]>m[b])return 1}return h.byteLength>m.byteLength?1:h.byteLength<m.byteLength?-1:0}function R_(h,m){return h.timestamp===m.timestamp?Nb(h.id,m.id):h.timestamp-m.timestamp}var VE=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(h,m,b,S={}){this.relay=h,this.storage=m,this.neg=new Bb(m),this.onhave=S.onhave,this.onneed=S.onneed,this.filter=b,this.subscription=this.relay.prepareSubscription([{}],{label:S.label||"negentropy"}),this.subscription.oncustom=z=>{switch(z[0]){case"NEG-MSG":{z.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${z}`);try{const k=this.neg.reconcile(z[2],this.onhave,this.onneed);k?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${k}"]`):(this.close(),S.onclose?.())}catch(k){console.error("negentropy reconcile error:",k),S?.onclose?.(`reconcile error: ${k}`)}break}case"NEG-CLOSE":{const k=z[2];console.warn("negentropy error:",k),S.onclose?.(k);break}case"NEG-ERR":S.onclose?.()}}}async start(){const h=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${h}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},qE={};Yi(qE,{getToken:()=>GE,hashPayload:()=>B0,unpackEventFromToken:()=>jb,validateEvent:()=>Hb,validateEventKind:()=>Vb,validateEventMethodTag:()=>Gb,validateEventPayloadTag:()=>Zb,validateEventTimestamp:()=>Ub,validateEventUrlTag:()=>qb,validateToken:()=>ZE});var Fb="Nostr ";async function GE(h,m,b,S=!1,z){const k={kind:S0,tags:[["u",h],["method",m]],created_at:Math.round(new Date().getTime()/1e3),content:""};z&&k.tags.push(["payload",B0(z)]);const A=await b(k);return(S?Fb:"")+Nu.encode(Nl.encode(JSON.stringify(A)))}async function ZE(h,m,b){const S=await jb(h).catch(k=>{throw k});return await Hb(S,m,b).catch(k=>{throw k})}async function jb(h){if(!h)throw new Error("Missing token");h=h.replace(Fb,"");const m=Ou.decode(Nu.decode(h));if(!m||m.length===0||!m.startsWith("{"))throw new Error("Invalid token");return JSON.parse(m)}function Ub(h){return h.created_at?Math.round(new Date().getTime()/1e3)-h.created_at<60:!1}function Vb(h){return h.kind===S0}function qb(h,m){const b=h.tags.find(S=>S[0]==="u");return b?b.length>0&&b[1]===m:!1}function Gb(h,m){const b=h.tags.find(S=>S[0]==="method");return b?b.length>0&&b[1].toLowerCase()===m.toLowerCase():!1}function B0(h){const m=Xh(Nl.encode(JSON.stringify(h)));return Br(m)}function Zb(h,m){const b=h.tags.find(z=>z[0]==="payload");if(!b)return!1;const S=B0(m);return b.length>0&&b[1]===S}async function Hb(h,m,b,S){if(!Gy(h))throw new Error("Invalid nostr event, signature invalid");if(!Vb(h))throw new Error("Invalid nostr event, kind invalid");if(!Ub(h))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!qb(h,m))throw new Error("Invalid nostr event, url tag invalid");if(!Gb(h,b))throw new Error("Invalid nostr event, method tag invalid");if(S&&typeof S=="object"&&Object.keys(S).length>0&&!Zb(h,S))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Pv=h=>Array.from(h).map(m=>m.toString(16).padStart(2,"0")).join(""),$b=Ae.createContext(null),HE=({children:h})=>{const[m,b]=Ae.useState(localStorage.getItem("parlens_pubkey")),[S]=Ae.useState(()=>new vS({enablePing:!0,enableReconnect:!0})),z=async(l,N,W)=>{let ne="",re=null;if(l==="extension"){if(!window.nostr)throw new Error("Nostr extension not found");ne=await window.nostr.getPublicKey()}else if(l==="nsec"&&N)try{const Me=ff.decode(N);if(Me.type!=="nsec")throw new Error("Not an nsec");re=Me.data,ne=cg(re),localStorage.setItem("parlens_privkey",Pv(re))}catch{throw new Error("Invalid nsec format")}else l==="create"&&(re=Xx(),ne=cg(re),localStorage.setItem("parlens_privkey",Pv(re)));if(b(ne),localStorage.setItem("parlens_pubkey",ne),l==="create"&&W&&re)try{const Me=Ho({kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:W,display_name:W,picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${ne}`})},re);await Promise.any([S.publish(["wss://relay.damus.io","wss://nos.lol"],Me)])}catch(Me){console.warn("Failed to publish metadata:",Me)}},k=()=>{b(null),localStorage.removeItem("parlens_pubkey"),localStorage.removeItem("parlens_privkey")},A=async l=>{const N=localStorage.getItem("parlens_privkey");if(N){const W=new Uint8Array(N.match(/.{1,2}/g).map(ne=>parseInt(ne,16)));return Ho(l,W)}if(window.nostr)return await window.nostr.signEvent(l);throw new Error("No signing method available")};return U.jsx($b.Provider,{value:{pubkey:m,login:z,logout:k,pool:S,signEvent:A},children:h})},Wp=()=>{const h=Ae.useContext($b);if(!h)throw new Error("useAuth must be used within AuthProvider");return h};const $E=h=>h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),XE=h=>h.replace(/^([A-Z])|[\s-_]+(\w)/g,(m,b,S)=>S?S.toUpperCase():b.toLowerCase()),Dv=h=>{const m=XE(h);return m.charAt(0).toUpperCase()+m.slice(1)},Xb=(...h)=>h.filter((m,b,S)=>!!m&&m.trim()!==""&&S.indexOf(m)===b).join(" ").trim(),YE=h=>{for(const m in h)if(m.startsWith("aria-")||m==="role"||m==="title")return!0};var WE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const KE=Ae.forwardRef(({color:h="currentColor",size:m=24,strokeWidth:b=2,absoluteStrokeWidth:S,className:z="",children:k,iconNode:A,...l},N)=>Ae.createElement("svg",{ref:N,...WE,width:m,height:m,stroke:h,strokeWidth:S?Number(b)*24/Number(m):b,className:Xb("lucide",z),...!k&&!YE(l)&&{"aria-hidden":"true"},...l},[...A.map(([W,ne])=>Ae.createElement(W,ne)),...Array.isArray(k)?k:[k]]));const ki=(h,m)=>{const b=Ae.forwardRef(({className:S,...z},k)=>Ae.createElement(KE,{ref:k,iconNode:m,className:Xb(`lucide-${$E(Dv(h))}`,`lucide-${h}`,S),...z}));return b.displayName=Dv(h),b};const QE=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],JE=ki("arrow-right",QE);const eM=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],tM=ki("arrow-up-down",eM);const nM=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],iM=ki("arrow-up",nM);const rM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],by=ki("check",rM);const aM=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Bu=ki("chevron-down",aM);const sM=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Py=ki("chevron-right",sM);const oM=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],N0=ki("chevron-up",oM);const lM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Iv=ki("circle-question-mark",lM);const cM=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Yb=ki("clock",cM);const uM=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],hM=ki("eye-off",uM);const dM=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],fM=ki("eye",dM);const pM=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],mM=ki("folder-open",pM);const gM=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Y_=ki("key",gM);const yM=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],yy=ki("locate",yM);const _M=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],gf=ki("map-pin",_M);const vM=[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]],xM=ki("map-pinned",vM);const bM=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],wM=ki("navigation",bM);const TM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],W_=ki("pencil",TM);const SM=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],EM=ki("route",SM);const MM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],AM=ki("save",MM);const CM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],zM=ki("search",CM);const PM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Wb=ki("shield",PM);const DM=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],K_=ki("trash-2",DM);const IM=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],kv=ki("trash",IM);const kM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],RM=ki("user-plus",kM);const LM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],OM=ki("user",LM);const BM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],qp=ki("x",BM),NM=Ae.createContext(null);function FM(h,m){const b=Array.isArray(h)?h[0]:h?h.x:0,S=Array.isArray(h)?h[1]:h?h.y:0,z=Array.isArray(m)?m[0]:m?m.x:0,k=Array.isArray(m)?m[1]:m?m.y:0;return b===z&&S===k}function Fs(h,m){if(h===m)return!0;if(!h||!m)return!1;if(Array.isArray(h)){if(!Array.isArray(m)||h.length!==m.length)return!1;for(let b=0;b<h.length;b++)if(!Fs(h[b],m[b]))return!1;return!0}else if(Array.isArray(m))return!1;if(typeof h=="object"&&typeof m=="object"){const b=Object.keys(h),S=Object.keys(m);if(b.length!==S.length)return!1;for(const z of b)if(!m.hasOwnProperty(z)||!Fs(h[z],m[z]))return!1;return!0}return!1}function Rv(h){return{longitude:h.center.lng,latitude:h.center.lat,zoom:h.zoom,pitch:h.pitch,bearing:h.bearing,padding:h.padding}}function Lv(h,m){const b=m.viewState||m,S={};if("longitude"in b&&"latitude"in b&&(b.longitude!==h.center.lng||b.latitude!==h.center.lat)){const z=h.center.constructor;S.center=new z(b.longitude,b.latitude)}return"zoom"in b&&b.zoom!==h.zoom&&(S.zoom=b.zoom),"bearing"in b&&b.bearing!==h.bearing&&(S.bearing=b.bearing),"pitch"in b&&b.pitch!==h.pitch&&(S.pitch=b.pitch),b.padding&&h.padding&&!Fs(b.padding,h.padding)&&(S.padding=b.padding),S}const jM=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ov(h){if(!h)return null;if(typeof h=="string"||("toJS"in h&&(h=h.toJS()),!h.layers))return h;const m={};for(const S of h.layers)m[S.id]=S;const b=h.layers.map(S=>{let z=null;"interactive"in S&&(z=Object.assign({},S),delete z.interactive);const k=m[S.ref];if(k){z=z||Object.assign({},S),delete z.ref;for(const A of jM)A in k&&(z[A]=k[A])}return z||S});return{...h,layers:b}}const Bv={version:8,sources:{},layers:[]},Nv={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Fv={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},jv={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},UM=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],VM=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class $p{constructor(m,b,S){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=z=>{const k=this.props[jv[z.type]];k?k(z):z.type==="error"&&console.error(z.error)},this._onCameraEvent=z=>{if(this._internalUpdate)return;z.viewState=this._propsedCameraUpdate||Rv(this._map.transform);const k=this.props[Fv[z.type]];k&&k(z)},this._onCameraUpdate=z=>this._internalUpdate?z:(this._propsedCameraUpdate=Rv(z),Lv(z,this.props)),this._onPointerEvent=z=>{(z.type==="mousemove"||z.type==="mouseout")&&this._updateHover(z);const k=this.props[Nv[z.type]];k&&(this.props.interactiveLayerIds&&z.type!=="mouseover"&&z.type!=="mouseout"&&(z.features=this._hoveredFeatures||this._queryRenderedFeatures(z.point)),k(z),delete z.features)},this._MapClass=m,this.props=b,this._initialize(S)}get map(){return this._map}setProps(m){const b=this.props;this.props=m;const S=this._updateSettings(m,b),z=this._updateSize(m),k=this._updateViewState(m);this._updateStyle(m,b),this._updateStyleComponents(m),this._updateHandlers(m,b),(S||z||k&&!this._map.isMoving())&&this.redraw()}static reuse(m,b){const S=$p.savedMaps.pop();if(!S)return null;const z=S.map,k=z.getContainer();for(b.className=k.className;k.childNodes.length>0;)b.appendChild(k.childNodes[0]);z._container=b;const A=z._resizeObserver;A&&(A.disconnect(),A.observe(b)),S.setProps({...m,styleDiffing:!1}),z.resize();const{initialViewState:l}=m;return l&&(l.bounds?z.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):S._updateViewState(l)),z.isStyleLoaded()?z.fire("load"):z.once("style.load",()=>z.fire("load")),z._update(),S}_initialize(m){const{props:b}=this,{mapStyle:S=Bv}=b,z={...b,...b.initialViewState,container:m,style:Ov(S)},k=z.initialViewState||z.viewState||z;if(Object.assign(z,{center:[k.longitude||0,k.latitude||0],zoom:k.zoom||0,pitch:k.pitch||0,bearing:k.bearing||0}),b.gl){const l=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=l,b.gl)}const A=new this._MapClass(z);k.padding&&A.setPadding(k.padding),b.cursor&&(A.getCanvas().style.cursor=b.cursor),A.transformCameraUpdate=this._onCameraUpdate,A.on("style.load",()=>{this._styleComponents={light:A.getLight(),sky:A.getSky(),projection:A.getProjection?.(),terrain:A.getTerrain()},this._updateStyleComponents(this.props)}),A.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const l in Nv)A.on(l,this._onPointerEvent);for(const l in Fv)A.on(l,this._onCameraEvent);for(const l in jv)A.on(l,this._onEvent);this._map=A}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),$p.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const m=this._map;m.style&&(m._frame&&(m._frame.cancel(),m._frame=null),m._render())}_updateSize(m){const{viewState:b}=m;if(b){const S=this._map;if(b.width!==S.transform.width||b.height!==S.transform.height)return S.resize(),!0}return!1}_updateViewState(m){const b=this._map,S=b.transform;if(!b.isMoving()){const k=Lv(S,m);if(Object.keys(k).length>0)return this._internalUpdate=!0,b.jumpTo(k),this._internalUpdate=!1,!0}return!1}_updateSettings(m,b){const S=this._map;let z=!1;for(const k of UM)k in m&&!Fs(m[k],b[k])&&(z=!0,S[`set${k[0].toUpperCase()}${k.slice(1)}`]?.call(S,m[k]));return z}_updateStyle(m,b){if(m.cursor!==b.cursor&&(this._map.getCanvas().style.cursor=m.cursor||""),m.mapStyle!==b.mapStyle){const{mapStyle:S=Bv,styleDiffing:z=!0}=m,k={diff:z};"localIdeographFontFamily"in m&&(k.localIdeographFontFamily=m.localIdeographFontFamily),this._map.setStyle(Ov(S),k)}}_updateStyleComponents({light:m,projection:b,sky:S,terrain:z}){const k=this._map,A=this._styleComponents;k.style._loaded&&(m&&!Fs(m,A.light)&&(A.light=m,k.setLight(m)),b&&!Fs(b,A.projection)&&b!==A.projection?.type&&(A.projection=typeof b=="string"?{type:b}:b,k.setProjection?.(A.projection)),S&&!Fs(S,A.sky)&&(A.sky=S,k.setSky(S)),z!==void 0&&!Fs(z,A.terrain)&&(!z||k.getSource(z.source))&&(A.terrain=z,k.setTerrain(z)))}_updateHandlers(m,b){const S=this._map;for(const z of VM){const k=m[z]??!0,A=b[z]??!0;Fs(k,A)||(k?S[z].enable(k):S[z].disable())}}_queryRenderedFeatures(m){const b=this._map,{interactiveLayerIds:S=[]}=this.props;try{return b.queryRenderedFeatures(m,{layers:S.filter(b.getLayer.bind(b))})}catch{return[]}}_updateHover(m){const{props:b}=this;if(b.interactiveLayerIds&&(b.onMouseMove||b.onMouseEnter||b.onMouseLeave)){const z=m.type,k=this._hoveredFeatures?.length>0,A=this._queryRenderedFeatures(m.point),l=A.length>0;!l&&k&&(m.type="mouseleave",this._onPointerEvent(m)),this._hoveredFeatures=A,l&&!k&&(m.type="mouseenter",this._onPointerEvent(m)),m.type=z}else this._hoveredFeatures=null}}$p.savedMaps=[];const qM=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function GM(h){if(!h)return null;const m=h.map,b={getMap:()=>m};for(const S of ZM(m))!(S in b)&&!qM.includes(S)&&(b[S]=m[S].bind(m));return b}function ZM(h){const m=new Set;let b=h;for(;b;){for(const S of Object.getOwnPropertyNames(b))S[0]!=="_"&&typeof h[S]=="function"&&S!=="fire"&&S!=="setEventedParent"&&m.add(S);b=Object.getPrototypeOf(b)}return Array.from(m)}const HM=typeof document<"u"?Ae.useLayoutEffect:Ae.useEffect;function $M(h,m){const{RTLTextPlugin:b,maxParallelImageRequests:S,workerCount:z,workerUrl:k}=m;if(b&&h.getRTLTextPluginStatus&&h.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:A,lazy:l=!0}=typeof b=="string"?{pluginUrl:b}:b;h.setRTLTextPlugin(A,N=>{N&&console.error(N)},l)}S!==void 0&&h.setMaxParallelImageRequests(S),z!==void 0&&h.setWorkerCount(z),k!==void 0&&h.setWorkerUrl(k)}const Kp=Ae.createContext(null);function XM(h,m){const b=Ae.useContext(NM),[S,z]=Ae.useState(null),k=Ae.useRef(),{current:A}=Ae.useRef({mapLib:null,map:null});Ae.useEffect(()=>{const W=h.mapLib;let ne=!0,re;return Promise.resolve(W||ox(()=>Promise.resolve().then(()=>dA),void 0)).then(Me=>{if(!ne)return;if(!Me)throw new Error("Invalid mapLib");const be="Map"in Me?Me:Me.default;if(!be.Map)throw new Error("Invalid mapLib");$M(be,h),h.reuseMaps&&(re=$p.reuse(h,k.current)),re||(re=new $p(be.Map,h,k.current)),A.map=GM(re),A.mapLib=be,z(re),b?.onMapMount(A.map,h.id)}).catch(Me=>{const{onError:be}=h;be?be({type:"error",target:null,originalEvent:null,error:Me}):console.error(Me)}),()=>{ne=!1,re&&(b?.onMapUnmount(h.id),h.reuseMaps?re.recycle():re.destroy())}},[]),HM(()=>{S&&S.setProps(h)}),Ae.useImperativeHandle(m,()=>A.map,[S]);const l=Ae.useMemo(()=>({position:"relative",width:"100%",height:"100%",...h.style}),[h.style]),N={height:"100%"};return Ae.createElement("div",{id:h.id,ref:k,style:l},S&&Ae.createElement(Kp.Provider,{value:A},Ae.createElement("div",{"mapboxgl-children":"",style:N},h.children)))}const YM=Ae.forwardRef(XM);var Kb=sx();const WM=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Vu(h,m){if(!h||!m)return;const b=h.style;for(const S in m){const z=m[S];Number.isFinite(z)&&!WM.test(S)?b[S]=`${z}px`:b[S]=z}}function Qb(h,m){if(h===m)return null;const b=Uv(h),S=Uv(m),z=[];for(const k of S)b.has(k)||z.push(k);for(const k of b)S.has(k)||z.push(k);return z.length===0?null:z}function Uv(h){return new Set(h?h.trim().split(/\s+/):[])}const jp=Ae.memo(Ae.forwardRef((h,m)=>{const{map:b,mapLib:S}=Ae.useContext(Kp),z=Ae.useRef({props:h}),k=Ae.useMemo(()=>{let Le=!1;Ae.Children.forEach(h.children,Ct=>{Ct&&(Le=!0)});const Ke={...h,element:Le?document.createElement("div"):void 0},ht=new S.Marker(Ke);return ht.setLngLat([h.longitude,h.latitude]),ht.getElement().addEventListener("click",Ct=>{z.current.props.onClick?.({type:"click",target:ht,originalEvent:Ct})}),ht.on("dragstart",Ct=>{const zt=Ct;zt.lngLat=k.getLngLat(),z.current.props.onDragStart?.(zt)}),ht.on("drag",Ct=>{const zt=Ct;zt.lngLat=k.getLngLat(),z.current.props.onDrag?.(zt)}),ht.on("dragend",Ct=>{const zt=Ct;zt.lngLat=k.getLngLat(),z.current.props.onDragEnd?.(zt)}),ht},[]);Ae.useEffect(()=>(k.addTo(b.getMap()),()=>{k.remove()}),[]);const{longitude:A,latitude:l,offset:N,style:W,draggable:ne=!1,popup:re=null,rotation:Me=0,rotationAlignment:be="auto",pitchAlignment:Ie="auto"}=h;Ae.useEffect(()=>{Vu(k.getElement(),W)},[W]),Ae.useImperativeHandle(m,()=>k,[]);const fe=z.current.props;(k.getLngLat().lng!==A||k.getLngLat().lat!==l)&&k.setLngLat([A,l]),N&&!FM(k.getOffset(),N)&&k.setOffset(N),k.isDraggable()!==ne&&k.setDraggable(ne),k.getRotation()!==Me&&k.setRotation(Me),k.getRotationAlignment()!==be&&k.setRotationAlignment(be),k.getPitchAlignment()!==Ie&&k.setPitchAlignment(Ie),k.getPopup()!==re&&k.setPopup(re);const ie=Qb(fe.className,h.className);if(ie)for(const Le of ie)k.toggleClassName(Le);return z.current.props=h,Kb.createPortal(h.children,k.getElement())}));Ae.memo(Ae.forwardRef((h,m)=>{const{map:b,mapLib:S}=Ae.useContext(Kp),z=Ae.useMemo(()=>document.createElement("div"),[]),k=Ae.useRef({props:h}),A=Ae.useMemo(()=>{const l={...h},N=new S.Popup(l);return N.setLngLat([h.longitude,h.latitude]),N.once("open",W=>{k.current.props.onOpen?.(W)}),N},[]);if(Ae.useEffect(()=>{const l=N=>{k.current.props.onClose?.(N)};return A.on("close",l),A.setDOMContent(z).addTo(b.getMap()),()=>{A.off("close",l),A.isOpen()&&A.remove()}},[]),Ae.useEffect(()=>{Vu(A.getElement(),h.style)},[h.style]),Ae.useImperativeHandle(m,()=>A,[]),A.isOpen()){const l=k.current.props;(A.getLngLat().lng!==h.longitude||A.getLngLat().lat!==h.latitude)&&A.setLngLat([h.longitude,h.latitude]),h.offset&&!Fs(l.offset,h.offset)&&A.setOffset(h.offset),(l.anchor!==h.anchor||l.maxWidth!==h.maxWidth)&&(A.options.anchor=h.anchor,A.setMaxWidth(h.maxWidth));const N=Qb(l.className,h.className);if(N)for(const W of N)A.toggleClassName(W);k.current.props=h}return Kb.createPortal(h.children,z)}));function yf(h,m,b,S){const z=Ae.useContext(Kp),k=Ae.useMemo(()=>h(z),[]);return Ae.useEffect(()=>{const A=m,l=null,N=typeof m=="function"?m:null,{map:W}=z;return W.hasControl(k)||(W.addControl(k,A?.position),l&&l(z)),()=>{N&&N(z),W.hasControl(k)&&W.removeControl(k)}},[]),k}function KM(h){const m=yf(({mapLib:b})=>new b.AttributionControl(h),{position:h.position});return Ae.useEffect(()=>{Vu(m._container,h.style)},[h.style]),null}Ae.memo(KM);function QM(h){const m=yf(({mapLib:b})=>new b.FullscreenControl({container:h.containerId&&document.getElementById(h.containerId)}),{position:h.position});return Ae.useEffect(()=>{Vu(m._controlContainer,h.style)},[h.style]),null}Ae.memo(QM);function JM(h,m){const b=Ae.useRef({props:h}),S=yf(({mapLib:z})=>{const k=new z.GeolocateControl(h),A=k._setupUI;return k._setupUI=()=>{k._container.hasChildNodes()||A()},k.on("geolocate",l=>{b.current.props.onGeolocate?.(l)}),k.on("error",l=>{b.current.props.onError?.(l)}),k.on("outofmaxbounds",l=>{b.current.props.onOutOfMaxBounds?.(l)}),k.on("trackuserlocationstart",l=>{b.current.props.onTrackUserLocationStart?.(l)}),k.on("trackuserlocationend",l=>{b.current.props.onTrackUserLocationEnd?.(l)}),k},{position:h.position});return b.current.props=h,Ae.useImperativeHandle(m,()=>S,[]),Ae.useEffect(()=>{Vu(S._container,h.style)},[h.style]),null}Ae.memo(Ae.forwardRef(JM));function eA(h){const m=yf(({mapLib:b})=>new b.NavigationControl(h),{position:h.position});return Ae.useEffect(()=>{Vu(m._container,h.style)},[h.style]),null}Ae.memo(eA);function tA(h){const m=yf(({mapLib:k})=>new k.ScaleControl(h),{position:h.position}),b=Ae.useRef(h),S=b.current;b.current=h;const{style:z}=h;return h.maxWidth!==void 0&&h.maxWidth!==S.maxWidth&&(m.options.maxWidth=h.maxWidth),h.unit!==void 0&&h.unit!==S.unit&&m.setUnit(h.unit),Ae.useEffect(()=>{Vu(m._container,z)},[z]),null}Ae.memo(tA);function nA(h){const m=yf(({mapLib:b})=>new b.TerrainControl(h),{position:h.position});return Ae.useEffect(()=>{Vu(m._container,h.style)},[h.style]),null}Ae.memo(nA);function iA(h){const m=yf(({mapLib:b})=>new b.LogoControl(h),{position:h.position});return Ae.useEffect(()=>{Vu(m._container,h.style)},[h.style]),null}Ae.memo(iA);function Dy(h,m){if(!h)throw new Error(m)}let rA=0;function aA(h,m,b){if(h.style&&h.style._loaded){const S={...b};return delete S.id,delete S.children,h.addSource(m,S),h.getSource(m)}return null}function sA(h,m,b){Dy(m.id===b.id,"source id changed"),Dy(m.type===b.type,"source type changed");let S="",z=0;for(const A in m)A!=="children"&&A!=="id"&&!Fs(b[A],m[A])&&(S=A,z++);if(!z)return;const k=m.type;if(k==="geojson")h.setData(m.data);else if(k==="image")h.updateImage({url:m.url,coordinates:m.coordinates});else switch(S){case"coordinates":h.setCoordinates?.(m.coordinates);break;case"url":h.setUrl?.(m.url);break;case"tiles":h.setTiles?.(m.tiles);break;default:console.warn(`Unable to update <Source> prop: ${S}`)}}function Vv(h){const m=Ae.useContext(Kp).map.getMap(),b=Ae.useRef(h),[,S]=Ae.useState(0),z=Ae.useMemo(()=>h.id||`jsx-source-${rA++}`,[]);Ae.useEffect(()=>{if(m){const A=()=>setTimeout(()=>S(l=>l+1),0);return m.on("styledata",A),A(),()=>{if(m.off("styledata",A),m.style&&m.style._loaded&&m.getSource(z)){const l=m.getStyle()?.layers;if(l)for(const N of l)N.source===z&&m.removeLayer(N.id);m.removeSource(z)}}}},[m]);let k=m&&m.style&&m.getSource(z);return k?sA(k,h,b.current):k=aA(m,z,h),b.current=h,k&&Ae.Children.map(h.children,A=>A&&Ae.cloneElement(A,{source:z}))||null}function oA(h,m,b,S){if(Dy(b.id===S.id,"layer id changed"),Dy(b.type===S.type,"layer type changed"),b.type==="custom"||S.type==="custom")return;const{layout:z={},paint:k={},filter:A,minzoom:l,maxzoom:N,beforeId:W}=b;if(W!==S.beforeId&&h.moveLayer(m,W),z!==S.layout){const ne=S.layout||{};for(const re in z)Fs(z[re],ne[re])||h.setLayoutProperty(m,re,z[re]);for(const re in ne)z.hasOwnProperty(re)||h.setLayoutProperty(m,re,void 0)}if(k!==S.paint){const ne=S.paint||{};for(const re in k)Fs(k[re],ne[re])||h.setPaintProperty(m,re,k[re]);for(const re in ne)k.hasOwnProperty(re)||h.setPaintProperty(m,re,void 0)}Fs(A,S.filter)||h.setFilter(m,A),(l!==S.minzoom||N!==S.maxzoom)&&h.setLayerZoomRange(m,l,N)}function lA(h,m,b){if(h.style&&h.style._loaded&&(!("source"in b)||h.getSource(b.source))){const S={...b,id:m};delete S.beforeId,h.addLayer(S,b.beforeId)}}let cA=0;function qv(h){const m=Ae.useContext(Kp).map.getMap(),b=Ae.useRef(h),[,S]=Ae.useState(0),z=Ae.useMemo(()=>h.id||`jsx-layer-${cA++}`,[]);if(Ae.useEffect(()=>{if(m){const A=()=>S(l=>l+1);return m.on("styledata",A),A(),()=>{m.off("styledata",A),m.style&&m.style._loaded&&m.getLayer(z)&&m.removeLayer(z)}}},[m]),m&&m.style&&m.getLayer(z))try{oA(m,z,h,b.current)}catch(A){console.warn(A)}else lA(m,z,h);return b.current=h,null}var wy={exports:{}};var uA=wy.exports,Gv;function hA(){return Gv||(Gv=1,(function(h,m){(function(b,S){h.exports=S()})(uA,(function(){var b={},S={};function z(A,l,N){if(S[A]=N,A==="index"){var W="var sharedModule = {}; ("+S.shared+")(sharedModule); ("+S.worker+")(sharedModule);",ne={};return S.shared(ne),S.index(b,ne),typeof window<"u"&&b.setWorkerUrl(window.URL.createObjectURL(new Blob([W],{type:"text/javascript"}))),b}}z("shared",["exports"],(function(A){function l(i,e,n,o){return new(n||(n=Promise))((function(u,p){function g(C){try{T(o.next(C))}catch(I){p(I)}}function x(C){try{T(o.throw(C))}catch(I){p(I)}}function T(C){var I;C.done?u(C.value):(I=C.value,I instanceof n?I:new n((function(L){L(I)}))).then(g,x)}T((o=o.apply(i,e||[])).next())}))}function N(i,e){this.x=i,this.y=e}function W(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ne,re;typeof SuppressedError=="function"&&SuppressedError,N.prototype={clone(){return new N(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround(i,e){const n=Math.cos(i),o=Math.sin(i),u=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:N},N.convert=function(i){if(i instanceof N)return i;if(Array.isArray(i))return new N(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new N(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var Me=(function(){if(re)return ne;function i(e,n,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=u}return re=1,ne=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<n)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var x=0,T=1;for(o=e,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<n));u++)e>p?x=o:T=o,o=.5*(T-x)+x;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},ne})(),be=W(Me);let Ie,fe;function ie(){return Ie==null&&(Ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ie}function Le(){if(fe==null&&(fe=!1,ie())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){fe=!0;break}}}return fe||!1}var Ke=1e-6,ht=typeof Float32Array<"u"?Float32Array:Array;function Ct(){var i=new ht(9);return ht!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function zt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function tt(){var i=new ht(3);return ht!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function st(i){var e=i[0],n=i[1],o=i[2];return Math.sqrt(e*e+n*n+o*o)}function ke(i,e,n){var o=new ht(3);return o[0]=i,o[1]=e,o[2]=n,o}function ct(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function it(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function lt(i,e,n){var o=e[0],u=e[1],p=e[2],g=n[0],x=n[1],T=n[2];return i[0]=u*T-p*x,i[1]=p*g-o*T,i[2]=o*x-u*g,i}var Et,qt=st;function $t(i,e,n){var o=e[0],u=e[1],p=e[2],g=e[3];return i[0]=n[0]*o+n[4]*u+n[8]*p+n[12]*g,i[1]=n[1]*o+n[5]*u+n[9]*p+n[13]*g,i[2]=n[2]*o+n[6]*u+n[10]*p+n[14]*g,i[3]=n[3]*o+n[7]*u+n[11]*p+n[15]*g,i}function ut(){var i=new ht(4);return ht!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function we(i,e,n,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;e*=p,o*=p,n*=p;var g=Math.sin(e),x=Math.cos(e),T=Math.sin(n),C=Math.cos(n),I=Math.sin(o),L=Math.cos(o);switch(u){case"xyz":i[0]=g*C*L+x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L-g*T*I;break;case"xzy":i[0]=g*C*L-x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L+g*T*I;break;case"yxz":i[0]=g*C*L+x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L+g*T*I;break;case"yzx":i[0]=g*C*L+x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L-g*T*I;break;case"zxy":i[0]=g*C*L-x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L-g*T*I;break;case"zyx":i[0]=g*C*L-x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L+g*T*I;break;default:throw new Error("Unknown angle order "+u)}return i}function $e(){var i=new ht(2);return ht!=Float32Array&&(i[0]=0,i[1]=0),i}function mt(i,e){var n=new ht(2);return n[0]=i,n[1]=e,n}tt(),Et=new ht(4),ht!=Float32Array&&(Et[0]=0,Et[1]=0,Et[2]=0,Et[3]=0),tt(),ke(1,0,0),ke(0,1,0),ut(),ut(),Ct(),$e();const vt=8192;function Ut(i,e,n){return e*(vt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function xe(i,e){return(i%e+e)%e}function Ye(i,e,n){return i*(1-n)+e*n}function wt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Mt(i,e,n,o){const u=new be(i,e,n,o);return p=>u.solve(p)}const Ft=Mt(.25,.1,.25,1);function Zt(i,e,n){return Math.min(n,Math.max(e,i))}function Vt(i,e,n){const o=n-e,u=((i-e)%o+o)%o+e;return u===e?n:u}function ln(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let Qt=1;function Dn(i,e,n){const o={};for(const u in i)o[u]=e.call(this,i[u],u,i);return o}function ai(i,e,n){const o={};for(const u in i)e.call(this,i[u],u,i)&&(o[u]=i[u]);return o}function Rn(i){return Array.isArray(i)?i.map(Rn):typeof i=="object"&&i?Dn(i,Rn):i}const lr={};function Mn(i){lr[i]||(typeof console<"u"&&console.warn(i),lr[i]=!0)}function ci(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Ri(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Jn=null;function Wi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const cr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ur(i,e,n,o,u){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const g=p?.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const x=g.startsWith("BGR"),T=new Uint8ClampedArray(o*u*4);if(yield p.copyTo(T,(function(C,I,L,B,F){const G=4*Math.max(-I,0),H=(Math.max(0,L)-L)*B*4+G,Y=4*B,J=Math.max(0,I),de=Math.max(0,L);return{rect:{x:J,y:de,width:Math.min(C.width,I+B)-J,height:Math.min(C.height,L+F)-de},layout:[{offset:H,stride:Y}]}})(i,e,n,o,u)),x)for(let C=0;C<T.length;C+=4){const I=T[C];T[C]=T[C+2],T[C+2]=I}return T}finally{p.close()}}))}let Hr,Ki;function $r(i,e,n,o){return i.addEventListener(e,n,o),{unsubscribe:()=>{i.removeEventListener(e,n,o)}}}function Li(i){return i*Math.PI/180}function nr(i){return i/Math.PI*180}const Be={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Z={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},$="AbortError";class K extends Error{constructor(e=$){super(e instanceof Error?e.message:e),this.name=$,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function ue(i){return i.name===$}const ge={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Re(i){return ge.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const ze="global-dispatcher";class Se extends Error{constructor(e,n,o,u){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=u}}const De=()=>Ri(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Je=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=Re(i.url);if(o)return o(i,e);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:ze},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(De())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return l(this,void 0,void 0,(function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:De(),signal:u.signal});let g,x;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{g=yield fetch(p)}catch(C){throw ue(C)?C:new Se(0,C.message,o.url,new Blob)}if(!g.ok){const C=yield g.blob();throw new Se(g.status,g.statusText,o.url,C)}x=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const T=yield x;return u.signal.throwIfAborted(),{data:T,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(i,e);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:ze},e)}var n;return(function(o,u){return new Promise(((p,g)=>{var x;const T=new XMLHttpRequest;T.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(T.responseType="arraybuffer");for(const C in o.headers)T.setRequestHeader(C,o.headers[C]);o.type==="json"&&(T.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=o.credentials==="include",T.onerror=()=>{g(new Error(T.statusText))},T.onload=()=>{if(!u.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let C=T.response;if(o.type==="json")try{C=JSON.parse(T.response)}catch(I){return void g(I)}p({data:C,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const C=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});g(new Se(T.status,T.statusText,o.url,C))}},u.signal.addEventListener("abort",(()=>{T.abort(),g(new K(u.signal.reason))})),T.send(o.body)}))})(i,e)};function at(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Rt(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function It(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class Ht{constructor(e,n={}){ln(this,n),this.type=e}}class yn extends Ht{constructor(e,n={}){super("error",ln({error:e},n))}}class un{on(e,n){return this._listeners=this._listeners||{},Rt(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return It(e,n,this._listeners),It(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Rt(e,n,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,n){typeof e=="string"&&(e=new Ht(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of u)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of p)It(o,x,this._oneTimeListeners),x.call(this,e);const g=this._eventedParent;g&&(ln(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof yn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const In=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ui(i,e){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return In.forEach((o=>{o in e&&(n[o]=e[o])})),n}function nn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!nn(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!nn(i[n],e[n]))return!1;return!0}return i===e}function kn(i,e){i.push(e)}function Ui(i,e,n){kn(n,{command:"addSource",args:[i,e[i]]})}function Ln(i,e,n){kn(e,{command:"removeSource",args:[i]}),n[i]=!0}function hi(i,e,n,o){Ln(i,n,o),Ui(i,e,n)}function On(i,e,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!nn(i[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!nn(i[n][o],e[n][o]))return!1;return!0}function Ti(i,e,n,o,u,p){i=i||{},e=e||{};for(const g in i)Object.prototype.hasOwnProperty.call(i,g)&&(nn(i[g],e[g])||n.push({command:p,args:[o,g,e[g],u]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(nn(i[g],e[g])||n.push({command:p,args:[o,g,e[g],u]}))}function Us(i){return i.id}function Vs(i,e){return i[e.id]=e,i}class bt{constructor(e,n,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function hr(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}class dr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Qe{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(e){return new Qe(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const _t={kind:"null"},Fe={kind:"number"},Tt={kind:"string"},kt={kind:"boolean"},ni={kind:"color"},Vi={kind:"projectionDefinition"},Xr={kind:"object"},en={kind:"value"},$o={kind:"collator"},ds={kind:"formatted"},qs={kind:"padding"},fs={kind:"colorArray"},ps={kind:"numberArray"},Si={kind:"resolvedImage"},Fl={kind:"variableAnchorOffsetCollection"};function Pr(i,e){return{kind:"array",itemType:i,N:e}}function xn(i){if(i.kind==="array"){const e=xn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Gs=[_t,Fe,Tt,kt,ni,Vi,ds,Xr,Pr(en),qs,ps,fs,Si,Fl];function jl(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!jl(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Gs)if(!jl(n,e))return null}}return`Expected ${xn(i)} but found ${xn(e)} instead.`}function Ul(i,e){return e.some((n=>n.kind===i.kind))}function po(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function Xa(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Rc=.96422,ms=.82521,Ma=4/29,An=6/29,Wh=3*An*An,_f=An*An*An,Xo=Math.PI/180,Kh=180/Math.PI;function Lc(i){return(i%=360)<0&&(i+=360),i}function vf([i,e,n,o]){let u,p;const g=Oc((.2225045*(i=Nr(i))+.7168786*(e=Nr(e))+.0606169*(n=Nr(n)))/1);i===e&&e===n?u=p=g:(u=Oc((.4360747*i+.3850649*e+.1430804*n)/Rc),p=Oc((.0139322*i+.0971045*e+.7141733*n)/ms));const x=116*g-16;return[x<0?0:x,500*(u-g),200*(g-p),o]}function Nr(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Oc(i){return i>_f?Math.pow(i,1/3):i/Wh+Ma}function qu([i,e,n,o]){let u=(i+16)/116,p=isNaN(e)?u:u+e/500,g=isNaN(n)?u:u-n/200;return u=1*mo(u),p=Rc*mo(p),g=ms*mo(g),[Bc(3.1338561*p-1.6168667*u-.4906146*g),Bc(-.9787684*p+1.9161415*u+.033454*g),Bc(.0719453*p-.2289914*u+1.4052427*g),o]}function Bc(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function mo(i){return i>An?i*i*i:Wh*(i-Ma)}const xf=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Vl(i,e){return xf(i,e)?i[e]:void 0}function Zs(i){return parseInt(i.padEnd(2,i),16)/255}function bf(i,e){return Yo(e?i/100:i,0,1)}function Yo(i,e,n){return Math.min(Math.max(e,i),n)}function Gu(i){return!i.some(Number.isNaN)}const Wo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function go(i,e,n){return i+n*(e-i)}function ql(i,e,n){return i.map(((o,u)=>go(o,e[u],n)))}class hn{constructor(e,n,o,u=1,p=!0){this.r=e,this.g=n,this.b=o,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,n,o,u]))}static parse(e){if(e instanceof hn)return e;if(typeof e!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Vl(Wo,o);if(u){const[g,x,T]=u;return[g/255,x/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let x=1;return[Zs(o.slice(x,x+=g)),Zs(o.slice(x,x+=g)),Zs(o.slice(x,x+=g)),Zs(o.slice(x,x+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[x,T,C,I,L,B,F,G,H,Y,J,de]=g,ee=[I||" ",F||" ",Y].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ae=[C,B,H].join(""),me=ae==="%%%"?100:ae===""?255:0;if(me){const ve=[Yo(+T/me,0,1),Yo(+L/me,0,1),Yo(+G/me,0,1),J?bf(+J,de):1];if(Gu(ve))return ve}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[g,x,T,C,I,L,B,F,G]=p,H=[T||" ",I||" ",B].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const Y=[+x,Yo(+C,0,100),Yo(+L,0,100),F?bf(+F,G):1];if(Gu(Y))return(function([J,de,ee,ae]){function me(ve){const Ue=(ve+J/30)%12,ot=de*Math.min(ee,1-ee);return ee-ot*Math.max(-1,Math.min(Ue-3,9-Ue,1))}return J=Lc(J),de/=100,ee/=100,[me(0),me(8),me(4),ae]})(Y)}}})(e);return n?new hn(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[e/p,n/p,o/p,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,o,u,p]=vf(e),g=Math.sqrt(o*o+u*u);return[Math.round(1e4*g)?Lc(Math.atan2(u,o)*Kh):NaN,g,n,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",vf(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,u]=this.rgb;return`rgba(${[e,n,o].map((p=>Math.round(255*p))).join(",")},${u})`}static interpolate(e,n,o,u="rgb"){switch(u){case"rgb":{const[p,g,x,T]=ql(e.rgb,n.rgb,o);return new hn(p,g,x,T,!1)}case"hcl":{const[p,g,x,T]=e.hcl,[C,I,L,B]=n.hcl;let F,G;if(isNaN(p)||isNaN(C))isNaN(p)?isNaN(C)?F=NaN:(F=C,x!==1&&x!==0||(G=I)):(F=p,L!==1&&L!==0||(G=g));else{let ee=C-p;C>p&&ee>180?ee-=360:C<p&&p-C>180&&(ee+=360),F=p+o*ee}const[H,Y,J,de]=(function([ee,ae,me,ve]){return ee=isNaN(ee)?0:ee*Xo,qu([me,Math.cos(ee)*ae,Math.sin(ee)*ae,ve])})([F,G??go(g,I,o),go(x,L,o),go(T,B,o)]);return new hn(H,Y,J,de,!1)}case"lab":{const[p,g,x,T]=qu(ql(e.lab,n.lab,o));return new hn(p,g,x,T,!1)}}}}hn.black=new hn(0,0,0,1),hn.white=new hn(1,1,1,1),hn.transparent=new hn(0,0,0,0),hn.red=new hn(1,0,0,1);class Ya{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Qh=["bottom","center","top"];class Nc{constructor(e,n,o,u,p,g){this.text=e,this.image=n,this.scale=o,this.fontStack=u,this.textColor=p,this.verticalAlign=g}}class ir{constructor(e){this.sections=e}static fromString(e){return new ir([new Nc(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof ir?e:ir.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class qi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof qi)return e;if(typeof e=="number")return new qi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new qi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new qi(ql(e.values,n.values,o))}}class di{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof di)return e;if(typeof e=="number")return new di([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new di(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new di(ql(e.values,n.values,o))}}class tn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof tn)return e;if(typeof e=="string"){const o=hn.parse(e);return o?new tn([o]):void 0}if(!Array.isArray(e))return;const n=[];for(const o of e){if(typeof o!="string")return;const u=hn.parse(o);if(!u)return;n.push(u)}return new tn(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o,u="rgb"){const p=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)p.push(hn.interpolate(e.values[g],n.values[g],o,u));return new tn(p)}}class $n extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Aa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ei{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ei)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],u=e[n+1];if(typeof o!="string"||!Aa.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new Ei(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){const u=e.values,p=n.values;if(u.length!==p.length)throw new $n(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const g=[];for(let x=0;x<u.length;x+=2){if(u[x]!==p[x])throw new $n(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${u[x]}, to[${x}]: ${p[x]}`);g.push(u[x]);const[T,C]=u[x+1],[I,L]=p[x+1];g.push([go(T,I,o),go(C,L,o)])}return new Ei(g)}}class Fr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Fr({name:e,available:!1}):null}}class rr{constructor(e,n,o){this.from=e,this.to=n,this.transition=o}static interpolate(e,n,o){return new rr(e,n,o)}static parse(e){return e instanceof rr?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new rr(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new rr(e.from,e.to,e.transition):typeof e=="string"?new rr(e,e,1):void 0}}function ca(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof rr||i instanceof hn||i instanceof Ya||i instanceof ir||i instanceof qi||i instanceof di||i instanceof tn||i instanceof Ei||i instanceof Fr)return!0;if(Array.isArray(i)){for(const e of i)if(!gs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!gs(i[e]))return!1;return!0}return!1}function fi(i){if(i===null)return _t;if(typeof i=="string")return Tt;if(typeof i=="boolean")return kt;if(typeof i=="number")return Fe;if(i instanceof hn)return ni;if(i instanceof rr)return Vi;if(i instanceof Ya)return $o;if(i instanceof ir)return ds;if(i instanceof qi)return qs;if(i instanceof di)return ps;if(i instanceof tn)return fs;if(i instanceof Ei)return Fl;if(i instanceof Fr)return Si;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const u=fi(o);if(n){if(n===u)continue;n=en;break}n=u}return Pr(n||en,e)}return Xr}function yo(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof hn||i instanceof rr||i instanceof ir||i instanceof qi||i instanceof di||i instanceof tn||i instanceof Ei||i instanceof Fr?i.toString():JSON.stringify(i)}class ua{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!gs(e[1]))return n.error("invalid value");const o=e[1];let u=fi(o);const p=n.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new ua(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ko={string:Tt,number:Fe,boolean:kt,object:Xr};class jr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,u=1;const p=e[0];if(p==="array"){let x,T;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in Ko)||C==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ko[C],u++}else x=en;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],u++}o=Pr(x,T)}else{if(!Ko[p])throw new Error(`Types doesn't contain name = ${p}`);o=Ko[p]}const g=[];for(;u<e.length;u++){const x=n.parse(e[u],u,en);if(!x)return null;g.push(x)}return new jr(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!jl(this.type,fi(o)))return o;if(n===this.args.length-1)throw new $n(`Expected value to be of type ${xn(this.type)}, but found ${xn(fi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Qi={"to-boolean":kt,"to-color":ni,"to-number":Fe,"to-string":Tt};class Ur{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!Qi[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const u=Qi[o],p=[];for(let g=1;g<e.length;g++){const x=n.parse(e[g],g,en);if(!x)return null;p.push(x)}return new Ur(u,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(e),o=null,n instanceof hn)return n;if(typeof n=="string"){const p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ca(n[0],n[1],n[2],n[3]),!o))return new hn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new $n(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const u=qi.parse(n);if(u)return u}throw new $n(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(e);const u=di.parse(n);if(u)return u}throw new $n(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(e);const u=tn.parse(n);if(u)return u}throw new $n(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const u=Ei.parse(n);if(u)return u}throw new $n(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new $n(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return ir.fromString(yo(this.args[0].evaluate(e)));case"resolvedImage":return Fr.fromString(yo(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return yo(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Fc=["Unknown","Point","LineString","Polygon"];class Qo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=hn.parse(e),this._parseColorCache.set(e,n)),n}}class Jo{constructor(e,n,o=[],u,p=new Qe,g=[]){this.registry=e,this.path=o,this.key=o.map((x=>`[${x}]`)).join(""),this.scope=p,this.errors=g,this.expectedType=u,this._isConstant=n}parse(e,n,o,u,p={}){return n?this.concat(n,o,u)._parse(e,p):this._parse(e,p)}_parse(e,n){function o(u,p,g){return g==="assert"?new jr(p,[u]):g==="coerce"?new Ur(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,T=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||T.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(T.kind)||x.kind==="colorArray"&&["value","string","array"].includes(T.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))g=o(g,x,n.typeAnnotation||"coerce");else if(this.checkSubtype(x,T))return null}else g=o(g,x,n.typeAnnotation||"assert")}if(!(g instanceof ua)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const x=new Qo;try{g=new ua(g.type,g.evaluate(x))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const u=typeof e=="number"?this.path.concat(e):this.path,p=o?this.scope.concat(o):this.scope;return new Jo(this.registry,this._isConstant,u,n||null,p,this.errors)}error(e,...n){const o=`${this.key}${n.map((u=>`[${u}]`)).join("")}`;this.errors.push(new dr(o,e))}checkSubtype(e,n){const o=jl(e,n);return o&&this.error(o),o}}class Vn{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=n.parse(e[p+1],p+1);if(!x)return null;o.push([g,x])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return u?new Vn(o,u):null}outputDefined(){return this.result.outputDefined()}}class _o{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new _o(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class pn{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Fe),u=n.parse(e[2],2,Pr(n.expectedType||en));return o&&u?new pn(u.type.itemType,o,u):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new $n(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new $n(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new $n(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class on{constructor(e,n){this.type=kt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,en),u=n.parse(e[2],2,en);return o&&u?Ul(o.type,[kt,Tt,Fe,_t,en])?new on(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${xn(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!po(n,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${xn(fi(n))} instead.`);if(!po(o,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${xn(fi(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class el{constructor(e,n,o){this.type=Fe,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,en),u=n.parse(e[2],2,en);if(!o||!u)return null;if(!Ul(o.type,[kt,Tt,Fe,_t,en]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${xn(o.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,Fe);return p?new el(o,u,p):null}return new el(o,u)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!po(n,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${xn(fi(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),po(o,["string"])){const p=o.indexOf(n,u);return p===-1?-1:[...o.slice(0,p)].length}if(po(o,["array"]))return o.indexOf(n,u);throw new $n(`Expected second argument to be of type array or string, but found ${xn(fi(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class bn{constructor(e,n,o,u,p,g){this.inputType=e,this.type=n,this.input=o,this.cases=u,this.outputs=p,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const p={},g=[];for(let C=2;C<e.length-1;C+=2){let I=e[C];const L=e[C+1];Array.isArray(I)||(I=[I]);const B=n.concat(C);if(I.length===0)return B.error("Expected at least one branch label.");for(const G of I){if(typeof G!="number"&&typeof G!="string")return B.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,fi(G)))return null}else o=fi(G);if(p[String(G)]!==void 0)return B.error("Branch labels must be unique.");p[String(G)]=g.length}const F=n.parse(L,C,u);if(!F)return null;u=u||F.type,g.push(F)}const x=n.parse(e[1],1,en);if(!x)return null;const T=n.parse(e[e.length-1],e.length-1,u);return T?x.type.kind!=="value"&&n.concat(1).checkSubtype(o,x.type)?null:new bn(o,u,x,p,g,T):null}evaluate(e){const n=this.input.evaluate(e);return(fi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class jc{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const x=n.parse(e[g],g,kt);if(!x)return null;const T=n.parse(e[g+1],g+1,o);if(!T)return null;u.push([x,T]),o=o||T.type}const p=n.parse(e[e.length-1],e.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new jc(o,u,p)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Ca{constructor(e,n,o,u){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,en),u=n.parse(e[2],2,Fe);if(!o||!u)return null;if(!Ul(o.type,[Pr(en),Tt,en]))return n.error(`Expected first argument to be of type array or string, but found ${xn(o.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,Fe);return p?new Ca(o.type,o,u,p):null}return new Ca(o.type,o,u)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),po(n,["string"]))return[...n].slice(o,u).join("");if(po(n,["array"]))return n.slice(o,u);throw new $n(`Expected first argument to be of type array or string, but found ${xn(fi(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function vo(i,e){const n=i.length-1;let o,u,p=0,g=n,x=0;for(;p<=g;)if(x=Math.floor((p+g)/2),o=i[x],u=i[x+1],o<=e){if(x===n||e<u)return x;p=x+1}else{if(!(o>e))throw new $n("Input is not a number.");g=x-1}return 0}class xo{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,p]of o)this.labels.push(u),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Fe);if(!o)return null;const u=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let g=1;g<e.length;g+=2){const x=g===1?-1/0:e[g],T=e[g+1],C=g,I=g+1;if(typeof x!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=x)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const L=n.parse(T,I,p);if(!L)return null;p=p||L.type,u.push([x,L])}return new xo(p,o,u)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return o[0].evaluate(e);const p=n.length;return u>=n[p-1]?o[p-1].evaluate(e):o[vo(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function wf(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Uc,Jh,Qp=(function(){if(Jh)return Uc;function i(e,n,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=u}return Jh=1,Uc=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<n)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var x=0,T=1;for(o=e,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<n));u++)e>p?x=o:T=o,o=.5*(T-x)+x;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Uc})(),ed=wf(Qp);class Vr{constructor(e,n,o,u,p){this.type=e,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,n,o,u){let p=0;if(e.name==="exponential")p=ys(n,e.base,o,u);else if(e.name==="linear")p=ys(n,1,o,u);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new ed(g[0],g[1],g[2],g[3]).solve(ys(n,1,o,u))}return p}static parse(e,n){let[o,u,p,...g]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const C=u[1];if(typeof C!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(C.length!==4||C.some((I=>typeof I!="number"||I<0||I>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,Fe),!p)return null;const x=[];let T=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==fs?n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType):T=ni;for(let C=0;C<g.length;C+=2){const I=g[C],L=g[C+1],B=C+3,F=C+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(x.length&&x[x.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const G=n.parse(L,F,T);if(!G)return null;T=T||G.type,x.push([I,G])}return Xa(T,Fe)||Xa(T,Vi)||Xa(T,ni)||Xa(T,qs)||Xa(T,ps)||Xa(T,fs)||Xa(T,Fl)||Xa(T,Pr(Fe))?new Vr(T,o,u,p,x):n.error(`Type ${xn(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return o[0].evaluate(e);const p=n.length;if(u>=n[p-1])return o[p-1].evaluate(e);const g=vo(n,u),x=Vr.interpolationFactor(this.interpolation,u,n[g],n[g+1]),T=o[g].evaluate(e),C=o[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return go(T,C,x);case"color":return hn.interpolate(T,C,x);case"padding":return qi.interpolate(T,C,x);case"colorArray":return tn.interpolate(T,C,x);case"numberArray":return di.interpolate(T,C,x);case"variableAnchorOffsetCollection":return Ei.interpolate(T,C,x);case"array":return ql(T,C,x);case"projectionDefinition":return rr.interpolate(T,C,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return hn.interpolate(T,C,x,"hcl");case"colorArray":return tn.interpolate(T,C,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return hn.interpolate(T,C,x,"lab");case"colorArray":return tn.interpolate(T,C,x,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function ys(i,e,n,o){const u=o-n,p=i-n;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}const pi={color:hn.interpolate,number:go,padding:qi.interpolate,numberArray:di.interpolate,colorArray:tn.interpolate,variableAnchorOffsetCollection:Ei.interpolate,array:ql};class tl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const p=[];for(const x of e.slice(1)){const T=n.parse(x,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,p.push(T)}if(!o)throw new Error("No output type");const g=u&&p.some((x=>jl(u,x.type)));return new tl(g?en:o,p)}evaluate(e){let n,o=null,u=0;for(const p of this.args)if(u++,o=p.evaluate(e),o&&o instanceof Fr&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Vc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function qc(i,e,n,o){return o.compare(e,n)===0}function Mi(i,e,n){const o=i!=="=="&&i!=="!=";return class Jb{constructor(p,g,x){this.type=kt,this.lhs=p,this.rhs=g,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const x=p[0];let T=g.parse(p[1],1,en);if(!T)return null;if(!Vc(x,T.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${xn(T.type)}'.`);let C=g.parse(p[2],2,en);if(!C)return null;if(!Vc(x,C.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${xn(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${xn(T.type)}' and '${xn(C.type)}'.`);o&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new jr(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new jr(T.type,[C])));let I=null;if(p.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(p[3],3,$o),!I)return null}return new Jb(T,C,I)}evaluate(p){const g=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const T=fi(g),C=fi(x);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new $n(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=fi(g),C=fi(x);if(T.kind!=="string"||C.kind!=="string")return e(p,g,x)}return this.collator?n(p,g,x,this.collator.evaluate(p)):e(p,g,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Tf=Mi("==",(function(i,e,n){return e===n}),qc),Zu=Mi("!=",(function(i,e,n){return e!==n}),(function(i,e,n,o){return!qc(0,e,n,o)})),Sf=Mi("<",(function(i,e,n){return e<n}),(function(i,e,n,o){return o.compare(e,n)<0})),Jp=Mi(">",(function(i,e,n){return e>n}),(function(i,e,n,o){return o.compare(e,n)>0})),Gl=Mi("<=",(function(i,e,n){return e<=n}),(function(i,e,n,o){return o.compare(e,n)<=0})),Hu=Mi(">=",(function(i,e,n){return e>=n}),(function(i,e,n,o){return o.compare(e,n)>=0}));class Zl{constructor(e,n,o){this.type=$o,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,kt);if(!u)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,kt);if(!p)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,Tt),!g)?null:new Zl(u,p,g)}evaluate(e){return new Ya(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class td{constructor(e,n,o,u,p){this.type=Tt,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Fe);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=n.parse(u.locale,1,Tt),!p))return null;let g=null;if(u.currency&&(g=n.parse(u.currency,1,Tt),!g))return null;let x=null;if(u["min-fraction-digits"]&&(x=n.parse(u["min-fraction-digits"],1,Fe),!x))return null;let T=null;return u["max-fraction-digits"]&&(T=n.parse(u["max-fraction-digits"],1,Fe),!T)?null:new td(o,p,g,x,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Gc{constructor(e){this.type=ds,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let p=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let T=null;if(x["font-scale"]&&(T=n.parse(x["font-scale"],1,Fe),!T))return null;let C=null;if(x["text-font"]&&(C=n.parse(x["text-font"],1,Pr(Tt)),!C))return null;let I=null;if(x["text-color"]&&(I=n.parse(x["text-color"],1,ni),!I))return null;let L=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!Qh.includes(x["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(L=n.parse(x["vertical-align"],1,Tt),!L)return null}const B=u[u.length-1];B.scale=T,B.font=C,B.textColor=I,B.verticalAlign=L}else{const T=n.parse(e[g],1,en);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Gc(u)}evaluate(e){return new ir(this.sections.map((n=>{const o=n.content.evaluate(e);return fi(o)===Si?new Nc("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Nc(yo(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class Hl{constructor(e){this.type=Si,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Tt);return o?new Hl(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Fr.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class $l{constructor(e){this.type=Fe,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${xn(o.type)} instead.`):new $l(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new $n(`Expected value to be of type string or array, but found ${xn(fi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Oi=8192;function Xl(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Oi),Math.round(o*u*Oi)]}function Yl(i,e){const n=Math.pow(2,e.z);return[(u=(i[0]/Oi+e.x)/n,360*u-180),(o=(i[1]/Oi+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Wl(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function bo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Ef(i,e,n){const o=i[0]-e[0],u=i[1]-e[1],p=i[0]-n[0],g=i[1]-n[1];return o*g-p*u==0&&o*p<=0&&u*g<=0}function Zc(i,e,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(p=[e[0]-i[0],e[1]-i[1]])[1]-u[1]*p[0]!=0&&!(!Xu(i,e,n,o)||!Xu(n,o,i,e));var u,p}function Mf(i,e,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(Zc(i,e,o[u],o[u+1]))return!0;return!1}function Wa(i,e,n=!1){let o=!1;for(const x of e)for(let T=0;T<x.length-1;T++){if(Ef(i,x[T],x[T+1]))return n;(p=x[T])[1]>(u=i)[1]!=(g=x[T+1])[1]>u[1]&&u[0]<(g[0]-p[0])*(u[1]-p[1])/(g[1]-p[1])+p[0]&&(o=!o)}var u,p,g;return o}function $u(i,e){for(const n of e)if(Wa(i,n))return!0;return!1}function Af(i,e){for(const n of i)if(!Wa(n,e))return!1;for(let n=0;n<i.length-1;++n)if(Mf(i[n],i[n+1],e))return!1;return!0}function Cf(i,e){for(const n of e)if(Af(i,n))return!0;return!1}function Xu(i,e,n,o){const u=o[0]-n[0],p=o[1]-n[1],g=(i[0]-n[0])*p-u*(i[1]-n[1]),x=(e[0]-n[0])*p-u*(e[1]-n[1]);return g>0&&x<0||g<0&&x>0}function Yu(i,e,n){const o=[];for(let u=0;u<i.length;u++){const p=[];for(let g=0;g<i[u].length;g++){const x=Xl(i[u][g],n);Wl(e,x),p.push(x)}o.push(p)}return o}function nl(i,e,n){const o=[];for(let u=0;u<i.length;u++){const p=Yu(i[u],e,n);o.push(p)}return o}function Kl(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const u=.5*o;let p=i[0]-n[0]>u?-o:n[0]-i[0]>u?o:0;p===0&&(p=i[0]-n[2]>u?-o:n[2]-i[0]>u?o:0),i[0]+=p}Wl(e,i)}function zf(i,e,n,o){const u=Math.pow(2,o.z)*Oi,p=[o.x*Oi,o.y*Oi],g=[];for(const x of i)for(const T of x){const C=[T.x+p[0],T.y+p[1]];Kl(C,e,n,u),g.push(C)}return g}function Hc(i,e,n,o){const u=Math.pow(2,o.z)*Oi,p=[o.x*Oi,o.y*Oi],g=[];for(const T of i){const C=[];for(const I of T){const L=[I.x+p[0],I.y+p[1]];Wl(e,L),C.push(L)}g.push(C)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of g)for(const C of T)Kl(C,e,n,u)}var x;return g}class wo{constructor(e,n){this.type=kt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gs(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const p of o.features){const{type:g,coordinates:x}=p.geometry;g==="Polygon"&&u.push(x),g==="MultiPolygon"&&u.push(...x)}if(u.length)return new wo(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new wo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new wo(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=Yu(o.coordinates,p,g),T=zf(n.geometry(),u,p,g);if(!bo(u,p))return!1;for(const C of T)if(!Wa(C,x))return!1}if(o.type==="MultiPolygon"){const x=nl(o.coordinates,p,g),T=zf(n.geometry(),u,p,g);if(!bo(u,p))return!1;for(const C of T)if(!$u(C,x))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=Yu(o.coordinates,p,g),T=Hc(n.geometry(),u,p,g);if(!bo(u,p))return!1;for(const C of T)if(!Af(C,x))return!1}if(o.type==="MultiPolygon"){const x=nl(o.coordinates,p,g),T=Hc(n.geometry(),u,p,g);if(!bo(u,p))return!1;for(const C of T)if(!Cf(C,x))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let nd=class{constructor(i=[],e=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,o=e[i];for(;i>0;){const u=i-1>>1,p=e[u];if(n(o,p)>=0)break;e[i]=p,i=u}e[i]=o}_down(i){const{data:e,compare:n}=this,o=this.length>>1,u=e[i];for(;i<o;){let p=1+(i<<1);const g=p+1;if(g<this.length&&n(e[g],e[p])<0&&(p=g),n(e[p],u)>=0)break;e[i]=e[p],i=p}e[i]=u}};function $c(i,e,n=0,o=i.length-1,u=id){for(;o>n;){if(o-n>600){const T=o-n+1,C=e-n+1,I=Math.log(T),L=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*L*(T-L)/T)*(C-T/2<0?-1:1);$c(i,e,Math.max(n,Math.floor(e-C*L/T+B)),Math.min(o,Math.floor(e+(T-C)*L/T+B)),u)}const p=i[e];let g=n,x=o;for(To(i,n,e),u(i[o],p)>0&&To(i,n,o);g<x;){for(To(i,g,x),g++,x--;u(i[g],p)<0;)g++;for(;u(i[x],p)>0;)x--}u(i[n],p)===0?To(i,n,x):(x++,To(i,x,o)),x<=e&&(n=x+1),e<=x&&(o=x-1)}}function To(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function id(i,e){return i<e?-1:i>e?1:0}function Xc(i,e){if(i.length<=1)return[i];const n=[];let o,u;for(const p of i){const g=em(p);g!==0&&(p.area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(o&&n.push(o),o=[p]):o.push(p))}if(o&&n.push(o),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||($c(n[p],e,1,n[p].length-1,Pf),n[p]=n[p].slice(0,e));return n}function Pf(i,e){return e.area-i.area}function em(i){let e=0;for(let n,o,u=0,p=i.length,g=p-1;u<p;g=u++)n=i[u],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}const Df=1/298.257223563,Yc=Df*(2-Df),If=Math.PI/180;class rd{constructor(e){const n=6378.137*If*1e3,o=Math.cos(e*If),u=1/(1-Yc*(1-o*o)),p=Math.sqrt(u);this.kx=n*p*o,this.ky=n*p*u*(1-Yc)}distance(e,n){const o=this.wrap(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,n){let o,u,p,g,x=1/0;for(let T=0;T<e.length-1;T++){let C=e[T][0],I=e[T][1],L=this.wrap(e[T+1][0]-C)*this.kx,B=(e[T+1][1]-I)*this.ky,F=0;L===0&&B===0||(F=(this.wrap(n[0]-C)*this.kx*L+(n[1]-I)*this.ky*B)/(L*L+B*B),F>1?(C=e[T+1][0],I=e[T+1][1]):F>0&&(C+=L/this.kx*F,I+=B/this.ky*F)),L=this.wrap(n[0]-C)*this.kx,B=(n[1]-I)*this.ky;const G=L*L+B*B;G<x&&(x=G,o=C,u=I,p=T,g=F)}return{point:[o,u],index:p,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Yr(i,e){return e[0]-i[0]}function So(i){return i[1]-i[0]+1}function za(i,e){return i[1]>=i[0]&&i[1]<e}function Wc(i,e){if(i[0]>i[1])return[null,null];const n=So(i);if(e){if(n===2)return[i,null];const u=Math.floor(n/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function Wu(i,e){if(!za(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Wl(n,i[o]);return n}function Ku(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)Wl(e,o);return e}function Kc(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Qu(i,e,n){if(!Kc(i)||!Kc(e))return NaN;let o=0,u=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(u=i[1]-e[3]),i[3]<e[1]&&(u=e[1]-i[3]),n.distance([0,0],[o,u])}function Pa(i,e,n){const o=n.pointOnLine(e,i);return n.distance(i,o.point)}function Qc(i,e,n,o,u){const p=Math.min(Pa(i,[n,o],u),Pa(e,[n,o],u)),g=Math.min(Pa(n,[i,e],u),Pa(o,[i,e],u));return Math.min(p,g)}function Jc(i,e,n,o,u){if(!za(e,i.length)||!za(o,n.length))return 1/0;let p=1/0;for(let g=e[0];g<e[1];++g){const x=i[g],T=i[g+1];for(let C=o[0];C<o[1];++C){const I=n[C],L=n[C+1];if(Zc(x,T,I,L))return 0;p=Math.min(p,Qc(x,T,I,L,u))}}return p}function Ju(i,e,n,o,u){if(!za(e,i.length)||!za(o,n.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let x=o[0];x<=o[1];++x)if(p=Math.min(p,u.distance(i[g],n[x])),p===0)return p;return p}function kf(i,e,n){if(Wa(i,e,!0))return 0;let o=1/0;for(const u of e){const p=u[0],g=u[u.length-1];if(p!==g&&(o=Math.min(o,Pa(i,[g,p],n)),o===0))return o;const x=n.pointOnLine(u,i);if(o=Math.min(o,n.distance(i,x.point)),o===0)return o}return o}function il(i,e,n,o){if(!za(e,i.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Wa(i[p],n,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p){const g=i[p],x=i[p+1];for(const T of n)for(let C=0,I=T.length,L=I-1;C<I;L=C++){const B=T[L],F=T[C];if(Zc(g,x,B,F))return 0;u=Math.min(u,Qc(g,x,B,F,o))}}return u}function rl(i,e){for(const n of i)for(const o of n)if(Wa(o,e,!0))return!0;return!1}function ad(i,e,n,o=1/0){const u=Ku(i),p=Ku(e);if(o!==1/0&&Qu(u,p,n)>=o)return o;if(bo(u,p)){if(rl(i,e))return 0}else if(rl(e,i))return 0;let g=1/0;for(const x of i)for(let T=0,C=x.length,I=C-1;T<C;I=T++){const L=x[I],B=x[T];for(const F of e)for(let G=0,H=F.length,Y=H-1;G<H;Y=G++){const J=F[Y],de=F[G];if(Zc(L,B,J,de))return 0;g=Math.min(g,Qc(L,B,J,de,n))}}return g}function Cn(i,e,n,o,u,p){if(!p)return;const g=Qu(Wu(o,p),u,n);g<e&&i.push([g,p,[0,0]])}function _s(i,e,n,o,u,p,g){if(!p||!g)return;const x=Qu(Wu(o,p),Wu(u,g),n);x<e&&i.push([x,p,g])}function eu(i,e,n,o,u=1/0){let p=Math.min(o.distance(i[0],n[0][0]),u);if(p===0)return p;const g=new nd([[0,[0,i.length-1],[0,0]]],Yr),x=Ku(n);for(;g.length>0;){const T=g.pop();if(T[0]>=p)continue;const C=T[1],I=e?50:100;if(So(C)<=I){if(!za(C,i.length))return NaN;if(e){const L=il(i,C,n,o);if(isNaN(L)||L===0)return L;p=Math.min(p,L)}else for(let L=C[0];L<=C[1];++L){const B=kf(i[L],n,o);if(p=Math.min(p,B),p===0)return 0}}else{const L=Wc(C,e);Cn(g,p,o,i,x,L[0]),Cn(g,p,o,i,x,L[1])}}return p}function tu(i,e,n,o,u,p=1/0){let g=Math.min(p,u.distance(i[0],n[0]));if(g===0)return g;const x=new nd([[0,[0,i.length-1],[0,n.length-1]]],Yr);for(;x.length>0;){const T=x.pop();if(T[0]>=g)continue;const C=T[1],I=T[2],L=e?50:100,B=o?50:100;if(So(C)<=L&&So(I)<=B){if(!za(C,i.length)&&za(I,n.length))return NaN;let F;if(e&&o)F=Jc(i,C,n,I,u),g=Math.min(g,F);else if(e&&!o){const G=i.slice(C[0],C[1]+1);for(let H=I[0];H<=I[1];++H)if(F=Pa(n[H],G,u),g=Math.min(g,F),g===0)return g}else if(!e&&o){const G=n.slice(I[0],I[1]+1);for(let H=C[0];H<=C[1];++H)if(F=Pa(i[H],G,u),g=Math.min(g,F),g===0)return g}else F=Ju(i,C,n,I,u),g=Math.min(g,F)}else{const F=Wc(C,e),G=Wc(I,o);_s(x,g,u,i,n,F[0],G[0]),_s(x,g,u,i,n,F[0],G[1]),_s(x,g,u,i,n,F[1],G[0]),_s(x,g,u,i,n,F[1],G[1])}}return g}function eh(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class al{constructor(e,n){this.type=Fe,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gs(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new al(o,o.features.map((u=>eh(u.geometry))).flat());if(o.type==="Feature")return new al(o,eh(o.geometry));if("type"in o&&"coordinates"in o)return new al(o,eh(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const u=n.geometry(),p=u.flat().map((T=>Yl([T.x,T.y],n.canonical)));if(u.length===0)return NaN;const g=new rd(p[0][1]);let x=1/0;for(const T of o){switch(T.type){case"Point":x=Math.min(x,tu(p,!1,[T.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,tu(p,!1,T.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,eu(p,!1,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const u=n.geometry(),p=u.flat().map((T=>Yl([T.x,T.y],n.canonical)));if(u.length===0)return NaN;const g=new rd(p[0][1]);let x=1/0;for(const T of o){switch(T.type){case"Point":x=Math.min(x,tu(p,!0,[T.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,tu(p,!0,T.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,eu(p,!0,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const p=Xc(u,0).map((T=>T.map((C=>C.map((I=>Yl([I.x,I.y],n.canonical))))))),g=new rd(p[0][0][0][1]);let x=1/0;for(const T of o)for(const C of p){switch(T.type){case"Point":x=Math.min(x,eu([T.coordinates],!1,C,g,x));break;case"LineString":x=Math.min(x,eu(T.coordinates,!0,C,g,x));break;case"Polygon":x=Math.min(x,ad(C,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class nu{constructor(e){this.type=en,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new nu(o)}evaluate(e){var n;const o=(n=e.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?Vl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Ql={"==":Tf,"!=":Zu,">":Jp,"<":Sf,">=":Hu,"<=":Gl,array:jr,at:pn,boolean:jr,case:jc,coalesce:tl,collator:Zl,format:Gc,image:Hl,in:on,"index-of":el,interpolate:Vr,"interpolate-hcl":Vr,"interpolate-lab":Vr,length:$l,let:Vn,literal:ua,match:bn,number:jr,"number-format":td,object:jr,slice:Ca,step:xo,string:jr,"to-boolean":Ur,"to-color":Ur,"to-number":Ur,"to-string":Ur,var:_o,within:wo,distance:al,"global-state":nu};class ha{constructor(e,n,o,u){this.name=e,this.type=n,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],u=ha.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=g.filter((([C])=>!Array.isArray(C)||C.length===e.length-1));let T=null;for(const[C,I]of x){T=new Jo(n.registry,qr,n.path,null,n.scope);const L=[];let B=!1;for(let F=1;F<e.length;F++){const G=e[F],H=Array.isArray(C)?C[F-1]:C.type,Y=T.parse(G,1+L.length,H);if(!Y){B=!0;break}L.push(Y)}if(!B)if(Array.isArray(C)&&C.length!==L.length)T.error(`Expected ${C.length} arguments, but found ${L.length} instead.`);else{for(let F=0;F<L.length;F++){const G=Array.isArray(C)?C[F]:C.type,H=L[F];T.concat(F+1).checkSubtype(G,H.type)}if(T.errors.length===0)return new ha(o,p,I,L)}}if(x.length===1)n.errors.push(...T.errors);else{const C=(x.length?x:g).map((([L])=>{return B=L,Array.isArray(B)?`(${B.map(xn).join(", ")})`:`(${xn(B.type)}...)`;var B})).join(" | "),I=[];for(let L=1;L<e.length;L++){const B=n.parse(e[L],1+I.length);if(!B)return null;I.push(xn(B.type))}n.error(`Expected arguments of type ${C}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){ha.definitions=n;for(const o in n)e[o]=ha}}function sd(i,[e,n,o,u]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const p=u?u.evaluate(i):1,g=ca(e,n,o,p);if(g)throw new $n(g);return new hn(e/255,n/255,o/255,p,!1)}function th(i,e){return i in e}function da(i,e){const n=e[i];return n===void 0?null:n}function vs(i){return{type:i}}function qr(i){if(i instanceof _o)return qr(i.boundExpression);if(i instanceof ha&&i.name==="error"||i instanceof Zl||i instanceof wo||i instanceof al||i instanceof nu)return!1;const e=i instanceof Ur||i instanceof jr;let n=!0;return i.eachChild((o=>{n=e?n&&qr(o):n&&o instanceof ua})),!!n&&Hs(i)&&ol(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Hs(i){if(i instanceof ha&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof wo||i instanceof al)return!1;let e=!0;return i.eachChild((n=>{e&&!Hs(n)&&(e=!1)})),e}function sl(i){if(i instanceof ha&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!sl(n)&&(e=!1)})),e}function ol(i,e){if(i instanceof ha&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((o=>{n&&!ol(o,e)&&(n=!1)})),n}function iu(i){return{result:"success",value:i}}function Eo(i){return{result:"error",value:i}}function Da(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function od(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Jl(i){return!!i.expression&&i.expression.interpolated}function cn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function nh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&fi(i)===Xr}function fa(i){return i}function ih(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",o=n||!(n||i.property!==void 0),u=i.type||(Jl(e)?"exponential":"interval"),p=(function(I){switch(I.type){case"color":return hn.parse;case"padding":return qi.parse;case"numberArray":return di.parse;case"colorArray":return tn.parse;default:return null}})(e);if(p&&((i=hr({},i)).stops&&(i.stops=i.stops.map((I=>[I[0],p(I[1])]))),i.default=p(i.default?i.default:e.default)),i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;const x=(function(I){switch(I){case"exponential":return Mo;case"interval":return rh;case"categorical":return Rf;case"identity":return ld;default:throw new Error(`Unknown function type "${I}"`)}})(u);let T,C;if(u==="categorical"){T=Object.create(null);for(const I of i.stops)T[I[0]]=I[1];C=typeof i.stops[0][0]}if(n){const I={},L=[];for(let G=0;G<i.stops.length;G++){const H=i.stops[G],Y=H[0].zoom;I[Y]===void 0&&(I[Y]={zoom:Y,type:i.type,property:i.property,default:i.default,stops:[]},L.push(Y)),I[Y].stops.push([H[0].value,H[1]])}const B=[];for(const G of L)B.push([I[G].zoom,ih(I[G],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Vr.interpolationFactor.bind(void 0,F),zoomStops:B.map((G=>G[0])),evaluate:({zoom:G},H)=>Mo({stops:B,base:i.base},e,G).evaluate(G,H)}}if(o){const I=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Vr.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map((L=>L[0])),evaluate:({zoom:L})=>x(i,e,L,T,C)}}return{kind:"source",evaluate(I,L){const B=L&&L.properties?L.properties[i.property]:void 0;return B===void 0?pa(i.default,e.default):x(i,e,B,T,C)}}}function pa(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Rf(i,e,n,o,u){return pa(typeof n===u?o[n]:void 0,i.default,e.default)}function rh(i,e,n){if(cn(n)!=="number")return pa(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const u=vo(i.stops.map((p=>p[0])),n);return i.stops[u][1]}function Mo(i,e,n){const o=i.base!==void 0?i.base:1;if(cn(n)!=="number")return pa(i.default,e.default);const u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];const p=vo(i.stops.map((I=>I[0])),n),g=(function(I,L,B,F){const G=F-B,H=I-B;return G===0?0:L===1?H/G:(Math.pow(L,H)-1)/(Math.pow(L,G)-1)})(n,o,i.stops[p][0],i.stops[p+1][0]),x=i.stops[p][1],T=i.stops[p+1][1],C=pi[e.type]||fa;return typeof x.evaluate=="function"?{evaluate(...I){const L=x.evaluate.apply(void 0,I),B=T.evaluate.apply(void 0,I);if(L!==void 0&&B!==void 0)return C(L,B,g,i.colorSpace)}}:C(x,T,g,i.colorSpace)}function ld(i,e,n){switch(e.type){case"color":n=hn.parse(n);break;case"formatted":n=ir.fromString(n.toString());break;case"resolvedImage":n=Fr.fromString(n.toString());break;case"padding":n=qi.parse(n);break;case"colorArray":n=tn.parse(n);break;case"numberArray":n=di.parse(n);break;default:cn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return pa(n,i.default,e.default)}ha.register(Ql,{error:[{kind:"error"},[Tt],(i,[e])=>{throw new $n(e.evaluate(i))}],typeof:[Tt,[en],(i,[e])=>xn(fi(e.evaluate(i)))],"to-rgba":[Pr(Fe,4),[ni],(i,[e])=>{const[n,o,u,p]=e.evaluate(i).rgb;return[255*n,255*o,255*u,p]}],rgb:[ni,[Fe,Fe,Fe],sd],rgba:[ni,[Fe,Fe,Fe,Fe],sd],has:{type:kt,overloads:[[[Tt],(i,[e])=>th(e.evaluate(i),i.properties())],[[Tt,Xr],(i,[e,n])=>th(e.evaluate(i),n.evaluate(i))]]},get:{type:en,overloads:[[[Tt],(i,[e])=>da(e.evaluate(i),i.properties())],[[Tt,Xr],(i,[e,n])=>da(e.evaluate(i),n.evaluate(i))]]},"feature-state":[en,[Tt],(i,[e])=>da(e.evaluate(i),i.featureState||{})],properties:[Xr,[],i=>i.properties()],"geometry-type":[Tt,[],i=>i.geometryType()],id:[en,[],i=>i.id()],zoom:[Fe,[],i=>i.globals.zoom],"heatmap-density":[Fe,[],i=>i.globals.heatmapDensity||0],elevation:[Fe,[],i=>i.globals.elevation||0],"line-progress":[Fe,[],i=>i.globals.lineProgress||0],accumulated:[en,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Fe,vs(Fe),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[Fe,vs(Fe),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:Fe,overloads:[[[Fe,Fe],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Fe],(i,[e])=>-e.evaluate(i)]]},"/":[Fe,[Fe,Fe],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Fe,[Fe,Fe],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Fe,[Fe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Fe,[Fe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Fe,[Fe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Fe,[Fe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Fe,[Fe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Fe,[Fe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Fe,[Fe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Fe,[Fe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Fe,[Fe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Fe,[Fe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Fe,vs(Fe),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[Fe,vs(Fe),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[Fe,[Fe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Fe,[Fe],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Fe,[Fe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Fe,[Fe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[kt,[Tt,en],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[kt,[en],(i,[e])=>i.id()===e.value],"filter-type-==":[kt,[Tt],(i,[e])=>i.geometryType()===e.value],"filter-<":[kt,[Tt,en],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[kt,[en],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[kt,[Tt,en],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[kt,[en],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[kt,[Tt,en],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[kt,[en],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[kt,[Tt,en],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[kt,[en],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[kt,[en],(i,[e])=>e.value in i.properties()],"filter-has-id":[kt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[kt,[Pr(Tt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[kt,[Pr(en)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[kt,[Tt,Pr(en)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[kt,[Tt,Pr(en)],(i,[e,n])=>(function(o,u,p,g){for(;p<=g;){const x=p+g>>1;if(u[x]===o)return!0;u[x]>o?g=x-1:p=x+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:kt,overloads:[[[kt,kt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[vs(kt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[vs(kt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[kt,[kt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[kt,[Tt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Tt,[Tt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Tt,[Tt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Tt,vs(en),(i,e)=>e.map((n=>yo(n.evaluate(i)))).join("")],"resolved-locale":[Tt,[$o],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ah{constructor(e,n,o){this.expression=e,this._warningHistory={},this._evaluator=new Qo,this._defaultValue=n?(function(u){if(u.type==="color"&&nh(u.default))return new hn(0,0,0,0);switch(u.type){case"color":return hn.parse(u.default)||null;case"padding":return qi.parse(u.default)||null;case"numberArray":return di.parse(u.default)||null;case"colorArray":return tn.parse(u.default)||null;case"variableAnchorOffsetCollection":return Ei.parse(u.default)||null;case"projectionDefinition":return rr.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=fr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,u,p,g){this._globalState&&(e=fr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new $n(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Ao(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ql}function ec(i,e,n){const o=new Jo(Ql,qr,[],e?(function(p){const g={color:ni,string:Tt,number:Fe,enum:Tt,boolean:kt,formatted:ds,padding:qs,numberArray:ps,colorArray:fs,projectionDefinition:Vi,resolvedImage:Si,variableAnchorOffsetCollection:Fl};return p.type==="array"?Pr(g[p.value]||en,p.length):g[p.type]})(e):void 0),u=o.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?iu(new ah(u,e,n)):Eo(o.errors)}class Gr{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!sl(n.expression),this.globalStateRefs=ar(n.expression),this._globalState=o}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=fr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,o,u,p,g)}evaluate(e,n,o,u,p,g){return this._globalState&&(e=fr(e,this._globalState)),this._styleExpression.evaluate(e,n,o,u,p,g)}}class Co{constructor(e,n,o,u,p){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!sl(n.expression),this.globalStateRefs=ar(n.expression),this.interpolationType=u,this._globalState=p}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=fr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,o,u,p,g)}evaluate(e,n,o,u,p,g){return this._globalState&&(e=fr(e,this._globalState)),this._styleExpression.evaluate(e,n,o,u,p,g)}interpolationFactor(e,n,o){return this.interpolationType?Vr.interpolationFactor(this.interpolationType,e,n,o):0}}function zo(i,e,n){const o=ec(i,e,n);if(o.result==="error")return o;const u=o.value.expression,p=Hs(u);if(!p&&!Da(e))return Eo([new dr("","data expressions not supported")]);const g=ol(u,["zoom"]);if(!g&&!od(e))return Eo([new dr("","zoom expressions not supported")]);const x=Po(u);return x||g?x instanceof dr?Eo([x]):x instanceof Vr&&!Jl(e)?Eo([new dr("",'"interpolate" expressions cannot be used with this property')]):iu(x?new Co(p?"camera":"composite",o.value,x.labels,x instanceof Vr?x.interpolation:void 0,n):new Gr(p?"constant":"source",o.value,n)):Eo([new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ll{constructor(e,n){this._parameters=e,this._specification=n,hr(this,ih(this._parameters,this._specification))}static deserialize(e){return new ll(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Po(i){let e=null;if(i instanceof Vn)e=Po(i.result);else if(i instanceof tl){for(const n of i.args)if(e=Po(n),e)break}else(i instanceof xo||i instanceof Vr)&&i.input instanceof ha&&i.input.name==="zoom"&&(e=i);return e instanceof dr||i.eachChild((n=>{const o=Po(n);o instanceof dr?e=o:!e&&o?e=new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function ar(i,e=new Set){return i instanceof nu&&e.add(i.key),i.eachChild((n=>{ar(n,e)})),e}function fr(i,e){const{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:g,accumulated:x}=i??{};return{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:g,accumulated:x,globalState:e}}function xs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!xs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const bs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wr(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};xs(i)||(i=cl(i));const n=ec(i,bs,e);if(n.result==="error")throw new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,p)=>n.value.evaluate(o,u,{},p),needGeometry:cd(i),getGlobalStateRefs:()=>ar(n.value.expression)}}function $s(i,e){return i<e?-1:i>e?1:0}function cd(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(cd(i[e]))return!0;return!1}function cl(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?tc(i[1],i[2],"=="):e==="!="?Xn(tc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?tc(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(cl))):e==="all"?["all"].concat(i.slice(1).map(cl)):e==="none"?["all"].concat(i.slice(1).map(cl).map(Xn)):e==="in"?ud(i[1],i.slice(2)):e==="!in"?Xn(ud(i[1],i.slice(2))):e==="has"?pr(i[1]):e!=="!has"||Xn(pr(i[1]));var n}function tc(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function ud(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort($s)]]:["filter-in-small",i,["literal",e]]}}function pr(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Xn(i){return["!",i]}function vn(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const p of i)u+=`${vn(p)},`;return`${u}]`}const n=Object.keys(i).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${vn(i[n[u]])},`;return`${o}}`}function Xs(i){let e="";for(const n of In)e+=`/${vn(i[n])}`;return e}function ma(i){const e=i.value;return e?[new bt(i.key,e,"constants have been deprecated as of v8")]:[]}function vi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Kr(i){if(Array.isArray(i))return i.map(Kr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Kr(i[n]);return e}return vi(i)}function Qr(i){const e=i.key,n=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},p=i.style,g=i.styleSpec,x=i.validateSpec;let T=[];const C=cn(n);if(C!=="object")return[new bt(e,n,`object expected, ${C} found`)];for(const I in n){const L=I.split(".")[0],B=Vl(o,L)||o["*"];let F;if(Vl(u,L))F=u[L];else if(Vl(o,L)){if(n[I]===void 0)continue;F=x}else if(u["*"])F=u["*"];else{if(!o["*"]){T.push(new bt(e,n[I],`unknown property "${I}"`));continue}F=x}T=T.concat(F({key:(e&&`${e}.`)+I,value:n[I],valueSpec:B,style:p,styleSpec:g,object:n,objectKey:I,validateSpec:x},n))}for(const I in o)u[I]||o[I].required&&o[I].default===void 0&&n[I]===void 0&&T.push(new bt(e,n,`missing required property "${I}"`));return T}function ru(i){const e=i.value,n=i.valueSpec,o=i.style,u=i.styleSpec,p=i.key,g=i.arrayElementValidator||i.validateSpec;if(cn(e)!=="array")return[new bt(p,e,`array expected, ${cn(e)} found`)];if(n.length&&e.length!==n.length)return[new bt(p,e,`array length ${n.length} expected, length ${e.length} found`)];let x={type:n.value,values:n.values};u.$version<7&&(x.function=n.function),cn(n.value)==="object"&&(x=n.value);let T=[];for(let C=0;C<e.length;C++)T=T.concat(g({array:e,arrayIndex:C,value:e[C],valueSpec:x,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${p}[${C}]`}));return T}function ws(i){const e=i.key,n=i.value,o=i.valueSpec;let u=cn(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new bt(e,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new bt(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new bt(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Ts(i){const e=i.valueSpec,n=vi(i.value.type);let o,u,p,g={};const x=n!=="categorical"&&i.value.property===void 0,T=!x,C=cn(i.value.stops)==="array"&&cn(i.value.stops[0])==="array"&&cn(i.value.stops[0][0])==="object",I=Qr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new bt(F.key,F.value,'identity function may not have a "stops" property')];let G=[];const H=F.value;return G=G.concat(ru({key:F.key,value:H,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:L})),cn(H)==="array"&&H.length===0&&G.push(new bt(F.key,H,"array must have at least one stop")),G},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&x&&I.push(new bt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||I.push(new bt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Jl(i.valueSpec)&&I.push(new bt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!Da(i.valueSpec)?I.push(new bt(i.key,i.value,"property functions not supported")):x&&!od(i.valueSpec)&&I.push(new bt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!C||i.value.property!==void 0||I.push(new bt(i.key,i.value,'"property" property is required')),I;function L(F){let G=[];const H=F.value,Y=F.key;if(cn(H)!=="array")return[new bt(Y,H,`array expected, ${cn(H)} found`)];if(H.length!==2)return[new bt(Y,H,`array length 2 expected, length ${H.length} found`)];if(C){if(cn(H[0])!=="object")return[new bt(Y,H,`object expected, ${cn(H[0])} found`)];if(H[0].zoom===void 0)return[new bt(Y,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new bt(Y,H,"object stop key must have value")];if(p&&p>vi(H[0].zoom))return[new bt(Y,H[0].zoom,"stop zoom values must appear in ascending order")];vi(H[0].zoom)!==p&&(p=vi(H[0].zoom),u=void 0,g={}),G=G.concat(Qr({key:`${Y}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:ws,value:B}}))}else G=G.concat(B({key:`${Y}[0]`,value:H[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},H));return Ao(Kr(H[1]))?G.concat([new bt(`${Y}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat(F.validateSpec({key:`${Y}[1]`,value:H[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function B(F,G){const H=cn(F.value),Y=vi(F.value),J=F.value!==null?F.value:G;if(o){if(H!==o)return[new bt(F.key,J,`${H} stop domain type must match previous stop domain type ${o}`)]}else o=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new bt(F.key,J,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&n!=="categorical"){let de=`number expected, ${H} found`;return Da(e)&&n===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new bt(F.key,J,de)]}return n!=="categorical"||H!=="number"||isFinite(Y)&&Math.floor(Y)===Y?n!=="categorical"&&H==="number"&&u!==void 0&&Y<u?[new bt(F.key,J,"stop domain values must appear in ascending order")]:(u=Y,n==="categorical"&&Y in g?[new bt(F.key,J,"stop domain values must be unique")]:(g[Y]=!0,[])):[new bt(F.key,J,`integer expected, found ${Y}`)]}}function Ss(i){const e=(i.expressionContext==="property"?zo:ec)(Kr(i.value),i.valueSpec);if(e.result==="error")return e.value.map((o=>new bt(`${i.key}${o.key}`,i.value,o.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new bt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!sl(n))return[new bt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!sl(n))return[new bt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ol(n,["zoom","feature-state"]))return[new bt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Hs(n))return[new bt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ys(i){const e=i.key,n=i.value,o=cn(n);return o!=="string"?[new bt(e,n,`color expected, ${o} found`)]:hn.parse(String(n))?[]:[new bt(e,n,`color expected, "${n}" found`)]}function Ws(i){const e=i.key,n=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(vi(n))===-1&&u.push(new bt(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(vi(n))===-1&&u.push(new bt(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Ia(i){return xs(Kr(i.value))?Ss(hr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Es(i)}function Es(i){const e=i.value,n=i.key;if(cn(e)!=="array")return[new bt(n,e,`array expected, ${cn(e)} found`)];const o=i.styleSpec;let u,p=[];if(e.length<1)return[new bt(n,e,"filter array must have at least 1 element")];switch(p=p.concat(Ws({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),vi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&vi(e[1])==="$type"&&p.push(new bt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new bt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=cn(e[1]),u!=="string"&&p.push(new bt(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=cn(e[g]),vi(e[1])==="$type"?p=p.concat(Ws({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new bt(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Es({key:`${n}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=cn(e[1]),e.length!==2?p.push(new bt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new bt(`${n}[1]`,e[1],`string expected, ${u} found`))}return p}function Ks(i,e){const n=i.key,o=i.validateSpec,u=i.style,p=i.styleSpec,g=i.value,x=i.objectKey,T=p[`${e}_${i.layerType}`];if(!T)return[];const C=x.match(/^(.*)-transition$/);if(e==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return o({key:n,value:g,valueSpec:p.transition,style:u,styleSpec:p});const I=i.valueSpec||T[x];if(!I)return[new bt(n,g,`unknown property "${x}"`)];let L;if(cn(g)==="string"&&Da(I)&&!I.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new bt(n,g,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const B=[];return i.layerType==="symbol"&&x==="text-font"&&nh(Kr(g))&&vi(g.type)==="identity"&&B.push(new bt(n,g,'"text-font" does not support identity functions')),B.concat(o({key:i.key,value:g,valueSpec:I,style:u,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:x}))}function Ms(i){return Ks(i,"paint")}function sh(i){return Ks(i,"layout")}function oh(i){let e=[];const n=i.value,o=i.key,u=i.style,p=i.styleSpec;if(cn(n)!=="object")return[new bt(o,n,`object expected, ${cn(n)} found`)];n.type||n.ref||e.push(new bt(o,n,'either "type" or "ref" is required'));let g=vi(n.type);const x=vi(n.ref);if(n.id){const T=vi(n.id);for(let C=0;C<i.arrayIndex;C++){const I=u.layers[C];vi(I.id)===T&&e.push(new bt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach((C=>{C in n&&e.push(new bt(o,n[C],`"${C}" is prohibited for ref layers`))})),u.layers.forEach((C=>{vi(C.id)===x&&(T=C)})),T?T.ref?e.push(new bt(o,n.ref,"ref cannot reference another ref layer")):g=vi(T.type):e.push(new bt(o,n.ref,`ref layer "${x}" not found`))}else if(g!=="background")if(n.source){const T=u.sources&&u.sources[n.source],C=T&&vi(T.type);T?C==="vector"&&g==="raster"?e.push(new bt(o,n.source,`layer "${n.id}" requires a raster source`)):C!=="raster-dem"&&g==="hillshade"||C!=="raster-dem"&&g==="color-relief"?e.push(new bt(o,n.source,`layer "${n.id}" requires a raster-dem source`)):C==="raster"&&g!=="raster"?e.push(new bt(o,n.source,`layer "${n.id}" requires a vector source`)):C!=="vector"||n["source-layer"]?C==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new bt(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||C==="geojson"&&T.lineMetrics||e.push(new bt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new bt(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new bt(o,n.source,`source "${n.source}" not found`))}else e.push(new bt(o,n,'missing required property "source"'));return e=e.concat(Qr({key:o,value:n,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Ia,layout:T=>Qr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>sh(hr({layerType:g},C))}}),paint:T=>Qr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Ms(hr({layerType:g},C))}})}})),e}function ga(i){const e=i.value,n=i.key,o=cn(e);return o!=="string"?[new bt(n,e,`string expected, ${o} found`)]:[]}const nc={promoteId:function({key:i,value:e}){if(cn(e)==="string")return ga({key:i,value:e});{const n=[];for(const o in e)n.push(...ga({key:`${i}.${o}`,value:e[o]}));return n}}};function Qs(i){const e=i.value,n=i.key,o=i.styleSpec,u=i.style,p=i.validateSpec;if(!e.type)return[new bt(n,e,'"type" is required')];const g=vi(e.type);let x;switch(g){case"vector":case"raster":return x=Qr({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:nc,validateSpec:p}),x;case"raster-dem":return x=(function(T){var C;const I=(C=T.sourceName)!==null&&C!==void 0?C:"",L=T.value,B=T.styleSpec,F=B.source_raster_dem,G=T.style;let H=[];const Y=cn(L);if(L===void 0)return H;if(Y!=="object")return H.push(new bt("source_raster_dem",L,`object expected, ${Y} found`)),H;const J=vi(L.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],ee=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ae in L)!J&&de.includes(ae)?H.push(new bt(ae,L[ae],`In "${I}": "${ae}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):F[ae]?H=H.concat(T.validateSpec({key:ae,value:L[ae],valueSpec:F[ae],validateSpec:T.validateSpec,style:G,styleSpec:B})):H.push(new bt(ae,L[ae],`unknown property "${ae}"`));return H})({sourceName:n,value:e,style:i.style,styleSpec:o,validateSpec:p}),x;case"geojson":if(x=Qr({key:n,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:p,objectElementValidators:nc}),e.cluster)for(const T in e.clusterProperties){const[C,I]=e.clusterProperties[T],L=typeof C=="string"?[C,["accumulated"],["get",T]]:C;x.push(...Ss({key:`${n}.${T}.map`,value:I,expressionContext:"cluster-map"})),x.push(...Ss({key:`${n}.${T}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return Qr({key:n,value:e,valueSpec:o.source_video,style:u,validateSpec:p,styleSpec:o});case"image":return Qr({key:n,value:e,valueSpec:o.source_image,style:u,validateSpec:p,styleSpec:o});case"canvas":return[new bt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ws({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Gi(i){const e=i.value,n=i.styleSpec,o=n.light,u=i.style;let p=[];const g=cn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new bt("light",e,`object expected, ${g} found`)]),p;for(const x in e){const T=x.match(/^(.*)-transition$/);p=p.concat(T&&o[T[1]]&&o[T[1]].transition?i.validateSpec({key:x,value:e[x],valueSpec:n.transition,validateSpec:i.validateSpec,style:u,styleSpec:n}):o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new bt(x,e[x],`unknown property "${x}"`)])}return p}function au(i){const e=i.value,n=i.styleSpec,o=n.sky,u=i.style,p=cn(e);if(e===void 0)return[];if(p!=="object")return[new bt("sky",e,`object expected, ${p} found`)];let g=[];for(const x in e)g=g.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],style:u,styleSpec:n}):[new bt(x,e[x],`unknown property "${x}"`)]);return g}function lh(i){const e=i.value,n=i.styleSpec,o=n.terrain,u=i.style;let p=[];const g=cn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new bt("terrain",e,`object expected, ${g} found`)]),p;for(const x in e)p=p.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new bt(x,e[x],`unknown property "${x}"`)]);return p}function hd(i){let e=[];const n=i.value,o=i.key;if(Array.isArray(n)){const u=[],p=[];for(const g in n)n[g].id&&u.includes(n[g].id)&&e.push(new bt(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),u.push(n[g].id),n[g].url&&p.includes(n[g].url)&&e.push(new bt(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),p.push(n[g].url),e=e.concat(Qr({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return ga({key:o,value:n})}function Lf(i){return!!i&&i.constructor===Object}function dd(i){return Lf(i.value)?[]:[new bt(i.key,i.value,`object expected, ${cn(i.value)} found`)]}const Bi={"*":()=>[],array:ru,boolean:function(i){const e=i.value,n=i.key,o=cn(e);return o!=="boolean"?[new bt(n,e,`boolean expected, ${o} found`)]:[]},number:ws,color:Ys,constants:ma,enum:Ws,filter:Ia,function:Ts,layer:oh,object:Qr,source:Qs,light:Gi,sky:au,terrain:lh,projection:function(i){const e=i.value,n=i.styleSpec,o=n.projection,u=i.style,p=cn(e);if(e===void 0)return[];if(p!=="object")return[new bt("projection",e,`object expected, ${p} found`)];let g=[];for(const x in e)g=g.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],style:u,styleSpec:n}):[new bt(x,e[x],`unknown property "${x}"`)]);return g},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const o=cn(n);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(n)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(n)?["array","string"].includes(o)?[]:[new bt(e,n,`projection expected, invalid type "${o}" found`)]:[new bt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:ga,formatted:function(i){return ga(i).length===0?[]:Ss(i)},resolvedImage:function(i){return ga(i).length===0?[]:Ss(i)},padding:function(i){const e=i.key,n=i.value;if(cn(n)==="array"){if(n.length<1||n.length>4)return[new bt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let p=0;p<n.length;p++)u=u.concat(i.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return u}return ws({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(cn(n)==="array"){const o={type:"number"};if(n.length<1)return[new bt(e,n,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<n.length;p++)u=u.concat(i.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return u}return ws({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(cn(n)==="array"){if(n.length<1)return[new bt(e,n,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<n.length;u++)o=o.concat(Ys({key:`${e}[${u}]`,value:n[u]}));return o}return Ys({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,o=cn(n),u=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new bt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let g=0;g<n.length;g+=2)p=p.concat(Ws({key:`${e}[${g}]`,value:n[g],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(ru({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return p},sprite:hd,state:dd,fontFaces:function(i){const e=i.key,n=i.value,o=i.validateSpec,u=i.styleSpec,p=i.style;if(!Lf(n))return[new bt(e,n,`object expected, ${cn(n)} found`)];const g=[];for(const x in n){const T=n[x],C=cn(T);if(C==="string")g.push(...ga({key:`${e}.${x}`,value:T}));else if(C==="array"){const I={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[L,B]of T.entries())g.push(...Qr({key:`${e}.${x}[${L}]`,value:B,valueSpec:I,styleSpec:u,style:p,validateSpec:o}))}else g.push(new bt(`${e}.${x}`,T,`string or array expected, ${C} found`))}return g}};function As(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=As,n.expression&&nh(vi(e))?Ts(i):n.expression&&Ao(Kr(e))?Ss(i):n.type&&Bi[n.type]?Bi[n.type](i):Qr(hr({},i,{valueSpec:n.type?o[n.type]:n}))}function ic(i){const e=i.value,n=i.key,o=ga(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new bt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new bt(n,e,'"glyphs" url must include a "{range}" token'))),o}function Dr(i,e=Oe){let n=[];return n=n.concat(As({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:As,objectElementValidators:{glyphs:ic,"*":()=>[]}})),i.constants&&(n=n.concat(ma({key:"constants",value:i.constants}))),ul(n)}function ya(i){return function(e){return i(Object.assign({},e,{validateSpec:As}))}}function ul(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function Ir(i){return function(...e){return ul(i.apply(this,e))}}Dr.source=Ir(ya(Qs)),Dr.sprite=Ir(ya(hd)),Dr.glyphs=Ir(ya(ic)),Dr.light=Ir(ya(Gi)),Dr.sky=Ir(ya(au)),Dr.terrain=Ir(ya(lh)),Dr.state=Ir(ya(dd)),Dr.layer=Ir(ya(oh)),Dr.filter=Ir(ya(Ia)),Dr.paintProperty=Ir(ya(Ms)),Dr.layoutProperty=Ir(ya(sh));const tm={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class rc{constructor(e,n){this._globalState=n,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=ec(e,tm,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=ar(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const su=Oe,sr=Dr,Ka=sr.light,ch=sr.sky,uh=sr.paintProperty,Of=sr.layoutProperty;function Qa(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new yn(new Error(o.message))),n=!0;return n}class Do{constructor(e,n,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let T=0;T<this.d*this.d;T++){const C=g[3+T],I=g[3+T+1];u.push(C===I?null:g.subarray(C,I))}const x=g[3+u.length+1];this.keys=g.subarray(g[3+u.length],x),this.bboxes=g.subarray(x),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const p=o/n*e;this.min=-p,this.max=e+p}insert(e,n,o,u,p){this._forEachCell(n,o,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,u,p,g){this.cells[p].push(g)}query(e,n,o,u,p){const g=this.min,x=this.max;if(e<=g&&n<=g&&x<=o&&x<=u&&!p)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,o,u,this._queryCell,T,{},p),T}}_queryCell(e,n,o,u,p,g,x,T){const C=this.cells[p];if(C!==null){const I=this.keys,L=this.bboxes;for(let B=0;B<C.length;B++){const F=C[B];if(x[F]===void 0){const G=4*F;(T?T(L[G+0],L[G+1],L[G+2],L[G+3]):e<=L[G+2]&&n<=L[G+3]&&o>=L[G+0]&&u>=L[G+1])?(x[F]=!0,g.push(I[F])):x[F]=!1}}}}_forEachCell(e,n,o,u,p,g,x,T){const C=this._convertToCellCoord(e),I=this._convertToCellCoord(n),L=this._convertToCellCoord(o),B=this._convertToCellCoord(u);for(let F=C;F<=L;F++)for(let G=I;G<=B;G++){const H=this.d*G+F;if((!T||T(this._convertFromCellCoord(F),this._convertFromCellCoord(G),this._convertFromCellCoord(F+1),this._convertFromCellCoord(G+1)))&&p.call(this,e,n,o,u,H,g,x,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=n;for(let g=0;g<e.length;g++){const x=e[g];u[3+g]=p,u.set(x,p),p+=x.length}return u[3+e.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+e.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new Do(e.buffer)}}const Jr={};function Ot(i,e,n={}){if(Jr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Jr[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Ot("Object",Object),Ot("Set",Set),Ot("TransferableGridIndex",Do),Ot("Color",hn),Ot("Error",Error),Ot("AJAXError",Se),Ot("ResolvedImage",Fr),Ot("StylePropertyFunction",ll),Ot("StyleExpression",ah,{omit:["_evaluator"]}),Ot("ZoomDependentExpression",Co),Ot("ZoomConstantExpression",Gr),Ot("CompoundExpression",ha,{omit:["_evaluate"]});for(const i in Ql)Ql[i]._classRegistryKey||Ot(`Expression_${i}`,Ql[i]);function ou(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function hh(i){return i.$name||i.constructor._classRegistryKey}function ka(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=hh(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||ou(i)||Wi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Ja(i,e){if(ka(i))return(ou(i)||Wi(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const p=[];for(const g of i)p.push(Ja(g,e));return p}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=hh(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Jr[n])throw new Error(`${n} is not registered.`);const{klass:o}=Jr[n],u=o.serialize?o.serialize(i,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||Jr[n].omit.indexOf(p)>=0)continue;const g=i[p];u[p]=Jr[n].shallow.indexOf(p)>=0?g:Ja(g,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function ac(i){if(ka(i))return i;if(Array.isArray(i))return i.map(ac);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=hh(i)||"Object";if(!Jr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Jr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const p=i[u];o[u]=Jr[e].shallow.indexOf(u)>=0?p:ac(p)}return o}class dh{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function Cs(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function hl(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function lu(i){return/\s/u.test(String.fromCodePoint(i))}function zs(i){for(const e of i)if(hl(e.codePointAt(0)))return!0;return!1}function fh(i){for(const e of i)if(!fd(e.codePointAt(0)))return!1;return!0}function cu(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const Ps=cu(["Arab","Dupl","Mong","Ougr","Syrc"]);function fd(i){return!Ps.test(String.fromCodePoint(i))}function Ds(i){return!(hl(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const ph=cu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function uu(i){return ph.test(String.fromCodePoint(i))}function Is(i,e){return!(!e&&uu(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Js(i){for(const e of i)if(uu(e.codePointAt(0)))return!0;return!1}const Ra=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Ra.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,o=new Promise((p=>{this.loadScriptResolve=p}));e(n);const u=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:n};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class Fn{constructor(e,n){this.isSupportedScript=pd,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new dh,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}function pd(i){return(function(e,n){for(const o of e)if(!Is(o.codePointAt(0),n))return!1;return!0})(i,Ra.getRTLTextPluginStatus()==="loaded")}const eo="-transition";class Io{constructor(e,n,o){this.property=e,this.value=n,this.expression=(function(u,p,g){if(nh(u))return new ll(u,p);if(Ao(u)){const x=zo(u,p,g);if(x.result==="error")throw new Error(x.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return x.value}{let x=u;return p.type==="color"&&typeof u=="string"?x=hn.parse(u):p.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?p.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?p.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?x=Ei.parse(u):p.type==="projectionDefinition"&&typeof u=="string"&&(x=rr.parse(u)):x=tn.parse(u):x=di.parse(u):x=qi.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>x}}})(n===void 0?e.specification.default:n,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class hu{constructor(e,n){this.property=e,this.value=new Io(e,void 0,n)}transitioned(e,n){return new dl(this.property,this.value,n,ln({},e.transition,this.transition),e.now)}untransitioned(){return new dl(this.property,this.value,null,{},0)}}class mh{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return Rn(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new hu(this._values[e].property,this._globalState)),this._values[e].value=new Io(this._values[e].property,n===null?void 0:Rn(n),this._globalState)}getTransition(e){return Rn(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new hu(this._values[e].property,this._globalState)),this._values[e].transition=Rn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const u=this.getTransition(n);u!==void 0&&(e[`${n}${eo}`]=u)}return e}transitioned(e,n){const o=new du(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,n._values[u]);return o}untransitioned(){const e=new du(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class dl{constructor(e,n,o,u,p){this.property=e,this.value=n,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const u=e.now||0,p=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return g.possiblyEvaluate(e,n,o);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),p,wt(x))}}return p}}class du{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const u=new fl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,n,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class md{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Rn(this._values[e].value)}setValue(e,n){this._values[e]=new Io(this._values[e].property,n===null?void 0:Rn(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const u=new fl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,n,o);return u}}class _a{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,u){return this.property.evaluate(this.value,this.parameters,e,n,o,u)}}class fl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Nt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const u=pi[this.specification.type];return u?u(e,n,o):e}}class Xt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,u){return new _a(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,u)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new _a(this,{kind:"constant",value:void 0},e.parameters);const u=pi[this.specification.type];if(u){const p=u(e.value.value,n.value.value,o);return new _a(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,n,o,u,p,g){return e.kind==="constant"?e.value:e.evaluate(n,o,u,p,g)}}class La extends Xt{possiblyEvaluate(e,n,o,u){if(e.value===void 0)return new _a(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},o,u),g=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,x=this._calculate(g,g,g,n);return new _a(this,{kind:"constant",value:x},n)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new _a(this,{kind:"constant",value:p},n)}return new _a(this,e.expression,n)}evaluate(e,n,o,u,p,g){if(e.kind==="source"){const x=e.evaluate(n,o,u,p,g);return this._calculate(x,x,x,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,u),e.evaluate({zoom:Math.floor(n.zoom)},o,u),e.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):e.value}_calculate(e,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class sc{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},o,u);return this._calculate(p,p,p,n)}return this._calculate(e.expression.evaluate(new Fn(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Fn(Math.floor(n.zoom),n)),e.expression.evaluate(new Fn(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class fu{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,u){return!!e.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class Ni{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Io(o,void 0,void 0),p=this.defaultTransitionablePropertyValues[n]=new hu(o,void 0);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}Ot("DataDrivenProperty",Xt),Ot("DataConstantProperty",Nt),Ot("CrossFadedDataDrivenProperty",La),Ot("CrossFadedProperty",sc),Ot("ColorRampProperty",fu);class xi extends un{constructor(e,n,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(u,p){return new rc(u,p)})(this.visibility,o),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Wr(e.filter,o)),n.layout&&(this._unevaluatedLayout=new md(n.layout,o)),n.paint)){this._transitionablePaint=new mh(n.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fl(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=Wr(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())e.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const u of o.getGlobalStateRefs())e.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const p of u.getGlobalStateRefs()){const g=(e=n.get(p))!==null&&e!==void 0?e:[];g.push({name:o,value:u.value}),n.set(p,g)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,n,o={}){if(n==null||!this._validate(Of,`layers.${this.id}.layout.${e}`,e,n,o))return e==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,n)}getPaintProperty(e){return e.endsWith(eo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(uh,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(eo))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[e],p=u.property.specification["property-type"]==="cross-faded-data-driven",g=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||g||p||this._handleOverridablePaintPropertyUpdate(e,x,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e=this.minzoom,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ai(e,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(e,n,o,u,p={}){return(!p||p.validate!==!1)&&Qa(this,e.call(sr,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof _a&&Da(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let Ai;var pu={get paint(){return Ai=Ai||new Ni({"raster-opacity":new Nt(Oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Nt(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(Oe.paint_raster["raster-saturation"]),"raster-contrast":new Nt(Oe.paint_raster["raster-contrast"]),"raster-resampling":new Nt(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(Oe.paint_raster["raster-fade-duration"])})}};class to extends xi{constructor(e,n){super(e,pu,n)}}const fn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bn{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mi(i,e=1){let n=0,o=0;return{members:i.map((u=>{const p=fn[u.type].BYTES_PER_ELEMENT,g=n=Oa(n,Math.max(e,p)),x=u.components||1;return o=Math.max(o,p),n+=p*x,{name:u.name,type:u.type,components:x,offset:g}})),size:Oa(n,Math.max(o,e)),alignment:e}}function Oa(i,e){return Math.ceil(i/e)*e}class es extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=o,e}}es.prototype.bytesPerElement=4,Ot("StructArrayLayout2i4",es);class pl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=u,e}}pl.prototype.bytesPerElement=6,Ot("StructArrayLayout3i6",pl);class ml extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,u)}emplace(e,n,o,u,p){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=u,this.int16[g+3]=p,e}}ml.prototype.bytesPerElement=8,Ot("StructArrayLayout4i8",ml);class no extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=u,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=x,e}}no.prototype.bytesPerElement=12,Ot("StructArrayLayout2i4i12",no);class gd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=4*e,C=8*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.uint8[C+4]=u,this.uint8[C+5]=p,this.uint8[C+6]=g,this.uint8[C+7]=x,e}}gd.prototype.bytesPerElement=8,Ot("StructArrayLayout2i4ub8",gd);class si extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=o,e}}si.prototype.bytesPerElement=8,Ot("StructArrayLayout2f8",si);class ts extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I){const L=this.length;return this.resize(L+1),this.emplace(L,e,n,o,u,p,g,x,T,C,I)}emplace(e,n,o,u,p,g,x,T,C,I,L){const B=10*e;return this.uint16[B+0]=n,this.uint16[B+1]=o,this.uint16[B+2]=u,this.uint16[B+3]=p,this.uint16[B+4]=g,this.uint16[B+5]=x,this.uint16[B+6]=T,this.uint16[B+7]=C,this.uint16[B+8]=I,this.uint16[B+9]=L,e}}ts.prototype.bytesPerElement=20,Ot("StructArrayLayout10ui20",ts);class oc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,o,u,p,g,x,T)}emplace(e,n,o,u,p,g,x,T,C){const I=8*e;return this.uint16[I+0]=n,this.uint16[I+1]=o,this.uint16[I+2]=u,this.uint16[I+3]=p,this.uint16[I+4]=g,this.uint16[I+5]=x,this.uint16[I+6]=T,this.uint16[I+7]=C,e}}oc.prototype.bytesPerElement=16,Ot("StructArrayLayout8ui16",oc);class lc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,u,p,g,x,T,C,I,L,B)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F){const G=12*e;return this.int16[G+0]=n,this.int16[G+1]=o,this.int16[G+2]=u,this.int16[G+3]=p,this.uint16[G+4]=g,this.uint16[G+5]=x,this.uint16[G+6]=T,this.uint16[G+7]=C,this.int16[G+8]=I,this.int16[G+9]=L,this.int16[G+10]=B,this.int16[G+11]=F,e}}lc.prototype.bytesPerElement=24,Ot("StructArrayLayout4i4ui4i24",lc);class mu extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,e}}mu.prototype.bytesPerElement=12,Ot("StructArrayLayout3f12",mu);class gu extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}gu.prototype.bytesPerElement=4,Ot("StructArrayLayout1ul4",gu);class yu extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,o,u,p,g,x,T,C)}emplace(e,n,o,u,p,g,x,T,C,I){const L=10*e,B=5*e;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=u,this.int16[L+3]=p,this.int16[L+4]=g,this.int16[L+5]=x,this.uint32[B+3]=T,this.uint16[L+8]=C,this.uint16[L+9]=I,e}}yu.prototype.bytesPerElement=20,Ot("StructArrayLayout6i1ul2ui20",yu);class ko extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=u,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=x,e}}ko.prototype.bytesPerElement=12,Ot("StructArrayLayout2i2i2i12",ko);class io extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,u,p)}emplace(e,n,o,u,p,g){const x=4*e,T=8*e;return this.float32[x+0]=n,this.float32[x+1]=o,this.float32[x+2]=u,this.int16[T+6]=p,this.int16[T+7]=g,e}}io.prototype.bytesPerElement=16,Ot("StructArrayLayout2f1f2i16",io);class Er extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=16*e,C=4*e,I=8*e;return this.uint8[T+0]=n,this.uint8[T+1]=o,this.float32[C+1]=u,this.float32[C+2]=p,this.int16[I+6]=g,this.int16[I+7]=x,e}}Er.prototype.bytesPerElement=16,Ot("StructArrayLayout2ub2f2i16",Er);class gi extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=u,e}}gi.prototype.bytesPerElement=6,Ot("StructArrayLayout3ui6",gi);class ks extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B,F,G,H,Y,J){const de=this.length;return this.resize(de+1),this.emplace(de,e,n,o,u,p,g,x,T,C,I,L,B,F,G,H,Y,J)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F,G,H,Y,J,de){const ee=24*e,ae=12*e,me=48*e;return this.int16[ee+0]=n,this.int16[ee+1]=o,this.uint16[ee+2]=u,this.uint16[ee+3]=p,this.uint32[ae+2]=g,this.uint32[ae+3]=x,this.uint32[ae+4]=T,this.uint16[ee+10]=C,this.uint16[ee+11]=I,this.uint16[ee+12]=L,this.float32[ae+7]=B,this.float32[ae+8]=F,this.uint8[me+36]=G,this.uint8[me+37]=H,this.uint8[me+38]=Y,this.uint32[ae+10]=J,this.int16[ee+22]=de,e}}ks.prototype.bytesPerElement=48,Ot("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ks);class gl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B,F,G,H,Y,J,de,ee,ae,me,ve,Ue,ot,et,pt,Dt,yt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,e,n,o,u,p,g,x,T,C,I,L,B,F,G,H,Y,J,de,ee,ae,me,ve,Ue,ot,et,pt,Dt,yt)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F,G,H,Y,J,de,ee,ae,me,ve,Ue,ot,et,pt,Dt,yt,rt){const He=32*e,jt=16*e;return this.int16[He+0]=n,this.int16[He+1]=o,this.int16[He+2]=u,this.int16[He+3]=p,this.int16[He+4]=g,this.int16[He+5]=x,this.int16[He+6]=T,this.int16[He+7]=C,this.uint16[He+8]=I,this.uint16[He+9]=L,this.uint16[He+10]=B,this.uint16[He+11]=F,this.uint16[He+12]=G,this.uint16[He+13]=H,this.uint16[He+14]=Y,this.uint16[He+15]=J,this.uint16[He+16]=de,this.uint16[He+17]=ee,this.uint16[He+18]=ae,this.uint16[He+19]=me,this.uint16[He+20]=ve,this.uint16[He+21]=Ue,this.uint16[He+22]=ot,this.uint32[jt+12]=et,this.float32[jt+13]=pt,this.float32[jt+14]=Dt,this.uint16[He+30]=yt,this.uint16[He+31]=rt,e}}gl.prototype.bytesPerElement=64,Ot("StructArrayLayout8i15ui1ul2f2ui64",gl);class yl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}yl.prototype.bytesPerElement=4,Ot("StructArrayLayout1f4",yl);class cc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.uint16[6*e+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,e}}cc.prototype.bytesPerElement=12,Ot("StructArrayLayout1ui2f12",cc);class ns extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=4*e;return this.uint32[2*e+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=u,e}}ns.prototype.bytesPerElement=8,Ot("StructArrayLayout1ul2ui8",ns);class y extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,e}}y.prototype.bytesPerElement=4,Ot("StructArrayLayout2ui4",y);class t extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,Ot("StructArrayLayout1ui2",t);class a extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,u)}emplace(e,n,o,u,p){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=u,this.float32[g+3]=p,e}}a.prototype.bytesPerElement=16,Ot("StructArrayLayout4f16",a);class c extends Bn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class f extends yu{get(e){return new c(this,e)}}Ot("CollisionBoxArray",f);class v extends Bn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}v.prototype.size=48;class w extends ks{get(e){return new v(this,e)}}Ot("PlacedSymbolArray",w);class E extends Bn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}E.prototype.size=64;class P extends gl{get(e){return new E(this,e)}}Ot("SymbolInstanceArray",P);class R extends yl{getoffsetX(e){return this.float32[1*e+0]}}Ot("GlyphOffsetArray",R);class O extends pl{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ot("SymbolLineVertexArray",O);class V extends Bn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}V.prototype.size=12;class j extends cc{get(e){return new V(this,e)}}Ot("TextAnchorOffsetArray",j);class X extends Bn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}X.prototype.size=8;class Q extends ns{get(e){return new X(this,e)}}Ot("FeatureIndexArray",Q);class se extends es{}class le extends es{}class oe extends es{}class he extends no{}class _e extends gd{}class ce extends si{}class ye extends ts{}class Te extends oc{}class pe extends lc{}class Ce extends mu{}class Ge extends gu{}class je extends ko{}class Ve extends Er{}class qe extends gi{}class St extends y{}const At=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ft}=At;class Pt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,o,u){const p=this.segments[this.segments.length-1];return e>Pt.MAX_VERTEX_ARRAY_LENGTH&&Mn(`Max vertices per segment is ${Pt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Pt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>Pt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u?this.createNewSegment(n,o,u):p}createNewSegment(e,n,o){const u={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,n,o){return this.prepareSegment(0,e,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,u){return new Pt([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function sn(i,e){return 256*(i=Zt(Math.floor(i),0,255))+Zt(Math.floor(e),0,255)}Pt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot("SegmentVector",Pt);const Nn=mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ei=mi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Yn,oi,qn,bi={exports:{}},li={exports:{}},mr={exports:{}},Ci=(function(){if(qn)return bi.exports;qn=1;var i=(Yn||(Yn=1,li.exports=function(n,o){var u,p,g,x,T,C,I,L;for(p=n.length-(u=3&n.length),g=o,T=3432918353,C=461845907,L=0;L<p;)I=255&n.charCodeAt(L)|(255&n.charCodeAt(++L))<<8|(255&n.charCodeAt(++L))<<16|(255&n.charCodeAt(++L))<<24,++L,g=27492+(65535&(x=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*C+(((I>>>16)*C&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,u){case 3:I^=(255&n.charCodeAt(L+2))<<16;case 2:I^=(255&n.charCodeAt(L+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&n.charCodeAt(L)))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*C+(((I>>>16)*C&65535)<<16)&4294967295}return g^=n.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),li.exports),e=(oi||(oi=1,mr.exports=function(n,o){for(var u,p=n.length,g=o^p,x=0;p>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(x)|(255&n.charCodeAt(++x))<<8|(255&n.charCodeAt(++x))<<16|(255&n.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:g^=(255&n.charCodeAt(x+2))<<16;case 2:g^=(255&n.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&n.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),mr.exports);return bi.exports=i,bi.exports.murmur3=i,bi.exports.murmur2=e,bi.exports})(),zi=W(Ci);class gr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,u){this.ids.push(Rs(e)),this.positions.push(n,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Rs(e);let o=0,u=this.ids.length-1;for(;o<u;){const g=o+u>>1;this.ids[g]>=n?u=g:o=g+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(e,n){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Ls(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const n=new gr;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Rs(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:zi(String(i))}function Ls(i,e,n,o){for(;n<o;){const u=i[n+o>>1];let p=n-1,g=o+1;for(;;){do p++;while(i[p]<u);do g--;while(i[g]>u);if(p>=g)break;is(i,p,g),is(e,3*p,3*g),is(e,3*p+1,3*g+1),is(e,3*p+2,3*g+2)}g-n<o-g?(Ls(i,e,n,g),n=g+1):(Ls(i,e,g+1,o),o=g)}}function is(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}Ot("FeaturePositionMap",gr);class ea{constructor(e,n){this.gl=e.gl,this.location=n}}class _l extends ea{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class uc extends ea{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class rs extends ea{constructor(e,n){super(e,n),this.current=hn.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ta=new Float32Array(16);function va(i){return[sn(255*i.r,255*i.g),sn(255*i.b,255*i.a)]}class Ba{constructor(e,n,o){this.value=e,this.uniformNames=n.map((u=>`u_${u}`)),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new rs(e,n):new _l(e,n)}}class Na{constructor(e,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,o,u){let p=null;u==="u_pattern_to"?p=this.patternTo:u==="u_pattern_from"?p=this.patternFrom:u==="u_dasharray_to"?p=this.dashTo:u==="u_dasharray_from"?p=this.dashFrom:u==="u_pixel_ratio_to"?p=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&e.set(p)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new uc(e,n):new _l(e,n)}}class jn{constructor(e,n,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,n,o){const u=this.paintVertexArray.length,p=this.expression.evaluate(new Fn(0,o),n,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,p)}updatePaintArray(e,n,o,u,p){const g=this.expression.evaluate(new Fn(0,p),o,u);this._setPaintValue(e,n,g)}_setPaintValue(e,n,o){if(this.type==="color"){const u=va(o);for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wn{constructor(e,n,o,u,p,g){this.expression=e,this.uniformNames=n.map((x=>`u_${x}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map((x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(e,n,o){const u=this.expression.evaluate(new Fn(this.zoom,o),n,{},o.canonical,[],o.formattedSection),p=this.expression.evaluate(new Fn(this.zoom+1,o),n,{},o.canonical,[],o.formattedSection),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,u,p)}updatePaintArray(e,n,o,u,p){const g=this.expression.evaluate(new Fn(this.zoom,p),o,u),x=this.expression.evaluate(new Fn(this.zoom+1,p),o,u);this._setPaintValue(e,n,g,x)}_setPaintValue(e,n,o,u){if(this.type==="color"){const p=va(o),g=va(u);for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,p[0],p[1],g[0],g[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=Zt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,n,o){return new _l(e,n)}}class Zi{constructor(e,n,o,u,p,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=g,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(n),o)}updatePaintArray(e,n,o,u,p){this._setPaintValues(e,n,this.getPositionIds(o),p)}_setPaintValues(e,n,o,u){const p=this.getPositions(u);if(!p||!o)return;const g=p[o.min],x=p[o.mid],T=p[o.max];if(g&&x&&T)for(let C=e;C<n;C++)this.emplace(this.zoomInPaintVertexArray,C,x,g),this.emplace(this.zoomOutPaintVertexArray,C,x,T)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ji extends Zi{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Nn.members}emplace(e,n,o,u){e.emplace(n,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class gh extends Zi{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return ei.members}emplace(e,n,o,u){e.emplace(n,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class yh{constructor(e,n,o){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!o(p))continue;const g=e.paint.get(p);if(!(g instanceof _a&&Da(g.property.specification)))continue;const x=Bf(p,e.type),T=g.value,C=g.property.specification.type,I=g.property.useIntegerZoom,L=g.property.specification["property-type"],B=L==="cross-faded"||L==="cross-faded-data-driven";if(T.kind==="constant")this.binders[p]=B?new Na(T.value,x):new Ba(T.value,x,C),u.push(`/u_${p}`);else if(T.kind==="source"||B){const F=Lo(p,C,"source");this.binders[p]=B?p==="line-dasharray"?new gh(T,C,I,n,F,e.id):new Ji(T,C,I,n,F,e.id):new jn(T,x,C,F),u.push(`/a_${p}`)}else{const F=Lo(p,C,"composite");this.binders[p]=new Wn(T,x,C,I,n,F),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof jn||n instanceof Wn?n.maxValue:0}populatePaintArrays(e,n,o){for(const u in this.binders){const p=this.binders[u];(p instanceof jn||p instanceof Wn||p instanceof Zi)&&p.populatePaintArray(e,n,o)}}setConstantPatternPositions(e,n){for(const o in this.binders){const u=this.binders[o];u instanceof Na&&u.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const o in this.binders){const u=this.binders[o];u instanceof Na&&u.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,o,u,p){let g=!1;for(const x in e){const T=n.getPositions(x);for(const C of T){const I=o.feature(C.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof jn||B instanceof Wn||B instanceof Zi)&&B.expression.isStateDependent===!0){const F=u.paint.get(L);B.expression=F.value,B.updatePaintArray(C.start,C.end,I,e[x],p),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Ba||o instanceof Na)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof jn||o instanceof Wn)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof Zi){const u=o.getVertexAttributes();for(const p of u)e.push(p.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ba||o instanceof Na||o instanceof Wn)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Ba||p instanceof Na||p instanceof Wn){for(const g of p.uniformNames)if(n[g]){const x=p.getBinding(e,n[g],g);o.push({name:g,property:u,binding:x})}}}return o}setUniforms(e,n,o,u){for(const{name:p,property:g,binding:x}of n)this.binders[g].setUniform(x,u,o.get(g),p)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof Zi){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof jn||o instanceof Wn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof jn||o instanceof Wn||o instanceof Zi)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof jn||n instanceof Wn||n instanceof Zi)&&n.destroy()}}}class Ro{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new yh(u,n,o);this.needsUpload=!1,this._featureMap=new gr,this._bufferOffset=0}populatePaintArrays(e,n,o,u){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,u);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,n,p,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Bf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Lo(i,e,n){const o={color:{source:si,composite:a},number:{source:yl,composite:si}},u=(function(p){return{"line-pattern":{source:ye,composite:ye},"fill-pattern":{source:ye,composite:ye},"fill-extrusion-pattern":{source:ye,composite:ye},"line-dasharray":{source:Te,composite:Te}}[p]})(i);return u&&u[n]||o[e][n]}Ot("ConstantBinder",Ba),Ot("CrossFadedConstantBinder",Na),Ot("SourceExpressionBinder",jn),Ot("CrossFadedPatternBinder",Ji),Ot("CrossFadedDasharrayBinder",gh),Ot("CompositeExpressionBinder",Wn),Ot("ProgramConfiguration",yh,{omit:["_buffers"]}),Ot("ProgramConfigurationSet",Ro);const _h=Math.pow(2,14)-1,ro=-_h-1;function ao(i){const e=vt/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let p=0;p<u.length;p++){const g=u[p],x=Math.round(g.x*e),T=Math.round(g.y*e);g.x=Zt(x,ro,_h),g.y=Zt(T,ro,_h),(x<g.x||x>g.x+1||T<g.y||T>g.y+1)&&Mn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function as(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ao(i):[]}}const vh=-32768;function _u(i,e,n,o,u){i.emplaceBack(vh+8*e+o,vh+8*n+u)}class vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new le,this.indexArray=new qe,this.segments=new Pt,this.programConfigurations=new Ro(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){const u=this.layers[0],p=[];let g=null,x=!1,T=u.type==="heatmap";if(u.type==="circle"){const I=u;g=I.layout.get("circle-sort-key"),x=!g.isConstant(),T=T||I.paint.get("circle-pitch-alignment")==="map"}const C=T?n.subdivisionGranularity.circle:1;for(const{feature:I,id:L,index:B,sourceLayerIndex:F}of e){const G=this.layers[0]._featureFilter.needGeometry,H=as(I,G);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),H,o))continue;const Y=x?g.evaluate(H,{},o):void 0,J={id:L,properties:I.properties,type:I.type,sourceLayerIndex:F,index:B,geometry:G?H.geometry:ao(I),patterns:{},sortKey:Y};p.push(J)}x&&p.sort(((I,L)=>I.sortKey-L.sortKey));for(const I of p){const{geometry:L,index:B,sourceLayerIndex:F}=I,G=e[B].feature;this.addFeature(I,L,B,o,C),n.featureIndex.insert(G,L,B,F,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ft),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,u,p=1){let g;switch(p){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const x=g.length;for(const T of n)for(const C of T){const I=C.x,L=C.y;if(I<0||I>=vt||L<0||L>=vt)continue;const B=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,e.sortKey),F=B.vertexLength;for(let G=0;G<x;G++)for(let H=0;H<x;H++)_u(this.layoutVertexArray,I,L,g[H],g[G]);for(let G=0;G<x-1;G++)for(let H=0;H<x-1;H++){const Y=F+G*x+H,J=F+(G+1)*x+H;this.indexArray.emplaceBack(Y,J+1,Y+1),this.indexArray.emplaceBack(Y,J,J+1)}B.vertexLength+=x*x,B.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function xu(i,e){for(let n=0;n<i.length;n++)if(Oo(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Oo(i,e[n]))return!0;return!!Mr(i,e)}function Nf(i,e,n){return!!Oo(i,e)||!!jf(e,i,n)}function Ff(i,e){if(i.length===1)return im(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let u=0;u<o.length;u++)if(Oo(i,o[u]))return!0}for(let n=0;n<i.length;n++)if(im(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Mr(i,e[n]))return!0;return!1}function yr(i,e,n){if(i.length>1){if(Mr(i,e))return!0;for(let o=0;o<e.length;o++)if(jf(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(jf(i[o],e,n))return!0;return!1}function Mr(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],u=i[n+1];for(let p=0;p<e.length-1;p++)if(mg(o,u,e[p],e[p+1]))return!0}return!1}function mg(i,e,n,o){return ci(i,n,o)!==ci(e,n,o)&&ci(i,e,n)!==ci(i,e,o)}function jf(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(nm(i,e[u-1],e[u])<o)return!0;return!1}function nm(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const u=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function im(i,e){let n,o,u,p=!1;for(let g=0;g<i.length;g++){n=i[g];for(let x=0,T=n.length-1;x<n.length;T=x++)o=n[x],u=n[T],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(p=!p)}return p}function Oo(i,e){let n=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const p=i[o],g=i[u];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(n=!n)}return n}function gg(i,e,n){const o=n[0],u=n[2];if(i.x<o.x&&e.x<o.x||i.x>u.x&&e.x>u.x||i.y<o.y&&e.y<o.y||i.y>u.y&&e.y>u.y)return!1;const p=ci(i,e,n[0]);return p!==ci(i,e,n[1])||p!==ci(i,e,n[2])||p!==ci(i,e,n[3])}function vl(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function yd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Uf(i,e,n,o,u){if(!e[0]&&!e[1])return i;const p=N.convert(e)._mult(u);n==="viewport"&&p._rotate(-o);const g=[];for(let x=0;x<i.length;x++)g.push(i[x].sub(p));return g}function Vf(i){const e=[];for(let n=0;n<i.length;n++){const o=i[n],u=e.at(-1);(n===0||u&&!o.equals(u))&&e.push(o)}return e}function rm({queryGeometry:i,size:e},n){return Nf(i,n,e)}function yg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){return Nf(i,p,e*(n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera/n.cameraToCenterDistance))}function _g({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){const g=n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera,x=e*(n.cameraToCenterDistance/g);return Nf(i,_d(p,n,o,u),x)}function vg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){return Nf(i,_d(p,n,o,u),e)}function qf({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u,pitchAlignment:p="map",pitchScale:g="map"},x){const T=p==="map"?g==="map"?rm:yg:g==="map"?_g:vg,C={queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u};for(const I of x)for(const L of I)if(T(C,L))return!0;return!1}function _d(i,e,n,o){const u=e.projectTileCoordinates(i.x,i.y,n,o).point;return new N((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let Gf,am;Ot("CircleBucket",vu,{omit:["layers"]});var sm={get paint(){return am=am||new Ni({"circle-radius":new Xt(Oe.paint_circle["circle-radius"]),"circle-color":new Xt(Oe.paint_circle["circle-color"]),"circle-blur":new Xt(Oe.paint_circle["circle-blur"]),"circle-opacity":new Xt(Oe.paint_circle["circle-opacity"]),"circle-translate":new Nt(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(Oe.paint_circle["circle-stroke-opacity"])})},get layout(){return Gf=Gf||new Ni({"circle-sort-key":new Xt(Oe.layout_circle["circle-sort-key"])})}};class Zf extends xi{constructor(e,n){super(e,sm,n)}createBucket(e){return new vu(e)}queryRadius(e){const n=e;return vl("circle-radius",this,n)+vl("circle-stroke-width",this,n)+yd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,unwrappedTileID:x,getElevation:T}){const C=Uf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,g),I=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),L=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let F,G;return B==="map"?(F=C,G=I*g):(F=(function(H,Y,J,de){return H.map((ee=>_d(ee,Y,J,de)))})(C,p,x,T),G=I),qf({queryGeometry:F,size:G,transform:p,unwrappedTileID:x,getElevation:T,pitchAlignment:B,pitchScale:L},u)}}class Hf extends vu{}let om;Ot("HeatmapBucket",Hf,{omit:["layers"]});var lm={get paint(){return om=om||new Ni({"heatmap-radius":new Xt(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fu(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(Oe.paint_heatmap["heatmap-opacity"])})}};function $f(i,{width:e,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*n*o}`)}else u=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=u,i}function Bo(i,{width:e,height:n},o){if(e===i.width&&n===i.height)return;const u=$f({},{width:e,height:n},o);vd(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},o),i.width=e,i.height=n,i.data=u.data}function vd(i,e,n,o,u,p){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,x=e.data;if(g===x)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<u.height;T++){const C=((n.y+T)*i.width+n.x)*p,I=((o.y+T)*e.width+o.x)*p;for(let L=0;L<u.width*p;L++)x[I+L]=g[C+L]}return e}class xd{constructor(e,n){$f(this,e,1,n)}resize(e){Bo(this,e,1)}clone(){return new xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,u,p){vd(e,n,o,u,p,1)}}class na{constructor(e,n){$f(this,e,4,n)}resize(e){Bo(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new na({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,u,p){vd(e,n,o,u,p,4)}setPixel(e,n,o){const u=4*(e*this.width+n);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function No(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new na({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(g,x,T)=>{e[i.evaluationKey]=T;const C=i.expression.evaluate(e);u.setPixel(g/4/n,x/4,C)};if(i.clips)for(let g=0,x=0;g<o;++g,x+=4*n)for(let T=0,C=0;T<n;T++,C+=4){const I=T/(n-1),{start:L,end:B}=i.clips[g];p(x,C,L*(1-I)+B*I)}else for(let g=0,x=0;g<n;g++,x+=4)p(0,x,g/(n-1));return u}Ot("AlphaImage",xd),Ot("RGBAImage",na);const bd="big-fb";class xg extends xi{createBucket(e){return new Hf(e)}constructor(e,n){super(e,lm,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=No({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(bd)&&this.heatmapFbos.delete(bd)}queryRadius(e){return vl("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,unwrappedTileID:x,getElevation:T}){return qf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,o)*g,transform:p,unwrappedTileID:x,getElevation:T},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let wd;var Td={get paint(){return wd=wd||new Ni({"hillshade-illumination-direction":new Nt(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Nt(Oe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Nt(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Nt(Oe.paint_hillshade["hillshade-method"])})}};class Pi extends xi{constructor(e,n){super(e,Td,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,n.length,o.length,u.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),n=n.concat(Array(p-n.length).fill(n.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),u=u.concat(Array(p-u.length).fill(u.at(-1)));const g=n.map(Li);return{directionRadians:e.map(Li),altitudeRadians:g,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let bg;var Jy={get paint(){return bg=bg||new Ni({"color-relief-opacity":new Nt(Oe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new fu(Oe["paint_color-relief"]["color-relief-color"])})}};class Xf{constructor(e,n,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,o){const{width:u,height:p}=e,g=!(this.size&&this.size[0]===u&&this.size[1]===p||o),{context:x}=this,{gl:T}=x;if(this.useMipmap=!!(n&&n.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),g)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Wi(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:C,y:I}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Wi(e)?T.texSubImage2D(T.TEXTURE_2D,0,C,I,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,C,I,u,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||e),this.filter=e),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class xh{constructor(e,n,o,u=1,p=1,g=1,x=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Mn(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=g,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<T;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(T,C)]=this.data[this._idx(T-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,T)]=this.data[this._idx(C,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<T;C++)for(let I=0;I<T;I++){const L=this.get(C,I);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(e,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return xl(e,this.getUnpackVector())}getPixels(){return new na({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,p=n*this.dim+this.dim,g=o*this.dim,x=o*this.dim+this.dim;switch(n){case-1:u=p-1;break;case 1:p=u+1}switch(o){case-1:g=x-1;break;case 1:x=g+1}const T=-n*this.dim,C=-o*this.dim;for(let I=g;I<x;I++)for(let L=u;L<p;L++)this.data[this._idx(L,I)]=e.data[this._idx(L+T,I+C)]}}function xl(i,e){const n=e[0],o=e[1],u=e[2],p=e[3],g=Math.min(n,o,u),x=Math.round((i+p)/g);return{r:Math.floor(x*g/n)%256,g:Math.floor(x*g/o)%256,b:Math.floor(x*g/u)%256}}Ot("DEMData",xh);class wg extends xi{constructor(e,n){super(e,Jy,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Gr&&o._styleExpression.expression instanceof Vr){this.colorRampExpression=o;const g=o._styleExpression.expression;n.elevationStops=g.labels,n.colorStops=[];for(const x of n.elevationStops)n.colorStops.push(g.evaluate({globals:{elevation:x}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[hn.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const u={elevationStops:[],colorStops:[]},p=(n.elevationStops.length-1)/(e-1);for(let g=0;g<n.elevationStops.length-.5;g+=p)u.elevationStops.push(n.elevationStops[Math.round(g)]),u.colorStops.push(n.colorStops[Math.round(g)]);return Mn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),p=new na({width:u.colorStops.length,height:1}),g=new na({width:u.colorStops.length,height:1});for(let x=0;x<u.elevationStops.length;x++){const T=xl(u.elevationStops[x],o);g.setPixel(0,x,new hn(T.r/255,T.g/255,T.b/255,1)),p.setPixel(0,x,u.colorStops[x])}return this.colorRampTextures={elevationTexture:new Xf(e,g,e.gl.RGBA),colorTexture:new Xf(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const Tg=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sd}=Tg;function ss(i,e,n){const o=n.patternDependencies;let u=!1;for(const p of e){const g=p.paint.get(`${i}-pattern`);g.isConstant()||(u=!0);const x=g.constantOr(null);x&&(u=!0,o[x.to]=!0,o[x.from]=!0)}return u}function Yf(i,e,n,o,u){const{zoom:p}=o,g=u.patternDependencies;for(const x of e){const T=x.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:p-1},n,{},u.availableImages),I=T.evaluate({zoom:p},n,{},u.availableImages),L=T.evaluate({zoom:p+1},n,{},u.availableImages);C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,g[C]=!0,g[I]=!0,g[L]=!0,n.patterns[x.id]={min:C,mid:I,max:L}}}return n}function Wf(i,e,n,o,u){let p;if(u===(function(g,x,T,C){let I=0;for(let L=x,B=T-C;L<T;L+=C)I+=(g[B]-g[L])*(g[L+1]+g[B+1]),B=L;return I})(i,e,n,o)>0)for(let g=e;g<n;g+=o)p=xa(g/o|0,i[g],i[g+1],p);else for(let g=n-o;g>=e;g-=o)p=xa(g/o|0,i[g],i[g+1],p);return p&&Fa(p,p.next)&&(ba(p),p=p.next),p}function hc(i,e){if(!i)return i;e||(e=i);let n,o=i;do if(n=!1,o.steiner||!Fa(o,o.next)&&zn(o.prev,o,o.next)!==0)o=o.next;else{if(ba(o),o=e=o.prev,o===o.next)break;n=!0}while(n||o!==e);return e}function bu(i,e,n,o,u,p,g){if(!i)return;!g&&p&&(function(T,C,I,L){let B=T;do B.z===0&&(B.z=vr(B.x,B.y,C,I,L)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==T);B.prevZ.nextZ=null,B.prevZ=null,(function(F){let G,H=1;do{let Y,J=F;F=null;let de=null;for(G=0;J;){G++;let ee=J,ae=0;for(let ve=0;ve<H&&(ae++,ee=ee.nextZ,ee);ve++);let me=H;for(;ae>0||me>0&&ee;)ae!==0&&(me===0||!ee||J.z<=ee.z)?(Y=J,J=J.nextZ,ae--):(Y=ee,ee=ee.nextZ,me--),de?de.nextZ=Y:F=Y,Y.prevZ=de,de=Y;J=ee}de.nextZ=null,H*=2}while(G>1)})(B)})(i,o,u,p);let x=i;for(;i.prev!==i.next;){const T=i.prev,C=i.next;if(p?Kf(i,o,u,p):cm(i))e.push(T.i,i.i,C.i),ba(i),i=C.next,x=C.next;else if((i=C)===x){g?g===1?bu(i=Sg(hc(i),e),e,n,o,u,p,2):g===2&&bl(i,e,n,o,u,p):bu(hc(i),e,n,o,u,p,1);break}}}function cm(i){const e=i.prev,n=i,o=i.next;if(zn(e,n,o)>=0)return!1;const u=e.x,p=n.x,g=o.x,x=e.y,T=n.y,C=o.y,I=Math.min(u,p,g),L=Math.min(x,T,C),B=Math.max(u,p,g),F=Math.max(x,T,C);let G=o.next;for(;G!==e;){if(G.x>=I&&G.x<=B&&G.y>=L&&G.y<=F&&bh(u,x,p,T,g,C,G.x,G.y)&&zn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function Kf(i,e,n,o){const u=i.prev,p=i,g=i.next;if(zn(u,p,g)>=0)return!1;const x=u.x,T=p.x,C=g.x,I=u.y,L=p.y,B=g.y,F=Math.min(x,T,C),G=Math.min(I,L,B),H=Math.max(x,T,C),Y=Math.max(I,L,B),J=vr(F,G,e,n,o),de=vr(H,Y,e,n,o);let ee=i.prevZ,ae=i.nextZ;for(;ee&&ee.z>=J&&ae&&ae.z<=de;){if(ee.x>=F&&ee.x<=H&&ee.y>=G&&ee.y<=Y&&ee!==u&&ee!==g&&bh(x,I,T,L,C,B,ee.x,ee.y)&&zn(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ae.x>=F&&ae.x<=H&&ae.y>=G&&ae.y<=Y&&ae!==u&&ae!==g&&bh(x,I,T,L,C,B,ae.x,ae.y)&&zn(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ee&&ee.z>=J;){if(ee.x>=F&&ee.x<=H&&ee.y>=G&&ee.y<=Y&&ee!==u&&ee!==g&&bh(x,I,T,L,C,B,ee.x,ee.y)&&zn(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ae&&ae.z<=de;){if(ae.x>=F&&ae.x<=H&&ae.y>=G&&ae.y<=Y&&ae!==u&&ae!==g&&bh(x,I,T,L,C,B,ae.x,ae.y)&&zn(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function Sg(i,e){let n=i;do{const o=n.prev,u=n.next.next;!Fa(o,u)&&dm(o,n,n.next,u)&&Ad(o,u)&&Ad(u,o)&&(e.push(o.i,n.i,u.i),ba(n),ba(n.next),n=i=u),n=n.next}while(n!==i);return hc(n)}function bl(i,e,n,o,u,p){let g=i;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&Fi(g,x)){let T=Cd(g,x);return g=hc(g,g.next),T=hc(T,T.next),bu(g,e,n,o,u,p,0),void bu(T,e,n,o,u,p,0)}x=x.next}g=g.next}while(g!==i)}function _r(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function um(i,e){const n=(function(u,p){let g=p;const x=u.x,T=u.y;let C,I=-1/0;if(Fa(u,g))return g;do{if(Fa(u,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){const H=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(H<=x&&H>I&&(I=H,C=g.x<g.next.x?g:g.next,H===x))return C}g=g.next}while(g!==p);if(!C)return null;const L=C,B=C.x,F=C.y;let G=1/0;g=C;do{if(x>=g.x&&g.x>=B&&x!==g.x&&hm(T<F?x:I,T,B,F,T<F?I:x,T,g.x,g.y)){const H=Math.abs(T-g.y)/(x-g.x);Ad(g,u)&&(H<G||H===G&&(g.x>C.x||g.x===C.x&&Eg(C,g)))&&(C=g,G=H)}g=g.next}while(g!==L);return C})(i,e);if(!n)return e;const o=Cd(n,i);return hc(o,o.next),hc(n,n.next)}function Eg(i,e){return zn(i.prev,i,e.prev)<0&&zn(e.next,i,i.next)<0}function vr(i,e,n,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function e_(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function hm(i,e,n,o,u,p,g,x){return(u-g)*(e-x)>=(i-g)*(p-x)&&(i-g)*(o-x)>=(n-g)*(e-x)&&(n-g)*(p-x)>=(u-g)*(o-x)}function bh(i,e,n,o,u,p,g,x){return!(i===g&&e===x)&&hm(i,e,n,o,u,p,g,x)}function Fi(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&dm(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1})(i,e)&&(Ad(i,e)&&Ad(e,i)&&(function(n,o){let u=n,p=!1;const g=(n.x+o.x)/2,x=(n.y+o.y)/2;do u.y>x!=u.next.y>x&&u.next.y!==u.y&&g<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==n);return p})(i,e)&&(zn(i.prev,i,e.prev)||zn(i,e.prev,e))||Fa(i,e)&&zn(i.prev,i,i.next)>0&&zn(e.prev,e,e.next)>0)}function zn(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Fa(i,e){return i.x===e.x&&i.y===e.y}function dm(i,e,n,o){const u=Md(zn(i,e,n)),p=Md(zn(i,e,o)),g=Md(zn(n,o,i)),x=Md(zn(n,o,e));return u!==p&&g!==x||!(u!==0||!Ed(i,n,e))||!(p!==0||!Ed(i,o,e))||!(g!==0||!Ed(n,i,o))||!(x!==0||!Ed(n,e,o))}function Ed(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Md(i){return i>0?1:i<0?-1:0}function Ad(i,e){return zn(i.prev,i,i.next)<0?zn(i,e,i.next)>=0&&zn(i,i.prev,e)>=0:zn(i,e,i.prev)<0||zn(i,i.next,e)<0}function Cd(i,e){const n=Qf(i.i,i.x,i.y),o=Qf(e.i,e.x,e.y),u=i.next,p=e.prev;return i.next=e,e.prev=i,n.next=u,u.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function xa(i,e,n,o){const u=Qf(i,e,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function ba(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Qf(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ar{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class zd{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}zd.noSubdivision=new zd({fill:new Ar(0,0),line:new Ar(0,0),tile:new Ar(0,0),stencil:new Ar(0,0),circle:1}),Ot("SubdivisionGranularityExpression",Ar),Ot("SubdivisionGranularitySetting",zd);const ja=-32768,so=32767;class wl{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=vt/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(n),p=this._getKey(o,u);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,g),this._vertexBuffer.push(o,u),g}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,p){const g=[];for(let x=0;x<p.length;x+=3){const T=p[x],C=p[x+1],I=p[x+2],L=u[2*T],B=u[2*T+1];(u[2*C]-L)*(u[2*I+1]-B)-(u[2*C+1]-B)*(u[2*I]-L)>0?(g.push(T),g.push(I),g.push(C)):(g.push(T),g.push(C),g.push(I))}return g})(this._vertexBuffer,e);const n=[],o=e.length;for(let u=0;u<o;u+=3){const p=[e[u+0],e[u+1],e[u+2]],g=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let x=1/0,T=1/0,C=-1/0,I=-1/0;for(let H=0;H<3;H++){const Y=g[2*H],J=g[2*H+1];x=Math.min(x,Y),C=Math.max(C,Y),T=Math.min(T,J),I=Math.max(I,J)}if(x===C||T===I)continue;const L=Math.floor(x/this._granularityCellSize),B=Math.ceil(C/this._granularityCellSize),F=Math.floor(T/this._granularityCellSize),G=Math.ceil(I/this._granularityCellSize);if(L!==B||F!==G)for(let H=F;H<G;H++){const Y=this._scanlineGenerateVertexRingForCellRow(H,g,p);oo(this._vertexBuffer,Y,n)}else n.push(...p)}return n}_scanlineGenerateVertexRingForCellRow(e,n,o){const u=e*this._granularityCellSize,p=u+this._granularityCellSize,g=[];for(let x=0;x<3;x++){const T=n[2*x],C=n[2*x+1],I=n[2*(x+1)%6],L=n[(2*(x+1)+1)%6],B=n[2*(x+2)%6],F=n[(2*(x+2)+1)%6],G=I-T,H=L-C,Y=G===0,J=H===0,de=(u-C)/H,ee=(p-C)/H,ae=Math.min(de,ee),me=Math.max(de,ee);if(!J&&(ae>=1||me<=0)||J&&(C<u||C>p)){L>=u&&L<=p&&g.push(o[(x+1)%3]);continue}!J&&ae>0&&g.push(this._vertexToIndex(T+G*ae,C+H*ae));const ve=T+G*Math.max(ae,0),Ue=T+G*Math.min(me,1);Y||this._generateIntraEdgeVertices(g,T,C,I,L,ve,Ue),!J&&me<1&&g.push(this._vertexToIndex(T+G*me,C+H*me)),(J||L>=u&&L<=p)&&g.push(o[(x+1)%3]),!J&&(L<=u||L>=p)&&this._generateInterEdgeVertices(g,T,C,I,L,B,F,Ue,u,p)}return g}_generateIntraEdgeVertices(e,n,o,u,p,g,x){const T=u-n,C=p-o,I=C===0,L=I?Math.min(n,u):Math.min(g,x),B=I?Math.max(n,u):Math.max(g,x),F=Math.floor(L/this._granularityCellSize)+1,G=Math.ceil(B/this._granularityCellSize)-1;if(I?n<u:g<x)for(let H=F;H<=G;H++){const Y=H*this._granularityCellSize;e.push(this._vertexToIndex(Y,o+C*(Y-n)/T))}else for(let H=G;H>=F;H--){const Y=H*this._granularityCellSize;e.push(this._vertexToIndex(Y,o+C*(Y-n)/T))}}_generateInterEdgeVertices(e,n,o,u,p,g,x,T,C,I){const L=p-o,B=g-u,F=x-p,G=(C-p)/F,H=(I-p)/F,Y=Math.min(G,H),J=Math.max(G,H),de=u+B*Y;let ee=Math.floor(Math.min(de,T)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(de,T)/this._granularityCellSize)-1,me=T<de;const ve=F===0;if(ve&&(x===C||x===I))return;if(ve||Y>=1||J<=0){const ot=o-x,et=g+(n-g)*Math.min((C-x)/ot,(I-x)/ot);ee=Math.floor(Math.min(et,T)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(et,T)/this._granularityCellSize)-1,me=T<et}const Ue=L>0?I:C;if(me)for(let ot=ee;ot<=ae;ot++)e.push(this._vertexToIndex(ot*this._granularityCellSize,Ue));else for(let ot=ae;ot>=ee;ot--)e.push(this._vertexToIndex(ot*this._granularityCellSize,Ue))}_generateOutline(e){const n=[];for(const o of e){const u=Tl(o,this._granularity,!0),p=this._pointArrayToIndices(u),g=[];for(let x=1;x<p.length;x++)g.push(p[x-1]),g.push(p[x]);n.push(g)}return n}_handlePoles(e){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(e,n,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const o=e[n+1];o===ja&&(e[n+1]=-32767),o===so&&(e[n+1]=32766)}}_generatePoleQuad(e,n,o,u,p,g){u>p!=(g===ja)?(e.push(n),e.push(o),e.push(this._vertexToIndex(u,g)),e.push(o),e.push(this._vertexToIndex(p,g)),e.push(this._vertexToIndex(u,g))):(e.push(o),e.push(n),e.push(this._vertexToIndex(u,g)),e.push(this._vertexToIndex(p,g)),e.push(o),e.push(this._vertexToIndex(u,g)))}_fillPoles(e,n,o){const u=this._vertexBuffer,p=vt,g=e.length;for(let x=2;x<g;x+=3){const T=e[x-2],C=e[x-1],I=e[x],L=u[2*T],B=u[2*T+1],F=u[2*C],G=u[2*C+1],H=u[2*I],Y=u[2*I+1];n&&(B===0&&G===0&&this._generatePoleQuad(e,T,C,L,F,ja),G===0&&Y===0&&this._generatePoleQuad(e,C,I,F,H,ja),Y===0&&B===0&&this._generatePoleQuad(e,I,T,H,L,ja)),o&&(B===p&&G===p&&this._generatePoleQuad(e,T,C,L,F,so),G===p&&Y===p&&this._generatePoleQuad(e,C,I,F,H,so),Y===p&&B===p&&this._generatePoleQuad(e,I,T,H,L,so))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(x){const T=[],C=[];for(const I of x)if(I.length!==0){I!==x[0]&&T.push(C.length/2);for(let L=0;L<I.length;L++)C.push(I[L].x),C.push(I[L].y)}return{flattened:C,holeIndices:T}})(e);let p;this._initializeVertices(o);try{const x=(function(C,I,L=2){const B=I&&I.length,F=B?I[0]*L:C.length;let G=Wf(C,0,F,L,!0);const H=[];if(!G||G.next===G.prev)return H;let Y,J,de;if(B&&(G=(function(ee,ae,me,ve){const Ue=[];for(let ot=0,et=ae.length;ot<et;ot++){const pt=Wf(ee,ae[ot]*ve,ot<et-1?ae[ot+1]*ve:ee.length,ve,!1);pt===pt.next&&(pt.steiner=!0),Ue.push(e_(pt))}Ue.sort(_r);for(let ot=0;ot<Ue.length;ot++)me=um(Ue[ot],me);return me})(C,I,G,L)),C.length>80*L){Y=C[0],J=C[1];let ee=Y,ae=J;for(let me=L;me<F;me+=L){const ve=C[me],Ue=C[me+1];ve<Y&&(Y=ve),Ue<J&&(J=Ue),ve>ee&&(ee=ve),Ue>ae&&(ae=Ue)}de=Math.max(ee-Y,ae-J),de=de!==0?32767/de:0}return bu(G,H,L,Y,J,de,0),H})(o,u),T=this._convertIndices(o,x);p=this._subdivideTrianglesScanline(T)}catch(x){console.error(x)}let g=[];return n&&(g=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:g}}_convertIndices(e,n){const o=[];for(let u=0;u<n.length;u++)o.push(this._vertexToIndex(e[2*n[u]],e[2*n[u]+1]));return o}_pointArrayToIndices(e){const n=[];for(let o=0;o<e.length;o++){const u=e[o];n.push(this._vertexToIndex(u.x,u.y))}return n}}function Jf(i,e,n,o=!0){return new wl(n,e).subdividePolygonInternal(i,o)}function Tl(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const o=i[0],u=i[i.length-1],p=n&&(o.x!==u.x||o.y!==u.y);if(e<2)return p?[...i,i[0]]:[...i];const g=Math.floor(vt/e),x=[];x.push(new N(i[0].x,i[0].y));const T=i.length,C=p?T:T-1;for(let I=0;I<C;I++){const L=i[I],B=I<T-1?i[I+1]:i[0],F=L.x,G=L.y,H=B.x,Y=B.y,J=F!==H,de=G!==Y;if(!J&&!de)continue;const ee=H-F,ae=Y-G,me=Math.abs(ee),ve=Math.abs(ae);let Ue=F,ot=G;for(;;){const pt=ee>0?(Math.floor(Ue/g)+1)*g:(Math.ceil(Ue/g)-1)*g,Dt=ae>0?(Math.floor(ot/g)+1)*g:(Math.ceil(ot/g)-1)*g,yt=Math.abs(Ue-pt),rt=Math.abs(ot-Dt),He=Math.abs(Ue-H),jt=Math.abs(ot-Y),Bt=J?yt/me:Number.POSITIVE_INFINITY,Gt=de?rt/ve:Number.POSITIVE_INFINITY;if((He<=yt||!J)&&(jt<=rt||!de))break;if(Bt<Gt&&J||!de){Ue=pt,ot+=ae*Bt;const Lt=new N(Ue,Math.round(ot));x[x.length-1].x===Lt.x&&x[x.length-1].y===Lt.y||x.push(Lt)}else{Ue+=ee*Gt,ot=Dt;const Lt=new N(Math.round(Ue),ot);x[x.length-1].x===Lt.x&&x[x.length-1].y===Lt.y||x.push(Lt)}}const et=new N(H,Y);x[x.length-1].x===et.x&&x[x.length-1].y===et.y||x.push(et)}return x}function oo(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=i[2*e[0]];for(let T=1;T<e.length;T++){const C=i[2*e[T]];C<u&&(u=C,o=T)}const p=e.length;let g=o,x=(g+1)%p;for(;;){const T=g-1>=0?g-1:p-1,C=(x+1)%p,I=i[2*e[T]],L=i[2*e[C]],B=i[2*e[g]],F=i[2*e[g]+1],G=i[2*e[x]+1];let H=!1;if(I<L)H=!0;else if(I>L)H=!1;else{const Y=G-F,J=-(i[2*e[x]]-B),de=F<G?1:-1;((I-B)*Y+(i[2*e[T]+1]-F)*J)*de>((L-B)*Y+(i[2*e[C]+1]-F)*J)*de&&(H=!0)}if(H){const Y=e[T],J=e[g],de=e[x];Y!==J&&Y!==de&&J!==de&&n.push(de,J,Y),g--,g<0&&(g=p-1)}else{const Y=e[C],J=e[g],de=e[x];Y!==J&&Y!==de&&J!==de&&n.push(de,J,Y),x++,x>=p&&(x=0)}if(T===C)break}}function fm(i,e,n,o,u,p,g,x,T){const C=u.length/2,I=g&&x&&T;if(C<Pt.MAX_VERTEX_ARRAY_LENGTH){const L=e.prepareSegment(C,n,o),B=L.vertexLength;for(let H=0;H<p.length;H+=3)o.emplaceBack(B+p[H],B+p[H+1],B+p[H+2]);let F,G;L.vertexLength+=C,L.primitiveLength+=p.length/3,I&&(G=g.prepareSegment(C,n,x),F=G.vertexLength,G.vertexLength+=C);for(let H=0;H<u.length;H+=2)i(u[H],u[H+1]);if(I)for(let H=0;H<T.length;H++){const Y=T[H];for(let J=1;J<Y.length;J+=2)x.emplaceBack(F+Y[J-1],F+Y[J]);G.primitiveLength+=Y.length/2}}else(function(L,B,F,G,H,Y){const J=[];for(let ve=0;ve<G.length/2;ve++)J.push(-1);const de={count:0};let ee=0,ae=L.getOrCreateLatestSegment(B,F),me=ae.vertexLength;for(let ve=2;ve<H.length;ve+=3){const Ue=H[ve-2],ot=H[ve-1],et=H[ve];let pt=J[Ue]<ee,Dt=J[ot]<ee,yt=J[et]<ee;ae.vertexLength+((pt?1:0)+(Dt?1:0)+(yt?1:0))>Pt.MAX_VERTEX_ARRAY_LENGTH&&(ae=L.createNewSegment(B,F),ee=de.count,pt=!0,Dt=!0,yt=!0,me=0);const rt=Fo(J,G,Y,de,Ue,pt,ae),He=Fo(J,G,Y,de,ot,Dt,ae),jt=Fo(J,G,Y,de,et,yt,ae);F.emplaceBack(me+rt-ee,me+He-ee,me+jt-ee),ae.primitiveLength++}})(e,n,o,u,p,i),I&&(function(L,B,F,G,H,Y){const J=[];for(let ve=0;ve<G.length/2;ve++)J.push(-1);const de={count:0};let ee=0,ae=L.getOrCreateLatestSegment(B,F),me=ae.vertexLength;for(let ve=0;ve<H.length;ve++){const Ue=H[ve];for(let ot=1;ot<H[ve].length;ot+=2){const et=Ue[ot-1],pt=Ue[ot];let Dt=J[et]<ee,yt=J[pt]<ee;ae.vertexLength+((Dt?1:0)+(yt?1:0))>Pt.MAX_VERTEX_ARRAY_LENGTH&&(ae=L.createNewSegment(B,F),ee=de.count,Dt=!0,yt=!0,me=0);const rt=Fo(J,G,Y,de,et,Dt,ae),He=Fo(J,G,Y,de,pt,yt,ae);F.emplaceBack(me+rt-ee,me+He-ee),ae.primitiveLength++}}})(g,n,x,u,T,i),e.forceNewSegmentOnNextPrepare(),g?.forceNewSegmentOnNextPrepare()}function Fo(i,e,n,o,u,p,g){if(p){const x=o.count;return n(e[2*u],e[2*u+1]),i[u]=o.count,o.count++,g.vertexLength++,x}return i[u]}class wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new oe,this.indexArray=new qe,this.indexArray2=new St,this.programConfigurations=new Ro(e.layers,e.zoom),this.segments=new Pt,this.segments2=new Pt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.hasDependencies=ss("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),g=[];for(const{feature:x,id:T,index:C,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,B=as(x,L);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),B,o))continue;const F=p?u.evaluate(B,{},o,n.availableImages):void 0,G={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:C,geometry:L?B.geometry:ao(x),patterns:{},sortKey:F};g.push(G)}p&&g.sort(((x,T)=>x.sortKey-T.sortKey));for(const x of g){const{geometry:T,index:C,sourceLayerIndex:I}=x;if(this.hasDependencies){const L=Yf("fill",this.layers,x,{zoom:this.zoom},n);this.patternFeatures.push(L)}else this.addFeature(x,T,C,o,{},n.subdivisionGranularity);n.featureIndex.insert(e[C].feature,T,C,I,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,u,p,g){for(const x of Xc(n,500)){const T=Jf(x,u,g.fill.getGranularityForZoomLevel(u.z)),C=this.layoutVertexArray;fm(((I,L)=>{C.emplaceBack(I,L)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:u})}}let wh,Tu;Ot("FillBucket",wu,{omit:["layers","patternFeatures"]});var Mg={get paint(){return Tu=Tu||new Ni({"fill-antialias":new Nt(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Xt(Oe.paint_fill["fill-opacity"]),"fill-color":new Xt(Oe.paint_fill["fill-color"]),"fill-outline-color":new Xt(Oe.paint_fill["fill-outline-color"]),"fill-translate":new Nt(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new La(Oe.paint_fill["fill-pattern"])})},get layout(){return wh=wh||new Ni({"fill-sort-key":new Xt(Oe.layout_fill["fill-sort-key"])})}};class Ag extends xi{constructor(e,n){super(e,Mg,n)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new wu(e)}queryRadius(){return yd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:o,pixelsToTileUnits:u}){return Ff(Uf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),n)}isTileClipped(){return!0}}const Pd=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Cg=mi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ep}=Pd;class Th{constructor(e,n,o,u,p){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=p,e.readFields(t_,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,o=[];let u,p=1,g=0,x=0,T=0;for(;e.pos<n;){if(g<=0){const C=e.readVarint();p=7&C,g=C>>3}if(g--,p===1||p===2)x+=e.readSVarint(),T+=e.readSVarint(),p===1&&(u&&o.push(u),u=[]),u&&u.push(new N(x,T));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let o=1,u=0,p=0,g=0,x=1/0,T=-1/0,C=1/0,I=-1/0;for(;e.pos<n;){if(u<=0){const L=e.readVarint();o=7&L,u=L>>3}if(u--,o===1||o===2)p+=e.readSVarint(),g+=e.readSVarint(),p<x&&(x=p),p>T&&(T=p),g<C&&(C=g),g>I&&(I=g);else if(o!==7)throw new Error(`unknown command ${o}`)}return[x,C,T,I]}toGeoJSON(e,n,o){const u=this.extent*Math.pow(2,o),p=this.extent*e,g=this.extent*n,x=this.loadGeometry();function T(B){return[360*(B.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+g)/u)*Math.PI))-90]}function C(B){return B.map(T)}let I;if(this.type===1){const B=[];for(const G of x)B.push(G[0]);const F=C(B);I=B.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const B=x.map(C);I=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=zg(x),F=[];for(const G of B)F.push(G.map(C));I=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const L={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(L.id=this.id),L}}function t_(i,e,n){i===1?e.id=n.readVarint():i===2?(function(o,u){const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=u._keys[o.readVarint()],x=u._values[o.readVarint()];u.properties[g]=x}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function zg(i){const e=i.length;if(e<=1)return[i];const n=[];let o,u;for(let p=0;p<e;p++){const g=Kn(i[p]);g!==0&&(u===void 0&&(u=g<0),u===g<0?(o&&n.push(o),o=[i[p]]):o&&o.push(i[p]))}return o&&n.push(o),n}function Kn(i){let e=0;for(let n,o,u=0,p=i.length,g=p-1;u<p;g=u++)n=i[u],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}Th.types=["Unknown","Point","LineString","Polygon"];class yi{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Tn,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Th(this._pbf,n,this.extent,this._keys,this._values)}}function Tn(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(o){let u=null;const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=o.readVarint()>>3;u=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(n))}class Sn{constructor(e,n){this.layers=e.readFields(ii,{},n)}}function ii(i,e,n){if(i===3){const o=new yi(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}const wa=Math.pow(2,13);function Os(i,e,n,o,u,p,g,x){i.emplaceBack(e,n,2*Math.floor(o*wa)+g,u*wa*2,p*wa*2,Math.round(x))}class dc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new he,this.centroidVertexArray=new se,this.indexArray=new qe,this.programConfigurations=new Ro(e.layers,e.zoom),this.segments=new Pt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.features=[],this.hasDependencies=ss("fill-extrusion",this.layers,n);for(const{feature:u,id:p,index:g,sourceLayerIndex:x}of e){const T=this.layers[0]._featureFilter.needGeometry,C=as(u,T);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),C,o))continue;const I={id:p,sourceLayerIndex:x,index:g,geometry:T?C.geometry:ao(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Yf("fill-extrusion",this.layers,I,{zoom:this.zoom},n)):this.addFeature(I,I.geometry,g,o,{},n.subdivisionGranularity),n.featureIndex.insert(u,I.geometry,g,x,this.index,!0)}}addFeatures(e,n,o){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,n,o,e.subdivisionGranularity)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ep),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Cg.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,u,p,g){for(const x of Xc(n,500)){const T={x:0,y:0,sampleCount:0},C=this.layoutVertexArray.length;this.processPolygon(T,u,e,x,g);const I=this.layoutVertexArray.length-C,L=Math.floor(T.x/T.sampleCount),B=Math.floor(T.y/T.sampleCount);for(let F=0;F<I;F++)this.centroidVertexArray.emplaceBack(L,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:u})}processPolygon(e,n,o,u,p){if(u.length<1||Hi(u[0]))return;for(const L of u)L.length!==0&&pm(e,L);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=p.fill.getGranularityForZoomLevel(n.z),T=Th.types[o.type]==="Polygon";for(const L of u){if(L.length===0||Hi(L))continue;const B=Tl(L,x,T);this._generateSideFaces(B,g)}if(!T)return;const C=Jf(u,n,x,!1),I=this.layoutVertexArray;fm(((L,B)=>{Os(I,L,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles)}_generateSideFaces(e,n){let o=0;for(let u=1;u<e.length;u++){const p=e[u],g=e[u-1];if(Sl(p,g))continue;n.segment.vertexLength+4>Pt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=p.sub(g)._perp()._unit(),T=g.dist(p);o+T>32768&&(o=0),Os(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,0,o),Os(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,1,o),o+=T,Os(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,0,o),Os(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,1,o);const C=n.segment.vertexLength;this.indexArray.emplaceBack(C,C+2,C+1),this.indexArray.emplaceBack(C+1,C+2,C+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function pm(i,e){for(let n=0;n<e.length;n++){const o=e[n];n===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(i.x+=o.x,i.y+=o.y,i.sampleCount++)}}function Sl(i,e){return i.x===e.x&&(i.x<0||i.x>vt)||i.y===e.y&&(i.y<0||i.y>vt)}function Hi(i){return i.every((e=>e.x<0))||i.every((e=>e.x>vt))||i.every((e=>e.y<0))||i.every((e=>e.y>vt))}let El;Ot("FillExtrusionBucket",dc,{omit:["layers","features"]});var Su={get paint(){return El=El||new Ni({"fill-extrusion-opacity":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new La(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Xt(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mm extends xi{constructor(e,n){super(e,Su,n)}createBucket(e){return new dc(e)}queryRadius(){return yd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,pixelPosMatrix:x}){const T=Uf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,g),C=this.paint.get("fill-extrusion-height").evaluate(n,o),I=this.paint.get("fill-extrusion-base").evaluate(n,o),L=(function(F,G){const H=[];for(const Y of F){const J=[Y.x,Y.y,0,1];$t(J,J,G),H.push(new N(J[0]/J[3],J[1]/J[3]))}return H})(T,x),B=(function(F,G,H,Y){const J=[],de=[],ee=Y[8]*G,ae=Y[9]*G,me=Y[10]*G,ve=Y[11]*G,Ue=Y[8]*H,ot=Y[9]*H,et=Y[10]*H,pt=Y[11]*H;for(const Dt of F){const yt=[],rt=[];for(const He of Dt){const jt=He.x,Bt=He.y,Gt=Y[0]*jt+Y[4]*Bt+Y[12],Lt=Y[1]*jt+Y[5]*Bt+Y[13],Kt=Y[2]*jt+Y[6]*Bt+Y[14],Pn=Y[3]*jt+Y[7]*Bt+Y[15],_n=Kt+me,Di=Pn+ve,sa=Gt+Ue,Tr=Lt+ot,Ii=Kt+et,wi=Pn+pt,Hn=new N((Gt+ee)/Di,(Lt+ae)/Di);Hn.z=_n/Di,yt.push(Hn);const $i=new N(sa/wi,Tr/wi);$i.z=Ii/wi,rt.push($i)}J.push(yt),de.push(rt)}return[J,de]})(u,I,C,x);return(function(F,G,H){let Y=1/0;Ff(H,G)&&(Y=Eu(H,G[0]));for(let J=0;J<G.length;J++){const de=G[J],ee=F[J];for(let ae=0;ae<de.length-1;ae++){const me=de[ae],ve=[me,de[ae+1],ee[ae+1],ee[ae],me];xu(H,ve)&&(Y=Math.min(Y,Eu(H,ve)))}}return Y!==1/0&&Y})(B[0],B[1],L)}}function Zr(i,e){return i.x*e.x+i.y*e.y}function Eu(i,e){if(i.length===1){let n=0;const o=e[n++];let u;for(;!u||o.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const p=e[n],g=i[0],x=u.sub(o),T=p.sub(o),C=g.sub(o),I=Zr(x,x),L=Zr(x,T),B=Zr(T,T),F=Zr(C,x),G=Zr(C,T),H=I*B-L*L,Y=(B*F-L*G)/H,J=(I*G-L*F)/H,de=o.z*(1-Y-J)+u.z*Y+p.z*J;if(isFinite(de))return de}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const Dd=mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ua}=Dd,gm=mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tp}=gm,Pg=Math.cos(Math.PI/180*37.5),Id=Math.pow(2,14)/.5;class Sh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new _e,this.layoutVertexArray2=new ce,this.indexArray=new qe,this.programConfigurations=new Ro(e.layers,e.zoom),this.segments=new Pt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.hasDependencies=ss("line",this.layers,n)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),g=[];for(const{feature:x,id:T,index:C,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,B=as(x,L);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),B,o))continue;const F=p?u.evaluate(B,{},o):void 0,G={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:C,geometry:L?B.geometry:ao(x),patterns:{},dashes:{},sortKey:F};g.push(G)}p&&g.sort(((x,T)=>x.sortKey-T.sortKey));for(const x of g){const{geometry:T,index:C,sourceLayerIndex:I}=x;this.hasDependencies?(ss("line",this.layers,n)?Yf("line",this.layers,x,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,x,this.zoom,n),this.patternFeatures.push(x)):this.addFeature(x,T,C,o,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[C].feature,T,C,I,this.index)}}update(e,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,n,o,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,tp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ua),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,u,p,g,x){const T=this.layers[0].layout,C=T.get("line-join").evaluate(e,{}),I=T.get("line-cap"),L=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of n)this.addLine(F,e,C,I,L,B,u,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,dashPositions:g,canonical:u})}addLine(e,n,o,u,p,g,x,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Tl(e,x?T.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=Th.types[n.type]==="Polygon";let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let L=0;for(;L<I-1&&e[L].equals(e[L+1]);)L++;if(I<(C?3:2))return;o==="bevel"&&(p=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let G,H,Y,J,de;this.e1=this.e2=-1,C&&(G=e[I-2],de=e[L].sub(G)._unit()._perp());for(let ee=L;ee<I;ee++){if(Y=ee===I-1?C?e[L+1]:void 0:e[ee+1],Y&&e[ee].equals(Y))continue;de&&(J=de),G&&(H=G),G=e[ee],de=Y?Y.sub(G)._unit()._perp():J,J=J||de;let ae=J.add(de);ae.x===0&&ae.y===0||ae._unit();const me=J.x*de.x+J.y*de.y,ve=ae.x*de.x+ae.y*de.y,Ue=ve!==0?1/ve:1/0,ot=2*Math.sqrt(2-2*ve),et=ve<Pg&&H&&Y,pt=J.x*de.y-J.y*de.x>0;if(et&&ee>L){const rt=G.dist(H);if(rt>2*B){const He=G.sub(G.sub(H)._mult(B/rt)._round());this.updateDistance(H,He),this.addCurrentVertex(He,J,0,0,F),H=He}}const Dt=H&&Y;let yt=Dt?o:C?"butt":u;if(Dt&&yt==="round"&&(Ue<g?yt="miter":Ue<=2&&(yt="fakeround")),yt==="miter"&&Ue>p&&(yt="bevel"),yt==="bevel"&&(Ue>2&&(yt="flipbevel"),Ue<p&&(yt="miter")),H&&this.updateDistance(H,G),yt==="miter")ae._mult(Ue),this.addCurrentVertex(G,ae,0,0,F);else if(yt==="flipbevel"){if(Ue>100)ae=de.mult(-1);else{const rt=Ue*J.add(de).mag()/J.sub(de).mag();ae._perp()._mult(rt*(pt?-1:1))}this.addCurrentVertex(G,ae,0,0,F),this.addCurrentVertex(G,ae.mult(-1),0,0,F)}else if(yt==="bevel"||yt==="fakeround"){const rt=-Math.sqrt(Ue*Ue-1),He=pt?rt:0,jt=pt?0:rt;if(H&&this.addCurrentVertex(G,J,He,jt,F),yt==="fakeround"){const Bt=Math.round(180*ot/Math.PI/20);for(let Gt=1;Gt<Bt;Gt++){let Lt=Gt/Bt;if(Lt!==.5){const Pn=Lt-.5;Lt+=Lt*Pn*(Lt-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*Pn*Pn+(.848013+me*(.215638*me-1.06021)))}const Kt=de.sub(J)._mult(Lt)._add(J)._unit()._mult(pt?-1:1);this.addHalfVertex(G,Kt.x,Kt.y,!1,pt,0,F)}}Y&&this.addCurrentVertex(G,de,-He,-jt,F)}else if(yt==="butt")this.addCurrentVertex(G,ae,0,0,F);else if(yt==="square"){const rt=H?1:-1;this.addCurrentVertex(G,ae,rt,rt,F)}else yt==="round"&&(H&&(this.addCurrentVertex(G,J,0,0,F),this.addCurrentVertex(G,J,1,1,F,!0)),Y&&(this.addCurrentVertex(G,de,-1,-1,F,!0),this.addCurrentVertex(G,de,0,0,F)));if(et&&ee<I-1){const rt=G.dist(Y);if(rt>2*B){const He=G.add(Y.sub(G)._mult(B/rt)._round());this.updateDistance(G,He),this.addCurrentVertex(He,de,0,0,F),G=He}}}}addCurrentVertex(e,n,o,u,p,g=!1){const x=n.y*u-n.x,T=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,p),this.addHalfVertex(e,x,T,g,!0,-u,p),this.distance>Id/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,u,p,g))}addHalfVertex({x:e,y:n},o,u,p,g,x,T){const C=.5*(this.lineClips?this.scaledDistance*(Id-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),T.primitiveLength++),g?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const o=n.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,n,o,u){for(const p of e){const g=p.paint.get("line-dasharray");if(!g||g.value.kind==="constant")continue;const x=p.layout.get("line-cap")==="round",T={dasharray:g.value.evaluate({zoom:o-1},n,{}),round:x},C={dasharray:g.value.evaluate({zoom:o},n,{}),round:x},I={dasharray:g.value.evaluate({zoom:o+1},n,{}),round:x},L=`${T.dasharray.join(",")},${T.round}`,B=`${C.dasharray.join(",")},${C.round}`,F=`${I.dasharray.join(",")},${I.round}`;u.dashDependencies[L]=T,u.dashDependencies[B]=C,u.dashDependencies[F]=I,n.dashes[p.id]={min:L,mid:B,max:F}}}}let Ml,xr;Ot("LineBucket",Sh,{omit:["layers","patternFeatures"]});var Al={get paint(){return xr=xr||new Ni({"line-opacity":new Xt(Oe.paint_line["line-opacity"]),"line-color":new Xt(Oe.paint_line["line-color"]),"line-translate":new Nt(Oe.paint_line["line-translate"]),"line-translate-anchor":new Nt(Oe.paint_line["line-translate-anchor"]),"line-width":new Xt(Oe.paint_line["line-width"]),"line-gap-width":new Xt(Oe.paint_line["line-gap-width"]),"line-offset":new Xt(Oe.paint_line["line-offset"]),"line-blur":new Xt(Oe.paint_line["line-blur"]),"line-dasharray":new La(Oe.paint_line["line-dasharray"]),"line-pattern":new La(Oe.paint_line["line-pattern"]),"line-gradient":new fu(Oe.paint_line["line-gradient"])})},get layout(){return Ml=Ml||new Ni({"line-cap":new Nt(Oe.layout_line["line-cap"]),"line-join":new Xt(Oe.layout_line["line-join"]),"line-miter-limit":new Nt(Oe.layout_line["line-miter-limit"]),"line-round-limit":new Nt(Oe.layout_line["line-round-limit"]),"line-sort-key":new Xt(Oe.layout_line["line-sort-key"])})}};class Eh extends Xt{possiblyEvaluate(e,n){return n=new Fn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,u){return n=ln({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,u)}}let Bs;class ym extends xi{constructor(e,n){super(e,Al,n),this.gradientVersion=0,Bs||(Bs=new Eh(Al.paint.properties["line-width"].specification),Bs.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof xo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Bs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Sh(e)}queryRadius(e){const n=e,o=np(vl("line-width",this,n),vl("line-gap-width",this,n)),u=vl("line-offset",this,n);return o/2+Math.abs(u)+yd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g}){const x=Uf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,g),T=g/2*np(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),C=this.paint.get("line-offset").evaluate(n,o);return C&&(u=(function(I,L){const B=[];for(let F=0;F<I.length;F++){const G=Vf(I[F]),H=[];for(let Y=0;Y<G.length;Y++){const J=G[Y],de=G[Y-1],ee=G[Y+1],ae=Y===0?new N(0,0):J.sub(de)._unit()._perp(),me=Y===G.length-1?new N(0,0):ee.sub(J)._unit()._perp(),ve=ae._add(me)._unit(),Ue=ve.x*me.x+ve.y*me.y;Ue!==0&&ve._mult(1/Ue),H.push(ve._mult(L)._add(J))}B.push(H)}return B})(u,C*g)),(function(I,L,B){for(let F=0;F<L.length;F++){const G=L[F];if(I.length>=3){for(let H=0;H<G.length;H++)if(Oo(I,G[H]))return!0}if(yr(I,G,B))return!0}return!1})(x,u,T)}isTileClipped(){return!0}}function np(i,e){return e>0?e+2*i:i}const Dg=mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kd=mi([{name:"a_projected_pos",components:3,type:"Float32"}],4);mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _m=mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Va=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ig=mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function qa(i,e,n){return i.sections.forEach((o=>{o.text=(function(u,p,g){const x=p.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?u=u.toLocaleUpperCase():x==="lowercase"&&(u=u.toLocaleLowerCase()),Ra.applyArabicShaping&&(u=Ra.applyArabicShaping(u)),u})(o.text,e,n)})),i}mi([{name:"triangle",components:3,type:"Uint16"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),mi([{type:"Float32",name:"offsetX"}]),mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),mi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var or=24;const Mh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},n_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},fc={40:!0};function Rd(i,e,n,o,u,p){if("fontStack"in e){const g=n[e.fontStack],x=g&&g[i];return x?x.metrics.advance*e.scale+u:0}{const g=o[e.imageName];return g?g.displaySize[0]*e.scale*or/p+u:0}}function ip(i,e,n,o){const u=Math.pow(i-e,2);return o?i<e?u/2:2*u:u+Math.abs(n)*n}function Ah(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function vm(i,e,n,o,u,p){let g=null,x=ip(e,n,u,p);for(const T of o){const C=ip(e-T.x,n,u,p)+T.badness;C<=x&&(g=T,x=C)}return{index:i,x:e,priorBreak:g,badness:x}}function xm(i){return i?xm(i.priorBreak).concat(i.index):[]}class Mu{constructor(e="",n=[],o=[]){this.text=e,this.sections=n,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,n){const o=new Mu;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let p=u.next();const g=e[Symbol.iterator]();g.next();let x=g.next();for(;!p.done;)n+=!x.done&&Ds(x.value.codePointAt(0))&&!Mh[x.value]||!o.premature&&Ds(o.value.codePointAt(0))&&!Mh[o.value]||!Mh[p.value]?p.value:Mh[p.value],o={value:p.value,premature:!1},p=u.next(),x=g.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(n,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-u)}substring(e,n){const o=[...this.text].slice(e,n).join(""),u=this.sectionIndex.slice(e,n);return new Mu(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,o=0;for(let u=0;u<this.length();u++){const p=this.getSection(u);if("imageName"in p){const g=e[p.imageName];if(!g)continue;const x=g.displaySize;n=Math.max(n,x[0]),o=Math.max(o,x[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Mn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):Mn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,o,u,p){const g=[],x=this.determineAverageLineWidth(e,n,o,u,p),T=this.hasZeroWidthSpaces();let C=0,I=0;const L=this.text[Symbol.iterator]();let B=L.next();const F=this.text[Symbol.iterator]();F.next();let G=F.next();const H=this.text[Symbol.iterator]();H.next(),H.next();let Y=H.next();for(;!B.done;){const J=this.getSection(I),de=B.value.codePointAt(0);if(lu(de)||(C+=Rd(de,J,o,u,e,p)),!G.done){const ee=Cs(de),ae=G.value.codePointAt(0);(n_[de]||ee||"imageName"in J||!Y.done&&fc[ae])&&g.push(vm(I+1,C,x,g,Ah(de,ae,ee&&T),!1))}I++,B=L.next(),G=F.next(),Y=H.next()}return xm(vm(this.length(),C,x,g,0,!0))}determineAverageLineWidth(e,n,o,u,p){let g=0,x=0;for(const T of this.text){const C=this.getSection(x);g+=Rd(T.codePointAt(0),C,o,u,e,p),x++}return g/Math.max(1,Math.ceil(g/n))}}const rp=4294967296,Ld=1/rp,ap=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class sp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,o=this.length){for(;this.pos<o;){const u=this.readVarint(),p=u>>3,g=this.pos;this.type=7&u,e(p,n,this),this.pos===g&&this.skip(u)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*rp;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*rp;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let o,u;return u=n[this.pos++],o=127&u,u<128?o:(u=n[this.pos++],o|=(127&u)<<7,u<128?o:(u=n[this.pos++],o|=(127&u)<<14,u<128?o:(u=n[this.pos++],o|=(127&u)<<21,u<128?o:(u=n[this.pos],o|=(15&u)<<28,(function(p,g,x){const T=x.buf;let C,I;if(I=T[x.pos++],C=(112&I)>>4,I<128||(I=T[x.pos++],C|=(127&I)<<3,I<128)||(I=T[x.pos++],C|=(127&I)<<10,I<128)||(I=T[x.pos++],C|=(127&I)<<17,I<128)||(I=T[x.pos++],C|=(127&I)<<24,I<128)||(I=T[x.pos++],C|=(1&I)<<31,I<128))return Ch(p,C,g);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&ap?ap.decode(this.buf.subarray(n,e)):(function(o,u,p){let g="",x=u;for(;x<p;){const T=o[x];let C,I,L,B=null,F=T>239?4:T>223?3:T>191?2:1;if(x+F>p)break;F===1?T<128&&(B=T):F===2?(C=o[x+1],(192&C)==128&&(B=(31&T)<<6|63&C,B<=127&&(B=null))):F===3?(C=o[x+1],I=o[x+2],(192&C)==128&&(192&I)==128&&(B=(15&T)<<12|(63&C)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(C=o[x+1],I=o[x+2],L=o[x+3],(192&C)==128&&(192&I)==128&&(192&L)==128&&(B=(15&T)<<18|(63&C)<<12|(63&I)<<6|63&L,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),x+=F}return g})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ld),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ld),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,o){let u,p;if(n>=0?(u=n%4294967296|0,p=n/4294967296|0):(u=~(-n%4294967296),p=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(g,x,T){T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,T.buf[T.pos]=127&(g>>>=7)})(u,0,o),(function(g,x){const T=(7&g)<<4;x.buf[x.pos++]|=T|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))})(p,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(u,p,g){for(let x,T,C=0;C<p.length;C++){if(x=p.charCodeAt(C),x>55295&&x<57344){if(!T){x>56319||C+1===p.length?(u[g++]=239,u[g++]=191,u[g++]=189):T=x;continue}if(x<56320){u[g++]=239,u[g++]=191,u[g++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(u[g++]=239,u[g++]=191,u[g++]=189,T=null);x<128?u[g++]=x:(x<2048?u[g++]=x>>6|192:(x<65536?u[g++]=x>>12|224:(u[g++]=x>>18|240,u[g++]=x>>12&63|128),u[g++]=x>>6&63|128),u[g++]=63&x|128)}return g})(this.buf,e,this.pos);const o=this.pos-n;o>=128&&kg(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,n){this.pos++;const o=this.pos;e(n,this);const u=this.pos-o;u>=128&&kg(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,n,o){this.writeTag(e,2),this.writeRawMessage(n,o)}writePackedVarint(e,n){n.length&&this.writeMessage(e,Rg,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,Lg,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,Og,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,zh,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,op,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,Bg,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,Ng,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,Fg,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,jg,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function Ch(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function kg(i,e,n){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(let u=n.pos-1;u>=i;u--)n.buf[u+o]=n.buf[u]}function Rg(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function Lg(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function zh(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function op(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function Og(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function Bg(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function Ng(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function Fg(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function jg(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function Ug(i,e,n){i===1&&n.readMessage(lp,e)}function lp(i,e,n){if(i===3){const{id:o,bitmap:u,width:p,height:g,left:x,top:T,advance:C}=n.readMessage(Vg,{});e.push({id:o,bitmap:new xd({width:p+6,height:g+6},u),metrics:{width:p,height:g,left:x,top:T,advance:C}})}}function Vg(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function bm(i){let e=0,n=0;for(const g of i)e+=g.w*g.h,n=Math.max(n,g.w);i.sort(((g,x)=>x.h-g.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,p=0;for(const g of i)for(let x=o.length-1;x>=0;x--){const T=o[x];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,p=Math.max(p,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===T.w&&g.h===T.h){const C=o.pop();C&&x<o.length&&(o[x]=C)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(o.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}class Qn{constructor(e,{pixelRatio:n,version:o,stretchX:u,stretchY:p,content:g,textFitWidth:x,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=p,this.content=g,this.version=o,this.textFitWidth=x,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class cp{constructor(e,n){const o={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,p),this.addImages(n,u,p);const{w:g,h:x}=bm(p),T=new na({width:g||1,height:x||1});for(const C in e){const I=e[C],L=o[C].paddedRect;na.copy(I.data,T,{x:0,y:0},{x:L.x+1,y:L.y+1},I.data)}for(const C in n){const I=n[C],L=u[C].paddedRect,B=L.x+1,F=L.y+1,G=I.data.width,H=I.data.height;na.copy(I.data,T,{x:0,y:0},{x:B,y:F},I.data),na.copy(I.data,T,{x:0,y:H-1},{x:B,y:F-1},{width:G,height:1}),na.copy(I.data,T,{x:0,y:0},{x:B,y:F+H},{width:G,height:1}),na.copy(I.data,T,{x:G-1,y:0},{x:B-1,y:F},{width:1,height:H}),na.copy(I.data,T,{x:0,y:0},{x:B+G,y:F},{width:1,height:H})}this.image=T,this.iconPositions=o,this.patternPositions=u}addImages(e,n,o){for(const u in e){const p=e[u],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(g),n[u]=new Qn(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,p]=e.tl;o.update(n.data,void 0,{x:u,y:p})}}var pc;function Od(i,e,n,o,u,p,g,x,T,C,I,L,B,F,G){const H=Mu.fromFeature(i,u);let Y;L===A.az.vertical&&H.verticalizePunctuation();let J=H.determineLineBreaks(C,p,e,o,F);const{processBidirectionalText:de,processStyledBidirectionalText:ee}=Ra;if(de&&H.sections.length===1){Y=[],J=J.map((Ue=>H.toCodeUnitIndex(Ue)));const ve=de(H.toString(),J);for(const Ue of ve){const ot=[...Ue].map((()=>0));Y.push(new Mu(Ue,H.sections,ot))}}else if(ee){Y=[],J=J.map((et=>H.toCodeUnitIndex(et)));let ve=0;const Ue=[];for(const et of H.text)Ue.push(...Array(et.length).fill(H.sectionIndex[ve])),ve++;const ot=ee(H.text,Ue,J);for(const et of ot){const pt=[];let Dt="";for(const yt of et[0])pt.push(et[1][Dt.length]),Dt+=yt;Y.push(new Mu(et[0],H.sections,pt))}}else Y=(function(ve,Ue){const ot=[];let et=0;for(const pt of Ue)ot.push(ve.substring(et,pt)),et=pt;return et<ve.length()&&ot.push(ve.substring(et,ve.length())),ot})(H,J);const ae=[],me={positionedLines:ae,text:H.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:L,iconsInText:!1,verticalizable:!1};return(function(ve,Ue,ot,et,pt,Dt,yt,rt,He,jt,Bt,Gt){let Lt=0,Kt=0,Pn=0,_n=0;const Di=rt==="right"?1:rt==="left"?0:.5,sa=or/Gt;let Tr=0;for(const Hn of pt){Hn.trim();const $i=Hn.getMaxScale(),tr={positionedGlyphs:[],lineOffset:0};ve.positionedLines[Tr]=tr;const _i=tr.positionedGlyphs;let cs=0;if(!Hn.length()){Kt+=Dt,++Tr;continue}const oa=i_(et,Hn,sa);let us=0;for(const Lr of Hn.text){const ji=Hn.getSection(us),Sr=Lr.codePointAt(0),Xi=up(He,Bt,Sr),Or={glyph:Sr,imageName:null,x:Lt,y:Kt+-17,vertical:Xi,scale:1,fontStack:"",sectionIndex:Hn.getSectionIndex(us),metrics:null,rect:null};let Pu;if("fontStack"in ji){if(Pu=Ph(ji,Sr,Xi,oa,Ue,ot),!Pu)continue;Or.fontStack=ji.fontStack}else{if(ve.iconsInText=!0,ji.scale*=sa,Pu=Tm(ji,Xi,$i,oa,et),!Pu)continue;cs=Math.max(cs,Pu.imageOffset),Or.imageName=ji.imageName}const{rect:kl,metrics:ig,baselineOffset:jh}=Pu;Or.y+=jh,Or.scale=ji.scale,Or.metrics=ig,Or.rect=kl,_i.push(Or),Xi?(ve.verticalizable=!0,Lt+=("imageName"in ji?ig.advance:or)*ji.scale+jt):Lt+=ig.advance*ji.scale+jt,us++}_i.length!==0&&(Pn=Math.max(Lt-jt,Pn),hp(_i,0,_i.length-1,Di)),Lt=0,tr.lineOffset=Math.max(cs,($i-1)*or);const Vo=Dt*$i+cs;Kt+=Vo,_n=Math.max(Vo,_n),++Tr}const{horizontalAlign:Ii,verticalAlign:wi}=wm(yt);(function(Hn,$i,tr,_i,cs,oa,us,Vo,Lr){const ji=($i-tr)*cs;let Sr=0;Sr=oa!==us?-Vo*_i- -17:-_i*Lr*us+.5*us;for(const Xi of Hn)for(const Or of Xi.positionedGlyphs)Or.x+=ji,Or.y+=Sr})(ve.positionedLines,Di,Ii,wi,Pn,_n,Dt,Kt,pt.length),ve.top+=-wi*Kt,ve.bottom=ve.top+Kt,ve.left+=-Ii*Pn,ve.right=ve.left+Pn})(me,e,n,o,Y,g,x,T,L,C,B,G),!(function(ve){for(const Ue of ve)if(Ue.positionedGlyphs.length!==0)return!1;return!0})(ae)&&me}function wm(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function i_(i,e,n){const o=e.getMaxScale()*or,{maxImageWidth:u,maxImageHeight:p}=e.getMaxImageSize(i),g=Math.max(o,p*n);return{verticalLineContentWidth:Math.max(o,u*n),horizontalLineContentHeight:g}}function qg(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function up(i,e,n){return!(i===A.az.horizontal||!e&&!hl(n)||e&&(lu(n)||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Ph(i,e,n,o,u,p){const g=p[i.fontStack],x=(function(C,I,L,B){if(C&&C.rect)return C;const F=I[L.fontStack],G=F&&F[B];return G?{rect:null,metrics:G.metrics}:null})(g&&g[e],u,i,e);if(x===null)return null;let T;if(n)T=o.verticalLineContentWidth-i.scale*or;else{const C=qg(i.verticalAlign);T=(o.horizontalLineContentHeight-i.scale*or)*C}return{rect:x.rect,metrics:x.metrics,baselineOffset:T}}function Tm(i,e,n,o,u){const p=u[i.imageName];if(!p)return null;const g=p.paddedRect,x=p.displaySize,T={width:x[0],height:x[1],left:1,top:-3,advance:e?x[1]:x[0]};let C;if(e)C=o.verticalLineContentWidth-x[1]*i.scale;else{const I=qg(i.verticalAlign);C=(o.horizontalLineContentHeight-x[1]*i.scale)*I}return{rect:g,metrics:T,baselineOffset:C,imageOffset:(e?x[0]:x[1])*i.scale-or*n}}function hp(i,e,n,o){if(o===0)return;const u=i[n],p=(i[n].x+u.metrics.advance*u.scale)*o;for(let g=e;g<=n;g++)i[g].x-=p}function Sm(i,e,n){const{horizontalAlign:o,verticalAlign:u}=wm(n),p=e[0]-i.displaySize[0]*o,g=e[1]-i.displaySize[1]*u;return{image:i,top:g,bottom:g+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Cl(i){var e,n;let o=i.left,u=i.top,p=i.right-o,g=i.bottom-u;const x=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",C=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(T==="proportional"){if(x==="stretchOnly"&&p/g<C||x==="proportional"){const I=Math.ceil(g*C);o*=I/p,p=I}}else if(x==="proportional"&&T==="stretchOnly"&&C!==0&&p/g>C){const I=Math.ceil(p/C);u*=I/g,g=I}return{x1:o,y1:u,x2:o+p,y2:u+g}}function lo(i,e,n,o,u,p){const g=i.image;let x;if(g.content){const Y=g.content,J=g.pixelRatio||1;x=[Y[0]/J,Y[1]/J,g.displaySize[0]-Y[2]/J,g.displaySize[1]-Y[3]/J]}const T=e.left*p,C=e.right*p;let I,L,B,F;n==="width"||n==="both"?(F=u[0]+T-o[3],L=u[0]+C+o[1]):(F=u[0]+(T+C-g.displaySize[0])/2,L=F+g.displaySize[0]);const G=e.top*p,H=e.bottom*p;return n==="height"||n==="both"?(I=u[1]+G-o[0],B=u[1]+H+o[2]):(I=u[1]+(G+H-g.displaySize[1])/2,B=I+g.displaySize[1]),{image:g,top:I,right:L,bottom:B,left:F,collisionPadding:x}}Ot("ImagePosition",Qn),Ot("ImageAtlas",cp),A.az=void 0,(pc=A.az||(A.az={}))[pc.none=0]="none",pc[pc.horizontal=1]="horizontal",pc[pc.vertical=2]="vertical",pc[pc.horizontalOnly=3]="horizontalOnly";const os=128,mc=32640;function Em(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Fn(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let p=0;for(;p<o.length&&o[p]<=i;)p++;p=Math.max(0,p-1);let g=p;for(;g<o.length&&o[g]<i+1;)g++;g=Math.min(o.length-1,g);const x=o[p],T=o[g];return n.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:T,minSize:n.evaluate(new Fn(x)),maxSize:n.evaluate(new Fn(T)),interpolationType:u}}}function dp(i,e,n){let o="never";const u=i.get(e);return u?o=u:i.get(n)&&(o="always"),o}const Gg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bd(i,e,n,o,u,p,g,x,T,C,I,L,B){const F=x?Math.min(mc,Math.round(x[0])):0,G=x?Math.min(mc,Math.round(x[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*u),p,g,(F<<1)+(T?1:0),G,16*C,16*I,256*L,256*B)}function Mm(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Am(i){for(const e of i.sections)if(Js(e.text))return!0;return!1}class fp{constructor(e){this.layoutVertexArray=new pe,this.indexArray=new qe,this.programConfigurations=e,this.segments=new Pt,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new Ge,this.hasVisibleVertices=!1,this.placedSymbolArray=new w}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Gg,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ot("SymbolBuffers",fp);class pp{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Pt,this.collisionVertexArray=new Ve}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,_m.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ot("CollisionBuffers",pp);class Dh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Em(this.zoom,n["text-size"]),this.iconSizeData=Em(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=dp(o,"text-overlap","text-allow-overlap")!=="never"||dp(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((g=>A.az[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=e.sourceID}createArrays(){this.text=new fp(new Ro(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new fp(new Ro(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new R,this.lineVertexArray=new O,this.symbolInstances=new P,this.textAnchorOffsets=new j}calculateGlyphDependencies(e,n,o,u,p){for(const g of e)if(n[g.codePointAt(0)]=!0,(o||u)&&p){const x=Mh[g];x&&(n[x.codePointAt(0)]=!0)}}populate(e,n,o){const u=this.layers[0],p=u.layout,g=p.get("text-font"),x=p.get("text-field"),T=p.get("icon-image"),C=(x.value.kind!=="constant"||x.value.value instanceof ir&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),I=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!C&&!I)return;const B=n.iconDependencies,F=n.glyphDependencies,G=n.availableImages,H=new Fn(this.zoom);for(const{feature:Y,id:J,index:de,sourceLayerIndex:ee}of e){const ae=u._featureFilter.needGeometry,me=as(Y,ae);if(!u._featureFilter.filter(H,me,o))continue;let ve,Ue;if(ae||(me.geometry=ao(Y)),C){const et=u.getValueAndResolveTokens("text-field",me,o,G),pt=ir.factory(et),Dt=this.hasRTLText=this.hasRTLText||Am(pt);(!Dt||Ra.getRTLTextPluginStatus()==="unavailable"||Dt&&Ra.isParsed())&&(ve=qa(pt,u,me))}if(I){const et=u.getValueAndResolveTokens("icon-image",me,o,G);Ue=et instanceof Fr?et:Fr.fromString(et)}if(!ve&&!Ue)continue;const ot=this.sortFeaturesByKey?L.evaluate(me,{},o):void 0;if(this.features.push({id:J,text:ve,icon:Ue,index:de,sourceLayerIndex:ee,geometry:me.geometry,properties:Y.properties,type:Th.types[Y.type],sortKey:ot}),Ue&&(B[Ue.name]=!0),ve){const et=g.evaluate(me,{},o).join(","),pt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(A.az.vertical)>=0;for(const Dt of ve.sections)if(Dt.image)B[Dt.image.name]=!0;else{const yt=zs(ve.toString()),rt=Dt.fontStack||et,He=F[rt]=F[rt]||{};this.calculateGlyphDependencies(Dt.text,He,pt,this.allowVerticalPlacement,yt)}}}p.get("symbol-placement")==="line"&&(this.features=(function(Y){const J={},de={},ee=[];let ae=0;function me(et){ee.push(Y[et]),ae++}function ve(et,pt,Dt){const yt=de[et];return delete de[et],de[pt]=yt,ee[yt].geometry[0].pop(),ee[yt].geometry[0]=ee[yt].geometry[0].concat(Dt[0]),yt}function Ue(et,pt,Dt){const yt=J[pt];return delete J[pt],J[et]=yt,ee[yt].geometry[0].shift(),ee[yt].geometry[0]=Dt[0].concat(ee[yt].geometry[0]),yt}function ot(et,pt,Dt){const yt=Dt?pt[0][pt[0].length-1]:pt[0][0];return`${et}:${yt.x}:${yt.y}`}for(let et=0;et<Y.length;et++){const pt=Y[et],Dt=pt.geometry,yt=pt.text?pt.text.toString():null;if(!yt){me(et);continue}const rt=ot(yt,Dt),He=ot(yt,Dt,!0);if(rt in de&&He in J&&de[rt]!==J[He]){const jt=Ue(rt,He,Dt),Bt=ve(rt,He,ee[jt].geometry);delete J[rt],delete de[He],de[ot(yt,ee[Bt].geometry,!0)]=Bt,ee[jt].geometry=null}else rt in de?ve(rt,He,Dt):He in J?Ue(rt,He,Dt):(me(et),J[rt]=ae-1,de[He]=ae-1)}return ee.filter((et=>et.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Y,J)=>Y.sortKey-J.sortKey))}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(n[e.segment+1]),p=e.dist(n[e.segment]);const g={};for(let x=e.segment+1;x<n.length;x++)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:u},x<n.length-1&&(u+=n[x+1].dist(n[x]));for(let x=e.segment||0;x>=0;x--)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const T=g[x];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,u,p,g,x,T,C,I,L,B){const F=e.indexArray,G=e.layoutVertexArray,H=e.segments.prepareSegment(4*n.length,G,F,this.canOverlap?g.sortKey:void 0),Y=this.glyphOffsetArray.length,J=H.vertexLength,de=this.allowVerticalPlacement&&x===A.az.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let ae=0;ae<n.length;ae++){const{tl:me,tr:ve,bl:Ue,br:ot,tex:et,pixelOffsetTL:pt,pixelOffsetBR:Dt,minFontScaleX:yt,minFontScaleY:rt,glyphOffset:He,isSDF:jt,sectionIndex:Bt}=n[ae],Gt=H.vertexLength,Lt=He[1];Bd(G,T.x,T.y,me.x,Lt+me.y,et.x,et.y,o,jt,pt.x,pt.y,yt,rt),Bd(G,T.x,T.y,ve.x,Lt+ve.y,et.x+et.w,et.y,o,jt,Dt.x,pt.y,yt,rt),Bd(G,T.x,T.y,Ue.x,Lt+Ue.y,et.x,et.y+et.h,o,jt,pt.x,Dt.y,yt,rt),Bd(G,T.x,T.y,ot.x,Lt+ot.y,et.x+et.w,et.y+et.h,o,jt,Dt.x,Dt.y,yt,rt),Mm(e.dynamicLayoutVertexArray,T,de),F.emplaceBack(Gt,Gt+2,Gt+1),F.emplaceBack(Gt+1,Gt+2,Gt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(He[0]),ae!==n.length-1&&Bt===n[ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,g,g.index,{imagePositions:{},canonical:B,formattedSection:ee&&ee[Bt]})}e.placedSymbolArray.emplaceBack(T.x,T.y,Y,this.glyphOffsetArray.length-Y,J,C,I,T.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],x,0,!1,0,L)}_addCollisionDebugVertex(e,n,o,u,p,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,p,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,u,p,g,x){const T=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),C=T.vertexLength,I=p.layoutVertexArray,L=p.collisionVertexArray,B=x.anchorX,F=x.anchorY;this._addCollisionDebugVertex(I,L,g,B,F,new N(e,n)),this._addCollisionDebugVertex(I,L,g,B,F,new N(o,n)),this._addCollisionDebugVertex(I,L,g,B,F,new N(o,u)),this._addCollisionDebugVertex(I,L,g,B,F,new N(e,u)),T.vertexLength+=4;const G=p.indexArray;G.emplaceBack(C,C+1),G.emplaceBack(C+1,C+2),G.emplaceBack(C+2,C+3),G.emplaceBack(C+3,C),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,u){for(let p=e;p<n;p++){const g=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,u?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pp(je,Va.members,St),this.iconCollisionBox=new pp(je,Va.members,St);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,u,p,g,x,T,C){const I={};for(let L=n;L<o;L++){const B=e.get(L);I.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.textFeatureIndex=B.featureIndex;break}for(let L=u;L<p;L++){const B=e.get(L);I.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.verticalTextFeatureIndex=B.featureIndex;break}for(let L=g;L<x;L++){const B=e.get(L);I.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.iconFeatureIndex=B.featureIndex;break}for(let L=T;L<C;L++){const B=e.get(L);I.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.verticalIconFeatureIndex=B.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+2,p+1),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),u=[],p=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const T=this.symbolInstances.get(x);u.push(0|Math.round(n*T.anchorX+o*T.anchorY)),p.push(T.featureIndex)}return g.sort(((x,T)=>u[x]-u[T]||p[T]-p[x])),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,p,g)=>{u>=0&&g.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mp,gp;Ot("SymbolBucket",Dh,{omit:["layers","collisionBoxArray","features","compareText"]}),Dh.MAX_GLYPHS=65535,Dh.addDynamicAttributes=Mm;var Cm={get paint(){return gp=gp||new Ni({"icon-opacity":new Xt(Oe.paint_symbol["icon-opacity"]),"icon-color":new Xt(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Xt(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(Oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Xt(Oe.paint_symbol["text-opacity"]),"text-color":new Xt(Oe.paint_symbol["text-color"],{runtimeType:ni,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Xt(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(Oe.paint_symbol["text-halo-blur"]),"text-translate":new Nt(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(Oe.paint_symbol["text-translate-anchor"])})},get layout(){return mp=mp||new Ni({"symbol-placement":new Nt(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(Oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Nt(Oe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Nt(Oe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Nt(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(Oe.layout_symbol["icon-size"]),"icon-text-fit":new Nt(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(Oe.layout_symbol["icon-image"]),"icon-rotate":new Xt(Oe.layout_symbol["icon-rotate"]),"icon-padding":new Xt(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Xt(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(Oe.layout_symbol["text-field"]),"text-font":new Xt(Oe.layout_symbol["text-font"]),"text-size":new Xt(Oe.layout_symbol["text-size"]),"text-max-width":new Xt(Oe.layout_symbol["text-max-width"]),"text-line-height":new Nt(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Xt(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(Oe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Xt(Oe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Xt(Oe.layout_symbol["text-anchor"]),"text-max-angle":new Nt(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(Oe.layout_symbol["text-rotate"]),"text-padding":new Nt(Oe.layout_symbol["text-padding"]),"text-keep-upright":new Nt(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Xt(Oe.layout_symbol["text-transform"]),"text-offset":new Xt(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(Oe.layout_symbol["text-allow-overlap"]),"text-overlap":new Nt(Oe.layout_symbol["text-overlap"]),"text-ignore-placement":new Nt(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(Oe.layout_symbol["text-optional"])})}};class Zg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:_t,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot("FormatSectionOverride",Zg,{omit:["defaultValue"]});class gc extends xi{constructor(e,n){super(e,Cm,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const p of o)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,u){const p=this.layout.get(e).evaluate(n,{},o,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Ao(g.value)||!p?p:(function(x,T){return T.replace(/{([^{}]+)}/g,((C,I)=>x&&I in x?String(x[I]):""))})(n.properties,p)}createBucket(e){return new Dh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Cm.paint.overridableProperties){if(!gc.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new Zg(n),u=new ah(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new Gr("source",u):new Co("composite",u,n.value.zoomStops),this.paint._values[e]=new _a(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&gc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),u=Cm.paint.properties[n];let p=!1;const g=x=>{for(const T of x)if(u.overrides&&u.overrides.hasOverride(T))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ir)g(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const x=C=>{p||(C instanceof ua&&fi(C.value)===ds?g(C.value.sections):C instanceof Gc?g(C.sections):C.eachChild(x))},T=o.value;T._styleExpression&&x(T._styleExpression.expression)}return p}}let Hg;var $g={get paint(){return Hg=Hg||new Ni({"background-color":new Nt(Oe.paint_background["background-color"]),"background-pattern":new sc(Oe.paint_background["background-pattern"]),"background-opacity":new Nt(Oe.paint_background["background-opacity"])})}};class En extends xi{constructor(e,n){super(e,$g,n)}}class zm extends xi{constructor(e,n){super(e,{},n),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Pm={once:!0},_p=63710088e-1;class jo{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new jo(Vt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,u=e.lat*n,p=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return _p*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof jo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new jo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new jo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ih=2*Math.PI*_p;function Nd(i){return Ih*Math.cos(i*Math.PI/180)}function Xg(i){return(180+i)/360}function Dm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Yg(i,e){return i/Nd(e)}function Wg(i){return 360*i-180}function Fd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Im(i,e){return i*Nd(Fd(e))}class Gn{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=jo.convert(e);return new Gn(Xg(o.lng),Dm(o.lat),Yg(n,o.lat))}toLngLat(){return new jo(Wg(this.x),Fd(this.y))}toAltitude(){return Im(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ih*(e=Fd(this.y),1/Math.cos(e*Math.PI/180));var e}}function vp(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Cr{constructor(e,n,o){if(!(function(u,p,g){return!(u<0||u>25||g<0||g>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))})(e,n,o))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=kh(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const u=(function(g,x,T){var C=vp(256*g,256*(x=Math.pow(2,T)-x-1),T),I=vp(256*(g+1),256*(x+1),T);return C[0]+","+C[1]+","+I[0]+","+I[1]})(this.x,this.y,this.z),p=(function(g,x,T){let C,I="";for(let L=g;L>0;L--)C=1<<L-1,I+=(x&C?1:0)+(T&C?2:0);return I})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,p).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new N((e.x*n-this.x)*vt,(e.y*n-this.y)*vt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kg{constructor(e,n){this.wrap=e,this.canonical=n,this.key=kh(e,n.z,n.z,n.x,n.y)}}class Ga{constructor(e,n,o,u,p){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Cr(o,+u,+p),this.key=kh(n,e,o,u,p)}clone(){return new Ga(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new Ga(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ga(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?kh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):kh(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Ga(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Ga(n,this.wrap,n,o,u),new Ga(n,this.wrap,n,o+1,u),new Ga(n,this.wrap,n,o,u+1),new Ga(n,this.wrap,n,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ga(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ga(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Gn(e.x-this.wrap,e.y))}}function kh(i,e,n,o,u){(i*=2)<0&&(i=-1*i-1);const p=1<<n;return(p*p*i+p*u+o).toString(36)+n.toString(36)+e.toString(36)}function jd(i,e){return e?i.properties[e]:i.id}function km(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=i.addOrUpdateProperties.findIndex((p=>p.key===o));u>-1&&i.addOrUpdateProperties.splice(u,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function Ud(i){var e,n;if(!i)return{};const o={};return o.removeAll=i.removeAll,o.remove=new Set(i.remove||[]),o.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((u=>[u.id,u]))),o}Ot("CanonicalTileID",Cr),Ot("OverscaledTileID",Ga,{omit:["terrainRttPosMatrix32f"]});class yc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new yc;return n.extend(e(new N(this.minX,this.minY))),n.extend(e(new N(this.maxX,this.minY))),n.extend(e(new N(this.minX,this.maxY))),n.extend(e(new N(this.maxX,this.maxY))),n}static fromPoints(e){const n=new yc;for(const o of e)n.extend(o);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Rm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class xp{constructor(e,n,o,u,p){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=n,this.properties=e.properties,this.id=p}projectPoint(e,n,o,u){return[360*(e.x+n)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,n,o,u){return e.map((p=>this.projectPoint(p,n,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,p=e.loadGeometry();switch(e.type){case 1:{const g=[];for(const T of p)g.push(T[0]);const x=this.projectLine(g,o,u,n);this._geometry=g.length===1?{type:"Point",coordinates:x[0]}:{type:"MultiPoint",coordinates:x};break}case 2:{const g=p.map((x=>this.projectLine(x,o,u,n)));this._geometry=g.length===1?{type:"LineString",coordinates:g[0]}:{type:"MultiLineString",coordinates:g};break}case 3:{const g=zg(p),x=[];for(const T of g)x.push(T.map((C=>this.projectLine(C,o,u,n))));this._geometry=x.length===1?{type:"Polygon",coordinates:x[0]}:{type:"MultiPolygon",coordinates:x};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class _c{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,o){this._name=e,this.dataBuffer=n,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class bp extends _c{}class wp extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Lm extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Om extends _c{delta;constructor(e,n,o,u){super(e,n,u),this.delta=o}}class Bm extends Om{constructor(e,n,o,u){super(e,Int32Array.of(n),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Nm extends _c{constructor(e,n,o){super(e,Int32Array.of(n),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class vc{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,o,u,p=4096){this._name=e,this._geometryVector=n,this._idVector=o,this._propertyVectors=u,this._extent=p}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const u=e?.next().value,p={};for(const g of this.propertyVectors){if(!g)continue;const x=g.name,T=g.getValue(n);T!==null&&(p[x]=T)}n++,yield{id:o,geometry:u,properties:p}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const p={coordinates:n[o],type:this.geometryVector.geometryType(o)},g={};for(const x of this.propertyVectors){if(!x)continue;const T=x.name,C=x.getValue(o);C!==null&&(g[T]=C)}e.push({id:u,geometry:p,properties:g})}return e}containsMaxSaveIntegerValues(e){return e instanceof wp||e instanceof Nm&&e instanceof Bm||e instanceof Lm}}class Qg{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var mn,co,kr,uo,xc,ia,er,br,ls,Ta;function wr(i,e,n){const o=new Int32Array(n);let u=0,p=e.get();for(let g=0;g<o.length;g++){let x=i[p++],T=127&x;x<128||(x=i[p++],T|=(127&x)<<7,x<128||(x=i[p++],T|=(127&x)<<14,x<128||(x=i[p++],T|=(127&x)<<21,x<128||(x=i[p++],T|=(15&x)<<28)))),o[u++]=T}return e.set(p),o}function Vd(i,e,n){const o=new BigInt64Array(n);for(let u=0;u<o.length;u++)o[u]=Tp(i,e);return o}function Jg(i,e){let n,o;return o=i[e.get()],e.increment(),n=127&o,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<7,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<14,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<21,o<128?n:(o=i[e.get()],n|=(15&o)<<28,(function(u,p,g){let x,T;if(T=p[g.get()],g.increment(),x=(112&T)>>4,T<128||(T=p[g.get()],g.increment(),x|=(127&T)<<3,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<10,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<17,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<24,T<128)||(T=p[g.get()],g.increment(),x|=(1&T)<<31,T<128))return 4294967296*x+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function Rh(i,e,n,o){throw new Error("FastPFor is not implemented yet.")}function Rr(i){return i>>>1^-(1&i)}function Au(i){return i>>1n^-(1n&i)}function Tp(i,e){let n=0n,o=0,u=e.get();for(;u<i.length;){const p=i[u++];if(n|=BigInt(127&p)<<BigInt(o),!(128&p))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),n}function Uo(i,e,n){const o=new Int32Array(n);let u=0;for(let p=0;p<e;p++){const g=i[p];o.fill(i[p+e],u,u+g),u+=g}return o}function ey(i,e,n){const o=new BigInt64Array(n);let u=0;for(let p=0;p<e;p++){const g=Number(i[p]);o.fill(i[p+e],u,u+g),u+=g}return o}function ty(i,e,n){const o=new Float64Array(n);let u=0;for(let p=0;p<e;p++){const g=i[p];o.fill(i[p+e],u,u+g),u+=g}return o}function bc(i){const e=i.length/4*4;let n=1;if(e>=4)for(let o=i[0];n<e-4;n+=4)o=i[n]+=o,o=i[n+1]+=o,o=i[n+2]+=o,o=i[n+3]+=o;for(;n!=i.length;)i[n]+=i[n-1],++n}function Fm(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const o=i[n],u=i[n+1],p=i[n+2],g=i[n+3];i[n]=(o>>>1^-(1&o))+i[n-2],i[n+1]=(u>>>1^-(1&u))+i[n-1],i[n+2]=(p>>>1^-(1&p))+i[n],i[n+3]=(g>>>1^-(1&g))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(mn||(mn={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(co||(co={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(kr||(kr={}));class jm{_dictionaryType;_offsetType;_lengthType;constructor(e,n,o){this._dictionaryType=e,this._offsetType=n,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function ra(i,e){const n=(function(o,u){const p=o[u.get()],g=Object.values(kr)[p>>4];let x=null;switch(g){case kr.DATA:x=new jm(Object.values(uo)[15&p]);break;case kr.OFFSET:x=new jm(null,Object.values(xc)[15&p]);break;case kr.LENGTH:x=new jm(null,null,Object.values(ia)[15&p])}u.increment();const T=o[u.get()],C=Object.values(mn)[T>>5],I=Object.values(mn)[T>>2&7],L=Object.values(co)[3&T];u.increment();const B=wr(o,u,2),F=B[0];return{physicalStreamType:g,logicalStreamType:x,logicalLevelTechnique1:C,logicalLevelTechnique2:I,physicalLevelTechnique:L,numValues:F,byteLength:B[1],decompressedCount:F}})(i,e);return n.logicalLevelTechnique1===mn.MORTON?(function(o,u,p){const g=wr(u,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:g[0],coordinateShift:g[1]}})(n,i,e):mn.RLE!==n.logicalLevelTechnique1&&mn.RLE!==n.logicalLevelTechnique2||co.NONE===n.physicalLevelTechnique?n:(function(o,u,p){const g=wr(u,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:g[1],runs:g[0],numRleValues:g[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(uo||(uo={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(xc||(xc={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(ia||(ia={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(er||(er={}));class ho{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const o=Math.floor(e/8);this.values[o]=this.values[o]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function aa(i,e,n,o,u){return(function(p,g,x){switch(g.logicalLevelTechnique1){case mn.DELTA:return g.logicalLevelTechnique2===mn.RLE?(function(T,C,I){const L=new Int32Array(I);let B=0,F=0;for(let G=0;G<C;G++){const H=T[G],Y=Rr(T[G+C]);for(let J=0;J<H;J++)F+=Y,L[B++]=F}return L})(p,g.runs,g.numRleValues):((function(T){T[0]=T[0]>>>1^-(1&T[0]);const C=T.length/4*4;let I=1;if(C>=4)for(;I<C-4;I+=4){const L=T[I],B=T[I+1],F=T[I+2],G=T[I+3];T[I]=(L>>>1^-(1&L))+T[I-1],T[I+1]=(B>>>1^-(1&B))+T[I],T[I+2]=(F>>>1^-(1&F))+T[I+1],T[I+3]=(G>>>1^-(1&G))+T[I+2]}for(;I!=T.length;++I)T[I]=(T[I]>>>1^-(1&T[I]))+T[I-1]})(p),p);case mn.RLE:return(function(T,C,I){return I?(function(L,B,F){const G=new Int32Array(F);let H=0;for(let Y=0;Y<B;Y++){const J=L[Y];let de=L[Y+B];de=de>>>1^-(1&de),G.fill(de,H,H+J),H+=J}return G})(T,C.runs,C.numRleValues):Uo(T,C.runs,C.numRleValues)})(p,g,x);case mn.MORTON:return bc(p),p;case mn.COMPONENTWISE_DELTA:return Fm(p),p;case mn.NONE:return x&&(function(T){for(let C=0;C<T.length;C++){const I=T[C];T[C]=I>>>1^-(1&I)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${g.logicalLevelTechnique1}`)}})(Sp(i,e,n),n,o)}function wc(i,e,n){return(function(o,u){if(u.logicalLevelTechnique1===mn.DELTA&&u.logicalLevelTechnique2===mn.NONE)return(function(g){const x=new Int32Array(g.length+1);x[0]=0,x[1]=Rr(g[0]);let T=x[1],C=2;for(;C!=x.length;++C){const I=g[C-1];T+=I>>>1^-(1&I),x[C]=x[C-1]+T}return x})(o);if(u.logicalLevelTechnique1===mn.RLE&&u.logicalLevelTechnique2===mn.NONE)return(function(g,x,T){const C=new Int32Array(T+1);C[0]=0;let I=1,L=C[0];for(let B=0;B<x;B++){const F=g[B],G=g[B+x];for(let H=I;H<I+F;H++)C[H]=G+L,L=C[H];I+=F}return C})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===mn.NONE&&u.logicalLevelTechnique2===mn.NONE){(function(g){let x=0;for(let T=0;T<g.length;T++)g[T]+=x,x=g[T]})(o);const p=new Int32Array(u.numValues+1);return p[0]=0,p.set(o,1),p}if(u.logicalLevelTechnique1===mn.DELTA&&u.logicalLevelTechnique2===mn.RLE){const p=(function(g,x,T){const C=new Int32Array(T+1);C[0]=0;let I=1,L=C[0];for(let B=0;B<x;B++){const F=g[B];let G=g[B+x];G=G>>>1^-(1&G);for(let H=I;H<I+F;H++)C[H]=G+L,L=C[H];I+=F}return C})(o,u.runs,u.numRleValues);return bc(p),p}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Sp(i,e,n),n)}function Sp(i,e,n){const o=n.physicalLevelTechnique;if(o===co.FAST_PFOR)return Rh();if(o===co.VARINT)return wr(i,e,n.numValues);if(o===co.NONE){const u=e.get();e.add(n.byteLength);const p=i.subarray(u,e.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Um(i,e,n,o){const u=Sp(i,e,n);if(u.length===1){const p=u[0];return o?Rr(p):p}return o?(function(p){return Rr(p[1])})(u):(function(p){return p[1]})(u)}function Vm(i,e,n){return(function(o){if(o.length==2){const u=Rr(o[1]);return[u,u]}return[Rr(o[2]),Rr(o[3])]})(Sp(i,e,n))}function Cu(i,e,n){return(function(o){if(o.length==2){const u=Au(o[1]);return[u,u]}return[Au(o[2]),Au(o[3])]})(Vd(i,e,n.numValues))}function Lh(i,e,n,o){return(function(u,p,g){switch(p.logicalLevelTechnique1){case mn.DELTA:return p.logicalLevelTechnique2===mn.RLE?(function(x,T,C){const I=new BigInt64Array(C);let L=0,B=0n;for(let F=0;F<T;F++){const G=Number(x[F]),H=Au(x[F+T]);for(let Y=0;Y<G;Y++)B+=H,I[L++]=B}return I})(u,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>1n^-(1n&x[0]);const T=x.length/4*4;let C=1;if(T>=4)for(;C<T-4;C+=4){const I=x[C],L=x[C+1],B=x[C+2],F=x[C+3];x[C]=(I>>1n^-(1n&I))+x[C-1],x[C+1]=(L>>1n^-(1n&L))+x[C],x[C+2]=(B>>1n^-(1n&B))+x[C+1],x[C+3]=(F>>1n^-(1n&F))+x[C+2]}for(;C!=x.length;++C)x[C]=(x[C]>>1n^-(1n&x[C]))+x[C-1]})(u),u);case mn.RLE:return(function(x,T,C){return C?(function(I,L,B){const F=new BigInt64Array(B);let G=0;for(let H=0;H<L;H++){const Y=Number(I[H]);let J=I[H+L];J=J>>1n^-(1n&J),F.fill(J,G,G+Y),G+=Y}return F})(x,T.runs,T.numRleValues):ey(x,T.runs,T.numRleValues)})(u,p,g);case mn.NONE:return g&&(function(x){for(let T=0;T<x.length;T++){const C=x[T];x[T]=C>>1n^-(1n&C)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(Vd(i,e,n.numValues),n,o)}function qm(i,e,n,o){const u=Vd(i,e,n.numValues);if(u.length===1){const p=u[0];return o?Au(p):p}return o?(function(p){return Au(p[1])})(u):(function(p){return p[1]})(u)}function Gm(i,e,n,o,u){return(function(p,g,x,T){switch(g.logicalLevelTechnique1){case mn.DELTA:return g.logicalLevelTechnique2===mn.RLE&&(p=Uo(p,g.runs,g.numRleValues)),(function(C,I){const L=new Int32Array(C.size());let B=0;C.get(0)?(L[0]=C.get(0)?I[0]>>>1^-(1&I[0]):0,B=1):L[0]=0;let F=1;for(;F!=L.length;++F)L[F]=C.get(F)?L[F-1]+(I[B]>>>1^-(1&I[B++])):L[F-1];return L})(T,p);case mn.RLE:return(function(C,I,L,B){const F=I;return L?(function(G,H,Y){const J=new Int32Array(G.size());let de=0;for(let ee=0;ee<Y;ee++){const ae=H[ee];let me=H[ee+Y];me=me>>>1^-(1&me);for(let ve=de;ve<de+ae;ve++)G.get(ve)?J[ve]=me:(J[ve]=0,de++);de+=ae}return J})(B,C,F.runs):(function(G,H,Y){const J=new Int32Array(G.size());let de=0;for(let ee=0;ee<Y;ee++){const ae=H[ee],me=H[ee+Y];for(let ve=de;ve<de+ae;ve++)G.get(ve)?J[ve]=me:(J[ve]=0,de++);de+=ae}return J})(B,C,F.runs)})(p,g,x,T);case mn.MORTON:return bc(p),p;case mn.COMPONENTWISE_DELTA:return Fm(p),p;case mn.NONE:return p=x?(function(C,I){const L=new Int32Array(C.size());let B=0,F=0;for(;F!=L.length;++F)if(C.get(F)){const G=I[B++];L[F]=G>>>1^-(1&G)}else L[F]=0;return L})(T,p):(function(C,I){const L=new Int32Array(C.size());let B=0,F=0;for(;F!=L.length;++F)L[F]=C.get(F)?I[B++]:0;return L})(T,p),p;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===co.FAST_PFOR?Rh():wr(i,e,n.numValues),n,o,u)}function zl(i,e,n,o){const u=i.logicalLevelTechnique1;if(u===mn.RLE)return i.runs===1?er.CONST:er.FLAT;const p=e instanceof ho?e.size():e;if(u===mn.DELTA&&i.logicalLevelTechnique2===mn.RLE){const g=i.runs,x=2;if(i.numRleValues!==p)return er.FLAT;if(g===1)return er.SEQUENCE;if(g===2){const T=o.get();let C;if(i.physicalLevelTechnique===co.VARINT)C=wr(n,o,4);else{const I=o.get();C=new Int32Array(n.buffer,n.byteOffset+I,4)}if(o.set(T),C[2]===x&&C[3]===x)return er.SEQUENCE}}return i.numValues===1?er.CONST:er.FLAT}class Oh extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Zm extends Om{constructor(e,n,o,u){super(e,BigInt64Array.of(n),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Pl{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,o){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function qd(i,e,n){return{x:Ep(i,e)-n,y:Ep(i>>1,e)-n}}function Ep(i,e){let n=0;for(let o=0;o<e;o++)n|=(i&1<<2*o)>>o;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(br||(br={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(ls||(ls={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(Ta||(Ta={}));class Mp{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function Hm(i){const e=new Array(i.numGeometries);let n=1,o=1,u=1,p=0;const g=new Mp;let x=0,T=0;const C=i.mortonSettings,I=i.topologyVector,L=I.geometryOffsets,B=I.partOffsets,F=I.ringOffsets,G=i.vertexOffsets,H=i.containsPolygonGeometry(),Y=i.vertexBuffer;for(let J=0;J<i.numGeometries;J++){const de=i.geometryType(J);if(de===br.POINT){if(G&&G.length!==0)if(i.vertexBufferType===Ta.VEC_2){const ee=2*G[T++],ae=new N(Y[ee],Y[ee+1]);e[p++]=g.createPoint(ae)}else{const ee=qd(Y[G[T++]],C.numBits,C.coordinateShift),ae=new N(ee.x,ee.y);e[p++]=g.createPoint(ae)}else{const ee=new N(Y[x++],Y[x++]);e[p++]=g.createPoint(ee)}L&&u++,B&&n++,F&&o++}else if(de===br.MULTIPOINT){const ee=L[u]-L[u-1];u++;const ae=new Array(ee);if(G&&G.length!==0){for(let me=0;me<ee;me++){const ve=2*G[T++];ae[me]=new N(Y[ve],Y[ve+1])}e[p++]=g.createMultiPoint(ae)}else{for(let me=0;me<ee;me++){const ve=Y[x++],Ue=Y[x++];ae[me]=new N(ve,Ue)}e[p++]=g.createMultiPoint(ae)}}else if(de===br.LINESTRING){let ee,ae=0;H?(ae=F[o]-F[o-1],o++):ae=B[n]-B[n-1],n++,G&&G.length!==0?(ee=i.vertexBufferType===Ta.VEC_2?Hd(Y,G,T,ae,!1):Xm(Y,G,T,ae,!1,C),T+=ae):(ee=$m(Y,x,ae,!1),x+=2*ae),e[p++]=g.createLineString(ee),L&&u++}else if(de===br.POLYGON){const ee=B[n]-B[n-1];n++;const ae=new Array(ee-1);let me=F[o]-F[o-1];if(o++,G&&G.length!==0){const ve=i.vertexBufferType===Ta.VEC_2?Ap(Y,G,T,me):Zd(Y,G,T,me,0,C);T+=me;for(let Ue=0;Ue<ae.length;Ue++)me=F[o]-F[o-1],o++,ae[Ue]=i.vertexBufferType===Ta.VEC_2?Ap(Y,G,T,me):Zd(Y,G,T,me,0,C),T+=me;e[p++]=g.createPolygon(ve,ae)}else{const ve=Gd(Y,x,me);x+=2*me;for(let Ue=0;Ue<ae.length;Ue++)me=F[o]-F[o-1],o++,ae[Ue]=Gd(Y,x,me),x+=2*me;e[p++]=g.createPolygon(ve,ae)}L&&u++}else if(de===br.MULTILINESTRING){const ee=L[u]-L[u-1];u++;const ae=new Array(ee);if(G&&G.length!==0){for(let me=0;me<ee;me++){let ve=0;H?(ve=F[o]-F[o-1],o++):ve=B[n]-B[n-1],n++;const Ue=i.vertexBufferType===Ta.VEC_2?Hd(Y,G,T,ve,!1):Xm(Y,G,T,ve,!1,C);ae[me]=Ue,T+=ve}e[p++]=g.createMultiLineString(ae)}else{for(let me=0;me<ee;me++){let ve=0;H?(ve=F[o]-F[o-1],o++):ve=B[n]-B[n-1],n++,ae[me]=$m(Y,x,ve,!1),x+=2*ve}e[p++]=g.createMultiLineString(ae)}}else{if(de!==br.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ee=L[u]-L[u-1];u++;const ae=new Array(ee);let me=0;if(G&&G.length!==0){for(let ve=0;ve<ee;ve++){const Ue=B[n]-B[n-1];n++;const ot=new Array(Ue-1);me=F[o]-F[o-1],o++;const et=i.vertexBufferType===Ta.VEC_2?Ap(Y,G,T,me):Zd(Y,G,T,me,0,C);T+=me;for(let pt=0;pt<ot.length;pt++)me=F[o]-F[o-1],o++,ot[pt]=i.vertexBufferType===Ta.VEC_2?Ap(Y,G,T,me):Zd(Y,G,T,me,0,C),T+=me;ae[ve]=g.createPolygon(et,ot)}e[p++]=g.createMultiPolygon(ae)}else{for(let ve=0;ve<ee;ve++){const Ue=B[n]-B[n-1];n++;const ot=new Array(Ue-1);me=F[o]-F[o-1],o++;const et=Gd(Y,x,me);x+=2*me;for(let pt=0;pt<ot.length;pt++){const Dt=F[o]-F[o-1];o++,ot[pt]=Gd(Y,x,Dt),x+=2*Dt}ae[ve]=g.createPolygon(et,ot)}e[p++]=g.createMultiPolygon(ae)}}}}return e}function Gd(i,e,n){return $m(i,e,n,!0)}function Ap(i,e,n,o){return Hd(i,e,n,o,!0)}function Zd(i,e,n,o,u,p){return Xm(i,e,n,o,!0,p)}function $m(i,e,n,o){const u=new Array(o?n+1:n);for(let p=0;p<2*n;p+=2)u[p/2]=new N(i[e+p],i[e+p+1]);return o&&(u[u.length-1]=u[0]),u}function Hd(i,e,n,o,u){const p=new Array(u?o+1:o);for(let g=0;g<2*o;g+=2){const x=2*e[n+g/2];p[g/2]=new N(i[x],i[x+1])}return u&&(p[p.length-1]=p[0]),p}function Xm(i,e,n,o,u,p){const g=new Array(u?o+1:o);for(let x=0;x<o;x++){const T=qd(i[e[n+x]],p.numBits,p.coordinateShift);g[x]=new N(T.x,T.y)}return u&&(g[g.length-1]=g[0]),g}class $d{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,o,u,p){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=p}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Hm(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=qd(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return Hm(this)}get mortonSettings(){return this._mortonSettings}}class Xd extends $d{_numGeometries;_geometryType;constructor(e,n,o,u,p,g,x){super(o,u,p,g,x),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===br.POLYGON||this._geometryType===br.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Yd extends $d{_geometryTypes;constructor(e,n,o,u,p,g){super(e,o,u,p,g),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===br.POLYGON||this.geometryType(e)===br.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class ny{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,o,u){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,o=n.partOffsets,u=n.ringOffsets,p=n.geometryOffsets;let g=0,x=1,T=1,C=1;for(let I=0;I<this.numGeometries;I++)switch(this.geometryType(I)){case br.POLYGON:{const L=o[x]-o[x-1];x++;const B=[];for(let F=0;F<L;F++){const G=u[T]-u[T-1];T++;const H=[];for(let Y=0;Y<G;Y++){const J=this._vertexBuffer[g++],de=this._vertexBuffer[g++];H.push(new N(J,de))}H.length>0&&H.push(H[0]),B.push(H)}e[I]=B,p&&C++}break;case br.MULTIPOLYGON:{const L=p[C]-p[C-1];C++;const B=[];for(let F=0;F<L;F++){const G=o[x]-o[x-1];x++;for(let H=0;H<G;H++){const Y=u[T]-u[T-1];T++;const J=[];for(let de=0;de<Y;de++){const ee=this._vertexBuffer[g++],ae=this._vertexBuffer[g++];J.push(new N(ee,ae))}J.length>0&&J.push(J[0]),B.push(J)}}e[I]=B}}return e}[Symbol.iterator](){return null}}function Bh(i,e,n,o,u,p){return new r_(i,e,n,o,u,p)}class r_ extends ny{_numGeometries;_geometryType;constructor(e,n,o,u,p,g){super(o,u,p,g),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Ym(i,e,n,o,u){return new iy(i,e,n,o,u)}class iy extends ny{_geometryTypes;constructor(e,n,o,u,p){super(n,o,u,p),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function ry(i,e,n,o,u){const p=ra(i,n);let g=null,x=null,T=null,C=null,I=null,L=null,B=null,F=null;if(zl(p,o,i,n)===er.CONST){const H=Um(i,n,p,!1);for(let Y=0;Y<e-1;Y++){const J=ra(i,n);switch(J.physicalStreamType){case kr.LENGTH:switch(J.logicalStreamType.lengthType){case ia.GEOMETRIES:g=wc(i,n,J);break;case ia.PARTS:x=wc(i,n,J);break;case ia.RINGS:T=wc(i,n,J);break;case ia.TRIANGLES:B=wc(i,n,J)}break;case kr.OFFSET:switch(J.logicalStreamType.offsetType){case xc.VERTEX:C=aa(i,n,J,!1);break;case xc.INDEX:F=aa(i,n,J,!1)}break;case kr.DATA:uo.VERTEX===J.logicalStreamType.dictionaryType?I=aa(i,n,J,!0):(L={numBits:J.numBits,coordinateShift:J.coordinateShift},I=aa(i,n,J,!1))}}return F!==null?g!=null||x!=null?Bh(o,H,B,F,I,new Pl(g,x,T)):Bh(o,H,B,F,I):L===null?(function(Y,J,de,ee,ae){return new Xd(Y,J,Ta.VEC_2,de,ee,ae)})(o,H,new Pl(g,x,T),C,I):(function(Y,J,de,ee,ae,me){return new Xd(Y,J,Ta.MORTON,de,ee,ae,me)})(o,H,new Pl(g,x,T),C,I,L)}const G=aa(i,n,p,!1);for(let H=0;H<e-1;H++){const Y=ra(i,n);switch(Y.physicalStreamType){case kr.LENGTH:switch(Y.logicalStreamType.lengthType){case ia.GEOMETRIES:g=aa(i,n,Y,!1);break;case ia.PARTS:x=aa(i,n,Y,!1);break;case ia.RINGS:T=aa(i,n,Y,!1);break;case ia.TRIANGLES:B=wc(i,n,Y)}break;case kr.OFFSET:switch(Y.logicalStreamType.offsetType){case xc.VERTEX:C=aa(i,n,Y,!1);break;case xc.INDEX:F=aa(i,n,Y,!1)}break;case kr.DATA:uo.VERTEX===Y.logicalStreamType.dictionaryType?I=aa(i,n,Y,!0):(L={numBits:Y.numBits,coordinateShift:Y.coordinateShift},I=aa(i,n,Y,!1))}}return F!==null&&x===null?Ym(G,B,F,I):(g!==null?(g=Cp(G,g,2),x!==null&&T!==null?(x=zp(G,g,x,!1),T=(function(H,Y,J,de){const ee=new Int32Array(J[J.length-1]+1);let ae=0;ee[0]=ae;let me=1,ve=1,Ue=0;for(let ot=0;ot<H.length;ot++){const et=H[ot],pt=Y[ot+1]-Y[ot];if(et!==0&&et!==3)for(let Dt=0;Dt<pt;Dt++){const yt=J[me]-J[me-1];me++;for(let rt=0;rt<yt;rt++)ae=ee[ve++]=ae+de[Ue++]}else for(let Dt=0;Dt<pt;Dt++)ee[ve++]=++ae,me++}return ee})(G,g,x,T)):x!==null&&(x=(function(H,Y,J){const de=new Int32Array(Y[Y.length-1]+1);let ee=0;de[0]=ee;let ae=1,me=0;for(let ve=0;ve<H.length;ve++){const Ue=H[ve],ot=Y[ve+1]-Y[ve];if(Ue===4||Ue===1)for(let et=0;et<ot;et++)ee=de[ae++]=ee+J[me++];else for(let et=0;et<ot;et++)de[ae++]=++ee}return de})(G,g,x))):x!==null&&T!==null?(x=Cp(G,x,1),T=zp(G,x,T,!0)):x!==null&&(x=Cp(G,x,0)),F!==null?Ym(G,B,F,I,new Pl(g,x,T)):L===null?(function(H,Y,J,de){return new Yd(Ta.VEC_2,H,Y,J,de)})(G,new Pl(g,x,T),C,I):(function(H,Y,J,de,ee){return new Yd(Ta.MORTON,H,Y,J,de,ee)})(G,new Pl(g,x,T),C,I,L))}function Cp(i,e,n){const o=new Int32Array(i.length+1);let u=0;o[0]=u;let p=0;for(let g=0;g<i.length;g++)u=o[g+1]=u+(i[g]>n?e[p++]:1);return o}function zp(i,e,n,o){const u=new Int32Array(e[e.length-1]+1);let p=0;u[0]=p;let g=1,x=0;for(let T=0;T<i.length;T++){const C=i[T],I=e[T+1]-e[T];if(C===5||C===2||o&&(C===4||C===1))for(let L=0;L<I;L++)p=u[g++]=p+n[x++];else for(let L=0;L<I;L++)u[g++]=++p}return u}class ay extends _c{dataVector;constructor(e,n,o){super(e,n.getBuffer(),o),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class sy extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Wd extends _c{constructor(e,n,o){super(e,BigInt64Array.of(n),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Kd(i,e,n){return oy(i,Math.ceil(e/8),n)}function oy(i,e,n){const o=new Uint8Array(e);let u=0;for(;u<e;){const p=i[n.increment()];if(p<=127){const g=p+3,x=i[n.increment()],T=u+g;o.fill(x,u,T),u=T}else{const g=256-p;for(let x=0;x<g;x++)o[u++]=i[n.increment()]}}return o}const Wm=new TextDecoder;function Qd(i,e,n){return n-e>=12?Wm.decode(i.subarray(e,n)):(function(o,u,p){let g="",x=u;for(;x<p;){const T=o[x];let C,I,L,B=null,F=T>239?4:T>223?3:T>191?2:1;if(x+F>p)break;F===1?T<128&&(B=T):F===2?(C=o[x+1],(192&C)==128&&(B=(31&T)<<6|63&C,B<=127&&(B=null))):F===3?(C=o[x+1],I=o[x+2],(192&C)==128&&(192&I)==128&&(B=(15&T)<<12|(63&C)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(C=o[x+1],I=o[x+2],L=o[x+3],(192&C)==128&&(192&I)==128&&(192&L)==128&&(B=(15&T)<<18|(63&C)<<12|(63&I)<<6|63&L,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),x+=F}return g})(i,e,n)}class Nh extends _c{offsetBuffer;constructor(e,n,o,u){super(e,o,u),this.offsetBuffer=n}}class Pp extends Nh{textEncoder;constructor(e,n,o,u){super(e,n,o,u??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Qd(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class zu extends Nh{indexBuffer;textEncoder;constructor(e,n,o,u,p){super(e,o,u,p??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return Qd(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class Dp extends Nh{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,o,u,p,g,x){super(e,o,u,x),this.indexBuffer=n,this.symbolOffsetBuffer=p,this.symbolTableBuffer=g,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,p){const g=[],x=new Array(u.length).fill(0);for(let T=1;T<u.length;T++)x[T]=x[T-1]+u[T-1];for(let T=0;T<p.length;T++)if(p[T]===255)g.push(p[++T]);else{const C=u[p[T]],I=x[p[T]];for(let L=0;L<C;L++)g.push(o[I+L])}return new Uint8Array(g)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return Qd(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const p=e[u];n[u-1]=p-o,o=p}return n}}function Tc(i,e,n,o,u,p){return n.type==="scalarType"?(function(g,x,T,C,I,L){let B=null,F=0;if(g===0)return null;if(L.nullable){const H=ra(x,T);F=H.numValues;const Y=T.get(),J=Kd(x,F,T);T.set(Y+H.byteLength),B=new ho(J,H.numValues)}const G=B??C;switch(I.physicalType){case 4:case 3:return(function(H,Y,J,de,ee){const ae=ra(H,Y),me=zl(ae,ee,H,Y),ve=de.physicalType===3;if(me===er.FLAT){const Ue=Ns(ee)?Gm(H,Y,ae,ve,ee):aa(H,Y,ae,ve);return new wp(J.name,Ue,ee)}if(me===er.SEQUENCE){const Ue=Vm(H,Y,ae);return new Bm(J.name,Ue[0],Ue[1],ae.numRleValues)}{const Ue=Um(H,Y,ae,ve);return new Nm(J.name,Ue,ee)}})(x,T,L,I,G);case 9:return(function(H,Y,J,de,ee){let ae=null,me=null,ve=null,Ue=null,ot=null,et=null,pt=null,Dt=null;for(let yt=0;yt<de;yt++){const rt=ra(Y,J);if(rt.byteLength!==0)switch(rt.physicalStreamType){case kr.PRESENT:{const He=Kd(Y,rt.numValues,J);et=new ho(He,rt.numValues);break}case kr.OFFSET:me=ee!=null||et!=null?Gm(Y,J,rt,!1,ee??et):aa(Y,J,rt,!1);break;case kr.LENGTH:{const He=wc(Y,J,rt);ia.DICTIONARY===rt.logicalStreamType.lengthType?ae=He:ia.SYMBOL===rt.logicalStreamType.lengthType?Ue=He:pt=He;break}case kr.DATA:{const He=Y.subarray(J.get(),J.get()+rt.byteLength);J.add(rt.byteLength);const jt=rt.logicalStreamType.dictionaryType;uo.FSST===jt?ot=He:uo.SINGLE===jt||uo.SHARED===jt?ve=He:uo.NONE===jt&&(Dt=He);break}}}return(function(yt,rt,He,jt,Bt,Gt,Lt){return rt?new Dp(yt,He,jt,Bt,Gt,rt,Lt):null})(H,ot,me,ae,ve,Ue,ee??et)??(function(yt,rt,He,jt,Bt){return rt?Bt?new zu(yt,He,jt,rt,Bt):new zu(yt,He,jt,rt):null})(H,ve,me,ae,ee??et)??(function(yt,rt,He,jt,Bt){if(!rt||!He)return null;if(jt)return Bt?new zu(yt,jt,rt,He,Bt):new zu(yt,jt,rt,He);if(Bt&&Bt.size()!==rt.length-1){const Gt=new Int32Array(Bt.size());let Lt=0;for(let Kt=0;Kt<Bt.size();Kt++)Gt[Kt]=Bt.get(Kt)?Lt++:0;return new zu(yt,Gt,rt,He,Bt)}return Bt?new Pp(yt,rt,He,Bt):new Pp(yt,rt,He)})(H,pt,Dt,me,ee??et)})(L.name,x,T,L.nullable?g-1:g,B);case 0:return(function(H,Y,J,de,ee){const ae=ra(H,Y),me=ae.numValues,ve=Y.get(),Ue=Ns(ee)?(function(et,pt,Dt,yt){const rt=oy(et,Math.ceil(pt/8),Dt),He=new ho(rt,pt),jt=yt.size(),Bt=new ho(new Uint8Array(jt),jt);let Gt=0;for(let Lt=0;Lt<yt.size();Lt++){const Kt=!!yt.get(Lt)&&He.get(Gt++);Bt.set(Lt,Kt)}return Bt.getBuffer()})(H,me,Y,ee):Kd(H,me,Y);Y.set(ve+ae.byteLength);const ot=new ho(Ue,me);return new ay(J.name,ot,ee)})(x,T,L,0,G);case 6:case 5:return(function(H,Y,J,de,ee){const ae=ra(H,Y),me=zl(ae,de,H,Y),ve=ee.physicalType===5;if(me===er.FLAT){const Ue=Ns(de)?(function(ot,et,pt,Dt,yt){return(function(rt,He,jt,Bt){switch(He.logicalLevelTechnique1){case mn.DELTA:return He.logicalLevelTechnique2===mn.RLE&&(rt=ey(rt,He.runs,He.numRleValues)),(function(Gt,Lt){const Kt=new BigInt64Array(Gt.size());let Pn=0;Gt.get(0)?(Kt[0]=Gt.get(0)?Lt[0]>>1n^-(1n&Lt[0]):0n,Pn=1):Kt[0]=0n;let _n=1;for(;_n!=Kt.length;++_n)Kt[_n]=Gt.get(_n)?Kt[_n-1]+(Lt[Pn]>>1n^-(1n&Lt[Pn++])):Kt[_n-1];return Kt})(Bt,rt);case mn.RLE:return(function(Gt,Lt,Kt,Pn){const _n=Lt;return Kt?(function(Di,sa,Tr){const Ii=new BigInt64Array(Di.size());let wi=0;for(let Hn=0;Hn<Tr;Hn++){const $i=Number(sa[Hn]);let tr=sa[Hn+Tr];tr=tr>>1n^-(1n&tr);for(let _i=wi;_i<wi+$i;_i++)Di.get(_i)?Ii[_i]=tr:(Ii[_i]=0n,wi++);wi+=$i}return Ii})(Pn,Gt,_n.runs):(function(Di,sa,Tr){const Ii=new BigInt64Array(Di.size());let wi=0;for(let Hn=0;Hn<Tr;Hn++){const $i=Number(sa[Hn]),tr=sa[Hn+Tr];for(let _i=wi;_i<wi+$i;_i++)Di.get(_i)?Ii[_i]=tr:(Ii[_i]=0n,wi++);wi+=$i}return Ii})(Pn,Gt,_n.runs)})(rt,He,jt,Bt);case mn.NONE:return rt=jt?(function(Gt,Lt){const Kt=new BigInt64Array(Gt.size());let Pn=0,_n=0;for(;_n!=Kt.length;++_n)if(Gt.get(_n)){const Di=Lt[Pn++];Kt[_n]=Di>>1n^-(1n&Di)}else Kt[_n]=0n;return Kt})(Bt,rt):(function(Gt,Lt){const Kt=new BigInt64Array(Gt.size());let Pn=0,_n=0;for(;_n!=Kt.length;++_n)Kt[_n]=Gt.get(_n)?Lt[Pn++]:0n;return Kt})(Bt,rt),rt;default:throw new Error("The specified Logical level technique is not supported")}})(Vd(ot,et,pt.numValues),pt,Dt,yt)})(H,Y,ae,ve,de):Lh(H,Y,ae,ve);return new Oh(J.name,Ue,de)}if(me===er.SEQUENCE){const Ue=Cu(H,Y,ae);return new Zm(J.name,Ue[0],Ue[1],ae.numRleValues)}{const Ue=qm(H,Y,ae,ve);return new Wd(J.name,Ue,de)}})(x,T,L,G,I);case 7:return(function(H,Y,J,de){const ee=ra(H,Y),ae=Ns(de)?(function(me,ve,Ue,ot){const et=ve.get(),pt=et+ot*Float32Array.BYTES_PER_ELEMENT,Dt=new Uint8Array(me.subarray(et,pt)).buffer,yt=new Float32Array(Dt);ve.set(pt);const rt=Ue.size(),He=new Float32Array(rt);let jt=0;for(let Bt=0;Bt<rt;Bt++)He[Bt]=Ue.get(Bt)?yt[jt++]:0;return He})(H,Y,de,ee.numValues):(function(me,ve,Ue){const ot=ve.get(),et=ot+Ue*Float32Array.BYTES_PER_ELEMENT,pt=new Uint8Array(me.subarray(ot,et)).buffer,Dt=new Float32Array(pt);return ve.set(et),Dt})(H,Y,ee.numValues);return new sy(J.name,ae,de)})(x,T,L,G);case 8:return(function(H,Y,J,de){const ee=ra(H,Y),ae=Ns(de)?(function(me,ve,Ue,ot){const et=ve.get(),pt=et+ot*Float64Array.BYTES_PER_ELEMENT,Dt=new Uint8Array(me.subarray(et,pt)).buffer,yt=new Float64Array(Dt);ve.set(pt);const rt=Ue.size(),He=new Float64Array(rt);let jt=0;for(let Bt=0;Bt<rt;Bt++)He[Bt]=Ue.get(Bt)?yt[jt++]:0;return He})(H,Y,de,ee.numValues):(function(me,ve,Ue){const ot=ve.get(),et=ot+Ue*Float64Array.BYTES_PER_ELEMENT,pt=new Uint8Array(me.subarray(ot,et)).buffer,Dt=new Float64Array(pt);return ve.set(et),Dt})(H,Y,ee.numValues);return new Lm(J.name,ae,de)})(x,T,L,G);default:throw new Error(`The specified data type for the field is currently not supported: ${I}`)}})(o,i,e,u,n.scalarType,n):o!=1?null:(function(g,x,T,C){let I=null,L=null,B=null,F=null,G=!1;for(;!G;){const de=ra(g,x);switch(de.physicalStreamType){case kr.LENGTH:ia.DICTIONARY===de.logicalStreamType.lengthType?I=wc(g,x,de):B=wc(g,x,de);break;case kr.DATA:uo.SINGLE===de.logicalStreamType.dictionaryType||uo.SHARED===de.logicalStreamType.dictionaryType?(L=g.subarray(x.get(),x.get()+de.byteLength),G=!0):F=g.subarray(x.get(),x.get()+de.byteLength),x.add(de.byteLength)}}const H=T.complexType.children,Y=[];let J=0;for(const de of H){const ee=wr(g,x,1)[0];if(ee==0)continue;const ae=`${T.name}${de.name==="default"?"":":"+de.name}`;if(ee!==2||de.type!=="scalarField"||de.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const me=ra(g,x),ve=Kd(g,me.numValues,x),Ue=ra(g,x),ot=Ue.decompressedCount!==C?Gm(g,x,Ue,!1,new ho(ve,me.numValues)):aa(g,x,Ue,!1);Y[J++]=F?new Dp(ae,ot,I,L,B,F,new ho(ve,me.numValues)):new zu(ae,ot,I,L,new ho(ve,me.numValues))}return Y})(i,e,n,u)}function Ns(i){return i instanceof ho}function Sc(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Jd=new TextDecoder;function Fh(i,e){const n=wr(i,e,1)[0];if(n===0)return"";const o=e.get(),u=i.subarray(o,o+n);return e.add(n),Jd.decode(u)}function Dl(i,e){const n=wr(i,e,1)[0]>>>0,o=!!(4&n),u=!!(2&n),p=wr(i,e,1)[0]>>>0,g={};if(1&n&&(g.nullable=!0),u){const x={};if(o?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),8&n){const T=wr(i,e,1)[0]>>>0;x.children=new Array(T);for(let C=0;C<T;C++)x.children[C]=Dl(i,e)}g.type="complexField",g.complexField=x}else{const x={};o?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),g.type="scalarField",g.scalarField=x}return g}function a_(i,e){const n=wr(i,e,1)[0]>>>0,o=(function(u){switch(u){case 0:case 1:case 2:case 3:{const p={};p.nullable=!!(1&u),p.columnScope=0;const g={};return g.physicalType=u>1?6:4,g.type="physicalType",p.scalarType=g,p.type="scalarType",p}case 4:{const p={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:0};return p.type="complexType",p.complexType=g,p}case 30:{const p={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:1};return p.type="complexType",p.complexType=g,p}default:return(function(p){let g=null;switch(p){case 10:case 11:g=0;break;case 12:case 13:g=1;break;case 14:case 15:g=2;break;case 16:case 17:g=3;break;case 18:case 19:g=4;break;case 20:case 21:g=5;break;case 22:case 23:g=6;break;case 24:case 25:g=7;break;case 26:case 27:g=8;break;case 28:case 29:g=9;break;default:return null}const x={};x.nullable=!!(1&p),x.columnScope=0;const T={type:"physicalType"};return T.physicalType=g,x.type="scalarType",x.scalarType=T,x})(u)}})(n);if(!o)throw new Error(`Unsupported column type code: ${n}`);if((function(u){return u>=10})(n)?o.name=Fh(i,e):n>=0&&n<=3?o.name="id":n===4&&(o.name="geometry"),(function(u){return u===30})(n)){const u=wr(i,e,1)[0]>>>0,p=o.complexType;p.children=new Array(u);for(let g=0;g<u;g++)p.children[g]=Dl(i,e)}return o}function ly(i,e){const n={featureTables:[]},o={};o.name=Fh(i,e);const u=wr(i,e,1)[0]>>>0,p=wr(i,e,1)[0]>>>0;o.columns=new Array(p);for(let g=0;g<p;g++)o.columns[g]=a_(i,e);return n.featureTables.push(o),[n,u]}function ef(i,e,n,o,u,p,g=!1){const x=e.scalarType.physicalType,T=zl(u,p,i,n);if(x===4)switch(T){case er.FLAT:{const C=aa(i,n,u,!1);return new wp(o,C,p)}case er.SEQUENCE:{const C=Vm(i,n,u);return new Bm(o,C[0],C[1],u.numRleValues)}case er.CONST:{const C=Um(i,n,u,!1);return new Nm(o,C,p)}}else switch(T){case er.FLAT:{if(g){const I=(function(L,B,F,G){const H=(function(Y,J,de){const ee=new Float64Array(J);for(let ae=0;ae<J;ae++)ee[ae]=Jg(Y,de);return ee})(L,F.numValues,B);return(function(Y,J,de){switch(J.logicalLevelTechnique1){case mn.DELTA:return J.logicalLevelTechnique2===mn.RLE&&(Y=ty(Y,J.runs,J.numRleValues)),(function(ee){ee[0]=ee[0]%2==1?(ee[0]+1)/-2:ee[0]/2;const ae=ee.length/4*4;let me=1;if(ae>=4)for(;me<ae-4;me+=4){const ve=ee[me],Ue=ee[me+1],ot=ee[me+2],et=ee[me+3];ee[me]=(ve%2==1?(ve+1)/-2:ve/2)+ee[me-1],ee[me+1]=(Ue%2==1?(Ue+1)/-2:Ue/2)+ee[me],ee[me+2]=(ot%2==1?(ot+1)/-2:ot/2)+ee[me+1],ee[me+3]=(et%2==1?(et+1)/-2:et/2)+ee[me+2]}for(;me!=ee.length;++me)ee[me]=(ee[me]%2==1?(ee[me]+1)/-2:ee[me]/2)+ee[me-1]})(Y),Y;case mn.RLE:return(function(ee,ae,me){return ty(ee,ae.runs,ae.numRleValues)})(Y,J);case mn.NONE:return Y;default:throw new Error(`The specified Logical level technique is not supported: ${J.logicalLevelTechnique1}`)}})(H,F)})(i,n,u);return new Lm(o,I,p)}const C=Lh(i,n,u,!1);return new Oh(o,C,p)}case er.SEQUENCE:{const C=Cu(i,n,u);return new Zm(o,C[0],C[1],u.numRleValues)}case er.CONST:{const C=qm(i,n,u,!1);return new Wd(o,C,p)}}throw new Error("Vector type not supported for id column.")}class s_{constructor(e,n){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case br.POINT:case br.MULTIPOINT:this.type=1;break;case br.LINESTRING:case br.MULTILINESTRING:this.type=2;break;case br.POLYGON:case br.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const o=[];for(const u of n)o.push(new N(u.x,u.y));e.push(o)}return e}}class cy{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new s_(this.features[e],this.extent)}}class tf{constructor(e){this.layers={};const n=(function(o,u,p=!0){const g=new Qg(0),x=[];for(;g.get()<o.length;){const T=wr(o,g,1)[0]>>>0,C=g.get()+T;if(C>o.length)throw new Error(`Block overruns tile: ${C} > ${o.length}`);if(wr(o,g,1)[0]>>>0!=1){g.set(C);continue}const I=ly(o,g),L=I[1],B=I[0].featureTables[0];let F=null,G=null;const H=[];let Y=0;for(const de of B.columns){const ee=de.name;if(ee==="id"){let ae=null;if(de.nullable){const ve=ra(o,g),Ue=g.get(),ot=Kd(o,ve.numValues,g);g.set(Ue+ve.byteLength),ae=new ho(ot,ve.numValues)}const me=ra(o,g);Y=me.decompressedCount,F=ef(o,de,g,ee,me,ae??Y,p)}else if(ee==="geometry"){const ae=wr(o,g,1)[0];if(Y===0){const me=g.get();Y=ra(o,g).decompressedCount,g.set(me)}G=ry(o,ae,g,Y)}else{const ae=Sc(de)?wr(o,g,1)[0]:1;if(ae===0&&de.type==="scalarType")continue;const me=Tc(o,g,de,ae,Y);if(me)if(Array.isArray(me))for(const ve of me)H.push(ve);else H.push(me)}}const J=new vc(B.name,G,F,H,L);x.push(J),g.set(C)}return x})(new Uint8Array(e));this.layers=n.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new cy(u)})),{})}}class uy{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of n){const u=[];for(const p of o)u.push(new N(p[0],p[1]));e.push(u)}return e}}const nf="_geojsonTileLayer";function Ip(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let p=0;p<i.length;p++)n.feature=i.feature(p),e.writeMessage(2,kp,n);const o=n.keys;for(const p of o)e.writeStringField(3,p);const u=n.values;for(const p of u)e.writeMessage(4,Rp,p)}function kp(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,hy,i),e.writeVarintField(3,n.type),e.writeMessage(4,Qm,n)}function hy(i,e){for(const n in i.feature?.properties){let o=i.feature.properties[n],u=i.keycache[n];if(o==null)continue;u===void 0&&(i.keys.push(n),u=i.keys.length-1,i.keycache[n]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const p=typeof o+":"+o;let g=i.valuecache[p];g===void 0&&(i.values.push(o),g=i.values.length-1,i.valuecache[p]=g),e.writeVarint(g)}}function Ec(i,e){return(e<<3)+(7&i)}function Km(i){return i<<1^i>>31}function Qm(i,e){const n=i.loadGeometry(),o=i.type;let u=0,p=0;for(const g of n){let x=1;o===1&&(x=g.length),e.writeVarint(Ec(1,x));const T=o===3?g.length-1:g.length;for(let C=0;C<T;C++){C===1&&o!==1&&e.writeVarint(Ec(2,T-1));const I=g[C].x-u,L=g[C].y-p;e.writeVarint(Km(I)),e.writeVarint(Km(L)),u+=I,p+=L}i.type===3&&e.writeVarint(Ec(7,1))}}function Rp(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Jm{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Do(vt,16,0),this.grid3D=new Do(vt,16,0),this.featureIndexArray=new Q,this.promoteId=n}insert(e,n,o,u,p,g){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,p);const T=g?this.grid3D:this.grid;for(let C=0;C<n.length;C++){const I=n[C],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<I.length;B++){const F=I[B];L[0]=Math.min(L[0],F.x),L[1]=Math.min(L[1],F.y),L[2]=Math.max(L[2],F.x),L[3]=Math.max(L[3],F.y)}L[0]<vt&&L[1]<vt&&L[2]>=0&&L[3]>=0&&T.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Sn(new sp(this.rawTileData)).layers:new tf(this.rawTileData).layers,this.sourceLayerCoder=new Rm(this.vtLayers?Object.keys(this.vtLayers).sort():[nf])),this.vtLayers}query(e,n,o,u){this.loadVTLayers();const p=e.params,g=vt/e.tileSize/e.scale,x=Wr(p.filter,p.globalState),T=e.queryGeometry,C=e.queryPadding*g,I=yc.fromPoints(T),L=this.grid.query(I.minX-C,I.minY-C,I.maxX+C,I.maxY+C),B=yc.fromPoints(e.cameraQueryGeometry).expandBy(C),F=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,((Y,J,de,ee)=>(function(ae,me,ve,Ue,ot){for(const pt of ae)if(me<=pt.x&&ve<=pt.y&&Ue>=pt.x&&ot>=pt.y)return!0;const et=[new N(me,ve),new N(me,ot),new N(Ue,ot),new N(Ue,ve)];if(ae.length>2){for(const pt of et)if(Oo(ae,pt))return!0}for(let pt=0;pt<ae.length-1;pt++)if(gg(ae[pt],ae[pt+1],et))return!0;return!1})(e.cameraQueryGeometry,Y-C,J-C,de+C,ee+C)));for(const Y of F)L.push(Y);L.sort(Lp);const G={};let H;for(let Y=0;Y<L.length;Y++){const J=L[Y];if(J===H)continue;H=J;const de=this.featureIndexArray.get(J);let ee=null;this.loadMatchingFeature(G,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,x,p.layers,p.availableImages,n,o,u,((ae,me,ve)=>(ee||(ee=ao(ae)),me.queryIntersectsFeature({queryGeometry:T,feature:ae,featureState:ve,geometry:ee,zoom:this.z,transform:e.transform,pixelsToTileUnits:g,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return G}loadMatchingFeature(e,n,o,u,p,g,x,T,C,I,L){const B=this.bucketLayerIDs[n];if(g&&!B.some((Y=>g.has(Y))))return;const F=this.sourceLayerCoder.decode(o),G=this.vtLayers[F].feature(u);if(p.needGeometry){const Y=as(G,!0);if(!p.filter(new Fn(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!p.filter(new Fn(this.tileID.overscaledZ),G))return;const H=this.getId(G,F);for(let Y=0;Y<B.length;Y++){const J=B[Y];if(g&&!g.has(J))continue;const de=T[J];if(!de)continue;let ee={};H&&I&&(ee=I.getState(de.sourceLayer||nf,H));const ae=ln({},C[J]);ae.paint=dy(ae.paint,de.paint,G,ee,x),ae.layout=dy(ae.layout,de.layout,G,ee,x);const me=!L||L(G,de,ee);if(!me)continue;const ve=new xp(G,this.z,this.x,this.y,H);ve.layer=ae;let Ue=e[J];Ue===void 0&&(Ue=e[J]=[]),Ue.push({featureIndex:u,feature:ve,intersectionZ:me})}}lookupSymbolFeatures(e,n,o,u,p,g,x,T){const C={};this.loadVTLayers();const I=Wr(p.filterSpec,p.globalState);for(const L of e)this.loadMatchingFeature(C,o,u,L,I,g,x,T,n);return C}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function dy(i,e,n,o,u){return Dn(i,((p,g)=>{const x=e instanceof fl?e.get(g):null;return x&&x.evaluate?x.evaluate(n,o,u):x}))}function Lp(i,e){return e-i}function r(i,e,n,o,u){const p=[];for(let g=0;g<i.length;g++){const x=i[g];let T;for(let C=0;C<x.length-1;C++){let I=x[C],L=x[C+1];I.x<e&&L.x<e||(I.x<e?I=new N(e,I.y+(e-I.x)/(L.x-I.x)*(L.y-I.y))._round():L.x<e&&(L=new N(e,I.y+(e-I.x)/(L.x-I.x)*(L.y-I.y))._round()),I.y<n&&L.y<n||(I.y<n?I=new N(I.x+(n-I.y)/(L.y-I.y)*(L.x-I.x),n)._round():L.y<n&&(L=new N(I.x+(n-I.y)/(L.y-I.y)*(L.x-I.x),n)._round()),I.x>=o&&L.x>=o||(I.x>=o?I=new N(o,I.y+(o-I.x)/(L.x-I.x)*(L.y-I.y))._round():L.x>=o&&(L=new N(o,I.y+(o-I.x)/(L.x-I.x)*(L.y-I.y))._round()),I.y>=u&&L.y>=u||(I.y>=u?I=new N(I.x+(u-I.y)/(L.y-I.y)*(L.x-I.x),u)._round():L.y>=u&&(L=new N(I.x+(u-I.y)/(L.y-I.y)*(L.x-I.x),u)._round()),T&&I.equals(T[T.length-1])||(T=[I],p.push(T)),T.push(L)))))}}return p}function s(i,e,n,o,u){switch(e){case 1:return(function(p,g,x,T){const C=[];for(const I of p)for(const L of I){const B=T===0?L.x:L.y;B>=g&&B<=x&&C.push([L])}return C})(i,n,o,u);case 2:return _(i,n,o,u,!1);case 3:return _(i,n,o,u,!0)}return[]}function d(i,e,n,o,u){const p=o===0?M:D;let g=[];const x=[];for(let I=0;I<i.length-1;I++){const L=i[I],B=i[I+1],F=o===0?L.x:L.y,G=o===0?B.x:B.y;let H=!1;F<e?G>e&&g.push(p(L,B,e)):F>n?G<n&&g.push(p(L,B,n)):g.push(L),G<e&&F>=e&&(g.push(p(L,B,e)),H=!0),G>n&&F<=n&&(g.push(p(L,B,n)),H=!0),!u&&H&&(x.push(g),g=[])}const T=i.length-1,C=o===0?i[T].x:i[T].y;return C>=e&&C<=n&&g.push(i[T]),u&&g.length>0&&!g[0].equals(g[g.length-1])&&g.push(new N(g[0].x,g[0].y)),g.length>0&&x.push(g),x}function _(i,e,n,o,u){const p=[];for(const g of i){const x=d(g,e,n,o,u);x.length>0&&p.push(...x)}return p}function M(i,e,n){return new N(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function D(i,e,n){return new N(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}Ot("FeatureIndex",Jm,{omit:["rawTileData","sourceLayerCoder"]});class q extends N{constructor(e,n,o,u){super(e,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new q(this.x,this.y,this.angle,this.segment)}}function te(i,e,n,o,u){if(e.segment===void 0||n===0)return!0;let p=e,g=e.segment+1,x=0;for(;x>-n/2;){if(g--,g<0)return!1;x-=i[g].dist(p),p=i[g]}x+=i[g].dist(i[g+1]),g++;const T=[];let C=0;for(;x<n/2;){const I=i[g],L=i[g+1];if(!L)return!1;let B=i[g-1].angleTo(I)-I.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:B}),C+=B;x-T[0].distance>o;)C-=T.shift().angleDelta;if(C>u)return!1;g++,x+=I.dist(L)}return!0}function Ee(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function Xe(i,e,n){return i?.6*e*n:0}function dt(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function xt(i,e,n,o,u,p){const g=Xe(n,u,p),x=dt(n,o)*p;let T=0;const C=Ee(i)/2;for(let I=0;I<i.length-1;I++){const L=i[I],B=i[I+1],F=L.dist(B);if(T+F>C){const G=(C-T)/F,H=pi.number(L.x,B.x,G),Y=pi.number(L.y,B.y,G),J=new q(H,Y,B.angleTo(L),I);return J._round(),!g||te(i,J,x,g,e)?J:void 0}T+=F}}function We(i,e,n,o,u,p,g,x,T){const C=Xe(o,p,g),I=dt(o,u),L=I*g,B=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-L<e/4&&(e=L+e/4),nt(i,B?e/2*x%e:(I/2+2*p)*g*x%e,e,C,n,L,B,!1,T)}function nt(i,e,n,o,u,p,g,x,T){const C=p/2,I=Ee(i);let L=0,B=e-n,F=[];for(let G=0;G<i.length-1;G++){const H=i[G],Y=i[G+1],J=H.dist(Y),de=Y.angleTo(H);for(;B+n<L+J;){B+=n;const ee=(B-L)/J,ae=pi.number(H.x,Y.x,ee),me=pi.number(H.y,Y.y,ee);if(ae>=0&&ae<T&&me>=0&&me<T&&B-C>=0&&B+C<=I){const ve=new q(ae,me,de,G);ve._round(),o&&!te(i,ve,p,o,u)||F.push(ve)}}L+=J}return x||F.length||g||(F=nt(i,L/2,n,o,u,p,g,!0,T)),F}function Yt(i,e,n,o){const u=[],p=i.image,g=p.pixelRatio,x=p.paddedRect.w-2,T=p.paddedRect.h-2;let C={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const I=p.stretchX||[[0,x]],L=p.stretchY||[[0,T]],B=(He,jt)=>He+jt[1]-jt[0],F=I.reduce(B,0),G=L.reduce(B,0),H=x-F,Y=T-G;let J=0,de=F,ee=0,ae=G,me=0,ve=H,Ue=0,ot=Y;if(p.content&&o){const He=p.content,jt=He[2]-He[0],Bt=He[3]-He[1];(p.textFitWidth||p.textFitHeight)&&(C=Cl(i)),J=an(I,0,He[0]),ee=an(L,0,He[1]),de=an(I,He[0],He[2]),ae=an(L,He[1],He[3]),me=He[0]-J,Ue=He[1]-ee,ve=jt-de,ot=Bt-ae}const et=C.x1,pt=C.y1,Dt=C.x2-et,yt=C.y2-pt,rt=(He,jt,Bt,Gt)=>{const Lt=Ne(He.stretch-J,de,Dt,et),Kt=Pe(He.fixed-me,ve,He.stretch,F),Pn=Ne(jt.stretch-ee,ae,yt,pt),_n=Pe(jt.fixed-Ue,ot,jt.stretch,G),Di=Ne(Bt.stretch-J,de,Dt,et),sa=Pe(Bt.fixed-me,ve,Bt.stretch,F),Tr=Ne(Gt.stretch-ee,ae,yt,pt),Ii=Pe(Gt.fixed-Ue,ot,Gt.stretch,G),wi=new N(Lt,Pn),Hn=new N(Di,Pn),$i=new N(Di,Tr),tr=new N(Lt,Tr),_i=new N(Kt/g,_n/g),cs=new N(sa/g,Ii/g),oa=e*Math.PI/180;if(oa){const Lr=Math.sin(oa),ji=Math.cos(oa),Sr=[ji,-Lr,Lr,ji];wi._matMult(Sr),Hn._matMult(Sr),tr._matMult(Sr),$i._matMult(Sr)}const us=He.stretch+He.fixed,Vo=jt.stretch+jt.fixed;return{tl:wi,tr:Hn,bl:tr,br:$i,tex:{x:p.paddedRect.x+1+us,y:p.paddedRect.y+1+Vo,w:Bt.stretch+Bt.fixed-us,h:Gt.stretch+Gt.fixed-Vo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:_i,pixelOffsetBR:cs,minFontScaleX:ve/g/Dt,minFontScaleY:ot/g/yt,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const He=ri(I,H,F),jt=ri(L,Y,G);for(let Bt=0;Bt<He.length-1;Bt++){const Gt=He[Bt],Lt=He[Bt+1];for(let Kt=0;Kt<jt.length-1;Kt++)u.push(rt(Gt,jt[Kt],Lt,jt[Kt+1]))}}else u.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return u}function an(i,e,n){let o=0;for(const u of i)o+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return o}function ri(i,e,n){const o=[{fixed:-1,stretch:0}];for(const[u,p]of i){const g=o[o.length-1];o.push({fixed:u-g.stretch,stretch:g.stretch}),o.push({fixed:u-g.stretch,stretch:g.stretch+(p-u)})}return o.push({fixed:e+1,stretch:n}),o}function Ne(i,e,n,o){return i/e*n+o}function Pe(i,e,n,o){return i-e*n/o}Ot("Anchor",q);class Ze{constructor(e,n,o,u,p,g,x,T,C,I){var L;if(this.boxStartIndex=e.length,C){let B=g.top,F=g.bottom;const G=g.collisionPadding;G&&(B-=G[1],F+=G[3]);let H=F-B;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{const B=!((L=g.image)===null||L===void 0)&&L.content&&(g.image.textFitWidth||g.image.textFitHeight)?Cl(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};B.y1=B.y1*x-T[0],B.y2=B.y2*x+T[2],B.x1=B.x1*x-T[3],B.x2=B.x2*x+T[1];const F=g.collisionPadding;if(F&&(B.x1-=F[0]*x,B.y1-=F[1]*x,B.x2+=F[2]*x,B.y2+=F[3]*x),I){const G=new N(B.x1,B.y1),H=new N(B.x2,B.y1),Y=new N(B.x1,B.y2),J=new N(B.x2,B.y2),de=I*Math.PI/180;G._rotate(de),H._rotate(de),Y._rotate(de),J._rotate(de),B.x1=Math.min(G.x,H.x,Y.x,J.x),B.x2=Math.max(G.x,H.x,Y.x,J.x),B.y1=Math.min(G.y,H.y,Y.y,J.y),B.y2=Math.max(G.y,H.y,Y.y,J.y)}e.emplaceBack(n.x,n.y,B.x1,B.y1,B.x2,B.y2,o,u,p)}this.boxEndIndex=e.length}}class gt{constructor(e=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,u=n[e];for(;e>0;){const p=e-1>>1,g=n[p];if(o(u,g)>=0)break;n[e]=g,e=p}n[e]=u}_down(e){const{data:n,compare:o}=this,u=this.length>>1,p=n[e];for(;e<u;){let g=1+(e<<1);const x=g+1;if(x<this.length&&o(n[x],n[g])<0&&(g=x),o(n[g],p)>=0)break;n[e]=n[g],e=g}n[e]=p}}function rn(i,e=1,n=!1){const o=yc.fromPoints(i[0]),u=Math.min(o.width(),o.height());let p=u/2;const g=new gt([],Zn),{minX:x,minY:T,maxX:C,maxY:I}=o;if(u===0)return new N(x,T);for(let F=x;F<C;F+=u)for(let G=T;G<I;G+=u)g.push(new Wt(F+p,G+p,p,i));let L=(function(F){let G=0,H=0,Y=0;const J=F[0];for(let de=0,ee=J.length,ae=ee-1;de<ee;ae=de++){const me=J[de],ve=J[ae],Ue=me.x*ve.y-ve.x*me.y;H+=(me.x+ve.x)*Ue,Y+=(me.y+ve.y)*Ue,G+=3*Ue}return new Wt(H/G,Y/G,0,F)})(i),B=g.length;for(;g.length;){const F=g.pop();(F.d>L.d||!L.d)&&(L=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,B)),F.max-L.d<=e||(p=F.h/2,g.push(new Wt(F.p.x-p,F.p.y-p,p,i)),g.push(new Wt(F.p.x+p,F.p.y-p,p,i)),g.push(new Wt(F.p.x-p,F.p.y+p,p,i)),g.push(new Wt(F.p.x+p,F.p.y+p,p,i)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function Zn(i,e){return e.max-i.max}function Wt(i,e,n,o){this.p=new N(i,e),this.h=n,this.d=(function(u,p){let g=!1,x=1/0;for(let T=0;T<p.length;T++){const C=p[T];for(let I=0,L=C.length,B=L-1;I<L;B=I++){const F=C[I],G=C[B];F.y>u.y!=G.y>u.y&&u.x<(G.x-F.x)*(u.y-F.y)/(G.y-F.y)+F.x&&(g=!g),x=Math.min(x,nm(u,F,G))}}return(g?1:-1)*Math.sqrt(x)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Jt;A.aP=void 0,(Jt=A.aP||(A.aP={}))[Jt.center=1]="center",Jt[Jt.left=2]="left",Jt[Jt.right=3]="right",Jt[Jt.top=4]="top",Jt[Jt.bottom=5]="bottom",Jt[Jt["top-left"]=6]="top-left",Jt[Jt["top-right"]=7]="top-right",Jt[Jt["bottom-left"]=8]="bottom-left",Jt[Jt["bottom-right"]=9]="bottom-right";const wn=Number.POSITIVE_INFINITY;function Un(i,e){return e[1]!==wn?(function(n,o,u){let p=0,g=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,g]})(i,e[0],e[1]):(function(n,o){let u=0,p=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":p=g-7;break;case"bottom-right":case"bottom-left":p=7-g;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=o;break;case"right":u=-o}return[u,p]})(i,e[0])}function Il(i,e,n){var o;const u=i.layout,p=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(p){const x=p.values,T=[];for(let C=0;C<x.length;C+=2){const I=T[C]=x[C],L=x[C+1].map((B=>B*or));I.startsWith("top")?L[1]-=7:I.startsWith("bottom")&&(L[1]+=7),T[C+1]=L}return new Ei(T)}const g=u.get("text-variable-anchor");if(g){let x;x=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},n)*or,wn]:u.get("text-offset").evaluate(e,{},n).map((C=>C*or));const T=[];for(const C of g)T.push(C,Un(C,x));return new Ei(T)}return null}function eg(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function y1(i,e,n,o,u,p,g,x,T,C,I,L){let B=p.textMaxSize.evaluate(e,{});B===void 0&&(B=g);const F=i.layers[0].layout,G=F.get("icon-offset").evaluate(e,{},I),H=V0(n.horizontal),Y=g/24,J=i.tilePixelRatio*Y,de=i.tilePixelRatio*B/24,ee=i.tilePixelRatio*x,ae=i.tilePixelRatio*F.get("symbol-spacing"),me=F.get("text-padding")*i.tilePixelRatio,ve=(function(Bt,Gt,Lt,Kt=1){const Pn=Bt.get("icon-padding").evaluate(Gt,{},Lt),_n=Pn&&Pn.values;return[_n[0]*Kt,_n[1]*Kt,_n[2]*Kt,_n[3]*Kt]})(F,e,I,i.tilePixelRatio),Ue=F.get("text-max-angle")/180*Math.PI,ot=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",et=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",pt=F.get("symbol-placement"),Dt=ae/2,yt=F.get("icon-text-fit");let rt;o&&yt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(rt=lo(o,n.vertical,yt,F.get("icon-text-fit-padding"),G,Y)),H&&(o=lo(o,H,yt,F.get("icon-text-fit-padding"),G,Y)));const He=I?L.line.getGranularityForZoomLevel(I.z):1,jt=(Bt,Gt)=>{Gt.x<0||Gt.x>=vt||Gt.y<0||Gt.y>=vt||(function(Lt,Kt,Pn,_n,Di,sa,Tr,Ii,wi,Hn,$i,tr,_i,cs,oa,us,Vo,Lr,ji,Sr,Xi,Or,Pu,kl,ig){const jh=Lt.addToLineVertexArray(Kt,Pn);let rf,Op,Bp,Np,H0=0,$0=0,X0=0,Y0=0,p_=-1,m_=-1;const Du={};let W0=zi("");if(Lt.allowVerticalPlacement&&_n.vertical){const Sa=Ii.layout.get("text-rotate").evaluate(Xi,{},kl)+90;Bp=new Ze(wi,Kt,Hn,$i,tr,_n.vertical,_i,cs,oa,Sa),Tr&&(Np=new Ze(wi,Kt,Hn,$i,tr,Tr,Vo,Lr,oa,Sa))}if(Di){const Sa=Ii.layout.get("icon-rotate").evaluate(Xi,{}),fo=Ii.layout.get("icon-text-fit")!=="none",af=Yt(Di,Sa,Pu,fo),Ll=Tr?Yt(Tr,Sa,Pu,fo):void 0;Op=new Ze(wi,Kt,Hn,$i,tr,Di,Vo,Lr,!1,Sa),H0=4*af.length;const sf=Lt.iconSizeData;let Mc=null;sf.kind==="source"?(Mc=[os*Ii.layout.get("icon-size").evaluate(Xi,{})],Mc[0]>mc&&Mn(`${Lt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):sf.kind==="composite"&&(Mc=[os*Or.compositeIconSizes[0].evaluate(Xi,{},kl),os*Or.compositeIconSizes[1].evaluate(Xi,{},kl)],(Mc[0]>mc||Mc[1]>mc)&&Mn(`${Lt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Lt.addSymbols(Lt.icon,af,Mc,Sr,ji,Xi,A.az.none,Kt,jh.lineStartIndex,jh.lineLength,-1,kl),p_=Lt.icon.placedSymbolArray.length-1,Ll&&($0=4*Ll.length,Lt.addSymbols(Lt.icon,Ll,Mc,Sr,ji,Xi,A.az.vertical,Kt,jh.lineStartIndex,jh.lineLength,-1,kl),m_=Lt.icon.placedSymbolArray.length-1)}const K0=Object.keys(_n.horizontal);for(const Sa of K0){const fo=_n.horizontal[Sa];if(!rf){W0=zi(fo.text);const Ll=Ii.layout.get("text-rotate").evaluate(Xi,{},kl);rf=new Ze(wi,Kt,Hn,$i,tr,fo,_i,cs,oa,Ll)}const af=fo.positionedLines.length===1;if(X0+=U0(Lt,Kt,fo,sa,Ii,oa,Xi,us,jh,_n.vertical?A.az.horizontal:A.az.horizontalOnly,af?K0:[Sa],Du,p_,Or,kl),af)break}_n.vertical&&(Y0+=U0(Lt,Kt,_n.vertical,sa,Ii,oa,Xi,us,jh,A.az.vertical,["vertical"],Du,m_,Or,kl));const x1=rf?rf.boxStartIndex:Lt.collisionBoxArray.length,b1=rf?rf.boxEndIndex:Lt.collisionBoxArray.length,w1=Bp?Bp.boxStartIndex:Lt.collisionBoxArray.length,T1=Bp?Bp.boxEndIndex:Lt.collisionBoxArray.length,S1=Op?Op.boxStartIndex:Lt.collisionBoxArray.length,E1=Op?Op.boxEndIndex:Lt.collisionBoxArray.length,M1=Np?Np.boxStartIndex:Lt.collisionBoxArray.length,A1=Np?Np.boxEndIndex:Lt.collisionBoxArray.length;let Rl=-1;const py=(Sa,fo)=>Sa&&Sa.circleDiameter?Math.max(Sa.circleDiameter,fo):fo;Rl=py(rf,Rl),Rl=py(Bp,Rl),Rl=py(Op,Rl),Rl=py(Np,Rl);const Q0=Rl>-1?1:0;Q0&&(Rl*=ig/or),Lt.glyphOffsetArray.length>=Dh.MAX_GLYPHS&&Mn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xi.sortKey!==void 0&&Lt.addToSortKeyRanges(Lt.symbolInstances.length,Xi.sortKey);const C1=Il(Ii,Xi,kl),[z1,P1]=(function(Sa,fo){const af=Sa.length,Ll=fo?.values;if(Ll?.length>0)for(let sf=0;sf<Ll.length;sf+=2){const Mc=Ll[sf+1];Sa.emplaceBack(A.aP[Ll[sf]],Mc[0],Mc[1])}return[af,Sa.length]})(Lt.textAnchorOffsets,C1);Lt.symbolInstances.emplaceBack(Kt.x,Kt.y,Du.right>=0?Du.right:-1,Du.center>=0?Du.center:-1,Du.left>=0?Du.left:-1,Du.vertical||-1,p_,m_,W0,x1,b1,w1,T1,S1,E1,M1,A1,Hn,X0,Y0,H0,$0,Q0,0,_i,Rl,z1,P1)})(i,Gt,Bt,n,o,u,rt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,J,[me,me,me,me],ot,T,ee,ve,et,G,e,p,C,I,g)};if(pt==="line")for(const Bt of r(e.geometry,0,0,vt,vt)){const Gt=Tl(Bt,He),Lt=We(Gt,ae,Ue,n.vertical||H,o,24,de,i.overscaling,vt);for(const Kt of Lt)H&&_1(i,H.text,Dt,Kt)||jt(Gt,Kt)}else if(pt==="line-center"){for(const Bt of e.geometry)if(Bt.length>1){const Gt=Tl(Bt,He),Lt=xt(Gt,Ue,n.vertical||H,o,24,de);Lt&&jt(Gt,Lt)}}else if(e.type==="Polygon")for(const Bt of Xc(e.geometry,0)){const Gt=rn(Bt,16);jt(Tl(Bt[0],He,!0),new q(Gt.x,Gt.y,0))}else if(e.type==="LineString")for(const Bt of e.geometry){const Gt=Tl(Bt,He);jt(Gt,new q(Gt[0].x,Gt[0].y,0))}else if(e.type==="Point")for(const Bt of e.geometry)for(const Gt of Bt)jt([Gt],new q(Gt.x,Gt.y,0))}function U0(i,e,n,o,u,p,g,x,T,C,I,L,B,F,G){const H=(function(de,ee,ae,me,ve,Ue,ot,et){const pt=me.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,Dt=[];for(const yt of ee.positionedLines)for(const rt of yt.positionedGlyphs){if(!rt.rect)continue;const He=rt.rect||{};let jt=4,Bt=!0,Gt=1,Lt=0;const Kt=(ve||et)&&rt.vertical,Pn=rt.metrics.advance*rt.scale/2;if(et&&ee.verticalizable&&(Lt=yt.lineOffset/2-(rt.imageName?-(or-rt.metrics.width*rt.scale)/2:(rt.scale-1)*or)),rt.imageName){const Lr=ot[rt.imageName];Bt=Lr.sdf,Gt=Lr.pixelRatio,jt=1/Gt}const _n=ve?[rt.x+Pn,rt.y]:[0,0];let Di=ve?[0,0]:[rt.x+Pn+ae[0],rt.y+ae[1]-Lt],sa=[0,0];Kt&&(sa=Di,Di=[0,0]);const Tr=rt.metrics.isDoubleResolution?2:1,Ii=(rt.metrics.left-jt)*rt.scale-Pn+Di[0],wi=(-rt.metrics.top-jt)*rt.scale+Di[1],Hn=Ii+He.w/Tr*rt.scale/Gt,$i=wi+He.h/Tr*rt.scale/Gt,tr=new N(Ii,wi),_i=new N(Hn,wi),cs=new N(Ii,$i),oa=new N(Hn,$i);if(Kt){const Lr=new N(-Pn,Pn- -17),ji=-Math.PI/2,Sr=12-Pn,Xi=new N(22-Sr,-(rt.imageName?Sr:0)),Or=new N(...sa);tr._rotateAround(ji,Lr)._add(Xi)._add(Or),_i._rotateAround(ji,Lr)._add(Xi)._add(Or),cs._rotateAround(ji,Lr)._add(Xi)._add(Or),oa._rotateAround(ji,Lr)._add(Xi)._add(Or)}if(pt){const Lr=Math.sin(pt),ji=Math.cos(pt),Sr=[ji,-Lr,Lr,ji];tr._matMult(Sr),_i._matMult(Sr),cs._matMult(Sr),oa._matMult(Sr)}const us=new N(0,0),Vo=new N(0,0);Dt.push({tl:tr,tr:_i,bl:cs,br:oa,tex:He,writingMode:ee.writingMode,glyphOffset:_n,sectionIndex:rt.sectionIndex,isSDF:Bt,pixelOffsetTL:us,pixelOffsetBR:Vo,minFontScaleX:0,minFontScaleY:0})}return Dt})(0,n,x,u,p,g,o,i.allowVerticalPlacement),Y=i.textSizeData;let J=null;Y.kind==="source"?(J=[os*u.layout.get("text-size").evaluate(g,{})],J[0]>mc&&Mn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Y.kind==="composite"&&(J=[os*F.compositeTextSizes[0].evaluate(g,{},G),os*F.compositeTextSizes[1].evaluate(g,{},G)],(J[0]>mc||J[1]>mc)&&Mn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,H,J,x,p,g,C,e,T.lineStartIndex,T.lineLength,B,G);for(const de of I)L[de]=i.text.placedSymbolArray.length-1;return 4*H.length}function V0(i){for(const e in i)return i[e];return null}function _1(i,e,n,o){const u=i.compareText;if(e in u){const p=u[e];for(let g=p.length-1;g>=0;g--)if(o.dist(p[g])<n)return!0}else u[e]=[];return u[e].push(o),!1}const q0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class o_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=q0[15&o];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new o_(x,g,p,e)}constructor(e,n=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=q0.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return l_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:x}=this,T=[0,p.length-1,0],C=[];for(;T.length;){const I=T.pop()||0,L=T.pop()||0,B=T.pop()||0;if(L-B<=x){for(let Y=B;Y<=L;Y++){const J=g[2*Y],de=g[2*Y+1];J>=e&&J<=o&&de>=n&&de<=u&&C.push(p[Y])}continue}const F=B+L>>1,G=g[2*F],H=g[2*F+1];G>=e&&G<=o&&H>=n&&H<=u&&C.push(p[F]),(I===0?e<=G:n<=H)&&(T.push(B),T.push(F-1),T.push(1-I)),(I===0?o>=G:u>=H)&&(T.push(F+1),T.push(L),T.push(1-I))}return C}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:g}=this,x=[0,u.length-1,0],T=[],C=o*o;for(;x.length;){const I=x.pop()||0,L=x.pop()||0,B=x.pop()||0;if(L-B<=g){for(let Y=B;Y<=L;Y++)Z0(p[2*Y],p[2*Y+1],e,n)<=C&&T.push(u[Y]);continue}const F=B+L>>1,G=p[2*F],H=p[2*F+1];Z0(G,H,e,n)<=C&&T.push(u[F]),(I===0?e-o<=G:n-o<=H)&&(x.push(B),x.push(F-1),x.push(1-I)),(I===0?e+o>=G:n+o>=H)&&(x.push(F+1),x.push(L),x.push(1-I))}return T}}function l_(i,e,n,o,u,p){if(u-o<=n)return;const g=o+u>>1;G0(i,e,g,o,u,p),l_(i,e,n,o,g-1,1-p),l_(i,e,n,g+1,u,1-p)}function G0(i,e,n,o,u,p){for(;u>o;){if(u-o>600){const C=u-o+1,I=n-o+1,L=Math.log(C),B=.5*Math.exp(2*L/3),F=.5*Math.sqrt(L*B*(C-B)/C)*(I-C/2<0?-1:1);G0(i,e,n,Math.max(o,Math.floor(n-I*B/C+F)),Math.min(u,Math.floor(n+(C-I)*B/C+F)),p)}const g=e[2*n+p];let x=o,T=u;for(tg(i,e,o,n),e[2*u+p]>g&&tg(i,e,o,u);x<T;){for(tg(i,e,x,T),x++,T--;e[2*x+p]<g;)x++;for(;e[2*T+p]>g;)T--}e[2*o+p]===g?tg(i,e,o,T):(T++,tg(i,e,T,u)),T<=n&&(o=T+1),n<=T&&(u=T-1)}}function tg(i,e,n,o){c_(i,n,o),c_(e,2*n,2*o),c_(e,2*n+1,2*o+1)}function c_(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function Z0(i,e,n,o){const u=i-n,p=e-o;return u*u+p*p}var u_;A.cH=void 0,(u_=A.cH||(A.cH={})).create="create",u_.load="load",u_.fullLoad="fullLoad";let fy=null,ng=[];const h_=1e3/60,d_="loadTime",f_="fullLoadTime",v1={mark(i){performance.mark(i)},frame(i){const e=i;fy!=null&&ng.push(e-fy),fy=e},clearMetrics(){fy=null,ng=[],performance.clearMeasures(d_),performance.clearMeasures(f_);for(const i in A.cH)performance.clearMarks(A.cH[i])},getPerformanceMetrics(){performance.measure(d_,A.cH.create,A.cH.load),performance.measure(f_,A.cH.create,A.cH.fullLoad);const i=performance.getEntriesByName(d_)[0].duration,e=performance.getEntriesByName(f_)[0].duration,n=ng.length,o=1/(ng.reduce(((p,g)=>p+g),0)/n/1e3),u=ng.filter((p=>p>h_)).reduce(((p,g)=>p+(g-h_)/h_),0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};A.$=ie,A.A=ht,A.B=Qa,A.C=sr,A.D=Nt,A.E=un,A.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},A.G=pi,A.H=Fn,A.I=Qn,A.J=ch,A.K=function(i){if(Jn==null){const e=i.navigator?i.navigator.userAgent:null;Jn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Jn},A.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yp((()=>this.process())),this.subscription=$r(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Ri(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=e?$r(e.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[u];const T={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),Pm):null;this.resolveRejects[u]={resolve:T=>{p?.unsubscribe(),n(T)},reject:T=>{p?.unsubscribe(),o(T)}};const g=[],x=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Ja(i.data,g)});this.target.postMessage(x,{transfer:g})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Ri(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return l(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(e.error?u.reject(ac(e.error)):u.resolve(ac(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=ac(e.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,n,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}}))}completeTask(i,e,n){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Ja(e):null,data:Ja(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},A.M=ze,A.N=function(){var i=new ht(16);return ht!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},A.O=function(i,e,n){var o,u,p,g,x,T,C,I,L,B,F,G,H=n[0],Y=n[1],J=n[2];return e===i?(i[12]=e[0]*H+e[4]*Y+e[8]*J+e[12],i[13]=e[1]*H+e[5]*Y+e[9]*J+e[13],i[14]=e[2]*H+e[6]*Y+e[10]*J+e[14],i[15]=e[3]*H+e[7]*Y+e[11]*J+e[15]):(u=e[1],p=e[2],g=e[3],x=e[4],T=e[5],C=e[6],I=e[7],L=e[8],B=e[9],F=e[10],G=e[11],i[0]=o=e[0],i[1]=u,i[2]=p,i[3]=g,i[4]=x,i[5]=T,i[6]=C,i[7]=I,i[8]=L,i[9]=B,i[10]=F,i[11]=G,i[12]=o*H+x*Y+L*J+e[12],i[13]=u*H+T*Y+B*J+e[13],i[14]=p*H+C*Y+F*J+e[14],i[15]=g*H+I*Y+G*J+e[15]),i},A.P=N,A.Q=function(i,e,n){var o=n[0],u=n[1],p=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},A.R=na,A.S=function(i,e,n){var o=e[0],u=e[1],p=e[2],g=e[3],x=e[4],T=e[5],C=e[6],I=e[7],L=e[8],B=e[9],F=e[10],G=e[11],H=e[12],Y=e[13],J=e[14],de=e[15],ee=n[0],ae=n[1],me=n[2],ve=n[3];return i[0]=ee*o+ae*x+me*L+ve*H,i[1]=ee*u+ae*T+me*B+ve*Y,i[2]=ee*p+ae*C+me*F+ve*J,i[3]=ee*g+ae*I+me*G+ve*de,i[4]=(ee=n[4])*o+(ae=n[5])*x+(me=n[6])*L+(ve=n[7])*H,i[5]=ee*u+ae*T+me*B+ve*Y,i[6]=ee*p+ae*C+me*F+ve*J,i[7]=ee*g+ae*I+me*G+ve*de,i[8]=(ee=n[8])*o+(ae=n[9])*x+(me=n[10])*L+(ve=n[11])*H,i[9]=ee*u+ae*T+me*B+ve*Y,i[10]=ee*p+ae*C+me*F+ve*J,i[11]=ee*g+ae*I+me*G+ve*de,i[12]=(ee=n[12])*o+(ae=n[13])*x+(me=n[14])*L+(ve=n[15])*H,i[13]=ee*u+ae*T+me*B+ve*Y,i[14]=ee*p+ae*C+me*F+ve*J,i[15]=ee*g+ae*I+me*G+ve*de,i},A.T=Xf,A.U=function(i,e){const n={};for(let o=0;o<e.length;o++){const u=e[o];u in i&&(n[u]=i[u])}return n},A.V=jo,A.W=Vt,A.X=Dm,A.Y=Xg,A.Z=ue,A._=l,A.a=K,A.a$=it,A.a0=Le,A.a1=ur,A.a2=Ga,A.a3=Wg,A.a4=Fd,A.a5=vt,A.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const o=Ud(i),u=Ud(e);(function(g,x){x.removeAll&&(g.add.clear(),g.update.clear(),g.remove.clear(),x.remove.clear());for(const T of x.remove)g.add.delete(T),g.update.delete(T);for(const[T,C]of x.update){const I=g.update.get(T);I&&(x.update.set(T,km(I,C)),g.update.delete(T))}})(o,u);const p={};if((o.removeAll||u.removeAll)&&(p.removeAll=!0),p.remove=new Set([...o.remove,...u.remove]),p.add=new Map([...o.add,...u.add]),p.update=new Map([...o.update,...u.update]),p.remove.size&&p.add.size)for(const g of p.add.keys())p.remove.delete(g);return(function(g){const x={};return g.removeAll&&(x.removeAll=g.removeAll),g.remove&&(x.remove=Array.from(g.remove)),g.add&&(x.add=Array.from(g.add.values())),g.update&&(x.update=Array.from(g.update.values())),x})(p)},A.a7=function(i,e){const n=new Map;if(i==null||i.type==null)return n;if(i.type==="Feature"){const o=jd(i,e);return o==null?void 0:(n.set(o,i),n)}if(i.type==="FeatureCollection"){const o=new Set;for(const u of i.features){const p=jd(u,e);if(p==null||o.has(p))return;o.add(p),n.set(p,u)}return n}},A.a8=function(i,e,n){var o,u;const p=[];if(e.removeAll)i.clear();else if(e.remove)for(const g of e.remove){const x=i.get(g);x&&(p.push(x.geometry),i.delete(g))}if(e.add)for(const g of e.add){const x=jd(g,n);if(x==null)continue;const T=i.get(x);T&&p.push(T.geometry),p.push(g.geometry),i.set(x,g)}if(e.update)for(const g of e.update){const x=i.get(g.id);if(!x)continue;const T=!!g.newGeometry,C=g.removeAllProperties||((o=g.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=g.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!T&&!C)continue;p.push(x.geometry);const I=Object.assign({},x);if(i.set(g.id,I),T&&(p.push(g.newGeometry),I.geometry=g.newGeometry),C){if(I.properties=g.removeAllProperties?{}:Object.assign({},I.properties||{}),g.removeProperties)for(const L of g.removeProperties)delete I.properties[L];if(g.addOrUpdateProperties)for(const{key:L,value:B}of g.addOrUpdateProperties)I.properties[L]=B}}return p},A.a9=Gn,A.aA=function(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/os:i.kind==="composite"?pi.number(o/os,u/os,n):e},A.aB=function(i,e){var n=e[0],o=e[1],u=e[2],p=e[3],g=e[4],x=e[5],T=e[6],C=e[7],I=e[8],L=e[9],B=e[10],F=e[11],G=e[12],H=e[13],Y=e[14],J=e[15],de=n*x-o*g,ee=n*T-u*g,ae=n*C-p*g,me=o*T-u*x,ve=o*C-p*x,Ue=u*C-p*T,ot=I*H-L*G,et=I*Y-B*G,pt=I*J-F*G,Dt=L*Y-B*H,yt=L*J-F*H,rt=B*J-F*Y,He=de*rt-ee*yt+ae*Dt+me*pt-ve*et+Ue*ot;return He?(i[0]=(x*rt-T*yt+C*Dt)*(He=1/He),i[1]=(u*yt-o*rt-p*Dt)*He,i[2]=(H*Ue-Y*ve+J*me)*He,i[3]=(B*ve-L*Ue-F*me)*He,i[4]=(T*pt-g*rt-C*et)*He,i[5]=(n*rt-u*pt+p*et)*He,i[6]=(Y*ae-G*Ue-J*ee)*He,i[7]=(I*Ue-B*ae+F*ee)*He,i[8]=(g*yt-x*pt+C*ot)*He,i[9]=(o*pt-n*yt-p*ot)*He,i[10]=(G*ve-H*ae+J*de)*He,i[11]=(L*ae-I*ve-F*de)*He,i[12]=(x*et-g*Dt-T*ot)*He,i[13]=(n*Dt-o*et+u*ot)*He,i[14]=(H*ee-G*me-Y*de)*He,i[15]=(I*me-L*ee+B*de)*He,i):null},A.aC=$e,A.aD=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},A.aE=function(i){return i[0]=0,i[1]=0,i},A.aF=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},A.aG=Mm,A.aH=$t,A.aI=function(i,e,n,o){const u=e.y-i.y,p=e.x-i.x,g=o.y-n.y,x=o.x-n.x,T=g*p-x*u;if(T===0)return null;const C=(x*(i.y-n.y)-g*(i.x-n.x))/T;return new N(i.x+C*p,i.y+C*u)},A.aJ=r,A.aK=xu,A.aL=function(i){let e=1/0,n=1/0,o=-1/0,u=-1/0;for(const p of i)e=Math.min(e,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return[e,n,o,u]},A.aM=or,A.aN=Ut,A.aO=function(i,e,n,o,u=!1){if(!n[0]&&!n[1])return[0,0];const p=u?o==="map"?-i.bearingInRadians:0:o==="viewport"?i.bearingInRadians:0;if(p){const g=Math.sin(p),x=Math.cos(p);n=[n[0]*x-n[1]*g,n[0]*g+n[1]*x]}return[u?n[0]:Ut(e,n[0],i.zoom),u?n[1]:Ut(e,n[1],i.zoom)]},A.aQ=dp,A.aR=eg,A.aS=wm,A.aT=o_,A.aU=mi,A.aV=zd,A.aW=se,A.aX=Pt,A.aY=qe,A.aZ=nr,A.a_=Im,A.aa=yc,A.ab=25,A.ac=Cr,A.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const o of i){const u=window.document.createElement("source");at(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},A.ae=bt,A.af=function(){return Qt++},A.ag=f,A.ah=Dh,A.ai=nf,A.aj=Wr,A.ak=as,A.al=xp,A.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,u,p)=>{const g=u||p;return e[o]=!g||g.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},A.an=Zt,A.ao=85.051129,A.ap=Li,A.aq=function(i){return Math.pow(2,i)},A.ar=zt,A.as=Yg,A.at=function(i){return Math.log(i)/Math.LN2},A.au=function(i){var e=i[0],n=i[1];return e*e+n*n},A.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((T=>T.canonical.z)));let n=1/0,o=-1/0,u=1/0,p=-1/0;const g=[];for(const T of i){const{x:C,y:I,z:L}=T.canonical,B=Math.pow(2,e-L),F=C*B,G=I*B;g.push({id:T,x:F,y:G}),F<n&&(n=F),F>o&&(o=F),G<u&&(u=G),G>p&&(p=G)}const x=new Set;for(const T of g)T.x!==n&&T.x!==o&&T.y!==u&&T.y!==p||x.add(T.id);return x},A.aw=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},A.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const o=i.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout((()=>{this.remove(i,u)}),n)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,o=e===void 0?0:this.data[n].indexOf(e),u=this.data[n][o];return this.data[n].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const o of this.data[n])i(o.value)||e.push(o);for(const n of e)this.remove(n.value.tileID,n)}},A.ay=function(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:g}=i,x=u?Zt(Vr.interpolationFactor(u,e,p,g),0,1):0;i.kind==="camera"?o=pi.number(i.minSize,i.maxSize,x):n=x}return{uSizeT:n,uSize:o}},A.b=Wi,A.b$=rs,A.b0=ct,A.b1=function(i){var e=new ht(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},A.b2=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},A.b3=function(i,e){var n=e[0],o=e[1],u=e[2],p=n*n+o*o+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i},A.b4=lt,A.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},A.b6=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},A.b7=st,A.b8=function(i,e,n){const o=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return o===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/o},A.b9=qt,A.bA=function(i,e,n,o){return i[0]=e[0]+n[0]*o,i[1]=e[1]+n[1]*o,i[2]=e[2]+n[2]*o,i},A.bB=we,A.bC=function(i,e,n){var o=n[0],u=n[1],p=n[2],g=n[3],x=e[0],T=e[1],C=e[2],I=u*C-p*T,L=p*x-o*C,B=o*T-u*x;return i[0]=x+g*(I+=I)+u*(B+=B)-p*(L+=L),i[1]=T+g*L+p*I-o*B,i[2]=C+g*B+o*L-u*I,i},A.bD=function(i,e,n){const o=(function(T){var C=T[3],I=T[4],L=T[5],B=T[6],F=T[7],G=T[8];return T[0]*(G*I-L*F)+T[1]*(-G*C+L*B)+T[2]*(F*C-I*B)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(o===0)return null;const u=lt([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),p=lt([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),g=lt([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),x=it([],u,-i[3]);return ct(x,x,it([],p,-e[3])),ct(x,x,it([],g,-n[3])),it(x,x,1/o),x},A.bE=_p,A.bF=function(){return new Float64Array(4)},A.bG=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),p[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),p[2]=u[2],i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bH=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[0],p[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),p[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bI=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),p[1]=u[1],p[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bJ=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[0],g=e[1],x=e[2],T=e[3],C=e[8],I=e[9],L=e[10],B=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u-C*o,i[1]=g*u-I*o,i[2]=x*u-L*o,i[3]=T*u-B*o,i[8]=p*o+C*u,i[9]=g*o+I*u,i[10]=x*o+L*u,i[11]=T*o+B*u,i},A.bK=function(i,e){const n=xe(i,360),o=xe(e,360),u=o-n,p=o>n?u-360:u+360;return Math.abs(u)<Math.abs(p)?u:p},A.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},A.bM=function(i,e,n,o){const u=Math.sqrt(i*i+e*e),p=Math.sqrt(n*n+o*o);i/=u,e/=u,n/=p,o/=p;const g=Math.acos(i*n+e*o);return-e*n+i*o>0?g:-g},A.bN=function(i,e){const n=xe(i,2*Math.PI),o=xe(e,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},A.bO=function(){const i={},e=Oe.$version;for(const n in Oe.$root){const o=Oe.$root[n];if(o.required){let u=null;u=n==="version"?e:o.type==="array"?[]:{},u!=null&&(i[n]=u)}}return i},A.bP=De,A.bQ=dh,A.bR=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!i(e[o],n[o]))return!1;return!0}return e===n},A.bS=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=ui(i[n],e[i[n].ref]));return i},A.bT=function(i,e){if(i.type==="custom")return new zm(i,e);switch(i.type){case"background":return new En(i,e);case"circle":return new Zf(i,e);case"color-relief":return new wg(i,e);case"fill":return new Ag(i,e);case"fill-extrusion":return new mm(i,e);case"heatmap":return new xg(i,e);case"hillshade":return new Pi(i,e);case"line":return new ym(i,e);case"raster":return new to(i,e);case"symbol":return new gc(i,e)}},A.bU=i=>i.type==="raster",A.bV=Rn,A.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!nn(i.version,e.version))return[{command:"setStyle",args:[e]}];nn(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),nn(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),nn(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),nn(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),nn(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),nn(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),nn(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),nn(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),nn(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),nn(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),nn(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),nn(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),nn(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),nn(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(g,x,T,C){let I;for(I in x=x||{},g=g||{})Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(x,I)||Ln(I,T,C));for(I in x)Object.prototype.hasOwnProperty.call(x,I)&&(Object.prototype.hasOwnProperty.call(g,I)?nn(g[I],x[I])||(g[I].type==="geojson"&&x[I].type==="geojson"&&On(g,x,I)?kn(T,{command:"setGeoJSONSourceData",args:[I,x[I].data]}):hi(I,x,T,C)):Ui(I,x,T))})(i.sources,e.sources,u,o);const p=[];i.layers&&i.layers.forEach((g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):p.push(g)})),n=n.concat(u),(function(g,x,T){x=x||[];const C=(g=g||[]).map(Us),I=x.map(Us),L=g.reduce(Vs,{}),B=x.reduce(Vs,{}),F=C.slice(),G=Object.create(null);let H,Y,J,de,ee;for(let ae=0,me=0;ae<C.length;ae++)H=C[ae],Object.prototype.hasOwnProperty.call(B,H)?me++:(kn(T,{command:"removeLayer",args:[H]}),F.splice(F.indexOf(H,me),1));for(let ae=0,me=0;ae<I.length;ae++)H=I[I.length-1-ae],F[F.length-1-ae]!==H&&(Object.prototype.hasOwnProperty.call(L,H)?(kn(T,{command:"removeLayer",args:[H]}),F.splice(F.lastIndexOf(H,F.length-me),1)):me++,de=F[F.length-ae],kn(T,{command:"addLayer",args:[B[H],de]}),F.splice(F.length-ae,0,H),G[H]=!0);for(let ae=0;ae<I.length;ae++)if(H=I[ae],Y=L[H],J=B[H],!G[H]&&!nn(Y,J))if(nn(Y.source,J.source)&&nn(Y["source-layer"],J["source-layer"])&&nn(Y.type,J.type)){for(ee in Ti(Y.layout,J.layout,T,H,null,"setLayoutProperty"),Ti(Y.paint,J.paint,T,H,null,"setPaintProperty"),nn(Y.filter,J.filter)||kn(T,{command:"setFilter",args:[H,J.filter]}),nn(Y.minzoom,J.minzoom)&&nn(Y.maxzoom,J.maxzoom)||kn(T,{command:"setLayerZoomRange",args:[H,J.minzoom,J.maxzoom]}),Y)Object.prototype.hasOwnProperty.call(Y,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ti(Y[ee],J[ee],T,H,ee.slice(6),"setPaintProperty"):nn(Y[ee],J[ee])||kn(T,{command:"setLayerProperty",args:[H,ee,J[ee]]}));for(ee in J)Object.prototype.hasOwnProperty.call(J,ee)&&!Object.prototype.hasOwnProperty.call(Y,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ti(Y[ee],J[ee],T,H,ee.slice(6),"setPaintProperty"):nn(Y[ee],J[ee])||kn(T,{command:"setLayerProperty",args:[H,ee,J[ee]]}))}else kn(T,{command:"removeLayer",args:[H]}),de=F[F.lastIndexOf(H)+1],kn(T,{command:"addLayer",args:[J,de]})})(p,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[e]}]}return n},A.bX=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},A.bY=Dn,A.bZ=ai,A.b_=class extends ea{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},A.ba=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},A.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},A.bc=Kg,A.bd=kh,A.be=function(i,e,n,o,u){var p=1/Math.tan(e/2);if(i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0){var g=1/(o-u);i[10]=(u+o)*g,i[14]=2*u*o*g}else i[10]=-1,i[14]=-2*o;return i},A.bf=function(i){var e=new ht(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},A.bg=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[0],g=e[1],x=e[2],T=e[3],C=e[4],I=e[5],L=e[6],B=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u+C*o,i[1]=g*u+I*o,i[2]=x*u+L*o,i[3]=T*u+B*o,i[4]=C*u-p*o,i[5]=I*u-g*o,i[6]=L*u-x*o,i[7]=B*u-T*o,i},A.bh=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[4],g=e[5],x=e[6],T=e[7],C=e[8],I=e[9],L=e[10],B=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*u+C*o,i[5]=g*u+I*o,i[6]=x*u+L*o,i[7]=T*u+B*o,i[8]=C*u-p*o,i[9]=I*u-g*o,i[10]=L*u-x*o,i[11]=B*u-T*o,i},A.bi=function(){const i=new Float32Array(16);return zt(i),i},A.bj=function(){const i=new Float64Array(16);return zt(i),i},A.bk=function(){return new Float64Array(16)},A.bl=function(i,e,n){const o=new Float64Array(4);return we(o,i,e-90,n),o},A.bm=function(i,e,n,o){var u,p,g,x,T,C=e[0],I=e[1],L=e[2],B=e[3],F=n[0],G=n[1],H=n[2],Y=n[3];return(p=C*F+I*G+L*H+B*Y)<0&&(p=-p,F=-F,G=-G,H=-H,Y=-Y),1-p>Ke?(u=Math.acos(p),g=Math.sin(u),x=Math.sin((1-o)*u)/g,T=Math.sin(o*u)/g):(x=1-o,T=o),i[0]=x*C+T*F,i[1]=x*I+T*G,i[2]=x*L+T*H,i[3]=x*B+T*Y,i},A.bn=function(i){const e=new Float64Array(9);(function(p,g){var x=g[0],T=g[1],C=g[2],I=g[3],L=x+x,B=T+T,F=C+C,G=x*L,H=T*L,Y=T*B,J=C*L,de=C*B,ee=C*F,ae=I*L,me=I*B,ve=I*F;p[0]=1-Y-ee,p[3]=H-ve,p[6]=J+me,p[1]=H+ve,p[4]=1-G-ee,p[7]=de-ae,p[2]=J-me,p[5]=de+ae,p[8]=1-G-Y})(e,i);const n=nr(-Math.asin(Zt(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-nr(Math.atan2(e[3],e[4]))):(o=nr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=nr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:n+90,bearing:u}},A.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},A.bp=hn,A.bq=_l,A.br=ja,A.bs=so,A.bt=Ar,A.bu=Ye,A.bv=wt,A.bw=rr,A.bx=function(i,e,n,o,u){return Ye(o,u,Zt((i-e)/(n-e),0,1))},A.by=xe,A.bz=function(){return new Float64Array(3)},A.c=ge,A.c$=function(i,e,n,o,u){return l(this,void 0,void 0,(function*(){if(Le())try{return yield ur(i,e,n,o,u)}catch{}return(function(p,g,x,T,C){const I=p.width,L=p.height;Hr&&Ki||(Hr=new OffscreenCanvas(I,L),Ki=Hr.getContext("2d",{willReadFrequently:!0})),Hr.width=I,Hr.height=L,Ki.drawImage(p,0,0,I,L);const B=Ki.getImageData(g,x,T,C);return Ki.clearRect(0,0,I,L),B.data})(i,e,n,o,u)}))},A.c0=class extends ea{constructor(i,e){super(i,e),this.current=ta}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},A.c1=uc,A.c2=class extends ea{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},A.c3=class extends ea{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},A.c4=Ct,A.c5=function(i,e){var n=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},A.c6=function(i,e,n){var o=e[0],u=e[1],p=e[2];return i[0]=o*n[0]+u*n[3]+p*n[6],i[1]=o*n[1]+u*n[4]+p*n[7],i[2]=o*n[2]+u*n[5]+p*n[8],i},A.c7=function(i,e,n,o,u,p,g){var x=1/(e-n),T=1/(o-u),C=1/(p-g);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+n)*x,i[13]=(u+o)*T,i[14]=(g+p)*C,i[15]=1,i},A.c8=class extends ea{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},A.c9=class extends ea{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},A.cA=function(i,e){return Be[e]&&"touches"in i},A.cB=function(i){return Be[i]||Z[i]},A.cC=function(i,e,n){var o=e[0],u=e[1];return i[0]=n[0]*o+n[4]*u+n[12],i[1]=n[1]*o+n[5]*u+n[13],i},A.cD=function(i,e){const{x:n,y:o}=Gn.fromLngLat(e);return!(i<0||i>25||o<0||o>=1||n<0||n>=1)},A.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},A.cF=class extends pl{},A.cG=v1,A.cI=Se,A.cJ=function(i,e){ge.REGISTERED_PROTOCOLS[i]=e},A.cK=function(i){delete ge.REGISTERED_PROTOCOLS[i]},A.cL=function(i,e){const n={};for(let u=0;u<i.length;u++){const p=e&&e[i[u].id]||Xs(i[u]);e&&(e[i[u].id]=p);let g=n[p];g||(g=n[p]=[]),g.push(i[u])}const o=[];for(const u in n)o.push(n[u]);return o},A.cM=Ot,A.cN=Rm,A.cO=Jm,A.cP=cp,A.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=vt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Fn(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Fn(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Fn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Fn(C),i.canonical),o["text-size"].possiblyEvaluate(new Fn(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Fn(C),i.canonical),o["icon-size"].possiblyEvaluate(new Fn(I),i.canonical)]}const p=n.get("text-line-height")*or,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",x=n.get("text-keep-upright"),T=n.get("text-size");for(const C of i.bucket.features){const I=n.get("text-font").evaluate(C,{},i.canonical).join(","),L=T.evaluate(C,{},i.canonical),B=u.layoutTextSize.evaluate(C,{},i.canonical),F=u.layoutIconSize.evaluate(C,{},i.canonical),G={horizontal:{},vertical:void 0},H=C.text;let Y,J=[0,0];if(H){const ae=H.toString(),me=n.get("text-letter-spacing").evaluate(C,{},i.canonical)*or,ve=fh(ae)?me:0,Ue=n.get("text-anchor").evaluate(C,{},i.canonical),ot=Il(e,C,i.canonical);if(!ot){const yt=n.get("text-radial-offset").evaluate(C,{},i.canonical);J=yt?Un(Ue,[yt*or,wn]):n.get("text-offset").evaluate(C,{},i.canonical).map((rt=>rt*or))}let et=g?"center":n.get("text-justify").evaluate(C,{},i.canonical);const pt=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(C,{},i.canonical)*or:1/0,Dt=()=>{i.bucket.allowVerticalPlacement&&zs(ae)&&(G.vertical=Od(H,i.glyphMap,i.glyphPositions,i.imagePositions,I,pt,p,Ue,"left",ve,J,A.az.vertical,!0,B,L))};if(!g&&ot){const yt=new Set;if(et==="auto")for(let He=0;He<ot.values.length;He+=2)yt.add(eg(ot.values[He]));else yt.add(et);let rt=!1;for(const He of yt)if(!G.horizontal[He])if(rt)G.horizontal[He]=G.horizontal[0];else{const jt=Od(H,i.glyphMap,i.glyphPositions,i.imagePositions,I,pt,p,"center",He,ve,J,A.az.horizontal,!1,B,L);jt&&(G.horizontal[He]=jt,rt=jt.positionedLines.length===1)}Dt()}else{et==="auto"&&(et=eg(Ue));const yt=Od(H,i.glyphMap,i.glyphPositions,i.imagePositions,I,pt,p,Ue,et,ve,J,A.az.horizontal,!1,B,L);yt&&(G.horizontal[et]=yt),Dt(),zs(ae)&&g&&x&&(G.vertical=Od(H,i.glyphMap,i.glyphPositions,i.imagePositions,I,pt,p,Ue,et,ve,J,A.az.vertical,!1,B,L))}}let de=!1;if(C.icon&&C.icon.name){const ae=i.imageMap[C.icon.name];ae&&(Y=Sm(i.imagePositions[C.icon.name],n.get("icon-offset").evaluate(C,{},i.canonical),n.get("icon-anchor").evaluate(C,{},i.canonical)),de=!!ae.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=de:i.bucket.sdfIcons!==de&&Mn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ee=V0(G.horizontal)||G.vertical;i.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||Y)&&y1(i.bucket,C,G,Y,i.imageMap,u,B,F,J,de,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},A.cR=wu,A.cS=dc,A.cT=Sh,A.cU=function(i){const e=new sp;return(function(n,o){for(const u in n.layers)o.writeMessage(3,Ip,n.layers[u])})(i,e),e.finish()},A.cV=function(i,e,n,o,u,p){let g=s(i,e,n,u,0);return g=s(g,e,o,p,1),g},A.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},A.cX=Sn,A.cY=sp,A.cZ=tf,A.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},A.ca=class extends io{},A.cb=Ig,A.cc=class extends gi{},A.cd=bd,A.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},A.cf=No,A.cg=function(i,e,n){var o=e[0],u=e[1],p=e[2],g=n[3]*o+n[7]*u+n[11]*p+n[15];return i[0]=(n[0]*o+n[4]*u+n[8]*p+n[12])/(g=g||1),i[1]=(n[1]*o+n[5]*u+n[9]*p+n[13])/g,i[2]=(n[2]*o+n[6]*u+n[10]*p+n[14])/g,i},A.ch=class extends ml{},A.ci=class extends t{},A.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},A.ck=function(i,e){var n=i[0],o=i[1],u=i[2],p=i[3],g=i[4],x=i[5],T=i[6],C=i[7],I=i[8],L=i[9],B=i[10],F=i[11],G=i[12],H=i[13],Y=i[14],J=i[15],de=e[0],ee=e[1],ae=e[2],me=e[3],ve=e[4],Ue=e[5],ot=e[6],et=e[7],pt=e[8],Dt=e[9],yt=e[10],rt=e[11],He=e[12],jt=e[13],Bt=e[14],Gt=e[15];return Math.abs(n-de)<=Ke*Math.max(1,Math.abs(n),Math.abs(de))&&Math.abs(o-ee)<=Ke*Math.max(1,Math.abs(o),Math.abs(ee))&&Math.abs(u-ae)<=Ke*Math.max(1,Math.abs(u),Math.abs(ae))&&Math.abs(p-me)<=Ke*Math.max(1,Math.abs(p),Math.abs(me))&&Math.abs(g-ve)<=Ke*Math.max(1,Math.abs(g),Math.abs(ve))&&Math.abs(x-Ue)<=Ke*Math.max(1,Math.abs(x),Math.abs(Ue))&&Math.abs(T-ot)<=Ke*Math.max(1,Math.abs(T),Math.abs(ot))&&Math.abs(C-et)<=Ke*Math.max(1,Math.abs(C),Math.abs(et))&&Math.abs(I-pt)<=Ke*Math.max(1,Math.abs(I),Math.abs(pt))&&Math.abs(L-Dt)<=Ke*Math.max(1,Math.abs(L),Math.abs(Dt))&&Math.abs(B-yt)<=Ke*Math.max(1,Math.abs(B),Math.abs(yt))&&Math.abs(F-rt)<=Ke*Math.max(1,Math.abs(F),Math.abs(rt))&&Math.abs(G-He)<=Ke*Math.max(1,Math.abs(G),Math.abs(He))&&Math.abs(H-jt)<=Ke*Math.max(1,Math.abs(H),Math.abs(jt))&&Math.abs(Y-Bt)<=Ke*Math.max(1,Math.abs(Y),Math.abs(Bt))&&Math.abs(J-Gt)<=Ke*Math.max(1,Math.abs(J),Math.abs(Gt))},A.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},A.cm=i=>i.type==="symbol",A.cn=i=>i.type==="circle",A.co=i=>i.type==="heatmap",A.cp=i=>i.type==="line",A.cq=i=>i.type==="fill",A.cr=i=>i.type==="fill-extrusion",A.cs=i=>i.type==="hillshade",A.ct=i=>i.type==="color-relief",A.cu=i=>i.type==="background",A.cv=i=>i.type==="custom",A.cw=Mt,A.cx=function(i,e,n){const o=mt(e.x-n.x,e.y-n.y),u=mt(i.x-n.x,i.y-n.y),p=Math.atan2(o[0]*u[1]-o[1]*u[0],(function(g,x){return g[0]*x[0]+g[1]*x[1]})(o,u));return nr(p)},A.cy=Ft,A.cz=function(i,e){return Z[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},A.d=at,A.d0=xh,A.d1=W,A.d2=class{constructor(i,e){this.layers={[nf]:this},this.name=nf,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new uy(this.features[i],this.extent)}},A.d3=ec,A.d4=Ra,A.e=ln,A.f=i=>l(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),A.g=Re,A.h=i=>new Promise(((e,n)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=cr}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):cr})),A.i=Ri,A.j=(i,e)=>Je(ln(i,{type:"json"}),e),A.k=yn,A.l=Ht,A.m=Je,A.n=(i,e)=>Je(ln(i,{type:"arrayBuffer"}),e),A.o=function(i){return new sp(i).readFields(Ug,[])},A.p=bm,A.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},A.r=xd,A.s=$r,A.t=Ni,A.u=Oe,A.v=su,A.w=Mn,A.x=mh,A.y=Ka,A.z=eo})),z("worker",["./shared"],(function(A){class l{constructor(Z,$){this.keyCache={},Z&&this.replace(Z,$)}replace(Z,$){this._layerConfigs={},this._layers={},this.update(Z,[],$)}update(Z,$,K){for(const ge of Z){this._layerConfigs[ge.id]=ge;const Re=this._layers[ge.id]=A.bT(ge,K);Re._featureFilter=A.aj(Re.filter,K),this.keyCache[ge.id]&&delete this.keyCache[ge.id]}for(const ge of $)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const ue=A.cL(Object.values(this._layerConfigs),this.keyCache);for(const ge of ue){const Re=ge.map((Rt=>this._layers[Rt.id])),ze=Re[0];if(ze.isHidden())continue;const Se=ze.source||"";let De=this.familiesBySource[Se];De||(De=this.familiesBySource[Se]={});const Je=ze.sourceLayer||A.ai;let at=De[Je];at||(at=De[Je]=[]),at.push(Re)}}}class N{constructor(Z){const $={},K=[];for(const ze in Z){const Se=Z[ze],De=$[ze]={};for(const Je in Se){const at=Se[+Je];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Rt={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};K.push(Rt),De[Je]={rect:Rt,metrics:at.metrics}}}const{w:ue,h:ge}=A.p(K),Re=new A.r({width:ue||1,height:ge||1});for(const ze in Z){const Se=Z[ze];for(const De in Se){const Je=Se[+De];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const at=$[ze][De].rect;A.r.copy(Je.bitmap,Re,{x:0,y:0},{x:at.x+1,y:at.y+1},Je.bitmap)}}this.image=Re,this.positions=$}}A.cM("GlyphAtlas",N);class W{constructor(Z){this.tileID=new A.a2(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[]}parse(Z,$,K,ue,ge){return A._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new A.ag;const Re=new A.cN(Object.keys(Z.layers).sort()),ze=new A.cO(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Se={},De={featureIndex:ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:K,subdivisionGranularity:ge},Je=$.familiesBySource[this.source];for(const On in Je){const Ti=Z.layers[On];if(!Ti)continue;Ti.version===1&&A.w(`Vector tile source "${this.source}" layer "${On}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Us=Re.encode(On),Vs=[];for(let bt=0;bt<Ti.length;bt++){const hr=Ti.feature(bt),dr=ze.getId(hr,On);Vs.push({feature:hr,id:dr,index:bt,sourceLayerIndex:Us})}for(const bt of Je[On]){const hr=bt[0];hr.source!==this.source&&A.w(`layer.source = ${hr.source} does not equal this.source = ${this.source}`),hr.isHidden(this.zoom,!0)||(ne(bt,this.zoom,K),(Se[hr.id]=hr.createBucket({index:ze.bucketLayerIDs.length,layers:bt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Us,sourceID:this.source})).populate(Vs,De,this.tileID.canonical),ze.bucketLayerIDs.push(bt.map((dr=>dr.id))))}}const at=A.bY(De.glyphDependencies,(On=>Object.keys(On).map(Number)));this.inFlightDependencies.forEach((On=>On?.abort())),this.inFlightDependencies=[];let Rt=Promise.resolve({});if(Object.keys(at).length){const On=new AbortController;this.inFlightDependencies.push(On),Rt=ue.sendAsync({type:"GG",data:{stacks:at,source:this.source,tileID:this.tileID,type:"glyphs"}},On)}const It=Object.keys(De.iconDependencies);let Ht=Promise.resolve({});if(It.length){const On=new AbortController;this.inFlightDependencies.push(On),Ht=ue.sendAsync({type:"GI",data:{icons:It,source:this.source,tileID:this.tileID,type:"icons"}},On)}const yn=Object.keys(De.patternDependencies);let un=Promise.resolve({});if(yn.length){const On=new AbortController;this.inFlightDependencies.push(On),un=ue.sendAsync({type:"GI",data:{icons:yn,source:this.source,tileID:this.tileID,type:"patterns"}},On)}const Oe=De.dashDependencies;let In=Promise.resolve({});if(Object.keys(Oe).length){const On=new AbortController;this.inFlightDependencies.push(On),In=ue.sendAsync({type:"GDA",data:{dashes:Oe}},On)}const[ui,nn,kn,Ui]=yield Promise.all([Rt,Ht,un,In]),Ln=new N(ui),hi=new A.cP(nn,kn);for(const On in Se){const Ti=Se[On];Ti instanceof A.ah?(ne(Ti.layers,this.zoom,K),A.cQ({bucket:Ti,glyphMap:ui,glyphPositions:Ln.positions,imageMap:nn,imagePositions:hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:De.subdivisionGranularity})):Ti.hasDependencies&&(Ti instanceof A.cR||Ti instanceof A.cS||Ti instanceof A.cT)&&(ne(Ti.layers,this.zoom,K),Ti.addFeatures(De,this.tileID.canonical,hi.patternPositions,Ui))}return this.status="done",{buckets:Object.values(Se).filter((On=>!On.isEmpty())),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ln.image,imageAtlas:hi,dashPositions:Ui,glyphMap:this.returnDependencies?ui:null,iconMap:this.returnDependencies?nn:null,glyphPositions:this.returnDependencies?Ln.positions:null}}))}}function ne(Be,Z,$){const K=new A.H(Z);for(const ue of Be)ue.recalculate(K,$)}class re{constructor(Z,$,K,ue,ge){this.type=Z,this.properties=K||{},this.extent=ge,this.pointsArray=$,this.id=ue}loadGeometry(){return this.pointsArray.map((Z=>Z.map(($=>new A.P($.x,$.y)))))}}class Me{constructor(Z,$,K){this.version=2,this._myFeatures=Z,this.name=$,this.length=Z.length,this.extent=K}feature(Z){return this._myFeatures[Z]}}class be{constructor(){this.layers={}}addLayer(Z){this.layers[Z.name]=Z}}function Ie(Be){let Z=A.cU(Be);return Z.byteOffset===0&&Z.byteLength===Z.buffer.byteLength||(Z=new Uint8Array(Z)),{vectorTile:Be,rawData:Z.buffer}}function fe(Be,Z,$){const{extent:K}=Be,ue=Math.pow(2,$.z-Z.z),ge=($.x-Z.x*ue)*K,Re=($.y-Z.y*ue)*K,ze=[];for(let Se=0;Se<Be.length;Se++){const De=Be.feature(Se);let Je=De.loadGeometry();for(const Rt of Je)for(const It of Rt)It.x=It.x*ue-ge,It.y=It.y*ue-Re;const at=128;Je=A.cV(Je,De.type,-at,-at,K+at,K+at),Je.length!==0&&ze.push(new re(De.type,Je,De.properties,De.id,K))}return new Me(ze,Be.name,K)}class ie{constructor(Z,$,K){this.actor=Z,this.layerIndex=$,this.availableImages=K,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new A.cW(1e3)}loadVectorTile(Z,$){return A._(this,void 0,void 0,(function*(){const K=yield A.n(Z.request,$);try{return{vectorTile:Z.encoding!=="mlt"?new A.cX(new A.cY(K.data)):new A.cZ(K.data),rawData:K.data,cacheControl:K.cacheControl,expires:K.expires}}catch(ue){const ge=new Uint8Array(K.data);let Re=`Unable to parse the tile at ${Z.request.url}, `;throw Re+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.message}`,new Error(Re)}}))}loadTile(Z){return A._(this,void 0,void 0,(function*(){const{uid:$,overzoomParameters:K}=Z;K&&(Z.request=K.overzoomRequest);const ue=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new A.c_(Z.request),ge=new W(Z);this.loading[$]=ge;const Re=new AbortController;ge.abort=Re;try{const ze=yield this.loadVectorTile(Z,Re);if(delete this.loading[$],!ze)return null;if(K){const Rt=this._getOverzoomTile(Z,ze.vectorTile);ze.rawData=Rt.rawData,ze.vectorTile=Rt.vectorTile}const Se=ze.rawData,De={};ze.expires&&(De.expires=ze.expires),ze.cacheControl&&(De.cacheControl=ze.cacheControl);const Je={};if(ue){const Rt=ue.finish();Rt&&(Je.resourceTiming=JSON.parse(JSON.stringify(Rt)))}ge.vectorTile=ze.vectorTile;const at=ge.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);this.loaded[$]=ge,this.fetching[$]={rawTileData:Se,cacheControl:De,resourceTiming:Je};try{const Rt=yield at;return A.e({rawTileData:Se.slice(0),encoding:Z.encoding},Rt,De,Je)}finally{delete this.fetching[$]}}catch(ze){throw delete this.loading[$],ge.status="done",this.loaded[$]=ge,ze}}))}_getOverzoomTile(Z,$){const{tileID:K,source:ue,overzoomParameters:ge}=Z,{maxZoomTileID:Re}=ge,ze=`${Re.key}_${K.key}`,Se=this.overzoomedTileResultCache.get(ze);if(Se)return Se;const De=new be,Je=this.layerIndex.familiesBySource[ue];for(const Rt in Je){const It=$.layers[Rt];if(!It)continue;const Ht=fe(It,Re,K.canonical);Ht.length>0&&De.addLayer(Ht)}const at=Ie(De);return this.overzoomedTileResultCache.set(ze,at),at}reloadTile(Z){return A._(this,void 0,void 0,(function*(){const $=Z.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const K=this.loaded[$];if(K.showCollisionBoxes=Z.showCollisionBoxes,K.status==="parsing"){const ue=yield K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);let ge;if(this.fetching[$]){const{rawTileData:Re,cacheControl:ze,resourceTiming:Se}=this.fetching[$];delete this.fetching[$],ge=A.e({rawTileData:Re.slice(0),encoding:Z.encoding},ue,ze,Se)}else ge=ue;return ge}if(K.status==="done"&&K.vectorTile)return K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity)}))}abortTile(Z){return A._(this,void 0,void 0,(function*(){const $=this.loading,K=Z.uid;$&&$[K]&&$[K].abort&&($[K].abort.abort(),delete $[K])}))}removeTile(Z){return A._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]}))}}class Le{constructor(){this.loaded={}}loadTile(Z){return A._(this,void 0,void 0,(function*(){const{uid:$,encoding:K,rawImageData:ue,redFactor:ge,greenFactor:Re,blueFactor:ze,baseShift:Se}=Z,De=ue.width+2,Je=ue.height+2,at=A.b(ue)?new A.R({width:De,height:Je},yield A.c$(ue,-1,-1,De,Je)):ue,Rt=new A.d0($,at,K,ge,Re,ze,Se);return this.loaded=this.loaded||{},this.loaded[$]=Rt,Rt}))}removeTile(Z){const $=this.loaded,K=Z.uid;$&&$[K]&&delete $[K]}}var Ke,ht,Ct=(function(){if(ht)return Ke;function Be($,K){if($.length!==0){Z($[0],K);for(var ue=1;ue<$.length;ue++)Z($[ue],!K)}}function Z($,K){for(var ue=0,ge=0,Re=0,ze=$.length,Se=ze-1;Re<ze;Se=Re++){var De=($[Re][0]-$[Se][0])*($[Se][1]+$[Re][1]),Je=ue+De;ge+=Math.abs(ue)>=Math.abs(De)?ue-Je+De:De-Je+ue,ue=Je}ue+ge>=0!=!!K&&$.reverse()}return ht=1,Ke=function $(K,ue){var ge,Re=K&&K.type;if(Re==="FeatureCollection")for(ge=0;ge<K.features.length;ge++)$(K.features[ge],ue);else if(Re==="GeometryCollection")for(ge=0;ge<K.geometries.length;ge++)$(K.geometries[ge],ue);else if(Re==="Feature")$(K.geometry,ue);else if(Re==="Polygon")Be(K.coordinates,ue);else if(Re==="MultiPolygon")for(ge=0;ge<K.coordinates.length;ge++)Be(K.coordinates[ge],ue);return K}})(),zt=A.d1(Ct);const tt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},st=Math.fround||(ke=new Float32Array(1),Be=>(ke[0]=+Be,ke[0]));var ke;class ct{constructor(Z){this.options=Object.assign(Object.create(tt),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:$,minZoom:K,maxZoom:ue}=this.options;$&&console.time("total time");const ge=`prepare ${Z.length} points`;$&&console.time(ge),this.points=Z;const Re=[];for(let Se=0;Se<Z.length;Se++){const De=Z[Se];if(!De.geometry)continue;const[Je,at]=De.geometry.coordinates,Rt=st(Et(Je)),It=st(qt(at));Re.push(Rt,It,1/0,Se,-1,1),this.options.reduce&&Re.push(0)}let ze=this.trees[ue+1]=this._createTree(Re);$&&console.timeEnd(ge);for(let Se=ue;Se>=K;Se--){const De=+Date.now();ze=this.trees[Se]=this._createTree(this._cluster(ze,Se)),$&&console.log("z%d: %d clusters in %dms",Se,ze.numItems,+Date.now()-De)}return $&&console.timeEnd("total time"),this}getClusters(Z,$){let K=((Z[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,Z[1]));let ge=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)K=-180,ge=180;else if(K>ge){const at=this.getClusters([K,ue,180,Re],$),Rt=this.getClusters([-180,ue,ge,Re],$);return at.concat(Rt)}const ze=this.trees[this._limitZoom($)],Se=ze.range(Et(K),qt(Re),Et(ge),qt(ue)),De=ze.data,Je=[];for(const at of Se){const Rt=this.stride*at;Je.push(De[Rt+5]>1?it(De,Rt,this.clusterProps):this.points[De[Rt+3]])}return Je}getChildren(Z){const $=this._getOriginId(Z),K=this._getOriginZoom(Z),ue="No cluster with the specified id.",ge=this.trees[K];if(!ge)throw new Error(ue);const Re=ge.data;if($*this.stride>=Re.length)throw new Error(ue);const ze=this.options.radius/(this.options.extent*Math.pow(2,K-1)),Se=ge.within(Re[$*this.stride],Re[$*this.stride+1],ze),De=[];for(const Je of Se){const at=Je*this.stride;Re[at+4]===Z&&De.push(Re[at+5]>1?it(Re,at,this.clusterProps):this.points[Re[at+3]])}if(De.length===0)throw new Error(ue);return De}getLeaves(Z,$,K){const ue=[];return this._appendLeaves(ue,Z,$=$||10,K=K||0,0),ue}getTile(Z,$,K){const ue=this.trees[this._limitZoom(Z)],ge=Math.pow(2,Z),{extent:Re,radius:ze}=this.options,Se=ze/Re,De=(K-Se)/ge,Je=(K+1+Se)/ge,at={features:[]};return this._addTileFeatures(ue.range(($-Se)/ge,De,($+1+Se)/ge,Je),ue.data,$,K,ge,at),$===0&&this._addTileFeatures(ue.range(1-Se/ge,De,1,Je),ue.data,ge,K,ge,at),$===ge-1&&this._addTileFeatures(ue.range(0,De,Se/ge,Je),ue.data,-1,K,ge,at),at.features.length?at:null}getClusterExpansionZoom(Z){let $=this._getOriginZoom(Z)-1;for(;$<=this.options.maxZoom;){const K=this.getChildren(Z);if($++,K.length!==1)break;Z=K[0].properties.cluster_id}return $}_appendLeaves(Z,$,K,ue,ge){const Re=this.getChildren($);for(const ze of Re){const Se=ze.properties;if(Se&&Se.cluster?ge+Se.point_count<=ue?ge+=Se.point_count:ge=this._appendLeaves(Z,Se.cluster_id,K,ue,ge):ge<ue?ge++:Z.push(ze),Z.length===K)break}return ge}_createTree(Z){const $=new A.aT(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<Z.length;K+=this.stride)$.add(Z[K],Z[K+1]);return $.finish(),$.data=Z,$}_addTileFeatures(Z,$,K,ue,ge,Re){for(const ze of Z){const Se=ze*this.stride,De=$[Se+5]>1;let Je,at,Rt;if(De)Je=lt($,Se,this.clusterProps),at=$[Se],Rt=$[Se+1];else{const yn=this.points[$[Se+3]];Je=yn.properties;const[un,Oe]=yn.geometry.coordinates;at=Et(un),Rt=qt(Oe)}const It={type:1,geometry:[[Math.round(this.options.extent*(at*ge-K)),Math.round(this.options.extent*(Rt*ge-ue))]],tags:Je};let Ht;Ht=De||this.options.generateId?$[Se+3]:this.points[$[Se+3]].id,Ht!==void 0&&(It.id=Ht),Re.features.push(It)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,$){const{radius:K,extent:ue,reduce:ge,minPoints:Re}=this.options,ze=K/(ue*Math.pow(2,$)),Se=Z.data,De=[],Je=this.stride;for(let at=0;at<Se.length;at+=Je){if(Se[at+2]<=$)continue;Se[at+2]=$;const Rt=Se[at],It=Se[at+1],Ht=Z.within(Se[at],Se[at+1],ze),yn=Se[at+5];let un=yn;for(const Oe of Ht){const In=Oe*Je;Se[In+2]>$&&(un+=Se[In+5])}if(un>yn&&un>=Re){let Oe,In=Rt*yn,ui=It*yn,nn=-1;const kn=(at/Je<<5)+($+1)+this.points.length;for(const Ui of Ht){const Ln=Ui*Je;if(Se[Ln+2]<=$)continue;Se[Ln+2]=$;const hi=Se[Ln+5];In+=Se[Ln]*hi,ui+=Se[Ln+1]*hi,Se[Ln+4]=kn,ge&&(Oe||(Oe=this._map(Se,at,!0),nn=this.clusterProps.length,this.clusterProps.push(Oe)),ge(Oe,this._map(Se,Ln)))}Se[at+4]=kn,De.push(In/un,ui/un,1/0,kn,-1,un),ge&&De.push(nn)}else{for(let Oe=0;Oe<Je;Oe++)De.push(Se[at+Oe]);if(un>1)for(const Oe of Ht){const In=Oe*Je;if(!(Se[In+2]<=$)){Se[In+2]=$;for(let ui=0;ui<Je;ui++)De.push(Se[In+ui])}}}}return De}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,$,K){if(Z[$+5]>1){const Re=this.clusterProps[Z[$+6]];return K?Object.assign({},Re):Re}const ue=this.points[Z[$+3]].properties,ge=this.options.map(ue);return K&&ge===ue?Object.assign({},ge):ge}}function it(Be,Z,$){return{type:"Feature",id:Be[Z+3],properties:lt(Be,Z,$),geometry:{type:"Point",coordinates:[(K=Be[Z],360*(K-.5)),$t(Be[Z+1])]}};var K}function lt(Be,Z,$){const K=Be[Z+5],ue=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,ge=Be[Z+6],Re=ge===-1?{}:Object.assign({},$[ge]);return Object.assign(Re,{cluster:!0,cluster_id:Be[Z+3],point_count:K,point_count_abbreviated:ue})}function Et(Be){return Be/360+.5}function qt(Be){const Z=Math.sin(Be*Math.PI/180),$=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return $<0?0:$>1?1:$}function $t(Be){const Z=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function ut(Be,Z,$,K){let ue=K;const ge=Z+($-Z>>1);let Re,ze=$-Z;const Se=Be[Z],De=Be[Z+1],Je=Be[$],at=Be[$+1];for(let Rt=Z+3;Rt<$;Rt+=3){const It=we(Be[Rt],Be[Rt+1],Se,De,Je,at);if(It>ue)Re=Rt,ue=It;else if(It===ue){const Ht=Math.abs(Rt-ge);Ht<ze&&(Re=Rt,ze=Ht)}}ue>K&&(Re-Z>3&&ut(Be,Z,Re,K),Be[Re+2]=ue,$-Re>3&&ut(Be,Re,$,K))}function we(Be,Z,$,K,ue,ge){let Re=ue-$,ze=ge-K;if(Re!==0||ze!==0){const Se=((Be-$)*Re+(Z-K)*ze)/(Re*Re+ze*ze);Se>1?($=ue,K=ge):Se>0&&($+=Re*Se,K+=ze*Se)}return Re=Be-$,ze=Z-K,Re*Re+ze*ze}function $e(Be,Z,$,K){const ue={id:Be??null,type:Z,geometry:$,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")mt(ue,$);else if(Z==="Polygon")mt(ue,$[0]);else if(Z==="MultiLineString")for(const ge of $)mt(ue,ge);else if(Z==="MultiPolygon")for(const ge of $)mt(ue,ge[0]);return ue}function mt(Be,Z){for(let $=0;$<Z.length;$+=3)Be.minX=Math.min(Be.minX,Z[$]),Be.minY=Math.min(Be.minY,Z[$+1]),Be.maxX=Math.max(Be.maxX,Z[$]),Be.maxY=Math.max(Be.maxY,Z[$+1])}function vt(Be,Z,$,K){if(!Z.geometry)return;const ue=Z.geometry.coordinates;if(ue&&ue.length===0)return;const ge=Z.geometry.type,Re=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let ze=[],Se=Z.id;if($.promoteId?Se=Z.properties[$.promoteId]:$.generateId&&(Se=K||0),ge==="Point")Ut(ue,ze);else if(ge==="MultiPoint")for(const De of ue)Ut(De,ze);else if(ge==="LineString")xe(ue,ze,Re,!1);else if(ge==="MultiLineString"){if($.lineMetrics){for(const De of ue)ze=[],xe(De,ze,Re,!1),Be.push($e(Se,"LineString",ze,Z.properties));return}Ye(ue,ze,Re,!1)}else if(ge==="Polygon")Ye(ue,ze,Re,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(const De of Z.geometry.geometries)vt(Be,{id:Se,geometry:De,properties:Z.properties},$,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const De of ue){const Je=[];Ye(De,Je,Re,!0),ze.push(Je)}}Be.push($e(Se,ge,ze,Z.properties))}function Ut(Be,Z){Z.push(wt(Be[0]),Mt(Be[1]),0)}function xe(Be,Z,$,K){let ue,ge,Re=0;for(let Se=0;Se<Be.length;Se++){const De=wt(Be[Se][0]),Je=Mt(Be[Se][1]);Z.push(De,Je,0),Se>0&&(Re+=K?(ue*Je-De*ge)/2:Math.sqrt(Math.pow(De-ue,2)+Math.pow(Je-ge,2))),ue=De,ge=Je}const ze=Z.length-3;Z[2]=1,ut(Z,0,ze,$),Z[ze+2]=1,Z.size=Math.abs(Re),Z.start=0,Z.end=Z.size}function Ye(Be,Z,$,K){for(let ue=0;ue<Be.length;ue++){const ge=[];xe(Be[ue],ge,$,K),Z.push(ge)}}function wt(Be){return Be/360+.5}function Mt(Be){const Z=Math.sin(Be*Math.PI/180),$=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return $<0?0:$>1?1:$}function Ft(Be,Z,$,K,ue,ge,Re,ze){if(K/=Z,ge>=($/=Z)&&Re<K)return Be;if(Re<$||ge>=K)return null;const Se=[];for(const De of Be){const Je=De.geometry;let at=De.type;const Rt=ue===0?De.minX:De.minY,It=ue===0?De.maxX:De.maxY;if(Rt>=$&&It<K){Se.push(De);continue}if(It<$||Rt>=K)continue;let Ht=[];if(at==="Point"||at==="MultiPoint")Zt(Je,Ht,$,K,ue);else if(at==="LineString")Vt(Je,Ht,$,K,ue,!1,ze.lineMetrics);else if(at==="MultiLineString")Qt(Je,Ht,$,K,ue,!1);else if(at==="Polygon")Qt(Je,Ht,$,K,ue,!0);else if(at==="MultiPolygon")for(const yn of Je){const un=[];Qt(yn,un,$,K,ue,!0),un.length&&Ht.push(un)}if(Ht.length){if(ze.lineMetrics&&at==="LineString"){for(const yn of Ht)Se.push($e(De.id,at,yn,De.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(Ht.length===1?(at="LineString",Ht=Ht[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=Ht.length===3?"Point":"MultiPoint"),Se.push($e(De.id,at,Ht,De.tags))}}return Se.length?Se:null}function Zt(Be,Z,$,K,ue){for(let ge=0;ge<Be.length;ge+=3){const Re=Be[ge+ue];Re>=$&&Re<=K&&Dn(Z,Be[ge],Be[ge+1],Be[ge+2])}}function Vt(Be,Z,$,K,ue,ge,Re){let ze=ln(Be);const Se=ue===0?ai:Rn;let De,Je,at=Be.start;for(let un=0;un<Be.length-3;un+=3){const Oe=Be[un],In=Be[un+1],ui=Be[un+2],nn=Be[un+3],kn=Be[un+4],Ui=ue===0?Oe:In,Ln=ue===0?nn:kn;let hi=!1;Re&&(De=Math.sqrt(Math.pow(Oe-nn,2)+Math.pow(In-kn,2))),Ui<$?Ln>$&&(Je=Se(ze,Oe,In,nn,kn,$),Re&&(ze.start=at+De*Je)):Ui>K?Ln<K&&(Je=Se(ze,Oe,In,nn,kn,K),Re&&(ze.start=at+De*Je)):Dn(ze,Oe,In,ui),Ln<$&&Ui>=$&&(Je=Se(ze,Oe,In,nn,kn,$),hi=!0),Ln>K&&Ui<=K&&(Je=Se(ze,Oe,In,nn,kn,K),hi=!0),!ge&&hi&&(Re&&(ze.end=at+De*Je),Z.push(ze),ze=ln(Be)),Re&&(at+=De)}let Rt=Be.length-3;const It=Be[Rt],Ht=Be[Rt+1],yn=ue===0?It:Ht;yn>=$&&yn<=K&&Dn(ze,It,Ht,Be[Rt+2]),Rt=ze.length-3,ge&&Rt>=3&&(ze[Rt]!==ze[0]||ze[Rt+1]!==ze[1])&&Dn(ze,ze[0],ze[1],ze[2]),ze.length&&Z.push(ze)}function ln(Be){const Z=[];return Z.size=Be.size,Z.start=Be.start,Z.end=Be.end,Z}function Qt(Be,Z,$,K,ue,ge){for(const Re of Be)Vt(Re,Z,$,K,ue,ge,!1)}function Dn(Be,Z,$,K){Be.push(Z,$,K)}function ai(Be,Z,$,K,ue,ge){const Re=(ge-Z)/(K-Z);return Dn(Be,ge,$+(ue-$)*Re,1),Re}function Rn(Be,Z,$,K,ue,ge){const Re=(ge-$)/(ue-$);return Dn(Be,Z+(K-Z)*Re,ge,1),Re}function lr(Be,Z){const $=[];for(let K=0;K<Be.length;K++){const ue=Be[K],ge=ue.type;let Re;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")Re=Mn(ue.geometry,Z);else if(ge==="MultiLineString"||ge==="Polygon"){Re=[];for(const ze of ue.geometry)Re.push(Mn(ze,Z))}else if(ge==="MultiPolygon"){Re=[];for(const ze of ue.geometry){const Se=[];for(const De of ze)Se.push(Mn(De,Z));Re.push(Se)}}$.push($e(ue.id,ge,Re,ue.tags))}return $}function Mn(Be,Z){const $=[];$.size=Be.size,Be.start!==void 0&&($.start=Be.start,$.end=Be.end);for(let K=0;K<Be.length;K+=3)$.push(Be[K]+Z,Be[K+1],Be[K+2]);return $}function ci(Be,Z){if(Be.transformed)return Be;const $=1<<Be.z,K=Be.x,ue=Be.y;for(const ge of Be.features){const Re=ge.geometry,ze=ge.type;if(ge.geometry=[],ze===1)for(let Se=0;Se<Re.length;Se+=2)ge.geometry.push(Ri(Re[Se],Re[Se+1],Z,$,K,ue));else for(let Se=0;Se<Re.length;Se++){const De=[];for(let Je=0;Je<Re[Se].length;Je+=2)De.push(Ri(Re[Se][Je],Re[Se][Je+1],Z,$,K,ue));ge.geometry.push(De)}}return Be.transformed=!0,Be}function Ri(Be,Z,$,K,ue,ge){return[Math.round($*(Be*K-ue)),Math.round($*(Z*K-ge))]}function Jn(Be,Z,$,K,ue){const ge=Z===ue.maxZoom?0:ue.tolerance/((1<<Z)*ue.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:$,y:K,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ze of Be)Wi(Re,ze,ge,ue);return Re}function Wi(Be,Z,$,K){const ue=Z.geometry,ge=Z.type,Re=[];if(Be.minX=Math.min(Be.minX,Z.minX),Be.minY=Math.min(Be.minY,Z.minY),Be.maxX=Math.max(Be.maxX,Z.maxX),Be.maxY=Math.max(Be.maxY,Z.maxY),ge==="Point"||ge==="MultiPoint")for(let ze=0;ze<ue.length;ze+=3)Re.push(ue[ze],ue[ze+1]),Be.numPoints++,Be.numSimplified++;else if(ge==="LineString")cr(Re,ue,Be,$,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(let ze=0;ze<ue.length;ze++)cr(Re,ue[ze],Be,$,ge==="Polygon",ze===0);else if(ge==="MultiPolygon")for(let ze=0;ze<ue.length;ze++){const Se=ue[ze];for(let De=0;De<Se.length;De++)cr(Re,Se[De],Be,$,!0,De===0)}if(Re.length){let ze=Z.tags||null;if(ge==="LineString"&&K.lineMetrics){ze={};for(const De in Z.tags)ze[De]=Z.tags[De];ze.mapbox_clip_start=ue.start/ue.size,ze.mapbox_clip_end=ue.end/ue.size}const Se={geometry:Re,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:ze};Z.id!==null&&(Se.id=Z.id),Be.features.push(Se)}}function cr(Be,Z,$,K,ue,ge){const Re=K*K;if(K>0&&Z.size<(ue?Re:K))return void($.numPoints+=Z.length/3);const ze=[];for(let Se=0;Se<Z.length;Se+=3)(K===0||Z[Se+2]>Re)&&($.numSimplified++,ze.push(Z[Se],Z[Se+1])),$.numPoints++;ue&&(function(Se,De){let Je=0;for(let at=0,Rt=Se.length,It=Rt-2;at<Rt;It=at,at+=2)Je+=(Se[at]-Se[It])*(Se[at+1]+Se[It+1]);if(Je>0===De)for(let at=0,Rt=Se.length;at<Rt/2;at+=2){const It=Se[at],Ht=Se[at+1];Se[at]=Se[Rt-2-at],Se[at+1]=Se[Rt-1-at],Se[Rt-2-at]=It,Se[Rt-1-at]=Ht}})(ze,ge),Be.push(ze)}const ur={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Hr{constructor(Z,$){const K=($=this.options=(function(ge,Re){for(const ze in Re)ge[ze]=Re[ze];return ge})(Object.create(ur),$)).debug;if(K&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=(function(ge,Re){const ze=[];if(ge.type==="FeatureCollection")for(let Se=0;Se<ge.features.length;Se++)vt(ze,ge.features[Se],Re,Se);else vt(ze,ge.type==="Feature"?ge:{geometry:ge},Re);return ze})(Z,$);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=(function(ge,Re){const ze=Re.buffer/Re.extent;let Se=ge;const De=Ft(ge,1,-1-ze,ze,0,-1,2,Re),Je=Ft(ge,1,1-ze,2+ze,0,-1,2,Re);return(De||Je)&&(Se=Ft(ge,1,-ze,1+ze,0,-1,2,Re)||[],De&&(Se=lr(De,1).concat(Se)),Je&&(Se=Se.concat(lr(Je,-1)))),Se})(ue,$),ue.length&&this.splitTile(ue,0,0,0),K&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,$,K,ue,ge,Re,ze){const Se=[Z,$,K,ue],De=this.options,Je=De.debug;for(;Se.length;){ue=Se.pop(),K=Se.pop(),$=Se.pop(),Z=Se.pop();const at=1<<$,Rt=Ki($,K,ue);let It=this.tiles[Rt];if(!It&&(Je>1&&console.time("creation"),It=this.tiles[Rt]=Jn(Z,$,K,ue,De),this.tileCoords.push({z:$,x:K,y:ue}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,K,ue,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));const hi=`z${$}`;this.stats[hi]=(this.stats[hi]||0)+1,this.total++}if(It.source=Z,ge==null){if($===De.indexMaxZoom||It.numPoints<=De.indexMaxPoints)continue}else{if($===De.maxZoom||$===ge)continue;if(ge!=null){const hi=ge-$;if(K!==Re>>hi||ue!==ze>>hi)continue}}if(It.source=null,Z.length===0)continue;Je>1&&console.time("clipping");const Ht=.5*De.buffer/De.extent,yn=.5-Ht,un=.5+Ht,Oe=1+Ht;let In=null,ui=null,nn=null,kn=null,Ui=Ft(Z,at,K-Ht,K+un,0,It.minX,It.maxX,De),Ln=Ft(Z,at,K+yn,K+Oe,0,It.minX,It.maxX,De);Z=null,Ui&&(In=Ft(Ui,at,ue-Ht,ue+un,1,It.minY,It.maxY,De),ui=Ft(Ui,at,ue+yn,ue+Oe,1,It.minY,It.maxY,De),Ui=null),Ln&&(nn=Ft(Ln,at,ue-Ht,ue+un,1,It.minY,It.maxY,De),kn=Ft(Ln,at,ue+yn,ue+Oe,1,It.minY,It.maxY,De),Ln=null),Je>1&&console.timeEnd("clipping"),Se.push(In||[],$+1,2*K,2*ue),Se.push(ui||[],$+1,2*K,2*ue+1),Se.push(nn||[],$+1,2*K+1,2*ue),Se.push(kn||[],$+1,2*K+1,2*ue+1)}}getTile(Z,$,K){Z=+Z,$=+$,K=+K;const ue=this.options,{extent:ge,debug:Re}=ue;if(Z<0||Z>24)return null;const ze=1<<Z,Se=Ki(Z,$=$+ze&ze-1,K);if(this.tiles[Se])return ci(this.tiles[Se],ge);Re>1&&console.log("drilling down to z%d-%d-%d",Z,$,K);let De,Je=Z,at=$,Rt=K;for(;!De&&Je>0;)Je--,at>>=1,Rt>>=1,De=this.tiles[Ki(Je,at,Rt)];return De&&De.source?(Re>1&&(console.log("found parent tile z%d-%d-%d",Je,at,Rt),console.time("drilling down")),this.splitTile(De.source,Je,at,Rt,Z,$,K),Re>1&&console.timeEnd("drilling down"),this.tiles[Se]?ci(this.tiles[Se],ge):null):null}}function Ki(Be,Z,$){return 32*((1<<Be)*$+Z)+Be}class $r extends ie{constructor(Z,$,K,ue=Li){super(Z,$,K),this._dataUpdateable=new Map,this._createGeoJSONIndex=ue}loadVectorTile(Z,$){return A._(this,void 0,void 0,(function*(){const K=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(K.z,K.x,K.y);return ue?Ie(new A.d2(ue.features,{version:2,extent:A.a5})):null}))}loadData(Z){return A._(this,void 0,void 0,(function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();const K=this._startPerformance(Z);this._pendingRequest=new AbortController;try{(!this._pendingData||Z.request||Z.data||Z.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Z,this._pendingRequest));const ue=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ue,Z),this.loaded={};const ge={};return Z.request&&(ge.data=ue),this._finishPerformance(K,Z,ge),ge}catch(ue){if(delete this._pendingRequest,A.Z(ue))return{abandoned:!0};throw ue}}))}_startPerformance(Z){var $;if(!(($=Z?.request)===null||$===void 0)&&$.collectResourceTiming)return new A.c_(Z.request)}_finishPerformance(Z,$,K){if(!Z)return;const ue=Z.finish();ue&&(K.resourceTiming={},K.resourceTiming[$.source]=JSON.parse(JSON.stringify(ue)))}getData(){return A._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Z){const $=this.loaded;return $&&$[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadAndProcessGeoJSON(Z,$){return A._(this,void 0,void 0,(function*(){let K;if(Z.request?K=yield this.loadGeoJSONFromUrl(Z.request,Z.promoteId,$):Z.data?K=this._loadGeoJSONFromObject(Z.data,Z.promoteId):Z.dataDiff&&(K=this._loadGeoJSONFromDiff(Z.dataDiff,Z.promoteId,Z.source)),delete this._pendingRequest,typeof K!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);return zt(K,!0),Z.filter&&(K=this._filterGeoJSON(K,Z.filter)),K}))}loadGeoJSONFromUrl(Z,$,K){return A._(this,void 0,void 0,(function*(){const ue=yield A.j(Z,K);return this._dataUpdateable=A.a7(ue.data,$),ue.data}))}_loadGeoJSONFromObject(Z,$){return this._dataUpdateable=A.a7(Z,$),Z}_loadGeoJSONFromDiff(Z,$,K){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K}`);A.a8(this._dataUpdateable,Z,$);const ue=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ue)}_filterGeoJSON(Z,$){const K=A.d3($,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(K.result==="error")throw new Error(K.value.map((ge=>`${ge.key}: ${ge.message}`)).join(", "));const ue=Z.features.filter((ge=>K.value.evaluate({zoom:0},ge)));return this._toFeatureCollection(ue)}_toFeatureCollection(Z){return{type:"FeatureCollection",features:Z}}removeSource(Z){return A._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}function Li(Be,Z){return Z.cluster?new ct((function({superclusterOptions:$,clusterProperties:K}){if(!K||!$)return $;const ue={},ge={},Re={accumulated:null,zoom:0},ze={properties:null},Se=Object.keys(K);for(const De of Se){const[Je,at]=K[De],Rt=A.d3(at),It=A.d3(typeof Je=="string"?[Je,["accumulated"],["get",De]]:Je);ue[De]=Rt.value,ge[De]=It.value}return $.map=De=>{ze.properties=De;const Je={};for(const at of Se)Je[at]=ue[at].evaluate(Re,ze);return Je},$.reduce=(De,Je)=>{ze.properties=Je;for(const at of Se)Re.accumulated=De[at],De[at]=ge[at].evaluate(Re,ze)},$})(Z)).load(Be.features):(function($,K){return new Hr($,K)})(Be,Z.geojsonVtOptions)}class nr{constructor(Z){this.self=Z,this.actor=new A.L(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=($,K)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=K},this.self.addProtocol=A.cJ,this.self.removeProtocol=A.cK,this.self.registerRTLTextPlugin=$=>{A.d4.setMethods($)},this.actor.registerMessageHandler("LDT",(($,K)=>this._getDEMWorkerSource($,K.source).loadTile(K))),this.actor.registerMessageHandler("RDT",(($,K)=>A._(this,void 0,void 0,(function*(){this._getDEMWorkerSource($,K.source).removeTile(K)})))),this.actor.registerMessageHandler("GCEZ",(($,K)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource($,K.type,K.source).getClusterExpansionZoom(K)})))),this.actor.registerMessageHandler("GCC",(($,K)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource($,K.type,K.source).getClusterChildren(K)})))),this.actor.registerMessageHandler("GCL",(($,K)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource($,K.type,K.source).getClusterLeaves(K)})))),this.actor.registerMessageHandler("LD",(($,K)=>this._getWorkerSource($,K.type,K.source).loadData(K))),this.actor.registerMessageHandler("GD",(($,K)=>this._getWorkerSource($,K.type,K.source).getData())),this.actor.registerMessageHandler("LT",(($,K)=>this._getWorkerSource($,K.type,K.source).loadTile(K))),this.actor.registerMessageHandler("RT",(($,K)=>this._getWorkerSource($,K.type,K.source).reloadTile(K))),this.actor.registerMessageHandler("AT",(($,K)=>this._getWorkerSource($,K.type,K.source).abortTile(K))),this.actor.registerMessageHandler("RMT",(($,K)=>this._getWorkerSource($,K.type,K.source).removeTile(K))),this.actor.registerMessageHandler("RS",(($,K)=>A._(this,void 0,void 0,(function*(){if(!this.workerSources[$]||!this.workerSources[$][K.type]||!this.workerSources[$][K.type][K.source])return;const ue=this.workerSources[$][K.type][K.source];delete this.workerSources[$][K.type][K.source],ue.removeSource!==void 0&&ue.removeSource(K)})))),this.actor.registerMessageHandler("RM",($=>A._(this,void 0,void 0,(function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],this.globalStates.delete($)})))),this.actor.registerMessageHandler("SR",(($,K)=>A._(this,void 0,void 0,(function*(){this.referrer=K})))),this.actor.registerMessageHandler("SRPS",(($,K)=>this._syncRTLPluginState($,K))),this.actor.registerMessageHandler("IS",(($,K)=>A._(this,void 0,void 0,(function*(){this.self.importScripts(K)})))),this.actor.registerMessageHandler("SI",(($,K)=>this._setImages($,K))),this.actor.registerMessageHandler("UL",(($,K)=>A._(this,void 0,void 0,(function*(){this._getLayerIndex($).update(K.layers,K.removedIds,this._getGlobalState($))})))),this.actor.registerMessageHandler("UGS",(($,K)=>A._(this,void 0,void 0,(function*(){const ue=this._getGlobalState($);for(const ge in K)ue[ge]=K[ge]})))),this.actor.registerMessageHandler("SL",(($,K)=>A._(this,void 0,void 0,(function*(){this._getLayerIndex($).replace(K,this._getGlobalState($))}))))}_getGlobalState(Z){let $=this.globalStates.get(Z);return $||($={},this.globalStates.set(Z,$)),$}_setImages(Z,$){return A._(this,void 0,void 0,(function*(){this.availableImages[Z]=$;for(const K in this.workerSources[Z]){const ue=this.workerSources[Z][K];for(const ge in ue)ue[ge].availableImages=$}}))}_syncRTLPluginState(Z,$){return A._(this,void 0,void 0,(function*(){return yield A.d4.syncState($,this.self.importScripts)}))}_getAvailableImages(Z){let $=this.availableImages[Z];return $||($=[]),$}_getLayerIndex(Z){let $=this.layerIndexes[Z];return $||($=this.layerIndexes[Z]=new l),$}_getWorkerSource(Z,$,K){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][$]||(this.workerSources[Z][$]={}),!this.workerSources[Z][$][K]){const ue={sendAsync:(ge,Re)=>(ge.targetMapId=Z,this.actor.sendAsync(ge,Re))};switch($){case"vector":this.workerSources[Z][$][K]=new ie(ue,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][$][K]=new $r(ue,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][$][K]=new this.externalWorkerSourceTypes[$](ue,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][$][K]}_getDEMWorkerSource(Z,$){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][$]||(this.demWorkerSources[Z][$]=new Le),this.demWorkerSources[Z][$]}}return A.i(self)&&(self.worker=new nr(self)),nr})),z("index",["exports","./shared"],(function(A,l){var N="5.15.0";function W(){var y=new l.A(4);return l.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}let ne,re,Me;const be={frame(y,t,a){const c=requestAnimationFrame((v=>{f(),t(v)})),{unsubscribe:f}=l.s(y.signal,"abort",(()=>{f(),cancelAnimationFrame(c),a(new l.a(y.signal.reason))}),!1)},frameAsync(y){return new Promise(((t,a)=>{this.frame(y,t,a)}))},getImageData(y,t=0){return this.getImageCanvasContext(y).getImageData(-t,-t,y.width+2*t,y.height+2*t)},getImageCanvasContext(y){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=y.width,t.height=y.height,a.drawImage(y,0,0,y.width,y.height),a},resolveURL:y=>(ne||(ne=document.createElement("a")),ne.href=y,ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Me!==void 0?Me:!!matchMedia&&(re==null&&(re=matchMedia("(prefers-reduced-motion: reduce)")),re.matches)},set prefersReducedMotion(y){Me=y}},Ie=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(y){this._frozenAt=y}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function fe(){return Ie.getCurrentTime()}class ie{static testProp(t){if(!ie.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in ie.docStyle)return t[a];return t[0]}static create(t,a,c){const f=window.document.createElement(t);return a!==void 0&&(f.className=a),c&&c.appendChild(f),f}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){ie.docStyle&&ie.selectProp&&(ie.userSelect=ie.docStyle[ie.selectProp],ie.docStyle[ie.selectProp]="none")}static enableDrag(){ie.docStyle&&ie.selectProp&&(ie.docStyle[ie.selectProp]=ie.userSelect)}static setTransform(t,a){t.style[ie.transformProp]=a}static addEventListener(t,a,c,f={}){t.addEventListener(a,c,"passive"in f?f:f.capture)}static removeEventListener(t,a,c,f={}){t.removeEventListener(a,c,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",ie.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ie.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ie.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,c){const f=a.boundingClientRect;return new l.P((c.clientX-f.left)/a.x-t.clientLeft,(c.clientY-f.top)/a.y-t.clientTop)}static mousePos(t,a){const c=ie.getScale(t);return ie.getPoint(t,c,a)}static touchPos(t,a){const c=[],f=ie.getScale(t);for(let v=0;v<a.length;v++)c.push(ie.getPoint(t,f,a[v]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(const f of c)f.remove();return ie.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const c of a)ie.removeAttributes(c),ie.clean(c)}static removeAttributes(t){for(const{name:a,value:c}of t.attributes)ie.isPossiblyDangerous(a,c)&&t.removeAttribute(a)}}ie.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ie.selectProp=ie.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ie.transformProp=ie.testProp(["transform","WebkitTransform"]);const Le={supported:!1,testSupport:function(y){!Ct&&ht&&(zt?tt(y):Ke=y)}};let Ke,ht,Ct=!1,zt=!1;function tt(y){const t=y.createTexture();y.bindTexture(y.TEXTURE_2D,t);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,ht),y.isContextLost())return;Le.supported=!0}catch{}y.deleteTexture(t),Ct=!0}var st;typeof document<"u"&&(ht=document.createElement("img"),ht.onload=()=>{Ke&&tt(Ke),Ke=null,zt=!0},ht.onerror=()=>{Ct=!0,Ke=null},ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(y){let t,a,c,f;y.resetRequestQueue=()=>{t=[],a=0,c=0,f={}},y.addThrottleControl=P=>{const R=c++;return f[R]=P,R},y.removeThrottleControl=P=>{delete f[P],w()},y.getImage=(P,R,O=!0)=>new Promise(((V,j)=>{Le.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),l.e(P,{type:"image"}),t.push({abortController:R,requestParameters:P,supportImageRefresh:O,state:"queued",onError:X=>{j(X)},onSuccess:X=>{V(X)}}),w()}));const v=P=>l._(this,void 0,void 0,(function*(){P.state="running";const{requestParameters:R,supportImageRefresh:O,onError:V,onSuccess:j,abortController:X}=P,Q=O===!1&&!l.i(self)&&!l.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce(((oe,he)=>oe&&he==="accept"),!0));a++;const se=Q?E(R,X):l.m(R,X);try{const oe=yield se;delete P.abortController,P.state="completed",oe.data instanceof HTMLImageElement||l.b(oe.data)?j(oe):oe.data&&j({data:yield(le=oe.data,typeof createImageBitmap=="function"?l.f(le):l.h(le)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete P.abortController,V(oe)}finally{a--,w()}var le})),w=()=>{const P=(()=>{for(const R of Object.keys(f))if(f[R]())return!0;return!1})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=a;R<P&&t.length>0;R++){const O=t.shift();O.abortController.signal.aborted?R--:v(O)}},E=(P,R)=>new Promise(((O,V)=>{const j=new Image,X=P.url,Q=P.credentials;Q&&Q==="include"?j.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!l.d(X))&&(j.crossOrigin="anonymous"),R.signal.addEventListener("abort",(()=>{j.src="",V(new l.a(R.signal.reason))})),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,O({data:j})},j.onerror=()=>{j.onerror=j.onload=null,R.signal.aborted||V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=X}))})(st||(st={})),st.resetRequestQueue();class ke{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ct(y){const t=[];if(typeof y=="string")t.push({id:"default",url:y});else if(y&&y.length>0){const a=[];for(const{id:c,url:f}of y){const v=`${c}${f}`;a.indexOf(v)===-1&&(a.push(v),t.push({id:c,url:f}))}}return t}function it(y,t,a){try{const c=new URL(y);return c.pathname+=`${t}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${y}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function lt(y){const{userImage:t}=y;return!!(t&&t.render&&t.render())&&(y.data.replace(new Uint8Array(t.data.buffer)),!0)}class Et extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new l.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let c=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,a){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||a<f[1])return!1;c=f[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const c=a.spriteData,f=c&&c.width||a.data.width,v=c&&c.height||a.data.height;return!(t[0]<0||f<t[0]||t[1]<0||v<t[1]||t[2]<0||f<t[2]||t[3]<0||v<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,c=!0){const f=this.getImage(t);if(c&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,c)=>{let f=!0;if(!this.isLoaded())for(const v of t)this.images[v]||(f=!1);this.isLoaded()||f?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const c of t){let f=this.getImage(c);f||(this.fire(new l.l("styleimagemissing",{id:c})),f=this.getImage(c)),f?a[c]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],c=this.getImage(t);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const f={w:c.data.width+2,h:c.data.height+2,x:0,y:0},v=new l.I(f,c);this.patterns[t]={bin:f,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:a,h:c}=l.p(t),f=this.atlasImage;f.resize({width:a||1,height:c||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],E=w.x+1,P=w.y+1,R=this.getImage(v).data,O=R.width,V=R.height;l.R.copy(R,f,{x:0,y:0},{x:E,y:P},{width:O,height:V}),l.R.copy(R,f,{x:0,y:V-1},{x:E,y:P-1},{width:O,height:1}),l.R.copy(R,f,{x:0,y:0},{x:E,y:P+V},{width:O,height:1}),l.R.copy(R,f,{x:O-1,y:0},{x:E-1,y:P},{width:1,height:V}),l.R.copy(R,f,{x:0,y:0},{x:E+O,y:P},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||l.w(`Image with ID: "${a}" was not found`),lt(c)&&this.updateImage(a,c)}}cloneImages(){const t={};for(const a in this.images){const c=this.images[a];t[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return t}}const qt=1e20;function $t(y,t,a,c,f,v,w,E,P){for(let R=t;R<t+c;R++)ut(y,a*v+R,v,f,w,E,P);for(let R=a;R<a+f;R++)ut(y,R*v+t,1,c,w,E,P)}function ut(y,t,a,c,f,v,w){v[0]=0,w[0]=-qt,w[1]=qt,f[0]=y[t];for(let E=1,P=0,R=0;E<c;E++){f[E]=y[t+E*a];const O=E*E;do{const V=v[P];R=(f[E]-f[V]+O-V*V)/(E-V)/2}while(R<=w[P]&&--P>-1);P++,v[P]=E,w[P]=R,w[P+1]=qt}for(let E=0,P=0;E<c;E++){for(;w[P+1]<E;)P++;const R=v[P],O=E-R;y[t+E*a]=f[R]+O*O}}const we=l.v.layout_symbol["text-font"].default.join(",");class $e{constructor(t,a,c){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,(function*(){const a=[];for(const v in t)for(const w of t[v])a.push(this._getAndCacheGlyphsPromise(v,w));const c=yield Promise.all(a),f={};for(const{stack:v,id:w,glyph:E}of c)f[v]||(f[v]={}),f[v][w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return f}))}_getAndCacheGlyphsPromise(t,a){return l._(this,void 0,void 0,(function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let f=c.glyphs[a];return f!==void 0?{stack:t,id:a,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(f=c.glyphs[a]=this._drawGlyph(c,t,a),{stack:t,id:a,glyph:f}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return l._(this,void 0,void 0,(function*(){const c=this.entries[t],f=Math.floor(a/256);if(c.ranges[f])return{stack:t,id:a,glyph:null};if(!c.requests[f]){const v=$e.loadGlyphRange(t,f,this.url,this.requestManager);c.requests[f]=v}try{const v=yield c.requests[f];for(const w in v)c.glyphs[+w]=v[+w];return c.ranges[f]=!0,{stack:t,id:a,glyph:v[a]||null}}catch(v){const w=c.glyphs[a]=this._drawGlyph(c,t,a);return this._warnOnMissingGlyphRange(w,f,a,v),{stack:t,id:a,glyph:w}}}))}_warnOnMissingGlyphRange(t,a,c,f){const v=256*a,w=v+255,E=c.toString(16).padStart(4,"0").toUpperCase();l.w(`Unable to load glyph range ${a}, ${v}-${w}. Rendering codepoint U+${E} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&l.q(t)}_drawGlyph(t,a,c){const f=a===we&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),v=f?"ideographTinySDF":"tinySDF";t[v]||(t[v]=this._createTinySDF(f?this.localIdeographFontFamily:a));const w=t[v].draw(String.fromCodePoint(c));return{id:c,bitmap:new l.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const c=a.map((f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`)).join(",");return new $e.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[f,v]of Object.entries(a))new RegExp(`\\b${f}\\b`,"i").test(t)&&(c=`${v}`);return c}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}$e.loadGlyphRange=function(y,t,a,c){return l._(this,void 0,void 0,(function*(){const f=256*t,v=f+255,w=c.transformRequest(a.replace("{fontstack}",y).replace("{range}",`${f}-${v}`),"Glyphs"),E=yield l.n(w,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${t}, ${f}-${v}`);const P={};for(const R of l.o(E.data))P[R.id]=R;return P}))},$e.TinySDF=class{constructor({fontSize:y=24,buffer:t=3,radius:a=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:v="normal",fontStyle:w="normal",lang:E=null}={}){this.buffer=t,this.cutoff=c,this.radius=a,this.lang=E;const P=this.size=y+4*t,R=this._createCanvas(P),O=this.ctx=R.getContext("2d",{willReadFrequently:!0});O.font=`${w} ${v} ${y}px ${f}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(y){const t=document.createElement("canvas");return t.width=t.height=y,t}draw(y){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:v}=this.ctx.measureText(y),w=Math.ceil(a),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-f))),P=Math.min(this.size-this.buffer,w+Math.ceil(c)),R=E+2*this.buffer,O=P+2*this.buffer,V=Math.max(R*O,0),j=new Uint8ClampedArray(V),X={data:j,width:R,height:O,glyphWidth:E,glyphHeight:P,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(E===0||P===0)return X;const{ctx:Q,buffer:se,gridInner:le,gridOuter:oe}=this;this.lang&&(Q.lang=this.lang),Q.clearRect(se,se,E,P),Q.fillText(y,se,se+w);const he=Q.getImageData(se,se,E,P);oe.fill(qt,0,V),le.fill(0,0,V);for(let _e=0;_e<P;_e++)for(let ce=0;ce<E;ce++){const ye=he.data[4*(_e*E+ce)+3]/255;if(ye===0)continue;const Te=(_e+se)*R+ce+se;if(ye===1)oe[Te]=0,le[Te]=qt;else{const pe=.5-ye;oe[Te]=pe>0?pe*pe:0,le[Te]=pe<0?pe*pe:0}}$t(oe,0,0,R,O,R,this.f,this.v,this.z),$t(le,se,se,E,P,R,this.f,this.v,this.z);for(let _e=0;_e<V;_e++){const ce=Math.sqrt(oe[_e])-Math.sqrt(le[_e]);j[_e]=Math.round(255-255*(ce/this.radius+this.cutoff))}return X}};class mt{constructor(){this.specification=l.u.light.position}possiblyEvaluate(t,a){return l.F(t.expression.evaluate(a))}interpolate(t,a,c){return{x:l.G.number(t.x,a.x,c),y:l.G.number(t.y,a.y,c),z:l.G.number(t.z,a.z,c)}}}let vt;class Ut extends l.E{constructor(t){super(),vt=vt||new l.t({anchor:new l.D(l.u.light.anchor),position:new mt,color:new l.D(l.u.light.color),intensity:new l.D(l.u.light.intensity)}),this._transitionable=new l.x(vt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(l.y,t,a))for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c){return(!c||c.validate!==!1)&&l.B(this,t.call(l.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u}))}}const xe=new l.t({"sky-color":new l.D(l.u.sky["sky-color"]),"horizon-color":new l.D(l.u.sky["horizon-color"]),"fog-color":new l.D(l.u.sky["fog-color"]),"fog-ground-blend":new l.D(l.u.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.u.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.u.sky["atmosphere-blend"])});class Ye extends l.E{constructor(t){super(),this._transitionable=new l.x(xe,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0))}setSky(t,a={}){if(!this._validate(l.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c={}){return c?.validate!==!1&&l.B(this,t.call(l.C,l.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class wt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const c=t.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,a)),this.dashEntry[c]}getDashRanges(t,a,c){const f=[];let v=t.length%2==1?-t[t.length-1]*c:0,w=t[0]*c,E=!0;f.push({left:v,right:w,isDash:E,zeroLength:t[0]===0});let P=t[0];for(let R=1;R<t.length;R++){E=!E;const O=t[R];v=P*c,P+=O,w=P*c,f.push({left:v,right:w,isDash:E,zeroLength:O===0})}return f}addRoundDash(t,a,c){const f=a/2;for(let v=-c;v<=c;v++){const w=this.width*(this.nextRow+c+v);let E=0,P=t[E];for(let R=0;R<this.width;R++){R/P.right>1&&(P=t[++E]);const O=Math.abs(R-P.left),V=Math.abs(R-P.right),j=Math.min(O,V);let X;const Q=v/c*(f+1);if(P.isDash){const se=f-Math.abs(Q);X=Math.sqrt(j*j+se*se)}else X=f-Math.sqrt(j*j+Q*Q);this.data[w+R]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const P=t[E],R=t[E+1];P.zeroLength?t.splice(E,1):R&&R.isDash===P.isDash&&(R.left=P.left,t.splice(E,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const f=this.width*this.nextRow;let v=0,w=t[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++v]);const P=Math.abs(E-w.left),R=Math.abs(E-w.right),O=Math.min(P,R);this.data[f+E]=Math.max(0,Math.min(255,(w.isDash?O:-O)+128))}}addDash(t,a){const c=a?7:0,f=2*c+1;if(this.nextRow+f>this.height)return l.w("LineAtlas out of space"),null;let v=0;for(let E=0;E<t.length;E++)v+=t[E];if(v!==0){const E=this.width/v,P=this.getDashRanges(t,this.width,E);a?this.addRoundDash(P,E,c):this.addRegularDash(P)}const w={y:this.nextRow+c,height:2*c,width:v};return this.nextRow+=f,this.dirty=!0,w}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Mt="maplibre_preloaded_worker_pool";class Ft{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ft.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Mt]}numActive(){return Object.keys(this.active).length}}const Zt=Math.floor(be.hardwareConcurrency/2);let Vt,ln;function Qt(){return Vt||(Vt=new Ft),Vt}Ft.workerCount=l.K(globalThis)?Math.max(Math.min(Zt,3),1):1;class Dn{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let f=0;f<c.length;f++){const v=new l.L(c[f],a);v.name=`Worker ${f}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const c=[];for(const f of this.actors)c.push(f.sendAsync({type:t,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const c of this.actors)c.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function ai(){return ln||(ln=new Dn(Qt(),l.M),ln.registerMessageHandler("GR",((y,t,a)=>l.m(t,a)))),ln}function Rn(y,t){const a=l.N();return l.O(a,a,[1,1,0]),l.Q(a,a,[.5*y.width,.5*y.height,1]),y.calculatePosMatrix?l.S(a,a,y.calculatePosMatrix(t.toUnwrapped())):a}function lr(y,t,a,c,f,v,w){var E;const P=(function(j,X,Q){if(j)for(const se of j){const le=X[se];if(le&&le.source===Q&&le.type==="fill-extrusion")return!0}else for(const se in X){const le=X[se];if(le.source===Q&&le.type==="fill-extrusion")return!0}return!1})((E=f?.layers)!==null&&E!==void 0?E:null,t,y.id),R=v.maxPitchScaleFactor(),O=y.tilesIn(c,R,P);O.sort(Mn);const V=[];for(const j of O)V.push({wrappedTileID:j.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(t,a,y.getState(),j.queryGeometry,j.cameraQueryGeometry,j.scale,f,v,R,Rn(v,j.tileID),w?(X,Q)=>w(j.tileID,X,Q):void 0)});return(function(j,X){for(const Q in j)for(const se of j[Q])ci(se,X);return j})((function(j){const X={},Q={};for(const se of j){const le=se.queryResults,oe=se.wrappedTileID,he=Q[oe]=Q[oe]||{};for(const _e in le){const ce=le[_e],ye=he[_e]=he[_e]||{},Te=X[_e]=X[_e]||[];for(const pe of ce)ye[pe.featureIndex]||(ye[pe.featureIndex]=!0,Te.push(pe))}}return X})(V),y)}function Mn(y,t){const a=y.tileID,c=t.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function ci(y,t){const a=y.feature,c=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function Ri(y,t,a){return l._(this,void 0,void 0,(function*(){let c=y;if(y.url?c=(yield l.j(t.transformRequest(y.url,"Source"),a)).data:yield be.frameAsync(a),!c)return null;const f=l.U(l.e(c,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(f.vectorLayerIds=c.vector_layers.map((v=>v.id))),f}))}class Jn{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}extend(t){const a=this._sw,c=this._ne;let f,v;if(t instanceof l.V)f=t,v=t;else{if(!(t instanceof Jn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Jn.convert(t)):this.extend(l.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.V.convert(t)):this;if(f=t._sw,v=t._ne,!f||!v)return this}return a||c?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),c.lng=Math.max(v.lng,c.lng),c.lat=Math.max(v.lat,c.lat)):(this._sw=new l.V(f.lng,f.lat),this._ne=new l.V(v.lng,v.lat)),this}getCenter(){return new l.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.V(this.getWest(),this.getNorth())}getSouthEast(){return new l.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:c}=l.V.convert(t);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}intersects(t){if(!((t=Jn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),c=Math.abs(t.getEast()-t.getWest());if(a>=360||c>=360)return!0;const f=l.W(this.getWest(),-180,180),v=l.W(this.getEast(),-180,180),w=l.W(t.getWest(),-180,180),E=l.W(t.getEast(),-180,180),P=f>=v,R=w>=E;return!(!P||!R)||(P?E>=f||w<=v:R?v>=w||f<=E:w<=v&&E>=f)}static convert(t){return t instanceof Jn?t:t&&new Jn(t)}static fromLngLat(t,a=0){const c=360*a/40075017,f=c/Math.cos(Math.PI/180*t.lat);return new Jn(new l.V(t.lng-f,t.lat-c),new l.V(t.lng+f,t.lat+c))}adjustAntiMeridian(){const t=new l.V(this._sw.lng,this._sw.lat),a=new l.V(this._ne.lng,this._ne.lat);return new Jn(t,t.lng>a.lng?new l.V(a.lng+360,a.lat):a)}}class Wi{constructor(t,a,c){this.bounds=Jn.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),c=Math.floor(l.Y(this.bounds.getWest())*a),f=Math.floor(l.X(this.bounds.getNorth())*a),v=Math.ceil(l.Y(this.bounds.getEast())*a),w=Math.ceil(l.X(this.bounds.getSouth())*a);return t.x>=c&&t.x<v&&t.y>=f&&t.y<w}}class cr extends l.E{constructor(t,a,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=l.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Ri(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new Wi(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,l.Z(t)||this.fire(new l.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};c.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((v,w)=>{t.reloadPromise={resolve:v,reject:w}}))}else t.actor=this.dispatcher.getActor(),f="LT";t.abortController=new AbortController;try{const v=yield t.actor.sendAsync({type:f,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,v)}catch(v){if(delete t.abortController,t.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ur extends l.E{constructor(t,a,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},a),l.e(this,l.U(a,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ri(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new Wi(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield st.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const f=this.map.painter.context,v=f.gl,w=c.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new l.T(f,w,v.RGBA,{useMipmap:!0}),t.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Hr extends ur{constructor(t,a,c,f){super(t,a,c,f),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const f=yield st.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){const v=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const w=l.b(v)&&l.$()?v:yield this.readImageNow(v),E={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const P=yield t.actor.sendAsync({type:"LDT",data:E});t.dem=P,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}}))}readImageNow(t){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.a0()){const a=t.width+2,c=t.height+2;try{return new l.R({width:a,height:c},yield l.a1(t,-1,-1,a,c))}catch{}}return be.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,c=Math.pow(2,a.z),f=(a.x-1+c)%c,v=a.x===0?t.wrap-1:t.wrap,w=(a.x+1+c)%c,E=a.x+1===c?t.wrap+1:t.wrap,P={};return P[new l.a2(t.overscaledZ,v,a.z,f,a.y).key]={backfilled:!1},P[new l.a2(t.overscaledZ,E,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(P[new l.a2(t.overscaledZ,v,a.z,f,a.y-1).key]={backfilled:!1},P[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},P[new l.a2(t.overscaledZ,E,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<c&&(P[new l.a2(t.overscaledZ,v,a.z,f,a.y+1).key]={backfilled:!1},P[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},P[new l.a2(t.overscaledZ,E,a.z,w,a.y+1).key]={backfilled:!1}),P}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Ki(y){return y.type==="GeometryCollection"?y.geometries.map((t=>t.coordinates)).flat(1/0):y.coordinates.flat(1/0)}function $r(y){const t=new Jn;let a;switch(y.type){case"FeatureCollection":a=y.features.map((c=>Ki(c.geometry))).flat(1/0);break;case"Feature":a=Ki(y.geometry);break;default:a=Ki(y)}if(a.length==0)return t;for(let c=0;c<a.length-1;c+=2)t.extend([a[c],a[c+1]]);return t}class Li extends l.E{constructor(t,a,c,f){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(f),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:l.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(l.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const c=this._updateWorkerData();return a?c:this}updateData(t,a){this._pendingWorkerUpdate.diff=l.a6(this._pendingWorkerUpdate.diff,t);const c=this._updateWorkerData();return a?c:this}getData(){return l._(this,void 0,void 0,(function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return l._(this,void 0,void 0,(function*(){return $r(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:c}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void l.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,c=l.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(c.request=this.map._requestManager.transformRequest(be.resolveURL(t),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=t,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));f.data&&(this._data={geojson:f.data});const v=this._applyDiffToSource(a),w=this._getShouldReloadTileOptions(v);let E=null;f.resourceTiming&&f.resourceTiming[this.id]&&(E=f.resourceTiming[this.id].slice(0));const P={dataType:"source"};this._collectResourceTiming&&E&&E.length>0&&l.e(P,{resourceTiming:E}),this.fire(new l.l("data",Object.assign(Object.assign({},P),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},P),{sourceDataType:"content",shouldReloadTileOptions:w})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const f=l.a7(this._data.geojson,a);if(!f)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:f}}if(!this._data.updateable)return;const c=l.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:c}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>$r(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:c,extent:f}=this.workerOptions.geojsonVtOptions,v=(function({x:w,y:E,z:P},R=0){const O=l.a3((w-R)/Math.pow(2,P)),V=l.a4((E+1+R)/Math.pow(2,P)),j=l.a3((w+1+R)/Math.pow(2,P)),X=l.a4((E-R)/Math.pow(2,P));return new Jn([O,V],[j,X])})(t.tileID.canonical,c/f);for(const w of a)if(v.intersects(w))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const f=yield this.actor.sendAsync({type:a,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(f,this.map.painter,a==="RT")}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class nr extends l.E{constructor(t,a,c,f){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}load(t){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield st.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(l.a9.fromLngLat);var c;return this.tileID=(function(f){const v=l.aa.fromPoints(f),w=v.width(),E=v.height(),P=Math.max(w,E),R=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),O=Math.pow(2,R);return new l.ac(R,Math.floor((v.minX+v.maxX)/2*O),Math.floor((v.minY+v.maxY)/2*O))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new l.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:c,maxX:f,maxY:v}=l.aa.fromPoints(t),w={};for(let E=0;E<=l.ab;E++){const P=Math.pow(2,E),R=Math.floor(a*P),O=Math.floor(c*P),V=Math.floor(f*P),j=Math.floor(v*P);w[E]={minTileX:R,minTileY:O,maxTileX:V,maxTileY:j}}return w}}class Be extends nr{constructor(t,a,c,f){super(t,a,c,f),this.roundZoom=!0,this.type="video",this.options=a}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield l.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new l.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new l.k(new l.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Z extends nr{constructor(t,a,c,f){super(t,a,c,f),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((v=>!Array.isArray(v)||v.length!==2||v.some((w=>typeof w!="number"))))||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.k(new l.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,c=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new l.T(a,this.canvas,c.RGBA,{premultiply:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,f=!0)}f&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const $={},K=y=>{switch(y){case"geojson":return Li;case"image":return nr;case"raster":return ur;case"raster-dem":return Hr;case"vector":return cr;case"video":return Be;case"canvas":return Z}return $[y]},ue="RTLPluginLoaded";class ge extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ai()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=be.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(ue))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Re=null;function ze(){return Re||(Re=new ge),Re}var Se,De;(function(y){y[y.Base=0]="Base",y[y.Parent=1]="Parent"})(Se||(Se={})),(function(y){y[y.Departing=0]="Departing",y[y.Incoming=1]="Incoming"})(De||(De={}));class Je{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=l.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:c,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=f}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=fe(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(f,v){const w={};if(!v)return w;for(const E of f){const P=E.layerIds.map((R=>v.getLayer(R))).filter(Boolean);if(P.length!==0){E.layers=P,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map((R=>P.filter((O=>O.id===R))[0])));for(const R of P)w[R.id]=E}}return w})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const v=this.buckets[f];if(v instanceof l.ah){if(this.hasSymbolBuckets=!0,!c)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const v=this.buckets[f];if(v instanceof l.ah&&v.hasRTLText){this.hasRTLText=!0,ze().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const v=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(v))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new l.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,c,f,v,w,E,P,R,O,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:O,transform:P,params:E,queryPadding:this.queryPadding*R,getElevation:V},t,a,c):{}}querySourceFeatures(t,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),v=a&&a.sourceLayer?a.sourceLayer:"",w=f[l.ai]||f[v];if(!w)return;const E=l.aj(a?.filter,a?.globalState),{z:P,x:R,y:O}=this.tileID.canonical,V={z:P,x:R,y:O};for(let j=0;j<w.length;j++){const X=w.feature(j);if(E.needGeometry){const le=l.ak(X,!0);if(!E.filter(new l.H(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!E.filter(new l.H(this.tileID.overscaledZ),X))continue;const Q=c.getId(X,v),se=new l.al(X,P,R,O,Q);se.tile=V,t.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const c=l.am(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const v=this.expirationTime-a;v?this.expirationTime=c+Math.max(v,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const v=this.buckets[f],w=v.layers[0].sourceLayer||l.ai,E=c[w],P=t[w];if(!E||!P||Object.keys(P).length===0)continue;v.update(P,E,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const R=a&&a.style&&a.style.getLayer(f);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(v)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fe()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=fe()+t}setDependencies(t,a){const c={};for(const f of a)c[f]=!0;this.dependencies[t]=c}hasDependency(t,a){for(const c of t){const f=this.dependencies[c];if(f){for(const v of a)if(f[v])return!0}}return!1}}class at{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,c){const f=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},l.e(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==f&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const v in this.state[t][f])c[v]||(this.deletedStates[t][f][v]=null)}else for(const v in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][v]===null&&delete this.deletedStates[t][f][v]}removeFeatureState(t,a,c){if(this.deletedStates[t]===null)return;const f=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&a!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,a){const c=String(a),f=l.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const v=this.deletedStates[t][a];if(v===null)return{};for(const w in v)delete f[w]}return f}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const v={};for(const w in this.stateChanges[f])this.state[f][w]||(this.state[f][w]={}),l.e(this.state[f][w],this.stateChanges[f][w]),v[w]=this.state[f][w];c[f]=v}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const v={};if(this.deletedStates[f]===null)for(const w in this.state[f])v[w]={},this.state[f][w]={};else for(const w in this.deletedStates[f]){if(this.deletedStates[f][w]===null)this.state[f][w]={};else for(const E of Object.keys(this.deletedStates[f][w]))delete this.state[f][w][E];v[w]=this.state[f][w]}c[f]=c[f]||{},l.e(c[f],v)}this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0&&t.setFeatureState(c,a)}}const Rt=89.25;function It(y,t){const a=l.an(t.lat,-l.ao,l.ao);return new l.P(l.Y(t.lng)*y,l.X(a)*y)}function Ht(y,t){return new l.a9(t.x/y,t.y/y).toLngLat()}function yn(y){return y.cameraToCenterDistance*Math.min(.85*Math.tan(l.ap(90-y.pitch)),Math.tan(l.ap(Rt-y.pitch)))}function un(y,t){const a=y.canonical,c=t/l.aq(a.z),f=a.x+Math.pow(2,a.z)*y.wrap,v=l.ar(new Float64Array(16));return l.O(v,v,[f*c,a.y*c,0]),l.Q(v,v,[c/l.a5,c/l.a5,1]),v}function Oe(y,t,a,c,f){const v=l.a9.fromLngLat(y,t),w=f*l.as(1,y.lat),{x:E,y:P,z:R}=In(a,c);return new l.a9(v.x+w*-E,v.y+w*-P,v.z+w*-R)}function In(y,t){const a=l.ap(y),c=l.ap(t),f=Math.cos(-a),v=Math.sin(a);return{x:v*Math.sin(c),y:-v*Math.cos(c),z:f}}function ui(y,t,a){const c=t.intersectsFrustum(y);if(!a||c===0)return c;const f=t.intersectsPlane(a);return f===0?0:c===2&&f===2?2:1}function nn(y,t,a){let c=0;const f=(a-t)/10;for(let v=0;v<10;v++)c+=f*Math.pow(Math.cos(t+(v+.5)/10*(a-t)),y);return c}function kn(y,t){return function(a,c,f,v,w){const E=2*((y-1)/l.at(Math.cos(l.ap(Rt-w))/Math.cos(l.ap(Rt)))-1),P=Math.acos(f/v),R=2*nn(E-1,0,l.ap(w/2)),O=Math.min(l.ap(Rt),P+l.ap(w/2)),V=nn(E-1,Math.min(O,P-l.ap(w/2)),O),j=Math.atan(c/f),X=Math.hypot(c,f);let Q=a;return Q+=l.at(v/X/Math.max(.5,Math.cos(l.ap(w/2)))),Q+=E*l.at(Math.cos(j))/2,Q-=l.at(Math.max(1,V/R/t))/2,Q}}const Ui=kn(9.314,3);function Ln(y,t){const a=(t.roundZoom?Math.round:Math.floor)(y.zoom+l.at(y.tileSize/t.tileSize));return Math.max(0,a)}function hi(y,t){const a=y.getCameraFrustum(),c=y.getClippingPlane(),f=y.screenPointToMercatorCoordinate(y.getCameraPoint()),v=l.a9.fromLngLat(y.center,y.elevation);f.z=v.z+Math.cos(y.pitchInRadians)*y.cameraToCenterDistance/y.worldSize;const w=y.getCoveringTilesDetailsProvider(),E=w.allowVariableZoom(y,t),P=Ln(y,t),R=t.minzoom||0,O=t.maxzoom!==void 0?t.maxzoom:y.maxZoom,V=Math.min(Math.max(0,P),O),j=Math.pow(2,V),X=[j*f.x,j*f.y,0],Q=[j*v.x,j*v.y,0],se=Math.hypot(v.x-f.x,v.y-f.y),le=Math.abs(v.z-f.z),oe=Math.hypot(se,le),he=ye=>({zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),_e=[],ce=[];if(y.renderWorldCopies&&w.allowWorldCopies())for(let ye=1;ye<=3;ye++)_e.push(he(-ye)),_e.push(he(ye));for(_e.push(he(0));_e.length>0;){const ye=_e.pop(),Te=ye.x,pe=ye.y;let Ce=ye.fullyVisible;const Ge={x:Te,y:pe,z:ye.zoom},je=w.getTileBoundingVolume(Ge,ye.wrap,y.elevation,t);if(!Ce){const At=ui(a,je,c);if(At===0)continue;Ce=At===2}const Ve=w.distanceToTile2d(f.x,f.y,Ge,je);let qe=P;E&&(qe=(t.calculateTileZoom||Ui)(y.zoom+l.at(y.tileSize/t.tileSize),Ve,le,oe,y.fov)),qe=(t.roundZoom?Math.round:Math.floor)(qe),qe=Math.max(0,qe);const St=Math.min(qe,O);if(ye.wrap=w.getWrap(v,Ge,ye.wrap),ye.zoom>=St){if(ye.zoom<R)continue;const At=V-ye.zoom,ft=X[0]-.5-(Te<<At),Pt=X[1]-.5-(pe<<At),sn=t.reparseOverscaled?Math.max(ye.zoom,qe):ye.zoom;ce.push({tileID:new l.a2(ye.zoom===O?sn:ye.zoom,ye.wrap,ye.zoom,Te,pe),distanceSq:l.au([Q[0]-.5-Te,Q[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(ft*ft+Pt*Pt)})}else for(let At=0;At<4;At++)_e.push({zoom:ye.zoom+1,x:(Te<<1)+At%2,y:(pe<<1)+(At>>1),wrap:ye.wrap,fullyVisible:Ce})}return ce.sort(((ye,Te)=>ye.distanceSq-Te.distanceSq)).map((ye=>ye.tileID))}const On=l.aa.fromPoints([new l.P(0,0),new l.P(l.a5,l.a5)]);function Ti(y){return y==="raster"||y==="image"||y==="video"}function Us(y,t,a,c,f,v,w){if(!t.hasData())return!1;const{tileID:E,fadingRole:P,fadingDirection:R,fadingParentID:O}=t;if(P===Se.Base&&R===De.Incoming&&O)return a[O.key]=O,!0;const V=Math.max(E.overscaledZ-f,v);for(let j=E.overscaledZ-1;j>=V;j--){const X=E.scaledTo(j),Q=y.getLoadedTile(X);if(Q)return t.setCrossFadeLogic({fadingRole:Se.Base,fadingDirection:De.Incoming,fadingParentID:Q.tileID,fadeEndTime:c+w}),Q.setCrossFadeLogic({fadingRole:Se.Parent,fadingDirection:De.Departing,fadeEndTime:c+w}),a[X.key]=X,!0}return!1}function Vs(y,t,a,c,f,v){if(!t.hasData())return!1;const w=t.tileID.children(f);let E=bt(y,t,w,a,c,f,v);if(E)return!0;for(const P of w)bt(y,t,P.children(f),a,c,f,v)&&(E=!0);return E}function bt(y,t,a,c,f,v,w){if(a[0].overscaledZ>=v)return!1;let E=!1;for(const P of a){const R=y.getLoadedTile(P);if(!R)continue;const{fadingRole:O,fadingDirection:V,fadingParentID:j}=R;O===Se.Base&&V===De.Departing&&j||(R.setCrossFadeLogic({fadingRole:Se.Base,fadingDirection:De.Departing,fadingParentID:t.tileID,fadeEndTime:f+w}),t.setCrossFadeLogic({fadingRole:Se.Parent,fadingDirection:De.Incoming,fadeEndTime:f+w})),c[P.key]=P,E=!0}return E}function hr(y,t,a,c){const f=y.tileID;return!!y.selfFading||!y.hasData()&&!!t.has(f)&&(y.setSelfFadeLogic(a+c),!0)}function dr(y,t){var a;y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let c=t.tileID.canonical.x-y.tileID.canonical.x;const f=t.tileID.canonical.y-y.tileID.canonical.y,v=Math.pow(2,y.tileID.canonical.z),w=t.tileID.key;c===0&&f===0||Math.abs(f)>1||(Math.abs(c)>1&&(Math.abs(c+v)===1?c+=v:Math.abs(c-v)===1&&(c-=v)),t.dem&&y.dem&&(y.dem.backfillBorder(t.dem,c,f),!((a=y.neighboringTiles)===null||a===void 0)&&a[w]&&(y.neighboringTiles[w].backfilled=!0)))}class Qe{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+t),a[f.tileID.key]=f}this._tiles=a}setFeatureState(t,a){for(const c in this._tiles)this._tiles[c].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(l.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var c;return(c=this.getTileById(t))===null||c===void 0?void 0:c.isRenderable(a)}getRenderableIds(t=0,a){const c=[];for(const f of this.getAllIds())this.isIdRenderable(f,a)&&c.push(this.getTileById(f));return a?c.sort(((f,v)=>{const w=f.tileID,E=v.tileID,P=new l.P(w.canonical.x,w.canonical.y)._rotate(-t),R=new l.P(E.canonical.x,E.canonical.y)._rotate(-t);return w.overscaledZ-E.overscaledZ||R.y-P.y||R.x-P.x})).map((f=>f.tileID.key)):c.map((f=>f.tileID)).sort(l.aw).map((f=>f.key))}}class _t extends l.E{constructor(t,a,c){super(),this.id=t,this.dispatcher=c,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,v,w,E)=>{const P=new(K(v.type))(f,v,w,E);if(P.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${P.id}`);return P})(t,a,c,this),this._inViewTiles=new Qe,this._outOfViewCache=new l.ax(0,(f=>this._unloadTile(f))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new at,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Qe}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,c){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,c)}catch(f){t.state="errored",f.status!==404?this._source.fire(new l.k(f,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const c=this.getLoadedTile(t.scaledTo(a));if(c)return this._inViewTiles.isIdRenderable(c.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const c of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(c);a&&!this._source.shouldReloadTile(f,a)||(t?this._reloadTile(c,"expired"):f.state!=="errored"&&this._reloadTile(c,"reloading"))}}}_reloadTile(t,a){return l._(this,void 0,void 0,(function*(){const c=this._inViewTiles.getTileById(t);c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,t,a))}))}_tileLoaded(t,a,c){t.timeAdded=fe(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(f,v){var w,E;const P=v.getRenderableIds();for(const R of P){if(!f.neighboringTiles||!f.neighboringTiles[R])continue;const O=v.getTileById(R);f.neighboringTiles[R].backfilled||dr(f,O),!((E=(w=O.neighboringTiles)===null||w===void 0?void 0:w[f.tileID.key])===null||E===void 0)&&E.backfilled||dr(O,f)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const c=this._getLoadedDescendents(a),f=new Set;for(const v of a){const w=c[v.key];if(!w?.length){f.add(v);continue}const E=v.overscaledZ+_t.maxOverzooming,P=w.filter((V=>V.tileID.overscaledZ<=E));if(!P.length){f.add(v);continue}const R=Math.min(...P.map((V=>V.tileID.overscaledZ))),O=P.filter((V=>V.tileID.overscaledZ===R)).map((V=>V.tileID));for(const V of O)t[V.key]=V;this._areDescendentsComplete(O,R,v.overscaledZ)||f.add(v)}return f}_getLoadedDescendents(t){var a;const c={};for(const f of this._inViewTiles.getAllTiles().filter((v=>v.hasData())))for(const v of t)f.tileID.isChildOf(v)&&(c[a=v.key]||(c[a]=[])).push(f);return c}_areDescendentsComplete(t,a,c){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-c)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._outOfViewCache.setMaxSize(v)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((P=>new l.a2(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y))):(c=hi(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((P=>this._source.hasTile(P))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const f=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const v=Ln(t,this._source),w=this._updateRetainedTiles(c,v),E=Ti(this._source.type);E&&this._rasterFadeDuration>0&&!a&&(function(P,R,O,V,j,X,Q){const se=fe(),le=l.av(R);for(const oe of R){const he=P.getTileById(oe.key);he.fadingDirection!==De.Departing&&he.fadeOpacity!==0||he.resetFadeLogic(),Us(P,he,O,se,V,j,Q)||Vs(P,he,O,se,X,Q)||hr(he,le,se,Q)||he.resetFadeLogic()}})(this._inViewTiles,c,w,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),E?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);t[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const c of t)if(c.canonical.z>this._source.minzoom){const f=c.scaledTo(c.canonical.z-1);a.push(f);const v=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(v)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var c;const f=new Set;for(const R of t)this._addTile(R).hasData()||f.add(R);const v=t.reduce(((R,O)=>(R[O.key]=O,R)),{}),w=this._retainLoadedChildren(v,f),E={},P=Math.max(a-_t.maxUnderzooming,this._source.minzoom);for(const R of w){let O=this._inViewTiles.getTileById(R.key),V=O?.wasRequested();for(let j=R.overscaledZ-1;j>=P;--j){const X=R.scaledTo(j);if(E[X.key])break;if(E[X.key]=!0,O=this.getTile(X),!O&&V&&(O=this._addTile(X)),O){const Q=O.hasData();if((Q||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||V)&&(v[X.key]=X),V=O.wasRequested(),Q)break}}}return v}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const c=a;return a||(a=new Je(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),c||this._source.fire(new l.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const c=a.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||c.state=="errored")&&t.some((f=>f.equals(c.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,c){const f=[],v=this.transform;if(!v)return f;const w=v.getCoveringTilesDetailsProvider().allowWorldCopies(),E=c?v.getCameraQueryGeometry(t):t,P=X=>v.screenPointToMercatorCoordinate(X,this.terrain),R=this.transformBbox(t,P,!w),O=this.transformBbox(E,P,!w),V=this.getIds(),j=l.aa.fromPoints(O);for(let X=0;X<V.length;X++){const Q=this._inViewTiles.getTileById(V[X]);if(Q.holdingForSymbolFade())continue;const se=w?[Q.tileID]:[Q.tileID.unwrapTo(-1),Q.tileID.unwrapTo(0)],le=Math.pow(2,v.zoom-Q.tileID.overscaledZ),oe=a*Q.queryPadding*l.a5/Q.tileSize/le;for(const he of se){const _e=j.map((ce=>he.getTilePoint(new l.a9(ce.x,ce.y))));if(_e.expandBy(oe),_e.intersects(On)){const ce=R.map((Te=>he.getTilePoint(Te))),ye=O.map((Te=>he.getTilePoint(Te)));f.push({tile:Q,tileID:w?he:he.unwrapTo(0),queryGeometry:ce,cameraQueryGeometry:ye,scale:le})}}}return f}transformBbox(t,a,c){let f=t.map(a);if(c){const v=l.aa.fromPoints(t);v.shrinkBy(.001*Math.min(v.width(),v.height()));const w=v.map(a);l.aa.fromPoints(f).covers(w)||(f=f.map((E=>E.x>.5?new l.a9(E.x-1,E.y,E.z):E)))}return f}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((c=>this._inViewTiles.getTileById(c).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!Ti(this._source.type)||!(function(t,a){if(a<=0)return!1;const c=fe();for(const f of t.getAllTiles())if(f.fadeEndTime>=c)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,c){this._state.updateState(t=t||l.ai,a,c)}removeFeatureState(t,a,c){this._state.removeFeatureState(t=t||l.ai,a,c)}getFeatureState(t,a){return this._state.getState(t=t||l.ai,a)}setDependencies(t,a,c){const f=this._inViewTiles.getTileById(t);f&&f.setDependencies(a,c)}reloadTilesForDependencies(t,a){for(const c of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(c).hasDependency(t,a)&&this._reloadTile(c,"reloading");this._outOfViewCache.filter((c=>!c.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}_t.maxUnderzooming=10,_t.maxOverzooming=3;class Fe{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.an(t,0,1);let a=1,c=this._distances[a];const f=t*this.paddedLength+this.padding;for(;c<f&&a<this._distances.length;)c=this._distances[++a];const v=a-1,w=this._distances[v],E=c-w,P=E>0?(f-w)/E:0;return this.points[v].mult(1-P).add(this.points[a].mult(P))}}function Tt(y,t){let a=!0;return y==="always"||y!=="never"&&t!=="never"||(a=!1),a}class kt{constructor(t,a,c){const f=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(a/c);for(let w=0;w<this.xCellCount*this.yCellCount;w++)f.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,c,f,v){this._forEachCell(a,c,f,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v)}insertCircle(t,a,c,f){this._forEachCell(a-f,c-f,a+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,a,c,f,v,w){this.boxCells[v].push(w)}_insertCircleCell(t,a,c,f,v,w){this.circleCells[v].push(w)}_query(t,a,c,f,v,w,E){if(c<0||t>this.width||f<0||a>this.height)return[];const P=[];if(t<=0&&a<=0&&this.width<=c&&this.height<=f){if(v)return[{key:null,x1:t,y1:a,x2:c,y2:f}];for(let R=0;R<this.boxKeys.length;R++)P.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],V=this.circles[3*R+1],j=this.circles[3*R+2];P.push({key:this.circleKeys[R],x1:O-j,y1:V-j,x2:O+j,y2:V+j})}}else this._forEachCell(t,a,c,f,this._queryCell,P,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},E);return P}query(t,a,c,f){return this._query(t,a,c,f,!1,null)}hitTest(t,a,c,f,v,w){return this._query(t,a,c,f,!0,v,w).length>0}hitTestCircle(t,a,c,f,v){const w=t-c,E=t+c,P=a-c,R=a+c;if(E<0||w>this.width||R<0||P>this.height)return!1;const O=[];return this._forEachCell(w,P,E,R,this._queryCellCircle,O,{hitTest:!0,overlapMode:f,circle:{x:t,y:a,radius:c},seenUids:{box:{},circle:{}}},v),O.length>0}_queryCell(t,a,c,f,v,w,E,P){const{seenUids:R,hitTest:O,overlapMode:V}=E,j=this.boxCells[v];if(j!==null){const Q=this.bboxes;for(const se of j)if(!R.box[se]){R.box[se]=!0;const le=4*se,oe=this.boxKeys[se];if(t<=Q[le+2]&&a<=Q[le+3]&&c>=Q[le+0]&&f>=Q[le+1]&&(!P||P(oe))&&(!O||!Tt(V,oe.overlapMode))&&(w.push({key:oe,x1:Q[le],y1:Q[le+1],x2:Q[le+2],y2:Q[le+3]}),O))return!0}}const X=this.circleCells[v];if(X!==null){const Q=this.circles;for(const se of X)if(!R.circle[se]){R.circle[se]=!0;const le=3*se,oe=this.circleKeys[se];if(this._circleAndRectCollide(Q[le],Q[le+1],Q[le+2],t,a,c,f)&&(!P||P(oe))&&(!O||!Tt(V,oe.overlapMode))){const he=Q[le],_e=Q[le+1],ce=Q[le+2];if(w.push({key:oe,x1:he-ce,y1:_e-ce,x2:he+ce,y2:_e+ce}),O)return!0}}}return!1}_queryCellCircle(t,a,c,f,v,w,E,P){const{circle:R,seenUids:O,overlapMode:V}=E,j=this.boxCells[v];if(j!==null){const Q=this.bboxes;for(const se of j)if(!O.box[se]){O.box[se]=!0;const le=4*se,oe=this.boxKeys[se];if(this._circleAndRectCollide(R.x,R.y,R.radius,Q[le+0],Q[le+1],Q[le+2],Q[le+3])&&(!P||P(oe))&&!Tt(V,oe.overlapMode))return w.push(!0),!0}}const X=this.circleCells[v];if(X!==null){const Q=this.circles;for(const se of X)if(!O.circle[se]){O.circle[se]=!0;const le=3*se,oe=this.circleKeys[se];if(this._circlesCollide(Q[le],Q[le+1],Q[le+2],R.x,R.y,R.radius)&&(!P||P(oe))&&!Tt(V,oe.overlapMode))return w.push(!0),!0}}}_forEachCell(t,a,c,f,v,w,E,P){const R=this._convertToXCellCoord(t),O=this._convertToYCellCoord(a),V=this._convertToXCellCoord(c),j=this._convertToYCellCoord(f);for(let X=R;X<=V;X++)for(let Q=O;Q<=j;Q++)if(v.call(this,t,a,c,f,this.xCellCount*Q+X,w,E,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,c,f,v,w){const E=f-t,P=v-a,R=c+w;return R*R>E*E+P*P}_circleAndRectCollide(t,a,c,f,v,w,E){const P=(w-f)/2,R=Math.abs(t-(f+P));if(R>P+c)return!1;const O=(E-v)/2,V=Math.abs(a-(v+O));if(V>O+c)return!1;if(R<=P||V<=O)return!0;const j=R-P,X=V-O;return j*j+X*X<=c*c}}function ni(y,t,a){const c=l.N();if(!y){const{vecSouth:V,vecEast:j}=Xr(t),X=W();X[0]=j[0],X[1]=j[1],X[2]=V[0],X[3]=V[1],f=X,(O=(w=(v=X)[0])*(R=v[3])-(P=v[2])*(E=v[1]))&&(f[0]=R*(O=1/O),f[1]=-E*O,f[2]=-P*O,f[3]=w*O),c[0]=X[0],c[1]=X[1],c[4]=X[2],c[5]=X[3]}var f,v,w,E,P,R,O;return l.Q(c,c,[1/a,1/a,1]),c}function Vi(y,t,a,c){if(y){const f=l.N();if(!t){const{vecSouth:v,vecEast:w}=Xr(a);f[0]=w[0],f[1]=w[1],f[4]=v[0],f[5]=v[1]}return l.Q(f,f,[c,c,1]),f}return a.pixelsToClipSpaceMatrix}function Xr(y){const t=Math.cos(y.rollInRadians),a=Math.sin(y.rollInRadians),c=Math.cos(y.pitchInRadians),f=Math.cos(y.bearingInRadians),v=Math.sin(y.bearingInRadians),w=l.aC();w[0]=-f*c*a-v*t,w[1]=-v*c*a+f*t;const E=l.aD(w);E<1e-9?l.aE(w):l.aF(w,w,1/E);const P=l.aC();P[0]=f*c*t-v*a,P[1]=v*c*t+f*a;const R=l.aD(P);return R<1e-9?l.aE(P):l.aF(P,P,1/R),{vecEast:P,vecSouth:w}}function en(y,t,a,c){let f;c?(f=[y,t,c(y,t),1],l.aH(f,f,a)):(f=[y,t,0,1],Ma(f,f,a));const v=f[3];return{point:new l.P(f[0]/v,f[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function $o(y,t){return .5+y/t*.5}function ds(y,t){return y.x>=-t[0]&&y.x<=t[0]&&y.y>=-t[1]&&y.y<=t[1]}function qs(y,t,a,c,f,v,w,E,P,R,O,V,j){const X=a?y.textSizeData:y.iconSizeData,Q=l.ay(X,t.transform.zoom),se=[256/t.width*2+1,256/t.height*2+1],le=a?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;le.clear();const oe=y.lineVertexArray,he=a?y.text.placedSymbolArray:y.icon.placedSymbolArray,_e=t.transform.width/t.transform.height;let ce=!1;for(let ye=0;ye<he.length;ye++){const Te=he.get(ye);if(Te.hidden||Te.writingMode===l.az.vertical&&!ce){ms(Te.numGlyphs,le);continue}ce=!1;const pe=new l.P(Te.anchorX,Te.anchorY),Ce={getElevation:j,pitchedLabelPlaneMatrix:c,lineVertexArray:oe,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:pe,unwrappedTileID:P,width:R,height:O,translation:V},Ge=jl(Te.anchorX,Te.anchorY,Ce);if(!ds(Ge.point,se)){ms(Te.numGlyphs,le);continue}const je=$o(t.transform.cameraToCenterDistance,Ge.signedDistanceFromCamera),Ve=l.aA(X,Q,Te),qe=v?Ve*t.transform.getPitchedTextCorrection(Te.anchorX,Te.anchorY,P)/je:Ve*je,St=Si({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:f,symbol:Te,fontSize:qe,flip:!1,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:_e,rotateToLine:E});ce=St.useVertical,(St.notEnoughRoom||ce||St.needsFlipping&&Si({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:f,symbol:Te,fontSize:qe,flip:!0,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:_e,rotateToLine:E}).notEnoughRoom)&&ms(Te.numGlyphs,le)}a?y.text.dynamicLayoutVertexBuffer.updateData(le):y.icon.dynamicLayoutVertexBuffer.updateData(le)}function fs(y,t,a,c,f,v,w,E){const P=v.glyphStartIndex+v.numGlyphs,R=v.lineStartIndex,O=v.lineStartIndex+v.lineLength,V=t.getoffsetX(v.glyphStartIndex),j=t.getoffsetX(P-1),X=Xa(y*V,a,c,f,v.segment,R,O,E,w);if(!X)return null;const Q=Xa(y*j,a,c,f,v.segment,R,O,E,w);return Q?E.projectionCache.anyProjectionOccluded?null:{first:X,last:Q}:null}function ps(y,t,a,c){return y===l.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*c?{useVertical:!0}:(y===l.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Si(y){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:f,flip:v,keepUpright:w,glyphOffsetArray:E,dynamicLayoutVertexArray:P,aspectRatio:R,rotateToLine:O}=y,V=f/24,j=c.lineOffsetX*V,X=c.lineOffsetY*V;let Q;if(c.numGlyphs>1){const se=c.glyphStartIndex+c.numGlyphs,le=c.lineStartIndex,oe=c.lineStartIndex+c.lineLength,he=fs(V,E,j,X,v,c,O,t);if(!he)return{notEnoughRoom:!0};const _e=Gs(he.first.point.x,he.first.point.y,t,a),ce=Gs(he.last.point.x,he.last.point.y,t,a);if(w&&!v){const ye=ps(c.writingMode,_e,ce,R);if(ye)return ye}Q=[he.first];for(let ye=c.glyphStartIndex+1;ye<se-1;ye++){const Te=Xa(V*E.getoffsetX(ye),j,X,v,c.segment,le,oe,t,O);if(!Te)return{notEnoughRoom:!0};Q.push(Te)}Q.push(he.last)}else{if(w&&!v){const le=xn(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,oe=c.lineStartIndex+c.segment+1,he=new l.P(t.lineVertexArray.getx(oe),t.lineVertexArray.gety(oe)),_e=xn(he.x,he.y,t),ce=_e.signedDistanceFromCamera>0?_e.point:Fl(t.tileAnchorPoint,he,le,1,t),ye=Gs(le.x,le.y,t,a),Te=Gs(ce.x,ce.y,t,a),pe=ps(c.writingMode,ye,Te,R);if(pe)return pe}const se=Xa(V*E.getoffsetX(c.glyphStartIndex),j,X,v,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,O);if(!se||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Q=[se]}for(const se of Q)l.aG(P,se.point,se.angle);return{}}function Fl(y,t,a,c,f){const v=y.add(y.sub(t)._unit()),w=xn(v.x,v.y,f).point,E=a.sub(w);return a.add(E._mult(c/E.mag()))}function Pr(y,t,a){const c=t.projectionCache;if(c.projections[y])return c.projections[y];const f=new l.P(t.lineVertexArray.getx(y),t.lineVertexArray.gety(y)),v=xn(f.x,f.y,t);if(v.signedDistanceFromCamera>0)return c.projections[y]=v.point,c.anyProjectionOccluded=c.anyProjectionOccluded||v.isOccluded,v.point;const w=y-a.direction;return Fl(a.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(w),t.lineVertexArray.gety(w)),f,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function xn(y,t,a){const c=y+a.translation[0],f=t+a.translation[1];let v;return a.pitchWithMap?(v=en(c,f,a.pitchedLabelPlaneMatrix,a.getElevation),v.isOccluded=!1):(v=a.transform.projectTileCoordinates(c,f,a.unwrappedTileID,a.getElevation),v.point.x=(.5*v.point.x+.5)*a.width,v.point.y=(.5*-v.point.y+.5)*a.height),v}function Gs(y,t,a,c){if(a.pitchWithMap){const f=[y,t,0,1];return l.aH(f,f,c),a.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],a.unwrappedTileID,a.getElevation).point}return{x:y/a.width*2-1,y:1-t/a.height*2}}function jl(y,t,a){return a.transform.projectTileCoordinates(y,t,a.unwrappedTileID,a.getElevation)}function Ul(y,t,a){return y._unit()._perp()._mult(t*a)}function po(y,t,a,c,f,v,w,E,P){if(E.projectionCache.offsets[y])return E.projectionCache.offsets[y];const R=a.add(t);if(y+P.direction<c||y+P.direction>=f)return E.projectionCache.offsets[y]=R,R;const O=Pr(y+P.direction,E,P),V=Ul(O.sub(a),w,P.direction),j=a.add(V),X=O.add(V);return E.projectionCache.offsets[y]=l.aI(v,R,j,X)||R,E.projectionCache.offsets[y]}function Xa(y,t,a,c,f,v,w,E,P){const R=c?y-t:y+t;let O=R>0?1:-1,V=0;c&&(O*=-1,V=Math.PI),O<0&&(V+=Math.PI);let j,X=O>0?v+f:v+f+1;E.projectionCache.cachedAnchorPoint?j=E.projectionCache.cachedAnchorPoint:(j=xn(E.tileAnchorPoint.x,E.tileAnchorPoint.y,E).point,E.projectionCache.cachedAnchorPoint=j);let Q,se,le=j,oe=j,he=0,_e=0;const ce=Math.abs(R),ye=[];let Te;for(;he+_e<=ce;){if(X+=O,X<v||X>=w)return null;he+=_e,oe=le,se=Q;const Ge={absOffsetX:ce,direction:O,distanceFromAnchor:he,previousVertex:oe};if(le=Pr(X,E,Ge),a===0)ye.push(oe),Te=le.sub(oe);else{let je;const Ve=le.sub(oe);je=Ve.mag()===0?Ul(Pr(X+O,E,Ge).sub(le),a,O):Ul(Ve,a,O),se||(se=oe.add(je)),Q=po(X,je,le,v,w,se,a,E,Ge),ye.push(se),Te=Q.sub(se)}_e=Te.mag()}const pe=Te._mult((ce-he)/_e)._add(se||oe),Ce=V+Math.atan2(le.y-oe.y,le.x-oe.x);return ye.push(pe),{point:pe,angle:P?Ce:0,path:ye}}const Rc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ms(y,t){for(let a=0;a<y;a++){const c=t.length;t.resize(c+4),t.float32.set(Rc,3*c)}}function Ma(y,t,a){const c=t[0],f=t[1];return y[0]=a[0]*c+a[4]*f+a[12],y[1]=a[1]*c+a[5]*f+a[13],y[3]=a[3]*c+a[7]*f+a[15],y}const An=100;class Wh{constructor(t,a=new kt(t.width+200,t.height+200,25),c=new kt(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+An,this.screenBottomBoundary=t.height+An,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,c,f,v,w,E,P,R,O,V,j){const X=this.projectAndGetPerspectiveRatio(t.anchorPointX+P[0],t.anchorPointY+P[1],v,O,j),Q=c*X.perspectiveRatio;let se;if(w||E)se=this._projectCollisionBox(t,Q,f,v,w,E,P,X,O,V,j);else{const Te=X.x+(V?V.x*Q:0),pe=X.y+(V?V.y*Q:0);se={allPointsOccluded:!1,box:[Te+t.x1*Q,pe+t.y1*Q,Te+t.x2*Q,pe+t.y2*Q]}}const[le,oe,he,_e]=se.box,ce=w?se.allPointsOccluded:X.isOccluded;let ye=ce;return ye||(ye=X.perspectiveRatio<this.perspectiveRatioCutoff),ye||(ye=!this.isInsideGrid(le,oe,he,_e)),ye||a!=="always"&&this.grid.hitTest(le,oe,he,_e,a,R)?{box:[le,oe,he,_e],placeable:!1,offscreen:!1,occluded:ce}:{box:[le,oe,he,_e],placeable:!0,offscreen:this.isOffscreen(le,oe,he,_e),occluded:ce}}placeCollisionCircles(t,a,c,f,v,w,E,P,R,O,V,j,X,Q){const se=[],le=new l.P(a.anchorX,a.anchorY),oe=this.getPerspectiveRatio(le.x,le.y,w,Q),he=(R?v*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,w)/oe:v*oe)/l.aM,_e={getElevation:Q,pitchedLabelPlaneMatrix:E,lineVertexArray:c,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:le,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:X},ce=fs(he,f,a.lineOffsetX*he,a.lineOffsetY*he,!1,a,!1,_e);let ye=!1,Te=!1,pe=!0;if(ce){const Ce=.5*V*oe+j,Ge=new l.P(-100,-100),je=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Ve=new Fe,qe=ce.first,St=ce.last;let At=[];for(let sn=qe.path.length-1;sn>=1;sn--)At.push(qe.path[sn]);for(let sn=1;sn<St.path.length;sn++)At.push(St.path[sn]);const ft=2.5*Ce;if(R){const sn=this.projectPathToScreenSpace(At,_e);At=sn.some((Nn=>Nn.signedDistanceFromCamera<=0))?[]:sn.map((Nn=>Nn.point))}let Pt=[];if(At.length>0){const sn=At[0].clone(),Nn=At[0].clone();for(let ei=1;ei<At.length;ei++)sn.x=Math.min(sn.x,At[ei].x),sn.y=Math.min(sn.y,At[ei].y),Nn.x=Math.max(Nn.x,At[ei].x),Nn.y=Math.max(Nn.y,At[ei].y);Pt=sn.x>=Ge.x&&Nn.x<=je.x&&sn.y>=Ge.y&&Nn.y<=je.y?[At]:Nn.x<Ge.x||sn.x>je.x||Nn.y<Ge.y||sn.y>je.y?[]:l.aJ([At],Ge.x,Ge.y,je.x,je.y)}for(const sn of Pt){Ve.reset(sn,.25*Ce);let Nn=0;Nn=Ve.length<=.5*Ce?1:Math.ceil(Ve.paddedLength/ft)+1;for(let ei=0;ei<Nn;ei++){const Yn=ei/Math.max(Nn-1,1),oi=Ve.lerp(Yn),qn=oi.x+An,bi=oi.y+An;se.push(qn,bi,Ce,0);const li=qn-Ce,mr=bi-Ce,Ci=qn+Ce,zi=bi+Ce;if(pe=pe&&this.isOffscreen(li,mr,Ci,zi),Te=Te||this.isInsideGrid(li,mr,Ci,zi),t!=="always"&&this.grid.hitTestCircle(qn,bi,Ce,t,O)&&(ye=!0,!P))return{circles:[],offscreen:!1,collisionDetected:ye}}}}return{circles:!P&&ye||!Te||oe<this.perspectiveRatioCutoff?[]:se,offscreen:pe,collisionDetected:ye}}projectPathToScreenSpace(t,a){const c=(function(f,v){const w=l.N();return l.aB(w,v.pitchedLabelPlaneMatrix),f.map((E=>{const P=en(E.x,E.y,w,v.getElevation),R=v.transform.projectTileCoordinates(P.point.x,P.point.y,v.unwrappedTileID,v.getElevation);return R.point.x=(.5*R.point.x+.5)*v.width,R.point.y=(.5*-R.point.y+.5)*v.height,R}))})(t,a);return(function(f){let v=0,w=0,E=0,P=0;for(let R=0;R<f.length;R++)f[R].isOccluded?(E=R+1,P=0):(P++,P>w&&(w=P,v=E));return f.slice(v,v+w)})(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],c=new l.aa;for(const V of t){const j=new l.P(V.x+An,V.y+An);c.extend(j),a.push(j)}const{minX:f,minY:v,maxX:w,maxY:E}=c,P=this.grid.query(f,v,w,E).concat(this.ignoredGrid.query(f,v,w,E)),R={},O={};for(const V of P){const j=V.key;if(R[j.bucketInstanceId]===void 0&&(R[j.bucketInstanceId]={}),R[j.bucketInstanceId][j.featureIndex])continue;const X=[new l.P(V.x1,V.y1),new l.P(V.x2,V.y1),new l.P(V.x2,V.y2),new l.P(V.x1,V.y2)];l.aK(a,X)&&(R[j.bucketInstanceId][j.featureIndex]=!0,O[j.bucketInstanceId]===void 0&&(O[j.bucketInstanceId]=[]),O[j.bucketInstanceId].push(j.featureIndex))}return O}insertCollisionBox(t,a,c,f,v,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:v,collisionGroupID:w,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,c,f,v,w){const E=c?this.ignoredGrid:this.grid,P={bucketInstanceId:f,featureIndex:v,collisionGroupID:w,overlapMode:a};for(let R=0;R<t.length;R+=4)E.insertCircle(P,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,a,c,f,v){if(v){let w;f?(w=[t,a,f(t,a),1],l.aH(w,w,v)):(w=[t,a,0,1],Ma(w,w,v));const E=w[3];return{x:(w[0]/E+1)/2*this.transform.width+An,y:(-w[1]/E+1)/2*this.transform.height+An,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E*.5,isOccluded:!1,signedDistanceFromCamera:E}}{const w=this.transform.projectTileCoordinates(t,a,c,f);return{x:(w.point.x+1)/2*this.transform.width+An,y:(1-w.point.y)/2*this.transform.height+An,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,c,f){const v=this.transform.projectTileCoordinates(t,a,c,f);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(t,a,c,f){return c<An||t>=this.screenRightBoundary||f<An||a>this.screenBottomBoundary}isInsideGrid(t,a,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=l.ar([]);return l.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,c,f,v,w,E,P,R,O,V){let j=1,X=0,Q=0,se=1;const le=t.anchorPointX+E[0],oe=t.anchorPointY+E[1];if(w&&!v){const At=this.projectAndGetPerspectiveRatio(le+1,oe,f,R,V),ft=At.x-P.x,Pt=Math.atan((At.y-P.y)/ft)+(ft<0?Math.PI:0),sn=Math.sin(Pt),Nn=Math.cos(Pt);j=Nn,X=sn,Q=-sn,se=Nn}else if(!w&&v){const At=Xr(this.transform);j=At.vecEast[0],X=At.vecEast[1],Q=At.vecSouth[0],se=At.vecSouth[1]}let he=P.x,_e=P.y,ce=a;v&&(he=le,_e=oe,ce=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),ce*=this.transform.getPitchedTextCorrection(le,oe,f),O||(ce*=l.an(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),O&&(he+=j*O.x*ce+Q*O.y*ce,_e+=X*O.x*ce+se*O.y*ce);const ye=t.x1*ce,Te=t.x2*ce,pe=(ye+Te)/2,Ce=t.y1*ce,Ge=t.y2*ce,je=(Ce+Ge)/2,Ve=[{offsetX:ye,offsetY:Ce},{offsetX:pe,offsetY:Ce},{offsetX:Te,offsetY:Ce},{offsetX:Te,offsetY:je},{offsetX:Te,offsetY:Ge},{offsetX:pe,offsetY:Ge},{offsetX:ye,offsetY:Ge},{offsetX:ye,offsetY:je}];let qe=[];for(const{offsetX:At,offsetY:ft}of Ve)qe.push(new l.P(he+j*At+Q*ft,_e+X*At+se*ft));let St=!1;if(v){const At=qe.map((ft=>this.projectAndGetPerspectiveRatio(ft.x,ft.y,f,R,V)));St=At.some((ft=>!ft.isOccluded)),qe=At.map((ft=>new l.P(ft.x,ft.y)))}else St=!0;return{box:l.aL(qe),allPointsOccluded:!St}}}class _f{constructor(t,a,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Xo{constructor(t,a,c,f,v){this.text=new _f(t?t.text:null,a,c,v),this.icon=new _f(t?t.icon:null,a,f,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kh{constructor(t,a,c){this.text=t,this.icon=a,this.skipFade=c}}class Lc{constructor(t,a,c,f,v){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=v}}class vf{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[t]}}function Nr(y,t,a,c,f){const{horizontalAlign:v,verticalAlign:w}=l.aS(y);return new l.P(-(v-.5)*t+c[0]*f,-(w-.5)*a+c[1]*f)}class Oc{constructor(t,a,c,f,v){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Wh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new vf(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(c,f)=>a.getElevation(t,c,f):null}getBucketParts(t,a,c,f){const v=c.getBucket(a),w=c.latestFeatureIndex;if(!v||!w||a.id!==v.layerIds[0])return;const E=c.collisionBoxArray,P=v.layers[0].layout,R=v.layers[0].paint,O=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),V=c.tileSize/l.a5,j=c.tileID.toUnwrapped(),X=P.get("text-rotation-alignment")==="map",Q=l.aN(c,1,this.transform.zoom),se=l.aO(this.collisionIndex.transform,c,R.get("text-translate"),R.get("text-translate-anchor")),le=l.aO(this.collisionIndex.transform,c,R.get("icon-translate"),R.get("icon-translate-anchor")),oe=ni(X,this.transform,Q);this.retainedQueryData[v.bucketInstanceId]=new Lc(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,c.tileID);const he={bucket:v,layout:P,translationText:se,translationIcon:le,unwrappedTileID:j,pitchedLabelPlaneMatrix:oe,scale:O,textPixelRatio:V,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:l.ay(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(f)for(const _e of v.sortKeyRanges){const{sortKey:ce,symbolInstanceStart:ye,symbolInstanceEnd:Te}=_e;t.push({sortKey:ce,symbolInstanceStart:ye,symbolInstanceEnd:Te,parameters:he})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:he})}attemptAnchorPlacement(t,a,c,f,v,w,E,P,R,O,V,j,X,Q,se,le,oe,he,_e,ce){const ye=l.aP[t.textAnchor],Te=[t.textOffset0,t.textOffset1],pe=Nr(ye,c,f,Te,v),Ce=this.collisionIndex.placeCollisionBox(a,j,P,R,O,E,w,le,V.predicate,_e,pe,ce);if((!he||this.collisionIndex.placeCollisionBox(he,j,P,R,O,E,w,oe,V.predicate,_e,pe,ce).placeable)&&Ce.placeable){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:Te,width:c,height:f,anchor:ye,textBoxScale:v,prevAnchor:Ge},this.markUsedJustification(Q,ye,X,se),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,se,X),this.placedOrientations[X.crossTileID]=se),{shift:pe,placedGlyphBoxes:Ce}}}placeLayerBucketPart(t,a,c){const{bucket:f,layout:v,translationText:w,translationIcon:E,unwrappedTileID:P,pitchedLabelPlaneMatrix:R,textPixelRatio:O,holdingForFade:V,collisionBoxArray:j,partiallyEvaluatedTextSize:X,collisionGroup:Q}=t.parameters,se=v.get("text-optional"),le=v.get("icon-optional"),oe=l.aQ(v,"text-overlap","text-allow-overlap"),he=oe==="always",_e=l.aQ(v,"icon-overlap","icon-allow-overlap"),ce=_e==="always",ye=v.get("text-rotation-alignment")==="map",Te=v.get("text-pitch-alignment")==="map",pe=v.get("icon-text-fit")!=="none",Ce=v.get("symbol-z-order")==="viewport-y",Ge=he&&(ce||!f.hasIconData()||le),je=ce&&(he||!f.hasTextData()||se);!f.collisionArrays&&j&&f.deserializeCollisionBoxes(j);const Ve=this.retainedQueryData[f.bucketInstanceId].tileID,qe=this._getTerrainElevationFunc(Ve),St=this.transform.getFastPathSimpleProjectionMatrix(Ve),At=(ft,Pt,sn)=>{var Nn,ei;if(a[ft.crossTileID])return;if(V)return void(this.placements[ft.crossTileID]=new Kh(!1,!1,!1));let Yn=!1,oi=!1,qn=!0,bi=null,li={box:null,placeable:!1,offscreen:null,occluded:!1},mr={placeable:!1},Ci=null,zi=null,gr=null,Rs=0,Ls=0,is=0;Pt.textFeatureIndex?Rs=Pt.textFeatureIndex:ft.useRuntimeCollisionCircles&&(Rs=ft.featureIndex),Pt.verticalTextFeatureIndex&&(Ls=Pt.verticalTextFeatureIndex);const ea=Pt.textBox;if(ea){const ta=jn=>{let Wn=l.az.horizontal;if(f.allowVerticalPlacement&&!jn&&this.prevPlacement){const Zi=this.prevPlacement.placedOrientations[ft.crossTileID];Zi&&(this.placedOrientations[ft.crossTileID]=Zi,Wn=Zi,this.markUsedOrientation(f,Wn,ft))}return Wn},va=(jn,Wn)=>{if(f.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&Pt.verticalTextBox){for(const Zi of f.writingModes)if(Zi===l.az.vertical?(li=Wn(),mr=li):li=jn(),li&&li.placeable)break}else li=jn()},Ba=ft.textAnchorOffsetStartIndex,Na=ft.textAnchorOffsetEndIndex;if(Na===Ba){const jn=(Wn,Zi)=>{const Ji=this.collisionIndex.placeCollisionBox(Wn,oe,O,Ve,P,Te,ye,w,Q.predicate,qe,void 0,St);return Ji&&Ji.placeable&&(this.markUsedOrientation(f,Zi,ft),this.placedOrientations[ft.crossTileID]=Zi),Ji};va((()=>jn(ea,l.az.horizontal)),(()=>{const Wn=Pt.verticalTextBox;return f.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&Wn?jn(Wn,l.az.vertical):{box:null,offscreen:null}})),ta(li&&li.placeable)}else{let jn=l.aP[(ei=(Nn=this.prevPlacement)===null||Nn===void 0?void 0:Nn.variableOffsets[ft.crossTileID])===null||ei===void 0?void 0:ei.anchor];const Wn=(Ji,gh,yh)=>{const Ro=Ji.x2-Ji.x1,Bf=Ji.y2-Ji.y1,Lo=ft.textBoxScale,_h=pe&&_e==="never"?gh:null;let ro=null,ao=oe==="never"?1:2,as="never";jn&&ao++;for(let vh=0;vh<ao;vh++){for(let _u=Ba;_u<Na;_u++){const vu=f.textAnchorOffsets.get(_u);if(jn&&vu.textAnchor!==jn)continue;const xu=this.attemptAnchorPlacement(vu,Ji,Ro,Bf,Lo,ye,Te,O,Ve,P,Q,as,ft,f,yh,w,E,_h,qe);if(xu&&(ro=xu.placedGlyphBoxes,ro&&ro.placeable))return Yn=!0,bi=xu.shift,ro}jn?jn=null:as=oe}return c&&!ro&&(ro={box:this.collisionIndex.placeCollisionBox(ea,"always",O,Ve,P,Te,ye,w,Q.predicate,qe,void 0,St).box,offscreen:!1,placeable:!1,occluded:!1}),ro};va((()=>Wn(ea,Pt.iconBox,l.az.horizontal)),(()=>{const Ji=Pt.verticalTextBox;return f.allowVerticalPlacement&&(!li||!li.placeable)&&ft.numVerticalGlyphVertices>0&&Ji?Wn(Ji,Pt.verticalIconBox,l.az.vertical):{box:null,occluded:!0,offscreen:null}})),li&&(Yn=li.placeable,qn=li.offscreen);const Zi=ta(li&&li.placeable);if(!Yn&&this.prevPlacement){const Ji=this.prevPlacement.variableOffsets[ft.crossTileID];Ji&&(this.variableOffsets[ft.crossTileID]=Ji,this.markUsedJustification(f,Ji.anchor,ft,Zi))}}}if(Ci=li,Yn=Ci&&Ci.placeable,qn=Ci&&Ci.offscreen,ft.useRuntimeCollisionCircles&&ft.centerJustifiedTextSymbolIndex>=0){const ta=f.text.placedSymbolArray.get(ft.centerJustifiedTextSymbolIndex),va=l.aA(f.textSizeData,X,ta),Ba=v.get("text-padding");zi=this.collisionIndex.placeCollisionCircles(oe,ta,f.lineVertexArray,f.glyphOffsetArray,va,P,R,c,Te,Q.predicate,ft.collisionCircleDiameter,Ba,w,qe),zi.circles.length&&zi.collisionDetected&&!c&&l.w("Collisions detected, but collision boxes are not shown"),Yn=he||zi.circles.length>0&&!zi.collisionDetected,qn=qn&&zi.offscreen}if(Pt.iconFeatureIndex&&(is=Pt.iconFeatureIndex),Pt.iconBox){const ta=va=>this.collisionIndex.placeCollisionBox(va,_e,O,Ve,P,Te,ye,E,Q.predicate,qe,pe&&bi?bi:void 0,St);mr&&mr.placeable&&Pt.verticalIconBox?(gr=ta(Pt.verticalIconBox),oi=gr.placeable):(gr=ta(Pt.iconBox),oi=gr.placeable),qn=qn&&gr.offscreen}const _l=se||ft.numHorizontalGlyphVertices===0&&ft.numVerticalGlyphVertices===0,uc=le||ft.numIconVertices===0;_l||uc?uc?_l||(oi=oi&&Yn):Yn=oi&&Yn:oi=Yn=oi&&Yn;const rs=oi&&gr.placeable;if(Yn&&Ci.placeable&&this.collisionIndex.insertCollisionBox(Ci.box,oe,v.get("text-ignore-placement"),f.bucketInstanceId,mr&&mr.placeable&&Ls?Ls:Rs,Q.ID),rs&&this.collisionIndex.insertCollisionBox(gr.box,_e,v.get("icon-ignore-placement"),f.bucketInstanceId,is,Q.ID),zi&&Yn&&this.collisionIndex.insertCollisionCircles(zi.circles,oe,v.get("text-ignore-placement"),f.bucketInstanceId,Rs,Q.ID),c&&this.storeCollisionData(f.bucketInstanceId,sn,Pt,Ci,gr,zi),ft.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ft.crossTileID]=new Kh((Yn||Ge)&&!Ci?.occluded,(oi||je)&&!gr?.occluded,qn||f.justReloaded),a[ft.crossTileID]=!0};if(Ce){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ft=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Pt=ft.length-1;Pt>=0;--Pt){const sn=ft[Pt];At(f.symbolInstances.get(sn),f.collisionArrays[sn],sn)}}else for(let ft=t.symbolInstanceStart;ft<t.symbolInstanceEnd;ft++)At(f.symbolInstances.get(ft),f.collisionArrays[ft],ft);f.justReloaded=!1}storeCollisionData(t,a,c,f,v,w){if(c.textBox||c.iconBox){let E,P;this.collisionBoxArrays.has(t)?E=this.collisionBoxArrays.get(t):(E=new Map,this.collisionBoxArrays.set(t,E)),E.has(a)?P=E.get(a):(P={text:null,icon:null},E.set(a,P)),c.textBox&&(P.text=f.box),c.iconBox&&(P.icon=v.box)}if(w){let E=this.collisionCircleArrays[t];E===void 0&&(E=this.collisionCircleArrays[t]=[]);for(let P=0;P<w.circles.length;P+=4)E.push(w.circles[P+0]-An),E.push(w.circles[P+1]-An),E.push(w.circles[P+2]),E.push(w.collisionDetected?1:0)}}markUsedJustification(t,a,c,f){let v;v=f===l.az.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.aR(a)];const w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const E of w)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=v>=0&&E!==v?0:c.crossTileID)}markUsedOrientation(t,a,c){const f=a===l.az.horizontal||a===l.az.horizontalOnly?a:0,v=a===l.az.vertical?a:0,w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const E of w)t.text.placedSymbolArray.get(E).placedOrientation=f;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(t):1,v=a?a.opacities:{},w=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const P in this.placements){const R=this.placements[P],O=v[P];O?(this.opacities[P]=new Xo(O,f,R.text,R.icon),c=c||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[P]=new Xo(null,f,R.text,R.icon,R.skipFade),c=c||R.text||R.icon)}for(const P in v){const R=v[P];if(!this.opacities[P]){const O=new Xo(R,f,!1,!1);O.isHidden()||(this.opacities[P]=O,c=c||R.text.placed||R.icon.placed)}}for(const P in w)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=w[P]);for(const P in E)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=E[P]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const c={};for(const f of a){const v=f.getBucket(t);v&&f.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,f.tileID,c,f.collisionBoxArray)}}updateBucketOpacities(t,a,c,f){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const v=t.layers[0],w=v.layout,E=new Xo(null,0,!1,!1,!0),P=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),O=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=w.get("text-rotation-alignment")==="map",j=w.get("text-pitch-alignment")==="map",X=w.get("icon-text-fit")!=="none",Q=new Xo(null,0,P&&(R||!t.hasIconData()||w.get("icon-optional")),R&&(P||!t.hasTextData()||w.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const se=(oe,he,_e)=>{for(let ce=0;ce<he/4;ce++)oe.opacityVertexArray.emplaceBack(_e);oe.hasVisibleVertices=oe.hasVisibleVertices||_e!==Wo},le=this.collisionBoxArrays.get(t.bucketInstanceId);for(let oe=0;oe<t.symbolInstances.length;oe++){const he=t.symbolInstances.get(oe),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:ce,crossTileID:ye}=he;let Te=this.opacities[ye];c[ye]?Te=E:Te||(Te=Q,this.opacities[ye]=Te),c[ye]=!0;const pe=he.numIconVertices>0,Ce=this.placedOrientations[he.crossTileID],Ge=Ce===l.az.vertical,je=Ce===l.az.horizontal||Ce===l.az.horizontalOnly;if(_e>0||ce>0){const qe=Gu(Te.text);se(t.text,_e,Ge?Wo:qe),se(t.text,ce,je?Wo:qe);const St=Te.text.isHidden();[he.rightJustifiedTextSymbolIndex,he.centerJustifiedTextSymbolIndex,he.leftJustifiedTextSymbolIndex].forEach((Pt=>{Pt>=0&&(t.text.placedSymbolArray.get(Pt).hidden=St||Ge?1:0)})),he.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(he.verticalPlacedTextSymbolIndex).hidden=St||je?1:0);const At=this.variableOffsets[he.crossTileID];At&&this.markUsedJustification(t,At.anchor,he,Ce);const ft=this.placedOrientations[he.crossTileID];ft&&(this.markUsedJustification(t,"left",he,ft),this.markUsedOrientation(t,ft,he))}if(pe){const qe=Gu(Te.icon),St=!(X&&he.verticalPlacedIconSymbolIndex&&Ge);he.placedIconSymbolIndex>=0&&(se(t.icon,he.numIconVertices,St?qe:Wo),t.icon.placedSymbolArray.get(he.placedIconSymbolIndex).hidden=Te.icon.isHidden()),he.verticalPlacedIconSymbolIndex>=0&&(se(t.icon,he.numVerticalIconVertices,St?Wo:qe),t.icon.placedSymbolArray.get(he.verticalPlacedIconSymbolIndex).hidden=Te.icon.isHidden())}const Ve=le&&le.has(oe)?le.get(oe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const qe=t.collisionArrays[oe];if(qe){let St=new l.P(0,0);if(qe.textBox||qe.verticalTextBox){let At=!0;if(O){const ft=this.variableOffsets[ye];ft?(St=Nr(ft.anchor,ft.width,ft.height,ft.textOffset,ft.textBoxScale),V&&St._rotate(j?-this.transform.bearingInRadians:this.transform.bearingInRadians)):At=!1}if(qe.textBox||qe.verticalTextBox){let ft;qe.textBox&&(ft=Ge),qe.verticalTextBox&&(ft=je),qu(t.textCollisionBox.collisionVertexArray,Te.text.placed,!At||ft,Ve.text,St.x,St.y)}}if(qe.iconBox||qe.verticalIconBox){const At=!!(!je&&qe.verticalIconBox);let ft;qe.iconBox&&(ft=At),qe.verticalIconBox&&(ft=!At),qu(t.iconCollisionBox.collisionVertexArray,Te.icon.placed,ft,Ve.icon,X?St.x:0,X?St.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function qu(y,t,a,c,f,v){c&&c.length!==0||(c=[0,0,0,0]);const w=c[0]-An,E=c[1]-An,P=c[2]-An,R=c[3]-An;y.emplaceBack(t?1:0,a?1:0,f||0,v||0,w,E),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,P,E),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,P,R),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,w,R)}const Bc=Math.pow(2,25),mo=Math.pow(2,24),xf=Math.pow(2,17),Vl=Math.pow(2,16),Zs=Math.pow(2,9),bf=Math.pow(2,8),Yo=Math.pow(2,1);function Gu(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const t=y.placed?1:0,a=Math.floor(127*y.opacity);return a*Bc+t*mo+a*xf+t*Vl+a*Zs+t*bf+a*Yo+t}const Wo=0;class go{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,c,f,v){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((E,P)=>E.sortKey-P.sortKey)));this._currentPartIndex<w.length;)if(a.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,v())return!0;return!1}}class ql{constructor(t,a,c,f,v,w,E,P){this.placement=new Oc(t,a,w,E,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(t,a,c){const f=fe(),v=()=>!this._forceFullPlacement&&fe()-f>2;for(;this._currentPlacementIndex>=0;){const w=a[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=E)&&(!w.maxzoom||w.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new go(w)),this._inProgressLayer.continuePlacement(c[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const hn=512/l.a5/2;class Ya{constructor(t,a,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const f=new Map;for(let v=0;v<a.length;v++){const w=a.get(v),E=w.key,P=f.get(E);P?P.push(w):f.set(E,[w])}for(const[v,w]of f){const E={positions:w.map((P=>({x:Math.floor(P.anchorX*hn),y:Math.floor(P.anchorY*hn)}))),crossTileIDs:w.map((P=>P.crossTileID))};if(E.positions.length>128){const P=new l.aT(E.positions.length,16,Uint16Array);for(const{x:R,y:O}of E.positions)P.add(R,O);P.finish(),delete E.positions,E.index=P}this._symbolsByKey[v]=E}}getScaledCoordinates(t,a){const{x:c,y:f,z:v}=this.tileID.canonical,{x:w,y:E,z:P}=a.canonical,R=hn/Math.pow(2,P-v),O=(E*l.a5+t.anchorY)*R,V=f*l.a5*hn;return{x:Math.floor((w*l.a5+t.anchorX)*R-c*l.a5*hn),y:Math.floor(O-V)}}findMatches(t,a,c){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let v=0;v<t.length;v++){const w=t.get(v);if(w.crossTileID)continue;const E=this._symbolsByKey[w.key];if(!E)continue;const P=this.getScaledCoordinates(w,a);if(E.index){const R=E.index.range(P.x-f,P.y-f,P.x+f,P.y+f).sort();for(const O of R){const V=E.crossTileIDs[O];if(!c[V]){c[V]=!0,w.crossTileID=V;break}}}else if(E.positions)for(let R=0;R<E.positions.length;R++){const O=E.positions[R],V=E.crossTileIDs[R];if(Math.abs(O.x-P.x)<=f&&Math.abs(O.y-P.y)<=f&&!c[V]){c[V]=!0,w.crossTileID=V;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Qh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Nc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const c in this.indexes){const f=this.indexes[c],v={};for(const w in f){const E=f[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),v[E.tileID.key]=E}this.indexes[c]=v}this.lng=t}addBucket(t,a,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>t.overscaledZ)for(const E in w){const P=w[E];P.tileID.isChildOf(t)&&P.findMatches(a.symbolInstances,t,f)}else{const E=w[t.scaledTo(Number(v)).key];E&&E.findMatches(a.symbolInstances,t,f)}}for(let v=0;v<a.symbolInstances.length;v++){const w=a.symbolInstances.get(v);w.crossTileID||(w.crossTileID=c.generate(),f[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ya(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const c of a.getCrossTileIDsLists())for(const f of c)delete this.usedCrossTileIDs[t][f]}removeStaleBuckets(t){let a=!1;for(const c in this.indexes){const f=this.indexes[c];for(const v in f)t[f[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[v]),delete f[v],a=!0)}return a}}class ir{constructor(){this.layerIndexes={},this.crossTileIDs=new Qh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,c){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Nc);let v=!1;const w={};f.handleWrapJump(c);for(const E of a){const P=E.getBucket(t);P&&t.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(E.tileID,P,this.crossTileIDs)&&(v=!0),w[P.bucketInstanceId]=!0)}return f.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(t){const a={};t.forEach((c=>{a[c]=!0}));for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var qi="void main() {fragColor=vec4(1.0);}";const di={prelude:tn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:tn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:tn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:tn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:tn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:tn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:tn(qi,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:tn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:tn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:tn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:tn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:tn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:tn(qi,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:tn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:tn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:tn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:tn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:tn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:tn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:tn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:tn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:tn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:tn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:tn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:tn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:tn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:tn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:tn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:tn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:tn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:tn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:tn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:tn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:tn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:tn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:tn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function tn(y,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),f=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(f):f,E={};return{fragmentSource:y=y.replace(a,((P,R,O,V,j)=>(E[j]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${O} ${V} ${j};
#else
uniform ${O} ${V} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${O} ${V} ${j} = u_${j};
#endif
`))),vertexSource:t=t.replace(a,((P,R,O,V,j)=>{const X=V==="float"?"vec2":"vec4",Q=j.match(/color/)?"color":X;return E[j]?R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${O} ${X} a_${j};
out ${O} ${V} ${j};
#else
uniform ${O} ${V} u_${j};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${O} ${V} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${Q}(a_${j}, u_${j}_t);
#else
    ${O} ${V} ${j} = u_${j};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${O} ${X} a_${j};
#else
uniform ${O} ${V} u_${j};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${O} ${V} ${j} = a_${j};
#else
    ${O} ${V} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${O} ${V} ${j} = unpack_mix_${Q}(a_${j}, u_${j}_t);
#else
    ${O} ${V} ${j} = u_${j};
#endif
`})),staticAttributes:c,staticUniforms:w}}class $n{constructor(t,a,c){this.vertexBuffer=t,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Aa=l.aU([{name:"a_pos",type:"Int16",components:2}]);const Ei="#define PROJECTION_MERCATOR",Fr="mercator";class rr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Fr}get shaderDefine(){return Ei}get shaderPreludeCode(){return di.projectionMercator}get vertexShaderPreludeCode(){return di.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,c,f,v){if(this._cachedMesh)return this._cachedMesh;const w=new l.aW;w.emplaceBack(0,0),w.emplaceBack(l.a5,0),w.emplaceBack(0,l.a5),w.emplaceBack(l.a5,l.a5);const E=t.createVertexBuffer(w,Aa.members),P=l.aX.simpleSegment(0,0,4,2),R=new l.aY;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const O=t.createIndexBuffer(R);return this._cachedMesh=new $n(E,O,P),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class ca{constructor(t=0,a=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=c,this.right=f}interpolate(t,a,c){return a.top!=null&&t.top!=null&&(this.top=l.G.number(t.top,a.top,c)),a.bottom!=null&&t.bottom!=null&&(this.bottom=l.G.number(t.bottom,a.bottom,c)),a.left!=null&&t.left!=null&&(this.left=l.G.number(t.left,a.left,c)),a.right!=null&&t.right!=null&&(this.right=l.G.number(t.right,a.right,c)),this}getCenter(t,a){const c=l.an((this.left+t-this.right)/2,0,t),f=l.an((this.top+a-this.bottom)/2,0,a);return new l.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gs(y,t){if(!y.renderWorldCopies||y.lngRange)return;const a=t.lng-y.center.lng;t.lng+=a>180?-360:a<-180?360:0}function fi(y){return Math.max(0,Math.floor(y))}class yo{constructor(t,a){var c;this.applyConstrain=(f,v)=>this._constrainOverride!==null?this._constrainOverride(f,v):this._callbacks.defaultConstrain(f,v),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=fi(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ca,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,c){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=fi(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new ca(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=l.W(t,-180,180)*Math.PI/180;var c,f,v,w,E,P,R,O,V;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=W(),c=this._rotationMatrix,v=-this._bearingInRadians,w=(f=this._rotationMatrix)[0],E=f[1],P=f[2],R=f[3],O=Math.sin(v),V=Math.cos(v),c[0]=w*V+P*O,c[1]=E*V+R*O,c[2]=w*-O+P*V,c[3]=E*-O+R*V)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=l.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aZ(this._fovInRadians)}setFov(t){t=l.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=l.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=l.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,c){this._unmodified=!1,this._edgeInsets.interpolate(t,a,c),this.constrainInternal(),this._calcMatrices()}resize(t,a,c=!0){this._width=t,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Jn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-l.ao,l.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:c,minY:f,maxX:v,maxY:w}=l.aa.fromPoints(a).extend(t);return[new l.P(c,f),new l.P(v,f),new l.P(v,w),new l.P(c,w),new l.P(c,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=l.ar(new Float64Array(16));l.Q(t,t,[this._width/2,-this._height/2,1]),l.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=l.ar(new Float64Array(16)),l.Q(t,t,[1,-1,1]),l.O(t,t,[-1,-1,0]),l.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,c,f){const v=c!==void 0?c:this.bearing,w=f=f!==void 0?f:this.pitch,{distanceToCenter:E,clampedElevation:P}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,w),{x:R,y:O}=In(w,v),V=l.a9.fromLngLat(t,a);let j,X,Q=l.a_(1,V.y),se=0;do{if(se+=1,se>10)break;X=E/Q,j=new l.a9(V.x+R*X,V.y+O*X),Q=1/j.meterInMercatorCoordinateUnits()}while(Math.abs(E-X*Q)>1e-12);return{center:j.toLngLat(),elevation:P,zoom:l.at(this.height/2/Math.tan(this.fovInRadians/2)/X/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,c=l.as(1,this.center.lat)*this.worldSize,f=l.a9.fromLngLat(this.center,this.elevation),v=f.x/a,w=f.y/a,E=f.z/a,P=this.pitch,R=this.bearing,{x:O,y:V,z:j}=In(P,R),X=this.cameraToCenterDistance,Q=v+X*-O,se=w+X*-V,le=E+X*j,{distanceToCenter:oe,clampedElevation:he}=this._distanceToCenterFromAltElevationPitch(le/c,t,P),_e=oe*c,ce=new l.a9((Q+O*_e)*a,(se+V*_e)*a,0).toLngLat(),ye=l.as(1,ce.lat),Te=l.at(this.height/2/Math.tan(this.fovInRadians/2)/oe/ye/this.tileSize);this._elevation=he,this._center=ce,this.setZoom(Te)}_distanceToCenterFromAltElevationPitch(t,a,c){const f=-Math.cos(l.ap(c)),v=t-a;let w,E=a;return f*v>=0||Math.abs(f)<.1?(w=1e4,E=t+w*f):w=-v/f,{distanceToCenter:w,clampedElevation:E}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Oe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/l.a5,1/a/l.a5]}}class ua{constructor(t,a){this.min=t,this.max=a,this.center=l.a$([],l.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],c=l.b1(this.min),f=l.b1(this.max);for(let v=0;v<a.length;v++)c[v]=a[v]?this.min[v]:this.center[v],f[v]=a[v]?this.center[v]:this.max[v];return f[2]=this.max[2],new ua(c,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let c=0;c<t.planes.length;c++){const f=this.intersectsPlane(t.planes[c]);if(f===0)return 0;f===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],c=t[3];for(let f=0;f<3;f++)t[f]>0?(a+=t[f]*this.min[f],c+=t[f]*this.max[f]):(c+=t[f]*this.min[f],a+=t[f]*this.max[f]);return a>=0?2:c<0?0:1}}class Ko{distanceToTile2d(t,a,c,f){const v=f.distanceX([t,a]),w=f.distanceY([t,a]);return Math.hypot(v,w)}getWrap(t,a,c){return c}getTileBoundingVolume(t,a,c,f){var v,w;let E=0,P=0;if(f?.terrain){const O=new l.a2(t.z,a,t.z,t.x,t.y),V=f.terrain.getMinMaxElevation(O);E=(v=V.minElevation)!==null&&v!==void 0?v:Math.min(0,c),P=(w=V.maxElevation)!==null&&w!==void 0?w:Math.max(0,c)}const R=1<<t.z;return new ua([a+t.x/R,t.y/R,E],[a+(t.x+1)/R,(t.y+1)/R,P])}allowVariableZoom(t,a){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,f=l.an(78.5-c/2,0,60);return!!a.terrain||t.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class jr{constructor(t,a,c){this.points=t,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(t,a=1,c=0,f,v){const w=v?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],E=Math.pow(2,c),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((j=>(function(X,Q,se,le){const oe=l.aH([],X,Q),he=1/oe[3]/se*le;return l.b6(oe,oe,[he,he,1/oe[3],he])})(j,t,a,E)));f&&(function(j,X,Q,se){const le=se?4:0,oe=se?0:4;let he=0;const _e=[],ce=[];for(let pe=0;pe<4;pe++){const Ce=l.b2([],j[pe+oe],j[pe+le]),Ge=l.b7(Ce);l.a$(Ce,Ce,1/Ge),_e.push(Ge),ce.push(Ce)}for(let pe=0;pe<4;pe++){const Ce=l.b8(j[pe+le],ce[pe],Q);he=Ce!==null&&Ce>=0?Math.max(he,Ce):Math.max(he,_e[pe])}const ye=(function(pe,Ce){const Ge=l.b2([],pe[Ce[0]],pe[Ce[1]]),je=l.b2([],pe[Ce[2]],pe[Ce[1]]),Ve=[0,0,0,0];return l.b3(Ve,l.b4([],Ge,je)),Ve[3]=-l.b5(Ve,pe[Ce[0]]),Ve})(j,X),Te=(function(pe,Ce){const Ge=l.b9(pe),je=l.ba([],pe,1/Ge),Ve=l.b2([],Ce,l.a$([],je,l.b5(Ce,je))),qe=l.b9(Ve);if(qe>0){const St=Math.sqrt(1-je[3]*je[3]),At=l.a$([],je,-je[3]),ft=l.b0([],At,l.a$([],Ve,St/qe));return l.bb(Ce,ft)}return null})(Q,ye);if(Te!==null){const pe=Te/l.b5(ce[0],ye);he=Math.min(he,pe)}for(let pe=0;pe<4;pe++){const Ce=Math.min(he,_e[pe]);j[pe+oe]=[j[pe+le][0]+ce[pe][0]*Ce,j[pe+le][1]+ce[pe][1]*Ce,j[pe+le][2]+ce[pe][2]*Ce,1]}})(P,w[0],f,v);const R=w.map((j=>{const X=l.b2([],P[j[0]],P[j[1]]),Q=l.b2([],P[j[2]],P[j[1]]),se=l.b3([],l.b4([],X,Q)),le=-l.b5(se,P[j[1]]);return se.concat(le)})),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],V=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const j of P)for(let X=0;X<3;X++)O[X]=Math.min(O[X],j[X]),V[X]=Math.max(V[X],j[X]);return new jr(P,R,new ua(O,V))}}class Qi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=l.an(+c,this.minZoom,this.maxZoom);const f={center:new l.V(a.lng,a.lat),zoom:c};let v=this._helper._lngRange;if(!this._helper._renderWorldCopies&&v===null){const ce=179.9999999999;v=[-ce,ce]}const w=this.tileSize*l.aq(f.zoom);let E=0,P=w,R=0,O=w,V=0,j=0;const{x:X,y:Q}=this.size;if(this._helper._latRange){const ce=this._helper._latRange;E=l.X(ce[1])*w,P=l.X(ce[0])*w,P-E<Q&&(V=Q/(P-E))}v&&(R=l.W(l.Y(v[0])*w,0,w),O=l.W(l.Y(v[1])*w,0,w),O<R&&(O+=w),O-R<X&&(j=X/(O-R)));const{x:se,y:le}=It(w,a);let oe,he;const _e=Math.max(j||0,V||0);if(_e){const ce=new l.P(j?(O+R)/2:se,V?(P+E)/2:le);return f.center=Ht(w,ce).wrap(),f.zoom+=l.at(_e),f}if(this._helper._latRange){const ce=Q/2;le-ce<E&&(he=E+ce),le+ce>P&&(he=P-ce)}if(v){const ce=(R+O)/2;let ye=se;this._helper._renderWorldCopies&&(ye=l.W(se,ce-w/2,ce+w/2));const Te=X/2;ye-Te<R&&(oe=R+Te),ye+Te>O&&(oe=O-Te)}if(oe!==void 0||he!==void 0){const ce=new l.P(oe??se,he??le);f.center=Ht(w,ce).wrap()}return f},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new yo({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new Ko}clone(){const t=new Qi;return t.apply(this),t}apply(t,a,c){this._helper.apply(t,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new l.bc(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new l.P(0,0)),f=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),v=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),E=Math.floor(Math.min(c.x,f.x,v.x,w.x)),P=Math.floor(Math.max(c.x,f.x,v.x,w.x)),R=1;for(let O=E-R;O<=P+R;O++)O!==0&&a.push(new l.bc(O,t))}return a}getCameraFrustum(){return jr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,a){const c=l.as(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(a,c),v=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),w=l.a9.fromLngLat(t),E=new l.a9(w.x-(f.x-v.x),w.y-(f.y-v.y));this.setCenter(E?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(l.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(l.a9.fromLngLat(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const c=a||0,f=[t.x,t.y,0,1],v=[t.x,t.y,1,1];l.aH(f,f,this._pixelMatrixInverse),l.aH(v,v,this._pixelMatrixInverse);const w=f[3],E=v[3],P=f[1]/w,R=v[1]/E,O=f[2]/w,V=v[2]/E,j=O===V?0:(c-O)/(V-O);return new l.a9(l.G.number(f[0]/w,v[0]/E,j)/this.worldSize,l.G.number(P,R,j)/this.worldSize,c)}coordinatePoint(t,a=0,c=this._pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,a,1];return l.aH(f,f,c),new l.P(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this._helper._height/2-yn(this));return new Jn().extend(this.screenPointToLocation(new l.P(0,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-yn(this)}calculatePosMatrix(t,a=!1,c){var f;const v=(f=t.key)!==null&&f!==void 0?f:l.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),w=a?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(v)){const R=w.get(v);return c?R.f32:R.f64}const E=un(t,this.worldSize);l.S(E,a?this._alignedProjMatrix:this._viewProjMatrix,E);const P={f64:E,f32:new Float32Array(E)};return w.set(v,P),c?P.f32:P.f64}calculateFogMatrix(t){const a=t.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);const f=un(t,this.worldSize);return l.S(f,this._fogMatrix,f),c.set(a,new Float32Array(f)),c.get(a)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}_calculateNearFarZIfNeeded(t,a,c){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),v=t-f*this._helper._pixelPerMeter/Math.cos(a),w=f<0?v:t,E=Math.PI/2+this.pitchInRadians,P=l.ap(this.fov)*(Math.abs(Math.cos(l.ap(this.roll)))*this.height+Math.abs(Math.sin(l.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),R=Math.sin(P)*w/Math.sin(l.an(Math.PI-E-P,.01,Math.PI-.01)),O=yn(this),V=Math.atan(O/this._helper.cameraToCenterDistance),j=l.ap(.75),X=V>j?2*V*(.5+c.y/(2*O)):j,Q=Math.sin(X)*w/Math.sin(l.an(Math.PI-E-X,.01,Math.PI-.01)),se=Math.min(R,Q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*se+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=It(this.worldSize,this.center),c=a.x,f=a.y;this._helper._pixelPerMeter=l.as(1,this.center.lat)*this.worldSize;const v=l.ap(Math.min(this.pitch,Rt)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(v));let E;this._calculateNearFarZIfNeeded(w,v,t),E=new Float64Array(16),l.be(E,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aB(this._invProjMatrix,E),E[8]=2*-t.x/this._helper._width,E[9]=2*t.y/this._helper._height,this._projectionMatrix=l.bf(E),l.Q(E,E,[1,-1,1]),l.O(E,E,[0,0,-this._helper.cameraToCenterDistance]),l.bg(E,E,-this.rollInRadians),l.bh(E,E,this.pitchInRadians),l.bg(E,E,-this.bearingInRadians),l.O(E,E,[-c,-f,0]),this._mercatorMatrix=l.Q([],E,[this.worldSize,this.worldSize,this.worldSize]),l.Q(E,E,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E),l.O(E,E,[0,0,-this.elevation]),this._viewProjMatrix=E,this._invViewProjMatrix=l.aB([],E);const P=[0,0,-1,1];l.aH(P,P,this._invViewProjMatrix),this._cameraPosition=[P[0]/P[3],P[1]/P[3],P[2]/P[3]],this._fogMatrix=new Float64Array(16),l.be(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,l.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.O(this._fogMatrix,this._fogMatrix,[-c,-f,0]),l.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E);const R=this._helper._width%2/2,O=this._helper._height%2/2,V=Math.cos(this.bearingInRadians),j=Math.sin(-this.bearingInRadians),X=c-Math.round(c)+V*R+j*O,Q=f-Math.round(f)+V*O+j*R,se=new Float64Array(E);if(l.O(se,se,[X>.5?X-1:X,Q>.5?Q-1:Q,0]),this._alignedProjMatrix=se,E=l.aB(new Float64Array(16),this._pixelMatrix),!E)throw new Error("failed to invert matrix");this._pixelMatrixInverse=E,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new l.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Oe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const c=l.a9.fromLngLat(t),f=[c.x*this.worldSize,c.y*this.worldSize,a,1];return l.aH(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(t){const{overscaledTileID:a,aligned:c,applyTerrainMatrix:f}=t,v=this._helper.getMercatorTileCoordinates(a),w=a?this.calculatePosMatrix(a,c,!0):null;let E;return E=a&&a.terrainRttPosMatrix32f&&f?a.terrainRttPosMatrix32f:w||l.bi(),{mainMatrix:E,tileMercatorCoords:v,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:E}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,c){return 1}transformLightDirection(t){return l.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,c,f){const v=this.calculatePosMatrix(c);let w;f?(w=[t,a,f(t,a),1],l.aH(w,w,v)):(w=[t,a,0,1],Ma(w,w,v));const E=w[3];return{point:new l.P(w[0]/E,w[1]/E),signedDistanceFromCamera:E,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const c=l.a9.fromLngLat(t,a),f=c.meterInMercatorCoordinateUnits(),v=l.bj();return l.O(v,v,[c.x,c.y,c.z]),l.bg(v,v,Math.PI),l.bh(v,v,Math.PI/2),l.Q(v,v,[-f,f,f]),v}getProjectionDataForCustomLayer(t=!0){const a=new l.a2(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),f=un(a,this.worldSize);l.S(f,this._viewProjMatrix,f),c.tileMercatorCoords=[0,0,1,1];const v=[l.a5,l.a5,this.worldSize/this._helper.pixelsPerMeter],w=l.bk();return l.Q(w,f,v),c.fallbackMatrix=w,c.mainMatrix=w,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Ur(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Fc(y){if(y.useSlerp)if(y.k<1){const t=l.bl(y.startEulerAngles.roll,y.startEulerAngles.pitch,y.startEulerAngles.bearing),a=l.bl(y.endEulerAngles.roll,y.endEulerAngles.pitch,y.endEulerAngles.bearing),c=new Float64Array(4);l.bm(c,t,a,y.k);const f=l.bn(c);y.tr.setRoll(f.roll),y.tr.setPitch(f.pitch),y.tr.setBearing(f.bearing)}else y.tr.setRoll(y.endEulerAngles.roll),y.tr.setPitch(y.endEulerAngles.pitch),y.tr.setBearing(y.endEulerAngles.bearing);else y.tr.setRoll(l.G.number(y.startEulerAngles.roll,y.endEulerAngles.roll,y.k)),y.tr.setPitch(l.G.number(y.startEulerAngles.pitch,y.endEulerAngles.pitch,y.k)),y.tr.setBearing(l.G.number(y.startEulerAngles.bearing,y.endEulerAngles.bearing,y.k))}function Qo(y,t,a,c,f){const v=f.padding,w=It(f.worldSize,a.getNorthWest()),E=It(f.worldSize,a.getNorthEast()),P=It(f.worldSize,a.getSouthEast()),R=It(f.worldSize,a.getSouthWest()),O=l.ap(-c),V=w.rotate(O),j=E.rotate(O),X=P.rotate(O),Q=R.rotate(O),se=new l.P(Math.max(V.x,j.x,Q.x,X.x),Math.max(V.y,j.y,Q.y,X.y)),le=new l.P(Math.min(V.x,j.x,Q.x,X.x),Math.min(V.y,j.y,Q.y,X.y)),oe=se.sub(le),he=(f.width-(v.left+v.right+t.left+t.right))/oe.x,_e=(f.height-(v.top+v.bottom+t.top+t.bottom))/oe.y;if(_e<0||he<0)return void Ur();const ce=Math.min(l.at(f.scale*Math.min(he,_e)),y.maxZoom),ye=l.P.convert(y.offset),Te=new l.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(l.ap(c)),pe=ye.add(Te).mult(f.scale/l.aq(ce));return{center:Ht(f.worldSize,w.add(P).div(2).sub(pe)),zoom:ce,bearing:c}}class Jo{get useGlobeControls(){return!1}handlePanInertia(t,a){const c=t.mag(),f=Math.abs(yn(a));return{easingOffset:t.mult(Math.min(.75*f/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,c){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,a,c,f,v){return Qo(t,a,c,f,v)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(l.V.convert(a.center))}handleEaseTo(t,a){const c=t.zoom,f=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},E=a.zoom!==void 0,P=!t.isPaddingEqual(a.padding);let R=!1;const O=E?+a.zoom:t.zoom;let V=t.centerPoint.add(a.offsetAsPoint);const j=t.screenPointToLocation(V),{center:X,zoom:Q}=t.applyConstrain(l.V.convert(a.center||j),O??c);gs(t,X);const se=It(t.worldSize,j),le=It(t.worldSize,X).sub(se),oe=l.aq(Q-c);return R=Q!==c,{easeFunc:he=>{if(R&&t.setZoom(l.G.number(c,Q,he)),l.bo(v,w)||Fc({startEulerAngles:v,endEulerAngles:w,tr:t,k:he,useSlerp:v.roll!=w.roll}),P&&(t.interpolatePadding(f,a.padding,he),V=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const _e=l.aq(t.zoom-c),ce=Q>c?Math.min(2,oe):Math.max(.5,oe),ye=Math.pow(ce,1-he),Te=Ht(t.worldSize,se.add(le.mult(he*ye)).mult(_e));t.setLocationAtPoint(t.renderWorldCopies?Te.wrap():Te,V)}},isZooming:R,elevationCenter:X}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.zoom,v=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),c?+a.zoom:f),w=v.center,E=v.zoom;gs(t,w);const P=It(t.worldSize,a.locationAtOffset),R=It(t.worldSize,w).sub(P),O=R.mag(),V=l.aq(E-f);let j;if(a.minZoom!==void 0){const X=Math.min(+a.minZoom,f,E),Q=t.applyConstrain(w,X).zoom;j=l.aq(Q-f)}return{easeFunc:(X,Q,se,le)=>{t.setZoom(X===1?E:f+l.at(Q));const oe=X===1?w:Ht(t.worldSize,P.add(R.mult(se)).mult(Q));t.setLocationAtPoint(t.renderWorldCopies?oe.wrap():oe,le)},scaleOfZoom:V,targetCenter:w,scaleOfMinZoom:j,pixelPathLength:O}}}class Vn{constructor(t,a,c){this.blendFunction=t,this.blendColor=a,this.mask=c}}Vn.Replace=[1,0],Vn.disabled=new Vn(Vn.Replace,l.bp.transparent,[!1,!1,!1,!1]),Vn.unblended=new Vn(Vn.Replace,l.bp.transparent,[!0,!0,!0,!0]),Vn.alphaBlended=new Vn([1,771],l.bp.transparent,[!0,!0,!0,!0]);const _o=2305;class pn{constructor(t,a,c){this.enable=t,this.mode=a,this.frontFace=c}}pn.disabled=new pn(!1,1029,_o),pn.backCCW=new pn(!0,1029,_o),pn.frontCCW=new pn(!0,1028,_o);class on{constructor(t,a,c){this.func=t,this.mask=a,this.range=c}}on.ReadOnly=!1,on.ReadWrite=!0,on.disabled=new on(519,on.ReadOnly,[0,1]);const el=7680;class bn{constructor(t,a,c,f,v,w){this.test=t,this.ref=a,this.mask=c,this.fail=f,this.depthFail=v,this.pass=w}}bn.disabled=new bn({func:519,mask:0},0,0,el,el,el);const jc=new WeakMap;function Ca(y){var t;if(jc.has(y))return jc.get(y);{const a=(t=y.getParameter(y.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return jc.set(y,a),a}}class vo{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const f=new l.aW;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const v=new l.aY;v.emplaceBack(0,1,2),this._fullscreenTriangle=new $n(a.createVertexBuffer(f,Aa.members),a.createIndexBuffer(v),l.aX.simpleSegment(0,0,f.length,v.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);const w=c.createTexture();c.bindTexture(c.TEXTURE_2D,w),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),Ca(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const c=this._cachedRenderContext.context,f=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:l.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,f.TRIANGLES,on.disabled,bn.disabled,Vn.unblended,pn.disabled,((v,w)=>({u_input:v,u_output_expected:w}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ca(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const v=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:v}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ca(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=vo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const xo=l.a5/128;function wf(y,t){const a=y.granularity!==void 0?Math.max(y.granularity,1):1,c=a+(y.generateBorders?2:0),f=a+(y.extendToNorthPole||y.generateBorders?1:0)+(y.extendToSouthPole||y.generateBorders?1:0),v=c+1,w=f+1,E=y.generateBorders?-1:0,P=y.generateBorders||y.extendToNorthPole?-1:0,R=a+(y.generateBorders?1:0),O=a+(y.generateBorders||y.extendToSouthPole?1:0),V=v*w,j=c*f*6,X=v*w>65536;if(X&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Q=X||t==="32bit",se=new Int16Array(2*V);let le=0;for(let _e=P;_e<=O;_e++)for(let ce=E;ce<=R;ce++){let ye=ce/a*l.a5;ce===-1&&(ye=-xo),ce===a+1&&(ye=l.a5+xo);let Te=_e/a*l.a5;_e===-1&&(Te=y.extendToNorthPole?l.br:-xo),_e===a+1&&(Te=y.extendToSouthPole?l.bs:l.a5+xo),se[le++]=ye,se[le++]=Te}const oe=Q?new Uint32Array(j):new Uint16Array(j);let he=0;for(let _e=0;_e<f;_e++)for(let ce=0;ce<c;ce++){const ye=ce+1+_e*v,Te=ce+(_e+1)*v,pe=ce+1+(_e+1)*v;oe[he++]=ce+_e*v,oe[he++]=Te,oe[he++]=ye,oe[he++]=ye,oe[he++]=Te,oe[he++]=pe}return{vertices:se.buffer.slice(0),indices:oe.buffer.slice(0),uses32bitIndices:Q}}const Uc=new l.aV({fill:new l.bt(128,2),line:new l.bt(512,0),tile:new l.bt(128,32),stencil:new l.bt(128,1),circle:3});class Jh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return di.projectionGlobe}get vertexShaderPreludeCode(){return di.projectionMercator.vertexSource}get subdivisionGranularity(){return Uc}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new vo(t));const a=l.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(a,c),v=fe();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=v);const w=Math.min(Math.max((v-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bv(w))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,c,f,v){const w=(v==="stencil"?Uc.stencil:Uc.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:w,generateBorders:c,extendToNorthPole:a.y===0&&f,extendToSouthPole:a.y===(1<<a.z)-1&&f})}_getMesh(t,a){const c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];const f=(function(v,w){const E=wf(w,"16bit"),P=l.aW.deserialize({arrayBuffer:E.vertices,length:E.vertices.byteLength/2/2}),R=l.aY.deserialize({arrayBuffer:E.indices,length:E.indices.byteLength/2/3});return new $n(v.createVertexBuffer(P,Aa.members),v.createIndexBuffer(R),l.aX.simpleSegment(0,0,P.length,R.length))})(t,a);return this._tileMeshCache[c]=f,f}recalculate(t){}hasTransition(){const t=fe();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Qp=new l.t({type:new l.D(l.u.projection.type)});class ed extends l.E{constructor(t){super(),this._transitionable=new l.x(Qp,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0)),this._mercatorProjection=new rr,this._verticalPerspectiveProjection=new Jh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof l.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,c,f,v){return this.currentProjection.getMeshFromTileID(t,a,c,f,v)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Vr(y){const t=tl(y.worldSize,y.center.lat);return 2*Math.PI*t}function ys(y,t,a,c,f){const v=1/(1<<f),w=t/l.a5*v+c*v,E=l.by((y/l.a5*v+a*v)*Math.PI*2+Math.PI,2*Math.PI),P=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,R=Math.cos(P),O=new Float64Array(3);return O[0]=Math.sin(E)*R,O[1]=Math.sin(P),O[2]=Math.cos(E)*R,O}function pi(y){return(function(t,a){const c=Math.cos(a),f=new Float64Array(3);return f[0]=Math.sin(t)*c,f[1]=Math.sin(a),f[2]=Math.cos(t)*c,f})(y.lng*Math.PI/180,y.lat*Math.PI/180)}function tl(y,t){return y/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Vc(y){const t=Math.asin(y[1])/Math.PI*180,a=Math.sqrt(y[0]*y[0]+y[2]*y[2]);if(a>1e-6){const c=y[0]/a,f=Math.acos(y[2]/a),v=(c>0?f:-f)/Math.PI*180;return new l.V(l.W(v,-180,180),t)}return new l.V(0,t)}function qc(y){return Math.cos(y*Math.PI/180)}function Mi(y,t){const a=qc(y),c=qc(t);return l.at(c/a)}function Tf(y,t){const a=y.rotate(t.bearingInRadians),c=t.zoom+Mi(t.center.lat,0),f=l.bu(1/qc(t.center.lat),1/qc(Math.min(Math.abs(t.center.lat),60)),l.bx(c,7,3,0,1)),v=360/Vr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new l.V(t.center.lng-a.x*v*f,l.an(t.center.lat+a.y*v,-l.ao,l.ao))}function Zu(y){const t=.5*y,a=Math.sin(t),c=Math.cos(t);return Math.log(a+c)-Math.log(c-a)}function Sf(y,t,a,c){const f=y.lat+a*c;if(Math.abs(a)>1){const v=(Math.sign(y.lat+a)!==Math.sign(y.lat)?-Math.abs(y.lat):Math.abs(y.lat))*Math.PI/180,w=Math.abs(y.lat+a)*Math.PI/180,E=Zu(v+c*(w-v)),P=Zu(v),R=Zu(w);return new l.V(y.lng+t*((E-P)/(R-P)),f)}return new l.V(y.lng+t*c,f)}class Jp{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,c,f){const v=`${t.z}_${t.x}_${t.y}_${f?.terrain?"t":""}`,w=this._cache.get(v);if(w)return w;const E=this._cachePrevious.get(v);if(E)return this._cache.set(v,E),E;const P=this._boundingVolumeFactory(t,a,c,f);return this._cache.set(v,P),this._hadAnyChanges=!0,P}}class Gl{constructor(t,a,c,f){this.min=c,this.max=f,this.points=t,this.planes=a}static fromAabb(t,a){const c=[];for(let f=0;f<8;f++)c.push([1&~f?t[0]:a[0],(f>>1&1)==1?a[1]:t[1],(f>>2&1)==1?a[2]:t[2]]);return new Gl(c,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,c){const f=l.bB([],c[0],c[1],c[2]),v=l.bC([],[a[0],0,0],f),w=l.bC([],[0,a[1],0],f),E=l.bC([],[0,0,a[2]],f),P=[...t],R=[...t];for(let V=0;V<8;V++)for(let j=0;j<3;j++){const X=t[j]+v[j]*(1&~V?-1:1)+w[j]*((V>>1&1)==1?1:-1)+E[j]*((V>>2&1)==1?1:-1);P[j]=Math.min(P[j],X),R[j]=Math.max(R[j],X)}const O=[];for(let V=0;V<8;V++){const j=[...t];l.b0(j,j,l.a$([],v,1&~V?-1:1)),l.b0(j,j,l.a$([],w,(V>>1&1)==1?1:-1)),l.b0(j,j,l.a$([],E,(V>>2&1)==1?1:-1)),O.push(j)}return new Gl(O,[[...v,-l.b5(v,O[0])],[...w,-l.b5(w,O[0])],[...E,-l.b5(E,O[0])],[-v[0],-v[1],-v[2],-l.b5(v,O[7])],[-w[0],-w[1],-w[2],-l.b5(w,O[7])],[-E[0],-E[1],-E[2],-l.b5(E,O[7])]],P,R)}intersectsFrustum(t){let a=!0;const c=this.points.length,f=this.planes.length,v=t.planes.length,w=t.points.length;for(let E=0;E<v;E++){const P=t.planes[E];let R=0;for(let O=0;O<c;O++){const V=this.points[O];P[0]*V[0]+P[1]*V[1]+P[2]*V[2]+P[3]>=0&&R++}if(R===0)return 0;R<c&&(a=!1)}if(a)return 2;for(let E=0;E<f;E++){const P=this.planes[E];let R=0;for(let O=0;O<w;O++){const V=t.points[O];P[0]*V[0]+P[1]*V[1]+P[2]*V[2]+P[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let c=0;for(let f=0;f<a;f++){const v=this.points[f];t[0]*v[0]+t[1]*v[1]+t[2]*v[2]+t[3]>=0&&c++}return c===a?2:c===0?0:1}}function Hu(y,t,a){const c=y-t;return c<0?-c:Math.max(0,c-a)}function Zl(y,t,a,c,f){const v=y-a;let w;return w=v<0?Math.min(-v,1+v-f):v>1?Math.min(Math.max(v-f,0),1-v):0,Math.max(w,Hu(t,c,f))}class td{constructor(){this._boundingVolumeCache=new Jp(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,c,f){const v=1<<c.z,w=1/v,E=c.x/v,P=c.y/v;let R=2;return R=Math.min(R,Zl(t,a,E,P,w)),R=Math.min(R,Zl(t,a,E+.5,-P-w,w)),R=Math.min(R,Zl(t,a,E+.5,2-P-w,w)),R}getWrap(t,a,c){const f=1<<a.z,v=1/f,w=a.x/f,E=Hu(t.x,w,v),P=Hu(t.x,w-1,v),R=Hu(t.x,w+1,v),O=Math.min(E,P,R);return O===R?1:O===P?-1:0}allowVariableZoom(t,a){return Ln(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,c,f){return this._boundingVolumeCache.getTileBoundingVolume(t,a,c,f)}_computeTileBoundingVolume(t,a,c,f){var v,w;let E=0,P=0;if(f?.terrain){const R=new l.a2(t.z,a,t.z,t.x,t.y),O=f.terrain.getMinMaxElevation(R);E=(v=O.minElevation)!==null&&v!==void 0?v:Math.min(0,c),P=(w=O.maxElevation)!==null&&w!==void 0?w:Math.max(0,c)}if(E/=l.bE,P/=l.bE,E+=1,P+=1,t.z<=0)return Gl.fromAabb([-P,-P,-P],[P,P,P]);if(t.z===1)return Gl.fromAabb([t.x===0?-P:0,t.y===0?0:-P,-P],[t.x===0?0:P,t.y===0?P:0,P]);{const R=[ys(0,0,t.x,t.y,t.z),ys(l.a5,0,t.x,t.y,t.z),ys(l.a5,l.a5,t.x,t.y,t.z),ys(0,l.a5,t.x,t.y,t.z)],O=[];for(const Ve of R)O.push(l.a$([],Ve,P));if(P!==E)for(const Ve of R)O.push(l.a$([],Ve,E));t.y===0&&O.push([0,1,0]),t.y===(1<<t.z)-1&&O.push([0,-1,0]);const V=[1,1,1],j=[-1,-1,-1];for(const Ve of O)for(let qe=0;qe<3;qe++)V[qe]=Math.min(V[qe],Ve[qe]),j[qe]=Math.max(j[qe],Ve[qe]);const X=ys(l.a5/2,l.a5/2,t.x,t.y,t.z),Q=l.b4([],[0,1,0],X);l.b3(Q,Q);const se=l.b4([],X,Q);l.b3(se,se);const le=l.b4([],R[2],R[1]);l.b3(le,le);const oe=l.b4([],R[0],R[3]);l.b3(oe,oe),O.push(l.a$([],X,P)),t.y>=(1<<t.z)/2&&O.push(l.a$([],ys(l.a5/2,0,t.x,t.y,t.z),P)),t.y<(1<<t.z)/2&&O.push(l.a$([],ys(l.a5/2,l.a5,t.x,t.y,t.z),P));const he=Gc(X,O),_e=Gc(se,O),ce=[-X[0],-X[1],-X[2],he.max],ye=[X[0],X[1],X[2],-he.min],Te=[-se[0],-se[1],-se[2],_e.max],pe=[se[0],se[1],se[2],-_e.min],Ce=[...le,0],Ge=[...oe,0],je=[];return t.y===0?je.push(l.bD(Ge,Ce,ce),l.bD(Ge,Ce,ye)):je.push(l.bD(Te,Ce,ce),l.bD(Te,Ce,ye),l.bD(Te,Ge,ce),l.bD(Te,Ge,ye)),t.y===(1<<t.z)-1?je.push(l.bD(Ge,Ce,ce),l.bD(Ge,Ce,ye)):je.push(l.bD(pe,Ce,ce),l.bD(pe,Ce,ye),l.bD(pe,Ge,ce),l.bD(pe,Ge,ye)),new Gl(je,[ce,ye,Te,pe,Ce,Ge],V,j)}}}function Gc(y,t){let a=1/0,c=-1/0;for(const f of t){const v=l.b5(y,f);a=Math.min(a,v),c=Math.max(c,v)}return{min:a,max:c}}class Hl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=l.bF(),this._projectionMatrix=l.bj(),this._globeViewProjMatrix32f=l.bi(),this._globeViewProjMatrixNoCorrection=l.bj(),this._globeViewProjMatrixNoCorrectionInverted=l.bj(),this._globeProjMatrixInverted=l.bj(),this._cameraPosition=l.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{const f=l.an(a.lat,-l.ao,l.ao),v=l.an(+c,this.minZoom+Mi(0,f),this.maxZoom);return{center:new l.V(a.lng,f),zoom:v}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new yo({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new td}clone(){const t=new Hl;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=l.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:c}=t,f=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,c=this.cameraToCenterDistance/t,f=Math.sin(a)*c,v=Math.cos(a)*c+1,w=1/Math.sqrt(f*f+v*v)*1;let E=-f,P=v;const R=Math.sqrt(E*E+P*P);E/=R,P/=R;const O=[0,E,P];l.bG(O,O,[0,0,0],-this.bearingInRadians),l.bH(O,O,[0,0,0],-1*this.center.lat*Math.PI/180),l.bI(O,O,[0,0,0],this.center.lng*Math.PI/180);const V=1/l.b7(O);return l.a$(O,O,V),[...O,-w*V]}isLocationOccluded(t){return!this.isSurfacePointVisible(pi(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,f=Math.cos(c),v=[Math.sin(a)*f,Math.sin(c),Math.cos(a)*f],w=[v[2],0,-v[0]],E=[0,0,0];l.b4(E,w,v),l.b3(w,w),l.b3(E,E);const P=[0,0,0];return l.b3(P,[w[0]*t[0]+E[0]*t[1]+v[0]*t[2],w[1]*t[0]+E[1]*t[1]+v[1]*t[2],w[2]*t[0]+E[2]*t[1]+v[2]*t[2]]),P}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,c){const f=(function(E,P,R){const O=1/(1<<R.z);return new l.a9(E/l.a5*O+R.x*O,P/l.a5*O+R.y*O)})(t,a,c.canonical),v=(w=f.y,[l.by(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(v[1])}projectTileCoordinates(t,a,c,f){const v=c.canonical,w=ys(t,a,v.x,v.y,v.z),E=1+(f?f(t,a):0)/l.bE,P=[w[0]*E,w[1]*E,w[2]*E,1];l.aH(P,P,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,O=R[0]*w[0]+R[1]*w[1]+R[2]*w[2]+R[3]<0;return{point:new l.P(P[0]/P[3],P[1]/P[3]),signedDistanceFromCamera:P[3],isOccluded:O}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=tl(this.worldSize,this.center.lat),a=l.bk(),c=l.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),l.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;a[8]=2*-f.x/this._helper._width,a[9]=2*f.y/this._helper._height,this._projectionMatrix=l.bf(a),this._globeProjMatrixInverted=l.bk(),l.aB(this._globeProjMatrixInverted,a),l.O(a,a,[0,0,-this.cameraToCenterDistance]),l.bg(a,a,this.rollInRadians),l.bh(a,a,-this.pitchInRadians),l.bg(a,a,this.bearingInRadians),l.O(a,a,[0,0,-t]);const v=l.bz();v[0]=t,v[1]=t,v[2]=t,l.bh(c,a,this.center.lat*Math.PI/180),l.bJ(c,c,-this.center.lng*Math.PI/180),l.Q(c,c,v),this._globeViewProjMatrixNoCorrection=c,l.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bJ(a,a,-this.center.lng*Math.PI/180),l.Q(a,a,v),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=l.bk(),l.aB(this._globeViewProjMatrixNoCorrectionInverted,c);const w=l.bz();this._cameraPosition=l.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,l.bG(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),l.bH(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),l.bG(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),l.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bH(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),l.bI(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const E=l.bf(this._globeViewProjMatrixNoCorrectionInverted);l.Q(E,E,[1,1,-1]),this._cachedFrustum=jr.fromInvProjectionMatrix(E,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){l.w("calculateFogMatrix is not supported on globe projection.");const a=l.bk();return l.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new l.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=pi(t);l.a$(c,c,1+a/l.bE);const f=l.bF();return l.aH(f,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,c=[new l.P(0,0),new l.P(t,0),new l.P(this.width,0),new l.P(this.width,a),new l.P(this.width,this.height),new l.P(t,this.height),new l.P(0,this.height),new l.P(0,a)],f=[];for(const V of c)f.push(this.unprojectScreenPoint(V));let v=0,w=0,E=0,P=0;const R=this.center;for(const V of f){const j=l.bK(R.lng,V.lng),X=l.bK(R.lat,V.lat);j<w&&(w=j),j>v&&(v=j),X<P&&(P=X),X>E&&(E=X)}const O=[R.lng+w,R.lat+P,R.lng+v,R.lat+E];return this.isSurfacePointOnScreen([0,1,0])&&(O[3]=90,O[0]=-180,O[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(O[1]=-90,O[0]=-180,O[2]=180),new Jn(O)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){const c=pi(this.unprojectScreenPoint(a)),f=pi(t),v=l.bz();l.bL(v);const w=l.bz();l.bI(w,c,v,-this.center.lng*Math.PI/180),l.bH(w,w,v,this.center.lat*Math.PI/180);const E=f[0]*f[0]+f[2]*f[2],P=w[0]*w[0];if(E<P)return;const R=Math.sqrt(E-P),O=-R,V=l.bM(f[0],f[2],w[0],R),j=l.bM(f[0],f[2],w[0],O),X=l.bz();l.bI(X,f,v,-V);const Q=l.bM(X[1],X[2],w[1],w[2]),se=l.bz();l.bI(se,f,v,-j);const le=l.bM(se[1],se[2],w[1],w[2]),oe=.5*Math.PI,he=Q>=-oe&&Q<=oe,_e=le>=-oe&&le<=oe;let ce,ye;if(he&&_e){const Ge=this.center.lng*Math.PI/180,je=this.center.lat*Math.PI/180;l.bN(V,Ge)+l.bN(Q,je)<l.bN(j,Ge)+l.bN(le,je)?(ce=V,ye=Q):(ce=j,ye=le)}else if(he)ce=V,ye=Q;else{if(!_e)return;ce=j,ye=le}const Te=ce/Math.PI*180,pe=ye/Math.PI*180,Ce=this.center.lat;this.setCenter(new l.V(Te,l.an(pe,-90,90))),this.setZoom(this.zoom+Mi(Ce,this.center.lat))}locationToScreenPoint(t,a){const c=pi(t);if(a){const f=a.getElevationForLngLatZoom(t,this._helper._tileZoom);l.a$(c,c,1+f/l.bE)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new l.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c)return c}return l.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,a){const c=this._cameraPosition,f=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,f)}getRayDirectionFromPixel(t){const a=l.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,l.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const c=l.bz();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];const f=l.bz();return l.b3(f,c),f}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const c=l.b5(t,a),f=l.bz(),v=l.bz();l.a$(v,a,c),l.b2(f,t,v);const w=1-l.b5(f,f);if(w<0)return null;const E=l.b5(t,t)-1,P=-c+(c<0?1:-1)*Math.sqrt(w),R=E/P,O=P;return{tMin:Math.min(R,O),tMax:Math.max(R,O)}}unprojectScreenPoint(t){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(t),f=this.rayPlanetIntersection(a,c);if(f){const O=l.bz();l.b0(O,a,[c[0]*f.tMin,c[1]*f.tMin,c[2]*f.tMin]);const V=l.bz();return l.b3(V,O),Vc(V)}const v=this._cachedClippingPlane,w=v[0]*c[0]+v[1]*c[1]+v[2]*c[2],E=-l.bb(v,a)/w,P=l.bz();if(E>0)l.b0(P,a,[c[0]*E,c[1]*E,c[2]*E]);else{const O=l.bz();l.b0(O,a,[2*c[0],2*c[1],2*c[2]]);const V=l.bb(this._cachedClippingPlane,O);l.b2(P,O,[this._cachedClippingPlane[0]*V,this._cachedClippingPlane[1]*V,this._cachedClippingPlane[2]*V])}const R=(function(O){const V=l.bz();return V[0]=O[0]*-O[3],V[1]=O[1]*-O[3],V[2]=O[2]*-O[3],{center:V,radius:Math.sqrt(1-O[3]*O[3])}})(v);return Vc((function(O,V,j){const X=l.bz();l.b2(X,j,O);const Q=l.bz();return l.bA(Q,O,X,V/l.b9(X)),Q})(R.center,R.radius,P))}getMatrixForModel(t,a){const c=l.V.convert(t),f=1/l.bE,v=l.bj();return l.bJ(v,v,c.lng/180*Math.PI),l.bh(v,v,-c.lat/180*Math.PI),l.O(v,v,[0,0,1+a/l.bE]),l.bh(v,v,.5*Math.PI),l.Q(v,v,[f,f,f]),v}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new l.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class $l{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new yo({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._globeness=1,this._mercatorTransform=new Qi,this._verticalPerspectiveTransform=new Hl}clone(){const t=new $l;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return l.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,c){const f=this._mercatorTransform.getPitchedTextCorrection(t,a,c),v=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,c);return l.bu(f,v,this._globeness)}projectTileCoordinates(t,a,c,f){return this.currentTransform.projectTileCoordinates(t,a,c,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Oi{get useGlobeControls(){return!0}handlePanInertia(t,a){const c=Tf(t,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const c=t.around,f=a.screenPointToLocation(c);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const v=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const w=a.zoom-v;if(w===0)return;const E=l.bK(a.center.lng,f.lng),P=E/(Math.abs(E/180)+1),R=l.bK(a.center.lat,f.lat),O=a.getRayDirectionFromPixel(c),V=a.cameraPosition,j=-1*l.b5(V,O),X=l.bz();l.b0(X,V,[O[0]*j,O[1]*j,O[2]*j]);const Q=l.b7(X)-1,se=Math.exp(.5*-Math.max(Q-.3,0)),le=tl(a.worldSize,a.center.lat)/Math.min(a.width,a.height),oe=l.bx(le,.9,.5,1,.25),he=(1-l.aq(-w))*Math.min(se,oe),_e=a.center.lat,ce=a.zoom,ye=new l.V(a.center.lng+P*he,l.an(a.center.lat+R*he,-l.ao,l.ao));a.setLocationAtPoint(f,c);const Te=a.center,pe=l.bx(Math.abs(E),45,85,0,1),Ce=l.bx(le,.75,.35,0,1),Ge=Math.pow(Math.max(pe,Ce),.25),je=l.bK(Te.lng,ye.lng),Ve=l.bK(Te.lat,ye.lat);a.setCenter(new l.V(Te.lng+je*Ge,Te.lat+Ve*Ge).wrap()),a.setZoom(ce+Mi(_e,a.center.lat))}handleMapControlsPan(t,a,c){if(!t.panDelta)return;const f=a.center.lat,v=a.zoom;a.setCenter(Tf(t.panDelta,a).wrap()),a.setZoom(v+Mi(f,a.center.lat))}cameraForBoxAndBearing(t,a,c,f,v){const w=Qo(t,a,c,f,v),E=a.left/v.width*2-1,P=(v.width-a.right)/v.width*2-1,R=a.top/v.height*-2+1,O=(v.height-a.bottom)/v.height*-2+1,V=l.bK(c.getWest(),c.getEast())<0,j=V?c.getEast():c.getWest(),X=V?c.getWest():c.getEast(),Q=Math.max(c.getNorth(),c.getSouth()),se=Math.min(c.getNorth(),c.getSouth()),le=j+.5*l.bK(j,X),oe=Q+.5*l.bK(Q,se),he=v.clone();he.setCenter(w.center),he.setBearing(w.bearing),he.setPitch(0),he.setRoll(0),he.setZoom(w.zoom);const _e=he.modelViewProjectionMatrix,ce=[pi(c.getNorthWest()),pi(c.getNorthEast()),pi(c.getSouthWest()),pi(c.getSouthEast()),pi(new l.V(X,oe)),pi(new l.V(j,oe)),pi(new l.V(le,Q)),pi(new l.V(le,se))],ye=pi(w.center);let Te=Number.POSITIVE_INFINITY;for(const pe of ce)E<0&&(Te=Oi.getLesserNonNegativeNonNull(Te,Oi.solveVectorScale(pe,ye,_e,"x",E))),P>0&&(Te=Oi.getLesserNonNegativeNonNull(Te,Oi.solveVectorScale(pe,ye,_e,"x",P))),R>0&&(Te=Oi.getLesserNonNegativeNonNull(Te,Oi.solveVectorScale(pe,ye,_e,"y",R))),O<0&&(Te=Oi.getLesserNonNegativeNonNull(Te,Oi.solveVectorScale(pe,ye,_e,"y",O)));if(Number.isFinite(Te)&&Te!==0)return w.zoom=he.zoom+l.at(Te),w;Ur()}handleJumpToCenterZoom(t,a){const c=t.center.lat,f=t.applyConstrain(a.center?l.V.convert(a.center):t.center,t.zoom).center;t.setCenter(f.wrap());const v=a.zoom!==void 0?+a.zoom:t.zoom+Mi(c,f.lat);t.zoom!==v&&t.setZoom(v)}handleEaseTo(t,a){const c=t.zoom,f=t.center,v=t.padding,w={roll:t.roll,pitch:t.pitch,bearing:t.bearing},E={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},P=a.zoom!==void 0,R=!t.isPaddingEqual(a.padding);let O=!1;const V=a.center?l.V.convert(a.center):f,j=t.applyConstrain(V,c).center;gs(t,j);const X=t.clone();X.setCenter(j),X.setZoom(P?+a.zoom:c+Mi(f.lat,V.lat)),X.setBearing(a.bearing);const Q=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));X.setLocationAtPoint(j,Q);const se=(a.offset&&a.offsetAsPoint.mag())>0?X.center:j,le=P?+a.zoom:c+Mi(f.lat,se.lat),oe=c+Mi(f.lat,0),he=le+Mi(se.lat,0),_e=l.bK(f.lng,se.lng),ce=l.bK(f.lat,se.lat),ye=l.aq(he-oe);return O=le!==c,{easeFunc:Te=>{if(l.bo(w,E)||Fc({startEulerAngles:w,endEulerAngles:E,tr:t,k:Te,useSlerp:w.roll!=E.roll}),R&&t.interpolatePadding(v,a.padding,Te),a.around)l.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const pe=he>oe?Math.min(2,ye):Math.max(.5,ye),Ce=Math.pow(pe,1-Te),Ge=Sf(f,_e,ce,Te*Ce);t.setCenter(Ge.wrap())}if(O){const pe=l.G.number(oe,he,Te)+Mi(0,t.center.lat);t.setZoom(pe)}},isZooming:O,elevationCenter:se}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.center,v=t.zoom,w=t.padding,E=!t.isPaddingEqual(a.padding),P=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),v).center,R=c?+a.zoom:t.zoom+Mi(t.center.lat,P.lat),O=t.clone();O.setCenter(P),O.setZoom(R),O.setBearing(a.bearing);const V=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));O.setLocationAtPoint(P,V);const j=O.center;gs(t,j);const X=(function(ce,ye,Te){const pe=pi(ye),Ce=pi(Te),Ge=l.b5(pe,Ce),je=Math.acos(Ge),Ve=Vr(ce);return je/(2*Math.PI)*Ve})(t,f,j),Q=v+Mi(f.lat,0),se=R+Mi(j.lat,0),le=l.aq(se-Q);let oe;if(typeof a.minZoom=="number"){const ce=+a.minZoom+Mi(j.lat,0),ye=Math.min(ce,Q,se)+Mi(0,j.lat),Te=t.applyConstrain(j,ye).zoom+Mi(j.lat,0);oe=l.aq(Te-Q)}const he=l.bK(f.lng,j.lng),_e=l.bK(f.lat,j.lat);return{easeFunc:(ce,ye,Te,pe)=>{const Ce=Sf(f,he,_e,Te);E&&t.interpolatePadding(w,a.padding,ce);const Ge=ce===1?j:Ce;t.setCenter(Ge.wrap());const je=Q+l.at(ye);t.setZoom(ce===1?R:je+Mi(0,Ge.lat))},scaleOfZoom:le,targetCenter:j,scaleOfMinZoom:oe,pixelPathLength:X}}static solveVectorScale(t,a,c,f,v){const w=f==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],E=[c[3],c[7],c[11],c[15]],P=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],R=t[0]*E[0]+t[1]*E[1]+t[2]*E[2],O=a[0]*w[0]+a[1]*w[1]+a[2]*w[2],V=a[0]*E[0]+a[1]*E[1]+a[2]*E[2];return O+v*R===P+v*V||E[3]*(P-O)+w[3]*(V-R)+P*V==O*R?null:(O+w[3]-v*V-v*E[3])/(O-P-v*V+v*R)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class Xl{constructor(t){this._globe=t,this._mercatorCameraHelper=new Jo,this._verticalPerspectiveCameraHelper=new Oi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,c){this.currentHelper.handleMapControlsPan(t,a,c)}cameraForBoxAndBearing(t,a,c,f,v){return this.currentHelper.cameraForBoxAndBearing(t,a,c,f,v)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const Yl=(y,t)=>l.B(y,t&&t.filter((a=>a.identifier!=="source.canvas"))),Wl=l.bO();class bo extends l.E{constructor(t,a={}){var c,f;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const E=this.tileManagers[w].getSource().type;E!=="vector"&&E!=="geojson"||this.tileManagers[w].reload()}},this.map=t,this.dispatcher=new Dn(Qt(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((w,E)=>this.getGlyphs(w,E))),this.dispatcher.registerMessageHandler("GI",((w,E)=>this.getImages(w,E))),this.dispatcher.registerMessageHandler("GDA",((w,E)=>this.getDashes(w,E))),this.imageManager=new Et,this.imageManager.setEventedParent(this);const v=((c=t._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new $e(t._requestManager,a.localIdeographFontFamily,v),this.lineAtlas=new wt(256,512),this.crossTileSymbolIndex=new ir,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",l.bP()),ze().on(ue,this._rtlPluginLoaded),this.on("data",(w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const E=this.tileManagers[w.sourceId];if(!E)return;const P=E.getSource();if(P&&P.vectorLayerIds)for(const R in this._layers){const O=this._layers[R];O.source===P.id&&this._validateLayer(O)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new l.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var c,f,v;this._checkLoaded();const w=a===null?(v=(f=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||f===void 0?void 0:f.default)!==null&&v!==void 0?v:null:a;if(l.bR(w,this._globalState[t]))return this;this._globalState[t]=w,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const c in t)!l.bR(this._globalState[c],t[c].default)&&(a.push(c),this._globalState[c]=t[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,c={};for(const f of t){c[f]=this._globalState[f];for(const v in this._layers){const w=this._layers[v],E=w.getLayoutAffectingGlobalStateRefs(),P=w.getPaintAffectingGlobalStateRefs(),R=w.getVisibilityAffectingGlobalStateRefs();if(E.has(f)&&a.add(w.source),P.has(f))for(const{name:O,value:V}of P.get(f))this._updatePaintProperty(w,O,V);R?.has(f)&&(w.recalculateVisibility(),this._updateLayer(w))}}this.dispatcher.broadcast("UGS",c);for(const f in this.tileManagers)a.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;l.j(f,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,a,c)})).catch((w=>{this._loadStyleRequest=null,w&&!v.signal.aborted&&this.fire(new l.k(w))}))}loadJSON(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,be.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(Wl,{validate:!1})}_load(t,a,c){var f,v;let w=a.transformStyle?a.transformStyle(c,t):t;if(!a.validate||!Yl(this,l.C(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const E in w.sources)this.addSource(E,w.sources[E],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Ut(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new Ye(this.stylesheet.sky),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var t,a,c;const f=l.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",f),this._order=f.map((v=>v.id)),this._layers={},this._serializedLayers=null;for(const v of f){const w=l.bT(v,this._globalState);if(w.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=w,l.bU(w)&&this.tileManagers[w.source]){const E=(c=(a=v.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(E)}}}_loadSprite(t,a=!1,c=void 0){this.imageManager.setLoaded(!1);const f=new AbortController;let v;this._spriteRequest=f,(function(w,E,P,R){return l._(this,void 0,void 0,(function*(){const O=ct(w),V=P>1?"@2x":"",j={},X={};for(const{id:Q,url:se}of O){const le=E.transformRequest(it(se,V,".json"),"SpriteJSON");j[Q]=l.j(le,R);const oe=E.transformRequest(it(se,V,".png"),"SpriteImage");X[Q]=st.getImage(oe,R)}return yield Promise.all([...Object.values(j),...Object.values(X)]),(function(Q,se){return l._(this,void 0,void 0,(function*(){const le={};for(const oe in Q){le[oe]={};const he=be.getImageCanvasContext((yield se[oe]).data),_e=(yield Q[oe]).data;for(const ce in _e){const{width:ye,height:Te,x:pe,y:Ce,sdf:Ge,pixelRatio:je,stretchX:Ve,stretchY:qe,content:St,textFitWidth:At,textFitHeight:ft}=_e[ce];le[oe][ce]={data:null,pixelRatio:je,sdf:Ge,stretchX:Ve,stretchY:qe,content:St,textFitWidth:At,textFitHeight:ft,spriteData:{width:ye,height:Te,x:pe,y:Ce,context:he}}}}return le}))})(j,X)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const E in w){this._spritesImagesIds[E]=[];const P=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter((R=>!(R in w))):[];for(const R of P)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in w[E]){const O=E==="default"?R:`${E}:${R}`;this._spritesImagesIds[E].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,w[E][R],!1):this.imageManager.addImage(O,w[E][R]),a&&(this._changedImages[O]=!0)}}})).catch((w=>{this._spriteRequest=null,v=w,f.signal.aborted||this.fire(new l.k(v))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),c&&c(v)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const c=t.sourceLayer;if(!c)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.k(new Error(`Source layer "${c}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?l.bV(c):c);const f=[];for(const v of t)if(c[v]){const w=a?l.bV(c[v]):c[v];f.push(w)}return f}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const f=this._layers[c];f.type!=="custom"&&(t[c]=f.serialize())}return t}hasTransitions(){var t,a,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const f=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(f.length||v.length)&&this._updateWorkerLayers(f,v);for(const w in this._updatedSources){const E=this._updatedSources[w];if(E==="reload")this._reloadSource(w);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const f in this.tileManagers){const v=this.tileManagers[f];c[f]=v.used,v.used=!1}for(const f of this._order){const v=this._layers[f];v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)&&v.source&&(this.tileManagers[v.source].used=!0)}for(const f in c){const v=this.tileManagers[f];!!c[f]!=!!v.used&&v.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var c;this._checkLoaded();const f=this.serialize();if(t=a.transformStyle?a.transformStyle(f,t):t,((c=a.validate)===null||c===void 0||c)&&Yl(this,l.C(t)))return!1;(t=l.bV(t)).layers=l.bS(t.layers);const v=l.bW(f,t),w=this._getOperationsToPerform(v);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const E of w.operations)E();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],c=[];for(const f of t)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(f.command)}return{operations:a,unimplemented:c}}addImage(t,a){if(this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,c={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.C.source,`sources.${t}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.tileManagers[t]=new _t(t,a,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:t}))),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new l.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.tileManagers[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,c={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new l.k(new Error(`Layer "${f}" already exists on this map.`)));let v;if(t.type==="custom"){if(Yl(this,l.bX(t)))return;v=l.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(f,t.source),t=l.bV(t),t=l.e(t,{source:f})),this._validate(l.C.layer,`layers.${f}`,t,{arrayIndex:-1},c))return;v=l.bT(t,this._globalState),this._validateLayer(v),v.setEventedParent(this,{layer:{id:f}})}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)this.fire(new l.k(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(w,0,f),this._layerOrderChanged=!0,this._layers[f]=v,this._removedLayers[f]&&v.source&&v.type!=="custom"){const E=this._removedLayers[f];delete this._removedLayers[f],E.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.tileManagers[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const c=this._order.indexOf(t);this._order.splice(c,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new l.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,c){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===a&&f.maxzoom===c||(a!=null&&(f.minzoom=a),c!=null&&(f.maxzoom=c),this._updateLayer(f)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,c={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!l.bR(f.filter,a))return a==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(l.C.filter,`layers.${f.id}.filter`,a,null,c)||(f.setFilter(l.bV(a)),this._updateLayer(f)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,c,f={}){this._checkLoaded();const v=this.getLayer(t);v?l.bR(v.getLayoutProperty(a),c)||(v.setLayoutProperty(a,c,f),this._updateLayer(v)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const c=this.getLayer(t);if(c)return c.getLayoutProperty(a);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,c,f={}){this._checkLoaded();const v=this.getLayer(t);v?l.bR(v.getPaintProperty(a),c)||this._updatePaintProperty(v,a,c,f):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,c,f={}){t.setPaintProperty(a,c,f)&&this._updateLayer(t),l.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const c=t.source,f=t.sourceLayer,v=this.tileManagers[c];if(v===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&f?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||f?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),v.setFeatureState(f,t.id,a)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const c=t.source,f=this.tileManagers[c];if(f===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const v=f.getSource().type,w=v==="vector"?t.sourceLayer:void 0;v!=="vector"||w?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(w,t.id,a):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,c=t.sourceLayer,f=this.tileManagers[a];if(f!==void 0)return f.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(c,t.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.bY(this.tileManagers,(v=>v.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,f=this.stylesheet;return l.bZ({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:t,layers:a,terrain:c},(v=>v!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=w=>this._layers[w].type==="fill-extrusion",c={},f=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E)){c[E]=w;for(const P of t){const R=P[E];if(R)for(const O of R)f.push(O)}}}f.sort(((w,E)=>E.intersectionZ-w.intersectionZ));const v=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E))for(let P=f.length-1;P>=0;P--){const R=f[P].feature;if(c[R.layer.id]<w)break;v.push(R),f.pop()}else for(const P of t){const R=P[E];if(R)for(const O of R)v.push(O.feature)}}return v}queryRenderedFeatures(t,a,c){a&&a.filter&&this._validate(l.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of a.layers){const O=this._layers[R];if(!O)return this.fire(new l.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];f[O.source]=!0}}const v=[];a.availableImages=this._availableImages;const w=this._serializedAllLayers(),E=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,P=Object.assign(Object.assign({},a),{layers:E,globalState:this._globalState});for(const R in this.tileManagers)a.layers&&!f[R]||v.push(lr(this.tileManagers[R],this._layers,w,t,P,c,this.map.terrain?(O,V,j)=>this.map.terrain.getElevation(O,V,j):void 0));return this.placement&&v.push((function(R,O,V,j,X,Q,se){const le={},oe=Q.queryRenderedSymbols(j),he=[];for(const _e of Object.keys(oe).map(Number))he.push(se[_e]);he.sort(Mn);for(const _e of he){const ce=_e.featureIndex.lookupSymbolFeatures(oe[_e.bucketInstanceId],O,_e.bucketIndex,_e.sourceLayerIndex,{filterSpec:X.filter,globalState:X.globalState},X.layers,X.availableImages,R);for(const ye in ce){const Te=le[ye]=le[ye]||[],pe=ce[ye];pe.sort(((Ce,Ge)=>{const je=_e.featureSortOrder;if(je){const Ve=je.indexOf(Ce.featureIndex);return je.indexOf(Ge.featureIndex)-Ve}return Ge.featureIndex-Ce.featureIndex}));for(const Ce of pe)Te.push(Ce)}}return(function(_e,ce,ye){for(const Te in _e)for(const pe of _e[Te])ci(pe,ye[ce[Te].source]);return _e})(le,R,V)})(this._layers,w,this.tileManagers,t,P,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,a){a?.filter&&this._validate(l.C.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.tileManagers[t];return c?(function(f,v){const w=f.getRenderableIds().map((R=>f.getTileByID(R))),E=[],P={};for(let R=0;R<w.length;R++){const O=w[R],V=O.tileID.canonical.key;P[V]||(P[V]=!0,O.querySourceFeatures(E,v))}return E})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const c=this.light.getLight();let f=!1;for(const w in t)if(!l.bR(t[w],c[w])){f=!0;break}if(!f)return;const v={now:fe(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(v)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const c=this.getSky();let f=!1;if(!t&&!c)return;if(t&&!c)f=!0;else if(!t&&c)f=!0;else for(const w in t)if(!l.bR(t[w],c[w])){f=!0;break}if(!f)return;const v={now:fe(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(v)}_setProjectionInternal(t){const a=(function(c,f){const v={constrainOverride:f};if(Array.isArray(c)){const w=new ed({type:c});return{projection:w,transform:new $l(v),cameraHelper:new Xl(w)}}switch(c){case"mercator":return{projection:new rr,transform:new Qi(v),cameraHelper:new Jo};case"globe":{const w=new ed({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new $l(v),cameraHelper:new Xl(w)}}case"vertical-perspective":return{projection:new Jh,transform:new Hl(v),cameraHelper:new Oi};default:return l.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new rr,transform:new Qi(v),cameraHelper:new Jo}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(t,a,c,f,v={}){return(!v||v.validate!==!1)&&Yl(this,t.call(l.C,l.e({key:a,style:this.serialize(),value:c,styleSpec:l.u},f)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ze().off(ue,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,c,f,v=!1){let w=!1,E=!1;const P={};for(const R of this._order){const O=this._layers[R];if(O.type!=="symbol")continue;if(!P[O.source]){const j=this.tileManagers[O.source];P[O.source]=j.getRenderableIds(!0).map((X=>j.getTileByID(X))).sort(((X,Q)=>Q.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(Q.tileID)?-1:1)))}const V=this.crossTileSymbolIndex.addLayer(O,P[O.source],t.center.lng);w=w||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(fe(),t.zoom))&&(this.pauseablePlacement=new ql(t,this.map.terrain,this._order,v,a,c,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(fe()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w)for(const R of this._order){const O=this._layers[R];O.type==="symbol"&&this.placement.updateLayerOpacities(O,P[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(fe())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(a.stacks),f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(l.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return l._(this,void 0,void 0,(function*(){const c={};for(const[f,v]of Object.entries(a.dashes))c[f]=this.lineAtlas.getDash(v.dasharray,v.round);return c}))}addSprite(t,a,c={},f){this._checkLoaded();const v=[{id:t,url:a}],w=[...ct(this.stylesheet.sprite),...v];this._validate(l.C.sprite,"sprite",w,null,c)||(this.stylesheet.sprite=w,this._loadSprite(v,!0,f))}removeSprite(t){this._checkLoaded();const a=ct(this.stylesheet.sprite);if(a.find((c=>c.id===t))){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ct(this.stylesheet.sprite)}setSprite(t,a={},c){this._checkLoaded(),t&&this._validate(l.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Ef=l.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Zc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,c,f,v,w,E,P,R){this.context=t;let O=this.boundPaintVertexBuffers.length!==f.length;for(let V=0;!O&&V<f.length;V++)this.boundPaintVertexBuffers[V]!==f[V]&&(O=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||O||this.boundIndexBuffer!==v||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==R?this.freshBind(a,c,f,v,w,E,P,R):(t.bindVertexArray.set(this.vao),E&&E.bind(),v&&v.dynamicDraw&&v.bind(),P&&P.bind(),R&&R.bind())}freshBind(t,a,c,f,v,w,E,P){const R=t.numAttributes,O=this.context,V=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=P,a.enableAttributes(V,t);for(const j of c)j.enableAttributes(V,t);w&&w.enableAttributes(V,t),E&&E.enableAttributes(V,t),P&&P.enableAttributes(V,t),a.bind(),a.setVertexAttribPointers(V,t,v);for(const j of c)j.bind(),j.setVertexAttribPointers(V,t,v);w&&(w.bind(),w.setVertexAttribPointers(V,t,v)),f&&f.bind(),E&&(E.bind(),E.setVertexAttribPointers(V,t,v)),P&&(P.bind(),P.setVertexAttribPointers(V,t,v)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Mf=(y,t,a,c,f)=>({u_texture:0,u_ele_delta:y,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):l.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):l.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),Wa={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function $u(y){const t=[];for(let a=0;a<y.length;a++){if(y[a]===null)continue;const c=y[a].split(" ");t.push(c.pop())}return t}class Af{constructor(t,a,c,f,v,w,E,P,R=[]){const O=t.gl;this.program=O.createProgram();const V=$u(a.staticAttributes),j=c?c.getBinderAttributes():[],X=V.concat(j),Q=di.prelude.staticUniforms?$u(di.prelude.staticUniforms):[],se=E.staticUniforms?$u(E.staticUniforms):[],le=a.staticUniforms?$u(a.staticUniforms):[],oe=c?c.getBinderUniforms():[],he=Q.concat(se).concat(le).concat(oe),_e=[];for(const je of he)_e.indexOf(je)<0&&_e.push(je);const ce=c?c.defines():[];Ca(O)&&ce.unshift("#version 300 es"),v&&ce.push("#define OVERDRAW_INSPECTOR;"),w&&ce.push("#define TERRAIN3D;"),P&&ce.push(P),R&&ce.push(...R);let ye=ce.concat(di.prelude.fragmentSource,E.fragmentSource,a.fragmentSource).join(`
`),Te=ce.concat(di.prelude.vertexSource,E.vertexSource,a.vertexSource).join(`
`);Ca(O)||(ye=(function(je){return je.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ye),Te=(function(je){return je.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Te));const pe=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(pe,ye),O.compileShader(pe),!O.getShaderParameter(pe,O.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${O.getShaderInfoLog(pe)}`);O.attachShader(this.program,pe);const Ce=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(Ce,Te),O.compileShader(Ce),!O.getShaderParameter(Ce,O.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${O.getShaderInfoLog(Ce)}`);O.attachShader(this.program,Ce),this.attributes={};const Ge={};this.numAttributes=X.length;for(let je=0;je<this.numAttributes;je++)X[je]&&(O.bindAttribLocation(this.program,je,X[je]),this.attributes[X[je]]=je);if(O.linkProgram(this.program),!O.getProgramParameter(this.program,O.LINK_STATUS))throw new Error(`Program failed to link: ${O.getProgramInfoLog(this.program)}`);O.deleteShader(Ce),O.deleteShader(pe);for(let je=0;je<_e.length;je++){const Ve=_e[je];if(Ve&&!Ge[Ve]){const qe=O.getUniformLocation(this.program,Ve);qe&&(Ge[Ve]=qe)}}this.fixedUniforms=f(t,Ge),this.terrainUniforms=((je,Ve)=>({u_depth:new l.b_(je,Ve.u_depth),u_terrain:new l.b_(je,Ve.u_terrain),u_terrain_dim:new l.bq(je,Ve.u_terrain_dim),u_terrain_matrix:new l.c0(je,Ve.u_terrain_matrix),u_terrain_unpack:new l.c1(je,Ve.u_terrain_unpack),u_terrain_exaggeration:new l.bq(je,Ve.u_terrain_exaggeration)}))(t,Ge),this.projectionUniforms=((je,Ve)=>({u_projection_matrix:new l.c0(je,Ve.u_projection_matrix),u_projection_tile_mercator_coords:new l.c1(je,Ve.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.c1(je,Ve.u_projection_clipping_plane),u_projection_transition:new l.bq(je,Ve.u_projection_transition),u_projection_fallback_matrix:new l.c0(je,Ve.u_projection_fallback_matrix)}))(t,Ge),this.binderUniforms=c?c.getUniforms(t,Ge):[]}draw(t,a,c,f,v,w,E,P,R,O,V,j,X,Q,se,le,oe,he,_e){const ce=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(f),t.setColorMode(v),t.setCullFace(w),P){t.activeTexture.set(ce.TEXTURE2),ce.bindTexture(ce.TEXTURE_2D,P.depthTexture),t.activeTexture.set(ce.TEXTURE3),ce.bindTexture(ce.TEXTURE_2D,P.texture);for(const Te in this.terrainUniforms)this.terrainUniforms[Te].set(P[Te])}if(R)for(const Te in R)this.projectionUniforms[Wa[Te]].set(R[Te]);if(E)for(const Te in this.fixedUniforms)this.fixedUniforms[Te].set(E[Te]);le&&le.setUniforms(t,this.binderUniforms,Q,{zoom:se});let ye=0;switch(a){case ce.LINES:ye=2;break;case ce.TRIANGLES:ye=3;break;case ce.LINE_STRIP:ye=1}for(const Te of X.get()){const pe=Te.vaos||(Te.vaos={});(pe[O]||(pe[O]=new Zc)).bind(t,this,V,le?le.getPaintVertexBuffers():[],j,Te.vertexOffset,oe,he,_e),ce.drawElements(a,Te.primitiveLength*ye,ce.UNSIGNED_SHORT,Te.primitiveOffset*ye*2)}}}function Cf(y,t,a){const c=1/l.aN(a,1,t.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,t.transform.tileZoom)/f,w=v*(a.tileID.canonical.x+a.tileID.wrap*f),E=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[w>>16,E>>16],u_pixel_coord_lower:[65535&w,65535&E]}}const Xu=(y,t,a,c)=>{const f=y.style.light,v=f.properties.get("position"),w=[v.x,v.y,v.z],E=l.c4();f.properties.get("anchor")==="viewport"&&l.c5(E,y.transform.bearingInRadians),l.c6(w,w,E);const P=y.transform.transformLightDirection(w),R=f.properties.get("color");return{u_lightpos:w,u_lightpos_globe:P,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:c}},Yu=(y,t,a,c,f,v,w)=>l.e(Xu(y,t,a,c),Cf(v,y,w),{u_height_factor:-Math.pow(2,f.overscaledZ)/w.tileSize/8}),nl=(y,t,a,c)=>l.e(Cf(t,y,a),{u_fill_translate:c}),Kl=(y,t)=>({u_world:y,u_fill_translate:t}),zf=(y,t,a,c,f)=>l.e(nl(y,t,a,f),{u_world:c}),Hc=(y,t,a,c,f)=>{const v=y.transform;let w,E,P=0;if(a.paint.get("circle-pitch-alignment")==="map"){const R=l.aN(t,1,v.zoom);w=!0,E=[R,R],P=R/(l.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*f}else w=!1,E=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E,u_globe_extrude_scale:P,u_translate:c}},wo=y=>({u_pixel_extrude_scale:[1/y.width,1/y.height]}),nd=y=>({u_viewport_size:[y.width,y.height]}),$c=(y,t=1)=>({u_color:y,u_overlay:0,u_overlay_scale:t}),To=(y,t,a,c)=>{const f=l.aN(y,1,t)/(l.a5*Math.pow(2,y.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:l.aN(y,1,t),u_intensity:a,u_globe_extrude_scale:f}},id=(y,t,a,c)=>{const f=l.N();l.c7(f,0,y.width,y.height,0,0,1);const v=y.context.gl;return{u_matrix:f,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},Xc=(y,t,a)=>{const c=a.paint.get("hillshade-accent-color");let f;switch(a.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const v=a.getIlluminationProperties();for(let w=0;w<v.directionRadians.length;w++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(v.directionRadians[w]+=y.transform.bearingInRadians);return{u_image:0,u_latrange:em(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:v.altitudeRadians,u_azimuths:v.directionRadians,u_accent:c,u_method:f,u_highlights:v.highlightColor,u_shadows:v.shadowColor}},Pf=(y,t)=>{const a=t.stride,c=l.N();return l.c7(c,0,l.a5,-l.a5,0,0,1),l.O(c,c,[0,-l.a5,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:y.overscaledZ,u_unpack:t.getUnpackVector()}};function em(y,t){const a=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new l.a9(0,c/a).toLngLat().lat,new l.a9(0,(c+1)/a).toLngLat().lat]}const Df=(y,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:y.paint.get("color-relief-opacity")}),Yc=(y,t,a,c)=>{const f=y.transform;return{u_translation:Wc(y,t,a),u_ratio:c/l.aN(t,1,f.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},If=(y,t,a,c,f)=>l.e(Yc(y,t,a,c),{u_image:0,u_image_height:f}),rd=(y,t,a,c,f)=>{const v=y.transform,w=za(t,v);return{u_translation:Wc(y,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:c/l.aN(t,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[w,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Yr=(y,t,a,c,f)=>{const v=za(t,y.transform);return l.e(Yc(y,t,a,c),{u_tileratio:v,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})},So=(y,t,a,c,f,v)=>{const w=za(t,y.transform);return l.e(Yc(y,t,a,c),{u_image:0,u_image_height:v,u_tileratio:w,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})};function za(y,t){return 1/l.aN(y,1,t.tileZoom)}function Wc(y,t,a){return l.aO(y.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Wu=(y,t,a,c,f)=>{return{u_tl_parent:y,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(w=c.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=c.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ku(c.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var v,w};function Ku(y){y*=Math.PI/180;const t=Math.sin(y),a=Math.cos(y);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Kc=(y,t,a,c,f,v,w,E,P,R,O,V,j)=>{const X=w.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:X.width/X.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:E,u_coord_matrix:P,u_is_text:+O,u_pitch_with_map:+c,u_is_along_line:f,u_is_variable_anchor:v,u_texsize:V,u_texture:0,u_translation:R,u_pitched_scale:j}},Qu=(y,t,a,c,f,v,w,E,P,R,O,V,j,X)=>{const Q=w.transform;return l.e(Kc(y,t,a,c,f,v,w,E,P,R,O,V,X),{u_gamma_scale:c?Math.cos(Q.pitch*Math.PI/180)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},Pa=(y,t,a,c,f,v,w,E,P,R,O,V,j)=>l.e(Qu(y,t,a,c,f,v,w,E,P,R,!0,O,0,j),{u_texsize_icon:V,u_texture_icon:1}),Qc=(y,t)=>({u_opacity:y,u_color:t}),Jc=(y,t,a,c,f)=>l.e((function(v,w,E,P){const R=E.imageManager.getPattern(v.from.toString()),O=E.imageManager.getPattern(v.to.toString()),{width:V,height:j}=E.imageManager.getPixelSize(),X=Math.pow(2,P.tileID.overscaledZ),Q=P.tileSize*Math.pow(2,E.transform.tileZoom)/X,se=Q*(P.tileID.canonical.x+P.tileID.wrap*X),le=Q*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[V,j],u_mix:w.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/l.aN(P,1,E.transform.tileZoom),u_pixel_coord_upper:[se>>16,le>>16],u_pixel_coord_lower:[65535&se,65535&le]}})(a,f,t,c),{u_opacity:y}),Ju=(y,t)=>{},kf={fillExtrusion:(y,t)=>({u_lightpos:new l.c2(y,t.u_lightpos),u_lightpos_globe:new l.c2(y,t.u_lightpos_globe),u_lightintensity:new l.bq(y,t.u_lightintensity),u_lightcolor:new l.c2(y,t.u_lightcolor),u_vertical_gradient:new l.bq(y,t.u_vertical_gradient),u_opacity:new l.bq(y,t.u_opacity),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillExtrusionPattern:(y,t)=>({u_lightpos:new l.c2(y,t.u_lightpos),u_lightpos_globe:new l.c2(y,t.u_lightpos_globe),u_lightintensity:new l.bq(y,t.u_lightintensity),u_lightcolor:new l.c2(y,t.u_lightcolor),u_vertical_gradient:new l.bq(y,t.u_vertical_gradient),u_height_factor:new l.bq(y,t.u_height_factor),u_opacity:new l.bq(y,t.u_opacity),u_fill_translate:new l.c3(y,t.u_fill_translate),u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade)}),fill:(y,t)=>({u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillPattern:(y,t)=>({u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillOutline:(y,t)=>({u_world:new l.c3(y,t.u_world),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillOutlinePattern:(y,t)=>({u_world:new l.c3(y,t.u_world),u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade),u_fill_translate:new l.c3(y,t.u_fill_translate)}),circle:(y,t)=>({u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_scale_with_map:new l.b_(y,t.u_scale_with_map),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_extrude_scale:new l.c3(y,t.u_extrude_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_globe_extrude_scale:new l.bq(y,t.u_globe_extrude_scale),u_translate:new l.c3(y,t.u_translate)}),collisionBox:(y,t)=>({u_pixel_extrude_scale:new l.c3(y,t.u_pixel_extrude_scale)}),collisionCircle:(y,t)=>({u_viewport_size:new l.c3(y,t.u_viewport_size)}),debug:(y,t)=>({u_color:new l.b$(y,t.u_color),u_overlay:new l.b_(y,t.u_overlay),u_overlay_scale:new l.bq(y,t.u_overlay_scale)}),depth:Ju,clippingMask:Ju,heatmap:(y,t)=>({u_extrude_scale:new l.bq(y,t.u_extrude_scale),u_intensity:new l.bq(y,t.u_intensity),u_globe_extrude_scale:new l.bq(y,t.u_globe_extrude_scale)}),heatmapTexture:(y,t)=>({u_matrix:new l.c0(y,t.u_matrix),u_world:new l.c3(y,t.u_world),u_image:new l.b_(y,t.u_image),u_color_ramp:new l.b_(y,t.u_color_ramp),u_opacity:new l.bq(y,t.u_opacity)}),hillshade:(y,t)=>({u_image:new l.b_(y,t.u_image),u_latrange:new l.c3(y,t.u_latrange),u_exaggeration:new l.bq(y,t.u_exaggeration),u_altitudes:new l.c9(y,t.u_altitudes),u_azimuths:new l.c9(y,t.u_azimuths),u_accent:new l.b$(y,t.u_accent),u_method:new l.b_(y,t.u_method),u_shadows:new l.c8(y,t.u_shadows),u_highlights:new l.c8(y,t.u_highlights)}),hillshadePrepare:(y,t)=>({u_matrix:new l.c0(y,t.u_matrix),u_image:new l.b_(y,t.u_image),u_dimension:new l.c3(y,t.u_dimension),u_zoom:new l.bq(y,t.u_zoom),u_unpack:new l.c1(y,t.u_unpack)}),colorRelief:(y,t)=>({u_image:new l.b_(y,t.u_image),u_unpack:new l.c1(y,t.u_unpack),u_dimension:new l.c3(y,t.u_dimension),u_elevation_stops:new l.b_(y,t.u_elevation_stops),u_color_stops:new l.b_(y,t.u_color_stops),u_color_ramp_size:new l.b_(y,t.u_color_ramp_size),u_opacity:new l.bq(y,t.u_opacity)}),line:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels)}),lineGradient:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_image_height:new l.bq(y,t.u_image_height)}),linePattern:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_texsize:new l.c3(y,t.u_texsize),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_image:new l.b_(y,t.u_image),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade)}),lineSDF:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_mix:new l.bq(y,t.u_mix),u_tileratio:new l.bq(y,t.u_tileratio),u_crossfade_from:new l.bq(y,t.u_crossfade_from),u_crossfade_to:new l.bq(y,t.u_crossfade_to),u_lineatlas_width:new l.bq(y,t.u_lineatlas_width),u_lineatlas_height:new l.bq(y,t.u_lineatlas_height)}),lineGradientSDF:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_image_height:new l.bq(y,t.u_image_height),u_tileratio:new l.bq(y,t.u_tileratio),u_crossfade_from:new l.bq(y,t.u_crossfade_from),u_crossfade_to:new l.bq(y,t.u_crossfade_to),u_image_dash:new l.b_(y,t.u_image_dash),u_mix:new l.bq(y,t.u_mix),u_lineatlas_width:new l.bq(y,t.u_lineatlas_width),u_lineatlas_height:new l.bq(y,t.u_lineatlas_height)}),raster:(y,t)=>({u_tl_parent:new l.c3(y,t.u_tl_parent),u_scale_parent:new l.bq(y,t.u_scale_parent),u_buffer_scale:new l.bq(y,t.u_buffer_scale),u_fade_t:new l.bq(y,t.u_fade_t),u_opacity:new l.bq(y,t.u_opacity),u_image0:new l.b_(y,t.u_image0),u_image1:new l.b_(y,t.u_image1),u_brightness_low:new l.bq(y,t.u_brightness_low),u_brightness_high:new l.bq(y,t.u_brightness_high),u_saturation_factor:new l.bq(y,t.u_saturation_factor),u_contrast_factor:new l.bq(y,t.u_contrast_factor),u_spin_weights:new l.c2(y,t.u_spin_weights),u_coords_top:new l.c1(y,t.u_coords_top),u_coords_bottom:new l.c1(y,t.u_coords_bottom)}),symbolIcon:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texture:new l.b_(y,t.u_texture),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),symbolSDF:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texture:new l.b_(y,t.u_texture),u_gamma_scale:new l.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_is_halo:new l.b_(y,t.u_is_halo),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),symbolTextAndIcon:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texsize_icon:new l.c3(y,t.u_texsize_icon),u_texture:new l.b_(y,t.u_texture),u_texture_icon:new l.b_(y,t.u_texture_icon),u_gamma_scale:new l.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_is_halo:new l.b_(y,t.u_is_halo),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),background:(y,t)=>({u_opacity:new l.bq(y,t.u_opacity),u_color:new l.b$(y,t.u_color)}),backgroundPattern:(y,t)=>({u_opacity:new l.bq(y,t.u_opacity),u_image:new l.b_(y,t.u_image),u_pattern_tl_a:new l.c3(y,t.u_pattern_tl_a),u_pattern_br_a:new l.c3(y,t.u_pattern_br_a),u_pattern_tl_b:new l.c3(y,t.u_pattern_tl_b),u_pattern_br_b:new l.c3(y,t.u_pattern_br_b),u_texsize:new l.c3(y,t.u_texsize),u_mix:new l.bq(y,t.u_mix),u_pattern_size_a:new l.c3(y,t.u_pattern_size_a),u_pattern_size_b:new l.c3(y,t.u_pattern_size_b),u_scale_a:new l.bq(y,t.u_scale_a),u_scale_b:new l.bq(y,t.u_scale_b),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bq(y,t.u_tile_units_to_pixels)}),terrain:(y,t)=>({u_texture:new l.b_(y,t.u_texture),u_ele_delta:new l.bq(y,t.u_ele_delta),u_fog_matrix:new l.c0(y,t.u_fog_matrix),u_fog_color:new l.b$(y,t.u_fog_color),u_fog_ground_blend:new l.bq(y,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bq(y,t.u_fog_ground_blend_opacity),u_horizon_color:new l.b$(y,t.u_horizon_color),u_horizon_fog_blend:new l.bq(y,t.u_horizon_fog_blend),u_is_globe_mode:new l.bq(y,t.u_is_globe_mode)}),terrainDepth:(y,t)=>({u_ele_delta:new l.bq(y,t.u_ele_delta)}),terrainCoords:(y,t)=>({u_texture:new l.b_(y,t.u_texture),u_terrain_coords_id:new l.bq(y,t.u_terrain_coords_id),u_ele_delta:new l.bq(y,t.u_ele_delta)}),projectionErrorMeasurement:(y,t)=>({u_input:new l.bq(y,t.u_input),u_output_expected:new l.bq(y,t.u_output_expected)}),atmosphere:(y,t)=>({u_sun_pos:new l.c2(y,t.u_sun_pos),u_atmosphere_blend:new l.bq(y,t.u_atmosphere_blend),u_globe_position:new l.c2(y,t.u_globe_position),u_globe_radius:new l.bq(y,t.u_globe_radius),u_inv_proj_matrix:new l.c0(y,t.u_inv_proj_matrix)}),sky:(y,t)=>({u_sky_color:new l.b$(y,t.u_sky_color),u_horizon_color:new l.b$(y,t.u_horizon_color),u_horizon:new l.c3(y,t.u_horizon),u_horizon_normal:new l.c3(y,t.u_horizon_normal),u_sky_horizon_blend:new l.bq(y,t.u_sky_horizon_blend),u_sky_blend:new l.bq(y,t.u_sky_blend)})};class il{constructor(t,a,c){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const rl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ad{constructor(t,a,c,f){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let c=0;c<this.attributes.length;c++){const f=a.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,a,c){for(let f=0;f<this.attributes.length;f++){const v=this.attributes[f],w=a.attributes[v.name];w!==void 0&&t.vertexAttribPointer(w,v.components,t[rl[v.type]],!1,this.itemSize,v.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Cn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _s extends Cn{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class eu extends Cn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class tu extends Cn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class eh extends Cn{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class al extends Cn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class nu extends Cn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ql extends Cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ha extends Cn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class sd extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class th extends Cn{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class da extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class vs extends Cn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class qr extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Hs extends Cn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class sl extends Cn{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ol extends Cn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class iu extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Eo extends Cn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Da extends Cn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class od extends Cn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Jl extends Cn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class cn extends Cn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class nh extends Cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class fa extends Cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ih extends Cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class pa extends Cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rf extends Cn{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class rh extends Cn{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const c=this.gl;Ca(c)?c.bindVertexArray(t):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Mo extends Cn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ld extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ah extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ao extends Cn{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class ec extends Ao{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Gr extends Ao{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Co extends Ao{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const zo="Framebuffer is not complete";class ll{constructor(t,a,c,f,v){this.context=t,this.width=a,this.height=c;const w=t.gl,E=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new ec(t,E),f)this.depthAttachment=v?new Co(t,E):new Gr(t,E);else if(v)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(zo)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Po{constructor(t){var a,c;if(this.gl=t,this.clearColor=new _s(this),this.clearDepth=new eu(this),this.clearStencil=new tu(this),this.colorMask=new eh(this),this.depthMask=new al(this),this.stencilMask=new nu(this),this.stencilFunc=new Ql(this),this.stencilOp=new ha(this),this.stencilTest=new sd(this),this.depthRange=new th(this),this.depthTest=new da(this),this.depthFunc=new vs(this),this.blend=new qr(this),this.blendFunc=new Hs(this),this.blendColor=new sl(this),this.blendEquation=new ol(this),this.cullFace=new iu(this),this.cullFaceSide=new Eo(this),this.frontFace=new Da(this),this.program=new od(this),this.activeTexture=new Jl(this),this.viewport=new cn(this),this.bindFramebuffer=new nh(this),this.bindRenderbuffer=new fa(this),this.bindTexture=new ih(this),this.bindVertexBuffer=new pa(this),this.bindElementBuffer=new Rf(this),this.bindVertexArray=new rh(this),this.pixelStoreUnpack=new Mo(this),this.pixelStoreUnpackPremultiplyAlpha=new ld(this),this.pixelStoreUnpackFlipY=new ah(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ca(t)){this.HALF_FLOAT=t.HALF_FLOAT;const f=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:f?.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:f?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const f=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new il(this,t,a)}createVertexBuffer(t,a,c){return new ad(this,t,a,c)}createRenderbuffer(t,a,c){const f=this.gl,v=f.createRenderbuffer();return this.bindRenderbuffer.set(v),f.renderbufferStorage(f.RENDERBUFFER,t,a,c),this.bindRenderbuffer.set(null),v}createFramebuffer(t,a,c,f){return new ll(this,t,a,c,f)}clear({color:t,depth:a,stencil:c}){const f=this.gl;let v=0;t&&(v|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(v|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(v|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),f.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.bR(t.blendFunction,Vn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ca(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Ca(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let ar;function fr(y,t,a,c,f){const v=y.context,w=y.transform,E=v.gl,P=y.useProgram("collisionBox"),R=[];let O=0,V=0;for(let oe=0;oe<c.length;oe++){const he=c[oe],_e=t.getTile(he).getBucket(a);if(!_e)continue;const ce=f?_e.textCollisionBox:_e.iconCollisionBox,ye=_e.collisionCircleArray;ye.length>0&&(R.push({circleArray:ye,circleOffset:V,coord:he}),O+=ye.length/4,V=O),ce&&P.draw(v,E.LINES,on.disabled,bn.disabled,y.colorModeForRenderPass(),pn.disabled,wo(y.transform),y.style.map.terrain&&y.style.map.terrain.getTerrainData(he),w.getProjectionData({overscaledTileID:he,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,null,y.transform.zoom,null,null,ce.collisionVertexBuffer)}if(!f||!R.length)return;const j=y.useProgram("collisionCircle"),X=new l.ca;X.resize(4*O),X._trim();let Q=0;for(const oe of R)for(let he=0;he<oe.circleArray.length/4;he++){const _e=4*he,ce=oe.circleArray[_e+0],ye=oe.circleArray[_e+1],Te=oe.circleArray[_e+2],pe=oe.circleArray[_e+3];X.emplace(Q++,ce,ye,Te,pe,0),X.emplace(Q++,ce,ye,Te,pe,1),X.emplace(Q++,ce,ye,Te,pe,2),X.emplace(Q++,ce,ye,Te,pe,3)}(!ar||ar.length<2*O)&&(ar=(function(oe){const he=2*oe,_e=new l.cc;_e.resize(he),_e._trim();for(let ce=0;ce<he;ce++){const ye=6*ce;_e.uint16[ye+0]=4*ce+0,_e.uint16[ye+1]=4*ce+1,_e.uint16[ye+2]=4*ce+2,_e.uint16[ye+3]=4*ce+2,_e.uint16[ye+4]=4*ce+3,_e.uint16[ye+5]=4*ce+0}return _e})(O));const se=v.createIndexBuffer(ar,!0),le=v.createVertexBuffer(X,l.cb.members,!0);for(const oe of R){const he=nd(y.transform);j.draw(v,E.TRIANGLES,on.disabled,bn.disabled,y.colorModeForRenderPass(),pn.disabled,he,y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe.coord),null,a.id,le,se,l.aX.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,y.transform.zoom,null,null,null)}le.destroy(),se.destroy()}const xs=l.ar(new Float32Array(16));function bs(y,t,a,c,f,v){const{horizontalAlign:w,verticalAlign:E}=l.aS(y);return new l.P((-(w-.5)*t/f+c[0])*v,(-(E-.5)*a/f+c[1])*v)}function Wr(y,t,a,c,f,v){const w=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let E=c.mult(v);a||(E=E.rotate(-f));const P=w.add(E);return en(P.x,P.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const E=xn(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(y),P=Math.atan(E.y/E.x)+(E.x<0?Math.PI:0);return y.add(c.rotate(P))}return y.add(c)}function $s(y,t,a,c,f,v,w,E,P,R,O,V){const j=y.text.placedSymbolArray,X=y.text.dynamicLayoutVertexArray,Q=y.icon.dynamicLayoutVertexArray,se={};X.clear();for(let le=0;le<j.length;le++){const oe=j.get(le),he=oe.hidden||!oe.crossTileID||y.allowVerticalPlacement&&!oe.placedOrientation?null:c[oe.crossTileID];if(he){const _e=new l.P(oe.anchorX,oe.anchorY),ce={getElevation:V,width:f.width,height:f.height,pitchedLabelPlaneMatrix:v,pitchWithMap:a,transform:f,tileAnchorPoint:_e,translation:R,unwrappedTileID:O},ye=a?jl(_e.x,_e.y,ce):xn(_e.x,_e.y,ce),Te=$o(f.cameraToCenterDistance,ye.signedDistanceFromCamera);let pe=l.aA(y.textSizeData,E,oe)*Te/l.aM;a&&(pe*=y.tilePixelRatio/w);const{width:Ce,height:Ge,anchor:je,textOffset:Ve,textBoxScale:qe}=he,St=bs(je,Ce,Ge,Ve,qe,pe),At=f.getPitchedTextCorrection(_e.x+R[0],_e.y+R[1],O),ft=Wr(ye.point,ce,t,St,-f.bearingInRadians,At),Pt=y.allowVerticalPlacement&&oe.placedOrientation===l.az.vertical?Math.PI/2:0;for(let sn=0;sn<oe.numGlyphs;sn++)l.aG(X,ft,Pt);P&&oe.associatedIconIndex>=0&&(se[oe.associatedIconIndex]={shiftedAnchor:ft,angle:Pt})}else ms(oe.numGlyphs,X)}if(P){Q.clear();const le=y.icon.placedSymbolArray;for(let oe=0;oe<le.length;oe++){const he=le.get(oe);if(he.hidden)ms(he.numGlyphs,Q);else{const _e=se[oe];if(_e)for(let ce=0;ce<he.numGlyphs;ce++)l.aG(Q,_e.shiftedAnchor,_e.angle);else ms(he.numGlyphs,Q)}}y.icon.dynamicLayoutVertexBuffer.updateData(Q)}y.text.dynamicLayoutVertexBuffer.updateData(X)}function cd(y,t,a){return a.iconsInText&&t?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function cl(y,t,a,c,f,v,w,E,P,R,O,V,j){const X=y.context,Q=X.gl,se=y.transform,le=E==="map",oe=P==="map",he=E!=="viewport"&&a.layout.get("symbol-placement")!=="point",_e=le&&!oe&&!he,ce=!a.layout.get("symbol-sort-key").isConstant();let ye=!1;const Te=y.getDepthModeForSublayer(0,on.ReadOnly),pe=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ce=[],Ge=se.getCircleRadiusCorrection();for(const je of c){const Ve=t.getTile(je),qe=Ve.getBucket(a);if(!qe)continue;const St=f?qe.text:qe.icon;if(!St||!St.segments.get().length||!St.hasVisibleVertices)continue;const At=St.programConfigurations.get(a.id),ft=f||qe.sdfIcons,Pt=f?qe.textSizeData:qe.iconSizeData,sn=oe||se.pitch!==0,Nn=y.useProgram(cd(ft,f,qe),At),ei=l.ay(Pt,se.zoom),Yn=y.style.map.terrain&&y.style.map.terrain.getTerrainData(je);let oi,qn,bi,li,mr=[0,0],Ci=null;if(f)qn=Ve.glyphAtlasTexture,bi=Q.LINEAR,oi=Ve.glyphAtlasTexture.size,qe.iconsInText&&(mr=Ve.imageAtlasTexture.size,Ci=Ve.imageAtlasTexture,li=sn||y.options.rotating||y.options.zooming||Pt.kind==="composite"||Pt.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const jn=a.layout.get("icon-size").constantOr(0)!==1||qe.iconsNeedLinear;qn=Ve.imageAtlasTexture,bi=ft||y.options.rotating||y.options.zooming||jn||sn?Q.LINEAR:Q.NEAREST,oi=Ve.imageAtlasTexture.size}const zi=l.aN(Ve,1,y.transform.zoom),gr=ni(le,y.transform,zi),Rs=l.N();l.aB(Rs,gr);const Ls=Vi(oe,le,y.transform,zi),is=l.aO(se,Ve,v,w),ea=se.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),_l=pe&&qe.hasTextData(),uc=a.layout.get("icon-text-fit")!=="none"&&_l&&qe.hasIconData();if(he){const jn=y.style.map.terrain?(Zi,Ji)=>y.style.map.terrain.getElevation(je,Zi,Ji):null,Wn=a.layout.get("text-rotation-alignment")==="map";qs(qe,y,f,gr,Rs,oe,R,Wn,je.toUnwrapped(),se.width,se.height,is,jn)}const rs=f&&pe||uc,ta=he||rs?xs:oe?gr:y.transform.clipSpaceToPixelsMatrix,va=ft&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ba;Ba=ft?qe.iconsInText?Pa(Pt.kind,ei,_e,oe,he,rs,y,ta,Ls,is,oi,mr,Ge):Qu(Pt.kind,ei,_e,oe,he,rs,y,ta,Ls,is,f,oi,0,Ge):Kc(Pt.kind,ei,_e,oe,he,rs,y,ta,Ls,is,f,oi,Ge);const Na={program:Nn,buffers:St,uniformValues:Ba,projectionData:ea,atlasTexture:qn,atlasTextureIcon:Ci,atlasInterpolation:bi,atlasInterpolationIcon:li,isSDF:ft,hasHalo:va};if(ce&&qe.canOverlap){ye=!0;const jn=St.segments.get();for(const Wn of jn)Ce.push({segments:new l.aX([Wn]),sortKey:Wn.sortKey,state:Na,terrainData:Yn})}else Ce.push({segments:St.segments,sortKey:0,state:Na,terrainData:Yn})}ye&&Ce.sort(((je,Ve)=>je.sortKey-Ve.sortKey));for(const je of Ce){const Ve=je.state;if(X.activeTexture.set(Q.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,Q.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(X.activeTexture.set(Q.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Ve.isSDF){const qe=Ve.uniformValues;Ve.hasHalo&&(qe.u_is_halo=1,tc(Ve.buffers,je.segments,a,y,Ve.program,Te,O,V,qe,Ve.projectionData,je.terrainData)),qe.u_is_halo=0}tc(Ve.buffers,je.segments,a,y,Ve.program,Te,O,V,Ve.uniformValues,Ve.projectionData,je.terrainData)}}function tc(y,t,a,c,f,v,w,E,P,R,O){const V=c.context;f.draw(V,V.gl.TRIANGLES,v,w,E,pn.backCCW,P,O,R,a.id,y.layoutVertexBuffer,y.indexBuffer,t,a.paint,c.transform.zoom,y.programConfigurations.get(a.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function ud(y,t,a,c,f){const v=y.context,w=v.gl,E=bn.disabled,P=new Vn([w.ONE,w.ONE],l.bp.transparent,[!0,!0,!0,!0]),R=t.getBucket(a);if(!R)return;const O=c.key;let V=a.heatmapFbos.get(O);V||(V=Xn(v,t.tileSize,t.tileSize),a.heatmapFbos.set(O,V)),v.bindFramebuffer.set(V.framebuffer),v.viewport.set([0,0,t.tileSize,t.tileSize]),v.clear({color:l.bp.transparent});const j=R.programConfigurations.get(a.id),X=y.useProgram("heatmap",j,!f),Q=y.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=y.style.map.terrain.getTerrainData(c);X.draw(v,w.TRIANGLES,on.disabled,E,P,pn.disabled,To(t,y.transform.zoom,a.paint.get("heatmap-intensity"),1),se,Q,a.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,a.paint,y.transform.zoom,j)}function pr(y,t,a,c,f){const v=y.context,w=v.gl,E=y.transform;v.setColorMode(y.colorModeForRenderPass());const P=vn(v,t),R=a.key,O=t.heatmapFbos.get(R);if(!O)return;v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,O.colorAttachment.get()),v.activeTexture.set(w.TEXTURE1),P.bind(w.LINEAR,w.CLAMP_TO_EDGE);const V=E.getProjectionData({overscaledTileID:a,applyTerrainMatrix:f,applyGlobeMatrix:!c});y.useProgram("heatmapTexture").draw(v,w.TRIANGLES,on.disabled,bn.disabled,y.colorModeForRenderPass(),pn.disabled,id(y,t,0,1),null,V,t.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,t.paint,E.zoom),O.destroy(),t.heatmapFbos.delete(R)}function Xn(y,t,a){var c,f;const v=y.gl,w=v.createTexture();v.bindTexture(v.TEXTURE_2D,w),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const E=(c=y.HALF_FLOAT)!==null&&c!==void 0?c:v.UNSIGNED_BYTE,P=(f=y.RGBA16F)!==null&&f!==void 0?f:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,P,t,a,0,v.RGBA,E,null);const R=y.createFramebuffer(t,a,!1,!1);return R.colorAttachment.set(w),R}function vn(y,t){return t.colorRampTexture||(t.colorRampTexture=new l.T(y,t.colorRamp,y.gl.RGBA)),t.colorRampTexture}function Xs(y,t,a,c,f,v,w,E){let P=256;if(f.stepInterpolant){const R=t.getSource().maxzoom,O=w.canonical.z===R?Math.ceil(1<<y.transform.maxZoom-w.canonical.z):1;P=l.an(l.ce(v.maxLineLength/l.a5*1024*O),256,a.maxTextureSize)}return E.gradient=l.cf({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:P,image:E.gradient||void 0,clips:v.lineClipsArray}),E.texture?E.texture.update(E.gradient):E.texture=new l.T(a,E.gradient,c.RGBA),E.version=f.gradientVersion,E.texture}function ma(y,t,a,c,f){y.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),c.updatePaintBuffers(f)}function vi(y,t,a,c,f,v){(f||y.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),y.lineAtlas.bind(t)),c.updatePaintBuffers(v)}function Kr(y,t,a,c,f,v,w){const E=v.gradients[f.id];let P=E.texture;f.gradientVersion!==E.version&&(P=Xs(y,t,a,c,f,v,w,E)),a.activeTexture.set(c.TEXTURE0),P.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function Qr(y,t,a,c,f,v,w,E,P){const R=v.gradients[f.id];let O=R.texture;f.gradientVersion!==R.version&&(O=Xs(y,t,a,c,f,v,w,R)),a.activeTexture.set(c.TEXTURE0),O.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),y.lineAtlas.bind(a),E.updatePaintBuffers(P)}function ru(y,t,a,c,f){if(!a||!c||!c.imageAtlas)return;const v=c.imageAtlas.patternPositions;let w=v[a.to.toString()],E=v[a.from.toString()];if(!w&&E&&(w=E),!E&&w&&(E=w),!w||!E){const P=f.getPaintProperty(t);w=v[P],E=v[P]}w&&E&&y.setConstantPatternPositions(w,E)}function ws(y,t,a,c,f,v,w,E){const P=y.context.gl,R="fill-pattern",O=a.paint.get(R),V=O&&O.constantOr(1),j=a.getCrossfadeParameters();let X,Q,se,le,oe;const he=y.transform,_e=a.paint.get("fill-translate"),ce=a.paint.get("fill-translate-anchor");w?(Q=V&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=P.LINES):(Q=V?"fillPattern":"fill",X=P.TRIANGLES);const ye=O.constantOr(null);for(const Te of c){const pe=t.getTile(Te);if(V&&!pe.patternsLoaded())continue;const Ce=pe.getBucket(a);if(!Ce)continue;const Ge=Ce.programConfigurations.get(a.id),je=y.useProgram(Q,Ge),Ve=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Te);V&&(y.context.activeTexture.set(P.TEXTURE0),pe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ge.updatePaintBuffers(j)),ru(Ge,R,ye,pe,a);const qe=he.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),St=l.aO(he,pe,_e,ce);if(w){le=Ce.indexBuffer2,oe=Ce.segments2;const ft=[P.drawingBufferWidth,P.drawingBufferHeight];se=Q==="fillOutlinePattern"&&V?zf(y,j,pe,ft,St):Kl(ft,St)}else le=Ce.indexBuffer,oe=Ce.segments,se=V?nl(y,j,pe,St):{u_fill_translate:St};const At=y.stencilModeForClipping(Te);je.draw(y.context,X,f,At,v,pn.backCCW,se,Ve,qe,a.id,Ce.layoutVertexBuffer,le,oe,a.paint,y.transform.zoom,Ge)}}function Ts(y,t,a,c,f,v,w,E){const P=y.context,R=P.gl,O="fill-extrusion-pattern",V=a.paint.get(O),j=V.constantOr(1),X=a.getCrossfadeParameters(),Q=a.paint.get("fill-extrusion-opacity"),se=V.constantOr(null),le=y.transform;for(const oe of c){const he=t.getTile(oe),_e=he.getBucket(a);if(!_e)continue;const ce=y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe),ye=_e.programConfigurations.get(a.id),Te=y.useProgram(j?"fillExtrusionPattern":"fillExtrusion",ye);j&&(y.context.activeTexture.set(R.TEXTURE0),he.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ye.updatePaintBuffers(X));const pe=le.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!E,applyTerrainMatrix:!0});ru(ye,O,se,he,a);const Ce=l.aO(le,he,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ge=a.paint.get("fill-extrusion-vertical-gradient"),je=j?Yu(y,Ge,Q,Ce,oe,X,he):Xu(y,Ge,Q,Ce);Te.draw(P,P.gl.TRIANGLES,f,v,w,pn.backCCW,je,ce,pe,a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,a.paint,y.transform.zoom,ye,y.style.map.terrain&&_e.centroidVertexBuffer)}}function Ss(y,t,a,c,f,v,w,E,P){var R;const O=y.style.projection,V=y.context,j=y.transform,X=V.gl,Q=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],se=y.useProgram("hillshade",null,!1,Q),le=!y.options.moving;for(const oe of c){const he=t.getTile(oe),_e=he.fbo;if(!_e)continue;const ce=O.getMeshFromTileID(V,oe.canonical,E,!0,"raster"),ye=(R=y.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(oe);V.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,_e.colorAttachment.get());const Te=j.getProjectionData({overscaledTileID:oe,aligned:le,applyGlobeMatrix:!P,applyTerrainMatrix:!0});se.draw(V,X.TRIANGLES,v,f[oe.overscaledZ],w,pn.backCCW,Xc(y,he,a),ye,Te,a.id,ce.vertexBuffer,ce.indexBuffer,ce.segments)}}function Ys(y,t,a,c,f,v,w,E,P){var R;const O=y.style.projection,V=y.context,j=y.transform,X=V.gl,Q=y.useProgram("colorRelief"),se=!y.options.moving;let le=!0,oe=0;for(const he of c){const _e=t.getTile(he),ce=_e.dem;if(le){const je=X.getParameter(X.MAX_TEXTURE_SIZE),{elevationTexture:Ve,colorTexture:qe}=a.getColorRampTextures(V,je,ce.getUnpackVector());V.activeTexture.set(X.TEXTURE1),Ve.bind(X.NEAREST,X.CLAMP_TO_EDGE),V.activeTexture.set(X.TEXTURE4),qe.bind(X.LINEAR,X.CLAMP_TO_EDGE),le=!1,oe=Ve.size[0]}if(!ce||!ce.data)continue;const ye=ce.stride,Te=ce.getPixels();if(V.activeTexture.set(X.TEXTURE0),V.pixelStoreUnpackPremultiplyAlpha.set(!1),_e.demTexture=_e.demTexture||y.getTileTexture(ye),_e.demTexture){const je=_e.demTexture;je.update(Te,{premultiply:!1}),je.bind(X.LINEAR,X.CLAMP_TO_EDGE)}else _e.demTexture=new l.T(V,Te,X.RGBA,{premultiply:!1}),_e.demTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const pe=O.getMeshFromTileID(V,he.canonical,E,!0,"raster"),Ce=(R=y.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(he),Ge=j.getProjectionData({overscaledTileID:he,aligned:se,applyGlobeMatrix:!P,applyTerrainMatrix:!0});Q.draw(V,X.TRIANGLES,v,f[he.overscaledZ],w,pn.backCCW,Df(a,_e.dem,oe),Ce,Ge,a.id,pe.vertexBuffer,pe.indexBuffer,pe.segments)}}const Ws=[new l.P(0,0),new l.P(l.a5,0),new l.P(l.a5,l.a5),new l.P(0,l.a5)];function Ia(y,t,a,c,f,v,w,E,P=!1,R=!1){const O=c[c.length-1].overscaledZ,V=y.context,j=V.gl,X=y.useProgram("raster"),Q=y.transform,se=y.style.projection,le=y.colorModeForRenderPass(),oe=!y.options.moving,he=a.paint.get("raster-opacity"),_e=a.paint.get("raster-resampling"),ce=a.paint.get("raster-fade-duration"),ye=!!y.style.map.terrain;for(const Te of c){const pe=y.getDepthModeForSublayer(Te.overscaledZ-O,he===1?on.ReadWrite:on.ReadOnly,j.LESS),Ce=t.getTile(Te),Ge=_e==="nearest"?j.NEAREST:j.LINEAR;V.activeTexture.set(j.TEXTURE0),Ce.texture.bind(Ge,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),V.activeTexture.set(j.TEXTURE1);const{parentTile:je,parentScaleBy:Ve,parentTopLeft:qe,fadeValues:St}=Es(Ce,t,ce,ye);Ce.fadeOpacity=St.tileOpacity,je?(je.fadeOpacity=St.parentTileOpacity,je.texture.bind(Ge,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST)):Ce.texture.bind(Ge,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),Ce.texture.useMipmap&&V.extTextureFilterAnisotropic&&y.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const At=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Te),ft=Q.getProjectionData({overscaledTileID:Te,aligned:oe,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Pt=Wu(qe,Ve,St.fadeMix,a,E),sn=se.getMeshFromTileID(V,Te.canonical,v,w,"raster");X.draw(V,j.TRIANGLES,pe,f?f[Te.overscaledZ]:bn.disabled,le,P?pn.frontCCW:pn.backCCW,Pt,At,ft,a.id,sn.vertexBuffer,sn.indexBuffer,sn.segments)}}function Es(y,t,a,c){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return f;if(y.fadingParentID){const v=t.getLoadedTile(y.fadingParentID);if(!v)return f;const w=Math.pow(2,v.tileID.overscaledZ-y.tileID.overscaledZ),E=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1],P=(function(R,O,V){const j=fe(),X=(j-O.timeAdded)/V,Q=R.fadingDirection===De.Incoming,se=l.an((j-R.timeAdded)/V,0,1),le=l.an(1-X,0,1),oe=Q?se:le;return{tileOpacity:oe,parentTileOpacity:Q?le:se,fadeMix:{opacity:1,mix:1-oe}}})(y,v,a);return{parentTile:v,parentScaleBy:w,parentTopLeft:E,fadeValues:P}}if(y.selfFading){const v=(function(w,E){const P=(fe()-w.timeAdded)/E,R=l.an(P,0,1);return{tileOpacity:R,fadeMix:{opacity:R,mix:0}}})(y,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:v}}return f}const Ks=new l.bp(1,0,0,1),Ms=new l.bp(0,1,0,1),sh=new l.bp(0,0,1,1),oh=new l.bp(1,0,1,1),ga=new l.bp(0,1,1,1);function nc(y,t,a,c){Gi(y,0,t+a/2,y.transform.width,a,c)}function Qs(y,t,a,c){Gi(y,t-a/2,0,a,y.transform.height,c)}function Gi(y,t,a,c,f,v){const w=y.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*y.pixelRatio,a*y.pixelRatio,c*y.pixelRatio,f*y.pixelRatio),w.clear({color:v}),E.disable(E.SCISSOR_TEST)}function au(y,t,a){const c=y.context,f=c.gl,v=y.useProgram("debug"),w=on.disabled,E=bn.disabled,P=y.colorModeForRenderPass(),R="$debug",O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);c.activeTexture.set(f.TEXTURE0);const V=t.getTileByID(a.key).latestRawTileData,j=Math.floor((V&&V.byteLength||0)/1024),X=t.getTile(a).tileSize,Q=512/Math.min(X,512)*(a.overscaledZ/y.transform.zoom)*.5;let se=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(se+=` => ${a.overscaledZ}`),(function(oe,he){oe.initDebugOverlayCanvas();const _e=oe.debugOverlayCanvas,ce=oe.context.gl,ye=oe.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,_e.width,_e.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(he,5,5),ye.strokeText(he,5,5),oe.debugOverlayTexture.update(_e),oe.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)})(y,`${se} ${j}kB`);const le=y.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(c,f.TRIANGLES,w,E,Vn.alphaBlended,pn.disabled,$c(l.bp.transparent,Q),null,le,R,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),v.draw(c,f.LINE_STRIP,w,E,P,pn.disabled,$c(l.bp.red),O,le,R,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function lh(y,t,a,c){const{isRenderingGlobe:f}=c,v=y.context,w=v.gl,E=y.transform,P=y.colorModeForRenderPass(),R=y.getDepthModeFor3D(),O=y.useProgram("terrain");v.bindFramebuffer.set(null),v.viewport.set([0,0,y.width,y.height]);for(const V of a){const j=t.getTerrainMesh(V.tileID),X=y.renderToTexture.getTexture(V),Q=t.getTerrainData(V.tileID);v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,X.texture);const se=t.getMeshFrameDelta(E.zoom),le=E.calculateFogMatrix(V.tileID.toUnwrapped()),oe=Mf(se,le,y.style.sky,E.pitch,f),he=E.getProjectionData({overscaledTileID:V.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(v,w.TRIANGLES,R,bn.disabled,P,pn.backCCW,oe,Q,he,"terrain",j.vertexBuffer,j.indexBuffer,j.segments)}}function hd(y,t){if(!t.mesh){const a=new l.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const c=new l.aY;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new $n(y.createVertexBuffer(a,Aa.members),y.createIndexBuffer(c),l.aX.simpleSegment(0,0,a.length,c.length))}return t.mesh}class Lf{constructor(t,a){this.context=new Po(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=_t.maxOverzooming+_t.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ir}resize(t,a,c){if(this.width=Math.floor(t*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,a=new l.aW;a.emplaceBack(0,0),a.emplaceBack(l.a5,0),a.emplaceBack(0,l.a5),a.emplaceBack(l.a5,l.a5),this.tileExtentBuffer=t.createVertexBuffer(a,Aa.members),this.tileExtentSegments=l.aX.simpleSegment(0,0,4,2);const c=new l.aW;c.emplaceBack(0,0),c.emplaceBack(l.a5,0),c.emplaceBack(0,l.a5),c.emplaceBack(l.a5,l.a5),this.debugBuffer=t.createVertexBuffer(c,Aa.members),this.debugSegments=l.aX.simpleSegment(0,0,4,5);const f=new l.ch;f.emplaceBack(0,0,0,0),f.emplaceBack(l.a5,0,l.a5,0),f.emplaceBack(0,l.a5,0,l.a5),f.emplaceBack(l.a5,l.a5,l.a5,l.a5),this.rasterBoundsBuffer=t.createVertexBuffer(f,Ef.members),this.rasterBoundsSegments=l.aX.simpleSegment(0,0,4,2);const v=new l.aW;v.emplaceBack(0,0),v.emplaceBack(l.a5,0),v.emplaceBack(0,l.a5),v.emplaceBack(l.a5,l.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(v,Aa.members),this.rasterBoundsSegmentsPosOnly=l.aX.simpleSegment(0,0,4,5);const w=new l.aW;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,Aa.members),this.viewportSegments=l.aX.simpleSegment(0,0,4,2);const E=new l.ci;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(E);const P=new l.aY;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(P);const R=this.context.gl;this.stencilClearMode=new bn({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new $n(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=l.N();l.c7(c,0,this.width,this.height,0,0,1),l.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const f={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,on.disabled,this.stencilClearMode,Vn.disabled,pn.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const f=this.context;f.setColorMode(Vn.disabled),f.setDepthMode(on.disabled);const v={};for(const w of a)v[w.key]=this.nextStencilID++;this._renderTileMasks(v,a,c,!0),this._renderTileMasks(v,a,c,!1),this._tileClippingMaskIDs=v}_renderTileMasks(t,a,c,f){const v=this.context,w=v.gl,E=this.style.projection,P=this.transform,R=this.useProgram("clippingMask");for(const O of a){const V=t[O.key],j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),X=E.getMeshFromTileID(this.context,O.canonical,f,!0,"stencil"),Q=P.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!c,applyTerrainMatrix:!0});R.draw(v,w.TRIANGLES,on.disabled,new bn({func:w.ALWAYS,mask:0},V,255,w.KEEP,w.KEEP,w.REPLACE),Vn.disabled,c?pn.disabled:pn.backCCW,null,j,Q,"$clipping",X.vertexBuffer,X.indexBuffer,X.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,c=this.style.projection,f=this.transform,v=this.useProgram("depth"),w=this.getDepthModeFor3D(),E=hi(f,{tileSize:f.tileSize});for(const P of E){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),O=c.getMeshFromTileID(this.context,P.canonical,!0,!0,"raster"),V=f.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(t,a.TRIANGLES,w,bn.disabled,Vn.disabled,pn.backCCW,null,R,V,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new bn({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new bn({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,c=t.sort(((w,E)=>E.overscaledZ-w.overscaledZ)),f=c[c.length-1].overscaledZ,v=c[0].overscaledZ-f+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let E=0;E<v;E++)w[E+f]=new bn({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[w,c]}return[{[f]:bn.disabled},c]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,c=t.sort(((w,E)=>E.overscaledZ-w.overscaledZ)),f=c[c.length-1].overscaledZ,v=c[0].overscaledZ-f+1;if(this.clearStencil(),v>1){const w={},E={};for(let P=0;P<v;P++)w[P+f]=new bn({func:a.GREATER,mask:255},v+1+P,255,a.KEEP,a.KEEP,a.REPLACE),E[P+f]=new bn({func:a.GREATER,mask:255},1+P,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*v+1,[w,E,c]}return this.nextStencilID=3,[{[f]:new bn({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[f]:new bn({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Vn([t.CONSTANT_COLOR,t.ONE],new l.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vn.unblended:Vn.alphaBlended}getDepthModeForSublayer(t,a,c){if(!this.opaquePassEnabledForLayer())return on.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new on(c||this.context.gl.LEQUAL,a,[f,f])}getDepthModeFor3D(){return new on(this.context.gl.LEQUAL,on.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var c,f;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(fe()),this.imageManager.beginFrame();const v=this.style._order,w=this.style.tileManagers,E={},P={},R={},O={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const j in w){const X=w[j];X.used&&X.prepare(this.context),E[j]=X.getVisibleCoordinates(!1),P[j]=E[j].slice().reverse(),R[j]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<v.length;j++)if(this.style._layers[v[j]].is3D()){this.opaquePassCutoff=j;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const j of v){const X=this.style._layers[j];if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const Q=P[X.source];(X.type==="custom"||Q.length)&&this.renderLayer(this,w[X.source],X,Q,O)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:j=>this.useProgram(j)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?l.bp.black:l.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(j,X){const Q=j.context,se=Q.gl,le=((Te,pe,Ce)=>{const Ge=Math.cos(pe.rollInRadians),je=Math.sin(pe.rollInRadians),Ve=yn(pe),qe=pe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Te.properties.get("sky-color"),u_horizon_color:Te.properties.get("horizon-color"),u_horizon:[(pe.width/2-Ve*je)*Ce,(pe.height/2+Ve*Ge)*Ce],u_horizon_normal:[-je,Ge],u_sky_horizon_blend:Te.properties.get("sky-horizon-blend")*pe.height/2*Ce,u_sky_blend:qe}})(X,j.style.map.transform,j.pixelRatio),oe=new on(se.LEQUAL,on.ReadWrite,[0,1]),he=bn.disabled,_e=j.colorModeForRenderPass(),ce=j.useProgram("sky"),ye=hd(Q,X);ce.draw(Q,se.TRIANGLES,oe,he,_e,pn.disabled,le,null,void 0,"sky",ye.vertexBuffer,ye.indexBuffer,ye.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[v[this.currentLayer]],X=w[j.source],Q=E[j.source];this._renderTileClippingMasks(j,Q,!1),this.renderLayer(this,X,j,Q,O)}this.renderPass="translucent";let V=!1;for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const j=this.style._layers[v[this.currentLayer]],X=w[j.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(j,O))continue;this.opaquePassEnabledForLayer()||V||(V=!0,O.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Q=(j.type==="symbol"?R:P)[j.source];this._renderTileClippingMasks(j,E[j.source],!!this.renderToTexture),this.renderLayer(this,X,j,Q,O)}if(O.isRenderingGlobe&&(function(j,X,Q){const se=j.context,le=se.gl,oe=j.useProgram("atmosphere"),he=new on(le.LEQUAL,on.ReadOnly,[0,1]),_e=j.transform,ce=(function(qe,St){const At=qe.properties.get("position"),ft=[-At.x,-At.y,-At.z],Pt=l.ar(new Float64Array(16));return qe.properties.get("anchor")==="map"&&(l.bg(Pt,Pt,St.rollInRadians),l.bh(Pt,Pt,-St.pitchInRadians),l.bg(Pt,Pt,St.bearingInRadians),l.bh(Pt,Pt,St.center.lat*Math.PI/180),l.bJ(Pt,Pt,-St.center.lng*Math.PI/180)),l.cg(ft,ft,Pt),ft})(Q,j.transform),ye=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Te=X.properties.get("atmosphere-blend")*ye.projectionTransition;if(Te===0)return;const pe=tl(_e.worldSize,_e.center.lat),Ce=_e.inverseProjectionMatrix,Ge=new Float64Array(4);Ge[3]=1,l.aH(Ge,Ge,_e.modelViewProjectionMatrix),Ge[0]/=Ge[3],Ge[1]/=Ge[3],Ge[2]/=Ge[3],Ge[3]=1,l.aH(Ge,Ge,Ce),Ge[0]/=Ge[3],Ge[1]/=Ge[3],Ge[2]/=Ge[3],Ge[3]=1;const je=((qe,St,At,ft,Pt)=>({u_sun_pos:qe,u_atmosphere_blend:St,u_globe_position:At,u_globe_radius:ft,u_inv_proj_matrix:Pt}))(ce,Te,[Ge[0],Ge[1],Ge[2]],pe,Ce),Ve=hd(se,X);oe.draw(se,le.TRIANGLES,he,bn.disabled,Vn.alphaBlended,pn.disabled,je,null,null,"atmosphere",Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const j=(function(X,Q){let se=null;const le=Object.values(X._layers).flatMap((ce=>ce.source&&!ce.isHidden(Q)?[X.tileManagers[ce.source]]:[])),oe=le.filter((ce=>ce.getSource().type==="vector")),he=le.filter((ce=>ce.getSource().type!=="vector")),_e=ce=>{(!se||se.getSource().maxzoom<ce.getSource().maxzoom)&&(se=ce)};return oe.forEach((ce=>_e(ce))),se||he.forEach((ce=>_e(ce))),se})(this.style,this.transform.zoom);j&&(function(X,Q,se){for(let le=0;le<se.length;le++)au(X,Q,se[le])})(this,j,j.getVisibleCoordinates())}this.options.showPadding&&(function(j){const X=j.transform.padding;nc(j,j.transform.height-(X.top||0),3,Ks),nc(j,X.bottom||0,3,Ms),Qs(j,X.left||0,3,sh),Qs(j,j.transform.width-(X.right||0),3,oh);const Q=j.transform.centerPoint;(function(se,le,oe,he){Gi(se,le-1,oe-10,2,20,he),Gi(se,le-10,oe-1,20,2,he)})(j,Q.x,j.transform.height-Q.y,ga)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=t?!l.cj(a,c):!l.ck(a,c)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(l.cl(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(v,w){const E=v.context,P=E.gl,R=v.transform,O=Vn.unblended,V=new on(P.LEQUAL,on.ReadWrite,[0,1]),j=w.tileManager.getRenderableTiles(),X=v.useProgram("terrainDepth");E.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),E.clear({color:l.bp.transparent,depth:1});for(const Q of j){const se=w.getTerrainMesh(Q.tileID),le=w.getTerrainData(Q.tileID),oe=R.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),he={u_ele_delta:w.getMeshFrameDelta(R.zoom)};X.draw(E,P.TRIANGLES,V,bn.disabled,O,pn.backCCW,he,le,oe,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain),(function(v,w){const E=v.context,P=E.gl,R=v.transform,O=Vn.unblended,V=new on(P.LEQUAL,on.ReadWrite,[0,1]),j=w.getCoordsTexture(),X=w.tileManager.getRenderableTiles(),Q=v.useProgram("terrainCoords");E.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),E.clear({color:l.bp.transparent,depth:1}),w.coordsIndex=[];for(const se of X){const le=w.getTerrainMesh(se.tileID),oe=w.getTerrainData(se.tileID);E.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,j.texture);const he={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(R.zoom)},_e=R.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Q.draw(E,P.TRIANGLES,V,bn.disabled,O,pn.backCCW,he,oe,_e,"terrain",le.vertexBuffer,le.indexBuffer,le.segments),w.coordsIndex.push(se.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain))}renderLayer(t,a,c,f,v){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(f||[]).length)&&(this.id=c.id,l.cm(c)?(function(w,E,P,R,O,V){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:j}=V,X=bn.disabled,Q=w.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(se,le,oe,he,_e,ce,ye,Te,pe){const Ce=le.transform,Ge=le.style.map.terrain,je=_e==="map",Ve=ce==="map";for(const qe of se){const St=he.getTile(qe),At=St.getBucket(oe);if(!At||!At.text||!At.text.segments.get().length)continue;const ft=l.ay(At.textSizeData,Ce.zoom),Pt=l.aN(St,1,le.transform.zoom),sn=ni(je,le.transform,Pt),Nn=oe.layout.get("icon-text-fit")!=="none"&&At.hasIconData();if(ft){const ei=Math.pow(2,Ce.zoom-St.tileID.overscaledZ),Yn=Ge?(oi,qn)=>Ge.getElevation(qe,oi,qn):null;$s(At,je,Ve,pe,Ce,sn,ei,ft,Nn,l.aO(Ce,St,ye,Te),qe.toUnwrapped(),Yn)}}})(R,w,P,E,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),O),P.paint.get("icon-opacity").constantOr(1)!==0&&cl(w,E,P,R,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),X,Q,j),P.paint.get("text-opacity").constantOr(1)!==0&&cl(w,E,P,R,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),X,Q,j),E.map.showCollisionBoxes&&(fr(w,E,P,R,!0),fr(w,E,P,R,!1))})(t,a,c,f,this.style.placement.variableOffsets,v):l.cn(c)?(function(w,E,P,R,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:V}=O,j=P.paint.get("circle-opacity"),X=P.paint.get("circle-stroke-width"),Q=P.paint.get("circle-stroke-opacity"),se=!P.layout.get("circle-sort-key").isConstant();if(j.constantOr(1)===0&&(X.constantOr(1)===0||Q.constantOr(1)===0))return;const le=w.context,oe=le.gl,he=w.transform,_e=w.getDepthModeForSublayer(0,on.ReadOnly),ce=bn.disabled,ye=w.colorModeForRenderPass(),Te=[],pe=he.getCircleRadiusCorrection();for(let Ce=0;Ce<R.length;Ce++){const Ge=R[Ce],je=E.getTile(Ge),Ve=je.getBucket(P);if(!Ve)continue;const qe=P.paint.get("circle-translate"),St=P.paint.get("circle-translate-anchor"),At=l.aO(he,je,qe,St),ft=Ve.programConfigurations.get(P.id),Pt=w.useProgram("circle",ft),sn=Ve.layoutVertexBuffer,Nn=Ve.indexBuffer,ei=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ge),Yn={programConfiguration:ft,program:Pt,layoutVertexBuffer:sn,indexBuffer:Nn,uniformValues:Hc(w,je,P,At,pe),terrainData:ei,projectionData:he.getProjectionData({overscaledTileID:Ge,applyGlobeMatrix:!V,applyTerrainMatrix:!0})};if(se){const oi=Ve.segments.get();for(const qn of oi)Te.push({segments:new l.aX([qn]),sortKey:qn.sortKey,state:Yn})}else Te.push({segments:Ve.segments,sortKey:0,state:Yn})}se&&Te.sort(((Ce,Ge)=>Ce.sortKey-Ge.sortKey));for(const Ce of Te){const{programConfiguration:Ge,program:je,layoutVertexBuffer:Ve,indexBuffer:qe,uniformValues:St,terrainData:At,projectionData:ft}=Ce.state;je.draw(le,oe.TRIANGLES,_e,ce,ye,pn.backCCW,St,At,ft,P.id,Ve,qe,Ce.segments,P.paint,w.transform.zoom,Ge)}})(t,a,c,f,v):l.co(c)?(function(w,E,P,R,O){if(P.paint.get("heatmap-opacity")===0)return;const V=w.context,{isRenderingToTexture:j,isRenderingGlobe:X}=O;if(w.style.map.terrain){for(const Q of R){const se=E.getTile(Q);E.hasRenderableParent(Q)||(w.renderPass==="offscreen"?ud(w,se,P,Q,X):w.renderPass==="translucent"&&pr(w,P,Q,j,X))}V.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?(function(Q,se,le,oe){const he=Q.context,_e=he.gl,ce=Q.transform,ye=bn.disabled,Te=new Vn([_e.ONE,_e.ONE],l.bp.transparent,[!0,!0,!0,!0]);(function(pe,Ce,Ge){const je=pe.gl;pe.activeTexture.set(je.TEXTURE1),pe.viewport.set([0,0,Ce.width/4,Ce.height/4]);let Ve=Ge.heatmapFbos.get(l.cd);Ve?(je.bindTexture(je.TEXTURE_2D,Ve.colorAttachment.get()),pe.bindFramebuffer.set(Ve.framebuffer)):(Ve=Xn(pe,Ce.width/4,Ce.height/4),Ge.heatmapFbos.set(l.cd,Ve))})(he,Q,le),he.clear({color:l.bp.transparent});for(let pe=0;pe<oe.length;pe++){const Ce=oe[pe];if(se.hasRenderableParent(Ce))continue;const Ge=se.getTile(Ce),je=Ge.getBucket(le);if(!je)continue;const Ve=je.programConfigurations.get(le.id),qe=Q.useProgram("heatmap",Ve),St=ce.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),At=ce.getCircleRadiusCorrection();qe.draw(he,_e.TRIANGLES,on.disabled,ye,Te,pn.backCCW,To(Ge,ce.zoom,le.paint.get("heatmap-intensity"),At),null,St,le.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,le.paint,ce.zoom,Ve)}he.viewport.set([0,0,Q.width,Q.height])})(w,E,P,R):w.renderPass==="translucent"&&(function(Q,se){const le=Q.context,oe=le.gl;le.setColorMode(Q.colorModeForRenderPass());const he=se.heatmapFbos.get(l.cd);he&&(le.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,he.colorAttachment.get()),le.activeTexture.set(oe.TEXTURE1),vn(le,se).bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Q.useProgram("heatmapTexture").draw(le,oe.TRIANGLES,on.disabled,bn.disabled,Q.colorModeForRenderPass(),pn.disabled,id(Q,se,0,1),null,null,se.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments,se.paint,Q.transform.zoom))})(w,P)})(t,a,c,f,v):l.cp(c)?(function(w,E,P,R,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:V}=O,j=P.paint.get("line-opacity"),X=P.paint.get("line-width");if(j.constantOr(1)===0||X.constantOr(1)===0)return;const Q=w.getDepthModeForSublayer(0,on.ReadOnly),se=w.colorModeForRenderPass(),le=P.paint.get("line-dasharray"),oe=le.constantOr(1),he=P.paint.get("line-pattern"),_e=he.constantOr(1),ce=P.paint.get("line-gradient"),ye=P.getCrossfadeParameters();let Te;Te=_e?"linePattern":oe&&ce?"lineGradientSDF":oe?"lineSDF":ce?"lineGradient":"line";const pe=w.context,Ce=pe.gl,Ge=w.transform;let je=!0;for(const Ve of R){const qe=E.getTile(Ve);if(_e&&!qe.patternsLoaded())continue;const St=qe.getBucket(P);if(!St)continue;const At=St.programConfigurations.get(P.id),ft=w.context.program.get(),Pt=w.useProgram(Te,At),sn=je||Pt.program!==ft,Nn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve),ei=he.constantOr(null),Yn=le&&le.constantOr(null);if(ei&&qe.imageAtlas){const mr=qe.imageAtlas,Ci=mr.patternPositions[ei.to.toString()],zi=mr.patternPositions[ei.from.toString()];Ci&&zi&&At.setConstantPatternPositions(Ci,zi)}else if(Yn){const mr=P.layout.get("line-cap")==="round",Ci=w.lineAtlas.getDash(Yn.to,mr),zi=w.lineAtlas.getDash(Yn.from,mr);At.setConstantDashPositions(Ci,zi)}const oi=Ge.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),qn=Ge.getPixelScale();let bi;_e?(bi=rd(w,qe,P,qn,ye),ma(pe,Ce,qe,At,ye)):oe&&ce?(bi=So(w,qe,P,qn,ye,St.lineClipsArray.length),Qr(w,E,pe,Ce,P,St,Ve,At,ye)):oe?(bi=Yr(w,qe,P,qn,ye),vi(w,pe,Ce,At,sn,ye)):ce?(bi=If(w,qe,P,qn,St.lineClipsArray.length),Kr(w,E,pe,Ce,P,St,Ve)):bi=Yc(w,qe,P,qn);const li=w.stencilModeForClipping(Ve);Pt.draw(pe,Ce.TRIANGLES,Q,li,se,pn.disabled,bi,Nn,oi,P.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,P.paint,w.transform.zoom,At,St.layoutVertexBuffer2),je=!1}})(t,a,c,f,v):l.cq(c)?(function(w,E,P,R,O){const V=P.paint.get("fill-color"),j=P.paint.get("fill-opacity");if(j.constantOr(1)===0)return;const{isRenderingToTexture:X}=O,Q=w.colorModeForRenderPass(),se=P.paint.get("fill-pattern"),le=w.opaquePassEnabledForLayer()&&!se.constantOr(1)&&V.constantOr(l.bp.transparent).a===1&&j.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===le){const oe=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?on.ReadWrite:on.ReadOnly);ws(w,E,P,R,oe,Q,!1,X)}if(w.renderPass==="translucent"&&P.paint.get("fill-antialias")){const oe=w.getDepthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,on.ReadOnly);ws(w,E,P,R,oe,Q,!0,X)}})(t,a,c,f,v):l.cr(c)?(function(w,E,P,R,O){const V=P.paint.get("fill-extrusion-opacity");if(V===0)return;const{isRenderingToTexture:j}=O;if(w.renderPass==="translucent"){const X=new on(w.context.gl.LEQUAL,on.ReadWrite,w.depthRangeFor3D);if(V!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Ts(w,E,P,R,X,bn.disabled,Vn.disabled,j),Ts(w,E,P,R,X,w.stencilModeFor3D(),w.colorModeForRenderPass(),j);else{const Q=w.colorModeForRenderPass();Ts(w,E,P,R,X,bn.disabled,Q,j)}}})(t,a,c,f,v):l.cs(c)?(function(w,E,P,R,O){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:V}=O,j=w.context,X=w.style.projection.useSubdivision,Q=w.getDepthModeForSublayer(0,on.ReadOnly),se=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(le,oe,he,_e,ce,ye,Te){const pe=le.context,Ce=pe.gl;for(const Ge of he){const je=oe.getTile(Ge),Ve=je.dem;if(!Ve||!Ve.data||!je.needsHillshadePrepare)continue;const qe=Ve.dim,St=Ve.stride,At=Ve.getPixels();if(pe.activeTexture.set(Ce.TEXTURE1),pe.pixelStoreUnpackPremultiplyAlpha.set(!1),je.demTexture=je.demTexture||le.getTileTexture(St),je.demTexture){const Pt=je.demTexture;Pt.update(At,{premultiply:!1}),Pt.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE)}else je.demTexture=new l.T(pe,At,Ce.RGBA,{premultiply:!1}),je.demTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);pe.activeTexture.set(Ce.TEXTURE0);let ft=je.fbo;if(!ft){const Pt=new l.T(pe,{width:qe,height:qe,data:null},Ce.RGBA);Pt.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),ft=je.fbo=pe.createFramebuffer(qe,qe,!0,!1),ft.colorAttachment.set(Pt.texture)}pe.bindFramebuffer.set(ft.framebuffer),pe.viewport.set([0,0,qe,qe]),le.useProgram("hillshadePrepare").draw(pe,Ce.TRIANGLES,ce,ye,Te,pn.disabled,Pf(je.tileID,Ve),null,null,_e.id,le.rasterBoundsBuffer,le.quadTriangleIndexBuffer,le.rasterBoundsSegments),je.needsHillshadePrepare=!1}})(w,E,R,P,Q,bn.disabled,se),j.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(X){const[le,oe,he]=w.stencilConfigForOverlapTwoPass(R);Ss(w,E,P,he,le,Q,se,!1,V),Ss(w,E,P,he,oe,Q,se,!0,V)}else{const[le,oe]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Ss(w,E,P,oe,le,Q,se,!1,V)}})(t,a,c,f,v):l.ct(c)?(function(w,E,P,R,O){if(w.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:V}=O,j=w.style.projection.useSubdivision,X=w.getDepthModeForSublayer(0,on.ReadOnly),Q=w.colorModeForRenderPass();if(j){const[se,le,oe]=w.stencilConfigForOverlapTwoPass(R);Ys(w,E,P,oe,se,X,Q,!1,V),Ys(w,E,P,oe,le,X,Q,!0,V)}else{const[se,le]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Ys(w,E,P,le,se,X,Q,!1,V)}})(t,a,c,f,v):l.bU(c)?(function(w,E,P,R,O){if(w.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:V}=O,j=E.getSource(),X=w.style.projection.useSubdivision;if(j instanceof nr)Ia(w,E,P,R,null,!1,!1,j.tileCoords,j.flippedWindingOrder,V);else if(X){const[Q,se,le]=w.stencilConfigForOverlapTwoPass(R);Ia(w,E,P,le,Q,!1,!0,Ws,!1,V),Ia(w,E,P,le,se,!0,!0,Ws,!1,V)}else{const[Q,se]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Ia(w,E,P,se,Q,!1,!0,Ws,!1,V)}})(t,a,c,f,v):l.cu(c)?(function(w,E,P,R,O){const V=P.paint.get("background-color"),j=P.paint.get("background-opacity");if(j===0)return;const{isRenderingToTexture:X}=O,Q=w.context,se=Q.gl,le=w.style.projection,oe=w.transform,he=oe.tileSize,_e=P.paint.get("background-pattern");if(w.isPatternMissing(_e))return;const ce=!_e&&V.a===1&&j===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==ce)return;const ye=bn.disabled,Te=w.getDepthModeForSublayer(0,ce==="opaque"?on.ReadWrite:on.ReadOnly),pe=w.colorModeForRenderPass(),Ce=w.useProgram(_e?"backgroundPattern":"background"),Ge=R||hi(oe,{tileSize:he,terrain:w.style.map.terrain});_e&&(Q.activeTexture.set(se.TEXTURE0),w.imageManager.bind(w.context));const je=P.getCrossfadeParameters();for(const Ve of Ge){const qe=oe.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),St=_e?Jc(j,w,_e,{tileID:Ve,tileSize:he},je):Qc(j,V),At=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve),ft=le.getMeshFromTileID(Q,Ve.canonical,!1,!0,"raster");Ce.draw(Q,se.TRIANGLES,Te,ye,pe,pn.backCCW,St,At,qe,P.id,ft.vertexBuffer,ft.indexBuffer,ft.segments)}})(t,0,c,f,v):l.cv(c)&&(function(w,E,P,R){const{isRenderingGlobe:O}=R,V=w.context,j=P.implementation,X=w.style.projection,Q=w.transform,se=Q.getProjectionDataForCustomLayer(O),le={farZ:Q.farZ,nearZ:Q.nearZ,fov:Q.fov*Math.PI/180,modelViewProjectionMatrix:Q.modelViewProjectionMatrix,projectionMatrix:Q.projectionMatrix,shaderData:{variantName:X.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${X.shaderPreludeCode.vertexSource}`,define:X.shaderDefine},defaultProjectionData:se},oe=j.renderingMode?j.renderingMode:"2d";if(w.renderPass==="offscreen"){const he=j.prerender;he&&(w.setCustomLayerDefaults(),V.setColorMode(w.colorModeForRenderPass()),he.call(j,V.gl,le),V.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),V.setColorMode(w.colorModeForRenderPass()),V.setStencilMode(bn.disabled);const he=oe==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,on.ReadOnly);V.setDepthMode(he),j.render(V.gl,le),V.setDirty(),w.setBaseState(),V.bindFramebuffer.set(null)}})(t,0,c,v))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!a||!c}useProgram(t,a,c=!1,f=[]){this.cache=this.cache||{};const v=!!this.style.map.terrain,w=this.style.projection,E=c?di.projectionMercator:w.shaderPreludeCode,P=c?Ei:w.shaderDefine,R=t+(a?a.cacheKey:"")+`/${c?Fr:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[R]||(this.cache[R]=new Af(this.context,di[t],a,kf[t],this._showOverdrawInspector,v,E,P,f)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const c in this._tileTextures){const f=this._tileTextures[c];if(f)for(const v of f)v.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const f=this.cache[c];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function dd(y,t){let a,c=!1,f=null,v=null;const w=()=>{f=null,c&&(y.apply(v,a),f=setTimeout(w,t),c=!1)};return(...E)=>(c=!0,v=this,a=E,f||w(),f)}class Bi{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(c=f)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const c=a.join("/");let f=c;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${c}`);let v=window.location.hash.replace(f,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let w=window.location.href.replace(/(#.+)?$/,v);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=dd(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,f),w=Math.round(a.lng*v)/v,E=Math.round(a.lat*v)/v,P=this._map.getBearing(),R=this._map.getPitch();let O="";if(O+=t?`/${w}/${E}/${c}`:`${c}/${E}/${w}`,(P||R)&&(O+="/"+Math.round(10*P)/10),R&&(O+=`/${Math.round(R)}`),this._hashName){const V=this._hashName;let j=!1;const X=window.location.hash.slice(1).split("&").map((Q=>{const se=Q.split("=")[0];return se===V?(j=!0,`${se}=${O}`):Q})).filter((Q=>Q));return j||X.push(`${V}=${O}`),`#${X.join("&")}`}return`#${O}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new l.V(+t[2],+t[1])}catch{return!1}const a=+t[0],c=+(t[3]||0),f=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const As={linearity:.3,easing:l.cw(0,0,.3,1)},ic=l.e({deceleration:2500,maxSpeed:1400},As),Dr=l.e({deceleration:20,maxSpeed:1400},As),ya=l.e({deceleration:1e3,maxSpeed:360},As),ul=l.e({deceleration:1e3,maxSpeed:90},As),Ir=l.e({deceleration:1e3,maxSpeed:360},As);class tm{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:fe(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=fe();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,a.roll+=v.rollDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const v=su(a.pan.mag(),c,l.e({},ic,t||{})),w=a.pan.mult(v.amount/a.pan.mag()),E=this._map.cameraHelper.handlePanInertia(w,this._map.transform);f.center=E.easingCenter,f.offset=E.easingOffset,rc(f,v)}if(a.zoom){const v=su(a.zoom,c,Dr);f.zoom=this._map.transform.zoom+v.amount,rc(f,v)}if(a.bearing){const v=su(a.bearing,c,ya);f.bearing=this._map.transform.bearing+l.an(v.amount,-179,179),rc(f,v)}if(a.pitch){const v=su(a.pitch,c,ul);f.pitch=this._map.transform.pitch+v.amount,rc(f,v)}if(a.roll){const v=su(a.roll,c,Ir);f.roll=this._map.transform.roll+l.an(v.amount,-179,179),rc(f,v)}if(f.zoom||f.bearing){const v=a.pinchAround===void 0?a.around:a.pinchAround;f.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),l.e(f,{noMoveStart:!0})}}function rc(y,t){(!y.duration||y.duration<t.duration)&&(y.duration=t.duration,y.easing=t.easing)}function su(y,t,a){const{maxSpeed:c,linearity:f,deceleration:v}=a,w=l.an(y*f/(t/1e3),-c,c),E=Math.abs(w)/(v*f);return{easing:a.easing,duration:1e3*E,amount:w*(E/2)}}class sr extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c,f={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const v=ie.mousePos(a.getCanvas(),c),w=a.unproject(v);super(t,l.e({point:v,lngLat:w,originalEvent:c},f)),this._defaultPrevented=!1,this.target=a}}class Ka extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){const f=t==="touchend"?c.changedTouches:c.touches,v=ie.touchPos(a.getCanvasContainer(),f),w=v.map((P=>a.unproject(P))),E=v.reduce(((P,R,O,V)=>P.add(R.div(V.length))),new l.P(0,0));super(t,{points:v,point:E,lngLats:w,lngLat:a.unproject(E),originalEvent:c}),this._defaultPrevented=!1}}class ch extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class uh{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ch(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new sr(t.type,this._map,t))}mouseup(t){this._map.fire(new sr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new sr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new sr(t.type,this._map,t))}mouseover(t){this._map.fire(new sr(t.type,this._map,t))}mouseout(t){this._map.fire(new sr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ka(t.type,this._map,t))}touchmove(t){this._map.fire(new Ka(t.type,this._map,t))}touchend(t){this._map.fire(new Ka(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ka(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Of{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new sr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new sr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new sr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qa{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(l.P.convert(t),this._map.terrain)}}class Do{constructor(t,a){this._map=t,this._tr=new Qa(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(ie.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=c,this._box||(this._box=ie.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(f.x,c.x),w=Math.max(f.x,c.x),E=Math.min(f.y,c.y),P=Math.max(f.y,c.y);ie.setTransform(this._box,`translate(${v}px,${E}px)`),this._box.style.width=w-v+"px",this._box.style.height=P-E+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const c=this._startPos,f=a;if(this.reset(),ie.suppressClick(),c.x!==f.x||c.y!==f.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(c,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ie.remove(this._box),this._box=null),ie.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new l.l(t,{originalEvent:a}))}}function Jr(y,t){if(y.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${t.length}`);const a={};for(let c=0;c<y.length;c++)a[y[c].identifier]=t[c];return a}class Ot{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){const v=new l.P(0,0);for(const w of f)v._add(w);return v.div(f.length)})(a),this.touches=Jr(c,a)))}touchmove(t,a,c){if(this.aborted||!this.centroid)return;const f=Jr(c,a);for(const v in this.touches){const w=f[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,a,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class ou{constructor(t){this.singleTap=new Ot(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,c){this.singleTap.touchstart(t,a,c)}touchmove(t,a,c){this.singleTap.touchmove(t,a,c)}touchend(t,a,c){const f=this.singleTap.touchend(t,a,c);if(f){const v=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(f)<30;if(v&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class hh{constructor(t){this._tr=new Qa(t),this._zoomIn=new ou({numTouches:1,numTaps:2}),this._zoomOut=new ou({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,c){this._zoomIn.touchstart(t,a,c),this._zoomOut.touchstart(t,a,c)}touchmove(t,a,c){this._zoomIn.touchmove(t,a,c),this._zoomOut.touchmove(t,a,c)}touchend(t,a,c){const f=this._zoomIn.touchend(t,a,c),v=this._zoomOut.touchend(t,a,c),w=this._tr;return f?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(f)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ka{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const f=Array.isArray(a)?a[0]:a;return!this._moved&&f.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(c,f))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&ie.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ja=0,ac=2,dh={[Ja]:1,[ac]:2};class Cs{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=ie.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,c){const f=dh[c];return a.buttons===void 0||(a.buttons&f)!==f})(t,this._eventButton)}isValidEndEvent(t){return ie.mouseButton(t)===this._eventButton}}class hl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class lu{constructor(t=new Cs({checkCorrectEvent:()=>!0}),a=new hl){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,c){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const zs=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=t=>{t.preventDefault()}};class fh{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,c){return this._calculateTransform(t,a,c)}touchmove(t,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,c){this._calculateTransform(t,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,c){c.length>0&&(this._active=!0);const f=Jr(c,a),v=new l.P(0,0),w=new l.P(0,0);let E=0;for(const R in f){const O=f[R],V=this._touches[R];V&&(v._add(O),w._add(O.sub(V)),E++,f[R]=O)}if(this._touches=f,this._shouldBePrevented(E)||!w.mag())return;const P=w.div(E);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,c){if(!this._firstTwoTouches)return;t.preventDefault();const[f,v]=this._firstTwoTouches,w=Ps(c,a,f),E=Ps(c,a,v);if(!w||!E)return;const P=this._aroundCenter?null:w.add(E).div(2);return this._move([w,E],P,t)}touchend(t,a,c){if(!this._firstTwoTouches)return;const[f,v]=this._firstTwoTouches,w=Ps(c,a,f),E=Ps(c,a,v);w&&E||(this._active&&ie.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ps(y,t,a){for(let c=0;c<y.length;c++)if(y[c].identifier===a)return t[c]}function fd(y,t){return Math.log(y/t)/Math.LN2}class Ds extends cu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(fd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fd(this._distance,c),pinchAround:a}}}function ph(y,t){return 180*y.angleWith(t)/Math.PI}class uu extends cu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,c){const f=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ph(this._vector,f),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,c=ph(t,this._startVector);return Math.abs(c)<a}}function Is(y){return Math.abs(y.y)>Math.abs(y.x)}class Js extends cu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,c){super.touchstart(t,a,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Is(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),v=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,v,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,v=a.mag()>=2;if(!f&&!v)return;if(!f||!v)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return Is(t)&&Is(a)&&w}}const Ra={panStep:100,bearingStep:15,pitchStep:10};class Fn{constructor(t){this._tr=new Qa(t);const a=Ra;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,c=0,f=0,v=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:E=>{const P=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:pd,zoom:a?Math.round(P.zoom)+a*(t.shiftKey?2:1):P.zoom,bearing:P.bearing+c*this._bearingStep,pitch:P.pitch+f*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:P.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function pd(y){return y*(2-y)}const eo=4.000244140625,Io=1/450;class hu{constructor(t,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new Qa(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Io}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=fe(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%eo==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ie.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(l.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const E=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=E),typeof this._targetZoom=="number"&&(this._targetZoom+=E)}if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>eo?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&P!==0&&(P=1/P);const R=typeof this._targetZoom!="number"?t.scale:l.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),l.at(R*P)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,f=this._easing;let v,w=!1;if(this._type==="wheel"&&c&&f){const E=fe()-this._lastWheelEventTime,P=Math.min((E+5)/200,1),R=f(P);v=l.G.number(c,a,R),P<1?this._frameId||(this._frameId=!0):w=!0}else v=a,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=v,{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=l.cy;if(this._prevEase){const c=this._prevEase,f=(fe()-c.start)/c.duration,v=c.easing(f+.01)-c.easing(f),w=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-w*w);a=l.cw(w,E,.25,1)}return this._prevEase={start:fe(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class mh{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dl{constructor(t){this._tr=new Qa(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class du{constructor(){this._tap=new ou({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,c){if(!this._swipePoint)if(this._tapTime){const f=a[0],v=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(f)<30;v&&w?c.length>0&&(this._swipePoint=f,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,a,c)}touchmove(t,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=a[0],v=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,a,c)}touchend(t,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const f=this._tap.touchend(t,a,c);f&&(this._tapTime=t.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class md{constructor(t,a,c){this._el=t,this._mousePan=a,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _a{constructor(t,a,c,f){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class fl{constructor(t,a,c,f){this._el=t,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Nt{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=ie.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=a,this._container.appendChild(f);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=c,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ie.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Xt=y=>y.zoom||y.drag||y.roll||y.pitch||y.rotate;class La extends l.l{}function sc(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta||y.rollDelta}class fu{constructor(t,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,v)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=f.type==="renderFrame"?void 0:f,E={needsRenderFrame:!1},P={},R={};for(const{handlerName:j,handler:X,allowed:Q}of this._handlers){if(!X.isEnabled())continue;let se;if(this._blockedByActive(R,Q,j))X.reset();else if(X[v||f.type]){if(l.cz(f,v||f.type)){const le=ie.mousePos(this._map.getCanvas(),f);se=X[v||f.type](f,le)}else if(l.cA(f,v||f.type)){const le=this._getMapTouches(f.touches),oe=ie.touchPos(this._map.getCanvas(),le);se=X[v||f.type](f,oe,le)}else l.cB(v||f.type)||(se=X[v||f.type](f));this.mergeHandlerResult(E,P,se,j,w),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||X.isActive())&&(R[j]=X)}const O={};for(const j in this._previousActiveHandlers)R[j]||(O[j]=w);this._previousActiveHandlers=R,(Object.keys(O).length||sc(E))&&(this._changes.push([E,P,O]),this._triggerRenderFrame()),(Object.keys(R).length||sc(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=E;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tm(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,v,w]of this._listeners)ie.addEventListener(f,v,f===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,a,c]of this._listeners)ie.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new uh(a,t));const f=a.boxZoom=new Do(a,t);this._add("boxZoom",f),t.interactive&&t.boxZoom&&f.enable();const v=a.cooperativeGestures=new Nt(a,t.cooperativeGestures);this._add("cooperativeGestures",v),t.cooperativeGestures&&v.enable();const w=new hh(a),E=new dl(a);a.doubleClickZoom=new mh(E,w),this._add("tapZoom",w),this._add("clickZoom",E),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const P=new du;this._add("tapDragZoom",P);const R=a.touchPitch=new Js(a);this._add("touchPitch",R),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const O=()=>a.project(a.getCenter()),V=(function({enable:ce,clickTolerance:ye,aroundCenter:Te=!0,minPixelCenterThreshold:pe=100,rotateDegreesPerPixelMoved:Ce=.8},Ge){const je=new Cs({checkCorrectEvent:Ve=>ie.mouseButton(Ve)===0&&Ve.ctrlKey||ie.mouseButton(Ve)===2&&!Ve.ctrlKey});return new ka({clickTolerance:ye,move:(Ve,qe)=>{const St=Ge();if(Te&&Math.abs(St.y-Ve.y)>pe)return{bearingDelta:l.cx(new l.P(Ve.x,qe.y),qe,St)};let At=(qe.x-Ve.x)*Ce;return Te&&qe.y<St.y&&(At=-At),{bearingDelta:At}},moveStateManager:je,enable:ce,assignEvents:zs})})(t,O),j=(function({enable:ce,clickTolerance:ye,pitchDegreesPerPixelMoved:Te=-.5}){const pe=new Cs({checkCorrectEvent:Ce=>ie.mouseButton(Ce)===0&&Ce.ctrlKey||ie.mouseButton(Ce)===2});return new ka({clickTolerance:ye,move:(Ce,Ge)=>({pitchDelta:(Ge.y-Ce.y)*Te}),moveStateManager:pe,enable:ce,assignEvents:zs})})(t),X=(function({enable:ce,clickTolerance:ye,rollDegreesPerPixelMoved:Te=.3},pe){const Ce=new Cs({checkCorrectEvent:Ge=>ie.mouseButton(Ge)===2&&Ge.ctrlKey});return new ka({clickTolerance:ye,move:(Ge,je)=>{const Ve=pe();let qe=(je.x-Ge.x)*Te;return je.y<Ve.y&&(qe=-qe),{rollDelta:qe}},moveStateManager:Ce,enable:ce,assignEvents:zs})})(t,O);a.dragRotate=new _a(t,V,j,X),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",j,["mouseRotate","mouseRoll"]),this._add("mouseRoll",X,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const Q=(function({enable:ce,clickTolerance:ye}){const Te=new Cs({checkCorrectEvent:pe=>ie.mouseButton(pe)===0&&!pe.ctrlKey});return new ka({clickTolerance:ye,move:(pe,Ce)=>({around:Ce,panDelta:Ce.sub(pe)}),activateOnStart:!0,moveStateManager:Te,enable:ce,assignEvents:zs})})(t),se=new fh(t,a);a.dragPan=new md(c,Q,se),this._add("mousePan",Q),this._add("touchPan",se,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const le=new uu,oe=new Ds;a.touchZoomRotate=new fl(c,oe,le,P),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Of(a));const he=a.scrollZoom=new hu(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",he,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const _e=a.keyboard=new Fn(a);this._add("keyboard",_e),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,c){this._handlers.push({handlerName:t,handler:a,allowed:c}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,c){for(const f in t)if(f!==c&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const c of t)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(t,a,c,f,v){if(!c)return;l.e(t,c);const w={handlerName:f,originalEvent:c.originalEvent||v};c.zoomDelta!==void 0&&(a.zoom=w),c.panDelta!==void 0&&(a.drag=w),c.rollDelta!==void 0&&(a.roll=w),c.pitchDelta!==void 0&&(a.pitch=w),c.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},c={};for(const[f,v,w]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(t.rollDelta=(t.rollDelta||0)+f.rollDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),l.e(a,v),l.e(c,w);this._updateMapTransform(t,a,c),this._changes=[]}_updateMapTransform(t,a,c){const f=this._map,v=f._getTransformForUpdate(),w=f.terrain;if(!(sc(t)||w&&this._terrainMovement))return this._fireEvents(a,c,!0);f._stop(!0);let{panDelta:E,zoomDelta:P,bearingDelta:R,pitchDelta:O,rollDelta:V,around:j,pinchAround:X}=t;X!==void 0&&(j=X),j=j||f.transform.centerPoint,w&&!v.isPointOnMapSurface(j)&&(j=v.centerPoint);const Q={panDelta:E,zoomDelta:P,rollDelta:V,pitchDelta:O,bearingDelta:R,around:j};this._map.cameraHelper.useGlobeControls&&!v.isPointOnMapSurface(j)&&(j=v.centerPoint);const se=j.distSqr(v.centerPoint)<.01?v.center:v.screenPointToLocation(E?j.sub(E):j);this._handleMapControls({terrain:w,tr:v,deltasForHelper:Q,preZoomAroundLoc:se,combinedEventsInProgress:a,panDelta:E}),f._applyUpdatedTransform(v),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,c,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:c,preZoomAroundLoc:f,combinedEventsInProgress:v,panDelta:w}){const E=this._map.cameraHelper;if(E.handleMapControlsRollPitchBearingZoom(c,a),t)return E.useGlobeControls?(this._terrainMovement||!v.drag&&!v.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void E.handleMapControlsPan(c,a,f)):this._terrainMovement||!v.drag&&!v.zoom?void(v.drag&&this._terrainMovement&&w?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(w))):E.handleMapControlsPan(c,a,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void E.handleMapControlsPan(c,a,f));E.handleMapControlsPan(c,a,f)}_fireEvents(t,a,c){const f=Xt(this._eventsInProgress),v=Xt(t),w={};for(const V in t){const{originalEvent:j}=t[V];this._eventsInProgress[V]||(w[`${V}start`]=j),this._eventsInProgress[V]=t[V]}!f&&v&&this._fireEvent("movestart",v.originalEvent);for(const V in w)this._fireEvent(V,w[V]);v&&this._fireEvent("move",v.originalEvent);for(const V in t){const{originalEvent:j}=t[V];this._fireEvent(V,j)}const E={};let P;for(const V in this._eventsInProgress){const{handlerName:j,originalEvent:X}=this._eventsInProgress[V];this._handlersById[j].isActive()||(delete this._eventsInProgress[V],P=a[j]||X,E[`${V}end`]=P)}for(const V in E)this._fireEvent(V,E[V]);const R=Xt(this._eventsInProgress),O=(f||v)&&!R;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const V=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&V.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(V)}if(c&&O){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;!V||!V.essential&&be.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:P})),j(this._map.getBearing())&&this._map.resetNorth()):(j(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new l.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new La("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ni extends l.E{constructor(t,a,c){super(),this._renderFrameCallback=()=>{const f=Math.min((fe()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new l.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,c){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},a),c)}panTo(t,a,c){return this.easeTo(l.e({center:t},a),c)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,c){return this.easeTo(l.e({zoom:t},a),c)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)).fire(new l.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,c){return this.easeTo(l.e({bearing:t},a),c)}resetNorth(t,a){return this.rotateTo(0,l.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=Jn.convert(t).adjustAntiMeridian();const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,a)}_cameraForBoxAndBearing(t,a,c,f){const v={top:0,bottom:0,right:0,left:0};if(typeof(f=l.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const R=f.padding;f.padding={top:R,bottom:R,right:R,left:R}}const w=l.e(v,f.padding);f.padding=w;const E=this.transform,P=new Jn(t,a);return this.cameraHelper.cameraForBoxAndBearing(f,w,P,c,E)}fitBounds(t,a,c){return this._fitInternal(this.cameraForBounds(t,a),a,c)}fitScreenCoordinates(t,a,c,f,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(t)),this.transform.screenPointToLocation(l.P.convert(a)),c,f),f,v)}_fitInternal(t,a,c){return t?(delete(a=l.e(t,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(t,a){this.stop();const c=this._getTransformForUpdate();let f=!1,v=!1,w=!1;const E=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const P=c.zoom!==E;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(f=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(v=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(w=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)),P&&this.fire(new l.l("zoomstart",a)).fire(new l.l("zoom",a)).fire(new l.l("zoomend",a)),f&&this.fire(new l.l("rotatestart",a)).fire(new l.l("rotate",a)).fire(new l.l("rotateend",a)),v&&this.fire(new l.l("pitchstart",a)).fire(new l.l("pitch",a)).fire(new l.l("pitchend",a)),w&&this.fire(new l.l("rollstart",a)).fire(new l.l("roll",a)).fire(new l.l("rollend",a)),this.fire(new l.l("moveend",a))}calculateCameraOptionsFromTo(t,a,c,f=0){const v=l.a9.fromLngLat(t,a),w=l.a9.fromLngLat(c,f),E=w.x-v.x,P=w.y-v.y,R=w.z-v.z,O=Math.hypot(E,P,R);if(O===0)throw new Error("Can't calculate camera options with same From and To");const V=Math.hypot(E,P),j=l.at(this.transform.cameraToCenterDistance/O/this.transform.tileSize),X=180*Math.atan2(E,-P)/Math.PI;let Q=180*Math.acos(V/O)/Math.PI;return Q=R<0?90-Q:90+Q,{center:w.toLngLat(),elevation:f,zoom:j,pitch:Q,bearing:X}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,c,f,v){const w=this.transform.calculateCenterFromCameraLngLatAlt(t,a,c,f);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:c,pitch:f,roll:v}}easeTo(t,a){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.cy},t)).animate===!1||!t.essential&&be.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getBearing(),v=c.pitch,w=c.roll,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,P="pitch"in t?+t.pitch:v,R="roll"in t?this._normalizeBearing(t.roll,w):w,O="padding"in t?t.padding:c.padding,V=l.P.convert(t.offset);let j,X;t.around&&(j=l.V.convert(t.around),X=c.locationToScreenPoint(j));const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(c,{bearing:E,pitch:P,roll:R,padding:O,around:j,aroundPoint:X,offsetAsPoint:V,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||f!==E,this._pitching=this._pitching||P!==v,this._rolling=this._rolling||R!==w,this._padding=!c.isPaddingEqual(O),this._zooming=this._zooming||se.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Q),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease((le=>{se.easeFunc(le),this.terrain&&!t.freezeElevation&&this._updateElevation(le),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(le=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,le)}),t),this}_prepareEase(t,a,c={}){this._moving=!0,a||c.moving||this.fire(new l.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new l.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new l.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new l.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new l.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(a-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(l.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),c=t.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(c<f){const v=this.calculateCameraOptionsFromTo(a,f,t.center,t.elevation);return{pitch:v.pitch,zoom:v.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&a.push((f=>this.transformCameraUpdate(f))),!a.length)return;const c=t.clone();for(const f of a){const v=c.clone(),{center:w,zoom:E,roll:P,pitch:R,bearing:O,elevation:V}=f(v);w&&v.setCenter(w),V!==void 0&&v.setElevation(V),E!==void 0&&v.setZoom(E),P!==void 0&&v.setRoll(P),R!==void 0&&v.setPitch(R),O!==void 0&&v.setBearing(O),c.apply(v)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new l.l("move",t)),this._zooming&&this.fire(new l.l("zoom",t)),this._rotating&&this.fire(new l.l("rotate",t)),this._pitching&&this.fire(new l.l("pitch",t)),this._rolling&&this.fire(new l.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,f=this._rotating,v=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new l.l("zoomend",t)),f&&this.fire(new l.l("rotateend",t)),v&&this.fire(new l.l("pitchend",t)),w&&this.fire(new l.l("rollend",t)),this.fire(new l.l("moveend",t))}flyTo(t,a){if(!t.essential&&be.prefersReducedMotion){const qe=l.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(qe,a)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cy},t);const c=this._getTransformForUpdate(),f=c.bearing,v=c.pitch,w=c.roll,E=c.padding,P="bearing"in t?this._normalizeBearing(t.bearing,f):f,R="pitch"in t?+t.pitch:v,O="roll"in t?this._normalizeBearing(t.roll,w):w,V="padding"in t?t.padding:c.padding,j=l.P.convert(t.offset);let X=c.centerPoint.add(j);const Q=c.screenPointToLocation(X),se=this.cameraHelper.handleFlyTo(c,{bearing:P,pitch:R,roll:O,padding:V,locationAtOffset:Q,offsetAsPoint:j,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let le=t.curve;const oe=Math.max(c.width,c.height),he=oe/se.scaleOfZoom,_e=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(le=Math.sqrt(oe/se.scaleOfMinZoom/_e*2));const ce=le*le;function ye(qe){const St=(he*he-oe*oe+(qe?-1:1)*ce*ce*_e*_e)/(2*(qe?he:oe)*ce*_e);return Math.log(Math.sqrt(St*St+1)-St)}function Te(qe){return(Math.exp(qe)-Math.exp(-qe))/2}function pe(qe){return(Math.exp(qe)+Math.exp(-qe))/2}const Ce=ye(!1);let Ge=function(qe){return pe(Ce)/pe(Ce+le*qe)},je=function(qe){return oe*((pe(Ce)*(Te(St=Ce+le*qe)/pe(St))-Te(Ce))/ce)/_e;var St},Ve=(ye(!0)-Ce)/le;if(Math.abs(_e)<2e-6||!isFinite(Ve)){if(Math.abs(oe-he)<1e-6)return this.easeTo(t,a);const qe=he<oe?-1:1;Ve=Math.abs(Math.log(he/oe))/le,je=()=>0,Ge=St=>Math.exp(qe*le*St)}return t.duration="duration"in t?+t.duration:1e3*Ve/("screenSpeed"in t?+t.screenSpeed/le:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==P,this._pitching=R!==v,this._rolling=O!==w,this._padding=!c.isPaddingEqual(V),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease((qe=>{const St=qe*Ve,At=1/Ge(St),ft=je(St);this._rotating&&c.setBearing(l.G.number(f,P,qe)),this._pitching&&c.setPitch(l.G.number(v,R,qe)),this._rolling&&c.setRoll(l.G.number(w,O,qe)),this._padding&&(c.interpolatePadding(E,V,qe),X=c.centerPoint.add(j)),se.easeFunc(qe,At,ft,X),this.terrain&&!t.freezeElevation&&this._updateElevation(qe),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,a)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,a,c){c.animate===!1||c.duration===0?(t(1),a()):(this._easeStart=fe(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=l.W(t,-180,180);const c=Math.abs(t-a);return Math.abs(t-360-a)<c&&(t-=360),Math.abs(t+360-a)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(l.V.convert(t),this.transform):null}}const xi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ai{constructor(t=xi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=ie.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ie.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ie.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ie.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const c=this._map._getUIString(`AttributionControl.${a}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.tileManagers;for(const f in a){const v=a[f];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter((f=>String(f).trim())),t.sort(((f,v)=>f.length-v.length)),t=t.filter(((f,v)=>{for(let w=v+1;w<t.length;w++)if(t[w].indexOf(f)>=0)return!1;return!0}));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=ie.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pu{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=ie.create("div","maplibregl-ctrl");const a=ie.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ie.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class to{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var fn=l.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Bn extends l.E{constructor(t){super(),this._lastTilesetChange=fe(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const c={};for(const f of hi(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),l.c7(f.terrainRttPosMatrix32f,0,l.a5,l.a5,0,0,1),this._tiles[f.key]=new Je(f,this.tileSize),this._lastTilesetChange=fe());for(const f in this._tiles)c[f]||delete this._tiles[f]}freeRtt(t){for(const a in this._tiles){const c=this._tiles[a];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const c of this._renderableTilesKeys){const f=this._tiles[c].tileID,v=t.clone(),w=l.bk();if(f.canonical.equals(t.canonical))l.c7(w,0,l.a5,l.a5,0,0,1);else if(f.canonical.isChildOf(t.canonical)){const E=f.canonical.z-t.canonical.z,P=f.canonical.x-(f.canonical.x>>E<<E),R=f.canonical.y-(f.canonical.y>>E<<E),O=l.a5>>E;l.c7(w,0,O,O,0,0,1),l.O(w,w,[-P*O,-R*O,0])}else{if(!t.canonical.isChildOf(f.canonical))continue;{const E=t.canonical.z-f.canonical.z,P=t.canonical.x-(t.canonical.x>>E<<E),R=t.canonical.y-(t.canonical.y>>E<<E),O=l.a5>>E;l.c7(w,0,l.a5,l.a5,0,0,1),l.O(w,w,[P*O,R*O,0]),l.Q(w,w,[1/2**E,1/2**E,0])}}v.terrainRttPosMatrix32f=new Float32Array(w),a[c]=v}return a}_getTerrainCoordsForTileRanges(t,a){const c={};for(const f of this._renderableTilesKeys){const v=this._tiles[f].tileID;if(!this._isWithinTileRanges(v,a))continue;const w=t.clone(),E=l.bk();if(v.canonical.z===t.canonical.z){const P=t.canonical.x-v.canonical.x,R=t.canonical.y-v.canonical.y;l.c7(E,0,l.a5,l.a5,0,0,1),l.O(E,E,[P*l.a5,R*l.a5,0])}else if(v.canonical.z>t.canonical.z){const P=v.canonical.z-t.canonical.z,R=v.canonical.x-(v.canonical.x>>P<<P),O=v.canonical.y-(v.canonical.y>>P<<P),V=t.canonical.x-(v.canonical.x>>P),j=t.canonical.y-(v.canonical.y>>P),X=l.a5>>P;l.c7(E,0,X,X,0,0,1),l.O(E,E,[-R*X+V*l.a5,-O*X+j*l.a5,0])}else{const P=t.canonical.z-v.canonical.z,R=t.canonical.x-(t.canonical.x>>P<<P),O=t.canonical.y-(t.canonical.y>>P<<P),V=(t.canonical.x>>P)-v.canonical.x,j=(t.canonical.y>>P)-v.canonical.y,X=l.a5<<P;l.c7(E,0,X,X,0,0,1),l.O(E,E,[R*l.a5+V*X,O*l.a5+j*X,0])}w.terrainRttPosMatrix32f=new Float32Array(E),c[f]=w}return c}getSourceTile(t,a){const c=this.tileManager._source;let f=t.overscaledZ-this.deltaZoom;if(f>c.maxzoom&&(f=c.maxzoom),f<c.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let v=this.findTileInCaches(this._sourceTileCache[t.key]);if(!v?.dem&&a)for(;f>=c.minzoom&&!v?.dem;)v=this.findTileInCaches(t.scaledTo(f--).key);return v}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class dn{constructor(t,a,c){this._meshCache={},this.painter=t,this.tileManager=new Bn(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,c,f=l.a5){var v;if(!(a>=0&&a<f&&c>=0&&c<f))return 0;const w=this.getTerrainData(t),E=(v=w.tile)===null||v===void 0?void 0:v.dem;if(!E)return 0;const P=l.cC([],[a/f*l.a5,c/f*l.a5],w.u_terrain_matrix),R=[P[0]*E.dim,P[1]*E.dim],O=Math.floor(R[0]),V=Math.floor(R[1]),j=R[0]-O,X=R[1]-V;return E.get(O,V)*(1-j)*(1-X)+E.get(O+1,V)*j*(1-X)+E.get(O,V+1)*(1-j)*X+E.get(O+1,V+1)*j*X}getElevationForLngLatZoom(t,a){if(!l.cD(a,t.wrap()))return 0;const{tileID:c,mercatorX:f,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(c,f%l.a5,v%l.a5,l.a5)}getElevationForLngLat(t,a){const c=hi(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let f=0;for(const v of c)v.canonical.z>f&&(f=Math.min(v.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,f)}getElevation(t,a,c,f=l.a5){return this.getDEMElevation(t,a,c,f)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.painter.context,v=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(f,v,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(f,new l.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new l.T(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a.toString()+a.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const f=this.tileManager.getSource().maxzoom;let v=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?v=t.canonical.z-f:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>v<<v),E=t.canonical.y-(t.canonical.y>>v<<v),P=l.cE(new Float64Array(16),[1/(l.a5<<v),1/(l.a5<<v),0]);l.O(P,P,[w*l.a5,E*l.a5,0]),this._demMatrixCache[t.key]={matrix:P,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,c=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let E=0;E<this._coordsTextureSize;E++,w+=4)a[w+0]=255&E,a[w+1]=255&v,a[w+2]=E>>8<<4|v>>8,a[w+3]=0;const c=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new l.T(t,c,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),c=this.painter.context,f=c.gl,v=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(v,E-w-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const P=a[0]+(a[2]>>4<<8),R=a[1]+((15&a[2])<<8),O=this.coordsIndex[255-a[3]],V=O&&this.tileManager.getTileByID(O);if(!V)return null;const j=this._coordsTextureSize,X=(1<<V.tileID.canonical.z)*j;return new l.a9((V.tileID.canonical.x*j+P)/X+V.tileID.wrap,(V.tileID.canonical.y*j+R)/X,this.getElevation(V.tileID,P,R,j))}depthAtPoint(t){const a=new Uint8Array(4),c=this.painter.context,f=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,f=c&&t.canonical.y===0,v=c&&t.canonical.y===(1<<t.canonical.z)-1,w=`m_${f?"n":""}_${v?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const E=this.painter.context,P=new l.cF,R=new l.aY,O=this.meshSize,V=l.a5/O,j=O*O;for(let pe=0;pe<=O;pe++)for(let Ce=0;Ce<=O;Ce++)P.emplaceBack(Ce*V,pe*V,0);for(let pe=0;pe<j;pe+=O+1)for(let Ce=0;Ce<O;Ce++)R.emplaceBack(Ce+pe,O+Ce+pe+1,O+Ce+pe+2),R.emplaceBack(Ce+pe,O+Ce+pe+2,Ce+pe+1);const X=P.length,Q=X+(O+1),se=(O+1)*O,le=f?l.br:0,oe=f?0:1,he=v?l.bs:l.a5,_e=v?0:1;for(let pe=0;pe<=O;pe++)P.emplaceBack(pe*V,le,oe);for(let pe=0;pe<=O;pe++)P.emplaceBack(pe*V,he,_e);for(let pe=0;pe<O;pe++)R.emplaceBack(se+pe,Q+pe,Q+pe+1),R.emplaceBack(se+pe,Q+pe+1,se+pe+1),R.emplaceBack(0+pe,X+pe+1,X+pe),R.emplaceBack(0+pe,0+pe+1,X+pe+1);const ce=P.length,ye=ce+2*(O+1);for(const pe of[0,1])for(let Ce=0;Ce<=O;Ce++)for(const Ge of[0,1])P.emplaceBack(pe*l.a5,Ce*V,Ge);for(let pe=0;pe<2*O;pe+=2)R.emplaceBack(ce+pe,ce+pe+1,ce+pe+3),R.emplaceBack(ce+pe,ce+pe+3,ce+pe+2),R.emplaceBack(ye+pe,ye+pe+3,ye+pe+1),R.emplaceBack(ye+pe,ye+pe+2,ye+pe+3);const Te=new $n(E.createVertexBuffer(P,fn.members),E.createIndexBuffer(R),l.aX.simpleSegment(0,0,P.length,R.length));return this._meshCache[w]=Te,Te}getMeshFrameDelta(t){return 2*Math.PI*l.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var c;if(!l.cD(a,t.wrap()))return 0;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(c=this.getMinMaxElevation(f).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,a){const c=l.a9.fromLngLat(t.wrap()),f=(1<<a)*l.a5,v=c.x*f,w=c.y*f,E=Math.floor(v/l.a5),P=Math.floor(w/l.a5);return{tileID:new l.a2(a,0,a,E,P),mercatorX:v,mercatorY:w}}}class mi{constructor(t,a,c){this._context=t,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:t,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Oa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class es{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new mi(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((c=>!t._layers[c].isHidden(a))),this._coordsAscending={};for(const c in t.tileManagers){this._coordsAscending[c]={};const f=t.tileManagers[c].getVisibleCoordinates(),v=t.tileManagers[c].getSource(),w=v instanceof nr?v.terrainTileRanges:null;for(const E of f){const P=this.terrain.tileManager.getTerrainCoords(E,w);for(const R in P)this._coordsAscending[c][R]||(this._coordsAscending[c][R]=[]),this._coordsAscending[c][R].push(P[R])}}this._coordsAscendingStr={};for(const c of t._order){const f=t._layers[c],v=f.source;if(Oa[f.type]&&!this._coordsAscendingStr[v]){this._coordsAscendingStr[v]={};for(const w in this._coordsAscending[v])this._coordsAscendingStr[v][w]=this._coordsAscending[v][w].map((E=>E.key)).sort().join()}}for(const c of this._renderableTiles)for(const f in this._coordsAscendingStr){const v=this._coordsAscendingStr[f][c.tileID.key];v&&v!==c.rttCoords[f]&&(c.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),f=t.type,v=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Oa[f]&&(this._prevType&&Oa[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(t.id),!w))return!0;if(Oa[this._prevType]||Oa[f]&&w){this._prevType=f;const E=this._stacks.length-1,P=this._stacks[E]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(lh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[E]){const V=this.pool.getObjectForId(R.rtt[E].id);if(V.stamp===R.rtt[E].stamp){this.pool.useObject(V);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),R.rtt[E]={id:O.id,stamp:O.stamp},v.context.bindFramebuffer.set(O.fbo.framebuffer),v.context.clear({color:l.bp.transparent,stencil:0}),v.currentStencilSource=void 0;for(let V=0;V<P.length;V++){const j=v.style._layers[P[V]],X=j.source?this._coordsAscending[j.source][R.tileID.key]:[R.tileID];v.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),v._renderTileClippingMasks(j,X,!0),v.renderLayer(v,v.style.tileManagers[j.source],j,X,c),j.source&&(R.rttCoords[j.source]=this._coordsAscendingStr[j.source][R.tileID.key])}}return lh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),Oa[f]}return!1}}const pl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ml=N,no={hash:!1,interactive:!0,bearingSnap:7,attributionControl:xi,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},gd={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class si{constructor(t,a,c=!1){this.mousedown=v=>{this.startMove(v,ie.mousePos(this.element,v)),ie.addEventListener(window,"mousemove",this.mousemove),ie.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.move(v,ie.mousePos(this.element,v))},this.mouseup=v=>{this._rotatePitchHandler.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ie.touchPos(this.element,v.targetTouches)[0],this.startMove(v,this._startPos),ie.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=ie.touchPos(this.element,v.targetTouches)[0],this.move(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const f=new lu;this._rotatePitchHandler=new ka({clickTolerance:3,move:(v,w)=>{const E=a.getBoundingClientRect(),P=new l.P((E.bottom-E.top)/2,(E.right-E.left)/2);return{bearingDelta:l.cx(new l.P(v.x,w.y),w,P),pitchDelta:c?-.5*(w.y-v.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=t,ie.addEventListener(a,"mousedown",this.mousedown),ie.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),ie.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),ie.disableDrag()}move(t,a){const c=this.map,{bearingDelta:f,pitchDelta:v}=this._rotatePitchHandler.dragMove(t,a)||{};f&&c.setBearing(c.getBearing()+f),v&&c.setPitch(c.getPitch()+v)}off(){const t=this.element;ie.removeEventListener(t,"mousedown",this.mousedown),ie.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.removeEventListener(window,"touchend",this.touchend),ie.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ie.enableDrag(),ie.removeEventListener(window,"mousemove",this.mousemove),ie.removeEventListener(window,"mouseup",this.mouseup),ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.removeEventListener(window,"touchend",this.touchend)}}let ts;function oc(y,t,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return y?.wrap();const f=new l.V(y.lng,y.lat);if(y=new l.V(y.lng,y.lat),t){const v=new l.V(y.lng-360,y.lat),w=new l.V(y.lng+360,y.lat),E=a.locationToScreenPoint(y).distSqr(t);a.locationToScreenPoint(v).distSqr(t)<E?y=v:a.locationToScreenPoint(w).distSqr(t)<E&&(y=w)}for(;Math.abs(y.lng-a.center.lng)>180;){const v=a.locationToScreenPoint(y);if(v.x>=0&&v.y>=0&&v.x<=a.width&&v.y<=a.height)break;y.lng>a.center.lng?y.lng-=360:y.lng+=360}return y.lng!==f.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(y))?y:f}const lc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mu(y,t,a){const c=y.classList;for(const f in lc)c.remove(`maplibregl-${a}-anchor-${f}`);c.add(`maplibregl-${a}-anchor-${t}`)}class gu extends l.E{constructor(t){if(super(),this._onKeyPress=a=>{const c=a.code,f=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=oc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),ie.setTransform(this._element,`${lc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${f}`),be.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie.create("div");const a=ie.createNS("http://www.w3.org/2000/svg","svg"),c=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${c}`);const v=ie.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const w=ie.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const E=ie.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of P){const he=ie.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",oe.rx),he.setAttributeNS(null,"ry",oe.ry),E.appendChild(he)}const R=ie.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const O=ie.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(O);const V=ie.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const j=ie.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild(j);const X=ie.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const Q=ie.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=ie.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const le=ie.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),Q.appendChild(se),Q.appendChild(le),w.appendChild(E),w.appendChild(R),w.appendChild(V),w.appendChild(X),w.appendChild(Q),a.appendChild(w),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),mu(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ie.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,c;const f=(a=this._map)===null||a===void 0?void 0:a.terrain,v=this._map.transform.isLocationOccluded(this._lngLat);if(!f||v){const X=v?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==X&&(this._element.style.opacity=X))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const w=this._map,E=w.terrain.depthAtPoint(this._pos),P=w.terrain.getElevationForLngLat(this._lngLat,w.transform);if(w.transform.lngLatToCameraDepth(this._lngLat,P)-E<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/w.transform.pixelsPerMeter,O=Math.sin(w.getPitch()*Math.PI/180)*R,V=w.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),j=w.transform.lngLatToCameraDepth(this._lngLat,P+O)-V>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&j&&this._popup.remove(),this._element.style.opacity=j?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const yu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ko=0,io=!1;const Er={maxWidth:100,unit:"metric"};function gi(y,t,a){const c=a&&a.maxWidth||100,f=y._container.clientHeight/2,v=y._container.clientWidth/2,w=y.unproject([v-c/2,f]),E=y.unproject([v+c/2,f]),P=Math.round(y.project(E).x-y.project(w).x),R=Math.min(c,P,y._container.clientWidth),O=w.distanceTo(E);if(a&&a.unit==="imperial"){const V=3.2808*O;V>5280?ks(t,R,V/5280,y._getUIString("ScaleControl.Miles")):ks(t,R,V,y._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?ks(t,R,O/1852,y._getUIString("ScaleControl.NauticalMiles")):O>=1e3?ks(t,R,O/1e3,y._getUIString("ScaleControl.Kilometers")):ks(t,R,O,y._getUIString("ScaleControl.Meters"))}function ks(y,t,a,c){const f=(function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let E=v/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(P){const R=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*R)/R})(E),w*E})(a);y.style.width=t*(f/a)+"px",y.innerHTML=`${f}&nbsp;${c}`}const gl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},yl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cc(y){if(y){if(typeof y=="number"){const t=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,y),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-y),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(y,0),right:new l.P(-y,0)}}if(y instanceof l.P||Array.isArray(y)){const t=l.P.convert(y);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(y.center||[0,0]),top:l.P.convert(y.top||[0,0]),"top-left":l.P.convert(y["top-left"]||[0,0]),"top-right":l.P.convert(y["top-right"]||[0,0]),bottom:l.P.convert(y.bottom||[0,0]),"bottom-left":l.P.convert(y["bottom-left"]||[0,0]),"bottom-right":l.P.convert(y["bottom-right"]||[0,0]),left:l.P.convert(y.left||[0,0]),right:l.P.convert(y.right||[0,0])}}return cc(new l.P(0,0))}const ns=N;A.AJAXError=l.cI,A.Event=l.l,A.Evented=l.E,A.LngLat=l.V,A.MercatorCoordinate=l.a9,A.Point=l.P,A.addProtocol=l.cJ,A.config=l.c,A.removeProtocol=l.cK,A.AttributionControl=Ai,A.BoxZoomHandler=Do,A.CanvasSource=Z,A.CooperativeGesturesHandler=Nt,A.DoubleClickZoomHandler=mh,A.DragPanHandler=md,A.DragRotateHandler=_a,A.EdgeInsets=ca,A.FullscreenControl=class extends l.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ie.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=ie.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ie.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},A.GeoJSONSource=Li,A.GeolocateControl=class extends l.E{constructor(y){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new l.V(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,f=this._map.getBearing(),v=l.e({bearing:f},this.options.fitBoundsOptions),w=Jn.fromLngLat(a,c);this._map.fitBounds(w,v,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new l.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&io)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=ie.create("button","maplibregl-ctrl-geolocate",this._container),ie.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new gu({element:this._dotElement}),this._circleElement=ie.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},yu,y)}onAdd(y){return this._map=y,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(t=!1){if(ts!==void 0&&!t)return ts;if(window.navigator.permissions===void 0)return ts=!!window.navigator.geolocation,ts;try{ts=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ts=!!window.navigator.geolocation}return ts}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ie.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,ko=0,io=!1}_isOutOfMapMaxBounds(y){const t=this._map.getMaxBounds(),a=y.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const y=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&y))return;const t=this._map.project(y),a=this._map.unproject([t.x+100,t.y]),c=y.distanceTo(a)/100,f=2*this._accuracy/c;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ko--,io=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ko++,ko>1?(y={maximumAge:6e5,timeout:0},io=!0):(y=this.options.positionOptions,io=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},A.GlobeControl=class{constructor(){this._toggleProjection=()=>{var y;const t=(y=this._map.getProjection())===null||y===void 0?void 0:y.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var y;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((y=this._map.getProjection())===null||y===void 0?void 0:y.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(y){return this._map=y,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ie.create("button","maplibregl-ctrl-globe",this._container),ie.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ie.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},A.Hash=Bi,A.ImageSource=nr,A.KeyboardHandler=Fn,A.LngLatBounds=Jn,A.LogoControl=pu,A.Map=class extends Ni{constructor(y){var t,a;l.cG.mark(l.cH.create);const c=Object.assign(Object.assign(Object.assign({},no),y),{canvasContextAttributes:Object.assign(Object.assign({},no.canvasContextAttributes),y.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new Qi,v=new Jo;if(c.minZoom!==void 0&&f.setMinZoom(c.minZoom),c.maxZoom!==void 0&&f.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&f.setMinPitch(c.minPitch),c.maxPitch!==void 0&&f.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&f.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&f.setConstrainOverride(c.transformConstrain),super(f,v,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new to,this._controls=[],this._mapId=l.af(),this._lostContextStyle={style:null,images:null},this._contextLost=E=>{E.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const P of Object.values(this.style._layers))if(P.type==="custom"&&console.warn(`Custom layer with id '${P.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),P._listeners)for(const[R]of Object.entries(P._listeners))console.warn(`Custom layer with id '${P.id}' had event listeners for event '${R}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new l.l("webglcontextlost",{originalEvent:E}))},this._contextRestored=E=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:E}))},this._onMapScroll=E=>{if(E.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},pl),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(be.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=st.addThrottleControl((()=>this.isMoving())),this._requestManager=new ke(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let E=!1;const P=dd((R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())}),50);this._resizeObserver=new ResizeObserver((R=>{E?P(R):E=!0})),this._resizeObserver.observe(this._container)}this.handlers=new fu(this,c),this._hash=c.hash&&new Bi(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,l.e({},c.fitBoundsOptions,{duration:0}))));const w=typeof c.style=="string"||((a=(t=c.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Ai(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new pu,c.logoPosition),this.on("style.load",(()=>{if(w||this._resizeTransform(),this.transform.unmodified){const E=l.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(E)}})),this.on("data",(E=>{this._update(E.dataType==="style"),this.fire(new l.l(`${E.dataType}data`,E))})),this.on("dataloading",(E=>{this.fire(new l.l(`${E.dataType}dataloading`,E))})),this.on("dataabort",(E=>{this.fire(new l.l("sourcedataabort",E))}))}_getMapId(){return this._mapId}setGlobalStateProperty(y,t){return this.style.setGlobalStateProperty(y,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(y,t){if(t===void 0&&(t=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=y.onAdd(this);this._controls.push(y);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(y);return t>-1&&this._controls.splice(t,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}coveringTiles(y){return hi(this.transform,y)}calculateCameraOptionsFromTo(y,t,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(y,t,a,c)}resize(y,t=!0){const[a,c]=this._containerDimensions(),f=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,f),this.painter.resize(a,c,f),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const E=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,E),this.painter.resize(a,c,E)}this._resizeTransform(t);const v=!this._moving;return v&&(this.stop(),this.fire(new l.l("movestart",y)).fire(new l.l("move",y))),this.fire(new l.l("resize",y)),v&&this.fire(new l.l("moveend",y)),this}_resizeTransform(y=!0){var t;const[a,c]=this._containerDimensions();this.transform.resize(a,c,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c,y)}_getClampedPixelRatio(y,t){const{0:a,1:c}=this._maxCanvasSize,f=this.getPixelRatio(),v=y*f,w=t*f;return Math.min(v>a?a/v:1,w>c?c/w:1)*f}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Jn.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.setMinPitch(y),this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(y>=this.transform.minPitch)return this.transform.setMaxPitch(y),this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.setRenderWorldCopies(y),this._update()}setTransformConstrain(y){return this.transform.setConstrainOverride(y),this._update()}project(y){return this.transform.locationToScreenPoint(l.V.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.screenPointToLocation(l.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,t,a){if(y==="mouseenter"||y==="mouseover"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:v=>{const w=t.filter((P=>this.getLayer(P))),E=w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[];E.length?c||(c=!0,a.call(this,new sr(y,this,v.originalEvent,{features:E}))):c=!1},mouseout:()=>{c=!1}}}}if(y==="mouseleave"||y==="mouseout"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:w=>{const E=t.filter((P=>this.getLayer(P)));(E.length!==0?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?c=!0:c&&(c=!1,a.call(this,new sr(y,this,w.originalEvent)))},mouseout:w=>{c&&(c=!1,a.call(this,new sr(y,this,w.originalEvent)))}}}}{const c=f=>{const v=t.filter((E=>this.getLayer(E))),w=v.length!==0?this.queryRenderedFeatures(f.point,{layers:v}):[];w.length&&(f.features=w,a.call(this,f),delete f.features)};return{layers:t,listener:a,delegates:{[y]:c}}}}_saveDelegatedListener(y,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(t)}_removeDelegatedListener(y,t,a){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const c=this._delegatedListeners[y];for(let f=0;f<c.length;f++){const v=c[f];if(v.listener===a&&v.layers.length===t.length&&v.layers.every((w=>t.includes(w)))){for(const w in v.delegates)this.off(w,v.delegates[w]);return void c.splice(f,1)}}}on(y,t,a){if(a===void 0)return super.on(y,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(y,c,a);this._saveDelegatedListener(y,f);for(const v in f.delegates)this.on(v,f.delegates[v]);return{unsubscribe:()=>{this._removeDelegatedListener(y,c,a)}}}once(y,t,a){if(a===void 0)return super.once(y,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(y,c,a);for(const v in f.delegates){const w=f.delegates[v];f.delegates[v]=(...E)=>{this._removeDelegatedListener(y,c,a),w(...E)}}this._saveDelegatedListener(y,f);for(const v in f.delegates)this.once(v,f.delegates[v]);return this}off(y,t,a){return a===void 0?super.off(y,t):(this._removeDelegatedListener(y,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(y,t){if(!this.style)return[];let a;const c=y instanceof l.P||Array.isArray(y),f=c?y:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:y)||{},f instanceof l.P||typeof f[0]=="number")a=[l.P.convert(f)];else{const v=l.P.convert(f[0]),w=l.P.convert(f[1]);a=[v,new l.P(w.x,v.y),w,new l.P(v.x,w.y),v]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(y,t){return this.style.querySourceFeatures(y,t)}setStyle(y,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(y,t))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const t=this._locale[y];if(t==null)throw new Error(`Missing UI string '${y}'`);return t}_updateStyle(y,t){var a,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(y,t)));const f=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new bo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,t,f):this.style.loadJSON(y,t,f),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new bo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,t){if(typeof y=="string"){const a=this._requestManager.transformRequest(y,"Style");l.j(a,new AbortController).then((c=>{this._updateDiff(c.data,t)})).catch((c=>{c&&this.fire(new l.k(c))}))}else typeof y=="object"&&this._updateDiff(y,t)}_updateDiff(y,t){try{this.style.setState(y,t)&&this._update(!0)}catch(a){l.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(y,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(y,t){return this._lazyInitEmptyStyle(),this.style.addSource(y,t),this._update(!0)}isSourceLoaded(y){const t=this.style&&this.style.tileManagers[y];if(t!==void 0)return t.loaded();this.fire(new l.k(new Error(`There is no tile manager with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const t=this.style.tileManagers[y.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===y.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===y.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dn(this.painter,t,y),this.painter.renderToTexture=new es(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==y.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:y})),this}getTerrain(){var y,t;return(t=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const y=this.style&&this.style.tileManagers;for(const t of Object.values(y))if(!t.areTilesLoaded())return!1;return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}setSourceTileLodParams(y,t,a){if(a){const c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=kn(Math.max(1,y),Math.max(1,t))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=kn(Math.max(1,y),Math.max(1,t));return this._update(!0),this}refreshTiles(y,t){const a=this.style.tileManagers[y];if(!a)throw new Error(`There is no tile manager with ID "${y}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((c=>new l.ac(c.z,c.x,c.y))))}addImage(y,t,a={}){const{pixelRatio:c=1,sdf:f=!1,stretchX:v,stretchY:w,content:E,textFitWidth:P,textFitHeight:R}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:V,data:j}=t,X=t;return this.style.addImage(y,{data:new l.R({width:O,height:V},new Uint8Array(j)),pixelRatio:c,stretchX:v,stretchY:w,content:E,textFitWidth:P,textFitHeight:R,sdf:f,version:0,userImage:X}),X.onAdd&&X.onAdd(this,y),this}}{const{width:O,height:V,data:j}=be.getImageData(t);this.style.addImage(y,{data:new l.R({width:O,height:V},j),pixelRatio:c,stretchX:v,stretchY:w,content:E,textFitWidth:P,textFitHeight:R,sdf:f,version:0})}}updateImage(y,t){const a=this.style.getImage(y);if(!a)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||l.b(t)?be.getImageData(t):t,{width:f,height:v,data:w}=c;if(f===void 0||v===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||v!==a.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||l.b(t));return a.data.replace(w,E),this.style.updateImage(y,a),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return st.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,t){return this._lazyInitEmptyStyle(),this.style.addLayer(y,t),this._update(!0)}moveLayer(y,t){return this.style.moveLayer(y,t),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,t,a){return this.style.setLayerZoomRange(y,t,a),this._update(!0)}setFilter(y,t,a={}){return this.style.setFilter(y,t,a),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,t,a,c={}){return this.style.setPaintProperty(y,t,a,c),this._update(!0)}getPaintProperty(y,t){return this.style.getPaintProperty(y,t)}setLayoutProperty(y,t,a,c={}){return this.style.setLayoutProperty(y,t,a,c),this._update(!0)}getLayoutProperty(y,t){return this.style.getLayoutProperty(y,t)}setGlyphs(y,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,t,a,(c=>{c||this._update(!0)})),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,t,(a=>{a||this._update(!0)})),this}setLight(y,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(y,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,t){return this.style.setFeatureState(y,t),this._update()}removeFeatureState(y,t){return this.style.removeFeatureState(y,t),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,t=0;return this._container&&(y=this._container.clientWidth||400,t=this._container.clientHeight||300),[y,t]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const t=this._canvasContainer=ie.create("div","maplibregl-canvas-container",y);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=ie.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const f=this._controlContainer=ie.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{v[w]=ie.create("div",`maplibregl-ctrl-${w} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,t,a){this._canvas.width=Math.floor(a*y),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const y=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{t={requestedAttributes:y},c&&(t.statusMessage=c.statusMessage,t.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,y):this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y),!a){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new Lf(a,this.transform),Le.testSupport(a)}migrateProjection(y,t){super.migrateProjection(y,t),this.painter.transform=y,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){var t,a,c,f,v;const w=this._idleTriggered?this._fadeDuration:0,E=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let P=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,j=fe();this.style.zoomHistory.update(V,j);const X=new l.H(V,{now:j,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=X.crossFadingFactor();Q===1&&Q===this._crossFadingFactor||(P=!0,this._crossFadingFactor=Q),this.style.update(X)}const R=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==E;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(v=this.style.projection)===null||v===void 0?void 0:v.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cG.mark(l.cH.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||P)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const O=this._sourcesDirty||this._styleDirty||this._placementDirty;return O||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,l.cG.mark(l.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),st.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ie.remove(this._canvasContainer),ie.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cG.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,be.frame(this._frameRequest,(y=>{l.cG.frame(y),this._frameRequest=null;try{this._render(y)}catch(t){if(!l.Z(t)&&!(function(a){return a.message===zo})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return ml}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(y){return this._lazyInitEmptyStyle(),this.style.setProjection(y),this._update(!0)}},A.MapMouseEvent=sr,A.MapTouchEvent=Ka,A.MapWheelEvent=ch,A.Marker=gu,A.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);t.title=c,t.setAttribute("aria-label",c)},this.options=l.e({},gd,y),this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),ie.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),ie.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=ie.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new si(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ie.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,t){const a=ie.create("button",y,this._container);return a.type="button",a.addEventListener("click",t),a}},A.Popup=class extends l.E{constructor(y){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ie.remove(this._content),this._container&&(ie.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ie.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ie.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=oc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const f=cc(this.options.offset);if(!c){const w=this._container.offsetWidth,E=this._container.offsetHeight;let P;P=a.y+f.bottom.y<E?["top"]:a.y>this._map.transform.height-E?["bottom"]:[],a.x<w/2?P.push("left"):a.x>this._map.transform.width-w/2&&P.push("right"),c=P.length===0?"bottom":P.join("-")}let v=a.add(f[c]);this.options.subpixelPositioning||(v=v.round()),ie.setTransform(this._container,`${lc[c]} translate(${v.x}px,${v.y}px)`),mu(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(gl),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.V.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const t=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=y;c=a.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ie.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=ie.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(yl);y&&y.focus()}},A.RasterDEMTileSource=Hr,A.RasterTileSource=ur,A.ScaleControl=class{constructor(y){this._onMove=()=>{gi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,gi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Er),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ie.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},A.ScrollZoomHandler=hu,A.Style=bo,A.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ie.create("button","maplibregl-ctrl-terrain",this._container),ie.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ie.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},A.TwoFingersTouchPitchHandler=Js,A.TwoFingersTouchRotateHandler=uu,A.TwoFingersTouchZoomHandler=Ds,A.TwoFingersTouchZoomRotateHandler=fl,A.VectorTileSource=cr,A.VideoSource=Be,A.addSourceType=(y,t)=>l._(void 0,void 0,void 0,(function*(){if(K(y))throw new Error(`A source type called "${y}" already exists.`);((a,c)=>{$[a]=c})(y,t)})),A.clearPrewarmedResources=function(){const y=Vt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Mt),Vt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},A.createTileMesh=wf,A.getMaxParallelImageRequests=function(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS},A.getRTLTextPluginStatus=function(){return ze().getRTLTextPluginStatus()},A.getVersion=function(){return ns},A.getWorkerCount=function(){return Ft.workerCount},A.getWorkerUrl=function(){return l.c.WORKER_URL},A.importScriptInWorkers=function(y){return ai().broadcast("IS",y)},A.isTimeFrozen=function(){return Ie.isFrozen()},A.now=fe,A.prewarm=function(){Qt().acquire(Mt)},A.restoreNow=function(){Ie.restoreNow()},A.setMaxParallelImageRequests=function(y){l.c.MAX_PARALLEL_IMAGE_REQUESTS=y},A.setNow=function(y){Ie.setNow(y)},A.setRTLTextPlugin=function(y,t){return ze().setRTLTextPlugin(y,t)},A.setWorkerCount=function(y){Ft.workerCount=y},A.setWorkerUrl=function(y){l.c.WORKER_URL=y}}));var k=b;return k}))})(wy)),wy.exports}var e1=hA();const t1=Ly(e1),dA=D1({__proto__:null,default:t1},[e1]),Bl={PARKING_LOG:31417,OPEN_SPOT_BROADCAST:31714,ROUTE_LOG:34171},Zo=["wss://relay.damus.io","wss://nos.lol","wss://relay.primal.net","wss://relay.snort.social"];var L_={},Zv;function fA(){if(Zv)return L_;Zv=1;var h=function(){},m="+",b=8,S="0",z="23456789CFGHJMPQRVWX",k=z.length,A=90,l=180,N=10,W=[20,1,.05,.0025,125e-6],ne=4,re=5,Me=125e-6,be=6;h.prototype.isValid=function(ke){if(!ke||ke.indexOf(m)==-1||ke.indexOf(m)!=ke.lastIndexOf(m)||ke.length==1||ke.indexOf(m)>b||ke.indexOf(m)%2==1)return!1;if(ke.indexOf(S)>-1){if(ke.indexOf(S)==0)return!1;var ct=ke.match(new RegExp("("+S+"+)","g"));if(ct.length>1||ct[0].length%2==1||ct[0].length>b-2||ke.charAt(ke.length-1)!=m)return!1}if(ke.length-ke.indexOf(m)-1==1)return!1;ke=ke.replace(new RegExp("\\"+m+"+"),"").replace(new RegExp(S+"+"),"");for(var it=0,lt=ke.length;it<lt;it++){var Et=ke.charAt(it).toUpperCase();if(Et!=m&&z.indexOf(Et)==-1)return!1}return!0},h.prototype.isShort=function(ke){return this.isValid(ke)?ke.indexOf(m)>=0&&ke.indexOf(m)<b:!1},h.prototype.isFull=function(ke){if(!this.isValid(ke)||this.isShort(ke))return!1;var ct=z.indexOf(ke.charAt(0).toUpperCase())*k;if(ct>=A*2)return!1;if(ke.length>1){var it=z.indexOf(ke.charAt(1).toUpperCase())*k;if(it>=l*2)return!1}return!0},h.prototype.encode=function(ke,ct,it){if(typeof it>"u"&&(it=N),it<2||it<b&&it%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";ke=Ie(ke),ct=ie(ct),ke==90&&(ke=ke-fe(it));var lt=Le(ke,ct,Math.min(it,N));return it>N&&(lt+=Ke(ke,ct,it-N)),lt},h.prototype.decode=function(ke){if(!this.isFull(ke))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+ke;ke=ke.replace(m,""),ke=ke.replace(new RegExp(S+"+"),""),ke=ke.toUpperCase();var ct=ht(ke.substring(0,N));if(ke.length<=N)return ct;var it=zt(ke.substring(N));return tt(ct.latitudeLo+it.latitudeLo,ct.longitudeLo+it.longitudeLo,ct.latitudeLo+it.latitudeHi,ct.longitudeLo+it.longitudeHi,ct.codeLength+it.codeLength)},h.prototype.recoverNearest=function(ke,ct,it){if(!this.isShort(ke)){if(this.isFull(ke))return ke;throw"ValueError: Passed short code is not valid: "+ke}ct=Ie(ct),it=ie(it),ke=ke.toUpperCase();var lt=b-ke.indexOf(m),Et=Math.pow(20,2-lt/2),qt=Et/2,$t=Math.floor(ct/Et)*Et,ut=Math.floor(it/Et)*Et,we=this.decode(this.encode($t,ut).substr(0,lt)+ke),$e=we.latitudeCenter-ct;return $e>qt?we.latitudeCenter-=Et:$e<-qt&&(we.latitudeCenter+=Et),$e=we.longitudeCenter-it,$e>qt?we.longitudeCenter-=Et:$e<-qt&&(we.longitudeCenter+=Et),this.encode(we.latitudeCenter,we.longitudeCenter,we.codeLength)},h.prototype.shorten=function(lt,ct,it){if(!this.isFull(lt))throw"ValueError: Passed code is not valid and full: "+lt;if(lt.indexOf(S)!=-1)throw"ValueError: Cannot shorten padded codes: "+lt;var lt=lt.toUpperCase(),Et=this.decode(lt);if(Et.codeLength<be)throw"ValueError: Code length must be at least "+be;ct=Ie(ct),it=ie(it);for(var qt=Math.max(Math.abs(Et.latitudeCenter-ct),Math.abs(Et.longitudeCenter-it)),$t=W.length-2;$t>=1;$t--)if(qt<W[$t]*.3)return lt.substring(($t+1)*2);return lt};var Ie=function(ke){return Math.min(90,Math.max(-90,ke))},fe=function(ke){return ke<=10?Math.pow(20,Math.floor(ke/-2+2)):Math.pow(20,-3)/Math.pow(re,ke-10)},ie=function(ke){for(;ke<-180;)ke=ke+360;for(;ke>=180;)ke=ke-360;return ke},Le=function(ke,ct,it){for(var lt="",Et=ke+A,qt=ct+l,$t=0;$t<it;){var ut=W[Math.floor($t/2)],we=Math.floor(Et/ut);Et-=we*ut,lt+=z.charAt(we),$t+=1,we=Math.floor(qt/ut),qt-=we*ut,lt+=z.charAt(we),$t+=1,$t==b&&$t<it&&(lt+=m)}return lt.length<b&&(lt=lt+Array(b-lt.length+1).join(S)),lt.length==b&&(lt=lt+m),lt},Ke=function(ke,ct,it){for(var lt="",Et=Me,qt=Me,$t=(ke+A)%Et,ut=(ct+l)%qt,we=0;we<it;we++){var $e=Math.floor($t/(Et/re)),mt=Math.floor(ut/(qt/ne));Et/=re,qt/=ne,$t-=$e*Et,ut-=mt*qt,lt+=z.charAt($e*ne+mt)}return lt},ht=function(ke){var ct=Ct(ke,0),it=Ct(ke,1);return new tt(ct[0]-A,it[0]-l,ct[1]-A,it[1]-l,ke.length)},Ct=function(ke,ct){for(var it=0,lt=0;it*2+ct<ke.length;)lt+=z.indexOf(ke.charAt(it*2+ct))*W[it],it+=1;return[lt,lt+W[it-1]]},zt=function(ke){for(var ct=0,it=0,lt=Me,Et=Me,qt=0;qt<ke.length;){var $t=z.indexOf(ke.charAt(qt)),ut=Math.floor($t/ne),we=$t%ne;lt/=re,Et/=ne,ct+=ut*lt,it+=we*Et,qt+=1}return tt(ct,it,ct+lt,it+Et,ke.length)},tt=h.prototype.CodeArea=function(ke,ct,it,lt,Et){return new st.init(ke,ct,it,lt,Et)},st={init:function(ke,ct,it,lt,Et){this.latitudeLo=ke,this.longitudeLo=ct,this.latitudeHi=it,this.longitudeHi=lt,this.codeLength=Et,this.latitudeCenter=Math.min(ke+(it-ke)/2,A),this.longitudeCenter=Math.min(ct+(lt-ct)/2,l)}};return L_.OpenLocationCode=h,L_}var pA=fA();const mA=Ly(pA);function Iy(h,m,b=10){const S=[16,8,4,2,1],z="0123456789bcdefghjkmnpqrstuvwxyz";let k=!0,A=-90,l=90,N=-180,W=180,ne="",re=0,Me=0;for(;ne.length<b;){if(k){const be=(N+W)/2;m>be?(Me|=S[re],N=be):W=be}else{const be=(A+l)/2;h>be?(Me|=S[re],A=be):l=be}k=!k,re<4?re++:(ne+=z[Me],re=0,Me=0)}return ne}function gA(h,m){return`${h.toFixed(6)}, ${m.toFixed(6)}`}function yA(h,m,b=5){const S=Iy(h,m,b),z=b===5?.02:b===6?.005:.001,k=b===5?.04:b===6?.01:.002,A=new Set;A.add(S);const l=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[N,W]of l){const ne=h+N*z,re=m+W*k;A.add(Iy(ne,re,b))}return Array.from(A)}const Hv=mA,zc=Hv.default||Hv;function $v(h){const m=h.trim();if(m.replace(//g,"").replace(/,/g," ").split(/\s+/).filter(z=>z.length>0).length>=2){let z=null,k=null;const A=m.match(/^(-?\d+(\.\d+)?)[,\s]+(-?\d+(\.\d+)?)$/);if(A)z=parseFloat(A[1]),k=parseFloat(A[3]);else{const l=m.matchAll(/([0-9.-]+)\s*?\s*([NSEWnsew])?/g),N=Array.from(l);if(N.length===2){const W=parseFloat(N[0][1]),ne=N[0][2]?.toUpperCase(),re=parseFloat(N[1][1]),Me=N[1][2]?.toUpperCase(),be=(ie,Le)=>{let Ke=ie;return(Le==="S"||Le==="W")&&(Ke=-ie),Le==="N"||Le==="S"?{type:"lat",val:Ke}:Le==="E"||Le==="W"?{type:"lon",val:Ke}:{type:"unknown",val:Ke}},Ie=be(W,ne),fe=be(re,Me);Ie.type==="lat"&&fe.type==="lon"?(z=Ie.val,k=fe.val):Ie.type==="lon"&&fe.type==="lat"?(k=Ie.val,z=fe.val):Ie.type==="unknown"&&fe.type==="unknown"&&(z=Ie.val,k=fe.val)}}if(z!==null&&k!==null&&!isNaN(z)&&!isNaN(k)&&z>=-90&&z<=90&&k>=-180&&k<=180)return{lat:z,lon:k,type:"coordinate"}}try{if(zc&&zc.isValid&&zc.isValid(m)&&zc.isFull(m)){const k=zc.decode(m);return{lat:k.latitudeCenter,lon:k.longitudeCenter,type:"plus_code"}}const z=m.toUpperCase().replace(/\s+/g,"+");if(z!==m&&zc&&zc.isValid&&zc.isValid(z)&&zc.isFull(z)){const k=zc.decode(z);return{lat:k.latitudeCenter,lon:k.longitudeCenter,type:"plus_code"}}}catch{}return null}async function n1(h,m,b){const S=JSON.stringify(h);if(b){const z=ug.getConversationKey(b,m);return ug.encrypt(S,z)}else if(window.nostr?.nip44?.encrypt)return await window.nostr.nip44.encrypt(m,S);throw new Error("No encryption method available")}async function i1(h,m,b){let S;if(b){const z=ug.getConversationKey(b,m);S=ug.decrypt(h,z)}else if(window.nostr?.nip44?.decrypt)S=await window.nostr.nip44.decrypt(m,h);else throw new Error("No decryption method available");return JSON.parse(S)}const ky={IN:"INR",US:"USD",GB:"GBP",DE:"EUR",FR:"EUR",ES:"EUR",IT:"EUR",NL:"EUR",BE:"EUR",AT:"EUR",PT:"EUR",IE:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CN:"CNY",AE:"AED",SG:"SGD",HK:"HKD",CH:"CHF",SE:"SEK",NO:"NOK",DK:"DKK",NZ:"NZD",MX:"MXN",BR:"BRL",ZA:"ZAR",KR:"KRW",TH:"THB",MY:"MYR",PH:"PHP",ID:"IDR",VN:"VND",RU:"RUB",PL:"PLN",TR:"TRY",SA:"SAR",EG:"EGP"};async function _A(h,m){try{const b=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${h}&lon=${m}&zoom=3`,{headers:{"User-Agent":"Parlens-PWA/1.0"}});if(!b.ok)throw new Error("Geocoding failed");const z=(await b.json()).address?.country_code?.toUpperCase();return z&&ky[z]?ky[z]:"USD"}catch(b){return console.warn("Currency detection failed, using locale fallback:",b),r1()}}function r1(){try{const m=window.navigator.language.split("-")[1]?.toUpperCase();return m&&ky[m]?ky[m]:"USD"}catch{return"USD"}}function hg(h){try{return 0 .toLocaleString(window.navigator.language,{style:"currency",currency:h,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}catch{return{INR:"",USD:"$",GBP:"",EUR:"",JPY:"",CAD:"C$",AUD:"A$",CNY:"",AED:".",SGD:"S$"}[h]||"$"}}const vA={INR:"IN",USD:"US",GBP:"GB",EUR:"EU",JPY:"JP",CAD:"CA",AUD:"AU",CNY:"CN",AED:"AE",SGD:"SG",HKD:"HK",CHF:"CH",SEK:"SE",NOK:"NO",DKK:"DK",NZD:"NZ",MXN:"MX",BRL:"BR",ZAR:"ZA",KRW:"KR",THB:"TH",MYR:"MY",PHP:"PH",IDR:"ID",VND:"VN",RUB:"RU",PLN:"PL",TRY:"TR",SAR:"SA",EGP:"EG"};function xA(h){return(vA[h]||"US").toUpperCase().replace(/./g,b=>String.fromCodePoint(b.charCodeAt(0)+127397))}var cf=Symbol("verified"),bA=h=>h instanceof Object;function a1(h){if(!bA(h)||typeof h.kind!="number"||typeof h.content!="string"||typeof h.created_at!="number"||typeof h.pubkey!="string"||!h.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(h.tags))return!1;for(let m=0;m<h.tags.length;m++){let b=h.tags[m];if(!Array.isArray(b))return!1;for(let S=0;S<b.length;S++)if(typeof b[S]!="string")return!1}return!0}new TextDecoder("utf-8");var wA=new TextEncoder,TA=class{generateSecretKey(){return Pc.utils.randomPrivateKey()}getPublicKey(h){return Br(Pc.getPublicKey(h))}finalizeEvent(h,m){const b=h;return b.pubkey=Br(Pc.getPublicKey(m)),b.id=Ty(b),b.sig=Br(Pc.sign(Ty(b),m)),b[cf]=!0,b}verifyEvent(h){if(typeof h[cf]=="boolean")return h[cf];const m=Ty(h);if(m!==h.id)return h[cf]=!1,!1;try{const b=Pc.verify(h.sig,m,h.pubkey);return h[cf]=b,b}catch{return h[cf]=!1,!1}}};function s1(h){if(!a1(h))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content])}function Ty(h){let m=Xh(wA.encode(s1(h)));return Br(m)}var Wy=new TA,o1=Wy.generateSecretKey,SA=Wy.getPublicKey,l1=Wy.finalizeEvent;Wy.verifyEvent;const EA=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent:l1,generateSecretKey:o1,getEventHash:Ty,getPublicKey:SA,serializeEvent:s1,validateEvent:a1,verifiedSymbol:cf},Symbol.toStringTag,{value:"Module"})),MA=({status:h,setStatus:m,searchLocation:b,vehicleType:S,setOpenSpots:z,parkLocation:k,setParkLocation:A,sessionStart:l,setSessionStart:N})=>{const{pubkey:W,pool:ne,signEvent:re}=Wp(),[Me,be]=Ae.useState(!1),[Ie,fe]=Ae.useState("0"),[ie,Le]=Ae.useState("USD"),[Ke,ht]=Ae.useState("$"),[Ct,zt]=Ae.useState("00:00:00");Ae.useEffect(()=>{if(h==="parked"&&l){const ke=()=>{const lt=Math.floor(Date.now()/1e3)-l,Et=Math.floor(lt/3600),qt=Math.floor(lt%3600/60),$t=lt%60;zt(`${Et.toString().padStart(2,"0")}:${qt.toString().padStart(2,"0")}:${$t.toString().padStart(2,"0")}`)},ct=setInterval(ke,1e3);return ke(),()=>clearInterval(ct)}},[h,l]),Ae.useEffect(()=>{if(h==="search"&&b){const ke=yA(b[0],b[1],5);console.log("[Parlens] Starting spot search with polling in geohashes:",ke);const ct=async()=>{try{const Et=Math.floor(Date.now()/1e3),qt=await ne.querySync(Zo,{kinds:[Bl.OPEN_SPOT_BROADCAST],"#g":ke,since:Et-600}),$t=Math.floor(Date.now()/1e3),ut=[];for(const we of qt){const $e=we.tags.find(mt=>mt[0]==="expiration");if(!($e&&parseInt($e[1])<$t))try{const mt=we.tags,vt=mt.find(wt=>wt[0]==="location"),Ut=mt.find(wt=>wt[0]==="hourly_rate"),xe=mt.find(wt=>wt[0]==="currency"),Ye=mt.find(wt=>wt[0]==="type");if(vt){const[wt,Mt]=vt[1].split(",").map(Number),Ft=Ye?Ye[1]:"car";ut.push({id:we.id,lat:wt,lon:Mt,price:Ut?parseFloat(Ut[1]):0,currency:xe?xe[1]:"USD",type:Ft})}}catch(mt){console.warn("[Parlens] Error parsing spot:",mt)}}console.log("[Parlens] Found",ut.length,"valid spots"),z(ut)}catch(Et){console.error("[Parlens] Spot query error:",Et)}};ct();const it=setInterval(ct,1e4),lt=()=>{console.log("[Parlens] Visibility refresh triggered, searching spots..."),ct()};return window.addEventListener("visibility-refresh",lt),()=>{console.log("[Parlens] Stopping spot search"),clearInterval(it),window.removeEventListener("visibility-refresh",lt)}}else z([])},[h,S,ne,b]),Ae.useEffect(()=>{(async()=>{const ct=r1();if(Le(ct),ht(hg(ct)),b)try{const it=await _A(b[0],b[1]);Le(it),ht(hg(it))}catch{console.warn("GPS currency detection failed")}})()},[b]);const tt=async()=>{h==="idle"?m("search"):h==="search"?(N(Math.floor(Date.now()/1e3)),A(b?[b[0],b[1]]:null),m("parked")):h==="parked"&&(fe("0"),be(!0))},st=async()=>{m("idle"),be(!1);const ke=k?k[0]:b?b[0]:0,ct=k?k[1]:b?b[1]:0,it=Iy(ke,ct,5),lt=Math.floor(Date.now()/1e3),Et=l||lt;try{const qt={status:"vacated",lat:ke,lon:ct,geohash:it,fee:Ie,currency:ie,type:S,started_at:Et,finished_at:lt},$t=localStorage.getItem("parlens_privkey"),ut=$t?new Uint8Array($t.match(/.{1,2}/g).map(Qt=>parseInt(Qt,16))):void 0,we=await n1(qt,W,ut),$e={kind:Bl.PARKING_LOG,content:we,tags:[["d",`session_${Et}`],["client","parlens"]],created_at:lt,pubkey:W},mt=await re($e);console.log("Publishing log:",mt.id,"to",Zo);const vt=await Promise.allSettled(ne.publish(Zo,mt)),Ut=vt.filter(Qt=>Qt.status==="fulfilled").length,xe=vt.filter(Qt=>Qt.status==="rejected").length;console.log(`[Parlens] Publish results: ${Ut}/${vt.length} succeeded, ${xe} failed`),vt.forEach((Qt,Dn)=>{Qt.status==="rejected"&&console.warn(`[Parlens] Relay ${Zo[Dn]} failed:`,Qt.reason)}),Ut===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),console.log("Log published"),await new Promise(Qt=>setTimeout(Qt,300)),window.dispatchEvent(new Event("parking-log-updated"));const Ye=o1(),wt=lt-Et,Mt=Math.max(Math.ceil(wt/3600),1),Ft=String(Math.round(parseFloat(Ie)/Mt)),Zt=lt+300,Vt={kind:Bl.OPEN_SPOT_BROADCAST,content:"",tags:[["d",`spot_${it}_${lt}`],["g",it],["location",`${ke},${ct}`],["hourly_rate",Ft],["currency",ie],["type",S],["expiration",String(Zt)],["client","parlens"]],created_at:lt},ln=l1(Vt,Ye);console.log("[Parlens] *** BROADCASTING OPEN SPOT ***"),console.log("[Parlens] Geohash:",it),console.log("[Parlens] Location:",`${ke},${ct}`),console.log("[Parlens] Event ID:",ln.id),console.log("[Parlens] Pubkey:",ln.pubkey.substring(0,20)+"..."),ne.publish(Zo,ln),N(null),A(null)}catch(qt){console.error("Persistence error:",qt),alert("Could not save to Nostr. Check relay connections.")}};return U.jsxs("div",{className:"relative flex flex-col items-end gap-4",children:[U.jsxs("div",{className:"flex items-center gap-4",children:[h==="search"&&U.jsx("button",{onClick:()=>m("idle"),className:"h-14 px-8 rounded-full bg-red-500/90 text-white font-bold text-xs tracking-widest shadow-2xl backdrop-blur-md animate-in slide-in-from-left-8",children:"CANCEL"}),h==="parked"&&U.jsx("div",{className:"h-14 px-6 rounded-full bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-2xl flex items-center justify-center animate-in slide-in-from-left-8 pointer-events-none",children:U.jsx("span",{className:"font-mono text-xl font-bold tabular-nums text-zinc-900 dark:text-white",children:Ct})}),U.jsxs("button",{onClick:tt,className:`h-20 w-20 flex items-center justify-center rounded-[2.5rem] shadow-2xl transition-all active:scale-90 ${h==="idle"?"bg-[#007AFF] text-white shadow-blue-500/20":h==="search"?"bg-[#FF9500] text-white shadow-orange-500/20":"bg-[#34C759] text-white shadow-green-500/20"}`,children:[h==="idle"&&U.jsx(zM,{size:32,strokeWidth:2.5}),h==="search"&&U.jsx(gf,{size:32,strokeWidth:2.5,className:"animate-pulse"}),h==="parked"&&(S==="bicycle"?U.jsx("span",{className:"text-3xl",children:""}):S==="motorcycle"?U.jsx("span",{className:"text-3xl",children:""}):U.jsx("span",{className:"text-3xl",children:""}))]})]}),Me&&U.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:U.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[U.jsxs("div",{className:"text-center space-y-1",children:[U.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),U.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee, 0 if free parking"})]}),U.jsxs("div",{className:"flex items-center gap-4",children:[U.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[U.jsx("span",{className:"text-2xl font-bold text-blue-500",children:Ke}),U.jsx("input",{type:"number",value:Ie,onChange:ke=>fe(ke.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),U.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:ie})]}),U.jsxs("div",{className:"flex flex-col gap-1.5",children:[U.jsx("button",{onClick:()=>fe(String(Math.max(0,parseFloat(Ie||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:U.jsx(N0,{size:22,className:"text-zinc-600 dark:text-white/70"})}),U.jsx("button",{onClick:()=>fe(String(Math.max(0,parseFloat(Ie||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:U.jsx(Bu,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),U.jsxs("div",{className:"w-full space-y-3",children:[U.jsxs("button",{onClick:st,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",U.jsx(JE,{size:20})]}),U.jsx("button",{onClick:()=>be(!1),className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})};function AA(){const{pool:h,pubkey:m}=Wp(),[b,S]=Ae.useState([]),[z,k]=Ae.useState(!0),A=Ae.useRef(new Set),l=Ae.useCallback(async()=>{if(!(!m||!h)){k(!0),console.log("[useParkingLogs] Fetching logs for",m);try{const W=await h.querySync(Zo,{kinds:[Bl.PARKING_LOG,5],authors:[m],limit:100});console.log("[useParkingLogs] Fetched",W.length,"events");const ne=new Set,re=W.filter(fe=>fe.kind===5);for(const fe of re)for(const ie of fe.tags)ie[0]==="a"&&ne.add(ie[1]);const be=W.filter(fe=>fe.kind===Bl.PARKING_LOG).filter(fe=>{const ie=fe.tags?.find(Ke=>Ke[0]==="d")?.[1];if(!ie)return!0;if(A.current.has(ie))return!1;const Le=`${fe.kind}:${fe.pubkey}:${ie}`;return!ne.has(Le)});console.log("[useParkingLogs] Valid logs after filtering:",be.length);const Ie=be.sort((fe,ie)=>ie.created_at-fe.created_at);S(Ie)}catch(W){console.error("[useParkingLogs] Fetch error:",W)}finally{k(!1)}}},[h,m]),N=Ae.useCallback(W=>{console.log("[useParkingLogs] Marking deleted:",W),A.current.add(W)},[]);return Ae.useEffect(()=>{m&&l()},[m,l]),Ae.useEffect(()=>{const W=()=>{console.log("[useParkingLogs] Received update event, refetching..."),l()};return window.addEventListener("parking-log-updated",W),window.addEventListener("visibility-refresh",W),()=>{window.removeEventListener("parking-log-updated",W),window.removeEventListener("visibility-refresh",W)}},[l]),{logs:b,loading:z,refetch:l,markDeleted:N}}const CA=({setHistorySpots:h,onOpenChange:m})=>{const{pubkey:b,logout:S,pool:z,signEvent:k}=Wp(),{logs:A,refetch:l,markDeleted:N}=AA(),[W,ne]=Ae.useState(!1),[re,Me]=Ae.useState(!1);Ae.useEffect(()=>{m?.(W)},[W,m]);const[be,Ie]=Ae.useState(null),[fe,ie]=Ae.useState([]),[Le,Ke]=Ae.useState(!1),ht=async zt=>{if(!(!b||!confirm("Are you sure you want to delete this parking entry? This action cannot be undone."))){Me(!0);try{const tt=zt.tags?.find(ct=>ct[0]==="d")?.[1];if(!tt)throw new Error("Missing d tag on event");const st={kind:5,content:"Deleted by user",tags:[["a",`${Bl.PARKING_LOG}:${b}:${tt}`],["k",String(Bl.PARKING_LOG)]],created_at:Math.floor(Date.now()/1e3),pubkey:b},ke=await k(st);await Promise.allSettled(z.publish(Zo,ke)),N(tt),ie(ct=>ct.filter(it=>it.id!==zt.id))}catch(tt){console.error("Failed to delete parking log:",tt),alert("Failed to delete. Please try again.")}finally{Me(!1)}}};Ae.useEffect(()=>{b&&(async()=>{const tt=await z.get(Zo,{kinds:[0],authors:[b]});if(tt)try{const st=JSON.parse(tt.content);Ie({name:st.name||st.display_name||"Nostr User",npub:ff.npubEncode(b),picture:st.picture})}catch(st){console.error("Error parsing profile:",st)}else Ie({name:"Nostr User",npub:ff.npubEncode(b),picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${b}`})})()},[b,z]),Ae.useEffect(()=>{(async()=>{if(!b||!A.length)return;const tt=localStorage.getItem("parlens_privkey"),st=tt?new Uint8Array(tt.match(/.{1,2}/g).map(ct=>parseInt(ct,16))):void 0,ke=await Promise.all(A.map(async ct=>{try{const it=await i1(ct.content,b,st);return{...ct,decryptedContent:it}}catch{return{...ct,decryptedContent:null}}}));ie(ke.filter(ct=>ct.decryptedContent))})()},[A,b]),Ae.useEffect(()=>{h&&h(Le?fe:[])},[Le,fe,h]);const Ct=()=>{const zt=localStorage.getItem("parlens_privkey");if(zt){const tt=ff.nsecEncode(new Uint8Array(zt.match(/.{1,2}/g).map(st=>parseInt(st,16))));navigator.clipboard.writeText(tt),alert("Copied to clipboard")}};return U.jsxs(U.Fragment,{children:[U.jsx("button",{onClick:()=>{l(),ne(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Activity Log",children:U.jsx(OM,{size:20})}),W&&U.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[U.jsx("button",{onClick:()=>ne(!1),className:"absolute inset-0 z-0 cursor-default"}),re&&U.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:U.jsxs("div",{className:"flex flex-col items-center gap-3",children:[U.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),U.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),U.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent",children:be?.name||"Nostr User"}),U.jsx("button",{onClick:()=>ne(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:U.jsx(qp,{size:20,className:"text-black/60 dark:text-white/60"})})]}),U.jsxs("div",{className:"space-y-4",children:[U.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Keys"}),U.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[U.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer",onClick:()=>{navigator.clipboard.writeText(be?.npub),alert("Copied to clipboard")},children:[U.jsxs("div",{className:"flex items-center gap-3",children:[U.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400",children:U.jsx(Y_,{size:20})}),U.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),U.jsx(Py,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),localStorage.getItem("parlens_privkey")&&U.jsxs(U.Fragment,{children:[U.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),U.jsxs("div",{onClick:Ct,className:"flex items-center justify-between p-4 cursor-pointer transition-colors active:bg-black/10 dark:active:bg-white/10",children:[U.jsxs("div",{className:"flex items-center gap-3",children:[U.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-500",children:U.jsx(Wb,{size:20})}),U.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),U.jsx(Py,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]})]}),U.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:" Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost."})]}),U.jsxs("div",{className:"space-y-4",children:[U.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking History"}),h&&U.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5 mb-4",children:[U.jsxs("div",{className:"flex items-center gap-3",children:[U.jsx("div",{className:"p-2.5 rounded-xl bg-purple-500/10 dark:bg-purple-500/20 text-purple-500 dark:text-purple-400",children:U.jsx(gf,{size:20})}),U.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show logs on map"})]}),U.jsx("button",{onClick:()=>Ke(!Le),className:`w-12 h-7 rounded-full transition-colors relative ${Le?"bg-blue-500":"bg-zinc-200 dark:bg-white/20"}`,children:U.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${Le?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),U.jsx("div",{className:"space-y-2",children:fe.length>0?fe.map(zt=>{const tt=zt.decryptedContent,st=hg(tt.currency||"USD"),ke=tt.started_at?new Date(tt.started_at*1e3):null,ct=tt.finished_at?new Date(tt.finished_at*1e3):new Date(zt.created_at*1e3),it=tt.lat&&tt.lon?`${tt.lat.toFixed(5)}, ${tt.lon.toFixed(5)}`:null,lt=tt.type||"car",Et=lt==="bicycle"?"":lt==="motorcycle"?"":"";return U.jsxs("div",{className:"p-5 rounded-[2rem] bg-zinc-50 dark:bg-white/[0.03] space-y-3 border border-black/5 dark:border-white/5 text-zinc-900 dark:text-white",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center gap-3",children:[U.jsx("span",{className:"text-2xl",children:Et}),U.jsx("p",{className:"font-bold text-xl",children:`${st}${tt.fee||"0"}`})]}),U.jsxs("div",{className:"flex items-center gap-2",children:[U.jsx("span",{className:"text-2xl",children:xA(tt.currency||"USD")}),U.jsx("button",{onClick:()=>ht(zt),className:"p-1.5 text-zinc-400 dark:text-white/30 transition-colors",title:"Delete entry",children:U.jsx(K_,{size:16})})]})]}),it&&U.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[U.jsx(gf,{size:12,className:"text-blue-500 dark:text-blue-400"}),U.jsx("span",{className:"font-mono",children:it})]}),U.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/30",children:[U.jsx(Yb,{size:12,className:"text-green-500 dark:text-green-400"}),U.jsxs("div",{className:"space-x-1",children:[ke&&U.jsxs("span",{children:["Start: ",ke.toLocaleDateString(void 0,{month:"short",day:"numeric"})," ",ke.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),U.jsx("span",{className:"text-black/10 dark:text-white/10",children:""}),U.jsxs("span",{children:["End: ",ct.toLocaleDateString(void 0,{month:"short",day:"numeric"})," ",ct.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]},zt.id)}):U.jsx("div",{className:"p-10 rounded-[2.5rem] border-2 border-dashed border-black/5 dark:border-white/5 text-center",children:U.jsx("p",{className:"text-sm font-medium text-zinc-400 dark:text-white/10",children:"No recent activity"})})})]}),U.jsx("button",{onClick:()=>{S(),ne(!1)},className:"w-full py-5 rounded-[2rem] bg-zinc-100 dark:bg-zinc-800 text-red-500 font-bold tracking-wide border border-black/5 dark:border-white/5 transition-all active:scale-95 text-center mt-4",children:"Logout"})]})]})]})},zA=({query:h,onSelect:m,countryCode:b,currentLocation:S})=>{const[z,k]=Ae.useState(null),[A,l]=Ae.useState(!1);return Ae.useEffect(()=>{const W=setTimeout(async()=>{if(!(!h||h.length<4)){l(!0);try{let ne=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(h)}&format=json&limit=1`;if(b&&(ne+=`&countrycodes=${b}`),S){const[be,Ie]=S,fe=`${Ie-1},${be+1},${Ie+1},${be-1}`;ne+=`&viewbox=${fe}`}const Me=await(await fetch(ne)).json();Me&&Me.length>0?k(Me[0]):k(null)}catch(ne){console.error(ne),k(null)}finally{l(!1)}}},1e3);return()=>clearTimeout(W)},[h,b,S]),A?U.jsxs("div",{className:"mb-2 p-3 text-xs text-zinc-400 dark:text-white/40 italic flex items-center gap-2",children:[U.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-zinc-300 border-t-zinc-600 animate-spin"}),"Searching..."]}):z?U.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-purple-50 dark:bg-purple-500/10 border border-purple-500/20",children:[U.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-purple-700 dark:text-purple-400 bg-purple-100/50 dark:bg-purple-500/5",children:" Global Search Result"}),U.jsxs("button",{onClick:()=>m(z),className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[U.jsx(gf,{size:16,className:"text-purple-600 dark:text-purple-400 shrink-0"}),U.jsxs("div",{className:"flex-1 truncate",children:[U.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white truncate",children:z.display_name.split(",")[0]}),U.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:z.display_name})]})]})]}):null},PA=({vehicleType:h,onRouteChange:m,currentLocation:b,onDropPinModeChange:S,pendingWaypoints:z,onDropPinConsumed:k,onOpenChange:A,onWaypointsChange:l})=>{const{pool:N,pubkey:W,signEvent:ne}=Wp(),[re,Me]=Ae.useState(!1);Ae.useEffect(()=>{A?.(re)},[re,A]);const[be,Ie]=Ae.useState([]);Ae.useEffect(()=>{l?.(be)},[be,l]);const[fe,ie]=Ae.useState(""),[Le,Ke]=Ae.useState(!1),[ht,Ct]=Ae.useState(null),[zt,tt]=Ae.useState(null),[st,ke]=Ae.useState(!1),ct=Ae.useRef(null),[it,lt]=Ae.useState([]),[Et,qt]=Ae.useState(""),[$t,ut]=Ae.useState(!1),[we,$e]=Ae.useState(!1),[mt,vt]=Ae.useState(!1),[Ut,xe]=Ae.useState(!1),[Ye,wt]=Ae.useState(null),[Mt,Ft]=Ae.useState(""),[Zt,Vt]=Ae.useState(!1),[ln,Qt]=Ae.useState(null),[Dn,ai]=Ae.useState({}),Rn=Ae.useRef(new Set);Ae.useEffect(()=>{(async()=>{if(!(!b||ln))try{const K=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${b[0]}&lon=${b[1]}&format=json`)).json();K&&K.address&&K.address.country_code&&(console.log("[Parlens] Detected Country:",K.address.country_code),Qt(K.address.country_code))}catch($){console.error("[Parlens] Failed to detect country:",$)}})()},[b,ln]);const lr=a0.useMemo(()=>{if(!fe||fe.length<2)return[];const Z=fe.toLowerCase(),$=[];for(const K of it)for(const ue of K.decryptedContent.waypoints)ue.name.toLowerCase().includes(Z)&&($.find(ge=>ge.name.toLowerCase()===ue.name.toLowerCase())||$.push({name:ue.name,lat:ue.lat,lon:ue.lon}));return $.slice(0,5)},[fe,it]),Mn=Z=>{const $=be.filter(K=>K.id!==Z);Ie($),Ct(null),tt(null),Ke(!1),m(null,null,$,!1)},ci=()=>{Ie([]),Ct(null),tt(null),Ke(!1),m(null,null,[],!1)},Ri=(Z,$)=>{if(Z+$<0||Z+$>=be.length)return;const K=[...be];[K[Z],K[Z+$]]=[K[Z+$],K[Z]],Ie(K),Ct(null),tt(null),Ke(!1),m(null,null,K,!1)},Jn=()=>{const Z=[...be].reverse();Ie(Z),Ct(null),tt(null),Ke(!1),m(null,null,Z,!1)},Wi=async()=>{if(be.length<2){alert("Add at least 2 waypoints to create a route");return}ke(!0);try{const $={bicycle:"bike",motorcycle:"driving",car:"driving"}[h],K=[],ue=[],ge={};for(let De=0;De<be.length-1;De++){const Je=be[De],at=be[De+1],Rt=`${Je.lon},${Je.lat};${at.lon},${at.lat}`;console.log(`[Parlens] Fetching segment ${De+1}: ${Je.name}  ${at.name}`);const It=await fetch(`https://router.project-osrm.org/route/v1/${$}/${Rt}?overview=full&geometries=geojson&alternatives=true`);if(!It.ok)throw new Error(`OSRM error: ${It.status}`);const Ht=await It.json();if(Ht.code==="Ok"&&Ht.routes&&Ht.routes[0]){if(Ht.waypoints&&Ht.waypoints.length>=2){const un=Ht.waypoints[0].location,Oe=Ht.waypoints[1].location;ge[De]||(ge[De]={lat:un[1],lon:un[0]}),ge[De+1]={lat:Oe[1],lon:Oe[0]}}const yn=Ht.routes[0].geometry.coordinates.map(un=>[un[1],un[0]]);if(K.push(yn),Ht.routes.length>1){const un=Ht.routes[1].geometry.coordinates.map(Oe=>[Oe[1],Oe[0]]);ue.push(un),console.log(`[Parlens] Segment ${De+1} has alternate route`)}else ue.push(yn),console.log(`[Parlens] Segment ${De+1} has no alternate, using primary`)}else throw new Error(`No route found for segment ${De+1}`)}const Re=[],ze=[];for(let De=0;De<K.length;De++){const Je=De===0?0:1;Re.push(...K[De].slice(Je)),ze.push(...ue[De].slice(Je))}console.log("[Parlens] Combined primary route:",Re.length,"points"),console.log("[Parlens] Combined alternate route:",ze.length,"points"),Ct(Re),tt(ze),ai(ge),Ke(!0);const Se=Object.keys(ge).length===be.length?be.map((De,Je)=>({...De,...ge[Je]})):be;m(Re,ze,Se.map(De=>({lat:De.lat,lon:De.lon})),!0),Me(!1)}catch(Z){console.error("Route creation error:",Z);const $=be.map(K=>[K.lat,K.lon]);Ct($),tt(null),ai({}),Ke(!0),m($,null,be.map(K=>({lat:K.lat,lon:K.lon})),!0),Me(!1)}finally{ke(!1)}},cr=()=>{const Z=!Le;Ke(Z);const $=Object.keys(Dn).length===be.length?be.map((K,ue)=>({...K,...Dn[ue]})):be;m(ht,zt,$.map(K=>({lat:K.lat,lon:K.lon})),Z)},ur=Ae.useCallback(async()=>{if(!(!N||!W)){$e(!0);try{const Z=await N.querySync(Zo,{kinds:[Bl.ROUTE_LOG],authors:[W]});console.log("[Parlens] Fetched route events:",Z.length);const $=localStorage.getItem("parlens_privkey"),K=$?new Uint8Array($.match(/.{1,2}/g).map(ge=>parseInt(ge,16))):void 0,ue=[];for(const ge of Z){if(ge.tags.find(ze=>ze[0]==="deleted"))continue;const Re=ge.tags.find(ze=>ze[0]==="d")?.[1]||"";if(!(Re&&Rn.current.has(Re))&&ge.content)try{const ze=await i1(ge.content,W,K);if(ze){const Se=ge.tags.find(De=>De[0]==="d")?.[1]||"";ue.push({id:ge.id,dTag:Se,decryptedContent:ze,created_at:ge.created_at})}}catch(ze){console.warn("[Parlens] Failed to decrypt route:",ze)}}ue.sort((ge,Re)=>Re.created_at-ge.created_at);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(ue))}catch(ge){console.warn("[Parlens] Failed to cache routes:",ge)}lt(ue)}catch(Z){console.error("Error fetching saved routes:",Z)}finally{$e(!1)}}},[N,W]);Ae.useEffect(()=>{if(re&&W){try{const Z=localStorage.getItem("parlens_route_cache_v1");if(Z){const $=JSON.parse(Z);lt($)}}catch(Z){console.warn("[Parlens] Failed to load cached routes:",Z)}ur()}},[re,W,ur]);const Hr=()=>{const Z=!Ut;xe(Z),S?.(Z),Z&&(Me(!1),l?.(be))};Ae.useEffect(()=>{if(z){if(z.length>0){const Z=z.map(($,K)=>({id:crypto.randomUUID(),name:$.name||`Pin ${be.length+K+1}`,lat:$.lat,lon:$.lon}));Ie($=>[...$,...Z]),Ct(null),tt(null),Ke(!1),m(null,null,[...be,...Z],!1),ai({})}k?.(),Me(!0),S?.(!1)}},[z,k,S,m]);const Ki=async()=>{if(!N||!W||!ne||!ht||be.length<2){alert("Please create a route first");return}const Z=Et.trim()||`Route ${new Date().toLocaleDateString()}`;ut(!0);try{const $=Object.keys(Dn).length===be.length?be.map((It,Ht)=>({name:It.name,lat:Dn[Ht].lat,lon:Dn[Ht].lon})):be.map(It=>({name:It.name,lat:It.lat,lon:It.lon})),K={name:Z,waypoints:$,routeCoords:ht,alternateRouteCoords:zt||void 0,vehicleType:h,created_at:Math.floor(Date.now()/1e3)},ue=localStorage.getItem("parlens_privkey"),ge=ue?new Uint8Array(ue.match(/.{1,2}/g).map(It=>parseInt(It,16))):void 0,Re=await n1(K,W,ge),ze=`route_${Date.now()}`,Se={kind:Bl.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",ze],["client","parlens"]],content:Re},De=await ne(Se);console.log("[Parlens] Signed route event:",De);const Je=await Promise.allSettled(N.publish(Zo,De)),at=Je.filter(It=>It.status==="fulfilled").length;console.log("[Parlens] Route published:",at,"of",Je.length,"relays"),at===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)");const Rt={id:De.id,dTag:ze,decryptedContent:K,created_at:De.created_at};lt(It=>{const Ht=[Rt,...It];try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Ht))}catch(yn){console.warn("Cache update failed",yn)}return Ht}),qt("")}catch($){console.error("[Parlens] Error saving route:",$),alert("Failed to save route, try again later")}finally{ut(!1)}},$r=(Z,$)=>{Ie(K=>K.map(ue=>ue.id===Z?{...ue,name:$}:ue)),wt(null),Ft("")},Li=Z=>{wt(Z.id),Ft(Z.name)},nr=async Z=>{const $=Z.decryptedContent,K=$.waypoints.map(ue=>({id:crypto.randomUUID(),name:ue.name,lat:ue.lat,lon:ue.lon}));Ie(K),Ct($.routeCoords),tt($.alternateRouteCoords||null),ai({}),Ke(!0),vt(!1),m($.routeCoords,$.alternateRouteCoords||null,$.waypoints.map(ue=>({lat:ue.lat,lon:ue.lon})),!0),Me(!1)},Be=async Z=>{if(!(!N||!W||!ne)&&confirm("Are you sure you want to delete this route? This action cannot be undone.")){Vt(!0);try{const $={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Z.id],["a",`${Bl.ROUTE_LOG}:${W}:${Z.dTag}`]],content:"Deleted by user"},K=await ne($);await Promise.allSettled(N.publish(Zo,K));const ue={kind:Bl.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Z.dTag],["deleted","true"]],content:""},ge=await ne(ue);await Promise.allSettled(N.publish(Zo,ge)),Rn.current.add(Z.dTag),lt(Re=>{const ze=Re.filter(Se=>Se.id!==Z.id);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(ze))}catch(Se){console.warn("Cache update failed",Se)}return ze})}catch($){console.error("Error deleting route:",$),alert("Failed to delete route")}finally{Vt(!1)}}};return U.jsxs(U.Fragment,{children:[U.jsx("button",{onClick:()=>Me(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:U.jsx(EM,{size:20})}),re&&U.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[U.jsx("button",{onClick:()=>Me(!1),className:"absolute inset-0 z-0 cursor-default"}),Zt&&U.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:U.jsxs("div",{className:"flex flex-col items-center gap-3",children:[U.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),U.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),$t&&U.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:U.jsxs("div",{className:"flex flex-col items-center gap-3",children:[U.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),U.jsx("p",{className:"text-sm font-medium text-white",children:"Saving..."})]})}),U.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[U.jsxs("div",{className:"flex items-center justify-between",children:[U.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent",children:"Create Route"}),U.jsx("button",{onClick:()=>Me(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:U.jsx(qp,{size:20,className:"text-black/60 dark:text-white/60"})})]}),U.jsxs("div",{className:"space-y-2",children:[U.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30 ml-2",children:"Add Waypoint"}),U.jsx("div",{className:"relative",children:U.jsx("input",{ref:ct,type:"text",placeholder:"Search waypoint or coordinate",value:fe,onChange:Z=>ie(Z.target.value),className:"w-full h-14 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(()=>{const Z=$v(fe);return Z?U.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-blue-50 dark:bg-blue-500/10 border border-blue-500/20",children:[U.jsxs("div",{className:"px-3 py-1.5 text-xs font-medium text-blue-700 dark:text-blue-400 bg-blue-100/50 dark:bg-blue-500/5",children:[" ",Z.type==="plus_code"?"Plus Code Location":"Coordinate"]}),U.jsxs("button",{onClick:()=>{const $={id:crypto.randomUUID(),name:Z.type==="plus_code"?`Plus Code: ${fe}`:`Loc: ${gA(Z.lat,Z.lon)}`,lat:Z.lat,lon:Z.lon};Ie(K=>[...K,$]),ie(""),Ct(null),tt(null),Ke(!1),m(null,null,null,!1),ai({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[U.jsx(gf,{size:16,className:"text-blue-600 dark:text-blue-400 shrink-0"}),U.jsxs("div",{className:"flex-1 truncate",children:[U.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Add Location"}),U.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/60",children:[Z.lat.toFixed(6),", ",Z.lon.toFixed(6)]})]})]})]}):null})(),fe.length>3&&!$v(fe)&&U.jsx(zA,{query:fe,countryCode:ln,currentLocation:b,onSelect:Z=>{const $={id:crypto.randomUUID(),name:Z.display_name.split(",")[0],lat:parseFloat(Z.lat),lon:parseFloat(Z.lon)};Ie(K=>[...K,$]),ie(""),Ct(null),tt(null),Ke(!1),m(null,null,null,!1),ai({})}}),lr.length>0&&U.jsxs("div",{className:"rounded-2xl overflow-hidden bg-green-50 dark:bg-green-500/10 border border-green-500/20",children:[U.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100/50 dark:bg-green-500/5",children:" From your saved routes"}),lr.map((Z,$)=>U.jsxs("button",{onClick:()=>{const K={id:crypto.randomUUID(),name:Z.name,lat:Z.lat,lon:Z.lon};Ie(ue=>[...ue,K]),ie(""),Ct(null),tt(null),Ke(!1),m(null,null,null,!1),ai({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left border-b border-green-500/10 last:border-0",children:[U.jsx(gf,{size:16,className:"text-green-600 dark:text-green-400 shrink-0"}),U.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white/80 truncate",children:Z.name})]},`saved-${$}`))]}),b&&U.jsxs("button",{onClick:()=>{const Z={id:crypto.randomUUID(),name:"Current Location",lat:b[0],lon:b[1]};Ie($=>[...$,Z]),Ct(null),tt(null),Ke(!1),m(null,null,null,!1),ai({})},className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors",children:[U.jsx(wM,{size:16,className:"text-blue-500"}),U.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Current Location"})]}),U.jsxs("button",{onClick:Hr,className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-orange-500/10 dark:bg-orange-500/20 border border-orange-500/20 transition-colors",children:[U.jsx(xM,{size:16,className:"text-orange-500"}),U.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Drop Pin on Map"})]})]}),U.jsxs("div",{className:"space-y-2 flex-1",children:[U.jsxs("div",{className:"flex items-center justify-between ml-2 mr-2",children:[U.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30",children:["Waypoints (",be.length,")"]}),be.length>1&&U.jsx("button",{onClick:Jn,className:"p-1 rounded-md transition-colors",title:"Reverse Order",children:U.jsx(tM,{size:14,className:"text-zinc-400 dark:text-white/30"})})]}),be.length===0?U.jsx("div",{className:"p-8 text-center text-zinc-400 dark:text-white/30 text-sm",children:"No waypoints added yet."}):U.jsx("div",{className:"space-y-2",children:be.map((Z,$)=>U.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[U.jsxs("div",{className:"flex flex-col gap-0.5 -ml-1 mr-1",children:[U.jsx("button",{onClick:()=>Ri($,-1),disabled:$===0,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:U.jsx(N0,{size:12})}),U.jsx("button",{onClick:()=>Ri($,1),disabled:$===be.length-1,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:U.jsx(Bu,{size:12})})]}),U.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 text-white text-xs font-bold flex items-center justify-center shrink-0",children:$+1}),Ye===Z.id?U.jsxs(U.Fragment,{children:[U.jsx("input",{type:"text",value:Mt,onChange:K=>Ft(K.target.value),className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-blue-500",autoFocus:!0,onFocus:K=>K.currentTarget.select(),onKeyDown:K=>{K.key==="Enter"&&$r(Z.id,Mt),K.key==="Escape"&&wt(null)}}),U.jsx("button",{onClick:()=>$r(Z.id,Mt),className:"p-2 rounded-xl text-green-500 hover:bg-green-500/10 transition-colors",children:U.jsx(by,{size:16})}),U.jsx("button",{onClick:()=>wt(null),className:"p-2 rounded-xl text-zinc-400 hover:bg-zinc-500/10 transition-colors",children:U.jsx(qp,{size:16})})]}):U.jsxs(U.Fragment,{children:[U.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white font-medium truncate",children:Z.name}),U.jsx("button",{onClick:()=>Li(Z),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:U.jsx(W_,{size:14})}),U.jsx("button",{onClick:()=>Mn(Z.id),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:U.jsx(K_,{size:16})})]})]},Z.id))})]}),ht&&U.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[U.jsxs("div",{className:"flex items-center gap-3",children:[Le?U.jsx(fM,{size:20,className:"text-blue-500"}):U.jsx(hM,{size:20,className:"text-zinc-400"}),U.jsx("span",{className:"font-medium text-zinc-700 dark:text-white",children:"Show on Map"})]}),U.jsx("button",{onClick:cr,className:`w-14 h-8 rounded-full transition-colors ${Le?"bg-blue-500":"bg-zinc-300 dark:bg-white/20"}`,children:U.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${Le?"translate-x-7":"translate-x-1"}`})})]}),ht&&W&&U.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-green-500/5 dark:bg-green-500/10 border border-green-500/20",children:[U.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2",children:[U.jsx(AM,{size:14}),"Save Route"]}),U.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[U.jsx("input",{type:"text",value:Et,onChange:Z=>qt(Z.target.value),placeholder:"Route name (optional)",className:"w-full sm:flex-1 p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10 text-zinc-700 dark:text-white placeholder-zinc-400 dark:placeholder-white/40 text-sm"}),U.jsx("button",{onClick:Ki,disabled:$t,className:"w-full sm:w-auto px-6 rounded-xl bg-green-500 text-white font-bold disabled:opacity-50 transition-all active:scale-95 py-3 sm:py-0",children:$t?"...":"Save"})]})]}),U.jsxs("div",{className:"flex gap-3",children:[U.jsx("button",{onClick:ci,disabled:be.length===0,className:"flex-1 h-14 rounded-2xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:"Clear Route"}),U.jsx("button",{onClick:Wi,disabled:be.length<2||st,className:"flex-1 h-14 rounded-2xl bg-blue-500 text-white font-bold shadow-lg shadow-blue-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:st?"Creating...":"Create Route"})]}),!ht&&be.length>=2&&W&&U.jsx("p",{className:"text-xs text-center text-zinc-400 dark:text-white/40",children:" Save option will appear after you create the route"}),W&&U.jsxs("div",{className:"space-y-3 border-t border-black/5 dark:border-white/10 pt-4",children:[U.jsxs("button",{onClick:()=>vt(!mt),className:"w-full flex items-center justify-between",children:[U.jsxs("div",{className:"flex items-center gap-2",children:[U.jsx(mM,{size:18,className:"text-zinc-500 dark:text-white/50"}),U.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30",children:["Saved Routes (",it.length,")"]})]}),U.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:mt?"Hide":"Show"})]}),mt&&U.jsx("div",{className:"space-y-2",children:we?U.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):it.length===0?U.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"No saved routes yet"}):it.map(Z=>U.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[U.jsxs("button",{onClick:()=>nr(Z),className:"flex-1 text-left",children:[U.jsx("div",{className:"font-medium text-sm text-zinc-700 dark:text-white truncate",children:Z.decryptedContent.name}),U.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[U.jsxs("span",{children:[Z.decryptedContent.waypoints.length," stops"]}),U.jsx("span",{children:""}),U.jsx(Yb,{size:12}),U.jsx("span",{children:new Date(Z.created_at*1e3).toLocaleDateString()})]})]}),U.jsx("button",{onClick:()=>Be(Z),className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:U.jsx(K_,{size:16})})]},Z.id))})]}),U.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20",children:U.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[U.jsx("strong",{children:"Tip:"})," Use ",U.jsx("strong",{children:"Drop Pin on Map"})," and",U.jsx("strong",{children:" edit waypoint names"})," to label locations. When you ",U.jsx("strong",{children:"save routes"}),", waypoint names become searchable  building your personal offline map over time! "]})})]})]})]})};function DA(h){return h>=17?8:h>=15?7:h>=13?6:h>=11?5:h>=9?4:3}function Xv(h,m,b=!0){if(!b||h.length<2)return h;const S=DA(m),z=new Map;for(const A of h){const l=m>=15?`${A.lat.toFixed(4)},${A.lon.toFixed(4)}`:Iy(A.lat,A.lon,S);if(z.has(l)){const N=z.get(l);N.spots.push(A),N.count++,N.minPrice=Math.min(N.minPrice,A.price),N.maxPrice=Math.max(N.maxPrice,A.price),N.lat=N.spots.reduce((W,ne)=>W+ne.lat,0)/N.count,N.lon=N.spots.reduce((W,ne)=>W+ne.lon,0)/N.count}else z.set(l,{id:`cluster-${l}`,lat:A.lat,lon:A.lon,spots:[A],minPrice:A.price,maxPrice:A.price,currency:A.currency,count:1})}const k=[];for(const A of z.values())A.count===1?k.push(A.spots[0]):k.push(A);return k}function Yv(h){return"count"in h&&h.count>1}class O_{q;r;x;p;k;initialized=!1;constructor(m=1e-5,b=.001){this.q=m,this.r=b,this.x=0,this.p=1,this.k=0}filter(m){return this.initialized?(this.p=this.p+this.q,this.k=this.p/(this.p+this.r),this.x=this.x+this.k*(m-this.x),this.p=(1-this.k)*this.p,this.x):(this.x=m,this.initialized=!0,m)}reset(){this.initialized=!1,this.x=0,this.p=1}}class IA{latFilter;lonFilter;bearingFilter;hasLastBearing=!1;constructor(){this.latFilter=new O_(1e-5,.002),this.lonFilter=new O_(1e-5,.002),this.bearingFilter=new O_(.005,.8)}cumulativeBearing=0;lastInputBearing=0;smoothLocation(m,b){return[this.latFilter.filter(m),this.lonFilter.filter(b)]}smoothBearing(m,b,S=!1){if(!S&&b<2)return null;const z=(m%360+360)%360;if(!this.hasLastBearing)return this.lastInputBearing=z,this.cumulativeBearing=z,this.hasLastBearing=!0,this.bearingFilter.reset(),this.bearingFilter.filter(z),z;let k=z-this.lastInputBearing;return k>180?k-=360:k<-180&&(k+=360),this.cumulativeBearing+=k,this.lastInputBearing=z,(this.bearingFilter.filter(this.cumulativeBearing)%360+360)%360}reset(){this.latFilter.reset(),this.lonFilter.reset(),this.bearingFilter.reset(),this.cumulativeBearing=0,this.lastInputBearing=0,this.hasLastBearing=!1}}class kA{currentRotation=0;lastRawBearing=0;initialized=!1;setBearing(m){const b=(m%360+360)%360;if(!this.initialized)return this.currentRotation=b,this.lastRawBearing=b,this.initialized=!0,this.currentRotation;let S=b-this.lastRawBearing;return S>180?S-=360:S<-180&&(S+=360),this.currentRotation+=S,this.lastRawBearing=b,this.currentRotation}getCurrentRotation(){return this.currentRotation}reset(m=0){this.currentRotation=m,this.lastRawBearing=(m%360+360)%360,this.initialized=!0}}class RA{startLat=0;startLon=0;targetLat=0;targetLon=0;currentLat=0;currentLon=0;startTime=0;duration=300;animationId=null;onUpdate=null;setUpdateCallback(m){this.onUpdate=m}animateTo(m,b,S=300){if(this.animationId!==null&&cancelAnimationFrame(this.animationId),this.targetLat===0&&this.targetLon===0){this.targetLat=m,this.targetLon=b,this.currentLat=m,this.currentLon=b,this.onUpdate&&this.onUpdate(m,b);return}this.startLat=this.currentLat||this.targetLat,this.startLon=this.currentLon||this.targetLon,this.targetLat=m,this.targetLon=b,this.startTime=performance.now(),this.duration=S,this.animate()}animate=()=>{const b=performance.now()-this.startTime,S=Math.min(b/this.duration,1),z=1-Math.pow(1-S,3),k=this.startLat+(this.targetLat-this.startLat)*z,A=this.startLon+(this.targetLon-this.startLon)*z;this.currentLat=k,this.currentLon=A,this.onUpdate&&this.onUpdate(k,A),S<1?this.animationId=requestAnimationFrame(this.animate):this.animationId=null};stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class LA{anchorLat=0;anchorLon=0;displayLat=0;displayLon=0;lastRawLat=0;lastRawLon=0;lastUpdateTime=0;speedHistory=[];currentSpeedClass="stationary";predictedBearing=0;directionChangeBuffer=[];initialized=!1;bufferZones={stationary:5,walking:4,vehicle:3,fast_vehicle:2};pollIntervals={stationary:15e3,walking:5e3,vehicle:2e3,fast_vehicle:1e3};animationDurations={stationary:1200,walking:800,vehicle:400,fast_vehicle:200};haversineDistance(m,b,S,z){const A=(S-m)*Math.PI/180,l=(z-b)*Math.PI/180,N=Math.sin(A/2)*Math.sin(A/2)+Math.cos(m*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))}calculateBearing(m,b,S,z){const k=(z-b)*Math.PI/180,A=Math.sin(k)*Math.cos(S*Math.PI/180),l=Math.cos(m*Math.PI/180)*Math.sin(S*Math.PI/180)-Math.sin(m*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.cos(k);return(Math.atan2(A,l)*180/Math.PI+360)%360}updateLocation(m,b){const S=Date.now();if(!this.initialized)return this.anchorLat=m,this.anchorLon=b,this.displayLat=m,this.displayLon=b,this.lastRawLat=m,this.lastRawLon=b,this.lastUpdateTime=S,this.initialized=!0,{displayLat:m,displayLon:b,speed:0,speedClass:"stationary",shouldUpdate:!0,animationDuration:0,bearing:null};const z=this.haversineDistance(this.anchorLat,this.anchorLon,m,b),k=(S-this.lastUpdateTime)/1e3,A=this.haversineDistance(this.lastRawLat,this.lastRawLon,m,b),l=k>0?A/k:0;this.speedHistory.push(l),this.speedHistory.length>5&&this.speedHistory.shift();const N=this.speedHistory.reduce((Ie,fe)=>Ie+fe,0)/this.speedHistory.length;let W;N<.5?W="stationary":N<2?W="walking":N<10?W="vehicle":W="fast_vehicle",this.currentSpeedClass=W;const ne=this.bufferZones[W];if(A>1){const Ie=this.calculateBearing(this.lastRawLat,this.lastRawLon,m,b);this.directionChangeBuffer.push(Ie),this.directionChangeBuffer.length>3&&this.directionChangeBuffer.shift(),this.predictedBearing=this.directionChangeBuffer.reduce((fe,ie)=>fe+ie,0)/this.directionChangeBuffer.length}this.lastRawLat=m,this.lastRawLon=b,this.lastUpdateTime=S;let re=!1,Me=this.displayLat,be=this.displayLon;return z>ne?(this.anchorLat=m,this.anchorLon=b,Me=m,be=b,re=!0):(Me=this.anchorLat,be=this.anchorLon,re=!1),re&&(this.displayLat=Me,this.displayLon=be),{displayLat:this.displayLat,displayLon:this.displayLon,speed:N,speedClass:W,shouldUpdate:re,animationDuration:this.animationDurations[W],bearing:this.predictedBearing}}getPollingInterval(){return this.pollIntervals[this.currentSpeedClass]}getSpeedClass(){return this.currentSpeedClass}getPredictedBearing(){return this.predictedBearing}getSpeedHistoryAverage(){return this.speedHistory.length===0?0:this.speedHistory.reduce((m,b)=>m+b,0)/this.speedHistory.length}reset(){this.initialized=!1,this.anchorLat=0,this.anchorLon=0,this.displayLat=0,this.displayLon=0,this.speedHistory=[],this.currentSpeedClass="stationary",this.directionChangeBuffer=[]}}const OA=()=>{const h=Ae.useRef(null),[m,b]=Ae.useState(!1),S=Ae.useCallback(async()=>{if("wakeLock"in navigator)try{const k=await navigator.wakeLock.request("screen");h.current=k,b(!0),k.addEventListener("release",()=>{b(!1),h.current=null}),console.log("[Parlens] Screen Wake Lock acquired")}catch(k){console.warn("[Parlens] Failed to acquire Wake Lock:",k),b(!1)}else console.warn("[Parlens] Wake Lock API not supported")},[]),z=Ae.useCallback(async()=>{if(h.current)try{await h.current.release(),h.current=null,b(!1),console.log("[Parlens] Screen Wake Lock released")}catch(k){console.warn("[Parlens] Failed to release Wake Lock:",k)}},[]);return Ae.useEffect(()=>{const k=async()=>{document.visibilityState==="visible"&&m&&await S()};return document.addEventListener("visibilitychange",k),()=>{document.removeEventListener("visibilitychange",k)}},[m,S]),{requestLock:S,releaseLock:z,isLocked:m}},Wv={light:"https://tiles.openfreemap.org/styles/positron",dark:"https://tiles.openfreemap.org/styles/dark"},Kv=Ae.memo(({price:h,emoji:m,currency:b,isHistory:S=!1})=>{const z=hg(b);return U.jsxs("div",{className:"flex flex-col items-center justify-center cursor-pointer transition-transform active:scale-95",children:[U.jsx("div",{className:"text-[32px] leading-none drop-shadow-md z-10 filter",children:m}),U.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap
                    ${S?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[z,Math.round(h),"/hr"]})]})}),Q_=Ae.memo(({bearing:h,mapBearing:m,isNavigationMode:b})=>{const S=h-m,z=Ae.useRef(0),k=Ae.useRef(0),A=S-k.current;Math.abs(A)>180&&(A>0?z.current-=360:z.current+=360),k.current=S;const l=S+z.current;return U.jsx("div",{style:{transform:`rotate(${l}deg) scale(1)`,transition:"transform 0.2s ease-out",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:U.jsx("div",{style:{width:28,height:28,background:"#007AFF",border:"3px solid white",borderRadius:"50%",boxShadow:`0 0 0 ${b?3:2}px rgba(0,122,255,${b?.5:.4}), 0 4px 12px rgba(0,0,0,0.4)`,display:"flex",alignItems:"center",justifyContent:"center"},children:U.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",style:{transform:"translateY(-1px)"},children:U.jsx("path",{d:"M7 0L14 14L7 12L0 14L7 0Z",fill:"white"})})})})});Q_.displayName="UserLocationMarker";const J_=Ae.memo(({count:h,minPrice:m,maxPrice:b,currency:S,type:z})=>{const k=z==="open"?"":"",A=z==="history",l=hg(S),N=m===b?`${l}${m}`:`${l}${m}-${b}`;return U.jsxs("div",{className:"flex flex-col items-center justify-center cursor-pointer transition-transform active:scale-95 pointer-events-none",children:[U.jsxs("div",{className:"relative text-[32px] leading-none drop-shadow-md z-10 filter",children:[k,U.jsx("div",{className:`
                    absolute -top-1 -right-1 flex items-center justify-center min-w-[18px] h-[18px] px-1
                    text-[10px] font-bold text-white rounded-full border-2 border-white shadow-sm
                    ${A?"bg-zinc-500":"bg-[#34C759]"}
                `,children:h})]}),U.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap
                    ${A?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[N,"/hr"]})]})});J_.displayName="ClusterMarkerContent";const c1=Ae.memo(({vehicleType:h})=>{const m=h==="bicycle"?"":h==="motorcycle"?"":"";return U.jsx("div",{style:{fontSize:36,filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.4))",pointerEvents:"none"},children:m})});c1.displayName="ActiveSessionMarkerContent";const u1=Ae.memo(({vehicleType:h,onVehicleChange:m,disabled:b})=>{const[S,z]=Ae.useState(!1),k=["bicycle","motorcycle","car"],A={bicycle:"",motorcycle:"",car:""};return U.jsx("div",{className:"flex flex-col rounded-[2rem] bg-white/80 dark:bg-white/10 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg mb-2 overflow-hidden transition-all duration-300",children:S?U.jsxs("div",{className:"flex flex-col gap-1 p-1",children:[k.map(l=>U.jsx("button",{onClick:()=>{b?b&&alert("Please end your current session before changing vehicle type."):(m(l),z(!1))},className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${h===l?"bg-blue-500/20 shadow-inner":"transition-colors"}`,children:U.jsx("span",{className:`text-lg ${h===l?"":"opacity-50"}`,children:A[l]})},l)),U.jsx("button",{onClick:()=>z(!1),className:"w-10 h-6 flex items-center justify-center text-zinc-400 dark:text-white/40 transition-colors",children:U.jsx(N0,{size:16})})]}):U.jsxs("button",{onClick:()=>z(!0),className:"flex flex-col items-center p-1 transition-all",children:[U.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-500/20",children:U.jsx("span",{className:"text-lg",children:A[h]})}),U.jsx(Bu,{size:14,className:"text-zinc-400 dark:text-white/40 mt-0.5"})]})})});u1.displayName="VehicleToggle";const BA=()=>{const h=Ae.useRef(null),[m,b]=Ae.useState(null),S=Ae.useRef(new IA),z=Ae.useRef(new kA),k=Ae.useRef(new RA),[A,l]=Ae.useState(null),[N,W]=Ae.useState("idle"),[ne,re]=Ae.useState("fixed"),[Me,be]=Ae.useState(!1),[Ie,fe]=Ae.useState(!1),[ie,Le]=Ae.useState(()=>{const Qe=localStorage.getItem("parlens_vehicle_type");return Qe==="bicycle"||Qe==="motorcycle"||Qe==="car"?Qe:"car"}),[Ke,ht]=Ae.useState([]),[Ct,zt]=Ae.useState([]),[tt,st]=Ae.useState(null),[ke,ct]=Ae.useState(!1),[it,lt]=Ae.useState(17),[Et,qt]=Ae.useState(null),[$t,ut]=Ae.useState(null),[we,$e]=Ae.useState(null),[mt,vt]=Ae.useState(!1),[Ut,xe]=Ae.useState(null),[Ye,wt]=Ae.useState(!1),[Mt,Ft]=Ae.useState({longitude:77.5946,latitude:12.9716,zoom:17,bearing:0,pitch:0}),Zt=Ae.useRef(!1),Vt=Ae.useRef(!1),ln=window.matchMedia("(prefers-color-scheme: dark)").matches,[Qt,Dn]=Ae.useState(!1),[ai,Rn]=Ae.useState([]),[lr,Mn]=Ae.useState(null),[ci,Ri]=Ae.useState(null),[Jn,Wi]=Ae.useState(null),[cr,ur]=Ae.useState(""),[,Hr]=Ae.useState(!1),[Ki,$r]=Ae.useState([]),Li=Ae.useCallback(()=>{const Qe=Mt,_t=Ki.length+ai.length+1,Fe={id:crypto.randomUUID(),lat:Qe.latitude,lon:Qe.longitude,name:`Waypoint ${_t}`};Rn(Tt=>[...Tt,Fe])},[Mt,Ki.length,ai.length]),nr=(Qe,_t)=>{Rn(Fe=>Fe.map(Tt=>Tt.id===Qe?{...Tt,name:_t}:Tt))},Be=Qe=>{Rn(_t=>_t.filter(Tt=>Tt.id!==Qe).map((Tt,kt)=>Tt.name.startsWith("Waypoint ")?{...Tt,name:`Waypoint ${kt+1}`}:Tt)),ci===Qe&&Ri(null)},Z=Ae.useCallback(()=>{const Qe=ai.map(_t=>({lat:_t.lat,lon:_t.lon,name:_t.name}));Mn(Qe),Rn([]),Dn(!1)},[ai]),[$,K]=Ae.useState(!1),[ue,ge]=Ae.useState(0),[Re,ze]=Ae.useState(0),{requestLock:Se,releaseLock:De}=OA(),Je=Ae.useRef(new LA),[at,Rt]=Ae.useState(0),It=Ae.useRef(!1),Ht=Ae.useRef(0),yn=Ae.useRef(0);Ae.useEffect(()=>{N==="parked"&&(re("fixed"),Ft(Qe=>({...Qe,bearing:0,pitch:0})),h.current?.rotateTo(0,{duration:800}))},[N]),Ae.useEffect(()=>{if(!navigator.geolocation){l("Geolocation is not supported by your browser");return}const Qe=navigator.geolocation.watchPosition(_t=>{const{latitude:Fe,longitude:Tt}=_t.coords;k.current.animateTo(Fe,Tt,300);const kt=Je.current.updateLocation(Fe,Tt);Rt(kt.speed),Ht.current=kt.speed,It.current||(It.current=!0,b([kt.displayLat,kt.displayLon]),Ft(ni=>({...ni,latitude:kt.displayLat,longitude:kt.displayLon})))},_t=>{let Fe="Unable to get your location";_t.code===1?Fe="Location access denied. Please enable location services.":_t.code===2?Fe="Location unavailable. Check your GPS settings.":_t.code===3&&(Fe="Location request timed out."),l(Fe)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return k.current.setUpdateCallback((_t,Fe)=>{b([_t,Fe]),re(Tt=>{if((Tt==="auto"||Tt==="recentre")&&!Zt.current){if(Ht.current<.3&&Tt!=="recentre")return Tt;Ft(kt=>{const ni=h.current?.getZoom()??kt.zoom,Vi=.1,Xr=kt.latitude+(_t-kt.latitude)*Vi,en=kt.longitude+(Fe-kt.longitude)*Vi;return{...kt,latitude:Xr,longitude:en,zoom:ni}})}return Tt})}),()=>{navigator.geolocation.clearWatch(Qe),k.current.stop()}},[]),Ae.useEffect(()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&K(!0);const Qe=_t=>{if(Zt.current)return;let Fe=null;if(_t.webkitCompassHeading?Fe=_t.webkitCompassHeading:_t.alpha!==null&&(Fe=360-_t.alpha),Fe!==null){const Tt=window.screen.orientation?.angle??window.orientation??0;Fe=(Fe+Tt)%360}if(Fe!==null){yn.current=Fe,ze(kt=>{let Vi=Fe-kt;return Vi>180&&(Vi-=360),Vi<-180&&(Vi+=360),Math.abs(Vi)<2?kt:kt+Vi*.1});const Tt=S.current.smoothBearing(Fe,0,!0);if(Tt!==null){const kt=z.current.setBearing(Tt);ge(kt)}}};return window.addEventListener("deviceorientation",Qe,!0),()=>{window.removeEventListener("deviceorientation",Qe,!0)}},[]);const un=async()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&await DeviceOrientationEvent.requestPermission()==="granted"&&K(!1)};Ae.useEffect(()=>{!Zt.current&&!Vt.current&&m&&(ne==="auto"||ne==="recentre")&&Ft(Qe=>{const _t=h.current?.getZoom()??Qe.zoom,Fe={...Qe,longitude:m[1],latitude:m[0],zoom:_t,pitch:0};return Qt?Qe:(ne==="auto"&&(Fe.bearing=ue,Fe.transitionDuration=100),Fe)})},[m,ue,ne,mt,Qt]),Ae.useEffect(()=>(Se(),()=>{De()}),[Se,De]),Ae.useEffect(()=>{const Qe=localStorage.getItem("parlens_session");if(Qe)try{const _t=JSON.parse(Qe);_t.status==="parked"&&_t.parkLocation&&_t.sessionStart?(console.log("[Parlens] Restoring parked session:",_t),xe(_t.sessionStart),st(_t.parkLocation),W("parked")):_t.status==="search"&&(console.log("[Parlens] Restoring search session"),W("search"))}catch(_t){console.warn("[Parlens] Failed to restore session:",_t),localStorage.removeItem("parlens_session")}},[]),Ae.useEffect(()=>{N==="parked"&&Ut&&tt?localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:Ut,parkLocation:tt})):N==="search"?localStorage.setItem("parlens_session",JSON.stringify({status:"search"})):N==="idle"&&(localStorage.removeItem("parlens_session"),xe(null))},[N,Ut,tt]),Ae.useEffect(()=>{if(!m){ct(!1);return}const[Qe,_t]=m,Fe=Math.sqrt(Math.pow(Mt.latitude-Qe,2)+Math.pow(Mt.longitude-_t,2));ct(Fe>5e-4)},[m,Mt.latitude,Mt.longitude]);const Oe=Ae.useCallback(Qe=>{Ft(Qe.viewState);let _t=!1;if(h.current&&(nn.current&&(_t=!0),h.current.isZooming()&&(_t=!0),Qe&&Qe.originalEvent&&Qe.originalEvent.touches&&Qe.originalEvent.touches.length>1&&(_t=!0)),Zt.current&&(ne==="auto"||ne==="recentre")&&!_t){let Fe=1;m&&(Fe=Math.sqrt(Math.pow(Qe.viewState.longitude-m[1],2)+Math.pow(Qe.viewState.latitude-m[0],2))),Fe>1e-4&&re("fixed")}},[m,ne,ke]),In=Ae.useCallback(Qe=>{Qe.originalEvent&&(Zt.current=!0,k.current.stop(),Vt.current&&(h.current?.stop(),Vt.current=!1))},[]),ui=Ae.useCallback(()=>{setTimeout(()=>{Zt.current=!1},1e3),lt(Mt.zoom)},[Mt.zoom]),nn=Ae.useRef(!1),kn=Ae.useCallback(()=>{nn.current=!0,Zt.current=!0,k.current.stop(),Vt.current&&(h.current?.stop(),Vt.current=!1)},[]),Ui=Ae.useCallback(()=>{nn.current=!1,setTimeout(()=>{nn.current||(Zt.current=!1)},1e3)},[]),Ln=Qe=>{if(N!=="idle"){alert("Please end your current session before changing vehicle type.");return}Le(Qe),localStorage.setItem("parlens_vehicle_type",Qe)},hi=Ae.useCallback((Qe,_t,Fe,Tt)=>{if(qt(Qe),ut(_t),$e(Fe),vt(Tt),Qe&&Qe.length>1&&h.current&&Tt){const kt=[...Qe];_t&&_t.length>0&&kt.push(..._t);const ni=kt.map(en=>en[1]),Vi=kt.map(en=>en[0]),Xr=new t1.LngLatBounds([Math.min(...ni),Math.min(...Vi)],[Math.max(...ni),Math.max(...Vi)]);Vt.current=!0,h.current.fitBounds(Xr,{padding:50,duration:1e3}),re("fixed"),setTimeout(()=>{Vt.current=!1,typeof DeviceOrientationEvent.requestPermission=="function"&&K(!0)},1200)}},[]),On=Ae.useMemo(()=>Ct.filter(_t=>(_t.decryptedContent?.type||"car")===ie).map(_t=>{const Fe=_t.decryptedContent;return Fe&&Fe.lat&&Fe.lon?{id:_t.id,lat:Fe.lat,lon:Fe.lon,price:parseFloat(Fe.fee)||0,currency:Fe.currency||"USD",original:_t}:null}).filter(Boolean),[Ct,ie]),Ti=Ae.useMemo(()=>Xv(On,it),[On,it]),Us=Ae.useMemo(()=>N!=="search"?[]:Ke.filter(Qe=>(Qe.type||"car")===ie).map(Qe=>({id:Qe.id,lat:Qe.lat,lon:Qe.lon,price:Qe.price,currency:Qe.currency,original:Qe})),[Ke,ie,N]),Vs=Ae.useMemo(()=>Xv(Us,it),[Us,it]),bt=ln?Wv.dark:Wv.light,hr={id:"route",type:"line",paint:{"line-color":"#007AFF","line-width":5,"line-opacity":.9}},dr={id:"alternate-route",type:"line",paint:{"line-color":"#007AFF","line-width":3,"line-opacity":.4,"line-dasharray":[2,2]}};return U.jsxs("div",{className:"fixed inset-0 overflow-hidden bg-gray-50 dark:bg-black transition-colors duration-300",children:[(!m&&!A||!Ye)&&U.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:U.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:A?U.jsxs(U.Fragment,{children:[U.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center",children:U.jsx("span",{className:"text-2xl",children:""})}),U.jsx("p",{className:"text-sm font-medium text-red-500 dark:text-red-400",children:A}),U.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-6 py-2 rounded-full bg-blue-500 text-white text-sm font-medium active:scale-95 transition-transform",children:"Try Again"})]}):U.jsxs(U.Fragment,{children:[U.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"}),U.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Locating..."})]})})}),N==="parked"&&U.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[1000] h-12 px-6 bg-[#34C759] rounded-full shadow-lg flex items-center gap-3 animate-in slide-in-from-top-4 pointer-events-none",children:[U.jsx("div",{className:"text-xl",children:ie==="bicycle"?"":ie==="motorcycle"?"":""}),U.jsx("span",{className:"font-bold text-white whitespace-nowrap",children:"Session Active"})]}),N==="search"&&U.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[1000] h-12 px-6 bg-white dark:bg-zinc-800 rounded-full shadow-lg flex items-center gap-3 animate-in slide-in-from-top-4 pointer-events-none",children:[U.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#FF9500] animate-pulse"}),U.jsx("span",{className:"font-bold text-zinc-900 dark:text-white whitespace-nowrap",children:"Searching for spots"})]}),ne==="auto"&&m&&U.jsx("div",{className:"absolute top-1/2 left-1/2 z-[900] pointer-events-none flex items-center justify-center",style:{transform:"translate(-50%, -50%)",width:"40px",height:"40px"},children:U.jsx(Q_,{bearing:Re,mapBearing:Mt.bearing,isNavigationMode:!0})}),U.jsxs("div",{className:"absolute inset-0",onPointerDownCapture:()=>{Zt.current=!0,k.current.stop(),Vt.current&&(h.current?.stop(),Vt.current=!1)},onTouchStartCapture:()=>{Zt.current=!0,k.current.stop(),Vt.current&&(h.current?.stop(),Vt.current=!1)},onWheelCapture:()=>{Zt.current=!0,Vt.current&&(h.current?.stop(),Vt.current=!1),window.wheelDebounce&&clearTimeout(window.wheelDebounce),window.wheelDebounce=setTimeout(()=>{Zt.current=!1},1e3)},style:{touchAction:"none"},children:[U.jsxs(YM,{ref:h,...Mt,onStyleData:Qe=>{const _t=Qe.target;_t&&(_t.getStyle().layers?.forEach(kt=>{(kt.id.includes("oneway")||kt.id.includes("arrow")||kt.id.includes("direction"))&&_t.getLayoutProperty(kt.id,"visibility")!=="none"&&_t.setLayoutProperty(kt.id,"visibility","none")}),Object.entries({"icon-bus":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M4 6C4 4.89543 4.89543 4 6 4H18C19.1046 4 20 4.89543 20 6V17C20 18.1046 19.1046 19 18 19H16.5L17.5 21H15.5L14.5 19H9.5L8.5 21H6.5L7.5 19H6C4.89543 19 4 18.1046 4 17V6ZM6 6V10H18V6H6ZM6 12V16H18V12H6ZM8 14C8.55228 14 9 13.5523 9 13C9 12.4477 8.55228 12 8 12C7.44772 12 7 12.4477 7 13C7 13.5523 7.44772 14 8 14ZM16 14C16.5523 14 17 13.5523 17 13C17 12.4477 16.5523 12 16 12C15.4477 12 15 12.4477 15 13C15 13.5523 15.4477 14 16 14Z"/></svg>',"icon-train":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8 2 4 2.5 4 6V15.5C4 17.433 5.567 19 7.5 19L6 20.5V21H18V20.5L16.5 19C18.433 19 20 17.433 20 15.5V6C20 2.5 16 2 12 2ZM12 4C14.5 4 18 4.5 18 6V10H6V6C6 4.5 9.5 4 12 4ZM12 17C10.8954 17 10 16.1046 10 15C10 13.8954 10.8954 13 12 13C13.1046 13 14 13.8954 14 15C14 16.1046 13.1046 17 12 17ZM7.5 17C6.67157 17 6 16.3284 6 15.5V12H9.05C9.02 12.3 9 12.64 9 13C9 14.6569 10.3431 16 12 16C13.6569 16 15 14.6569 15 13C15 12.64 14.98 12.3 14.95 12H18V15.5C18 16.3284 17.3284 17 16.5 17H7.5Z"/></svg>',"icon-subway":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M17.8 2.8C16 2.09 13.86 2 12 2C10.14 2 8 2.09 6.2 2.8C4.30002 3.55 3.00002 4.97 3.00002 6.5V15.5C3.00002 17.4 4.40002 19.34 6.6 19.89L5.00002 21.5V22H19V21.5L17.4 19.89C19.6 19.34 21 17.4 21 15.5V6.5C21 4.97 19.7 3.55 17.8 2.8ZM16.5 16C15.12 16 14 14.88 14 13.5C14 12.12 15.12 11 16.5 11C17.88 11 19 12.12 19 13.5C19 14.88 17.88 16 16.5 16ZM12 9C7.58 9 6 6.5 6 6.5C6 6.5 8 5.5 12 5.5C16 5.5 18 6.5 18 6.5C18 6.5 16.42 9 12 9ZM7.5 16C6.12 16 5.00002 14.88 5.00002 13.5C5.00002 12.12 6.12 11 7.5 11C8.88 11 10 12.12 10 13.5C10 14.88 8.88 16 7.5 16Z"/></svg>',"icon-tram":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M13 5.5V2H11V5.5L7 8H17L13 5.5ZM5 9V17.5C5 18.7 5.7 19.7 6.8 20.2L6 21H8L9 20H15L16 21H18L17.2 20.2C18.3 19.7 19 18.7 19 17.5V9H5ZM16 16.5C16 17.05 15.55 17.5 15 17.5H9C8.45 17.5 8 17.05 8 16.5V14H16V16.5ZM16 12.5H8V10.5H16V12.5Z"/></svg>',"icon-stop":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="6" stroke="white" stroke-width="2"/><circle cx="12" cy="12" r="3" fill="white"/></svg>'}).forEach(([kt,ni])=>{if(!_t.hasImage(kt)){const Vi=new Image(24,24);Vi.onload=()=>_t.addImage(kt,Vi,{sdf:!0}),Vi.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(ni)}}),_t.getLayer("transit-stops")||_t.addLayer({id:"transit-stops",type:"symbol",source:"openmaptiles","source-layer":"poi",minzoom:14,filter:["match",["get","class"],["bus_station","railway","bus_stop","tram_stop","subway","rail","train_station"],!0,!1],layout:{"icon-image":["match",["get","class"],"bus_station","icon-bus","bus_stop","icon-stop","railway","icon-train","rail","icon-train","train_station","icon-train","tram_stop","icon-tram","subway","icon-subway","icon-stop"],"icon-size":["interpolate",["linear"],["zoom"],14,.6,18,1],"icon-allow-overlap":!1,"icon-padding":2},paint:{"icon-color":ln?"#999999":"#555555","icon-halo-color":ln?"rgba(0,0,0,0.5)":"#ffffff","icon-halo-width":1}}))},onLoad:Qe=>{wt(!0);const _t=Qe.target;_t&&(_t.getStyle().layers?.forEach(Tt=>{(Tt.id.includes("oneway")||Tt.id.includes("arrow")||Tt.id.includes("direction"))&&_t.setLayoutProperty(Tt.id,"visibility","none")}),_t.getLayer("transit-labels")||_t.addLayer({id:"transit-labels",type:"symbol",source:"openmaptiles","source-layer":"poi",minzoom:15,filter:["match",["get","class"],["bus_station","railway","bus_stop","tram_stop","subway","rail","train_station"],!0,!1],layout:{"text-field":["upcase",["coalesce",["get","name_en"],["get","name"]]],"text-size":11,"text-offset":[0,1.2],"text-anchor":"top","text-font":["Noto Sans Regular"],"text-max-width":9,"text-letter-spacing":.1},paint:{"text-color":ln?"#999999":"#666666","text-halo-color":ln?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.8)","text-halo-width":1.5,"text-halo-blur":.5}}))},onMove:Oe,onMoveStart:In,onMoveEnd:ui,onZoomStart:kn,onZoomEnd:Ui,onRotateStart:()=>{Zt.current=!0,k.current.stop()},onRotateEnd:ui,onPitchStart:()=>{Zt.current=!0,k.current.stop()},onPitchEnd:ui,style:{width:"100%",height:"100%"},mapStyle:bt,attributionControl:!1,dragPan:!Vt.current,minZoom:3,maxZoom:20,renderWorldCopies:!0,children:[mt&&$t&&$t.length>1&&U.jsx(Vv,{id:"alternate-route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:$t.map(Qe=>[Qe[1],Qe[0]])}},children:U.jsx(qv,{...dr})}),mt&&Et&&Et.length>1&&U.jsx(Vv,{id:"route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Et.map(Qe=>[Qe[1],Qe[0]])}},children:U.jsx(qv,{...hr})}),N==="search"&&Vs.map(Qe=>{const _t=Yv(Qe);return U.jsx(jp,{longitude:Qe.lon,latitude:Qe.lat,anchor:"center",style:{willChange:"transform"},onClick:Fe=>{Fe.originalEvent.stopPropagation(),_t&&h.current?.flyTo({center:[Qe.lon,Qe.lat],zoom:Mt.zoom+2})},children:_t?U.jsx(J_,{count:Qe.count,minPrice:Qe.minPrice,maxPrice:Qe.maxPrice,currency:Qe.currency,type:"open"}):U.jsx(Kv,{price:Qe.price,currency:Qe.currency,emoji:""})},`open-${Qe.id}`)}),(mt||Qt)&&(we||Ki.length>0)&&U.jsx(U.Fragment,{children:(Qt?Ki.length>0?Ki:we||[]:we||[]).map((Qe,_t)=>U.jsx(jp,{longitude:Qe.lon,latitude:Qe.lat,anchor:"center",onClick:Fe=>{Fe.originalEvent?.preventDefault(),Fe.originalEvent?.stopPropagation();const Tt=Qe.id;Ri(ci===Tt?null:Tt),ur(Qe.name||`Stop ${_t+1}`)},className:"cursor-pointer",style:{zIndex:ci===Qe.id?2e3:1e3},children:U.jsxs("div",{className:"relative flex flex-col items-center",children:[Qt&&U.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[2000]",onClick:Fe=>Fe.stopPropagation(),children:Jn===Qe.id?U.jsxs(U.Fragment,{children:[U.jsx("input",{type:"text",value:cr,onChange:Fe=>ur(Fe.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:Fe=>Fe.currentTarget.select(),onKeyDown:Fe=>{if(Fe.key==="Enter"){const Tt=Qe.id;Tt&&$r(kt=>kt.map(ni=>ni.id===Tt?{...ni,name:cr}:ni)),Wi(null)}}}),U.jsx("button",{onClick:()=>{const Fe=Qe.id;Fe&&$r(Tt=>Tt.map(kt=>kt.id===Fe?{...kt,name:cr}:kt)),Wi(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:U.jsx(by,{size:12,strokeWidth:3})}),U.jsx("button",{onClick:()=>Wi(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:U.jsx(qp,{size:12})})]}):U.jsxs(U.Fragment,{children:[U.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:Qe.name||`Stop ${_t+1}`}),U.jsx("button",{onClick:()=>{ur(Qe.name||`Stop ${_t+1}`),Wi(Qe.id)},className:"p-1 rounded-lg transition-colors",children:U.jsx(W_,{size:12})}),U.jsx("button",{onClick:()=>{const Fe=Qe.id;Fe&&$r(Tt=>Tt.filter(kt=>kt.id!==Fe))},className:"p-1 rounded-lg transition-colors",children:U.jsx(kv,{size:12})})]})}),U.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",style:{zIndex:10},children:_t+1})]})},`wp-${Qe.id||_t}`))}),Qt&&ai.map((Qe,_t)=>{const Fe=Ki.length+_t+1;return U.jsx(jp,{longitude:Qe.lon,latitude:Qe.lat,anchor:"center",onClick:Tt=>{Tt.originalEvent?.preventDefault(),Tt.originalEvent?.stopPropagation(),Ri(ci===Qe.id?null:Qe.id),ur(Qe.name)},className:"cursor-pointer",style:{zIndex:ci===Qe.id?2e3:1e3},children:U.jsxs("div",{className:"relative flex flex-col items-center",children:[U.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[2000]",onClick:Tt=>Tt.stopPropagation(),children:Jn===Qe.id?U.jsxs(U.Fragment,{children:[U.jsx("input",{type:"text",value:cr,onChange:Tt=>ur(Tt.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:Tt=>Tt.currentTarget.select(),onKeyDown:Tt=>{Tt.key==="Enter"&&(nr(Qe.id,cr),Wi(null))}}),U.jsx("button",{onClick:()=>{nr(Qe.id,cr),Wi(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:U.jsx(by,{size:12,strokeWidth:3})}),U.jsx("button",{onClick:()=>Wi(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:U.jsx(qp,{size:12})})]}):U.jsxs(U.Fragment,{children:[U.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:Qe.name}),U.jsx("button",{onClick:()=>{ur(Qe.name),Wi(Qe.id)},className:"p-1 rounded-lg transition-colors",children:U.jsx(W_,{size:12})}),U.jsx("button",{onClick:()=>Be(Qe.id),className:"p-1 rounded-lg transition-colors",children:U.jsx(kv,{size:12})})]})}),U.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",children:Fe})]})},Qe.id)}),"     ",Ti.map(Qe=>{const _t=Yv(Qe);return U.jsx(jp,{longitude:Qe.lon,latitude:Qe.lat,anchor:"center",style:{willChange:"transform"},onClick:Fe=>{Fe.originalEvent.stopPropagation(),_t&&h.current?.flyTo({center:[Qe.lon,Qe.lat],zoom:Mt.zoom+2})},children:_t?U.jsx(J_,{count:Qe.count,minPrice:Qe.minPrice,maxPrice:Qe.maxPrice,currency:Qe.currency,type:"history"}):U.jsx(Kv,{price:Qe.price,currency:Qe.currency,emoji:"",isHistory:!0})},`history-${Qe.id}`)}),N==="parked"&&tt&&U.jsx(jp,{longitude:tt[1],latitude:tt[0],anchor:"center",children:U.jsx(c1,{vehicleType:ie})}),m&&ne!=="auto"&&U.jsx(jp,{longitude:m[1],latitude:m[0],anchor:"center",style:{zIndex:1e3},children:U.jsx(Q_,{bearing:Re,mapBearing:Mt.bearing,isNavigationMode:!1})})]}),Qt&&U.jsxs(U.Fragment,{children:[U.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1600]",children:U.jsxs("div",{className:"relative flex items-center justify-center",children:[U.jsx("div",{className:"absolute w-8 h-8 rounded-full bg-blue-500/10 dark:bg-blue-400/10 animate-pulse"}),U.jsx("div",{className:"w-1.5 h-1.5 bg-[#007AFF] rounded-full shadow-sm z-10"}),U.jsx("div",{className:"absolute w-6 h-[1.5px] bg-[#007AFF]/60 rounded-full"}),U.jsx("div",{className:"absolute h-6 w-[1.5px] bg-[#007AFF]/60 rounded-full"})]})}),U.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 translate-y-12 z-[1500]",children:U.jsxs("button",{onClick:Li,className:"bg-white dark:bg-zinc-800 text-[#007AFF] px-6 py-2.5 rounded-full font-bold text-sm shadow-xl backdrop-blur-md active:scale-95 transition-all flex items-center gap-2 border border-black/5 dark:border-white/10",children:[U.jsx(gf,{size:16,className:"fill-current"}),"Drop Pin Here"]})}),U.jsx("div",{className:"absolute top-4 right-4 z-[2000] animate-in slide-in-from-top-4 fade-in",children:U.jsxs("button",{onClick:Z,className:"bg-[#007AFF] text-white px-6 py-2.5 rounded-full font-bold shadow-lg flex items-center gap-2 transition-transform active:scale-95 active:bg-[#007AFF]",children:[U.jsx(by,{size:18,strokeWidth:3}),"Done"]})})]})]}),U.jsxs("div",{className:`absolute z-[1000] flex flex-col items-start gap-3 animate-in slide-in-from-left-6 transition-opacity duration-300 ${Qt?"opacity-0 pointer-events-none":"opacity-100"}`,style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",left:"max(1rem, env(safe-area-inset-left))"},children:[U.jsx(u1,{vehicleType:ie,onVehicleChange:Ln,disabled:N!=="idle"}),U.jsx("button",{onClick:()=>fe(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95",children:U.jsx(Iv,{size:20})})]}),U.jsxs("div",{className:"absolute z-[1000] flex flex-col items-end gap-3 animate-in slide-in-from-right-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",right:"max(1rem, env(safe-area-inset-right))"},children:[Math.abs(Mt.bearing)>5&&ne!=="auto"&&U.jsx("button",{onClick:()=>{h.current?.rotateTo(0,{duration:400}),Ft(Qe=>({...Qe,bearing:0,pitch:0}))},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10",title:"Reset to true north",children:U.jsxs("div",{className:"flex flex-col items-center justify-center",style:{transform:`rotate(${-Mt.bearing}deg)`},children:[U.jsx("div",{style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"10px solid rgb(239 68 68)"}}),U.jsx("span",{className:"text-sm font-bold text-zinc-600 dark:text-white/70",style:{marginTop:"-2px"},children:"N"})]})}),U.jsx("button",{onClick:async()=>{if($){await un();return}if(Qt){m&&h.current?.flyTo({center:[m[1],m[0]],zoom:17,duration:800,essential:!0});return}h.current?.stop(),Vt.current=!1;const Qe=Mt.zoom,_t=17;if(ke){if(m){const Fe=Qe<_t?_t:Qe;Vt.current=!0,h.current?.flyTo({center:[m[1],m[0]],zoom:Fe,duration:800,essential:!0}),h.current?.once("moveend",()=>{Vt.current=!1})}re("recentre"),ct(!1);return}if((ne==="fixed"||ne==="recentre")&&m&&(Vt.current=!0,h.current?.flyTo({center:[m[1],m[0]],zoom:Qe<_t?_t:Qe,bearing:0,duration:800,essential:!0}),h.current?.once("moveend",()=>{Vt.current=!1,ne==="fixed"&&re("recentre")})),ne==="recentre"){if(N==="parked"){Vt.current=!0,h.current?.flyTo({bearing:0,pitch:0,zoom:16.5,duration:800,essential:!0}),h.current?.once("moveend",()=>{Vt.current=!1}),re("fixed");return}const Fe=Re||0;Vt.current=!0,be(!0),h.current?.rotateTo(Fe,{duration:800}),h.current?.once("moveend",()=>{Vt.current=!1,be(!1),z.current.reset(Fe),re("auto")});return}re(Fe=>Fe==="auto"?(Vt.current=!0,h.current?.flyTo({bearing:0,pitch:0,zoom:16.5,duration:800,essential:!0}),h.current?.once("moveend",()=>{Vt.current=!1}),be(!1),"fixed"):"recentre")},className:`h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg ${$?"bg-orange-500/20 border-orange-500/50 text-orange-500 animate-pulse":"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70"}`,children:$?U.jsx(yy,{size:20,className:"text-orange-500 animate-pulse"}):Qt?U.jsx(yy,{size:20,className:"text-zinc-600 dark:text-white/70"}):ne==="auto"||Me?U.jsx(iM,{size:20,className:"text-blue-500"}):ne==="recentre"?U.jsx(yy,{size:20,fill:"currentColor",className:"text-green-500"}):U.jsx(yy,{size:20,className:`text-zinc-600 dark:text-white/70 ${ke?"opacity-50":""}`})}),U.jsx("div",{className:Qt?"hidden":"block",children:U.jsx(PA,{vehicleType:ie,onRouteChange:hi,currentLocation:m,onDropPinModeChange:Dn,pendingWaypoints:lr,onDropPinConsumed:()=>Mn(null),onOpenChange:Hr,onWaypointsChange:$r})}),!Qt&&U.jsx("div",{className:"relative z-[1010]",children:U.jsx(CA,{setHistorySpots:zt})}),!Qt&&U.jsx(MA,{status:N,setStatus:W,searchLocation:m,vehicleType:ie,setOpenSpots:ht,parkLocation:tt,setParkLocation:st,sessionStart:Ut,setSessionStart:xe})]}),Ie&&U.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl pt-2 px-4 pb-4 animate-in fade-in",children:[U.jsx("button",{onClick:()=>fe(!1),className:"absolute inset-0 z-0 cursor-default"}),U.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] border border-black/5 dark:border-white/5 shadow-2xl p-6 space-y-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar transition-colors",style:{overscrollBehaviorY:"contain"},children:[U.jsx("button",{onClick:()=>fe(!1),className:"absolute top-6 right-6 p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:U.jsx(qp,{size:20,className:"text-black/60 dark:text-white/60"})}),U.jsxs("div",{className:"text-center space-y-2 pt-4",children:[U.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4",children:U.jsx(Iv,{size:32})}),U.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"How to use Parlens"}),U.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Decentralized Route & Parking Management"})]}),U.jsxs("div",{className:"space-y-3",children:[U.jsx("h3",{className:"text-center font-bold text-zinc-600 dark:text-white/90",children:"Add to your homescreen"}),U.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[U.jsxs("button",{onClick:()=>{document.getElementById("android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[U.jsx("span",{children:"Using Browser Menu (Android)"}),U.jsx(Bu,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),U.jsxs("div",{id:"android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:[U.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white",children:"Chrome & Brave:"}),U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsx("li",{children:"Tap menu button (three dots)"}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Add to Home screen"})]}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Add"})," to confirm"]})]}),U.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white mt-3",children:"Firefox:"}),U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsx("li",{children:"Tap menu button (three dots)"}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Install"})]})]})]})]}),U.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[U.jsxs("button",{onClick:()=>{document.getElementById("ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[U.jsx("span",{children:"Using Share Button (iOS)"}),U.jsx(Bu,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),U.jsx("div",{id:"ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsxs("li",{children:["Tap the ",U.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),U.jsxs("li",{children:["Scroll down and tap ",U.jsx("strong",{children:"Add to Home Screen"}),"."]}),U.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),U.jsxs("div",{className:"space-y-6 text-sm text-zinc-600 dark:text-white/80 leading-relaxed pt-4 border-t border-black/5 dark:border-white/10",children:[U.jsxs("p",{children:[U.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),U.jsxs("p",{children:[U.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Plan your route (optional)"}),"Tap the route button to add waypoints and create a route. If the system generated route(s) between your start and end points are not to your liking, add additional waypoints in locations you would prefer travelling through. Click the location button to re-centre and turn on follow-me or navigation mode for route tracking."]}),U.jsxs("p",{children:[U.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Find and log parking"}),"Click the main button once to see open spots reported by others live or within the last 5 minutes. Click again to mark your location. When leaving, click once more to end the session and report the fee. Use the profile button to see your parking history."]}),U.jsxs("p",{children:[U.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Create your own mirror (optional)"}),U.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 dark:text-blue-400 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the bandwidth load while sharing with your friends."]}),U.jsxs("p",{children:[U.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. User privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys and only accessible by you. Open spot broadcasts are ephemeral and not linked to any personal identifiers."]}),U.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20 mt-6",children:U.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[U.jsx("span",{className:"font-bold",children:"Tip: "}),"Use Parlens over your cellular internet connection to prevent personal IP address(es) from being associated with your data."]})})]})]})]})]})},NA=()=>{const{login:h}=Wp(),[m,b]=Ae.useState(""),[S,z]=Ae.useState(""),[k,A]=Ae.useState(!1),[l,N]=Ae.useState("landing"),[W,ne]=Ae.useState(""),[re,Me]=Ae.useState(null),be=async Le=>{A(!0),z("");try{await h(Le,Le==="nsec"?m:void 0)}catch(Ke){z(Ke.message)}finally{A(!1)}},Ie=()=>{N("setup")},fe=async()=>{if(!W.trim()){z("Please enter a username");return}A(!0);try{const{generateSecretKey:Le,getPublicKey:Ke}=await ox(async()=>{const{generateSecretKey:ke,getPublicKey:ct}=await Promise.resolve().then(()=>EA);return{generateSecretKey:ke,getPublicKey:ct}},void 0),ht=ke=>Array.from(ke).map(ct=>ct.toString(16).padStart(2,"0")).join(""),Ct=Le(),zt=Ke(Ct);localStorage.setItem("parlens_privkey",ht(Ct)),localStorage.setItem("parlens_pubkey",zt),localStorage.setItem("parlens_pending_username",W);const tt=ff.npubEncode(zt),st=ff.nsecEncode(Ct);Me({npub:tt,nsec:st}),N("backup")}catch(Le){z(Le.message)}finally{A(!1)}},ie=async()=>{A(!0);try{const Le=localStorage.getItem("parlens_pending_username");await h("create",void 0,Le||W),localStorage.removeItem("parlens_pending_username")}catch(Le){z(Le.message)}finally{A(!1)}};return U.jsx("div",{className:"min-h-screen bg-black p-6 text-white text-center overflow-y-auto no-scrollbar flex flex-col items-center justify-center",style:{paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:U.jsxs("div",{className:"w-full max-w-sm space-y-12 animate-in fade-in zoom-in-95 duration-700",children:[U.jsxs("div",{className:"space-y-4",children:[U.jsx("img",{src:"/parlens-pwa/pwa-512x512.png",alt:"Parlens",className:"mx-auto h-24 w-24 rounded-[22%] shadow-2xl shadow-[#007AFF]/20"}),U.jsx("h1",{className:"text-5xl font-extrabold tracking-tighter font-serif",children:"Parlens"}),U.jsx("p",{className:"text-sm font-medium text-white/40 tracking-tight",children:"Decentralized Route & Parking Management"})]}),U.jsxs("div",{className:"space-y-4",children:[l==="landing"?U.jsxs(U.Fragment,{children:[U.jsx("button",{onClick:Ie,disabled:k,className:"w-full h-16 rounded-3xl bg-white text-black font-bold text-lg shadow-xl active:scale-95 transition-all flex items-center justify-center gap-3",children:k?"Creating...":U.jsxs(U.Fragment,{children:[U.jsx(RM,{size:20,strokeWidth:3}),"Create a New Account"]})}),U.jsxs("button",{onClick:()=>N("nsec"),disabled:k,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold text-lg shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[U.jsx(Y_,{size:18}),"Login with Nostr Account"]})]}):l==="setup"?U.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-right-4",children:[U.jsxs("div",{className:"text-center pb-2",children:[U.jsx("h3",{className:"text-xl font-bold",children:"Pick a Username"}),U.jsx("p",{className:"text-white/40 text-sm",children:"This will be your identity on Nostr"})]}),U.jsx("input",{type:"text",placeholder:"Username",value:W,onChange:Le=>ne(Le.target.value),className:"w-full h-16 rounded-3xl bg-zinc-900 border border-white/10 px-6 text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-white/20",autoFocus:!0}),U.jsxs("div",{className:"flex gap-3",children:[U.jsx("button",{onClick:()=>N("landing"),className:"h-16 px-6 rounded-3xl bg-zinc-900 text-white font-bold",children:"Back"}),U.jsx("button",{onClick:fe,disabled:k||!W,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:k?"Creating...":"Continue"})]})]}):l==="backup"?U.jsxs("div",{className:"space-y-6 pt-4 animate-in slide-in-from-right-4 text-left",children:[U.jsxs("div",{className:"text-center pb-2",children:[U.jsx("h3",{className:"text-xl font-bold",children:" Account Created!"}),U.jsx("p",{className:"text-white/40 text-sm mt-1",children:"Back up your keys before continuing"})]}),U.jsxs("div",{className:"space-y-4",children:[U.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-white/30 ml-2",children:"Your Keys"}),U.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-white/[0.03] border border-white/10",children:[U.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-white/10",onClick:()=>{re&&(navigator.clipboard.writeText(re.npub),alert("Public Key copied to clipboard"))},children:[U.jsxs("div",{className:"flex items-center gap-3",children:[U.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/20 text-blue-400",children:U.jsx(Y_,{size:20})}),U.jsx("span",{className:"font-semibold text-sm text-white",children:"Copy Public Key (Npub)"})]}),U.jsx(Py,{size:18,className:"text-white/20"})]}),U.jsx("div",{className:"h-[1px] bg-white/5 mx-4"}),U.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-white/10",onClick:()=>{re&&(navigator.clipboard.writeText(re.nsec),alert("Secret Key copied to clipboard - keep this safe!"))},children:[U.jsxs("div",{className:"flex items-center gap-3",children:[U.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/20 text-red-500",children:U.jsx(Wb,{size:20})}),U.jsx("span",{className:"font-semibold text-sm text-white",children:"Copy Secret Key (Nsec)"})]}),U.jsx(Py,{size:18,className:"text-white/20"})]})]}),U.jsx("p",{className:"text-xs text-white/30 mt-2 ml-2 leading-relaxed text-center",children:" Store these keys securely. They cannot be recovered if lost."})]}),U.jsxs("div",{className:"space-y-6 pt-6 border-t border-white/10",children:[U.jsxs("div",{className:"space-y-2",children:[U.jsx("h3",{className:"text-lg font-bold text-white",children:"Getting Started"}),U.jsx("p",{className:"text-sm text-white/60",children:"Follow these steps to get the most out of Parlens."})]}),U.jsxs("div",{className:"space-y-3",children:[U.jsx("h4",{className:"font-bold text-sm text-white/80",children:"1. Add to your homescreen"}),U.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[U.jsxs("button",{onClick:()=>{document.getElementById("backup-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[U.jsx("span",{children:"Using Browser Menu (Android)"}),U.jsx(Bu,{size:16,className:"text-white/50"})]}),U.jsxs("div",{id:"backup-android-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2",children:[U.jsx("p",{className:"font-semibold text-white",children:"Chrome & Brave:"}),U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsx("li",{children:"Tap menu button (three dots)"}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Add to Home screen"})]}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Add"})," to confirm"]})]}),U.jsx("p",{className:"font-semibold text-white mt-3",children:"Firefox:"}),U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsx("li",{children:"Tap menu button (three dots)"}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Install"})]})]})]})]}),U.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[U.jsxs("button",{onClick:()=>{document.getElementById("backup-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[U.jsx("span",{children:"Using Share Button (iOS)"}),U.jsx(Bu,{size:16,className:"text-white/50"})]}),U.jsx("div",{id:"backup-ios-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2",children:U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsxs("li",{children:["Tap the ",U.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),U.jsxs("li",{children:["Scroll down and tap ",U.jsx("strong",{children:"Add to Home Screen"}),"."]}),U.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),U.jsxs("div",{className:"space-y-4 text-sm text-white/60 leading-relaxed",children:[U.jsxs("p",{children:[U.jsx("strong",{className:"text-white block mb-1",children:"2. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),U.jsxs("p",{children:[U.jsx("strong",{className:"text-white block mb-1",children:"3. Finding and Logging Parking"}),"Click the main button once to see open spots reported by others. Click again to mark your location. When leaving, click once more to end the session and report the fee."]}),U.jsxs("p",{children:[U.jsx("strong",{className:"text-white block mb-1",children:"4. Create your own mirror"}),U.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the bandwidth load while sharing with your friends."]}),U.jsxs("p",{children:[U.jsx("strong",{className:"text-white block mb-1",children:"5. User Privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys and only accessible by you."]}),U.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 border border-amber-500/20 mt-4",children:U.jsxs("p",{className:"text-xs text-amber-500/90 leading-relaxed",children:[U.jsx("span",{className:"font-bold",children:"Tip: "}),"Use Parlens over your cellular internet connection to prevent IP association."]})})]})]}),U.jsx("button",{onClick:ie,disabled:k,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:k?"Starting...":"Start Using Parlens"})]}):U.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-bottom-4",children:[U.jsx("input",{type:"password",placeholder:"Paste your nsec...",value:m,onChange:Le=>b(Le.target.value),className:"w-full h-16 rounded-3xl bg-zinc-900 border border-white/10 px-6 text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-white/20",autoFocus:!0}),U.jsxs("div",{className:"flex gap-3",children:[U.jsx("button",{onClick:()=>N("landing"),className:"h-16 px-6 rounded-3xl bg-zinc-900 text-white font-bold",children:"Back"}),U.jsx("button",{onClick:()=>be("nsec"),disabled:k||!m,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:k?"Decrypting...":"Login with Key"})]})]}),S&&U.jsx("div",{className:"p-4 rounded-3xl bg-red-500/10 border border-red-500/20 text-red-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-2",children:S}),U.jsxs("div",{className:"space-y-3 pt-6 border-t border-white/10",children:[U.jsx("h3",{className:"text-center font-bold text-white/70 text-sm",children:"Add to your homescreen for fullscreen experience"}),U.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[U.jsxs("button",{onClick:()=>{document.getElementById("login-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[U.jsx("span",{children:"Using Browser Menu (Android)"}),U.jsx(Bu,{size:16,className:"text-white/50"})]}),U.jsxs("div",{id:"login-android-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2 text-left",children:[U.jsx("p",{className:"font-semibold text-white/80",children:"Chrome & Brave:"}),U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsx("li",{children:"Tap menu button (three dots)"}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Add to Home screen"})]}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Add"})," to confirm"]})]}),U.jsx("p",{className:"font-semibold text-white/80 mt-3",children:"Firefox:"}),U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsx("li",{children:"Tap menu button (three dots)"}),U.jsxs("li",{children:["Tap ",U.jsx("strong",{children:"Install"})]})]})]})]}),U.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[U.jsxs("button",{onClick:()=>{document.getElementById("login-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[U.jsx("span",{children:"Using Share Button (iOS)"}),U.jsx(Bu,{size:16,className:"text-white/50"})]}),U.jsx("div",{id:"login-ios-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2 text-left",children:U.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[U.jsxs("li",{children:["Tap the ",U.jsx("strong",{className:"text-white/80",children:"Share"})," button in Safari menu bar."]}),U.jsxs("li",{children:["Scroll down and tap ",U.jsx("strong",{className:"text-white/80",children:"Add to Home Screen"}),"."]}),U.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]})]})]})})},FA=()=>{const{pubkey:h}=Wp();return a0.useEffect(()=>{let m=0;const b=()=>{if(document.visibilityState==="hidden")m=Date.now(),console.log("[App] Backgrounded at",new Date().toISOString());else if(document.visibilityState==="visible"&&m>0){const z=Date.now()-m;console.log("[App] Foregrounded after",z,"ms"),z>5e3&&(console.log("[App] Dispatching visibility-refresh event"),window.dispatchEvent(new Event("visibility-refresh")))}},S=z=>{z.persisted&&(console.log("[App] Page restored from bfcache, triggering refresh"),window.dispatchEvent(new Event("visibility-refresh")))};return document.addEventListener("visibilitychange",b),window.addEventListener("pageshow",S),()=>{document.removeEventListener("visibilitychange",b),window.removeEventListener("pageshow",S)}},[]),h?U.jsx(BA,{}):U.jsx(NA,{})};var Ky=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(h){return this.listeners.add(h),this.onSubscribe(),()=>{this.listeners.delete(h),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},jA={setTimeout:(h,m)=>setTimeout(h,m),clearTimeout:h=>clearTimeout(h),setInterval:(h,m)=>setInterval(h,m),clearInterval:h=>clearInterval(h)},UA=class{#e=jA;#t=!1;setTimeoutProvider(h){this.#e=h}setTimeout(h,m){return this.#e.setTimeout(h,m)}clearTimeout(h){this.#e.clearTimeout(h)}setInterval(h,m){return this.#e.setInterval(h,m)}clearInterval(h){this.#e.clearInterval(h)}},e0=new UA;function VA(h){setTimeout(h,0)}var Qy=typeof window>"u"||"Deno"in globalThis;function Ol(){}function qA(h,m){return typeof h=="function"?h(m):h}function GA(h){return typeof h=="number"&&h>=0&&h!==1/0}function ZA(h,m){return Math.max(h+(m||0)-Date.now(),0)}function t0(h,m){return typeof h=="function"?h(m):h}function HA(h,m){return typeof h=="function"?h(m):h}function Qv(h,m){const{type:b="all",exact:S,fetchStatus:z,predicate:k,queryKey:A,stale:l}=h;if(A){if(S){if(m.queryHash!==F0(A,m.options))return!1}else if(!fg(m.queryKey,A))return!1}if(b!=="all"){const N=m.isActive();if(b==="active"&&!N||b==="inactive"&&N)return!1}return!(typeof l=="boolean"&&m.isStale()!==l||z&&z!==m.state.fetchStatus||k&&!k(m))}function Jv(h,m){const{exact:b,status:S,predicate:z,mutationKey:k}=h;if(k){if(!m.options.mutationKey)return!1;if(b){if(dg(m.options.mutationKey)!==dg(k))return!1}else if(!fg(m.options.mutationKey,k))return!1}return!(S&&m.state.status!==S||z&&!z(m))}function F0(h,m){return(m?.queryKeyHashFn||dg)(h)}function dg(h){return JSON.stringify(h,(m,b)=>n0(b)?Object.keys(b).sort().reduce((S,z)=>(S[z]=b[z],S),{}):b)}function fg(h,m){return h===m?!0:typeof h!=typeof m?!1:h&&m&&typeof h=="object"&&typeof m=="object"?Object.keys(m).every(b=>fg(h[b],m[b])):!1}var $A=Object.prototype.hasOwnProperty;function h1(h,m){if(h===m)return h;const b=ex(h)&&ex(m);if(!b&&!(n0(h)&&n0(m)))return m;const z=(b?h:Object.keys(h)).length,k=b?m:Object.keys(m),A=k.length,l=b?new Array(A):{};let N=0;for(let W=0;W<A;W++){const ne=b?W:k[W],re=h[ne],Me=m[ne];if(re===Me){l[ne]=re,(b?W<z:$A.call(h,ne))&&N++;continue}if(re===null||Me===null||typeof re!="object"||typeof Me!="object"){l[ne]=Me;continue}const be=h1(re,Me);l[ne]=be,be===re&&N++}return z===A&&N===z?h:l}function ex(h){return Array.isArray(h)&&h.length===Object.keys(h).length}function n0(h){if(!tx(h))return!1;const m=h.constructor;if(m===void 0)return!0;const b=m.prototype;return!(!tx(b)||!b.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(h)!==Object.prototype)}function tx(h){return Object.prototype.toString.call(h)==="[object Object]"}function XA(h){return new Promise(m=>{e0.setTimeout(m,h)})}function YA(h,m,b){return typeof b.structuralSharing=="function"?b.structuralSharing(h,m):b.structuralSharing!==!1?h1(h,m):m}function WA(h,m,b=0){const S=[...h,m];return b&&S.length>b?S.slice(1):S}function KA(h,m,b=0){const S=[m,...h];return b&&S.length>b?S.slice(0,-1):S}var j0=Symbol();function d1(h,m){return!h.queryFn&&m?.initialPromise?()=>m.initialPromise:!h.queryFn||h.queryFn===j0?()=>Promise.reject(new Error(`Missing queryFn: '${h.queryHash}'`)):h.queryFn}var QA=class extends Ky{#e;#t;#n;constructor(){super(),this.#n=h=>{if(!Qy&&window.addEventListener){const m=()=>h();return window.addEventListener("visibilitychange",m,!1),()=>{window.removeEventListener("visibilitychange",m)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(h){this.#n=h,this.#t?.(),this.#t=h(m=>{typeof m=="boolean"?this.setFocused(m):this.onFocus()})}setFocused(h){this.#e!==h&&(this.#e=h,this.onFocus())}onFocus(){const h=this.isFocused();this.listeners.forEach(m=>{m(h)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},f1=new QA;function JA(){let h,m;const b=new Promise((z,k)=>{h=z,m=k});b.status="pending",b.catch(()=>{});function S(z){Object.assign(b,z),delete b.resolve,delete b.reject}return b.resolve=z=>{S({status:"fulfilled",value:z}),h(z)},b.reject=z=>{S({status:"rejected",reason:z}),m(z)},b}var eC=VA;function tC(){let h=[],m=0,b=l=>{l()},S=l=>{l()},z=eC;const k=l=>{m?h.push(l):z(()=>{b(l)})},A=()=>{const l=h;h=[],l.length&&z(()=>{S(()=>{l.forEach(N=>{b(N)})})})};return{batch:l=>{let N;m++;try{N=l()}finally{m--,m||A()}return N},batchCalls:l=>(...N)=>{k(()=>{l(...N)})},schedule:k,setNotifyFunction:l=>{b=l},setBatchNotifyFunction:l=>{S=l},setScheduler:l=>{z=l}}}var hs=tC(),nC=class extends Ky{#e=!0;#t;#n;constructor(){super(),this.#n=h=>{if(!Qy&&window.addEventListener){const m=()=>h(!0),b=()=>h(!1);return window.addEventListener("online",m,!1),window.addEventListener("offline",b,!1),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",b)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(h){this.#n=h,this.#t?.(),this.#t=h(this.setOnline.bind(this))}setOnline(h){this.#e!==h&&(this.#e=h,this.listeners.forEach(b=>{b(h)}))}isOnline(){return this.#e}},Ry=new nC;function iC(h){return Math.min(1e3*2**h,3e4)}function p1(h){return(h??"online")==="online"?Ry.isOnline():!0}var i0=class extends Error{constructor(h){super("CancelledError"),this.revert=h?.revert,this.silent=h?.silent}};function m1(h){let m=!1,b=0,S;const z=JA(),k=()=>z.status!=="pending",A=fe=>{if(!k()){const ie=new i0(fe);Me(ie),h.onCancel?.(ie)}},l=()=>{m=!0},N=()=>{m=!1},W=()=>f1.isFocused()&&(h.networkMode==="always"||Ry.isOnline())&&h.canRun(),ne=()=>p1(h.networkMode)&&h.canRun(),re=fe=>{k()||(S?.(),z.resolve(fe))},Me=fe=>{k()||(S?.(),z.reject(fe))},be=()=>new Promise(fe=>{S=ie=>{(k()||W())&&fe(ie)},h.onPause?.()}).then(()=>{S=void 0,k()||h.onContinue?.()}),Ie=()=>{if(k())return;let fe;const ie=b===0?h.initialPromise:void 0;try{fe=ie??h.fn()}catch(Le){fe=Promise.reject(Le)}Promise.resolve(fe).then(re).catch(Le=>{if(k())return;const Ke=h.retry??(Qy?0:3),ht=h.retryDelay??iC,Ct=typeof ht=="function"?ht(b,Le):ht,zt=Ke===!0||typeof Ke=="number"&&b<Ke||typeof Ke=="function"&&Ke(b,Le);if(m||!zt){Me(Le);return}b++,h.onFail?.(b,Le),XA(Ct).then(()=>W()?void 0:be()).then(()=>{m?Me(Le):Ie()})})};return{promise:z,status:()=>z.status,cancel:A,continue:()=>(S?.(),z),cancelRetry:l,continueRetry:N,canStart:ne,start:()=>(ne()?Ie():be().then(Ie),z)}}var g1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),GA(this.gcTime)&&(this.#e=e0.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(h){this.gcTime=Math.max(this.gcTime||0,h??(Qy?1/0:300*1e3))}clearGcTimeout(){this.#e&&(e0.clearTimeout(this.#e),this.#e=void 0)}},rC=class extends g1{#e;#t;#n;#r;#i;#s;#o;constructor(h){super(),this.#o=!1,this.#s=h.defaultOptions,this.setOptions(h.options),this.observers=[],this.#r=h.client,this.#n=this.#r.getQueryCache(),this.queryKey=h.queryKey,this.queryHash=h.queryHash,this.#e=ix(this.options),this.state=h.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(h){if(this.options={...this.#s,...h},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const m=ix(this.options);m.data!==void 0&&(this.setState(nx(m.data,m.dataUpdatedAt)),this.#e=m)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(h,m){const b=YA(this.state.data,h,this.options);return this.#a({data:b,type:"success",dataUpdatedAt:m?.updatedAt,manual:m?.manual}),b}setState(h,m){this.#a({type:"setState",state:h,setStateOptions:m})}cancel(h){const m=this.#i?.promise;return this.#i?.cancel(h),m?m.then(Ol).catch(Ol):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(h=>HA(h.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===j0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(h=>t0(h.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(h=>h.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(h=0){return this.state.data===void 0?!0:h==="static"?!1:this.state.isInvalidated?!0:!ZA(this.state.dataUpdatedAt,h)}onFocus(){this.observers.find(m=>m.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(m=>m.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(h){this.observers.includes(h)||(this.observers.push(h),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:h}))}removeObserver(h){this.observers.includes(h)&&(this.observers=this.observers.filter(m=>m!==h),this.observers.length||(this.#i&&(this.#o?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:h}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(h,m){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&m?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(h&&this.setOptions(h),!this.options.queryFn){const l=this.observers.find(N=>N.options.queryFn);l&&this.setOptions(l.options)}const b=new AbortController,S=l=>{Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(this.#o=!0,b.signal)})},z=()=>{const l=d1(this.options,m),W=(()=>{const ne={client:this.#r,queryKey:this.queryKey,meta:this.meta};return S(ne),ne})();return this.#o=!1,this.options.persister?this.options.persister(l,W,this):l(W)},A=(()=>{const l={fetchOptions:m,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:z};return S(l),l})();this.options.behavior?.onFetch(A,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==A.fetchOptions?.meta)&&this.#a({type:"fetch",meta:A.fetchOptions?.meta}),this.#i=m1({initialPromise:m?.initialPromise,fn:A.fetchFn,onCancel:l=>{l instanceof i0&&l.revert&&this.setState({...this.#t,fetchStatus:"idle"}),b.abort()},onFail:(l,N)=>{this.#a({type:"failed",failureCount:l,error:N})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:A.options.retry,retryDelay:A.options.retryDelay,networkMode:A.options.networkMode,canRun:()=>!0});try{const l=await this.#i.start();if(l===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(l),this.#n.config.onSuccess?.(l,this),this.#n.config.onSettled?.(l,this.state.error,this),l}catch(l){if(l instanceof i0){if(l.silent)return this.#i.promise;if(l.revert){if(this.state.data===void 0)throw l;return this.state.data}}throw this.#a({type:"error",error:l}),this.#n.config.onError?.(l,this),this.#n.config.onSettled?.(this.state.data,l,this),l}finally{this.scheduleGc()}}#a(h){const m=b=>{switch(h.type){case"failed":return{...b,fetchFailureCount:h.failureCount,fetchFailureReason:h.error};case"pause":return{...b,fetchStatus:"paused"};case"continue":return{...b,fetchStatus:"fetching"};case"fetch":return{...b,...aC(b.data,this.options),fetchMeta:h.meta??null};case"success":const S={...b,...nx(h.data,h.dataUpdatedAt),dataUpdateCount:b.dataUpdateCount+1,...!h.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=h.manual?S:void 0,S;case"error":const z=h.error;return{...b,error:z,errorUpdateCount:b.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:b.fetchFailureCount+1,fetchFailureReason:z,fetchStatus:"idle",status:"error"};case"invalidate":return{...b,isInvalidated:!0};case"setState":return{...b,...h.state}}};this.state=m(this.state),hs.batch(()=>{this.observers.forEach(b=>{b.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:h})})}};function aC(h,m){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:p1(m.networkMode)?"fetching":"paused",...h===void 0&&{error:null,status:"pending"}}}function nx(h,m){return{data:h,dataUpdatedAt:m??Date.now(),error:null,isInvalidated:!1,status:"success"}}function ix(h){const m=typeof h.initialData=="function"?h.initialData():h.initialData,b=m!==void 0,S=b?typeof h.initialDataUpdatedAt=="function"?h.initialDataUpdatedAt():h.initialDataUpdatedAt:0;return{data:m,dataUpdateCount:0,dataUpdatedAt:b?S??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:b?"success":"pending",fetchStatus:"idle"}}function rx(h){return{onFetch:(m,b)=>{const S=m.options,z=m.fetchOptions?.meta?.fetchMore?.direction,k=m.state.data?.pages||[],A=m.state.data?.pageParams||[];let l={pages:[],pageParams:[]},N=0;const W=async()=>{let ne=!1;const re=Ie=>{Object.defineProperty(Ie,"signal",{enumerable:!0,get:()=>(m.signal.aborted?ne=!0:m.signal.addEventListener("abort",()=>{ne=!0}),m.signal)})},Me=d1(m.options,m.fetchOptions),be=async(Ie,fe,ie)=>{if(ne)return Promise.reject();if(fe==null&&Ie.pages.length)return Promise.resolve(Ie);const Ke=(()=>{const tt={client:m.client,queryKey:m.queryKey,pageParam:fe,direction:ie?"backward":"forward",meta:m.options.meta};return re(tt),tt})(),ht=await Me(Ke),{maxPages:Ct}=m.options,zt=ie?KA:WA;return{pages:zt(Ie.pages,ht,Ct),pageParams:zt(Ie.pageParams,fe,Ct)}};if(z&&k.length){const Ie=z==="backward",fe=Ie?sC:ax,ie={pages:k,pageParams:A},Le=fe(S,ie);l=await be(ie,Le,Ie)}else{const Ie=h??k.length;do{const fe=N===0?A[0]??S.initialPageParam:ax(S,l);if(N>0&&fe==null)break;l=await be(l,fe),N++}while(N<Ie)}return l};m.options.persister?m.fetchFn=()=>m.options.persister?.(W,{client:m.client,queryKey:m.queryKey,meta:m.options.meta,signal:m.signal},b):m.fetchFn=W}}}function ax(h,{pages:m,pageParams:b}){const S=m.length-1;return m.length>0?h.getNextPageParam(m[S],m,b[S],b):void 0}function sC(h,{pages:m,pageParams:b}){return m.length>0?h.getPreviousPageParam?.(m[0],m,b[0],b):void 0}var oC=class extends g1{#e;#t;#n;#r;constructor(h){super(),this.#e=h.client,this.mutationId=h.mutationId,this.#n=h.mutationCache,this.#t=[],this.state=h.state||lC(),this.setOptions(h.options),this.scheduleGc()}setOptions(h){this.options=h,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(h){this.#t.includes(h)||(this.#t.push(h),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:h}))}removeObserver(h){this.#t=this.#t.filter(m=>m!==h),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:h})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(h){const m=()=>{this.#i({type:"continue"})},b={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=m1({fn:()=>this.options.mutationFn?this.options.mutationFn(h,b):Promise.reject(new Error("No mutationFn found")),onFail:(k,A)=>{this.#i({type:"failed",failureCount:k,error:A})},onPause:()=>{this.#i({type:"pause"})},onContinue:m,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const S=this.state.status==="pending",z=!this.#r.canStart();try{if(S)m();else{this.#i({type:"pending",variables:h,isPaused:z}),await this.#n.config.onMutate?.(h,this,b);const A=await this.options.onMutate?.(h,b);A!==this.state.context&&this.#i({type:"pending",context:A,variables:h,isPaused:z})}const k=await this.#r.start();return await this.#n.config.onSuccess?.(k,h,this.state.context,this,b),await this.options.onSuccess?.(k,h,this.state.context,b),await this.#n.config.onSettled?.(k,null,this.state.variables,this.state.context,this,b),await this.options.onSettled?.(k,null,h,this.state.context,b),this.#i({type:"success",data:k}),k}catch(k){try{throw await this.#n.config.onError?.(k,h,this.state.context,this,b),await this.options.onError?.(k,h,this.state.context,b),await this.#n.config.onSettled?.(void 0,k,this.state.variables,this.state.context,this,b),await this.options.onSettled?.(void 0,k,h,this.state.context,b),k}finally{this.#i({type:"error",error:k})}}finally{this.#n.runNext(this)}}#i(h){const m=b=>{switch(h.type){case"failed":return{...b,failureCount:h.failureCount,failureReason:h.error};case"pause":return{...b,isPaused:!0};case"continue":return{...b,isPaused:!1};case"pending":return{...b,context:h.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:h.isPaused,status:"pending",variables:h.variables,submittedAt:Date.now()};case"success":return{...b,data:h.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...b,data:void 0,error:h.error,failureCount:b.failureCount+1,failureReason:h.error,isPaused:!1,status:"error"}}};this.state=m(this.state),hs.batch(()=>{this.#t.forEach(b=>{b.onMutationUpdate(h)}),this.#n.notify({mutation:this,type:"updated",action:h})})}};function lC(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var cC=class extends Ky{constructor(h={}){super(),this.config=h,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(h,m,b){const S=new oC({client:h,mutationCache:this,mutationId:++this.#n,options:h.defaultMutationOptions(m),state:b});return this.add(S),S}add(h){this.#e.add(h);const m=_y(h);if(typeof m=="string"){const b=this.#t.get(m);b?b.push(h):this.#t.set(m,[h])}this.notify({type:"added",mutation:h})}remove(h){if(this.#e.delete(h)){const m=_y(h);if(typeof m=="string"){const b=this.#t.get(m);if(b)if(b.length>1){const S=b.indexOf(h);S!==-1&&b.splice(S,1)}else b[0]===h&&this.#t.delete(m)}}this.notify({type:"removed",mutation:h})}canRun(h){const m=_y(h);if(typeof m=="string"){const S=this.#t.get(m)?.find(z=>z.state.status==="pending");return!S||S===h}else return!0}runNext(h){const m=_y(h);return typeof m=="string"?this.#t.get(m)?.find(S=>S!==h&&S.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){hs.batch(()=>{this.#e.forEach(h=>{this.notify({type:"removed",mutation:h})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(h){const m={exact:!0,...h};return this.getAll().find(b=>Jv(m,b))}findAll(h={}){return this.getAll().filter(m=>Jv(h,m))}notify(h){hs.batch(()=>{this.listeners.forEach(m=>{m(h)})})}resumePausedMutations(){const h=this.getAll().filter(m=>m.state.isPaused);return hs.batch(()=>Promise.all(h.map(m=>m.continue().catch(Ol))))}};function _y(h){return h.options.scope?.id}var uC=class extends Ky{constructor(h={}){super(),this.config=h,this.#e=new Map}#e;build(h,m,b){const S=m.queryKey,z=m.queryHash??F0(S,m);let k=this.get(z);return k||(k=new rC({client:h,queryKey:S,queryHash:z,options:h.defaultQueryOptions(m),state:b,defaultOptions:h.getQueryDefaults(S)}),this.add(k)),k}add(h){this.#e.has(h.queryHash)||(this.#e.set(h.queryHash,h),this.notify({type:"added",query:h}))}remove(h){const m=this.#e.get(h.queryHash);m&&(h.destroy(),m===h&&this.#e.delete(h.queryHash),this.notify({type:"removed",query:h}))}clear(){hs.batch(()=>{this.getAll().forEach(h=>{this.remove(h)})})}get(h){return this.#e.get(h)}getAll(){return[...this.#e.values()]}find(h){const m={exact:!0,...h};return this.getAll().find(b=>Qv(m,b))}findAll(h={}){const m=this.getAll();return Object.keys(h).length>0?m.filter(b=>Qv(h,b)):m}notify(h){hs.batch(()=>{this.listeners.forEach(m=>{m(h)})})}onFocus(){hs.batch(()=>{this.getAll().forEach(h=>{h.onFocus()})})}onOnline(){hs.batch(()=>{this.getAll().forEach(h=>{h.onOnline()})})}},hC=class{#e;#t;#n;#r;#i;#s;#o;#a;constructor(h={}){this.#e=h.queryCache||new uC,this.#t=h.mutationCache||new cC,this.#n=h.defaultOptions||{},this.#r=new Map,this.#i=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#o=f1.subscribe(async h=>{h&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=Ry.subscribe(async h=>{h&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(h){return this.#e.findAll({...h,fetchStatus:"fetching"}).length}isMutating(h){return this.#t.findAll({...h,status:"pending"}).length}getQueryData(h){const m=this.defaultQueryOptions({queryKey:h});return this.#e.get(m.queryHash)?.state.data}ensureQueryData(h){const m=this.defaultQueryOptions(h),b=this.#e.build(this,m),S=b.state.data;return S===void 0?this.fetchQuery(h):(h.revalidateIfStale&&b.isStaleByTime(t0(m.staleTime,b))&&this.prefetchQuery(m),Promise.resolve(S))}getQueriesData(h){return this.#e.findAll(h).map(({queryKey:m,state:b})=>{const S=b.data;return[m,S]})}setQueryData(h,m,b){const S=this.defaultQueryOptions({queryKey:h}),k=this.#e.get(S.queryHash)?.state.data,A=qA(m,k);if(A!==void 0)return this.#e.build(this,S).setData(A,{...b,manual:!0})}setQueriesData(h,m,b){return hs.batch(()=>this.#e.findAll(h).map(({queryKey:S})=>[S,this.setQueryData(S,m,b)]))}getQueryState(h){const m=this.defaultQueryOptions({queryKey:h});return this.#e.get(m.queryHash)?.state}removeQueries(h){const m=this.#e;hs.batch(()=>{m.findAll(h).forEach(b=>{m.remove(b)})})}resetQueries(h,m){const b=this.#e;return hs.batch(()=>(b.findAll(h).forEach(S=>{S.reset()}),this.refetchQueries({type:"active",...h},m)))}cancelQueries(h,m={}){const b={revert:!0,...m},S=hs.batch(()=>this.#e.findAll(h).map(z=>z.cancel(b)));return Promise.all(S).then(Ol).catch(Ol)}invalidateQueries(h,m={}){return hs.batch(()=>(this.#e.findAll(h).forEach(b=>{b.invalidate()}),h?.refetchType==="none"?Promise.resolve():this.refetchQueries({...h,type:h?.refetchType??h?.type??"active"},m)))}refetchQueries(h,m={}){const b={...m,cancelRefetch:m.cancelRefetch??!0},S=hs.batch(()=>this.#e.findAll(h).filter(z=>!z.isDisabled()&&!z.isStatic()).map(z=>{let k=z.fetch(void 0,b);return b.throwOnError||(k=k.catch(Ol)),z.state.fetchStatus==="paused"?Promise.resolve():k}));return Promise.all(S).then(Ol)}fetchQuery(h){const m=this.defaultQueryOptions(h);m.retry===void 0&&(m.retry=!1);const b=this.#e.build(this,m);return b.isStaleByTime(t0(m.staleTime,b))?b.fetch(m):Promise.resolve(b.state.data)}prefetchQuery(h){return this.fetchQuery(h).then(Ol).catch(Ol)}fetchInfiniteQuery(h){return h.behavior=rx(h.pages),this.fetchQuery(h)}prefetchInfiniteQuery(h){return this.fetchInfiniteQuery(h).then(Ol).catch(Ol)}ensureInfiniteQueryData(h){return h.behavior=rx(h.pages),this.ensureQueryData(h)}resumePausedMutations(){return Ry.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(h){this.#n=h}setQueryDefaults(h,m){this.#r.set(dg(h),{queryKey:h,defaultOptions:m})}getQueryDefaults(h){const m=[...this.#r.values()],b={};return m.forEach(S=>{fg(h,S.queryKey)&&Object.assign(b,S.defaultOptions)}),b}setMutationDefaults(h,m){this.#i.set(dg(h),{mutationKey:h,defaultOptions:m})}getMutationDefaults(h){const m=[...this.#i.values()],b={};return m.forEach(S=>{fg(h,S.mutationKey)&&Object.assign(b,S.defaultOptions)}),b}defaultQueryOptions(h){if(h._defaulted)return h;const m={...this.#n.queries,...this.getQueryDefaults(h.queryKey),...h,_defaulted:!0};return m.queryHash||(m.queryHash=F0(m.queryKey,m)),m.refetchOnReconnect===void 0&&(m.refetchOnReconnect=m.networkMode!=="always"),m.throwOnError===void 0&&(m.throwOnError=!!m.suspense),!m.networkMode&&m.persister&&(m.networkMode="offlineFirst"),m.queryFn===j0&&(m.enabled=!1),m}defaultMutationOptions(h){return h?._defaulted?h:{...this.#n.mutations,...h?.mutationKey&&this.getMutationDefaults(h.mutationKey),...h,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},dC=Ae.createContext(void 0),fC=({client:h,children:m})=>(Ae.useEffect(()=>(h.mount(),()=>{h.unmount()}),[h]),U.jsx(dC.Provider,{value:h,children:m}));const pC=new hC;U1.createRoot(document.getElementById("root")).render(U.jsx(a0.StrictMode,{children:U.jsx(fC,{client:pC,children:U.jsx(HE,{children:U.jsx(FA,{})})})}));
